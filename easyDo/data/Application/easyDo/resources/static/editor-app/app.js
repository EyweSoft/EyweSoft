"use strict";var activitiModeler=angular.module("activitiModeler",["ngCookies","ngResource","ngSanitize","ngRoute","ngDragDrop","mgcrea.ngStrap","ngGrid","ngAnimate","pascalprecht.translate","duScroll"]),activitiModule=activitiModeler;activitiModeler.config(["$selectProvider","$translateProvider",function(e,t){angular.extend(e.defaults,{caretHtml:'&nbsp;<i class="icon icon-caret-down"></i>'}),t.useStaticFilesLoader({prefix:"./editor-app/i18n/",suffix:".json"}),t.preferredLanguage("en"),t.useCookieStorage()}]).run(["$rootScope","$timeout","$modal","$translate","$location","$window","$http","$q",function(e,t,n,i,o,r,s,l){e.config=ACTIVITI.CONFIG,e.editorInitialized=!1,e.editorFactory=l.defer(),e.forceSelectionRefresh=!1,e.ignoreChanges=!1,e.validationErrors=[],e.staticIncludeVersion=Date.now(),e.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},e.$on("$includeContentLoaded",(function(n){if(!e.editorInitialized){ORYX._loadPlugins(),!function(t){var n=KISBPM.URL.getModel(t);s({method:"GET",url:n}).success((function(t,n,i,o){e.editor=new ORYX.Editor(t),e.modelData=angular.fromJson(t),e.editorFactory.resolve()})).error((function(e,n,i,o){console.log("Error loading model with id "+t+" "+e)}))}(EDITOR.UTIL.getParameterByName("modelId")),e.window={};var i=function(){e.window.width=r.innerWidth,e.window.height=r.innerHeight};angular.element(r).bind("resize",(function(){e.safeApply(i())})),e.$watch("window.forceRefresh",(function(n){n&&t((function(){i(),e.window.forceRefresh=!1}))})),i(),jQuery(window).resize((function(){var t=jQuery("#editor-header").offset(),n=jQuery("#propertySection").height(),i=jQuery("#canvasSection"),o=jQuery("#main-header");if(null!=t&&null!==t&&null!=n&&null!=i&&null!==o){if(e.editor){var r=e.editor.selection,s=e.editor._subSelection;e.selectedElements=r,e.subSelectionElements=s,r&&r.length>0&&(e.selectedElementBeforeScrolling=r[0],e.editor.setSelection([]),e.editor.setSelection(e.selectedElements,e.subSelectionElements),e.selectedElements=void 0,e.subSelectionElements=void 0)}var l=jQuery(window).height()-t.top-o.height()-21;i.height(l-n),jQuery("#paletteSection").height(l);var c=null;i&&i[0].children[1]&&(c=i[0].children[1]);var a=i.position().top,u=i.position().left,d=i[0].clientHeight,p=i[0].clientWidth,y=0,E=0;c&&(E=c.clientWidth||c.parentNode.clientWidth),E<i[0].clientWidth&&(u-=(y=E-i[0].clientWidth)/2,p+=y);var f=17,h=20,v=jQuery("#canvas-grow-N");v.css("top",a+h+"px"),v.css("left",u-10+(p-f)/2+"px");var m=jQuery("#canvas-grow-S");m.css("top",a+d-h-8+"px"),m.css("left",u-10+(p-f)/2+"px");var g=jQuery("#canvas-grow-E");g.css("top",a-10+(d-f)/2+"px"),g.css("left",u+p-h-8+"px");var S=jQuery("#canvas-grow-W");S.css("top",a-10+(d-f)/2+"px"),S.css("left",u+h+"px"),(v=jQuery("#canvas-shrink-N")).css("top",a+h+"px"),v.css("left",u+10+(p-f)/2+"px"),(m=jQuery("#canvas-shrink-S")).css("top",a+d-h-8+"px"),m.css("left",u+10+(p-f)/2+"px"),(g=jQuery("#canvas-shrink-E")).css("top",a+10+(d-f)/2+"px"),g.css("left",u+p-h-8+"px"),(S=jQuery("#canvas-shrink-W")).css("top",a+10+(d-f)/2+"px"),S.css("left",u+h+"px")}})),jQuery(window).trigger("resize"),jQuery.fn.scrollStopped=function(e){jQuery(this).scroll((function(){var t=jQuery(this);t.data("scrollTimeout")&&clearTimeout(t.data("scrollTimeout")),t.data("scrollTimeout",setTimeout(e,50,this))}))},(o=jQuery("#canvasSection")).scroll((function(){var t=e.editor.selection,n=e.editor._subSelection;e.selectedElements=t,e.subSelectionElements=n,t&&t.length>0&&(e.selectedElementBeforeScrolling=t[0]),jQuery(".Oryx_button").each((function(t,n){e.orginalOryxButtonStyle=n.style.display,n.style.display="none"})),jQuery(".resizer_southeast").each((function(t,n){e.orginalResizerSEStyle=n.style.display,n.style.display="none"})),jQuery(".resizer_northwest").each((function(t,n){e.orginalResizerNWStyle=n.style.display,n.style.display="none"})),e.editor.handleEvents({type:ORYX.CONFIG.EVENT_CANVAS_SCROLL})})),o.scrollStopped((function(){function t(e){jQuery(e).position().top>0?e.style.display="block":e.style.display="none"}e.editor.setSelection([]),e.editor.setSelection(e.selectedElements,e.subSelectionElements),e.selectedElements=void 0,e.subSelectionElements=void 0,jQuery(".Oryx_button").each((function(e,n){t(n)})),jQuery(".resizer_southeast").each((function(e,n){t(n)})),jQuery(".resizer_northwest").each((function(e,n){t(n)}))})),e.editorInitialized=!0}var o})),e.editorFactory.promise.then((function(){KISBPM.eventBus.editor=e.editor,[{oryxType:ORYX.CONFIG.EVENT_SELECTION_CHANGED,kisBpmType:KISBPM.eventBus.EVENT_TYPE_SELECTION_CHANGE},{oryxType:ORYX.CONFIG.EVENT_DBLCLICK,kisBpmType:KISBPM.eventBus.EVENT_TYPE_DOUBLE_CLICK},{oryxType:ORYX.CONFIG.EVENT_MOUSEOUT,kisBpmType:KISBPM.eventBus.EVENT_TYPE_MOUSE_OUT},{oryxType:ORYX.CONFIG.EVENT_MOUSEOVER,kisBpmType:KISBPM.eventBus.EVENT_TYPE_MOUSE_OVER}].forEach((function(t){e.editor.registerOnEvent(t.oryxType,(function(e){KISBPM.eventBus.dispatch(t.kisBpmType,e)}))})),e.editor.registerOnEvent(ORYX.CONFIG.EVENT_SHAPEREMOVED,(function(e){var t=document.getElementById(e.shape.resourceId+"-validate-button");t&&(t.style.display="none")})),KISBPM.eventBus.dispatch(KISBPM.eventBus.EVENT_TYPE_EDITOR_READY,{type:KISBPM.eventBus.EVENT_TYPE_EDITOR_READY})})),e.alerts={queue:[]},e.showAlert=function(n){n.queue.length>0?(n.current=n.queue.shift(),n.timeout=t((function(){0==n.queue.length?(n.current=void 0,n.timeout=void 0):e.showAlert(n)}),"error"==n.current.type?5e3:1e3)):e.alerts.current=void 0},e.addAlert=function(t,n){var i={message:t,type:n};e.alerts.timeout?e.alerts.queue.push(i):(e.alerts.queue.push(i),e.showAlert(e.alerts))},e.dismissAlert=function(){e.alerts.timeout?(t.cancel(e.alerts.timeout),e.alerts.timeout=void 0,e.showAlert(e.alerts)):e.alerts.current=void 0},e.addAlertPromise=function(t,n){t&&t.then((function(t){e.addAlert(t,n)}))}}]).filter("dateformat",(function(){return function(e,t){return e?t?moment(e).format(t):moment(e).calendar():""}}));