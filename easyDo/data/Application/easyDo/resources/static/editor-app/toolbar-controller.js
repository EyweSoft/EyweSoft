"use strict";angular.module("activitiModeler").controller("ToolbarController",["$scope","$http","$modal","$q","$rootScope","$translate","$location",function(t,e,o,n,a,r,c){t.editorFactory.promise.then((function(){t.items=KISBPM.TOOLBAR_CONFIG.items})),t.secondaryItems=KISBPM.TOOLBAR_CONFIG.secondaryItems;var i=function(t,e){for(var o=Array.prototype.slice.call(arguments).splice(2),n=t.split("."),a=n.pop(),r=0;r<n.length;r++)e=e[n[r]];return e[a].apply(this,o)};t.toolbarButtonClicked=function(c){var l=t.items[c],d={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};i(l.action,window,d);var s={type:KISBPM.eventBus.EVENT_TYPE_TOOLBAR_BUTTON_CLICKED,toolbarItem:l};KISBPM.eventBus.dispatch(s.type,s)},t.toolbarSecondaryButtonClicked=function(a){var l=t.secondaryItems[a],d={$scope:t,$http:e,$modal:o,$q:n,$translate:r,$location:c};i(l.action,window,d)},Mousetrap.bind(["command+z","ctrl+z"],(function(c){var i={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};return KISBPM.TOOLBAR.ACTIONS.undo(i),!1})),Mousetrap.bind(["command+y","ctrl+y"],(function(c){var i={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};return KISBPM.TOOLBAR.ACTIONS.redo(i),!1})),Mousetrap.bind(["command+c","ctrl+c"],(function(c){var i={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};return KISBPM.TOOLBAR.ACTIONS.copy(i),!1})),Mousetrap.bind(["command+v","ctrl+v"],(function(c){var i={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};return KISBPM.TOOLBAR.ACTIONS.paste(i),!1})),Mousetrap.bind(["del"],(function(c){var i={$scope:t,$rootScope:a,$http:e,$modal:o,$q:n,$translate:r};return KISBPM.TOOLBAR.ACTIONS.deleteItem(i),!1})),t.undoStack=[],t.redoStack=[],t.editorFactory.promise.then((function(){t.editor.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,(function(e){if(e.commands){t.undoStack.push(e.commands),t.redoStack=[];for(var o=0;o<t.items.length;o++){var n=t.items[o];"KISBPM.TOOLBAR.ACTIONS.undo"===n.action?t.safeApply((function(){n.enabled=!0})):"KISBPM.TOOLBAR.ACTIONS.redo"===n.action?t.safeApply((function(){n.enabled=!1})):"KISBPM.TOOLBAR.ACTIONS.saveModel"===n.action&&(t.safeApply((function(){n.enabled=!0})),jQuery("#isFlowChanged").val("Y"))}t.editor.getCanvas().update(),t.editor.updateSelection()}}))})),t.editorFactory.promise.then((function(){t.editor.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,(function(e){for(var o=e.elements,n=0;n<t.items.length;n++){var a=t.items[n];if(a.enabledAction&&"element"===a.enabledAction){var r=1;a.minSelectionCount&&(r=a.minSelectionCount),a.minSelectionCount>1&&(a.enabled=!0),o.length>=r&&!a.enabled?t.safeApply((function(){jQuery("#delete-button").is(":visible")?a.enabled=!0:a.enabled=!1})):0==o.length&&a.enabled&&t.safeApply((function(){a.enabled=!1}))}}}))}))}]);