var KisBpmTaskListenersCtrl=["$scope","$modal","$timeout","$translate",function(e,s,t,i){s({template:"editor-app/configuration/properties/task-listeners-popup.html?version="+Date.now(),scope:e})}],KisBpmTaskListenersPopupCtrl=["$scope","$q","$translate",function(e,s,t){if(void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.taskListeners&&null!==e.property.value.taskListeners){e.property.value.taskListeners.constructor==String?e.taskListeners=JSON.parse(e.property.value.taskListeners):e.taskListeners=angular.copy(e.property.value.taskListeners);for(var i=0;i<e.taskListeners.length;i++){var l=e.taskListeners[i];void 0!==l.className&&""!==l.className?l.implementation=l.className:void 0!==l.expression&&""!==l.expression?l.implementation=l.expression:void 0!==l.delegateExpression&&""!==l.delegateExpression&&(l.implementation=l.delegateExpression)}}else e.taskListeners=[];e.selectedListeners=[],e.selectedFields=[],e.translationsRetrieved=!1,e.labels={};var n=t("PROPERTY.TASKLISTENERS.EVENT"),r=t("PROPERTY.TASKLISTENERS.FIELDS.IMPLEMENTATION"),a=t("PROPERTY.TASKLISTENERS.FIELDS.NAME");s.all([n,r,a]).then((function(s){e.labels.eventLabel=s[0],e.labels.implementationLabel=s[1],e.labels.nameLabel=s[2],e.translationsRetrieved=!0,e.gridOptions={data:"taskListeners",enableRowReordering:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:e.selectedListeners,afterSelectionChange:function(s,t){if(e.selectedFields.length=0,e.selectedListeners.length>0){var i=e.selectedListeners[0].fields;if(null!=i)for(var l=0;l<i.length;l++){var n=i[l];void 0!==n.stringValue&&""!==n.stringValue?n.implementation=n.stringValue:void 0!==n.expression&&""!==n.expression?n.implementation=n.expression:void 0!==n.string&&""!==n.string&&(n.implementation=n.string)}}},columnDefs:[{field:"event",displayName:e.labels.eventLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridFieldOptions={data:"selectedListeners[0].fields",enableRowReordering:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:e.selectedFields,columnDefs:[{field:"name",displayName:e.labels.name},{field:"implementation",displayName:e.labels.implementationLabel}]}})),e.listenerDetailsChanged=function(){""!==e.selectedListeners[0].className?e.selectedListeners[0].implementation=e.selectedListeners[0].className:""!==e.selectedListeners[0].expression?e.selectedListeners[0].implementation=e.selectedListeners[0].expression:""!==e.selectedListeners[0].delegateExpression?e.selectedListeners[0].implementation=e.selectedListeners[0].delegateExpression:e.selectedListeners[0].implementation=""},e.addNewListener=function(){e.taskListeners.push({event:"create",implementation:"",className:"",expression:"",delegateExpression:""})},e.removeListener=function(){if(e.selectedListeners.length>0){var s=e.taskListeners.indexOf(e.selectedListeners[0]);e.gridOptions.selectItem(s,!1),e.taskListeners.splice(s,1),e.selectedListeners.length=0,s<e.taskListeners.length?e.gridOptions.selectItem(s+1,!0):e.taskListeners.length>0&&e.gridOptions.selectItem(s-1,!0)}},e.moveListenerUp=function(){if(e.selectedListeners.length>0){var s=e.taskListeners.indexOf(e.selectedListeners[0]);if(0!=s){var t=e.taskListeners[s];e.taskListeners.splice(s,1),$timeout((function(){e.taskListeners.splice(s+-1,0,t)}),100)}}},e.moveListenerDown=function(){if(e.selectedListeners.length>0){var s=e.taskListeners.indexOf(e.selectedListeners[0]);if(s!=e.taskListeners.length-1){var t=e.taskListeners[s];e.taskListeners.splice(s,1),$timeout((function(){e.taskListeners.splice(s+1,0,t)}),100)}}},e.fieldDetailsChanged=function(){""!=e.selectedFields[0].stringValue?e.selectedFields[0].implementation=e.selectedFields[0].stringValue:""!=e.selectedFields[0].expression?e.selectedFields[0].implementation=e.selectedFields[0].expression:""!=e.selectedFields[0].string?e.selectedFields[0].implementation=e.selectedFields[0].string:e.selectedFields[0].implementation=""},e.addNewField=function(){e.selectedListeners.length>0&&(null==e.selectedListeners[0].fields&&(e.selectedListeners[0].fields=[]),e.selectedListeners[0].fields.push({name:"fieldName",implementation:"",stringValue:"",expression:"",string:""}))},e.removeField=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);e.gridFieldOptions.selectItem(s,!1),e.selectedListeners[0].fields.splice(s,1),e.selectedFields.length=0,s<e.selectedListeners[0].fields.length?e.gridFieldOptions.selectItem(s+1,!0):e.selectedListeners[0].fields.length>0&&e.gridFieldOptions.selectItem(s-1,!0)}},e.moveFieldUp=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);if(0!=s){var t=e.selectedListeners[0].fields[s];e.selectedListeners[0].fields.splice(s,1),$timeout((function(){e.selectedListeners[0].fields.splice(s+-1,0,t)}),100)}}},e.moveFieldDown=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);if(s!=e.selectedListeners[0].fields.length-1){var t=e.selectedListeners[0].fields[s];e.selectedListeners[0].fields.splice(s,1),$timeout((function(){e.selectedListeners[0].fields.splice(s+1,0,t)}),100)}}},e.save=function(){e.taskListeners.length>0?(e.property.value={},e.property.value.taskListeners=e.taskListeners):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.close()},e.close=function(){e.property.mode="read",e.$hide()}}];