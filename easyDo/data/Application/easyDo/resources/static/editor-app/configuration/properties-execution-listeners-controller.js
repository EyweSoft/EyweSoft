var KisBpmExecutionListenersCtrl=["$scope","$modal","$timeout","$translate",function(e,s,t,i){s({template:"editor-app/configuration/properties/execution-listeners-popup.html?version="+Date.now(),scope:e})}],KisBpmExecutionListenersPopupCtrl=["$scope","$q","$translate",function(e,s,t){if(void 0!==e.property.value&&null!==e.property.value&&void 0!==e.property.value.executionListeners&&null!==e.property.value.executionListeners){e.property.value.executionListeners.constructor==String?e.executionListeners=JSON.parse(e.property.value.executionListeners):e.executionListeners=angular.copy(e.property.value.executionListeners);for(var i=0;i<e.executionListeners.length;i++){var n=e.executionListeners[i];void 0!==n.className&&""!==n.className?n.implementation=n.className:void 0!==n.expression&&""!==n.expression?n.implementation=n.expression:void 0!==n.delegateExpression&&""!==n.delegateExpression&&(n.implementation=n.delegateExpression)}}else e.executionListeners=[];e.selectedListeners=[],e.selectedFields=[],e.translationsRetrieved=!1,e.labels={};var l=t("PROPERTY.EXECUTIONLISTENERS.EVENT"),r=t("PROPERTY.EXECUTIONLISTENERS.FIELDS.IMPLEMENTATION"),d=t("PROPERTY.EXECUTIONLISTENERS.FIELDS.NAME");s.all([l,r,d]).then((function(s){e.labels.eventLabel=s[0],e.labels.implementationLabel=s[1],e.labels.nameLabel=s[2],e.translationsRetrieved=!0,e.gridOptions={data:"executionListeners",enableRowReordering:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:e.selectedListeners,afterSelectionChange:function(s,t){if(e.selectedFields.length=0,e.selectedListeners.length>0){var i=e.selectedListeners[0].fields;if(null!=i)for(var n=0;n<i.length;n++){var l=i[n];void 0!==l.stringValue&&""!==l.stringValue?l.implementation=l.stringValue:void 0!==l.expression&&""!==l.expression?l.implementation=l.expression:void 0!==l.string&&""!==l.string&&(l.implementation=l.string)}}},columnDefs:[{field:"event",displayName:e.labels.eventLabel},{field:"implementation",displayName:e.labels.implementationLabel}]},e.gridFieldOptions={data:"selectedListeners[0].fields",enableRowReordering:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:e.selectedFields,columnDefs:[{field:"name",displayName:e.labels.nameLabel},{field:"implementation",displayName:e.labels.implementationLabel}]}})),e.listenerDetailsChanged=function(){""!==e.selectedListeners[0].className?e.selectedListeners[0].implementation=e.selectedListeners[0].className:""!==e.selectedListeners[0].expression?e.selectedListeners[0].implementation=e.selectedListeners[0].expression:""!==e.selectedListeners[0].delegateExpression?e.selectedListeners[0].implementation=e.selectedListeners[0].delegateExpression:e.selectedListeners[0].implementation=""},e.addNewListener=function(){e.executionListeners.push({event:"start",implementation:"",className:"",expression:"",delegateExpression:""})},e.removeListener=function(){if(e.selectedListeners.length>0){var s=e.executionListeners.indexOf(e.selectedListeners[0]);e.gridOptions.selectItem(s,!1),e.executionListeners.splice(s,1),e.selectedListeners.length=0,s<e.executionListeners.length?e.gridOptions.selectItem(s+1,!0):e.executionListeners.length>0&&e.gridOptions.selectItem(s-1,!0)}},e.moveListenerUp=function(){if(e.selectedListeners.length>0){var s=e.executionListeners.indexOf(e.selectedListeners[0]);if(0!=s){var t=e.executionListeners[s];e.executionListeners.splice(s,1),$timeout((function(){e.executionListeners.splice(s+-1,0,t)}),100)}}},e.moveListenerDown=function(){if(e.selectedListeners.length>0){var s=e.executionListeners.indexOf(e.selectedListeners[0]);if(s!=e.executionListeners.length-1){var t=e.executionListeners[s];e.executionListeners.splice(s,1),$timeout((function(){e.executionListeners.splice(s+1,0,t)}),100)}}},e.fieldDetailsChanged=function(){""!==e.selectedFields[0].stringValue?e.selectedFields[0].implementation=e.selectedFields[0].stringValue:""!==e.selectedFields[0].expression?e.selectedFields[0].implementation=e.selectedFields[0].expression:""!==e.selectedFields[0].string?e.selectedFields[0].implementation=e.selectedFields[0].string:e.selectedFields[0].implementation=""},e.addNewField=function(){e.selectedListeners.length>0&&(null==e.selectedListeners[0].fields&&(e.selectedListeners[0].fields=[]),e.selectedListeners[0].fields.push({name:"fieldName",implementation:"",stringValue:"",expression:"",string:""}))},e.removeField=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);e.gridFieldOptions.selectItem(s,!1),e.selectedListeners[0].fields.splice(s,1),e.selectedFields.length=0,s<e.selectedListeners[0].fields.length?e.gridFieldOptions.selectItem(s+1,!0):e.selectedListeners[0].fields.length>0&&e.gridFieldOptions.selectItem(s-1,!0)}},e.moveFieldUp=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);if(0!=s){var t=e.selectedListeners[0].fields[s];e.selectedListeners[0].fields.splice(s,1),$timeout((function(){e.selectedListeners[0].fields.splice(s+-1,0,t)}),100)}}},e.moveFieldDown=function(){if(e.selectedFields.length>0){var s=e.selectedListeners[0].fields.indexOf(e.selectedFields[0]);if(s!=e.selectedListeners[0].fields.length-1){var t=e.selectedListeners[0].fields[s];e.selectedListeners[0].fields.splice(s,1),$timeout((function(){e.selectedListeners[0].fields.splice(s+1,0,t)}),100)}}},e.save=function(){e.executionListeners.length>0?(e.property.value={},e.property.value.executionListeners=e.executionListeners):e.property.value=null,e.updatePropertyInModel(e.property),e.close()},e.cancel=function(){e.$hide(),e.property.mode="read"},e.close=function(){e.$hide(),e.property.mode="read"}}];