var KisBpmShapeSelectionCtrl=["$rootScope","$scope","$timeout","$translate",function(e,t,a,n){t.selectedMorphShapes=[],t.availableMorphShapes=[];for(var o=0;o<t.morphShapes.length;o++)t.morphShapes[o].id!=t.currentSelectedShape.getStencil().idWithoutNs()&&t.availableMorphShapes.push(t.morphShapes[o]);t.gridOptions={data:"availableMorphShapes",enableRowReordering:!0,headerRowHeight:28,multiSelect:!1,keepLastSelected:!1,selectedItems:t.selectedMorphShapes,columnDefs:[{field:"objectId",displayName:"Icon",width:50,cellTemplate:"editor-app/popups/icon-template.html?version="+Date.now()},{field:"name",displayName:"Name"}]},t.select=function(){if(t.selectedMorphShapes.length>0){var e=ORYX.Core.Command.extend({construct:function(e,t,a){this.shape=e,this.stencil=t,this.facade=a},execute:function(){var e=this.shape,t=this.stencil,a=e.resourceId,n=e.serialize();t.properties().each(function(e){e.readonly()&&(n=n.reject((function(t){return t.name==e.id()})))}.bind(this)),this.newShape?(newShape=this.newShape,this.facade.getCanvas().add(newShape)):newShape=this.facade.createShape({type:t.id(),namespace:t.namespace(),resourceId:a});var o=n.find((function(e){return"oryx"===e.prefix&&"bounds"===e.name})),s=null;if(this.facade.getRules().preserveBounds(e.getStencil())){var i=e.bounds.height(),h=e.bounds.width();newShape.minimumSize&&(e.bounds.height()<newShape.minimumSize.height&&(i=newShape.minimumSize.height),e.bounds.width()<newShape.minimumSize.width&&(h=newShape.minimumSize.width)),newShape.maximumSize&&(e.bounds.height()>newShape.maximumSize.height&&(i=newShape.maximumSize.height),e.bounds.width()>newShape.maximumSize.width&&(h=newShape.maximumSize.width)),s={a:{x:e.bounds.a.x,y:e.bounds.a.y},b:{x:e.bounds.a.x+h,y:e.bounds.a.y+i}}}else{var r=o.value.split(",");if(parseInt(r[0],10)>parseInt(r[2],10)){var d=r[0];r[0]=r[2],r[2]=d,d=r[1],r[1]=r[3],r[3]=d}r[2]=parseInt(r[0],10)+newShape.bounds.width(),r[3]=parseInt(r[1],10)+newShape.bounds.height(),o.value=r.join(",")}var p=e.bounds.center();null!==s&&newShape.bounds.set(s),this.setRelatedDockers(e,newShape);var c=e.node.parentNode,S=e.node.nextSibling;this.facade.deleteShape(e),newShape.deserialize(n),e.getStencil().property("oryx-bgcolor")&&e.properties["oryx-bgcolor"]&&e.getStencil().property("oryx-bgcolor").value().toUpperCase()==e.properties["oryx-bgcolor"].toUpperCase()&&newShape.getStencil().property("oryx-bgcolor")&&newShape.setProperty("oryx-bgcolor",newShape.getStencil().property("oryx-bgcolor").value()),null!==s&&newShape.bounds.set(s),"edge"!==newShape.getStencil().type()&&0!=newShape.dockers.length&&newShape.dockers[0].getDockedShape()||newShape.bounds.centerMoveTo(p),"node"!==newShape.getStencil().type()||0!=newShape.dockers.length&&newShape.dockers[0].getDockedShape()||this.setRelatedDockers(newShape,newShape),S?c.insertBefore(newShape.node,S):c.appendChild(newShape.node),this.facade.setSelection([newShape]),this.facade.getCanvas().update(),this.facade.updateSelection(),this.newShape=newShape},rollback:function(){this.shape&&this.newShape&&this.newShape.parent&&(this.newShape.parent.add(this.shape),this.setRelatedDockers(this.newShape,this.shape),this.facade.deleteShape(this.newShape),this.facade.setSelection([this.shape]),this.facade.getCanvas().update(),this.facade.updateSelection())},setRelatedDockers:function(e,t){"node"===e.getStencil().type()?((e.incoming||[]).concat(e.outgoing||[]).each((function(a){a.dockers.each((function(n){if(n.getDockedShape()==e){var o=Object.clone(n.referencePoint),s={x:o.x*t.bounds.width()/e.bounds.width(),y:o.y*t.bounds.height()/e.bounds.height()};if(n.setDockedShape(t),n.setReferencePoint(s),a instanceof ORYX.Core.Edge)n.bounds.centerMoveTo(s);else{var i=e.absoluteXY();n.bounds.centerMoveTo({x:s.x+i.x,y:s.y+i.y})}}}))})),e.dockers.length>0&&e.dockers.first().getDockedShape()&&(t.dockers.first().setDockedShape(e.dockers.first().getDockedShape()),t.dockers.first().setReferencePoint(Object.clone(e.dockers.first().referencePoint)))):(t.dockers.first().setDockedShape(e.dockers.first().getDockedShape()),t.dockers.first().setReferencePoint(e.dockers.first().referencePoint),t.dockers.last().setDockedShape(e.dockers.last().getDockedShape()),t.dockers.last().setReferencePoint(e.dockers.last().referencePoint))}}),a=void 0,n=t.editor.getStencilSets().values(),o=t.selectedMorphShapes[0].id;t.selectedMorphShapes[0].genericTaskId&&(o=t.selectedMorphShapes[0].genericTaskId);for(var s=0;s<n.length;s++)for(var i=n[s].nodes(),h=0;h<i.length;h++)if(i[h].idWithoutNs()===o){a=i[h];break}if(!a)return;var r=new e(t.currentSelectedShape,a,t.editor);t.editor.executeCommands([r])}t.close()},t.cancel=function(){t.$hide()},t.close=function(){t.$hide()}}];