function skinChanger(){$(".right-sidebar .choose-skin li").on("click",(function(){var e=$("body"),t=$(this),a=$(".right-sidebar .choose-skin li.active").data("theme");$(".right-sidebar .choose-skin li").removeClass("active"),e.removeClass("theme-"+a),t.addClass("active"),e.addClass("theme-"+t.data("theme"))}))}function changeMenu(e,t,a,i){if(i){var n=$(".content.iframeSign");if(n&&n.length>0){n.removeClass("iframeSign");var r=parent.$("#J_iframe"),o=r.height();o&&(iframeAddHeight=47,r.height(o-iframeAddHeight))}$(".is-actived").removeClass("is-actived"),i.addClass("is-actived");var l=i.attr("type");if(l&&("CONTAIN"==l||"LINK"==l)){showLoading();var s="",d="";"CONTAIN"==l?d=t:s=t,$.ajax({url:"/page/getTabContent",type:"post",data:{tabUrl:s,tabCls:d},async:!1,success:function(e){if(e){var t=$("#J_iframe");t.show(),$(".tabSet").remove(),d?(t.attr("src",""),setTimeout((function(){var a=t.contents().get(0);$(a).find("body").html(e),hideLoading()}),200)):s&&(t.attr("src",e),hideLoading())}}})}}t&&(e.siblings().removeClass("active open"),e.addClass("active open"),intoIframePage(t,!0),changeNav(a,t,e.find("a:first").find("span").text(),i?i.text():""))}function changeNav(e,t,a,i){$(".navigate-list li").removeClass("active"),$('.navigate-list li[url="'+t+'"]').addClass("active"),"/"===t.charAt(0)&&(t=t.substring(1)),$breadcrumb=$(".breadcrumb"),$breadcrumb.length||($breadcrumb=top.$(".breadcrumb")),i&&$("#title-text").text(i),$breadcrumb.find("li").removeClass("active"),e&&1!=e?2==e?($breadcrumb.find("h2.first-title").attr("src",t).html(a),$breadcrumb.find("li.first-title").attr("src",t).html('<a class="linked" href="javascript:void(0);">'+a+"</a>"),$breadcrumb.find("li.second-title, li.third-title").remove(),$breadcrumb.append('<li class="breadcrumb-item second-title active"><a class="linked" href="javascript:void(0);">'+i+"</a></li>")):3==e&&($breadcrumb.find("li.third-title").remove(),$breadcrumb.append('<li class="breadcrumb-item third-title active"><a class="linked" href="javascript:void(0);">'+a+"</a></li>")):($breadcrumb.find("li.second-title, li.third-title").remove(),$breadcrumb.find(".first-title").attr("src",t).html(a),$breadcrumb.find("li.first-title").addClass("active"));var n=$(".breadTab");n.length||(n=parent.$(".breadTab")),n.html(getTabsHtmlBySrc(t)),saveNavInfoToCache(t,$breadcrumb.html()+"#@#"+n.html())}function getTabsHtmlBySrc(e){showLoading();var t="";return e.indexOf("company")>=0?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'sys/company\')">公司信息</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'advanceSet/companyCalendar\')">公司日历</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'advanceSet\')">邮箱配置</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'advanceSet/navigateSet?type=SYS\')">导航栏配置</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'timerSet\')">定时器配置</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'sys/company/getLicenseInfo\')">产品许可</li>'):"sys/user/"==e?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'sys/user\')">用户信息</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'position\')">职位配置</li>'):"task/myTask"==e?(t+='<li class="breadTab-item" type="OWN" onclick="intoTab($(this), \'task/myTask?type=OWN\')">指派给我的</li>',t+='<li class="breadTab-item" type="ACT" onclick="intoTab($(this), \'task/myTask?type=ACT\')">我参与的</li>',t+='<li class="breadTab-item" type="CREATE" onclick="intoTab($(this), \'task/myTask?type=CREATE\')">我创建的</li>',t+='<li class="breadTab-item" type="MEMBER" onclick="intoTab($(this), \'task/myTask?type=MEMBER\')">成员任务</li>'):"workflow"==e?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'workflow\')">流程管理</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'workflowGroup\')">流程组合</li>'):"dashboard/dashboardList"==e?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'dashboard/dashboardList\')">仪表盘管理</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'dashboard/dashboardBlockList\')">区块管理</li>'):"workflow/myWorkflow"==e?(t+='<li class="breadTab-item" type="RECIVE" onclick="intoTab($(this), \'workflow/myWorkflow?type=RECIVE\')">指派给我的</li>',t+='<li class="breadTab-item" type="READ" onclick="intoTab($(this), \'workflow/myWorkflow?type=READ\')">知会我的</li>',t+='<li class="breadTab-item" type="CREATE" onclick="intoTab($(this), \'workflow/myWorkflow?type=CREATE\')">我创建的</li>'):"workReportList"==e?(t+='<li class="breadTab-item active" type="WEEKLY" onclick="intoTab($(this), \'workReportList?objectType=WEEKLY\')">周报</li>',t+='<li class="breadTab-item" type="MONTHLY" onclick="intoTab($(this), \'workReportList?objectType=MONTHLY\')">月报</li>'):"resourceCalendarList"==e?(t+='<li class="breadTab-item active" type="PENDING" onclick="intoTab($(this), \'resourceCalendarList?type=PENDING\')">待处理</li>',t+='<li class="breadTab-item" type="PROCESSED" onclick="intoTab($(this), \'resourceCalendarList?type=PROCESSED\')">已处理</li>'):e.indexOf("entity/myEntityList?objectType=PRQ")>=0?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'entity/myEntityList?objectType=PRQ\')">产品需求</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'workflow/myWorkflowList?objectType=MRQ\')">市场需求</li>'):e.indexOf("workflow/myWorkflowList?objectType=RSK")>=0?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'workflow/myWorkflowList?objectType=RSK\')">风险管理</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'rsk/rskLibraryList\')">风险库管理</li>'):e.indexOf("system/opreateRecordList")>=0?(t+='<li class="breadTab-item active" onclick="intoTab($(this), \'system/opreateRecordList?type=com\')">操作日志</li>',t+='<li class="breadTab-item" onclick="intoTab($(this), \'system/opreateRecordList?type=login\')">登录日志</li>'):hideLoading(),t}function intoTab(e,t){showLoading(),e.siblings().removeClass("active"),e.addClass("active");var a=e.attr("type"),i=$("#custom-iframe"),n=$(".page-ul .detail-sign");if(a){var r=$(".btn-box");"baseInfo"==a||"advance"==a||"commonAop"==a?r.attr("signType",a).show():r.attr("signType","").hide()}a&&"baseInfo"==a?(i.addClass("hide"),n.nextAll().show(),hideLoading()):e.attr("tabUrl")?(t="/"+e.attr("tabUrl")+"?objectType="+$("#objectType").val(),i.attr("src",t),i.removeClass("hide"),n.nextAll().hide()):"/"!==t.charAt(0)&&(e.siblings().removeClass("active"),e.addClass("active"),$("#J_iframe").attr("src",t),saveNavInfoToCache(t,$(".breadcrumb").html()+"#@#"+$(".breadTab").html()))}function saveNavInfoToCache(e,t){$.ajax({cache:!0,type:"POST",url:"/saveNavInfoToCache",data:{key:e,value:t},async:!1,success:function(e){}})}function intoMenuUrl(e,t,a){e&&a&&(intoIframePage(e,!0),changeNav(2,e,t,a))}function returnBack(e){window.history.back()}function addEntity(e,t,a){getLayerParam(e,"A"),a||(a=$("#objectType").val());var i,n=getCurRowId();if(i="MENU"==e?getPrefix(e)+"/addOrEditMenu/null?preId="+n+"&":"FIELD"==e?getPrefix(e)+"/addOrEditField/null?objectType="+a+"&preId="+n+"&":"USER"==e?getPrefix(e)+"/addOrEditUser/null?":"ROLE"==e?getPrefix(e)+"/addOrEditRole/null?preId="+n+"&":"DEPT"==e?getPrefix(e)+"/addOrEditDept/null?preId="+n+"&":"PISITION"==e?getPrefix(e)+"/addOrEditPisition/null?preId="+n+"&":getPrefix(e)+"/add?type="+e+(a?"&objectType="+a:"")+"&",i+="parentname="+window.name,isOpenIfarme(e))intoIframePage(i,!1,e);else if(isOpenWindowLikeIframe(e)){var r=isParentLayer(e);openWindowLikeIframe({url:i,title:title,isParent:r})}else top.layer.open({type:2,title:title,maxmin:!0,shadeClose:!1,area:[width,height],content:i})}function openEntity(e,t,a){if(showLoading(),e){if("WORKFLOWGROUPRLT"==e)return void hideLoading();if("MYWORKFLOW"==e)return $("#rowId_"+t).click(),void hideLoading()}getLayerParam(e,"V");var i=getPrefix(e)+"/view/"+t+"?";if("PAGE"==e){var n=$('tr[id="'+t+'"]').attr("sign");if(n&&"PAGENODE"==n)return void hideLoading();$.ajax({cache:!0,type:"POST",url:"/page/getPageType",data:{pageId:t},async:!1,success:function(e){!e||"LIST"!=e&&"IMPLIST"!=e&&"EXPLIST"!=e||(width="1200px",height="500px")}})}else{if("ENTITY"==e)return void $('tr[id="'+t+'"]').find(".entityMng").click();if("WORKFLOW"==e)return void $('tr[id="'+t+'"]').find(".workflowMng").click();if("PHASE"==e)i="/lifecycle/viewPhase/"+t+"?";else if("LIFECYCLEPHASE"==e)i="/lifecycle/viewLifecyclePhase/"+t+"?lifecycleId="+$("#id").val()+"&objectType="+$("#objectType").val()+"&";else if("DATASOURCE"==e)i="/field/dataSource/"+t+"?preId=&objectType="+objectType+"&";else if("INSTANCE"==e)i=getPrefix(e)+"/addOrEditInstance/"+t+"?objectType="+$("#objectType").val()+"&step=&preId=&";else if("REPORT_CHART"==e)i="/report/view/"+t+"?objectType="+$("#objectType").val()+"&preId=&";else if("OPERATE_RECORD"==e)i="/system/view/"+t+"?";else if("WORKFLOWGROUP"==e)i="/workflowGroup/view/"+t+"?";else if("SCRUM_BOARD"==e)i="/board/view/"+t+"?";else if("PJTPHASE"==e)i="/pjt/pjtPhase/"+t+"?";else if("PLN"==e){i="/plan/planTaskList?planId="+t+"&";var r=$("#isTemplate").val();title=r&&"Y"==r?"计划模板任务":"计划任务",width="100%",height="100%"}else isEntity(e)?i="/entity/view/"+t+"?objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&":isWorkflow(e)?i="/workflow/addOrEditWorkflow/"+t+"?objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&":"WEEKLY"==e||"MONTHLY"==e?(title="查看工作报",i="/workReport/"+t+"?objectType="+e+"&"):"REWPOINT"==e?(title="查看评审点",i="/rew/viewRewPoint/"+t+"?"):"REWELEMENT"==e?(title="查看评审要素",i="/rew/viewRewElement/"+t+"?"):i=getPrefix(e)+"/view/"+t+"?"}var o=a||window.name;if(o||(o=$("#parentName").val()),i+="isKeepTopWindow="+$("#isKeepTopWindow").val()+"&parentname="+o,isOpenIfarme(e))intoIframePage(i,!1,e);else if(isOpenWindowLikeIframe(e)){var l=isParentLayer(e);openWindowLikeIframe({url:i,title:title,isParent:l})}else top.layer.open({skin:"PLN"==e?"planClass":"openClass",type:2,title:title,maxmin:!0,shadeClose:!1,area:[width,height],content:i,end:function(e,t){e&&"function"==typeof reLoad&&reLoad(e,t)}})}$((function(){$("body").click((function(){$(".common-menu-hide").hide(),parent.$("#userInfo-ul").hide()})),$(".common-menu-hide").click((function(e){stopPropagation(e)})),jQuery.i18n&&jQuery.i18n.properties({name:"messages",path:"/i18n/",mode:"map",language:"zh_CN",callback:function(e){}}),$(".close-btn").click((function(){var e=top.layer.getFrameIndex(window.name);top.layer.close(e)}));var e=$("#pageTitle").val();if(e){(t=parent.$(".layui-layer-title")).length>1?$(t[t.length-1]).text(e):t.text(e)}else{var t,a=$("#winTitle").val();if(a)(t=parent.$(".winTitle")).length&&t.text(a)}}));var isClicked=!1,title,width,height;function intoIframePage(e,t,a,i){showLoading();var n="";if(!isClicked){isClicked=!0;var r=parent.$("#J_iframe");r.length||(r=$("#J_iframe")),r.length||(r=parent.parent.$("#J_iframe"));var o=r.parent();i&&o.find(".tabSet:visible").addClass("removeTab");var l=o.find(".tabSet:not(.removeTab)");if(t)hideOrShowBlockHeader(!0),l.remove(),r.attr("src",e).show(),isClicked=!1;else{hideOrShowBlockHeader(!1),r.hide(),l.hide(),n="tab_"+l.length;var s=$("<iframe>",{id:n,class:"tabSet "+a,width:"100%",height:r.height()+48,src:e});o.append(s)}setTimeout((function(){isClicked=!1}),1e3),o.find(".removeTab").remove()}return n}function tabReturnBack(e,t,a,i){var n=jQuery("#tabReturnBack");n.length||(n=parent.jQuery("#tabReturnBack")),n.length||(n=parent.parent.jQuery("#tabReturnBack")),e&&e.hasClass("return-back")?n.attr("isReturnBack",!0):n.attr("isReturnBack",!1),t?n.attr("isReturnTop",!0):n.attr("isReturnTop",!1),a?n.attr("isHide",!0):n.attr("isHide",!1),i?n.attr("isRefresh",!0):n.attr("isRefresh",!1),n.click()}function tabReturnBack2(e){var t=jQuery("#tabReturnBack");t.length||(t=parent.jQuery("#tabReturnBack")),t.length||(t=parent.parent.jQuery("#tabReturnBack")),e.isReturnBack?t.attr("isReturnBack",!0):t.attr("isReturnBack",!1),e.isReturnTop?t.attr("isReturnTop",!0):t.attr("isReturnTop",!1),e.isHide?t.attr("isHide",!0):t.attr("isHide",!1),e.isRefresh?t.attr("isRefresh",!0):t.attr("isRefresh",!1),e.isReturnParentList?t.attr("isReturnParentList",!0):t.attr("isReturnParentList",!1),e.isReturnPrev?t.attr("isReturnPrev",!0):t.attr("isReturnPrev",!1),t.click()}function layerWinCancel(e,t){var a=parent.layer.getFrameIndex(window.name);t?parent.layer.close(a,t):parent.layer.close(a)}function tabReturnBackCallback(e){var t=e.attr("isReturnBack"),a=e.attr("isReturnTop"),i=e.attr("isHide"),n=e.attr("isRefresh"),r=e.attr("isReturnParentList"),o=e.attr("isReturnPrev"),l=parent.$("#J_iframe");l.length||(l=$("#J_iframe"));var s=l.parent(),d=s.find(".tabSet:not(.removeTab)"),c=$("#isGantt").val();if(c&&"Y"==c){var p=parent.layer.getFrameIndex(window.name);parent.layer.close(p)}else if(d.length>0)if(t&&"true"==t){var f=!1,m=!1;if((u=d.eq(0)).length&&d.length>1)if(s.find(".tabSet:visible").attr("id")!=u.attr("id"))if((h=$(u.contents().get(0)).find(".layout-box.PJT"))&&h.length)f=!0;else{var y=$(u.contents().get(0)).find(".layout-box.module");y&&y.length&&(m=!0)}f||m?(u.show(),i?d.last().addClass("removeTab"):d.last().remove()):(hideOrShowBlockHeader(!0),l.show(),i?d.addClass("removeTab"):d.remove())}else{d.length<=1&&hideOrShowBlockHeader(!0);var u,h;f=!1;if((u=d.eq(0)).length&&d.length>1)(h=$(u.contents().get(0)).find(".layout-box.PJT"))&&h.length&&(f=!0),o&&"true"==o&&(f=!1);a&&"true"==a?(hideOrShowBlockHeader(!0),l.show(),i?d.addClass("removeTab"):d.remove()):(f||r&&"true"==r?u.show():d.last().prev().show(),i?d.last().addClass("removeTab"):d.last().remove())}else l.show(),hideOrShowBlockHeader(!0);refreshList(n,l)}function refreshList(e,t){if(e&&"false"!=e){var a=$(".refresh-action"),i=$(".tabSet:visible");if(i.length||(i=parent.$(".tabSet:visible")),i.length||(i=parent.parent.$(".tabSet:visible")),a.length)a.click();else if(i.length){var n=$(i.contents().get(0)).find(".custom-iframe");if(n.length)if((a=$(n.contents().get(0)).find(".refresh-action")).length)a.click();else"function"==typeof(r=n[0].contentWindow).reLoad&&r.reLoad();else(t=$(i.prev().contents().get(0)).find("iframe")).length||(t=$(i.prev())),"function"==typeof(r=t[0].contentWindow).reLoad&&r.reLoad()}else if(t&&t.length){var r;if((a=$(t.contents().get(0)).find(".refresh-action")).length)a.click();else"function"==typeof(r=t[0].contentWindow).reLoad&&r.reLoad()}}}function returnBackAndReLoad(e,t){tabReturnBack("",e,t,!0)}function winCloseAndReLoad(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e,"REFRESH")}function hideOrShowBlockHeader(e){var t=$(".block-header"),a=$("section.content");t.length||(t=parent.$(".block-header"),a=parent.$("section.content")),t.length||(t=parent.parent.$(".block-header"),a=parent.parent.$("section.content")),e?(t.show(),a.removeClass("maxWindow")):(t.hide(),a.addClass("maxWindow"))}function entityMng(e,t,a,i){e.attr("title"),"TSK"==i||i.toLowerCase(),intoIframePage("entity/baseInfo?objectType="+i,!1,t)}function editEntity(e,t,a,i){getLayerParam(e,"E"),a?"TYPE"!=a&&"PJT"!=a||"DOC"!=e&&"PRQ"!=e&&"TSC"!=e&&"TSP"!=e||(a=e):a=$("#objectType").val();var n;if("MENU"==e)n=getPrefix(e)+"/addOrEditMenu/"+t+"?preId=&";else if("FIELD"==e){n=getPrefix(e)+"/addOrEditField/"+t+"?objectType="+a+"&preId=&";var r=$('tr[id="'+t+'"]').attr("sign");r&&r.indexOf("CUS_G")>-1&&(width="830px",height="600px",title="编辑分组")}else if("PAGE"==e)n="/page/pageSet/"+t+"?objectType="+a+"&",$.ajax({cache:!0,type:"POST",url:"/page/getPageType",data:{pageId:t},async:!1,success:function(e){e&&"LIST"==e?(width="100%",height="100%",title="配置列表页面"):(width="100%",height="100%",title="配置表单页面")}}),!1;else if("STATUS"==e)n=getPrefix(e)+"/addOrEditStatus/"+t+"?objectType="+a+"&preId=&";else if("USER"==e)n=getPrefix(e)+"/addOrEditUser/"+t+"?";else if("ROLE"==e)n="TYPE"==a||"PJT"==a?"/type/addOrEditRole/"+t+"?":getPrefix(e)+"/addOrEditRole/"+t+"?";else if("DEPT"==e)n=getPrefix(e)+"/addOrEditDept/"+t+"?preId=&";else if("PHASE"==e)n="/lifecycle/addOrEditPhase/"+t+"?objectType="+a+"&";else if("LIFECYCLE"==e)n="/lifecycle/addOrEditLifecycle/"+t+"?objectType="+a+"&";else if("LIFECYCLEPHASE"==e){var o=$("#lifecycleId").val();n="/lifecycle/addOrEditLifecyclePhase/"+t+"?lifecycleId="+(o=o||$("#id").val())+"&objectType="+a+"&preId=&"}else"TYPE"==e?n="/type/addOrEditType/"+t+"?objectType="+a+"&preId=&parentId=&":"DATASOURCE"==e?n="/field/addOrEditSource/"+t+"?preId=&objectType="+a+"&":"INSTANCE"==e?n=getPrefix(e)+"/addOrEditInstance/"+t+"?objectType="+a+"&preId=&":"REPORT_CHART"==e?n="/report/addOrEditReportChart/"+t+"?objectType="+a+"&preId=&":"WORKFLOWGROUP"==e?n="/workflowGroup/addOrEditWorkflowGroup/"+t+"?preId=&":"WORKFLOWGROUPRLT"==e?n="/workflowGroup/addOrEditWorkflowGroupRlt/"+t+"?groupId=&":"SCRUM_BOARD"==e?n="/board/addOrEditScrumBoard/"+t+"?objectType="+a+"&preId=&":"PJTPHASE"==e?n="/pjt/addOrEditPjtPhase/"+t+"?":"POSITION"==e?n=getPrefix(e)+"/addOrEditPisition/"+t+"?preId=&":"PLN"==e?n="/plan/addOrEditPlan/"+t+"?preId=&":"RSKLIB"==e?n="/rsk/addOrEditRskLibrary/"+t+"?":"REWPOINT"==e?(title="编辑评审点",n="/rew/addOrEditRewPoint/"+t+"?preId=&"):n=isEntity(e)?"/entity/addOrEditEntity/"+t+"?objectType="+a+"&selectFolderId="+$("#selectFolderId").val()+"&":isWorkflow(e)?"PJT"==a?"/workflow/addOrEditWorkflow/"+t+"?objectType="+e+"&isEdit=Y&belongId="+$("#belongId").val()+"&belongType="+a+"&":"/workflow/addOrEditWorkflow/"+t+"?objectType="+a+"&isEdit=Y&":getPrefix(e)+"/edit/"+t+"?";var l=i||window.name;if(l||(l=$("#parentName").val()),n+="&parentname="+l,isOpenIfarme(e))intoIframePage(n,!1,e);else if(isOpenWindowLikeIframe(e)){var s=isParentLayer(e);openWindowLikeIframe({url:n,title:title,isParent:s})}else top.layer.open({skin:isEntity(e)?"openClass":"",type:2,title:title,maxmin:!0,shadeClose:!1,area:[width,height],content:n,end:function(e,t){if(e)if("function"==typeof reLoad)reLoad(e,t);else{var a=parent.layer.getFrameIndex(window.name);parent.layer.close(a,e)}}})}function editRole(e,t){top.layer.open({type:2,title:$.i18n.prop("user.edit.role"),maxmin:!0,shadeClose:!1,area:["800px","500px"],content:getPrefix(e)+"/editRole/"+t+"?parentname="+window.name})}function removeEntity(e,t,a,i){if(a?"TYPE"!=a&&"PJT"!=a||"DOC"!=e&&"PRQ"!=e&&"TSC"!=e&&"TSP"!=e&&!isWorkflow(e)||(a=e):a=$("#objectType").val(),"PJT"==e)var n=top.layer.confirm("项目被删除后将无法恢复，确定要删除选中的项目吗？",{btn:["下一步",$.i18n.prop("common.cancel")]},(function(){top.layer.close(n),top.layer.open({type:2,title:"确认删除信息",maxmin:!0,shadeClose:!1,area:["600px","430px"],content:"/pjt/deleteProject?ids="+t+"&parentname="+window.name})}));else n=top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){var r=getPrefix(e)+"/remove";isEntity(e)?r="/entity/removeData":isWorkflow(e)||"MYWORKFLOW"==e?(r="/workflow/removeData","MYWORKFLOW"==e&&i&&(a=i.find(".myWorkflow").attr("objectType"))):"WORKFLOWGROUP"==e?r="/workflowGroup/removeData":"WORKFLOWGROUPRLT"==e?r="/workflowGroup/removeWorkflowGroupRlt":"SCRUM_BOARD"==e?r="/board/remove":"PAGE"==e?r="/page/delPage":"PHASE"==e?r="/lifecycle/removePhase":"LIFECYCLEPHASE"==e?r="/lifecycle/removeLifecyclePhase":"PJTPHASE"==e?r="/pjt/removePjtPhase":"RSKLIB"==e&&(r="/rsk/removeRskLib"),$.ajax({url:r,type:"post",data:{ids:t,objectType:a},success:function(e){0==e.code?(reLoad(),top.layer.close(n),parent.layer.msg(e.msg)):(top.layer.close(n),parent.layer.msg(e.msg,1))}})}))}function closeOrRestartEntity(e,t,a){var i="common.close.comfirm";a&&"N"==a&&(i="common.restart.comfirm");var n=top.layer.confirm($.i18n.prop(i),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){var i="";"ENTITY"==e?i="/entity/closeOrRestartEntity":"WORKFLOW"==e?i="/workflow/closeOrRestartEntity":"DASHBOARD"==e&&(i="/dashboard/closeOrRestartDashboard"),$.ajax({url:i,type:"post",data:{ids:t,isClose:a},success:function(e){0==e.code?(reLoad(),top.layer.close(n),parent.layer.msg(e.msg)):(top.layer.close(n),parent.layer.msg(e.msg,1))}})}))}function changeUser(e,t,a){top.layer.open({type:2,title:"变更用户",maxmin:!0,shadeClose:!1,area:["800px","600px"],content:"workflow/changeUser?objectId="+t+"&objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&parentname="+window.name})}function rollBack(e,t,a){top.layer.open({type:2,title:"流程回退",maxmin:!0,shadeClose:!1,area:["800px","600px"],content:"workflow/rollBack?objectId="+t+"&objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&parentname="+window.name})}function importBill(e){e||(e=$("#objectType").val())||(e=$("#model").val()),intoIframePage("/importBill?objectType="+e+"&folderId="+$("#selectFolderId").val()+"&belongType="+$("#belongType").val()+"&belongId="+$("#belongId").val()+"&parentname="+(window.name?window.name:$("#parentName").val()))}function exportBill(e){showLoading(),e||(e=$("#objectType").val())||(e=$("#model").val());var t=$("body").data("bindData");t||(t=getNewFilterConditions());var a="<form method='post' id='exportForm' style='display:none'>";a+="\t<input name='module' value='"+e+"'>",a+="\t<input name='filterConditions' value='"+t+"'>",a+="\t<input name='name' value='"+$("#name").val()+"'>",a+="\t<input name='folderId' value='"+$("#selectFolderId").val()+"'>";var i=$("#belongType").val(),n=$("#belongId").val();i&&n&&(a+="\t<input name='objectType' value='"+$("#belongType").val()+"'>",a+="\t<input name='objectId' value='"+$("#belongId").val()+"'>"),a+="\t</form>";var r=$(a);r.attr("action","/exportBill"),$("body").append(r),r.submit(),hideLoading(500)}function linkEntity(e,t,a){var i,n,r=getCurRowId();i=getPrefix(e)+"/linkEntity/null?objectType="+a+"&preId="+r+"&parentname="+window.name,"FIELD"==e&&(n="链接公共字段"),top.layer.open({type:2,title:n,maxmin:!0,shadeClose:!1,area:["830px","630px"],content:i})}function cancelLinkEntity(e,t,a){top.layer.confirm("确定要取消链接选中的记录？",{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){$.ajax({url:getPrefix(e)+"/cancelLink",type:"post",data:{objectType:a,ids:t},success:function(e){0==e.code?(reLoad(),top.layer.closeAll(),layer.msg(e.msg)):(top.layer.closeAll(),layer.msg(e.msg,e.code))}})}))}function getPrefix(e){e||(e=$("#objectType").val());return"USER"==e||"COMPANY"==e||"MENU"==e||"ROLE"==e||"DEPT"==e?"/sys/"+e.toLowerCase():"TSK"==e?"/task":"REPORT_CHART"==e?"/report":"PLN"==e?"/plan":"RSKLIB"==e?"/rsk":"/"+e.toLowerCase()}function assignUser(e,t,a,i,n,r){top.layer.open({type:2,title:"指派",maxmin:!0,shadeClose:!1,area:["800px","600px"],content:"entity/assignUser?objectId="+t+"&objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&isOpenEntity="+n+"&isKeepTopWindow="+r+"&parentname="+window.name})}function addTsc(e,t,a,i){intoIframePage("entity/addOrEditEntity/null?objectType=TSC&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&srcObjectId="+t+"&srcObjectType=PRQ&parentname="+(i||window.name),!1,e)}function decPrq(e,t,a,i){intoIframePage("entity/addOrEditEntity/null?objectType=PRQ&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&srcObjectId="+t+"&srcObjectType=PRQ&parentname="+(i||window.name),!1,e)}function decTask(e,t,a,i){intoIframePage("/task/addOrEditTask?id=&taskType=PT&action=&projectId="+$("#belongId").val()+"&srcObjectId="+t+"&srcObjectType=PRQ&parentname="+(i||window.name),!1,e)}function doTsp(e,t,a,i){$.ajax({url:"/tsp/judgeHasMyTsc",type:"post",data:{tspId:t},success:function(e){0==e.code?excuteTsc(t,e.tscId):alert(e.msg)}})}function excuteTsc(e,t){var a=window.name;if(a){var i=top.layer.getFrameIndex(a);top.layer.close(i)}top.layer.open({type:2,title:"执行用例",maxmin:!0,shadeClose:!1,area:["1000px","600px"],content:"/tsp/excuteTsc?tspId="+e+"&tscId="+t+"&parentname="+a,end:function(e){e&&loadMyTsc(!0)}})}function getLayerParam(e,t){if(e&&t)if("V"==t?title=$.i18n.prop(e.toLowerCase()+".view"):"E"==t?(title=$.i18n.prop(e.toLowerCase()+".edit"),"PAGE"==e&&(height="500px")):"A"==t&&(title=$.i18n.prop(e.toLowerCase()+".add")),"USER"==e||"PAGE"==e||"TSK"==e||"LIFECYCLE"==e||isEntity(e)&&"PJT"!=e||"WEEKLY"==e||"MONTHLY"==e||"RSKLIB"==e||"REWPOINT"==e)width="962px",height="95%";else if("ROLE"==e){width="950px",height="95%",(a=$("#objectType").val())&&"DEPT"==a&&(height="600px")}else if("DEPT"==e)width="962px",height="90%";else if("FIELD"==e||"DATASOURCE"==e)width="830px",height="90%";else if("WORKFLOWGROUP"==e)width="830px",height="80%";else if("WORKFLOWGROUPRLT"==e)width="500px",height="400px";else if("MENU"==e||"PHASE"==e||"LIFECYCLEPHASE"==e||"OPERATE_RECORD"==e||"PJTPHASE"==e||"PLN"==e)width="830px",height="600px";else if("TYPE"==e){var a;(a=$("#objectType").val())&&"PJT"==a?(width="100%",height="100%"):(width="830px",height="600px")}else"STATUS"==e||"SCRUM_BOARD"==e||"POSITION"==e?(width="800px",height="500px"):"REPORT_CHART"==e?(width="960px",height="98%"):"REWELEMENT"==e?(width="700px",height="600px"):("INSTANCE"==e||"PJT"==e||isWorkflow(e))&&(width="100%",height="100%")}function viewUser(e,t){e||(e=t.attr("userId")),stopPropagation(),top.layer.open({type:2,title:"用户信息",maxmin:!0,shadeClose:!1,area:["800px","500px"],content:"/sys/user/view/"+e+"?isForward=Y&parentname="+window.name})}function showLoading(){var e=jQuery("#page-loader-wrapper");e.length||(e=parent.jQuery("#page-loader-wrapper")),e.length||(e=parent.parent.jQuery("#page-loader-wrapper")),e.show()}function hideLoading(e){var t=jQuery("#page-loader-wrapper");t.length||(t=parent.jQuery("#page-loader-wrapper")),t.length||(t=parent.parent.jQuery("#page-loader-wrapper")),e?setTimeout((function(){t.fadeOut()}),e):t.fadeOut()}var attLoadedPercent=0,attIncreasePercent=1,attPercentBoundary=Math.floor(10*Math.random())+75,attShowTimer,attUploadCompleted=!1;function showProgressLoading(){if($(".progress-loading").length)$(".progress-loading .r_num").text(attLoadedPercent+"%"),$(".progress-loading").show();else{'\t<div class="layui-layer-shade" id="layui-layer-shade5" times="5" style="z-index: 19891018; background-color: rgb(0, 0, 0); opacity: 0.1;"></div>','\t<div class="r_out">','\t\t<div class="r_in">','\t\t\t<div class="r_c"></div>','\t\t\t<div class="r_num">0%</div>',"\t\t</div>","\t</div>","</div>",$(document.body).append($('<div class="progress-loading">\t<div class="layui-layer-shade" id="layui-layer-shade5" times="5" style="z-index: 19891018; background-color: rgb(0, 0, 0); opacity: 0.1;"></div>\t<div class="r_out">\t\t<div class="r_in">\t\t\t<div class="r_c"></div>\t\t\t<div class="r_num">0%</div>\t\t</div>\t</div></div>'))}var e=$(".progress-loading .r_num"),t=$(".progress-loading .r_c");attShowTimer=setInterval((function(){attLoadedPercent<100?(attLoadedPercent+=attIncreasePercent=!attUploadCompleted&&attLoadedPercent>attPercentBoundary?0:1,e.text(attLoadedPercent+"%"),t.animate({height:attLoadedPercent+"%"},1)):(e.text("100%"),t.animate({height:"100%"},1),attLoadedPercent=0,clearInterval(attShowTimer),$(".progress-loading").hide(),attUploadCompleted&&parent.layer.msg("操作成功"))}),10)}function alert(e){top.layer.alert(e)}function confirm(e,t,a){hideLoading();top.layer.confirm(e,{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){t&&"function"==typeof t&&t()}),(function(){a&&"function"==typeof a&&a()}))}function enCode(e){return e?e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&#34;").replace(/\'/g,"&#39;"):""}function compareDate(e,t){return new Date(e.replace(/-/g,"/"))>new Date(t.replace(/-/g,"/"))}function strToFunction(funName,result){try{this.func=function(e){},this.func=eval(funName)}catch(e){console.log("方法名不存在")}return func}function upperFirstConcat(e){return e?e=e.substring(0,1).toUpperCase()+e.substring(1):e}function isEntity(e){if(!e)return!1;return["DOC","PRD","TSC","TSP","PRQ","PJT"].indexOf(e)>-1||"ENTITY"!=e&&"EN"==e.substring(0,2)}function isWorkflow(e){if(!e)return!1;return["BUG","MRQ","PBC","ISU","RSK","REW","CHG","REQ","MET","SPL","EQP","EQU","CRW","PDT","REV","EXP","BUD","PFC","PPM","PMI","PMC","MCM"].indexOf(e)>-1||"WF"==e.substring(0,2)}function downLoad(e,t,a){showLoading(),$.ajax({url:"/document/judgeFileIsExists",type:"post",data:{ids:t},success:function(e){if(e)hideLoading(),alert(e);else{var a=$("<form method='post' id='downloadForm' style='display:none'><input name='ids' value='"+t+"'></form>");a.attr("action","/document/download"),$(document.body).append(a),a.submit(),hideLoading()}}})}function setLifecyclePhase(e,t,a,i,n,r){top.layer.open({type:2,title:"设置生命阶段",maxmin:!0,shadeClose:!1,area:["830px","550px"],content:"/entity/setLifecyclePhase?objectId="+t+"&objectType="+e+"&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&isOpenEntity="+n+"&isKeepTopWindow="+r+"&parentname="+(i||window.name),end:function(e,t){e&&"function"==typeof reLoad&&reLoad(e,t)}})}function communication(e,t,a,i,n){"MYWORKFLOW"==e&&n&&(e=n.find(".myWorkflow").attr("objectType")),top.layer.open({type:2,title:"发送沟通消息",maxmin:!0,shadeClose:!1,area:["830px","600px"],content:"/addMessage?objectId="+t+"&objectType="+e+"&parentname="+(i||window.name)})}function transmitWorkflow(e,t,a){top.layer.open({type:2,title:"转发单据",maxmin:!0,shadeClose:!1,area:["830px","550px"],content:"/workflow/transmitWorkflow?objectId="+e+"&objectType="+t+"&parentname="+(a||window.name)})}function viewDoc(model,id,objectType,type){type||(type="1"),$.ajax({url:"/document/viewDoc",type:"post",data:{id:id,objectType:objectType,type:type},success:function(r){if(r){var isChangeHeight=!1,iframeId=window.frameElement.id,iframeHeight=0,$section,$iframe,$layer=layer;iframeId&&"J_iframe"==iframeId?($section=parent.$("section.content"),$section.addClass("iframeSign"),$iframe=parent.$("#"+iframeId),iframeHeight=$iframe.height(),$iframe.css("height",iframeHeight+50),isChangeHeight=!0):iframeId&&"custom-iframe"==iframeId&&($layer=parent.layer),r=eval("("+r+")"),$layer.open({skin:"iframeClass",type:2,title:"预览   "+r.name,maxmin:!1,shadeClose:!1,area:["100%","100%"],content:r.url+"/onlinePreview?url="+encodeURIComponent(base64encode(r.url+r.viewFile)),end:function(){isChangeHeight&&($section.removeClass("iframeSign"),$iframe.css("height",iframeHeight))}})}}})}function copy(e,t,a){top.layer.open({type:2,title:"复制模型",maxmin:!0,shadeClose:!1,area:["830px","400px"],content:"instance/copy/"+t+"?parentname="+window.name,end:function(e){e&&GridManager.refreshGrid("grid-table")}})}function stopPropagation(e){(e=e||window.event).stopPropagation?e.stopPropagation():e.cancelBubble=!0}function setCookie(e,t){if(e){var a=new Date;a.setTime(a.getTime()+864e7),document.cookie=e+"="+escape(t)+";expires="+a.toGMTString()+"; path=/"}}function getCookie(e){var t,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?unescape(t[2]):null}function getBrowser(){var e=navigator.userAgent,t=0;return e.indexOf("Chrome")>=0?t=1:e.indexOf("Firefox")>=0?t=2:e.indexOf("MSIE")>=0?t=3:e.indexOf("Opera")>=0?t=4:e.indexOf("Safari")>=0?t=5:e.indexOf("Netscape")>=0&&(t=6),t}function checkIsIE10AndUP(){return getIEVersion()>=10}function checkIsIE(){return getIEVersion()>0}function checkIsEdge(){return navigator.userAgent.toLowerCase().indexOf("edge")>-1}function getIEVersion(){var e=navigator.userAgent.toLowerCase(),t=/(msie\s|trident.*rv:)([\w.]+)/.exec(e);return null!=t&&null!=t[2]?parseInt(t[2]):0}function parentFrameTableReLoad(e){if(e&&e[0]){var t=top.frames[e[0]];"function"==typeof t.reLoad&&t.reLoad()}}function workflowMng(e,t,a,i,n){intoIframePage("workflow/baseInfo?objectType="+i,!1,t)}function disposeTransition(e,t,a){e.tranId?$.ajax({url:"/dispose/disposeTransition",type:"post",data:e,success:function(i){returnBackAndReLoad(!1,!0),0==i.code&&(i.errorInfo?alert(i.errorInfo):e.pageTo&&"2"==e.pageTo&&openEntity(e.srcObjectType,e.srcObjectId,t),parent.layer.msg(a))}}):(openEntity(e.srcObjectType,e.srcObjectId,t),parent.layer.msg(a))}function saveRelateObject(e,t,a,i){$.ajax({cache:!0,type:"POST",url:"/saveOrDelRelateObject",data:{objectId:e,objectType:t,selectIds:a,delIds:"",relateObjectType:i},async:!1,success:function(e){parent.layer.msg(e.msg)}})}function updatePassword(){top.layer.open({type:2,title:"修改密码",maxmin:!0,shadeClose:!1,area:["600px","300px"],content:"/sys/user/updatePassword?parentname="+window.name})}function setTheme(){top.layer.open({type:2,title:"主题设置",maxmin:!0,shadeClose:!1,area:["600px","300px"],content:"/sys/user/setTheme?parentname="+window.name})}function setNavigate(){top.layer.open({type:2,title:"导航栏配置",maxmin:!0,shadeClose:!1,area:["800px","500px"],content:"/advanceSet/navigateSetEdit?type=&parentname="+window.name})}function isOpenIfarme(e){var t=!1;return("TSK"==e||"RSKLIB"==e||"LIFECYCLE"==e||"TYPE"==e||"FIELD"==e||"WORKFLOWGROUP"==e||"USER"==e||"DEPT"==e||"MENU"==e||"WEEKLY"==e||"MONTHLY"==e||isEntity(e)||isWorkflow(e))&&(t=!0),t}function isOpenWindowLikeIframe(e){var t=!1;return"LIFECYCLEPHASE"!=e&&"DATASOURCE"!=e&&"PAGE"!=e&&"REPORT_CHART"!=e&&"PLN"!=e&&"ROLE"!=e&&"INSTANCE"!=e&&"REWPOINT"!=e||(t=!0),t}function isParentLayer(e){var t=!1;if("DATASOURCE"==e||"PAGE"==e||"PLN"==e||"ROLE"==e||"INSTANCE"==e||"REWPOINT"==e||"REPORT_CHART"==e){var a=$("#isCurWindow").val();a&&"Y"==a||(t=!0)}return t}function openWindowLikeIframe(e){var t,a=null,i=0;if(e.isParent&&"false"!=e.isParent){var n=window.frameElement;if(a=parent.layer,n&&n.id.startsWith("tab_")){var r=window.parent;0==$(r.document).find(".layui-layer").length&&(a=layer)}}else{a=layer,parent.$(".block-header"),(t=parent.$("section.content"))&&t.length&&t.addClass("iframeSign");var o=parent.$("#J_iframe"),l=o.height();l&&(i=47,o.height(l+i))}a.open({skin:"iframeClass",type:2,title:e.title,maxmin:!1,shadeClose:!1,area:["100%","100%"],content:e.url,end:function(e,a){if(t&&t.length&&(t.removeClass("iframeSign"),i)){var n=parent.$("#J_iframe"),r=n.height();r&&(i=47,n.height(r-i))}if(e)if("undefined"!=typeof GridManager)36==e.length?GridManager.refreshGrid("grid-table",!0):GridManager.refreshGrid(e,!0);else{iframeWindowIndex=0;var o=parent.layer.getFrameIndex(window.name);parent.layer.close(o,e)}}})}function showBtnBox(){parent.$(".btn-box").show()}function addDashboardBlock(e){var t=$("#id").val(),a="";!t&&e&&(t=e.attr("dashboardId"),a=e.attr("isForward")),top.layer.open({skin:"openClass",type:2,title:"添加区块",maxmin:!0,shadeClose:!1,area:["860px","650px"],content:"/dashboard/dashboardBlockAdd?dashboardId="+t+"&isForward="+a,end:function(e,t){e&&(a?$("#J_iframe")[0].contentWindow.reLoadDashboard():window.location.reload())}})}function undoDashboardBlock(e){var t=e.attr("dashboardId");$.ajax({cache:!0,type:"POST",url:"/dashboard/undoDashboardBlock",data:{dashboardId:t},async:!1,success:function(e){parent.layer.msg(e.msg),$("#J_iframe")[0].contentWindow.reLoadDashboard()}})}