function showNotification(t,i,e,o,s){var a="",n="";"SYS"==i?(a="系统消息",n="zmdi-notifications-add"):"TNR"==i?(a="通知提醒",n="zmdi-notifications-active"):"OTR"==i?(a="超时提醒",n="zmdi-notifications-paused"):"TM"==i?(a="转发提醒",n="zmdi-notifications-add"):"CNT"==i&&(a="沟通消息",n="fa fa-comment-dots"),null!==e&&""!==e||(e="消息内容为空！");var c='<div data-notify="container" class="bootstrap-notify-container alert alert-dismissible {0} " role="alert">';c+='\t<div class="title"><div class="icon"><i class="zmdi '+n+'"></i> '+a+'</div><button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button></div>',c+="\t<div class=\"content\" onclick=\"openNotifiy('', '"+t+"', '"+i+"','"+a+"','"+o+"','"+s+"')\">"+e+"</div>",c+="</div>",$.notify({message:e},{type:"bg-msg",allow_dismiss:true,newest_on_top:!0,timer:5e3,placement:{from:"bottom",align:"right"},animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},template:c})}function hideNoticeList(){$(".notices-list").hide(),$(".more-box").hide()}function openNotifiy(t,i,e,o,s,a){$(".more-box").hide();var n="";"SYS"==e||"CNT"==e?("SYS"==e?o="系统消息":"CNT"==e&&(o="沟通消息"),"830px","600px",n="viewMessasge?id="+i,top.layer.open({type:2,title:o,maxmin:!0,shadeClose:!1,area:["830px","600px"],content:n})):"OTR"!=e&&"TNR"!=e&&"TM"!=e||openEntity(a,s),$.ajax({url:"/openMessage",type:"post",data:{id:i},success:function(t){hideNotify(t)}}),t&&t.length&&t.attr("isread","Y")}function showNoticesList(){stopPropagation();var t=$(".notices-list");t.is(":visible")?t.hide():(t.show(),loadMessageContent(),$(".more-box, .dropdown-head-menu").hide())}function loadMessageContent(t,i){t||(t=$(".type-box .cur-type").attr("type")),i||(i=$(".status-box .cur-status").attr("status"));for(var e=$(".notices-list"),o=e.find(".notices-content"),s="",a=0;a<=5;a++)s+="<li>",s+='\t<div class="head placeRow"></div>',s+='\t<div class="content placeRow"></div>',s+="</li>";o.html(s),$.ajax({url:"/getMessageList",data:{type:t,status:i},type:"post",success:function(t){if(t&&t.length){var i="";o.html("");for(var s=0;s<t.length;s++)i+='<li id="'+t[s].id+'" isRead="'+t[s].isRead+'" onclick="openNotifiy($(this), \''+t[s].id+"', '"+t[s].type+"', '"+t[s].subject+"', '"+t[s].objectId+"', '"+t[s].objectType+"')\">",i+='\t<div class="head">',"SYS"==t[s].type?i+='\t<i class="zmdi zmdi-notifications-add icon"></i>系统消息':"TNR"==t[s].type?i+='\t<i class="zmdi zmdi-notifications-active icon"></i>通知提醒':"OTR"==t[s].type?i+='\t<i class="zmdi zmdi-notifications-paused icon"></i>超时提醒':"TM"==t[s].type?i+='\t<i class="zmdi zmdi-notifications-add icon"></i>转发提醒':"CNT"==t[s].type&&(i+='\t<i class="zmdi fa fa-comment-dots icon"></i>'+t[s].username),i+='\t\t<i class="zmdi zmdi-close" title="删除" onclick="delMessage($(this), \''+t[s].id+"')\"></i>",i+="\t</div>",i+='\t<div class="content">'+t[s].subject+"</div>",i+="</li>",s%10==0?(o.append(i),i=""):s==t.length-1&&o.append(i);e.removeClass("noData")}else e.addClass("noData")}})}function changeMessageTypeOrStatus(t,i,e){i?($(".type-box .type").removeClass("cur-type"),t.addClass("cur-type")):e&&($(".status-box .status").removeClass("cur-status"),t.addClass("cur-status")),loadMessageContent(i,e)}function delMessage(t,i){stopPropagation(),top.layer.confirm("确定要删除选中的记录？",{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){top.layer.closeAll(),t.closest("li").remove(),$.ajax({url:"/delMessage",type:"post",data:{id:i,type:""},success:function(t){hideNotify(t)}}),$(".notices-content li").length||$(".notices-list").addClass("noData").hide()}))}function showMessageBtn(t){stopPropagation();var i=t.find(".more-box");i.is(":visible")?i.hide():i.show()}function clearRead(t){stopPropagation(),top.layer.confirm("确定清空所有已读消息吗？",{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){top.layer.closeAll(),$.ajax({url:"/delMessage",type:"post",data:{id:"",type:$(".type-box .cur-type").attr("type")},success:function(t){$('.notices-content li[isread="Y"]').remove(),$(".notices-content li").length||$(".notices-list").addClass("noData")}}),$(".more-box").hide()}))}function markAsRead(t){$.ajax({url:"/markAsRead",type:"post",data:{type:$(".type-box .cur-type").attr("type")},success:function(t){$(".more-box").hide(),$(".notices-content li").attr("isread","Y"),hideNotify(t)}})}function hideNotify(t){t&&0==t.code&&0==t.messageCount&&$(".notices .notify").hide()}