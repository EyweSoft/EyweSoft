var iFilter={props:{$inputs:null,module:null,query:null,table:null,tableId:null,tableHeight:null,openState:null},init:function(t,e,i,n,l,o,a){var s=this;s.props.$inputs=t,s.props.module=e,s.props.query=i,s.props.table=n,s.props.tableId=l,s.props.openState=a,$(".clear-all").click((function(){s.clearConditions($(this))})),$("#search-btn").click((function(){$(this).closest(".dropdown-menu").hide(),$(this).closest(".btn-group").remove("open"),s.refreshTable()})),$("#con-filter").click((function(){var t=$(".fixed-table-filter");t.is(":visible")?t.hide():t.show();var e=$("#"+l).height()+1;e&&$("#"+l).closest(".table-wrap").height(e)}))},filterByMenu:function(t,e){var i=t.val();if(i&&(1==e||2==e)){if(2==e){var n=i;if((i.indexOf(">")>-1||i.indexOf("<")>-1)&&(n=i.substring(1)),isNaN(n))return void t.val("")}i.indexOf(">")>-1?t.val("<"+i.substring(1)):i.indexOf("<")>-1?t.val(i.substring(1)):t.val(">"+i),filterByField()}},getConditions:function(){return getNewFilterConditions()},clearConditions:function(){if(!$(".filter-conditions").length)return"";var t,e;$(".filter-conditions").each((function(i){t=$(this).attr("name"),"PJT"==(e=$(this).attr("htype"))||"PRD"==e||"DEPT"==e||"USER"==e?($(this).prev().val(""),$(this).val("")):"SELECT"==e||"RADIO"==e||"CHECKBOX"==e?$(this).selectpicker("val",""):"DATE"==e||"TIME"==e?($(this).selectpicker("val",""),$(this).closest(".field-content").find(".form-control-date").val("")):"TEXT"==e?$(this).val(""):"NUMBER"==e&&($("#"+t+"_start").val(""),$("#"+t+"_end").val(""))}))},_convertValue:function(t,e,i){return jworkflowDisposeBean.dynGetFilterIds(t,e,i,{callback:function(t){i=t},async:!1}),i},_getFieldModule:function(t){var e=this.props.module,i="";return"BUG"==e?"ModuleID"==t?i="Module":"DetectVerID"!=t&&"PlanVerID"!=t&&"RealVerID"!=t||(i="Build"):"MRQ"==e?"ReleaseID"==t&&(i="Release"):"REW"==e?"PointID"==t&&(i="ReviewPoint"):"PBC"==e?"AppPhaseID"==t&&(i="AppraisePhase"):"MET"==e?"RoomID"!=t&&"EquipmentID"!=t||(i="MeetingResource"):"DOC"==e?"StorageID"==t&&(i="Storage"):"PJT"==e&&"MileStoneID"==t&&(i="ProjectMileStone"),[i,"name"]},showSelect:function($obj,isCheckBox,name,param){var $s=this,$chosenDrop=$obj.nextAll(".chosen-drop"),$ul=$chosenDrop.find(".chosen-results");$ul.children().length?$chosenDrop.is(":visible")?$chosenDrop.hide():$chosenDrop.show():$.ajax({type:"POST",url:ctx+"getSelect",data:param,success:function(data){data=eval("("+data+")");for(var html="",i=0;i<data.length;i++)html+='<li val="'+data[i].id+'"><div class="checkbox"><input name="'+name+'_c" type="checkbox"><label>'+data[i].name+"</label></div></li>";$ul.html(html),$chosenDrop.is(":visible")?$chosenDrop.hide():$chosenDrop.show(),isCheckBox&&$ul.find("li").click((function(t){$checkBox=$(this).find("input[type=checkbox]"),$checkBox.is(":checked")?$checkBox.prop("checked",!1):$checkBox.prop("checked",!0),stopPropagation(t)})),$chosenAll=$chosenDrop.find(".chosen-all"),$chosenAll.click((function(t){stopPropagation(t)})),$chosenAll.find(".checkbox").click((function(t){($obj=$(this).find("input[type=checkbox]")).is(":checked")?($obj.prop("checked",!1),$("input[type=checkbox]:visible",$obj.closest(".chosen-drop").find(".chosen-results")).prop("checked",!1)):($obj.prop("checked",!0),$("input[type=checkbox]:visible",$obj.closest(".chosen-drop").find(".chosen-results")).prop("checked",!0))}))}})},selectFilter:function(t,e){var i="",n="550px";"DEPT"==e||"USER"==e?i="500px":(i="1000px",n="650px");var l=t.prev();top.layer.closeAll(),top.layer.open({type:2,title:$.i18n.prop("select."+e.toLowerCase()),maxmin:!1,shadeClose:!0,resize:!0,hideBtn:!0,btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")],area:[i,n],content:[ctx+"search?type="+e+"&selectIds="+l.val()+"&isMul=Y","no"],yes:function(i,n){var o=top.layer.getChildFrame("body",i),a="",s="";if("DEPT"==e||"USER"==e){var c=o.find(".selected-ul li");c&&c.length&&c.each((function(){a?(a+=","+$(this).attr("attrId"),s+=", "+$(this).find(".selected-name").text()):(a=$(this).attr("attrId"),s=$(this).find(".selected-name").text())}))}else if(a=o.find("#selectIds").val(),s=o.find("#selectNames").val(),a&&!s)for(var r=a.split(","),d=0;d<r.length;d++)r[d]&&(s&&(s+=", "),s+=o.find('tr[id="'+r[d]+'"]').find(".row-content").attr("title"));isOpen="N",l.val(a),t.val(s),top.layer.close(i)},btn2:function(t,e){top.layer.close(t),hideFilter()},cancel:function(t,e){top.layer.close(t)}})},searchSelect:function(t,e){if(13==e.keyCode){var i=t.val(),n=t.closest(".chosen-drop");if(i){new RegExp(i);var l=!0;n.find(".chosen-results li").each((function(){$(this).find("label").text().toUpperCase().indexOf(i.toUpperCase())<0?$(this).hide():($(this).show(),l=!1)})),l?(n.find(".no-data").show(),n.find(".chosen-all").hide()):(n.find(".no-data").hide(),n.find(".chosen-all").show())}else n.find(".chosen-results li, .chosen-all").show(),n.find(".no-data").hide()}},refreshTable:function(){var t=iFilter.props.table,e=iFilter.props.query,i=iFilter.getConditions();e.filterConditions=i,$("body").data("bindData",i),t.GM("setQuery",e)}};function selectConfirm(t){var e,i,n=t.closest(".chosen-drop");$("input[type=checkbox]:checked",n.find(".chosen-results")).each((function(){e?(e+=","+$(this).closest("li").attr("val"),i+=", "+$(this).next().text()):(e=$(this).closest("li").attr("val"),i=$(this).next().text())}));var l=n.closest(".from-basic");e?(l.find('input[attrSign="_ids"]').val(e),l.find('input[attrSign="_names"]').val(i)):(l.find('input[attrSign="_ids"]').val(""),l.find('input[attrSign="_names"]').val("")),n.hide(),iFilter.refreshTable()}function initContextMenu(t,e,i){var n;t.contextMenu({width:130,itemHeight:30,bgColor:"#F5F5F5",color:"black",fontSize:12,target:function(t){(n=$(t)).hasClass("selected")||(window.event.ctrlKey?n.hasClass("selected")?n.removeClass("selected"):n.addClass("selected"):(n.siblings().removeClass("selected"),n.addClass("selected")))},menu:[{text:$.i18n.prop("common.open"),icon:"fa fa-folder-open-o",callback:function(t){var i=$(".fixed-table-container tbody tr.selected").attr("id");openEntity(e,i)}},{text:$.i18n.prop("common.edit"),icon:"fa fa-edit",callback:function(){var t=$(".fixed-table-container tbody tr.selected").attr("id");editEntity(e,t)}},{text:$.i18n.prop("user.edit.role"),icon:"fa fa-cog",callback:function(){var t=$(".fixed-table-container tbody tr.selected").attr("id");editRole(e,t)}},{text:$.i18n.prop("common.del"),icon:"fa fa-close",callback:function(){var t="";$(".fixed-table-container tbody tr.selected").each((function(){t+=$(this).attr("id")+","})),removeEntity(t)}}]})}function getCurRowIds(){var t="";return $(".table-wrap tbody tr.selected").each((function(){t+=$(this).attr("id")+","})),t}function getCurRowId(){return $(".table-wrap tbody tr.selected").attr("id")}function saveFilter(t){var e=$(t).closest(".gm-filter-area"),i=e.find(".filter-conditions");if("SELECT"==i.attr("fieldtype")){var n="";e.find(".checkOption:visible:checked").each((function(){n?n+=","+$(this).val():n=$(this).val()})),i.val(n)}i.val()?e.addClass("filter-selected"):e.removeClass("filter-selected"),hideFilter(),iFilter.refreshTable()}function clearFilter(t){var e=$(t).closest(".gm-filter-area");e.removeClass("filter-selected"),e.find(".filter-conditions, .filter-search").val("");var i=e.find(".filter-conditions").attr("fieldtype");if("SELECT"==i){var n=e.find(".field-content-check .checkbox");n.show(),n.find(".checkOption").prop("checked",!1)}else if("DATE"==i||"TIME"==i){var l=e.find(".filter-conditions").attr("name");startTime=map.get(l+"_start"),endTime=map.get(l+"_end"),endTime.config.min="1900-1-1",startTime.config.max=endTime.config.max}hideFilter(),iFilter.refreshTable()}function openSelectDialog(t){iFilter.selectFilter(t,t.attr("htype"))}function hideFilter(){$(".filter-box").hide(),$(".layui-laydate").remove()}function createSearchConditions(headData,objectType){if(headData&&headData.length){var html="";$(".search-condition").remove(),html+='<div class="search-condition">',html+='\t<div class="seach-collapse">',html+='\t\t<div class="seach-list">',html+='\t\t\t<div class="condition btn">',html+='\t\t\t\t<button class="btn t-btn n-active ml10" onclick="searchData(\'N\');" type="button">',html+='\t\t\t\t\t<i class="fa fa-search mr5"></i>',html+='\t\t\t\t\t<span class="pt1 h18">查询</span>',html+="\t\t\t\t</button>",html+='\t\t\t\t<button class="btn t-reset-btn ml5" onclick="searchData(\'Y\');" type="button">',html+='\t\t\t\t\t<i class="fa fa-redo mr5"></i>',html+='\t\t\t\t\t<span class="pt1 h18">重置</span>',html+="\t\t\t\t</button>",html+='\t\t\t\t<button class="btn t-more-btn ml5" id="showMore" onclick="searchMore(\'Y\');" type="button">',html+='\t\t\t\t\t<i class="fa fa-angle-double-down mr5"></i>',html+='\t\t\t\t\t<span class="pt1 h18">更多</span>',html+="\t\t\t\t</button>",html+='\t\t\t\t<button class="btn t-more-btn ml5" id="hideMore" onclick="searchMore(\'N\');" type="button" style="display:none">',html+='\t\t\t\t\t<i class="fa fa-angle-double-up mr5"></i>',html+='\t\t\t\t\t<span class="pt1 h18">隐藏</span>',html+="\t\t\t\t</button>",html+="\t\t\t</div>",html+="\t\t</div>",html+='\t\t<div class="seach-list-more"></div>',html+="\t</div>",html+="</div>",$(".table-list-box").prepend(html);var info,index=1,$seachList=$(".seach-list");html="";for(var i=0;i<headData.length;i++)if(info=headData[i],"false"!=info.search){if(html+='<div class="condition">',html+='\t<div class="field-div field-label"><span class="title">'+info.text+"</span></div>",html+='\t<div class="field-div field-content '+info.type+'">',"NUMBER"==info.type)html+='\t\t<input class="form-control filter-conditions filter-search" name="'+info.key+'" valueType="start" id="'+info.key+'_start" type="'+info.type+'" htype="'+info.type+'" autocomplete="off" placeholder="请输入'+info.text+'"><span class="ml5 mr5">~</span>',html+='\t\t<input class="form-control filter-search" name="'+info.key+'" valueType="end" id="'+info.key+'_end" type="'+info.type+'" htype="'+info.type+'" autocomplete="off" placeholder="请输入'+info.text+'">';else if("TEXT"==info.type||"AREA"==info.type)html+='\t\t<input class="form-control filter-conditions filter-search" name="'+info.key+'" type="TEXT" htype="'+info.type+'" autocomplete="off" placeholder="请输入'+info.text+'">';else if("DEPT"==info.type||"PJT"==info.type||"PRD"==info.type||"USER"==info.type){var labelName="";"DEPT"==info.type?labelName+=$.i18n.prop("select.dept"):"PJT"==info.type?labelName+=$.i18n.prop("select.pjt"):"PRD"==info.type?labelName+=$.i18n.prop("select.prd"):"USER"==info.type&&(labelName+=$.i18n.prop("select.user")),html+='<input id="_'+info.key+'" name="'+info.key+'" type="hidden" value="">',html+='<input autocomplete="off" class="form-control form-control-popup filter-conditions" htype="'+info.type+'" name="'+info.key+'" placeholder="'+labelName+'" isMul readonly="readonly" type="text" value="" onclick="openSelectDialog($(this))">',html+='<i class="zmdi zmdi-search"></i>'}else if("SELECT"==info.type||"RADIO"==info.type||"CHECKBOX"==info.type)$.ajax({cache:!0,type:"POST",url:"/getSelect",data:{module:objectType,fieldName:info.key,baseId:""},async:!1,success:function(data){if(html+='<select class="selectpicker bs-select-hidden filter-conditions" data-live-search="true" data-live-search-style="begins" id="'+info.key+'" htype="'+info.type+'" multiple="true" name="'+info.key+'" title="请选择">',data){data=eval("("+data+")");for(var value="",i=0;i<data.length;i++)value=data[i].value,html+='<option data-content="'+data[i].text+'" value="'+value+'"></option>'}html+="</select>",hideLoading()}});else if("DATE"==info.type||"DATETIME"==info.type||"TIME"==info.type){var dateClass="datetimepicker"+index+"_csDate";html+='<select class="selectpicker filterSign bs-select-hidden selectDateSign filter-conditions" name="'+info.key+'" dateClass="'+dateClass+'" data-live-search="false" htype="'+info.type+'" data-live-search-style="begins" title="请选择" onchange="selectDate($(this))">',html+='\t<option class="bs-title-option" value="">请选择</option>',html+='\t<option value="CS">自定义时间</option>',html+='\t<option value="CD">今天</option>',html+='\t<option value="CW">本周</option>',html+='\t<option value="CM">本月</option>',html+='\t<option value="CQ">本季</option>',html+='\t<option value="CY">今年</option>',html+='\t<option value="LY">去年</option>',html+="</select>",html+='<input class="form-control form-control-date '+dateClass+' hide" name="csDate" value="" type="text" autocomplete="off" readonly="readonly" htype="DATE" lay-key="'+index+'">'}html+="\t</div>",html+="</div>",3==index&&($seachList.find(".condition:not(.btn)").remove(),$seachList.prepend(html),html=""),index++}1==index?$(".search-condition").remove():index<=4?($seachList.prepend(html),$("#showMore").hide()):$(".seach-list-more").html(html),index>1&&setTimeout((function(){$("select.filter-conditions").selectpicker("refresh")}),800),$(".filter-search, .filter-conditions").bind("keypress",(function(t){"13"==t.keyCode&&searchData("N")}))}}function searchMore(t){t&&"Y"==t?($(".seach-list-more").css("display","flex"),$("#showMore").hide(),$("#hideMore").show()):($(".seach-list-more").hide(),$("#showMore").show(),$("#hideMore").hide())}function initDates(t,e){laydate.render({elem:"."+t,eventElem:".layicon",trigger:"click",theme:"",type:"date",range:e,done:function(e,i){var n=jQuery("."+t);t.indexOf("_csDate")>=0&&(e?n.val(e):e="自定义时间",n.closest(".field-content").find(".filter-option").text(e))}})}function selectDate(t){if("CS"==t.val()){var e=t.attr("dateClass"),i=t.closest(".field-content").find("."+e);i.attr("isInit")||initDates(e,!0),setTimeout((function(){i.attr("isInit","Y"),i.click()}),100)}}function searchData(t){"Y"==t&&iFilter.clearConditions();var e=$("#viewType").val();if(e&&"BOARD"==e){var i=iFilter.getConditions();initTaskBoard(i)}else if(e&&"REPORT"==e){i=iFilter.getConditions();$("#filterConditions").val(i),initReport(e)}else iFilter.refreshTable();$("#hideMore").is(":visible")&&$("#hideMore").click()}function expandOrCollapse(t){var e=iFilter.props.table;if(e){var i=t.attr("openState");"undefined"!=i&&""!=i||(i=iFilter.props.openState),i=1!=i&&"true"!=i&&(0==i||"false"==i),t.attr("openState",i),GridManager.updateTreeState(e,i)}}function getNewFilterConditions(){var t="@###@",e=":",i="",n="",l=$("#oldFilterConditions").val();if(!$(".filter-conditions").length)return l||"";var o,a,s="";return $(".filter-conditions").each((function(l){s="",o=$(this).attr("name"),"PJT"==(a=$(this).attr("htype"))||"PRD"==a||"DEPT"==a||"USER"==a?(s=$(this).prev().val(),o=$(this).attr("name")):"SELECT"==a||"RADIO"==a||"CHECKBOX"==a?s=$(this).val():"DATE"==a||"TIME"==a?(s=$(this).val())&&"CS"==s&&(s=$(this).closest(".field-content").find(".form-control-date").val()):"TEXT"==a?s=$(this).val():"NUMBER"==a&&($("#"+o+"_start").val()||$("#"+o+"_end").val())&&(s=$("#"+o+"_start").val()+" - "+$("#"+o+"_end").val()),s&&"undefined"!=s&&("ext_Type"==o?n+=t+o+e+s+e+a:i+=t+o+e+s+e+a)})),l&&(i?i+="@###@"+l:i=l),n&&(n=n.substring(5,n.length),i+=t+n),i}