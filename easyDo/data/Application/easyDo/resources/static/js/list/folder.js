function loadFolderList(t,e,a,l){var s=$("#btnAdd").val(),i=$("#btnEdit").val(),n=$("#btnDel").val(),o=$("#entityName").val(),d="";d+="\t<li>",d+='\t\t<div class="tree-item">',d+='\t\t\t<div class="label-wrap">',d+='\t\t\t\t<span class="toggle-wrap"><i class="expand-icon zmdi zmdi-caret-down cp-theme"></i></span>',d+='\t\t\t\t<span class="name-wrap">',d+='\t\t\t\t\t<img class="file-icon-small" top="Y" src="/img/tree/ent.svg">',d+=o?'\t\t\t\t\t<span class="name">'+o+"库</span>":'\t\t\t\t\t<span class="name">'+$.i18n.prop(t.toLowerCase()+".folder")+"</span>",d+="\t\t\t\t</span>",s&&"Y"==s&&(d+='\t\t\t<span class="custom-operate cp-theme dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">',d+='\t\t\t\t<i class="fa fa-ellipsis-h"></i>',d+="\t\t\t</span>",d+='\t\t\t<ul class="dropdown-menu dropdown-menu-right" x-placement="bottom-end">',d+="\t\t\t\t<li onclick=\"addFolder($(this), '', '"+t+"', '"+l+'\')"><a href="javascript:void(0);"><i class="fa fa-plus eidt-list"></i><span class="text">新建文件夹</span></a></li>',d+="\t\t\t</ul>"),d+="\t\t\t</div>",d+="\t\t</div>",d+='\t\t<ul class="ml20">',d+='\t\t\t<li id="none">',d+='\t\t\t\t<div class="tree-item '+(e&&"none"==e?"active":"")+'">',d+='\t\t\t\t\t<div class="label-wrap">',d+='\t\t\t\t\t\t<span class="toggle-wrap"></span>',d+='\t\t\t\t\t\t<span class="name-wrap">',d+='\t\t\t\t\t\t\t<img class="file-icon-small" src="/img/tree/none.png">',d+='\t\t\t\t\t\t\t<span class="name">无</span>',d+="\t\t\t\t\t\t</span>",d+="\t\t\t\t\t</div>",d+="\t\t\t\t</div>",d+="\t\t\t</li>",$.ajax({url:"/folder/getFolderList",type:"post",dataType:"json",data:{model:t,type:a,objectId:l},async:!1,success:function(o){if(o&&o.children.length)for(var c,r=0;r<o.children.length;r++)c=o.children,d+='<li id="'+c[r].id+'">',d+='\t<div class="tree-item '+(e&&e==c[r].id?"active":"")+'">',d+='\t\t<div class="label-wrap">',d+='\t\t\t<span class="toggle-wrap">'+(c[r].children&&c[r].children.length?'<i class="expand-icon zmdi zmdi-caret-down cp-theme"></i>':"")+"</span>",d+='\t\t\t<span class="name-wrap">',d+='\t\t\t\t<img class="file-icon-small" src="/img/tree/folder-open.svg">',d+='\t\t\t\t<span class="name" title="'+c[r].text+'">'+c[r].text+"</span>",d+="\t\t\t</span>",(s||i||n)&&(d+='\t\t\t<span class="custom-operate cp-theme dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" >',d+='\t\t\t\t<i class="fa fa-ellipsis-h"></i>',d+="\t\t\t</span>",d+='\t\t\t<ul class="dropdown-menu dropdown-menu-right" x-placement="bottom-end">',s&&"Y"==s&&(d+="\t\t\t\t<li onclick=\"addFolder($(this), '"+c[r].id+"', '"+t+"', '"+l+'\')"><a href="javascript:void(0);"><i class="fa fa-plus eidt-list"></i><span class="text">新建文件夹</span></a></li>'),i&&"Y"==i&&(d+="\t\t\t\t<li onclick=\"renameFolder($(this), '"+c[r].id+"', '"+t+'\')"><a href="javascript:void(0);"><i class="fa fa-pencil-alt eidt-list"></i><span class="text">重命名</span></a></li>',d+="\t\t\t\t<li onclick=\"moveFolder($(this), '"+c[r].id+"', '"+t+'\')"><a href="javascript:void(0);"><i class="fa fa-random eidt-list"></i><span class="text">移动</span></a></li>'),n&&"Y"==n&&(d+="\t\t\t\t<li onclick=\"delFolder($(this), '"+c[r].id+"', '"+t+'\')"><a href="javascript:void(0);"><i class="fa fa-trash-alt eidt-list"></i><span class="text">删除</span></a></li>'),d+="\t\t\t</ul>"),d+="\t\t</div>",d+="\t</div>",c[r].children&&c[r].children.length&&(d+=loadChildren(c[r].children,"",a,e,t,l)),d+="</li>"}}),d+="\t\t</ul>",d+="\t</li>",$(".tree-list").html(d),$(".toggle-wrap").click((function(){var t=$(this).find(".expand-icon"),e=$(this).closest(".label-wrap").find(".file-icon-small"),a=$(this).closest(".tree-item");t.hasClass("close")?(t.removeClass("close"),a.next().show(200),e.attr("top")||e.attr("src","/img/tree/folder-open.svg")):(t.addClass("close"),a.next().hide(200),e.attr("top")||e.attr("src","/img/tree/folder.svg"))})),$(".name-wrap").click((function(){$(".tree-item").removeClass("active"),$(".quick-class li").removeClass("cur"),$(this).closest(".tree-item").addClass("active");var t=$(this).closest(".tree-item");t.addClass("active"),$("#selectFolderId").val(t.closest("li").attr("id")),reLoadEntityList()})),$(".custom-operate").click((function(){var t=$(this).prev();$(this).closest(".tree-item").hasClass("active")||t.click()}))}function loadChildren(t,e,a,l,s,i){var n=$("#btnAdd").val(),o=$("#btnEdit").val(),d=$("#btnDel").val();if(t){e+='<ul class="ml20">';for(var c=0;c<t.length;c++)e+='\t<li id="'+t[c].id+'">',e+='\t\t<div class="tree-item '+(l&&l==t[c].id?"active":"")+'">',e+='\t\t\t<div class="label-wrap">',e+='\t\t\t\t<span class="toggle-wrap">'+(t[c].children&&t[c].children.length?'<i class="expand-icon zmdi zmdi-caret-down cp-theme"></i>':"")+"</span>",e+='\t\t\t\t<span class="name-wrap">',e+='\t\t\t\t\t<img class="file-icon-small" src="/img/tree/folder-open.svg">',e+='\t\t\t\t\t<span class="name" title="'+t[c].text+'">'+t[c].text+"</span>",e+="\t\t\t\t</span>",(n||o||d)&&(e+='\t\t\t\t<span class="custom-operate cp-theme dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">',e+='\t\t\t\t\t<i class="fa fa-ellipsis-h"></i>',e+="\t\t\t\t</span>",e+='\t\t\t\t<ul class="dropdown-menu dropdown-menu-right" x-placement="bottom-end">',n&&"Y"==n&&(e+="\t\t\t\t\t<li onclick=\"addFolder($(this), '"+t[c].id+"', '"+s+"', '"+i+'\')"><a href="javascript:void(0);"><i class="fa fa-plus eidt-list"></i><span class="text">新建文件夹</span></a></li>'),o&&"Y"==o&&(e+="\t\t\t\t\t<li onclick=\"renameFolder($(this), '"+t[c].id+"', '"+s+'\')"><a href="javascript:void(0);"><i class="fa fa-pencil-alt eidt-list"></i><span class="text">重命名</span></a></li>',e+="\t\t\t\t\t<li onclick=\"moveFolder($(this), '"+t[c].id+"', '"+s+'\')"><a href="javascript:void(0);"><i class="fa fa-random eidt-list"></i><span class="text">移动</span></a></li>'),d&&"Y"==d&&(e+="\t\t\t\t\t<li onclick=\"delFolder($(this), '"+t[c].id+"', '"+s+'\')"><a href="javascript:void(0);"><i class="fa fa-trash-alt eidt-list"></i><span class="text">删除</span></a></li>'),e+="\t\t\t\t</ul>"),e+="\t\t\t</div>",e+="\t\t</div>",t[c].children&&t[c].children.length&&(e+=loadChildren(t[c].children,"",a,"",s,i)),e+="\t</li>";e+="</ul>"}return e}function addFolder(t,e,a,l){top.layer.open({type:2,title:"新建文件夹",maxmin:!0,shadeClose:!1,area:["560px","400px"],content:"folder/preAddFolder?preId="+e+"&objectType="+a+"&type="+$("#type").val()+"&objectId="+l+"&parentname="+window.name,end:function(t,e){t&&reLoadFolder(!1,$("#model").val())}})}function renameFolder(t,e,a){top.layer.open({type:2,title:"重命名",maxmin:!0,shadeClose:!1,area:["560px","300px"],content:"folder/preRenameFolder?id="+e+"&objectType="+a+"&parentname="+window.name,end:function(t,e){t&&reLoadFolder(!1,$("#model").val())}})}function moveFolder(t,e,a,l){a||(a=$("#objectType").val()),l||(l=!1),top.layer.open({type:2,title:"移动文件夹",maxmin:!0,shadeClose:!1,area:["560px","400px"],content:"folder/preMoveFolder?id="+e+"&objectType="+a+"&objectId="+$("#belongId").val()+"&isRemoveEntity="+l+"&parentname="+window.name,end:function(t,e){t&&reLoadFolder(!1,$("#model").val())}})}function delFolder(t,e,a){var l=top.layer.confirm("确定要删除选中的文件夹？",{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){$.ajax({url:"/folder/remove",type:"post",data:{id:e,objectType:a},success:function(t){if(0==t.code){var a=$("#selectFolderId").val();a&&a==e&&(t.id,$("#selectFolderId").val(t.id)),reLoadFolder(!1,$("#model").val()),parent.layer.close(l),layer.msg(t.msg)}else parent.layer.close(l),layer.msg(t.msg,t.code)}})}))}function changeType(t,e){$(".quick-class li").removeClass("cur"),$(".tree-list .tree-item").removeClass("active"),t.addClass("cur"),iFilter.props.query.folderId=e,iFilter.props.table.GM("setQuery",iFilter.props.query)}$.widget("ui.initFolder",{options:{model:null,type:1,selectId:null,objectId:null,objectType:null},_create:function(){$(".list-box").css("width",$(".wrapper-content").width()-230);var t=parent.$("#leftsidebar").height()-108;t<=0&&(t=parent.parent.$("#leftsidebar").height()-106);var e=$(".pjt-box");e&&e.length&&(t-=44),$(".tree-box").height(t);var a=this.options.model,l=this.options.selectId,s=this.options.type,i="";isEntity(a)&&(i+='<ul class="quick-class">',i+=' <li class="cp-theme" onclick="changeType($(this), \'myCreated\')"><span class="icon"><i class="zmdi zmdi-cloud-upload mr10"></i></span>我创建的</li>',i+=' <li class="cp-theme" onclick="changeType($(this), \'myOwned\')"><span class="icon"><i class="zmdi zmdi-account mr10"></i></span>我负责的</li>',i+=' <li class="cp-theme" onclick="changeType($(this), \'lastEdit\')"><span class="icon"><i class="zmdi zmdi-time-restore mr10"></i></span>最近编辑的</li>',i+="</ul>"),i+='<ul class="tree-list">',i+="</ul>",$("#tree-box").html(i),loadFolderList(a,l,s,this.options.objectId),$(".tree-list").height(t-140)},destroy:function(){}});