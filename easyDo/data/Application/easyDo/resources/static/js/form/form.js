function initFormList(data,isChangeType,errorMsg){var trData="",trType="even",index=0,curRow=0,totalPec=0,curPec=1,notShowDetailTabs=$("#notShowDetailTabs").val(),objectType=$("#objectType").val();if(!notShowDetailTabs||"Y"!=notShowDetailTabs){var titleHtml=getPageTitle(),subType=$("#subType").val();if((titleHtml||subType&&"ADD"!=subType&&"TSK"!=objectType)&&($(".title-ul").length||$(".layerWinPage").length||$(".layer-box").before('<ul class="title-ul"></ul>')),titleHtml){if($(".title-ul").html(titleHtml),$(".title-ul").find(".title-sign").length>0){var $layerTitle=parent.$(".layui-layer-title");if($layerTitle.length>1){var index=top.layer.getFrameIndex(window.name);$layerTitle=parent.$("#layui-layer"+index).find(".layui-layer-title"),$layerTitle.hide()}else $layerTitle.hide()}if(window.name){var index=parent.layer.getFrameIndex(window.name);if(index){var $layerIframe=parent.$("#layui-layer-iframe"+index);$layerIframe.attr("signIndex")||($layerIframe.height($layerIframe.height()+26),$layerIframe.attr("signIndex","1"))}}}}if(data)if("string"==typeof data&&(data=eval("("+data+")")),data.length){for(var html=getDetailTabs(),i=0,nameVal,simpleNameVal,codeVal,typeIdVal,lifecycleIdVal,phaseIdVal;i<data.length;i++)trData=data[i],curPec="F"==trData.l?2:1,("GROUP"==trData.ht||"SIGN"==trData.ht||totalPec+curPec>2)&&(trType="even",totalPec=0,curRow++),curRow%2==1&&"Y"==trData.ro?trType="odd":"Y"!=trData.ro&&(trType="even"),totalPec+=curPec,2==totalPec&&1==curPec?trType+=" halfRight":1==totalPec&&1==curPec&&(trType+=" halfLeft"),"TEXT"==trData.ht?html+=getTextHtml(trData,i,trType):"AREA"==trData.ht?html+=getAreaHtml(trData,i,trType):"FORMATAREA"==trData.ht?html+=getFormatareaHtml(trData,i,trType):"SELECT"==trData.ht?html+=getSelectHtml(trData,i,trType):"RADIO"==trData.ht?html+=getRadioHtml(trData,i,trType):"CHECKBOX"==trData.ht?html+=getCheckboxHtml(trData,i,trType):"NUMBER"==trData.ht?html+=getNumberHtml(trData,i,trType):"DATE"==trData.ht?html+=getDateHtml(trData,i,trType):"USER"==trData.ht?html+=getUsersHtml(trData,i,trType):"DEPT"==trData.ht?html+=getDeptHtml(trData,i,trType):"PJT"==trData.ht?html+=getProjectHtml(trData,i,trType):"PRD"==trData.ht?html+=getProductHtml(trData,i,trType):"GROUP"==trData.ht?html+=getGroupHtml(trData,i,trType):"SIGN"==trData.ht?html+=getSignHtml(trData,i,trType):"SECTION"==trData.ht&&(html+=getSectionHtml(trData,i,trType));var $pageUl=$(".page-ul");if($pageUl.find("li").length&&(isChangeType&&(nameVal=$pageUl.find('li[field="name"] input.form-control').val(),simpleNameVal=$pageUl.find('li[field="simpleName"] input.form-control').val(),codeVal=$pageUl.find('li[field="code"] input.form-control').val(),typeIdVal=$pageUl.find('li[field="typeId"] select.selectpicker').val(),lifecycleIdVal=$pageUl.find('li[field="lifecycleId"] select.selectpicker').val(),phaseIdVal=$pageUl.find('i[field="phaseId"] select.selectpicker').val()),$pageUl.find("li").remove()),objectType&&"TSK"==objectType){var isBatchAudit=$("#isBatchAudit").val();isBatchAudit&&"Y"==isBatchAudit&&(html+=getSubmitAndCloseBtnHtml())}else objectType&&"PJT"==objectType&&$(".windowPage .layout-box").addClass("PJT");$pageUl.append(html),isChangeType&&(nameVal&&$pageUl.find('li[field="name"] input.form-control').val(nameVal),simpleNameVal&&$pageUl.find('li[field="simpleName"] input.form-control').val(simpleNameVal),codeVal&&$pageUl.find('li[field="code"] input.form-control').val(codeVal),typeIdVal&&$pageUl.find('li[field="typeId"] select.selectpicker').selectpicker("refresh").selectpicker("val",typeIdVal),lifecycleIdVal&&$pageUl.find('li[field="lifecycleId"] select.selectpicker').val(lifecycleIdVal),phaseIdVal&&$pageUl.find('li[field="phaseId"] select.selectpicker').val(phaseIdVal),"function"==typeof initTypeSelect&&initTypeSelect()),hideLoading()}else $("#none").show();else errorMsg?$(".page-ul").html('<div class="none mt10" id="none">'+errorMsg+"</div>"):$(".page-ul").html('<div class="none mt10" id="none">该页面未配置，请联系管理员！</div>')}function getPageTitle(){var html="",speciData=$("#speciData").val();if(speciData){speciData=eval("("+speciData+")");var html='<li class="field-li content-whole r title-sign" htype="TEXT">';html+='\t<div class="field-div field-content spec">',html+='\t\t<div class="return-back" onclick="tabReturnBack($(this));"><i class="fa fa-reply mr5"></i><span>返回</span></div>',html+='\t\t<div class="line"></div>';var pageTitle=$("#pageTitle").val();"TSK"==speciData.objectType?(html+='\t\t<div class="field-name">'+speciData.name+"</div>",html+='\t\t<div class="cur-status sign-info" style="background-color:'+speciData.statusBg+'"><i class="'+speciData.statusIcon+'" style="color:'+speciData.statusFc+'"></i><div class="box"><div class="title" style="color:'+speciData.statusFc+'">'+speciData.statusName+"</div></div></div>",html+='\t\t<div class="cur-owner sign-info"><div class="circ"><img src="/img/user/boy.png"></div><div class="box"><div class="title">'+speciData.ownerName+'</div><div class="remark">'+speciData.ownFieldName+"</div></div></div>",html+='\t\t<div class="cur-date sign-info"><div class="circ"><i class="fa fa-calendar-check-o"></i></div><div class="box"><div class="title">'+speciData.startDate+'</div><div class="remark">'+speciData.startFieldName+"</div></div></div>",html+='\t\t<div class="cur-date sign-info"><div class="circ"><i class="fa fa-calendar-check-o"></i></div><div class="box"><div class="title">'+speciData.endDate+'</div><div class="remark">'+speciData.endFieldName+"</div></div></div>"):isEntity(speciData.objectType)?(html+='\t\t<div class="field-name">'+speciData.name+(speciData.checkOutUserId?'<span class="ml10 temp-work">( 副本 )</span>':"")+"</div>",html+="\t\t<div>",html+='\t\t\t<div class="cur-info sign-info" style="background-color:'+speciData.phaseBg+";color:"+speciData.phaseFc+'" title="当前阶段：'+speciData.phaseName+'">'+speciData.phaseName+"</div>",html+='\t\t\t<div class="cur-info sign-info" title="当前编号：'+speciData.code+'">'+speciData.code+"</div>","PJT"==speciData.objectType?speciData.copRate&&(html+='\t\t<div class="cur-info sign-info" title="完成率：'+speciData.copRate+'%">'+speciData.copRate+"%</div>"):html+='\t\t<div class="cur-info sign-info" title="当前版本：'+speciData.version+'">'+speciData.version+"</div>",html+="\t\t</div>"):isWorkflow(speciData.objectType)&&(html+='\t\t<div class="field-name">'+speciData.name+"</div>",html+="\t\t<div>",speciData.code&&(html+='\t\t\t<div class="cur-info sign-info" title="当前编号：'+speciData.code+'">'+speciData.code+"</div>"),speciData.statusName&&(html+='\t\t\t<div class="cur-info sign-info" style="background-color:'+speciData.statusBg+";color:"+speciData.statusFc+'" title="当前阶段：'+speciData.statusName+'">'+speciData.statusName+"</div>"),html+="\t\t</div>"),html+='\t<div class="clear"></div>',html+="\t</div>",html+="</li>"}else{var pageTitle=$("#pageTitle").val();if(pageTitle){var html='<li class="field-li content-whole r title-sign" htype="TEXT">';html+='\t<div class="field-div field-content spec">',html+='\t\t<div class="return-back" onclick="tabReturnBack($(this));"><i class="fa fa-reply mr5"></i><span>返回</span></div>',html+='\t\t<div class="line"></div>',html+='\t\t<div class="field-name">'+pageTitle+"</div>",html+="\t</div>",html+="</li>"}var subType=$("#subType").val();!subType||"ADD"!=subType&&"EDIT"!=subType||$(".layout-box").addClass("new")}return html}function getTextHtml(t,e,a){var i='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="TEXT">';if(t.ro&&"Y"==t.ro)i+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",i+='\t<div class="field-div field-content">'+t.v+"</div>";else{var l="请输入"+t.n;t.tp&&(l=t.tp),i+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",i+='\t<div class="field-div field-content textWrap wordSumTotal">',i+='\t\t<input class="form-control" name="'+t.cl+'" type="text" value="'+t.v+'" placeholder="'+l+'" autocomplete="off"  htype="TEXT" maxlength="'+t.tl+'" '+("Y"==t.r?"required":"")+" >",i+="\t</div>"}return i+="</li>"}function getAreaHtml(t,e,a){var i='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="AREA">';if(t.ro&&"Y"==t.ro)i+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",i+='\t<div class="field-div field-content">'+t.v+"</div>";else{var l="请输入"+t.n;t.tp&&(l=t.tp),i+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",i+='\t<div class="field-div field-content textWrap wordSumTotal">',i+='\t\t<div class="textarea-box">',i+='\t\t\t<textarea class="input_textarea" maxlength="'+t.tl+'" name="'+t.cl+'" placeholder="'+l+'" rows="'+t.ar+'" '+("Y"==t.r?"required":"")+">"+t.v+"</textarea>",i+="\t\t</div>",i+="\t</div>"}return i+="</li>"}function getFormatareaHtml(t,e,a){var i='<li class="field-li content-whole '+a+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="FORMATAREA">';return t.ro&&"Y"==t.ro?(i+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",i+='\t<div class="field-div field-content">'+t.v+"</div>"):(i+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",i+='\t<div class="field-div field-content field-content-summernote">',i+='\t\t<input type="hidden" name="'+t.cl+'" htype="FORMATAREA" value=\''+t.v+"' "+("Y"==t.r?"required":"")+"/>",i+='\t\t<div class="summernote"></div>',i+="\t</div>"),i+="</li>"}function getSelectHtml(trData,i,trType){var sv=trData.sv,sc=trData.sc,html='<li class="field-li '+trType+("F"==trData.l?" content-whole":"")+(trData.ro&&"Y"==trData.ro?" r":"")+'" field="'+trData.cl+'" htype="SELECT" '+("Y"==sc?' setCascade="Y"':"")+">";if(trData.ro&&"Y"==trData.ro)html+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+trData.n+'">'+trData.n+"</span></div>",html+='\t<div class="field-div field-content">'+trData.v+"</div>";else{var placeholder="请选择";if(trData.tp&&(placeholder=trData.tp),html+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==trData.r?"*":"")+'</span><span class="title" title="'+trData.n+'">'+trData.n+"</span>"+(trData.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+i+'" attrCalss="help-'+i+'" attrTip="'+trData.tp+'"></i></div>':"")+"</div>","Y"==sc)html+='\t<div class="field-div field-content cascade '+trData.cl+'Sign">',html+='<div class="cascader-panel-wrap">',html+='\t<div class="cascader-panel upward"></div>',html+="</div>",html+='<input type="hidden" attrsign="casCadeData" value=\''+sv+"'>",html+='<input type="hidden" attrsign="_levelValue" value="'+trData.lv+'">',html+='<input type="hidden" attrsign="_ids" name="'+trData.cl+'" data-target="'+trData.cl+'Sign" value="'+trData.v+'">',html+='<input class="form-control form-control-select" id="'+trData.cl+'" isSeached="'+trData.is+'" attrSign="_names" type="text" value="'+trData.lt+'" onclick="selectCascadeMenu(jQuery(this))" placeholder="'+placeholder+'" autocomplete="off" htype="TEXT" readonly="readonly" '+("Y"==trData.r?"required":"")+' style="padding-right: 0px;">',html+='<i class="zmdi zmdi-caret-down select"></i>';else{if(html+='\t<div class="field-div field-content '+trData.cl+'Sign">',html+='\t\t<select id="'+trData.cl+'" class="selectpicker" name="'+trData.cl+'" '+(trData.is&&"Y"==trData.is?' data-live-search="true" data-live-search-style="begins" ':"")+' title="'+placeholder+'" '+("Y"==trData.r?"required":"")+" >",html+='\t\t\t<option value="">请选择</option>',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)sv[j].checked?html+='<option value="'+sv[j].id+'" selected="'+sv[j].checked+'" data-content="'+sv[j].text+'"></option>':html+='<option value="'+sv[j].id+'" data-content="'+sv[j].text+'"></option>'}html+="\t\t</select>"}html+="\t</div>"}return html+="</li>",html}function getRadioHtml(trData,i,trType){var sv=trData.sv,html='<li class="field-li check '+trType+("F"==trData.l?" content-whole":"")+(trData.ro&&"Y"==trData.ro?" r":"")+'" field="'+trData.cl+'" htype="RADIO">';if(trData.ro&&"Y"==trData.ro)html+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+trData.n+'">'+trData.n+"</span></div>",html+='\t<div class="field-div field-content">'+(trData.v?trData.v:"")+"</div>";else{if(html+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==trData.r?"*":"")+'</span><span class="title" title="'+trData.n+'">'+trData.n+"</span>"+(trData.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+i+'" attrCalss="help-'+i+'" attrTip="'+trData.tp+'"></i></div>':"")+"</div>",html+='\t<div class="field-div field-content-check">',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)html+='<div class="radio">',html+='\t<input type="radio" name="'+trData.cl+'" id="_'+(trData.cl+j)+'" value="'+sv[j].id+'" data-target="radio" '+(sv[j].checked?' checked= "true"':"")+" "+("Y"==trData.r&&0==j?"required":"")+">",html+='\t<label for="_'+(trData.cl+j)+'">'+sv[j].text+"</label>",html+="</div>"}html+="\t</div>"}return html+="</li>",html}function getCheckboxHtml(trData,i,trType){var sv=trData.sv,html='<li class="field-li check '+trType+("F"==trData.l?" content-whole":"")+(trData.ro&&"Y"==trData.ro?" r":"")+'" field="'+trData.cl+'" htype="CHECKBOX">';if(trData.ro&&"Y"==trData.ro)html+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+trData.n+'">'+trData.n+"</span></div>",html+='\t<div class="field-div field-content">'+(trData.v?trData.v:"")+"</div>";else{if(html+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==trData.r?"*":"")+'</span><span class="title" title="'+trData.n+'">'+trData.n+"</span>"+(trData.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+i+'" attrCalss="help-'+i+'" attrTip="'+trData.tp+'"></i></div>':"")+"</div>",html+='\t<div class="field-div field-content-check">',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)html+='<div class="checkbox">',html+='\t<input type="checkbox" name="'+trData.cl+'" id="_'+(trData.cl+j)+'" value="'+sv[j].id+'" data-target="checkbox" '+(sv[j].checked?' checked= "true"':"")+" "+("Y"==trData.r&&0==j?"required":"")+">",html+='\t<label for="_'+(trData.cl+j)+'">'+sv[j].text+"</label>",html+="</div>"}html+="\t</div>"}return html+="</li>",html}function getNumberHtml(t,e,a){var i='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="NUMBER" style="'+("confirm_rate"==t.cl?"display:none":"")+'">';if(t.ro&&"Y"==t.ro)if(i+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+("P"==t.f?"%":"")+"</span></div>","I"==t.f&&t.v&&(t.green||t.red)){var l=Number(t.v),s=Number(t.green),n=Number(t.red),r="green";l<=s?r="green":l>s&&(l<=n||0==n)?r="yellow":l>n&&(r="red"),i+='\t<div class="field-div field-content"><div class="c-text mr5"><i class="zmdi zmdi-lamp fz22 mr5 '+r+'-light"></i></div></div>'}else i+='\t<div class="field-div field-content-num"><span class="numValue mr5">'+(t.v?t.v:0)+"</span>"+(t.unitName?t.unitName:"")+"</div>";else i+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+("P"==t.f?"%":"")+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",i+='\t<div class="field-div field-content-num">',"report_rate"==t.cl&&$("#curRate").val()&&!t.v?("100"==$("#curRate").val()&&(t.v=100),i+='\t\t<input type="number" name="'+t.cl+'" id="'+t.cl+'" class="num-input" value="'+t.v+'" placeholder="'+$("#curRate").val()+'" max="'+t.max+'" min="'+t.min+'" deci="'+t.deci+'" '+("Y"==t.r?"required":"")+' autocomplete="off"/>'):"confirm_rate"==t.cl?i+='\t\t<input type="number" name="'+t.cl+'" id="'+t.cl+'" class="num-input" value="'+t.v+'" placeholder="请输入确认完成率" max="'+t.max+'" min="'+t.min+'" deci="'+t.deci+'" autocomplete="off"/>':i+='\t\t<input type="number" name="'+t.cl+'" id="'+t.cl+'" class="num-input" oldValue="'+t.v+'" value="'+t.v+'" placeholder="请输入'+t.n+'" max="'+t.max+'" min="'+t.min+'" deci="'+t.deci+'" '+("Y"==t.r?"required":"")+' autocomplete="off"/>',i+='\t\t<div class="sumtips">'+(t.unitName?t.unitName:"")+"</div>","report_in_work"==t.cl&&(i+='\t\t<div class="day-hour">当日已登记工时:<span class="curHour mr5 ml5">0</span>小时</div>'),i+="\t</div>";return i+="</li>"}function getDateHtml(t,e,a){var i='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="DATE">',l="";return t.v&&(l=t.v),t.ro&&"Y"==t.ro?(i+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",i+='\t<div class="field-div field-content-date">'+l+"</div>"):(i+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",i+='\t<div class="field-div field-content">',i+='\t\t<input class="form-control form-control-date '+t.cl+'" name="'+t.cl+'" type="text" dateFormat="'+t.df+'" value="'+l+'" placeholder="请选择'+t.n+'" placeholder=" " autocomplete="off" readonly="readonly" htype="DATE" '+("Y"==t.r?"required":"")+" >",i+='\t\t<i class="zmdi zmdi-calendar"></i>',i+="\t</div>"),i+="</li>"}function getUsersHtml(trData,i,trType){var sv=trData.sv;appendHide(trData.cl+"_role",trData.fr);var html='<li class="field-li '+trType+("F"==trData.l?" content-whole":"")+(trData.ro&&"Y"==trData.ro?" r":"")+'" field="'+trData.cl+'" htype="USER">';if(trData.ro&&"Y"==trData.ro){if(html+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+trData.n+'">'+trData.n+"</span></div>",html+='\t<div class="field-div field-content user">',html+='\t\t<div class="user-list">',html+='\t\t\t<input type="hidden" name="'+trData.cl+'" value="'+trData.v+'" hType="USER" />',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)html+='<div class="cp" userId="'+sv[j].id+'" title="'+sv[j].name+'" onclick="viewUser(\''+sv[j].id+"')\">",html+='\t<i class="fa fa-minus-circle del" onclick="removeUser($(this))"></i>',html+='\t<div class="user-col">',html+='\t\t<img src="'+sv[j].img+'"/>',html+="\t\t<span>"+sv[j].name+"</span>",html+="\t</div>",html+="</div>"}html+="\t\t</div>",html+="\t</div>"}else{if(html+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==trData.r?"*":"")+'</span><span class="title" title="'+trData.n+'">'+trData.n+"</span>"+(trData.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+i+'" attrCalss="help-'+i+'" attrTip="'+trData.tp+'"></i></div>':"")+"</div>",html+='\t<div class="field-div field-content user">',html+='\t\t<div class="user-list">',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)html+='<div class="cp" userId="'+sv[j].id+'" title="'+sv[j].name+'" onclick="viewUser(\''+sv[j].id+"')\">",html+='\t<i class="fa fa-minus-circle del" onclick="removeUser($(this))"></i>',html+='\t<div class="user-col">',html+='\t\t<img src="'+sv[j].img+'"/>',html+="\t\t<span>"+sv[j].name+"</span>",html+="\t</div>",html+="</div>"}html+="\t\t</div>",html+='\t\t<div class="user-add">',html+='\t\t\t<input attrsign="_ids" name="'+trData.cl+'" type="hidden" value="'+trData.v+'" hType="USER" data-target="user-add" '+("Y"==trData.r?"required":"")+" >",html+='\t\t\t<div class="cp form-control-popup" htype="USER" '+(trData.im&&"Y"==trData.im?" ismul":"")+' ><img src="/img/user/user-add.png"/></div>',html+='\t\t\t<div class="cp" onclick="preRemoveUser($(this))"><img src="/img/user/user-del.png"/></div>',html+="\t\t</div>",html+="\t</div>"}return html+="</li>",html}function getDeptHtml(t,e,a){var i=t.vn,l=t.vv,s="",n='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="DEPT">';if(t.ro&&"Y"==t.ro)i&&(s=i),n+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",n+='\t<div class="field-div field-content">'+s+"</div>";else{l&&(s=l),s||(s=i);var r="请选择"+t.n;t.tp&&(r=t.tp),n+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",n+='\t<div class="field-div field-content">',n+='\t\t<input type="hidden" id="_'+t.cl+'" name="'+t.cl+'" value="'+t.v+'" '+("Y"==t.r?"required":"")+" >",n+='\t\t<input class="form-control form-control-popup" id="'+t.cl+'Name" type="text" value="'+s+'" placeholder="'+r+'" autocomplete="off" readonly="readonly" htype="DEPT" '+("Y"==t.r?"required":"")+" >",n+='\t\t<i class="zmdi zmdi-search"></i>',n+="\t</div>"}return n+="</li>"}function getProjectHtml(t,e,a){var i=t.vn,l=t.vv;i||(i=""),l||(l=i||"");var s='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="PJT">';if(t.ro&&"Y"==t.ro)s+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",s+='\t<div class="field-div field-content">'+i+"</div>";else{var n="请选择"+t.n;t.tp&&(n=t.tp),s+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",s+='\t<div class="field-div field-content">',s+='\t\t<input type="hidden" id="_'+t.cl+'" name="'+t.cl+'" value="'+t.v+'"'+("Y"==t.r?"required":"")+" >",s+='\t\t<input class="form-control form-control-popup" name="'+t.cl+'Name" type="text" value="'+l+'" placeholder="'+n+'" autocomplete="off" readonly="readonly" htype="PJT" '+("Y"==t.r?"required":"")+" >",s+='\t\t<i class="zmdi zmdi-search"></i>',s+="\t</div>"}return s+="</li>"}function getProductHtml(t,e,a){var i=t.vn;i||(i="");var l='<li class="field-li '+a+("F"==t.l?" content-whole":"")+(t.ro&&"Y"==t.ro?" r":"")+'" field="'+t.cl+'" htype="PRD">';if(t.ro&&"Y"==t.ro)l+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+t.n+'">'+t.n+"</span></div>",l+='\t<div class="field-div field-content">'+i+"</div>";else{var s="请选择"+t.n;t.tp&&(s=t.tp),l+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==t.r?"*":"")+'</span><span class="title" title="'+t.n+'">'+t.n+"</span>"+(t.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+e+'" attrCalss="help-'+e+'" attrTip="'+t.tp+'"></i></div>':"")+"</div>",l+='\t<div class="field-div field-content">',l+='\t\t<input type="hidden" id="_'+t.cl+'" name="'+t.cl+'" value="'+t.v+'"'+("Y"==t.r?"required":"")+" >",l+='\t\t<input class="form-control form-control-popup" name="'+t.cl+'Name" type="text" value="'+i+'" placeholder="'+s+'" placeholder=" " autocomplete="off" readonly="readonly" htype="PRD" '+("Y"==t.r?"required":"")+" >",l+='\t\t<i class="zmdi zmdi-search"></i>',l+="\t</div>"}return l+="</li>"}function getGroupHtml(t,e){var a="";if("detail_sign"==t.cl){if("TSK"==$("#objectType").val()){var i=$("#isAllowSubmit").val();i&&"Y"==i?a+=getSubmitAndCloseBtnHtml():$(".layout-box").addClass("noSubmitTask"),a+='<li class="field-li content-whole detail-sign" field="detailTabs" htype="SIGN">',a+='\t<div class="relevant-tabs">',a+=getTabHtml(),a+="\t</div>",a+="</li>"}}else t.s&&"Y"==t.s&&(t.bg||(t.bg="var(--theme)"),a+='<li class="field-li content-whole sign" field="'+t.cl+'" htype="SIGN">',t.f&&"JJ"!=t.f?"ZT"==t.f?(a+='\t<div class="field-div field-sign-title2" th:style="border-bottom:1px solid '+t.bg+'">',a+='\t\t<div class="title-box" th:style="background-color:'+t.bg+'">',a+='\t\t\t<div class="title show-name" th:style="color:'+t.fc+'">'+t.t+"</div>",a+='\t\t\t<div class="square"></div>',a+="\t\t</div>",a+="\t</div>"):"CT"==t.f&&(a+='\t<div class="field-div field-sign-title1 show-name" th:style="border-left:10px solid '+t.bg+'" >'+t.t+"</div>"):(a+='\t<div class="field-div field-sign-title3" style="color:'+t.bg+";border-bottom:1px solid "+t.bg+'">',a+='\t\t<i class="zmdi zmdi-hdr-strong mr10"></i>',a+='\t\t<div class="title show-name">'+t.t+"</div>",a+="\t</div>"),a+='\t<div class="field-div field-sign-content"></div>',a+="</li>");return a}function getSubmitAndCloseBtnHtml(){return'<li class="field-li content-whole" htype="btn">','\t<div class="layui-layer-btn">','\t\t<input type="submit" class="layui-layer-btn0 btns cp" value="确定"/>','\t\t<a class="btns cp ml5" onclick="tabReturnBack($(this))">取消</a>',"\t</div>","</li>",'<li class="field-li content-whole" htype="btn">\t<div class="layui-layer-btn">\t\t<input type="submit" class="layui-layer-btn0 btns cp" value="确定"/>\t\t<a class="btns cp ml5" onclick="tabReturnBack($(this))">取消</a>\t</div></li>'}function getDetailTabs(){var t=$("#objectType").val(),e=$("#notShowDetailTabs").val(),a=$("#id").val();if(a?"null"==a&&(a=$("#objectId").val()):a=$("#objectId").val(),e||$(".page-ul").addClass("showDetailTabs"),e&&"Y"==e)return"";if(!a){var i=$("#subType").val();if(!i||"ADD"==i)return""}var l="",s="";if("TSK"!=t){if(l='<li class="field-li content-whole detail-sign" field="detailTabs" htype="SIGN">',l+='\t<div class="relevant-tabs">',isEntity(t)){if(l+=getTabHtml(),s+='<div class="detail-content">',"PRQ"==t||"TSC"==t?(s+='\t\t<div class="content trackContent">',a&&(s+='\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="trackRelate();">',s+='\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t<span class="pt1 h18">关联跟踪对象</span>',s+="\t\t</button>"),s+='\t\t\t<div id="track-table" style="display:none;"></div>',s+='\t\t\t<div class="none" id="track-none">暂无跟踪对象</div>',s+="\t\t</div>","TSC"==t&&(s+='\t\t<div class="content testRecordContent">',s+='\t\t\t<div id="testRecord-table" style="display:none;"></div>',s+='\t\t\t<div class="none" id="testRecord-none">暂无测试记录</div>',s+="\t\t</div>")):"TSP"==t&&(s+='\t\t<div class="content relateTscContent">',a&&(s+='\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="tscRelate();">',s+='\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t<span class="pt1 h18">关联用例</span>',s+="\t\t</button>"),s+='\t\t\t<div id="relateTsc-table" style="display:none;"></div>',s+='\t\t\t<div class="none" id="relateTsc-none">暂无测试用例</div>',s+="\t\t</div>",s+='\t\t<div class="content myTscContent">',s+='\t\t\t<div id="myTsc-table" style="display:none;"></div>',s+='\t\t\t<div class="none" id="myTsc-none">暂无测试</div>',s+="\t\t</div>",s+='\t\t<div class="content testReportContent">',s+='\t\t\t<div id="allTestReport-table" style="display:none;"></div>',s+='\t\t\t<div id="levelTestReport-table" class="mt20" style="display:none;"></div>',s+='\t\t\t<div id="testerTestReport-table" class="mt20" style="display:none;"></div>',s+='\t\t\t<div class="none" id="testReport-none">暂无报告</div>',s+="\t\t</div>"),s+='\t\t<div class="content relateContent">',a){var n=$("#relateLINKOBJECT").val();("PJT"==t&&n||"PJT"!=t)&&(s+='\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="relateObject();">',s+='\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t<span class="pt1 h18">关联对象</span>',s+="\t\t</button>")}if(s+='\t\t\t<table grid-manager="demoOne" id="relate-table" style="display:none;"></table>',s+='\t\t\t<div class="none" id="relate-none">暂无关联项</div>',s+="\t\t</div>",s+='\t\t<div class="content historyVersionContent">',s+='\t\t\t<table grid-manager="demoOne" id="historyVersion-table" style="display:none;"></table>',s+='\t\t\t<div class="none" id="historyVersion-none">暂无历史版本</div>',s+="\t\t</div>",s+='\t\t<div class="content fileContent">',a){var r=$("#fileADDFILE").val();("PJT"==t&&r||"PJT"!=t)&&(s+='\t\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="addAttachment();">',s+='\t\t\t\t<i class="fa fa-plus mr5"></i>',s+='\t\t\t\t<span class="pt1 h18">新建附件</span>',s+="\t\t\t</button>");var d=$("#fileLINKDOC").val();("PJT"==t&&d||"PJT"!=t)&&(s+='\t\t\t<button type="button" class="btn t-btn n-active add mb10 ml3" onclick="linkDoc();">',s+='\t\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t\t<span class="pt1 h18">链接文档</span>',s+="\t\t\t</button>")}s+='\t\t\t<table grid-manager="demoOne" id="file-table" style="display:none;"></table>',s+='\t\t\t<div class="none" id="file-none">暂无附件</div>',s+="\t\t</div>",s+='\t\t<div class="content customContent"><iframe class="custom-iframe" id="custom-iframe" width="100%" height="'+(c=$(".layer-body").height()-89)+'" signHeight="'+c+'"></iframe></div>',s+="</div>"}else if(isWorkflow(t)){l+=getTabHtml(),s+='<div class="detail-content" >',s+='\t\t<div class="content workflowChartContent"><div class="none">暂无流转图</div></div>',s+='\t\t<div class="content workflowProcessContent"><div class="none">暂无流转明细</div></div>',s+='\t\t<div class="content relateContent">';var o=$("#canUpdateRelate").val();!a||o&&"Y"!=o||(s+='\t\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="relateObject();">',s+='\t\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t\t<span class="pt1 h18">关联对象</span>',s+="\t\t\t</button>"),s+='\t\t\t<table grid-manager="demoOne" id="relate-table" style="display:none;"></table>',s+='\t\t\t<div class="none" id="relate-none">暂无关联项</div>',s+="\t\t</div>",s+='\t\t<div class="content fileContent">';var c,p=$("#canUpdateFile").val();!a||p&&"Y"!=p||(s+='\t\t\t<button type="button" class="btn t-btn n-active add mb10" onclick="addAttachment();">',s+='\t\t\t\t<i class="fa fa-plus mr5"></i>',s+='\t\t\t\t<span class="pt1 h18">新建附件</span>',s+="\t\t\t</button>",s+='\t\t\t<button type="button" class="btn t-btn n-active add mb10 ml3" onclick="linkDoc();">',s+='\t\t\t\t<i class="fa fa-link mr5"></i>',s+='\t\t\t\t<span class="pt1 h18">链接文档</span>',s+="\t\t\t</button>"),s+='\t\t\t<table grid-manager="demoOne" id="file-table" style="display:none;"></table>',s+='\t\t\t<div class="none" id="file-none">暂无附件</div>',s+="\t\t</div>",s+='\t\t<div class="content customContent"><iframe class="custom-iframe" id="custom-iframe" width="100%" height="'+(c=$(".layer-body").height()-110)+'" signHeight="'+c+'"></iframe></div>',s+="</div>"}l+="\t</div>",l+="</li>"}return $(".page-ul").after(s),$(".layout-right").html(getOtherTabs()),l}function getTabHtml(){var html="",tabs=$("#tabs").val();if(tabs){var tabId,tabName,tabUrl,tabCls;tabs=eval("("+tabs+")");for(var i=0;i<tabs.length;i++)tabId=tabs[i].id,tabName=tabs[i].name,tabUrl=tabs[i].url,tabCls=tabs[i].cls,html+=0==i?'<div class="tab active '+tabId+'-tab" type="'+tabId+'" tabUrl="'+tabUrl+'" tabCls="'+tabCls+'">'+tabName+"</div>":"file"==tabId||"childTask"==tabId?'<div class="tab" type="'+tabId+'" tabUrl="'+tabUrl+'" tabCls="'+tabCls+'">'+tabName+'&nbsp;(<span class="count" id="'+tabId+'-count">0</span>)</div>':'<div class="tab '+tabId+'-tab" type="'+tabId+'" tabUrl="'+tabUrl+'" tabCls="'+tabCls+'">'+tabName+"</div>"}return html}function getOtherTabs(){var t=$("#notShowOtherTabs").val();if(t&&"Y"==t)return'<div class="mb20"></div>';var e=$("#id").val();e?"null"==e&&(e=$("#objectId").val()):e=$("#objectId").val();var a=$("#objectType").val(),i='<div class="other-tabs">';return i+=' <div class="tabs-box">',i+='\t<div class="tab active" type="comment">评论&nbsp;(<span class="count" id="comment-count">0</span>)</div>',a&&"PJT"==a||(i+='\t<div class="tab" type="operate">操作日志&nbsp;(<span class="count" id="operate-count">0</span>)</div>'),i+=" </div>",i+="</div>",i+='<div class="other-content">',i+='\t<div class="content comment-content">',i+='\t\t<div class="comment-box commentAll" id="comment-box">',i+='\t\t\t<div class="reviewArea clearfix">',e&&(i+='\t\t\t\t<div class="textWrap wordSumTotal">',i+='\t\t\t\t\t<div class="textarea-box">',i+='\t\t\t\t\t\t<textarea rows="3" class="input_textarea" maxlength="200" placeholder="请输入评论内容"></textarea>',i+="\t\t\t\t\t</div>",i+="\t\t\t\t</div>",i+='\t\t\t\t<button type="button" class="btn t-btn n-active mt10 mb10 fr" onclick="addComment($(this));" >',i+='\t\t\t\t\t<i class="fa fa-comment-edit mr5"></i>',i+='\t\t\t\t\t<span class="pt1 h18">评论</span>',i+="\t\t\t\t</button>"),i+="\t\t\t</div>",i+='\t\t\t<div class="comment-show" id="comment-content"></div>',i+="\t\t</div>",i+='\t\t<div class="none" id="comment-none">暂无评论</div>',i+="\t</div>",i+='\t<div class="content operate-content">',i+='\t\t<div class="operate-show" id="operate-content"></div>',i+='\t\t<div class="none" id="operate-none">暂无操作日志</div>',i+="\t</div>",i+="</div>"}function getSignHtml(t,e){t.bg||(t.bg="var(--theme)");var a='<li class="field-li content-whole sign" field="'+t.cl+'" htype="SIGN">';return t.f&&"JJ"!=t.f?"ZT"==t.f?(a+='\t<div class="field-div field-sign-title2 mt10" style="border-bottom:1px solid '+t.bg+'">',a+='\t\t<div class="title-box" style="background-color:'+t.bg+'">',a+='\t\t\t<div class="title show-name" style="color:'+t.fc+'">'+t.t+"</div>",a+='\t\t\t<div class="square"></div>',a+="\t\t</div>",a+="\t</div>"):"CT"==t.f?a+='\t<div class="field-div field-sign-title1 show-name mt10" style="border-left:10px solid '+t.bg+'" >'+t.t+"</div>":"BZ"==t.f?(a+='\t<div class="field-div field-sign-title4 remark-content mt10" style="background-color:'+("var(--theme)"==t.bg?"#fff":t.bg)+";color:"+("var(--font-color)"==t.fc?"#555":t.fc)+'">',a+='\t\t<div class="tip-title mb10" style="color:'+("var(--font-color)"==t.fc?"#555":t.fc)+'" ><i class="fa fa-info-circle mr10 fz20"></i><span class="fz16 show-name">'+t.t+"</span></div>",a+='\t\t<div class="tip-content">'+t.tp+"</div>",a+="\t</div>"):"ZDY"==t.f&&(a+='\t<div class="field-div field-sign-title3" style="color:'+t.bg+";border-bottom:1px solid "+t.bg+'">',a+='\t\t<i class="zmdi zmdi-hdr-strong mr10"></i>',a+='\t\t<div class="title show-name"><span class="requireSign">'+("Y"==t.r?"*":"")+"</span>"+t.t+"</div>",a+="\t</div>",a+='\t<div class="field-div field-sign-content mt10">'+t.v+"</div>"):(a+='\t<div class="field-div field-sign-title3" style="color:'+t.bg+";border-bottom:1px solid "+t.bg+'">',a+='\t\t<i class="zmdi zmdi-hdr-strong mr10"></i>',a+='\t\t<div class="title show-name">'+t.t+"</div>",a+="\t</div>"),a+="</li>"}function getSectionHtml(trData,i,trType){var v=$("#_milestoneId").val(),sv=trData.sv;v||(v="");var html='<li class="field-li '+trType+("F"==trData.l?" content-whole":"")+(trData.ro&&"Y"==trData.ro?" r":"")+'" field="'+trData.cl+'" htype="PRD">';if(trData.ro&&"Y"==trData.ro)html+='\t<div class="field-div field-label"><span class="requireSign"></span><span class="title" title="'+trData.n+'">'+trData.n+"</span></div>",html+='\t<div class="field-div field-content">'+(v&&"Y"!=v?v:"")+"</div>";else{var isTemplate=$("#isTemplate").val();if(html+='\t<div class="field-div field-label"><span class="requireSign">'+("Y"==trData.r?"*":"")+'</span><span class="title" title="'+trData.n+'">'+trData.n+"</span>"+(trData.tp?'<div class="field-div field-help"><i class="zmdi zmdi-info help-'+i+'" attrCalss="help-'+i+'" attrTip="'+trData.tp+'"></i></div>':"")+"</div>",html+='\t<div class="field-div field-content milestone">',html+='\t\t<input type="checkbox" id="_'+trData.cl+'Check" name="'+trData.cl+'Check" value="'+(v?"Y":"")+'" class="lcs_check lcs_tt1" '+(v?" checked":"")+"/>",isTemplate&&"Y"==isTemplate)html+='\t\t<input class="form-control milestoneId '+(v?"":"hide")+'" name="'+trData.cl+'" type="text" value="'+(v&&"Y"!=v?v:"")+'" placeholder="请输入'+trData.n+'" autocomplete="off" htype="text" '+("Y"==trData.r?"required":"")+" >";else{if(html+='\t\t<select id="'+trData.n+'" class="selectpicker milestoneId '+(v?"":"hide")+'" name="'+trData.cl+'" '+(trData.is&&"Y"==trData.is?' data-live-search="true" data-live-search-style="begins" ':"")+' title="请选择" '+("Y"==trData.r?"required":"")+" >",html+='\t\t\t<option value="">请选择</option>',sv){sv=eval("("+sv+")");for(var j=0;j<sv.length;j++)sv[j].checked?html+='<option value="'+sv[j].id+'" selected="'+sv[j].checked+'" data-content="'+sv[j].text+'"></option>':html+='<option value="'+sv[j].id+'" data-content="'+sv[j].text+'"></option>'}html+="\t\t</select>"}html+="\t</div>"}return html+="</li>",html}function appendHide(t,e){0==$("#"+t).size()&&$("#hideParam").append("<input type='hidden' id='"+t+"' name='"+t+"' value='"+e+"'>")}function initFormControl(t){if($(".wordSumTotal").textSum(),$(".form-control-popup").off("click").click((function(t){selectPopup($(this),$(this).attr("htype"),$(this).hasProp("isMul"))})),$(".form-control-date").each((function(t){var e=$(this).closest(".include-icon").hasClass("singer"),a="datetimepicker_"+t,i="date",l=$(this).attr("dateformat");if(l){getThemeColor();"YMD"==l?i="date":"YMDHm"==l||"YMDHms"==l?i="datetime":"YM"==l?i="month":"Y"==l?i="year":"YMDscope"==l?(i="date",e=!0):"YMDHmsscope"==l&&(i="datetime",e=!0)}$(this).addClass(a),$(this).hasClass("planStartDate")||$(this).hasClass("planEndDate")||$(this).hasClass("report_action_date")||initDate(a,i,e)})),$(".field-label .zmdi-info").hover((function(){$(this).attr("attrTip")&&layer.tips($(this).attr("attrTip"),"."+$(this).attr("attrCalss"),{tips:[1,"#f8ac59"]})}),(function(){layer.closeAll()})),$(".field-content-num .num-icon").click((function(){var t;$(this).find(".zmdi-minus").length?((t=$(this).next(".num-input")).val((t.val()?Number(t.val()):0)-1),t.change()):((t=$(this).prev(".num-input")).val((t.val()?Number(t.val()):0)+1),t.change())})),$('li[htype="NUMBER"] .num-input').on("change",(function(){$obj=$(this),limitNumber($obj,$obj.attr("deci"),$obj.attr("min"),$obj.attr("max"))})),$(".lcs_check").each((function(){$(this).lc_switch($(this).attr("on_text"),$(this).attr("off_text"))})),$("body").delegate(".lcs_check","lcs-statuschange",(function(){$(this).is(":checked")})),$("body").delegate(".lcs_check","lcs-on",(function(){"function"==typeof switchOnOrOff&&switchOnOrOff($(this),"ON")})),$("body").delegate(".lcs_check","lcs-off",(function(){"function"==typeof switchOnOrOff&&switchOnOrOff($(this),"OFF")})),$("body").click((function(){$(".field-content.cascade").removeClass("is-focus"),$(".cascader-panel-wrap").hide()})),$(".field-content.cascade .form-control-select, .cascader-panel-wrap").click((function(t){$(".bootstrap-select.open").removeClass("open"),stopPropagation(t)})),"USER"==t||"MAIL"==t)$('li[field$="assword"]').find(".zmdi").click((function(){$(this).hasClass("zmdi-eye-off")?($(this).removeClass("zmdi-eye-off"),$(this).addClass("zmdi-eye"),$(this).prev("input").attr("type","text")):($(this).removeClass("zmdi-eye"),$(this).addClass("zmdi-eye-off"),$(this).prev("input").attr("type","password"))}));else if("TSK"==t){var e=laydate.render({elem:".planStartDate",type:"date",done:function(t,e){a.config.min={year:e.year,month:e.month-1,date:e.date,hours:e.hours,minutes:e.minutes,seconds:e.seconds},"function"==typeof changeDate&&changeDate($(".planStartDate"),t)},change:function(t,e,a){}}),a=laydate.render({elem:".planEndDate",type:"date",done:function(t,a){e.config.max={year:a.year,month:a.month-1,date:a.date,hours:a.hours,minutes:a.minutes,seconds:a.seconds},"function"==typeof changeDate&&changeDate($(".planEndDate"),t)},change:function(t,e,a){}});$("#planWorkload").val()||resetWorkdayByDate($(".planStartDate").val(),$(".planEndDate").val());var i=new Date,l=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();laydate.render({elem:".report_action_date",type:"date",max:l,done:function(t,e){"function"==typeof changeDate&&changeDate($(".report_action_date"),t)}})}var s=0;$(".relevant-tabs:not(.tabSign) .tab").click((function(){$(".relevant-tabs .tab").removeClass("active"),$(this).addClass("active");var t=$(this).attr("type"),e=$(this).attr("tabUrl"),a=$(this).attr("tabCls"),i=$(this).closest(".detail-sign"),l=($(".page-ul"),$("#objectType").val()),n=$("#objectId").val();n||(n=$("#id").val());var r=$(".layer-box");if(r.removeClass("pr0"),t)if(0==s&&(s=r.height()),isWorkflow(l)&&("workflowChart"==t?$(".layout-box").addClass("workflowChart"):$(".layout-box").removeClass("workflowChart")),$(".detail-content .content, .formBtn").hide(),$(".other-tabs,.other-content").show(),"detail"==t)i.nextAll().show(),r.css("overflow","auto"),$(".customContent").hide(),$(".btn-box, .formBtn").show(),$(".layout-left").removeClass("signPb0 pjtOtherInfo");else if("plan"==t||"milestone"==t||"roleAndUser"==t||"doc"==t||"demand"==t||"test"==t||"workflow"==t||"dashboard"==t||"dynamics"==t||isWorkflow(t)){$(".layout-left").addClass("signPb0 pjtOtherInfo"),$(".other-tabs, .other-content, .btn-box").hide(),$(".page-ul .detail-sign").nextAll().hide(),(p=$(".detail-content")).find(".customContent").show(),r.scrollTop(0).css("overflow","hidden"),"milestone"!=t&&"dashboard"!=t&&"dynamics"!=t||r.addClass("pr0");var d="",o="";if("plan"==t)showLoading(),d="/plan/planTaskList?planId=&projectId="+n;else if("milestone"==t)showLoading(),d="/type/mileTypeList?objectId="+n+"&objectType="+l+"&isView=N";else if("roleAndUser"==t)o="nt",$(".detail-content").addClass("nt"),d="/type/roleList?objectId="+n+"&objectType="+l+"&isView=N";else if("doc"==t||"demand"==t||"test"==t){o="nt";var c="";"doc"==t?c="DOC":"demand"==t?c="PRQ":"test"==t&&(c="TSC"),d="/type/typeEntityList?objectId="+n+"&objectType="+l+"&module="+c+"&isView=N"}else"workflow"==t?(o="nt",d="/workflow/myWorkflow?objectId="+n+"&objectType="+l):"dashboard"==t?d="/report/pjtOverviewChart?objectId="+n+"&objectType="+l:"dynamics"==t?(showLoading(),d="/pjt/pjtDynamicsList?objectId="+n+"&objectType="+l):isWorkflow(t)&&(o="nt",d="/workflow/myWorkflowList?objectType="+t+"&belongId="+n+"&belongType="+l);d+="&parentname="+window.name,changeMarginTopAndIframeHeight(o,p),$(".customContent").show(),replaceCustomIframeUrl(d)}else{$(".layout-left").addClass("signPb0");var p=$(".detail-content");i.nextAll().hide(),36==t.length?(p.find(".customContent").show(),showLoading(),$.ajax({url:"/page/getTabContent",type:"post",data:{tabUrl:e,tabCls:a,objectType:l,objectId:n},async:!1,success:function(t){if(t){var i=$("#custom-iframe");a?(i.attr("src",""),setTimeout((function(){var e=i.contents().get(0);$(e).find("body").html(t),hideLoading()}),200)):e&&(i.attr("src",t),hideLoading())}}})):(p.find("."+t+"Content").show(),p.find("."+t+"Content .none").show());var v=strToFunction("load"+upperFirstConcat(t));v&&"function"==typeof v&&v(),changeMarginTopAndIframeHeight(o,p)}})),$(".other-tabs .tab").click((function(){$(".other-tabs .tab").removeClass("active"),$(this).addClass("active");var t=$(this).attr("type");t&&($(".other-content .content").hide(),$(".other-content").find("."+t+"-content").show(),$("#"+t+"-count").text()||$(".other-content").find("."+t+"-content .none").show(),"operate"==t&&"function"==typeof loadOperateRecord&&loadOperateRecord())})),"function"==typeof loadComment&&loadComment(),"function"==typeof loadTabTrCount&&loadTabTrCount(),"function"==typeof loadSummernote&&loadSummernote(),$(".close-btn").click((function(){var t=top.layer.getFrameIndex(window.name);top.layer.close(t)})),changeLayerBodyHeight(),$(".btn-box").removeClass("hide"),hideLoading()}function initDate(t,e,a){laydate.render({elem:"."+t,eventElem:".layicon",trigger:"click",type:e||"date",theme:"",range:a||!1,done:function(e,a){"function"==typeof changeDate&&changeDate($("."+t),e)},change:function(e,a,i){$("."+t).val(e)}})}function replaceCustomIframeUrl(t){$(".layout-left").scrollTop(0),$("#custom-iframe").attr("src",t)}function changeMarginTopAndIframeHeight(t,e){var a=e.attr("signTop"),i=$("#custom-iframe");t&&"nt"==t?(e.addClass("nt"),a||i.attr("height",i.height()),e.closest(".layer-box").addClass("signType")):(e.removeClass("nt"),i.attr("height",i.attr("signHeight")),e.closest(".layer-box").removeClass("signType")),e.attr("signTop",t)}function selectPopup(t,e,a){var i=t.prev(),l="500px",s="520px";$("body").height()<400&&(s="90%"),a&&1==a&&(a="Y");var n,r="";"DEPT"==e?r=$.i18n.prop("select.dept"):"USER"==e?r="选择用户  ["+(a?"多选":"单选")+"]":"PJT"==e?(r="选择项目",l="1000px",s="650px"):"ROLE_SYS"==e?r="选择系统角色":"ROLE_PJT"==e?r="选择项目角色":"ROLE_DPT"==e?r="选择部门角色":e.indexOf("GROUP_")>-1&&(l="830px",s="700px",r="选择分组字段"),showLoading(),n="USER"==e?[$.i18n.prop("common.comfirm"),"保存至常用联系人",$.i18n.prop("common.cancel")]:"PJT"==e||"PRD"==e?[$.i18n.prop("common.comfirm"),"清空",$.i18n.prop("common.cancel")]:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")],top.layer.open({type:2,title:r,maxmin:!1,shadeClose:!1,resize:!0,scrollbar:!1,hideBtn:!0,btn:n,area:[l,s],content:[ctx+"search?type="+e+"&selectIds="+i.val()+"&isMul="+a,"no"],yes:function(a,l){var s=top.layer.getChildFrame("body",a),n="",r="",d="";if(e.indexOf("GROUP_")>-1)n=s.find("#selectIds").val(),$.ajax({url:"/field/getFieldNames",type:"post",data:{ids:n},async:!1,success:function(t){r=t}});else if("PJT"==e||"PRD"==e){n=s.find("#selectIds").val(),r=s.find("#selectNames").val();var o=$("#objectId").val(),c=$("#objectType").val();isWorkflow(c)&&!o?$.ajax({url:"/instance/getDefaultInstanceByBelongId",type:"post",data:{objectType:c,belongId:n,belongType:e},async:!1,success:function(t){if(0==t.code){var a=$("#workflowId").val();if(a&&t.instanceId&&a!=t.instanceId)if(parent.layer.closeAll(),parentName&&parentName[0])top.frames[parentName[0]].addWorkflow(n,e)}}}):"TSK"==c&&n!=$("#_projectId").val()&&$.ajax({url:"/plan/getPrePlanList",type:"post",data:{planId:"",objectId:n,isTemplate:"N"},async:!1,success:function(t){if(t){for(var e='<option value="">请选择</option>',a="",i=0;i<t.length;i++)t[i].checked&&(a=t[i].id),e+='<option data-content="'+t[i].text+'" value="'+t[i].id+'"></option>';$("#planId").html(e).selectpicker("refresh").selectpicker("val",a),a&&"function"==typeof loadNodeList&&loadNodeList(a),$("#planId").change((function(){loadNodeList($(this).val())}))}}})}else $li=s.find(".selected-ul li"),$li&&$li.length&&$li.each((function(){n?(n+=","+$(this).attr("attrId"),r+=", "+$(this).find(".selected-name").text()):(n=$(this).attr("attrId"),r=$(this).find(".selected-name").text()),"USER"==e&&(d+=getUserHtml($(this).attr("attrId"),$(this).find(".selected-name").text(),$(this).attr("mtype"),$(this).attr("headImg")))}));if("USER"==e){var p=t.closest(".field-content").find(".user-list");p.length?p.html(d):t.val(r)}else(n&&r||!n&&!r)&&t.val(r);i.val(n),top.layer.close(a),"function"==typeof afterSelectPopup&&afterSelectPopup(),hideLoading()},btn2:function(a,l){if("USER"==e){var s=l.find("iframe")[0].contentWindow;if("function"==typeof s.saveContactUser)return s.saveContactUser(),!1}else{top.layer.getChildFrame("body",a);t.val(""),i.val(""),layer.close(a)}},btn3:function(t,e){layer.close(t),hideLoading()},cancel:function(t,e){layer.close(t),hideLoading()},end:function(e,a){e&&a&&(i.val(e),t.val(a))}})}function closeFormSelectBox(){$(".layui-laydate").remove()}function customValidate(type){var flag=!0,areaHtml,$summernote;if(type){if("USER"==type){var password=$("#password").val(),cfmPassword=$("#cfmPassword").val();(password||cfmPassword)&&(password&&cfmPassword&&password!=cfmPassword?($("#cfmPassword").testRemind($.i18n.prop("user.password.sync")),$("#cfmPassword").focus(),flag=!1):password&&!cfmPassword?($("#cfmPassword").testRemind($.i18n.prop("user.password.confirm.input")),$("#cfmPassword").focus(),flag=!1):!password&&cfmPassword&&($("#password").testRemind($.i18n.prop("user.password.input")),$("#password").focus(),flag=!1));var $userName=$('input[name="username"]'),username=$userName.val(),oldUserName=$userName.attr("oldUsername"),userId=$('input[name="id"]').val();flag&&username&&(oldUserName&&(username==oldUserName||password||($("#password").testRemind($.i18n.prop("user.password.reset")),$("#password").focus(),flag=!1)),$.ajax({type:"POST",url:ctx+"verifyUserExists",data:{fieldName:"userName",value:username,userId:userId},async:!1,success:function(t){0==t.code||($userName.testRemind(t.msg),$userName.focus(),flag=!1)}}));var $jobNumber=$('input[name="jobNumber"]'),jobNumber=$jobNumber.val();flag&&jobNumber&&$.ajax({type:"POST",url:ctx+"verifyUserExists",data:{fieldName:"jobNumber",value:jobNumber,userId:userId},async:!1,success:function(t){0==t.code||($jobNumber.testRemind(t.msg),$jobNumber.focus(),flag=!1)}})}else if("DEPT"==type){var $name=$('input[name="name"]'),name=$name.val(),id=$('input[name="id"]').val();flag&&name&&(flag=verifyValueExists($name,"name",name,id,type));var $code=$('input[name="code"]'),code=$code.val(),id=$('input[name="id"]').val();flag&&code&&(flag=verifyValueExists($code,"code",code,id,type))}else if("OPTION"==type){var $name=$('input[name="name"]'),name=$name.val(),id=$("#id").val(),parentId=$("#dataBaseId").val();flag&&name&&(flag=verifyValueExists($name,"name",name,id,type,parentId))}else if("PHASE"==type||"TYPE"==type||"SCRUM_BOARD"==type){var $name=$('input[name="name"]'),name=$name.val(),id=$("#id").val(),objectType=$("#objectType").val();flag&&name&&(flag=verifyValueExists($name,"name",name,id,type,parentId,objectType))}else if("DOC"==type){if("N"==$("#isEdit").val()&&!$(".easy_upload_queue_item:visible").length){flag=!1;var $uploadSelect=$(".easy_upload_select");$uploadSelect.testRemind("请选择文件"),$("html, body").animate({scrollTop:$(".easy_upload_select").offset().top},{duration:1,easing:"swing"})}}else if("PAGE"==type&&flag){var $rowCondition=$(".row-condition");$(".row-condition").find(".filterSign").each((function(){if(!$(this).val()){if($(this).is("input"))return flag=!1,$(this).testRemind("请填写筛选条件"),flag;if($(this).is("select")){$(".form-control-date").val();var t=$(this).next(".bootstrap-select");if(!t.next(".form-control-date").length||!t.next(".form-control-date").val())return flag=!1,t.testRemind("请选择筛选条件"),flag}}}))}if(isEntity(type)){var $code=$('input[name="code"]'),code=$code.val(),id=$("#id").val(),objectType=$("#objectType").val();flag&&code&&(flag=verifyValueExists($code,"code",code,id,type,parentId,null))}flag&&(isEntity(type)||isWorkflow(type)||"ONLYSAVE"==type)&&$(".field-li[htype='SIGN']").each((function(){try{var field=$(this).attr("field");if(!eval("save_"+field)()){var hasTipMsg=$(this).find(".hasTipMsg").val();return hasTipMsg&&"Y"==hasTipMsg||$(this).testRemind("此字段不允许为空"),flag=!1,!1}}catch(t){flag=!0}}))}$(".summernote").length&&$(".summernote").each((function(){areaHtml=(areaHtml=$(this).summernote("code")).trim(),$summernote=$(this).closest(".field-content-summernote"),!areaHtml&&$(this).hasProp("required")?($summernote.testRemind($.i18n.prop("filed.input")),mScroll($summernote),flag=!1):$summernote.find('input[htype="FORMATAREA"]').val(areaHtml)}));return flag||hideLoading(),flag}function verifyValueExists(t,e,a,i,l,s,n){var r=!0;return $.ajax({type:"POST",url:ctx+"verifyValueExists",data:{fieldName:e,value:a,id:i,type:l,parentId:s,objectType:n},async:!1,success:function(e){0==e.code||(t.testRemind(e.msg),t.focus(),r=!1)}}),r}function limitNumber(t,e,a,i){var l=t.val();if("."==l||"-"==l||!l)return t.val(""),void("report_in_work"==t.attr("name")&&"function"==typeof changeCurDayHour&&changeCurDayHour(t));if(l.trim()!=l&&(t.val(l.trim()),l=l.trim()),isFloat(l)){var s=l.indexOf(".");if(s>=0&&e&&""!=e)l.substring(s,l.length).length-1>parseInt(e)&&(l=l.substring(0,parseInt(s)+parseInt(e)+1)),0==parseInt(e)&&(l=parseInt(l))}else l="";/^\./.test(l)&&(l="0"+l);var n=/\.+$/;n.test(l)&&(l=l.replace(n,"")),a&&""!=a&&parseFloat(l)<parseFloat(a)&&(l=a),i&&""!=i&&parseFloat(l)>parseFloat(i)&&(l=i),l!=t.val()?(""!=l&&(l=parseFloat(l)),t.val(l)):""!=l&&t.val(parseFloat(l)),"report_in_work"==t.attr("name")&&"function"==typeof changeCurDayHour&&changeCurDayHour(t)}function isFloat(t){t=filterTrim(t);var e=new RegExp("^(-?[0-9]*)(\\.)?[0-9]*$","g");return t.match(e)==t}function isInteger(t){t=filterTrim(t);var e=new RegExp("^-?\\d+$","g");return t.match(e)==t}function filterTrim(t){return t?t.replace(/^\s*|\s*$/g,""):t}function mScroll(t){$("html,body").stop(!0),$("html,body").animate({scrollTop:t.offset().top},1)}var isOpenUserDialog="N";function selectUser(t,e){var a="",i="";"Y"!=isOpenUserDialog&&(isOpenUserDialog="Y",top.layer.open({type:2,title:"选择用户",maxmin:!1,shadeClose:!1,resize:!0,scrollbar:!1,hideBtn:!0,btn:["确定","取消"],area:["500px","520px"],content:["/search?type=USER&selectIds="+t.attr("userId")+"&isMul="+e,"no"],yes:function(e,l){var s=top.layer.getChildFrame("body",e).find(".selected-ul li");if(s&&s.length){var n,r=$("#curUserId").val();s.each((function(){n=$(this).attr("attrId"),r!=n&&(a?(a+=","+n,i+=", "+$(this).find(".selected-name").text()):(a=n,i=$(this).find(".selected-name").text()))}))}t.attr("userId",a),t.hasClass("fa-plus-circle")?$.ajax({url:"/sys/user/getCalendarMemberUserList",type:"post",data:{userIds:a},async:!1,success:function(t){var e="";if(t)for(var i=0;i<t.length;i++)e+=getUserLi(t[i],i+2);var l="";$('input[name="scheduleType"]:checked').each((function(){l&&(l+=","),l+=$(this).val()})),reloadCalendar(a,l),e||(e="<li class='noData'>没有成员</li>"),$("#memberList").html(e)}}):t.html("<a onclick=\"viewUser('"+a+"')\">"+i+"</a>"),top.layer.close(e),isOpenUserDialog="N";var d=$("#objectType").val();d&&"TSP"==d&&saveTspTscTester()},btn2:function(t,e){isOpenUserDialog="N"},cancel:function(t,e){isOpenUserDialog="N"}}))}var copyUser=!1;function changeStyle(t,e){var a=t.closest("td"),i=a.closest("table");i.find(".copy-drag").remove(),i.find("td").removeClass("selectTd first last middle"),a.addClass("selectTd"),e&&a.append('<div class="copy-drag"></div>');var l=t.attr("type");l&&"USER"==l&&(copyUser=!0,t.unbind("dblclick").on("dblclick",(function(e){selectUser(t)})),initEdit(i)),i.click((function(){i.find("td").removeClass("selectTd first last middle"),i.find(".copy-drag").remove()})),stopPropagation()}function changeStyle2(t){var e=t.parent();e.closest("table").find("td").removeClass("selectTd"),e.addClass("selectTd")}function initEdit(t){var e=!1,a=null,i=t.find('td[name="tester"]'),l=$(".layer-box");t.find(".copy-drag").mousedown((function(){e=!0,a=$(this).prev().find(".testerId")})),i.mousemove((function(){if(e){t.find(".copy-drag").remove();$(this);$(this).addClass("selectTd"),$(this).find(".testerId").attr("userId",a.attr("userId")).html(a.html());var i=t.find(".selectTd");i.each((function(t){i.length>1&&(0==t?$(this).addClass("first"):t==i.length-1?$(this).addClass("last"):$(this).addClass("middle"))}))}})),l.mouseup((function(a){e&&(t.find(".selectTd").length>1&&(t.find(".copy-drag").remove(),saveTspTscTester()));e=!1,startCell=null}))}function saveTspTscTester(){var t="";$("#relateTsc-table").find(".selectTd .testerId").each((function(){t&&(t+=","),t+=$(this).attr("tscId")+"#@#"+$(this).attr("userId")})),$.ajax({type:"POST",url:"/tsp/saveTspTscTester",data:{tspId:$("#id").val(),tscAndTesterIds:t},success:function(t){}})}function delRelateTsc(t,e){top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){var a=$("#id").val();a||(a=$("#objectId").val()),$.ajax({url:"/tsp/delRelateTsc",type:"post",data:{tspId:t,tscId:e,objectId:a,objectType:$("#objectType").val()},success:function(t){top.layer.closeAll("dialog"),layer.msg(t.msg),loadRelateTsc(!0)}})}))}function addBug(t){t||(t=$("#curTscId").val());var e=top.layer.getFrameIndex(window.name);parent.$("#layui-layer"+e).hide(),parent.$("#layui-layer-shade"+e).hide();var a="/workflow/addOrEditWorkflow/null?objectType=BUG&belongId="+$("#belongId").val()+"&belongType="+$("#belongType").val()+"&srcObjectId="+t+"&srcObjectType=TSC&iframeIndex="+e+"&parentname="+(parentName||window.name);intoIframePage(a)}function preRemoveUser(t){$del=t.closest(".user-add").prev().find(".del"),$del.is(":visible")?$del.hide():$del.show()}function removeUser(t){$user=t.closest(".cp"),$userIdInput=t.closest(".user-list").next().find('input[attrsign="_ids"]');var e=$userIdInput.val();e&&(e=removeSplit(e=e.replaceAll($user.attr("userId"),""),","),$userIdInput.val(e)),$user.remove(),stopPropagation()}function getUserHtml(t,e,a,i){var l='<div class="cp" userId="'+t+'" onclick="viewUser(\''+t+'\')" title="'+e+'">';return l+='\t\t<i class="fa fa-minus-circle del" onclick="removeUser($(this))"></i>',l+='\t\t<div class="user-col">',l+=i?'\t\t\t<img src="'+i+'"/>':'\t\t\t<img src="/img/user/'+a+'.png"/>',l+=e,l+="\t\t</div>",l+="\t</div>"}function removeSplit(t,e){if(t){for(var a=t.split(e),i="",l=0;l<a.length;l++)a[l]&&(i?i+=e+a[l]:i=a[l]);t=i}return t}function loadFile(t){reLoadTableData("file","ATTACHMENT","",t)}function loadRelate(t){reLoadTableData("relate","RELATE","",t)}function loadTrack(t){$.ajax({type:"POST",url:"/prq/getPrqTrackList",data:{objectId:$("#id").val()},async:!1,success:function(t){t&&t.length?(Table().init({id:"track-table",header:["序号","跟踪对象","名称","责任人","创建人","创建时间","操作"],data:t,columnWidth:["40px","90px","250px","90px","90px","100px","80px"],align:"left"}),$("#track-table").show(),$("#track-none").hide()):($("#track-table").hide(),$("#track-none").show())}})}function loadRelateTsc(t){$.ajax({type:"POST",url:"/tsp/getRelateTscList",data:{objectId:$("#id").val()},async:!1,success:function(t){t&&t.length?(Table().init({id:"relateTsc-table",header:["序号","名称","用例类型","优先级","测试人员","操作"],data:t,columnWidth:["40px","250px","100px","100px","100px","80px"],align:"left"}),$("#relateTsc-table").show(),$("#relateTsc-none").hide()):($("#relateTsc-table").hide(),$("#relateTsc-none").show())}})}function loadMyTsc(t){$.ajax({type:"POST",url:"/tsp/getMyTscList",data:{objectId:$("#id").val()},async:!1,success:function(t){t&&t.length?(Table().init({id:"myTsc-table",header:["序号","名称","执行人","执行时间","结果","操作"],data:t,columnWidth:["40px","250px","60px","100px","60px","150px"],align:"left"}),$("#myTsc-table").show(),$("#myTsc-none").hide()):($("#myTsc-table").hide(),$("#myTsc-none").show())}})}function loadTestRecord(t){$.ajax({type:"POST",url:"/tsp/getTestRecordList",data:{tscId:$("#id").val()},async:!1,success:function(t){t&&t.length?(Table().init({id:"testRecord-table",header:["序号","测试计划","执行人","执行时间","结果"],data:t,columnWidth:["40px","300px","100px","120px","100px"],align:"left"}),$("#testRecord-table").show(),$("#testRecord-none").hide()):($("#testRecord-table").hide(),$("#testRecord-none").show())}})}function loadTestReport(t){$.ajax({type:"POST",url:"/tsp/getTestReportList",data:{tspId:$("#id").val()},async:!1,success:function(t){if(t&&t.length){var e=t[0],a=t[1],i=t[2];if(null!=e){var l=Table();l.init({id:"allTestReport-table",header:["序号","用例总数","未执行（占比）","通过（占比）","失败（占比）","阻塞（占比）","忽略（占比）"],data:e,columnWidth:["34px","100px","100px","100px","100px","100px","100px"],align:"left"}),$("#allTestReport-table").show(),$("#testReport-none").hide(),l.init({id:"levelTestReport-table",header:["序号","优先级","用例总数","未执行（占比）","通过（占比）","失败（占比）","阻塞（占比）","忽略（占比）"],data:a,columnWidth:["40px","100px","100px","100px","100px","100px","100px","100px"],align:"left"}),$("#levelTestReport-table").show(),l.init({id:"testerTestReport-table",header:["序号","测试人员","用例总数","未执行（占比）","通过（占比）","失败（占比）","阻塞（占比）","忽略（占比）"],data:i,columnWidth:["40px","100px","100px","100px","100px","100px","100px","100px"],align:"left"}),$("#testerTestReport-table").show()}}else $("#allTestReport-table").hide(),$("#testReport-none").show()}})}function trackRelate(t,e,a){var i=$("#id").val();i||(i=$("#objectId").val()),top.layer.open({type:2,title:"关联对象",maxmin:!0,shadeClose:!1,area:["850px","680px"],content:"/relateObject?objectId="+i+"&objectType="+$("#objectType").val()+"&isSign="+t+"&selectIds="+e+"&deleteRelateId="+a+"&trackType=TSK,TSC,PRQ,MRQ,BUG&parentname="+window.name,end:function(t){t&&loadTrack(!0)}})}function tscRelate(t,e,a){var i=$("#id").val();i||(i=$("#objectId").val()),top.layer.open({type:2,title:"关联用例",maxmin:!0,shadeClose:!1,area:["850px","680px"],content:"/relateObject?objectId="+i+"&objectType="+$("#objectType").val()+"&isSign="+t+"&selectIds="+e+"&deleteRelateId="+a+"&trackType=TSC&parentname="+window.name,end:function(t){t&&loadRelateTsc(!0)}})}function delTrack(t,e){top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){var a=$("#id").val();a||(a=$("#objectId").val()),$.ajax({url:"/prq/delTrack",type:"post",data:{srcId:t,destId:e,objectId:a,objectType:$("#objectType").val()},success:function(t){top.layer.closeAll("dialog"),layer.msg(t.msg),loadTrack(!0)}})}))}function loadWorkflowProcess(){var $workflowProcess=$(".workflowProcessContent");if($workflowProcess.find(".none").length){var objectId=$("#objectId").val();$.ajax({type:"POST",url:"/workflow/getWorkflowProcessList",data:{objectId:objectId,workflowId:$("#workflowId").val(),objectType:$("#objectType").val()},async:!1,success:function(data){if(data){data=eval("("+data+")");var processList=data.processList,html='<div class="flowChart">',curData;html+='\t<div class="flowChart-left">',html+='\t\t<div class="dashed"></div>',html+="\t</div>",html+='\t<div class="flowChart-right">';for(var i=0;i<processList.length;i++)curData=processList[i],curData.tranType&&"decision"==curData.tranType||(html+=getProcessStatus(curData.statusName,curData.userImg,curData.userName,curData.userId,curData.tranName,curData.remark,curData.stayTime,curData.operateTime,curData.tranType));html+="\t</div>",html+="</div>",$workflowProcess.html(html)}}})}}function loadWorkflowChart(){var $workflowChart=$(".workflowChartContent");if($workflowChart.find(".none").length){var objectId=$("#objectId").val();$.ajax({type:"POST",url:"/workflow/getWorkflowProcessList",data:{objectId:objectId,workflowId:$("#workflowId").val(),objectType:$("#objectType").val()},async:!1,success:function(data){if(data){var $layerBox=$(".layer-box");data=eval("("+data+")");var flowChart=data.flowChart,hisTranIdArray=data.hisTranIdArray,curNodeId=data.curNodeId,roleUserInfo=data.roleUserInfo,instanceName=data.instanceName,html='<div class="flowChartName">'+instanceName+"</div>";html+='<div class="chart-view scroll-bar">',html+=getFlowChart(flowChart),html+=getCurNodeRoleUser(roleUserInfo),html+="</div>",$workflowChart.html(html),changeSvgParams();var hisTranIds="";if(hisTranIdArray){for(var tranId of hisTranIdArray)hisTranIds?hisTranIds+=",#svg-sid-"+tranId:hisTranIds="#svg-sid-"+tranId;var $tranPath=$(hisTranIds).find("path");$tranPath.css("stroke","#FF5722");var arrowhead="";$tranPath.each((function(){arrowhead+=arrowhead?",#"+$(this).attr("id").replace("_1","arrowhead"):"#"+$(this).attr("id").replace("_1","arrowhead")})),$(arrowhead).css({fill:"#FF5722",stroke:"#FF5722"})}if(curNodeId){var $curNode=$("#svg-sid-"+curNodeId),top=$curNode.offset().top-$(document).scrollTop(),left=$curNode.offset().left-$(document).scrollLeft(),array=$curNode.find(".stencils").attr("transform").replace(/[^0-9\-,.]/g,"").split(","),ctop=Number(array[0]-4),cleft=Number(array[1]-4),$curBox=$(".svgcontainer g:first-child");$curBox.attr({transform:"translate("+ctop+","+cleft+")",display:""}),$curBox.find("rect").attr({width:"40",height:"40",stroke:"#FF5722","stroke-dasharray":""});var $tipBox=$(".tipBox");$curNode.hover((function(){$(".tipBox").css({top:top-20-$layerBox.scrollTop()+"px",left:left+50-$layerBox.scrollLeft()-$(".scroll-bar").scrollLeft()+"px"}),$tipBox.show()}),(function(){$tipBox.hide()}))}}}})}}function getDefaultSignHtml(t){var e='<li class="field-li content-whole sign" htype="SIGN">';return e+='\t<div class="field-div field-sign-title3">',e+='\t\t<i class="zmdi zmdi-hdr-strong mr10"></i>',e+='\t\t<div class="title">'+t+"</div>",e+="\t</div>",e+='\t<div class="field-div field-sign-content"></div>',e+="</li>"}function getFlowChart(t){return t}function getCurNodeRoleUser(t){var e="";if(t&&t.length){e+='<div class="tipBox">',e+='\t<div class="tip-row tip-title">当前可操作用户</div>';for(var a=0;a<t.length;a++)e+='<div class="tip-row"><div class="tip-name">'+t[a].n+'</div><div class="tip-content">'+t[a].u+"</div></div>";e+="</div>"}return e}function changeSvgParams(){var t=$(".chart-view").children(":first"),e=t.children("g").get(0),a=e.getBBox(),i=a.x,l=a.y;a.width<860&&t.attr("width",920),i>30&&(i=30-i),l>30&&(l=30-l),$(e).attr({transform:"translate("+i+","+l+")"})}function getProcessStatus(t,e,a,i,l,s,n,r,d){var o='<div class="oneNode">';return o+=d&&"REJECT"==d?'\t<div class="check check-danger"><i class="zmdi zmdi-close"></i></div>':d&&"state-decision"==d?'\t<div class="check check-warning"><i class="zmdi zmdi-arrow-split"></i></div>':'\t<div class="check check-success"><i class="zmdi zmdi-check"></i></div>',o+='\t<div class="tag-boder">',o+='\t\t<div class="tag"></div>',o+="\t</div>",o+='\t<div class="NodeDetail">',o+='\t\t<div class="statusName"><div class="title"><span>'+t+"</span><span>"+r+"</span></div></div>",o+='\t\t<div class="NodeDetail-title">',o+='\t\t\t<img src="'+e+'" class="cp-theme" onclick="viewUser(\''+i+'\')" title="'+a+'"/>',o+='\t\t\t<div class="details">',o+='\t\t\t\t<a class="userName link-btn" onclick="viewUser(\''+i+'\')" title="'+a+'">'+a+"</a>",o+='\t\t\t\t<div class="operateDetail">',o+='\t\t\t\t\t<div class="status">'+l+"</div>",n&&(o+='\t\t\t\t<div class="stayTime">停留时间：'+n+"</div>"),o+="\t\t\t\t</div>",o+="\t\t\t</div>",o+="\t\t</div>",s&&(o+='\t\t<div class="NodeDetail-content">',o+='\t\t\t<span class="badgeSign">审批意见:</span>',o+='\t\t\t<span class="signRemark">'+s+"</span>",o+="\t\t</div>"),o+="\t</div>",o+="</div>"}function reLoadTableData(t,e,a,i){var l=t+"-table",s=t+"-none",n=$("#"+l),r=$("#objectType").val(),d=n.closest(".table-wrap");if(r&&"PJT"==r&&("RELATE"!=e&&"ATTACHMENT"!=e||n.closest(".content").css("width","65%")),d.length)i?n.GM("onlyRefresh"):n.attr("totals")&&"0"!=n.attr("totals")?(d.show(),$("#"+s).hide()):d.is(":visible")||$("#"+s).show();else if(n.length){var o=$("#id").val();o||(o=$("#objectId").val()),n.show(),n.initTable({tableId:l,model:e,supportPage:!0,supportTree:!1,queryObject:a,objectId:o,objectType:r})}}function addAttachment(t){showLoading();var e="";if(t||(e=$("#id").val())||(e=$("#objectId").val()),!$("#attachmentForm").length){var a='<form id="attachmentForm" action="/attachment/upload" method="post" enctype="multipart/form-data">';a+='\t\t<input type="hidden" id="objectId" name="objectId" value="'+e+'"/>',a+='\t\t<input type="hidden" id="objectType" name="objectType" value="'+$("#objectType").val()+'"/>',a+='\t\t<input type="file" name="attachments" id="attachments" multiple="multiple" class="hide"/>',a+="   </form>";var i=$(a);$(document.body).append(i),$("#attachments").change((function(){showProgressLoading(),uploadAttachment($(this))}))}$("#attachments").click(),setTimeout((function(){hideLoading()}),500)}function uploadAttachment(t){if(t.val()){var e=new FormData($("#attachmentForm")[0]);attUploadCompleted=!1,$.ajax({type:"POST",url:"/attachment/upload",data:e,cache:!1,async:!1,contentType:!1,processData:!1,error:function(t){},success:function(e){0==e.code?("function"==typeof reLoadFileList&&reLoadFileList(e),"function"==typeof reLoadTableData&&reLoadTableData("file","ATTACHMENT","",!0),attUploadCompleted=!0):(t.val(""),parent.layer.msg(e.msg,1),$(".progress-loading").hide())}})}}function delAttachment(t){top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){$.ajax({url:"/attachment/remove",type:"post",data:{ids:t},success:function(t){top.layer.closeAll("dialog"),layer.msg(t.msg),reLoadTableData("file","ATTACHMENT","",!0)}})}))}function downloadAttachment(t){$.ajax({url:"/attachment/judgeFileIsExists",type:"post",async:!1,data:{id:t},success:function(e){if(e)alert(e);else{var a=$("<form method='post' id='downloadForm' style='display:none'><input name='id' value='"+t+"'></form>");a.attr("action","/attachment/download"),$(document.body).append(a),a.submit()}}})}function linkDoc(t){(t=$("#id").val())||(t=$("#objectId").val()),top.layer.open({type:2,title:"链接文档",maxmin:!0,shadeClose:!1,area:["800px","680px"],content:"/document/linkDoc?objectId="+t+"&objectType="+$("#objectType").val()+"&parentname="+window.name,end:function(t,e){t&&loadDoc(!0)}})}function loadDoc(t){reLoadTableData("file",$("#objectType").val(),"",t)}function relateObject(t,e,a){var i=$("#id").val();i||(i=$("#objectId").val()),top.layer.open({type:2,title:"关联对象",maxmin:!0,shadeClose:!1,area:["850px","680px"],content:"/relateObject?objectId="+i+"&objectType="+$("#objectType").val()+"&isSign="+t+"&selectIds="+e+"&deleteRelateId="+a+"&parentname="+window.name,end:function(t,e){t?"TSC"==t?loadRelateTsc(!0):"isSign"==t?reLoadRelateList(e):loadTrack(!0):loadRelate(!0)}})}function delRelate(t){top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){var e=$("#id").val();e||(e=$("#objectId").val()),$.ajax({url:"/delRelateObject",type:"post",data:{ids:t,objectId:e,objectType:$("#objectType").val()},success:function(t){top.layer.closeAll("dialog"),layer.msg(t.msg),loadRelate(!0)}})}))}function changeEdition(t){var e=t.attr("name"),a=t.val(),i="";"bigEdition"==e||"smallEdition"==e?"0"==a?i="A":"1"==a?i="b":"2"==a?i="1":"3"==a?i="01":"4"==a&&(i="001"):"editionConnect"==e&&("0"==a?i=".":"1"==a?i="*":"2"==a?i="-":"3"==a?i="_":"4"==a&&(i="~")),$("."+e).text(i)}function changeCodeSuffix(t){var e=t.attr("name"),a=t.val(),i="";"SN"==a?i="000001":"RANDOM"==a&&(i="265832"),$("."+e).text(i)}function changeCodeConnect(t){var e=t.attr("name"),a=t.val(),i="";"2"==a?i="-":"3"==a?i="_":"4"==a&&(i="~"),$("."+e).text(i)}function changeMiddleRule(t){var e=t.attr("name"),a=t.val();$("."+e).text(formatDateByPattern(new Date,a))}function formatDateByPattern(t,e){var a="";if(e){var i=t.getFullYear(),l=t.getMonth()+1;t=t.getDate();"YYYMMDD"==e?a=i+""+l+t:"YYYYMM"==e?a=i+""+l:"YYYY"==e?a=i:"YY"==e&&(a=i.toString().substring(2))}return a}function filterRepeatFromArray(t,e){var a=[];if(t&&e){for(var i=0;i<t.length;i++)t[i].name!=e&&a.push({name:t[i].name,value:t[i].value});return a}}function changeLayerBodyHeight(){var t="Y",e=$(".windowPage");e&&e.length&&(t="N");var a=$(".title-ul"),i=0;if(a.length&&(i=a.height(),!a.find(".title-sign").length)){var l=parent.layer.getFrameIndex(window.name),s=parent.$("#layui-layer-iframe"+l);s.height(s.height()-20)}if(t&&"Y"==t)$(".layer-box").height($(".layer-body").height()-i);else{var n=$(".layer-body").height()+20;$('.windowPage:not([submittask="Y"]) .field-li.content-whole.detail-sign');parent.$(".iframeClass").length?n-=50:n-=73,0==i&&(n+=30),$(".layout-left, .layout-right").height(n)}}function getThemeColor(){var t=document.documentElement,e=getComputedStyle(t);return String(e.getPropertyValue("--theme")).trim()}function controlBtnShowPosition(){var t=$(".formBtn");setTimeout((function(){if(t.removeClass("hide"),!isBtnShowInWindow(t)){var e=t.closest(".layout-left");e&&e.length?e.addClass("btnFixed"):t.closest(".ibox-content").addClass("btnFixed")}}),100)}function isBtnShowInWindow(t){var e=t[0].getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=$(window).height()&&e.right<=$(window).width()}$.fn.serialize_plus=function(){var t=this.serializeArray(),e=$("input[type=radio],input[type=checkbox]",this),a={};return $.each(e,(function(){if(!a.hasOwnProperty(this.name)){var e=$("input[name='"+this.name+"']:checked");if(0==e.length)a[this.name]="",t.push({name:this.name,value:""});else if(e.length>1){var i="";e.each((function(){i?i+=","+$(this).val():i=$(this).val()})),(t=filterRepeatFromArray(t,this.name)).unshift({name:this.name,value:i}),a[this.name]=""}}})),jQuery.param(t)};