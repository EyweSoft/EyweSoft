function initFilterCondition(e,t){if(e)for(var l,i,a,o,n,r=e.split("@@##@@"),d=0;d<r.length;d++)if(r[d]){l=r[d].split("##@@@##");for(var s=0;s<l.length;s++)i=l[0],a=l[1],o=l[2],n=l[3];selectCondition(t,i,a,o,n)}}function selectFieldFilter(id,$obj,equalsId,filterSignValue){showLoading(),jQuery.ajax({url:"/field/getFieldFilterCondition",type:"post",data:{id:id},success:function(r){if(r){r=eval("("+r+")");var htmlType=r.htmlType,filterList=r.filterList,$rowCondition=$obj.closest(".row-condition");if(filterList){for(var filterData,selectId,$cell4=$rowCondition.find(".cell4"),isEditFlowChart=jQuery("#isEditFlowChart").val(),optionHtml='<select class="selectpicker" name="equalsFilter" '+(isEditFlowChart&&"Y"==isEditFlowChart?' dropupAuto="true"':"")+' data-live-search="false" data-live-search-style="begins" title="请选择">',i=0;i<filterList.length;i++)filterData=eval("("+filterList[i]+")"),0==i&&(selectId=filterData.value),optionHtml+='<option value="'+filterData.value+'">'+filterData.text+"</option>";equalsId&&(selectId=equalsId),optionHtml+="</select>",$rowCondition.find(".cell3").html(optionHtml),$rowCondition.find(".cell3").find('select[name="equalsFilter"]').selectpicker("refresh").selectpicker("val",selectId).show(),filterSignValue||(filterSignValue="");var conHtml="";if("USER"==htmlType){var userId="",userName="";if(filterSignValue){var userArray=filterSignValue.split("@#@#@");userId=userArray[0],userName=userArray[1]}conHtml+='<div class="field-div field-content">',conHtml+='\t<input type="hidden" id="_userId" name="userId" value="'+userId+'">',conHtml+='\t<input class="form-control form-control-popup filterSign" name="userIdName" type="text" value="'+userName+'" placeholder="请选择用户" autocomplete="off" readonly="readonly" htype="USER" isMul required>',conHtml+='\t<i class="zmdi zmdi-search"></i>',conHtml+="</div>",$cell4.html(conHtml)}else if("SELECT"==htmlType||"RADIO"==htmlType||"CHECKBOX"==htmlType){var optionList=r.optionList,optionData;if(conHtml+='<select class="selectpicker filterSign" name="conditionSelect" data-live-search="true" multiple data-live-search-style="begins" title="请选择" required>',optionList){optionList=eval("("+optionList+")");for(var i=0;i<optionList.length;i++)optionData=optionList[i],conHtml+='<option value="'+optionData.id+'">'+optionData.text+"</option>"}conHtml+="</select>",$cell4.html(conHtml),$cell4.find('select[name="conditionSelect"]').selectpicker("refresh"),filterSignValue&&$cell4.find('select[name="conditionSelect"]').selectpicker("val",filterSignValue.split(","))}else if("TEXT"==htmlType||"AREA"==htmlType)conHtml+='<div class="field-div field-content">',conHtml+='\t<input class="form-control filterSign" name="textContent" type="text" placeholder="请输入文本" value="'+filterSignValue+'" autocomplete="off"  htype="TEXT" maxlength="100" required>',conHtml+="</div>",$cell4.html(conHtml);else if("NUMBER"==htmlType)conHtml+='<div class="field-div field-content numberSign">',conHtml+='\t<input class="form-control filterSign" name="textContent" type="number" placeholder="请输入数字" value="'+filterSignValue+'" autocomplete="off"  htype="TEXT" maxlength="100" required>',conHtml+="</div>",$cell4.html(conHtml);else if("PJT"==htmlType){var dataId="",dataName="";if(filterSignValue){var dataArray=filterSignValue.split("@#@#@");dataId=dataArray[0],dataName=dataArray[1]}conHtml+='<div class="field-div field-content">',conHtml+='\t<input type="hidden" id="_projectId" name="userId" value="'+dataId+'">',conHtml+='\t<input class="form-control form-control-popup filterSign" name="projectIdName" type="text" value="'+dataName+'" placeholder="请选择项目" autocomplete="off" readonly="readonly" htype="PJT" isMul required>',conHtml+='\t<i class="zmdi zmdi-search"></i>',conHtml+="</div>",$cell4.html(conHtml)}else if("PRD"==htmlType){var dataId="",dataName="";if(filterSignValue){var dataArray=filterSignValue.split("@#@#@");dataId=dataArray[0],dataName=dataArray[1]}conHtml+='<div class="field-div field-content">',conHtml+='\t<input type="hidden" id="_productId" name="productId" value="'+dataId+'">',conHtml+='\t<input class="form-control form-control-popup filterSign" name="productIdName" type="text" value="'+dataName+'" placeholder="请选择产品" autocomplete="off" readonly="readonly" htype="PRD" isMul required>',conHtml+='\t<i class="zmdi zmdi-search"></i>',conHtml+="</div>",$cell4.html(conHtml)}else if("DEPT"==htmlType){var dataId="",dataName="";if(filterSignValue){var dataArray=filterSignValue.split("@#@#@");dataId=dataArray[0],dataName=dataArray[1]}conHtml+='<div class="field-div field-content">',conHtml+='\t<input type="hidden" id="_departmentId" name="departmentId" value="'+dataId+'">',conHtml+='\t<input class="form-control form-control-popup filterSign" name="departmentIdName" type="text" value="'+dataName+'" placeholder="请选择部门" autocomplete="off" readonly="readonly" htype="DEPT" isMul required>',conHtml+='\t<i class="zmdi zmdi-search"></i>',conHtml+="</div>",$cell4.html(conHtml)}else if("DATE"==htmlType){var dateClass="datetimepicker"+jQuery(".filter-from .row-condition .form-control-date").length+"_csDate",$equalsSelect=$rowCondition.find('select[name="equalsFilter"]'),type=$equalsSelect.val();$cell4.attr("type",type),initCell4DateHtml(r,$cell4,dateClass,type,filterSignValue),$equalsSelect.change((function(){var e=$cell4.attr("type");"EQ"==(type=jQuery(this).val())||"NE"==type?"EQ"!=e&&"EQ"!=e&&($cell4.attr("type",type),initCell4DateHtml(r,$cell4,dateClass,type,filterSignValue)):"LTE"!=e&&"LTE"!=e&&($cell4.attr("type",type),initCell4DateHtml(r,$cell4,dateClass,type,filterSignValue))}))}$rowCondition.find(".form-control-popup").click((function(e){var t=!0;try{t=jQuery(this).hasProp("isMul")}catch(e){t=!0}selectPopup(jQuery(this),jQuery(this).attr("htype"),t)}))}}hideLoading()}})}function initDate(e,t){laydate.render({elem:"."+e,eventElem:".layicon",trigger:"click",theme:"",type:"date",range:t,done:function(t,l){var i=jQuery("."+e);"function"==typeof changeDate&&changeDate(i,t),e.indexOf("_csDate")>=0&&(t?i.val(t):t="自定义时间",i.closest(".cell4").find(".filter-option").text(t))}})}function initCell4DateHtml(r,$cell4,dateClass,type,filterSignValue){if("EQ"==type||"NE"==type){var dateList=r.dateList,dateData,conHtml='<select class="selectpicker filterSign" name="dateSelect" data-live-search="false" data-live-search-style="begins" title="请选择" required>';if(dateList)for(var i=0;i<dateList.length;i++)dateData=eval("("+dateList[i]+")"),conHtml+='<option value="'+dateData.value+'">'+dateData.text+"</option>";conHtml+="</select>",$cell4.html(conHtml);var $dateSelect=$cell4.find('select[name="dateSelect"]');$dateSelect.selectpicker("refresh"),filterSignValue&&(filterSignValue.length>10?($dateSelect.selectpicker("val","CS"),$dateSelect.val("CS1"),$cell4.append('<input class="form-control form-control-date '+dateClass+' hide" name="csDate" value="'+filterSignValue+'" type="text"autocomplete="off" readonly="readonly" htype="DATE">'),$cell4.find(".filter-option").text(filterSignValue)):$dateSelect.selectpicker("val",filterSignValue)),$dateSelect.change((function(){if("CS"==jQuery(this).val()||"CS1"==jQuery(this).val()){var e="";if($cell4.find("."+dateClass).length){e=$cell4.find("."+dateClass).val(),$cell4.find("."+dateClass).remove();var t=e;t||(t="自定义时间"),$cell4.find(".filter-option").text(t)}$cell4.append('<input class="form-control form-control-date '+dateClass+' hide" name="csDate" value="'+e+'" type="text"autocomplete="off" readonly="readonly" htype="DATE">'),initDate(dateClass,!0),"CS"==jQuery(this).val()?jQuery(this).val("CS1"):jQuery(this).val("CS"),setTimeout((function(){$cell4.find("."+dateClass).click()}),100)}else $cell4.find("."+dateClass).remove()}))}else{isNaN(filterSignValue)&&!isNaN(Date.parse(filterSignValue))||(filterSignValue="");var conHtml='<div class="field-div field-content">';conHtml+='\t<input class="form-control form-control-date '+dateClass+'" name="csDate" type="text" value="'+filterSignValue+'" placeholder="" autocomplete="off" readonly="readonly" htype="DATE">',conHtml+='\t<i class="zmdi zmdi-calendar"></i>',conHtml+="</div>",$cell4.html(conHtml),initDate(dateClass,!1)}}function addCondition(e){setTimeout((function(){var t=e.closest(".filter-btn");jQuery(window).height()-t.offset().top-t.outerHeight()<350?t.find(".hide-select .bootstrap-select").addClass("open dropup").show():t.find(".hide-select .bootstrap-select").addClass("open").show()}),100)}function selectCondition(e,t,l,i,a){var o=null;(o=e?e.closest(".field-content").find(".filter-from"):jQuery(".filter-from")).append(jQuery(".hide-condition").html());var n=o.find(".row-condition").length;if($lastRow=o.children(":last-child"),1==n)$lastRow.find(".cell1").html("满足");else{n>2?t=jQuery(o.find(".row-condition")[1]).find('select[name="preCondition"]').val():t||(t="and");var r=jQuery("#isEditFlowChart").val(),d='<select class="selectpicker" name="preCondition" data-live-search-style="begins" '+(r&&"Y"==r?' dropupAuto="true"':"")+' onchange="selectPreCondition(jQuery(this))" title="请选择" >';d+='<option value="and">且</option>',d+='<option value="or">或</option>',d+="</select>",$lastRow.find(".cell1").html(d),$lastRow.find(".cell1").find('select[name="preCondition"]').selectpicker("refresh").selectpicker("val",t)}var s='<select class="selectpicker" name="selectField" data-live-search="true" data-live-search-style="begins" title="请选择" onchange="selectFieldFilter(jQuery(this).val(), jQuery(this))">';s+='<optgroup label="用户">';for(var c=0;c<fieldList.length;c++)"USER"==fieldList[c].htmlType&&(s+='<option type="USER" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+='<optgroup label="日期">';for(c=0;c<fieldList.length;c++)"DATE"==fieldList[c].htmlType&&(s+='<option type="DATE" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+='<optgroup label="选择框">';for(c=0;c<fieldList.length;c++)"SELECT"!=fieldList[c].htmlType&&"RADIO"!=fieldList[c].htmlType&&"CHECKBOX"!=fieldList[c].htmlType||(s+='<option type="'+fieldList[c].htmlType+'" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+='<optgroup label="数字">';for(c=0;c<fieldList.length;c++)"NUMBER"==fieldList[c].htmlType&&(s+='<option type="'+fieldList[c].htmlType+'" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+='<optgroup label="文本">';for(c=0;c<fieldList.length;c++)"TEXT"!=fieldList[c].htmlType&&"AREA"!=fieldList[c].htmlType||(s+='<option type="'+fieldList[c].htmlType+'" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+='<optgroup label="其他">';for(c=0;c<fieldList.length;c++)"PJT"!=fieldList[c].htmlType&&"PRD"!=fieldList[c].htmlType&&"DEPT"!=fieldList[c].htmlType||(s+='<option type="'+fieldList[c].htmlType+'" value="'+fieldList[c].id+'">'+fieldList[c].showName+"</option>");s+="</optgroup>",s+="</select>",e&&e.val()&&(l=e.val(),e.val("temp"));var p=$lastRow.find(".cell2");p.html(s),p.find('select[name="selectField"]').selectpicker("refresh").selectpicker("val",l),selectFieldFilter(l,p,i,a)}function removeCondition(e){e.closest(".row-condition").remove();var t=jQuery(".filter-from").children(":first");t.length&&t.find(".cell1").html("满足")}function selectPreCondition(e){e.closest(".row-condition").nextAll().find('select[name="preCondition"]').selectpicker("refresh").selectpicker("val",e.val())}function getFilterCondition(e){var t,l="";t=e?e.find(".filter-from .row-condition"):jQuery(".filter-from .row-condition");var i="";return t.each((function(e){i="",e>0&&(i+="@@##@@"+jQuery(this).find(".cell1 .selectpicker").val()),i+="##@@@##"+jQuery(this).find(".cell2 .selectpicker").val()+"##@@@##"+jQuery(this).find(".cell3 .selectpicker").val()+"##@@@##";var t="",a=jQuery(this).find(".cell4 .filterSign");t=a.is("input")?a.hasClass("form-control-popup")?a.prev().val()+"@#@#@"+a.val():a.val():a.val()?a.val():jQuery(this).find(".cell4 .form-control-date").val(),i+=t,t&&(l+=i)})),l}