function loadComment(){var $commmentContent=$("#comment-content");$commmentContent.html("");var id=$("#id").val();id||(id=$("#objectId").val()),$.ajax({type:"post",url:"/getComment",data:{objectId:id,objectType:$("#objectType").val()},async:!1,success:function(cData){if(cData&&(cData=eval("("+cData+")"),cData.totals?($("#comment-count").text(cData.totals),$("#comment-none").hide()):($("#comment-count").text(0),$("#comment-none").show()),cData.list)){for(var html="",trData,i=0;i<cData.list.length;i++){if(trData=cData.list[i],html+='<div class="comment-show-con clearfix">',html+='\t<div class="comment-show-con-img pull-left cp" onclick="viewUser(\''+trData.userId+'\')" title="'+trData.userName+'"><img src="'+trData.userImg+'"></div>',html+='\t<div class="comment-show-con-list pull-left clearfix">',html+='\t\t<div class="pl-text clearfix">',html+='\t\t\t<span class="comment-size-name"><span class="link-btn" onclick="viewUser(\''+trData.userId+"')\">"+trData.userName+"</span> ：</span>",html+='\t\t\t<span class="my-pl-con">&nbsp;'+trData.remark+"</span>",html+="\t\t</div>",html+='\t\t<div class="date-dz">',html+='\t\t\t<span class="date-dz-left pull-left comment-time">'+trData.createdTime+"</span>",html+='\t\t\t<div class="date-dz-right pull-right comment-pl-block">',trData.isAllowDel&&(html+='\t\t\t<span class="removeBlock link-btn" onclick="removeComment($(this), \''+trData.id+'\')"><i class="fa fa-trash mr5"></i>删除</span>'),html+='\t\t\t\t<span class="date-dz-pl pl-hf hf-con-block pull-left link-btn" onclick="replayComment($(this))"><i class="fa fa-mail-reply-all mr5"></i>回复</span>',html+="\t\t\t</div>",html+='\t\t\t<div class="replay-textarea hide">',html+='\t\t\t\t<div class="clearfix"></div>',html+='\t\t\t\t<div class="reviewArea clearfix mt10">',html+='\t\t\t\t\t<div class="textWrap wordSumTotal">',html+='\t\t\t\t\t\t<div class="textarea-box">',html+='\t\t\t\t\t\t\t<textarea rows="3" class="input_textarea" maxlength="200" placeholder="请输入评论内容"></textarea>',html+="\t\t\t\t\t\t</div>",html+="\t\t\t\t\t</div>",html+='\t\t\t\t\t<button type="button" class="btn t-btn n-active mt10 fr" onclick="addComment($(this), \''+trData.id+"', '"+trData.userId+"', '"+trData.userName+"', '"+trData.userImg+"')\">",html+='\t\t\t\t\t\t<i class="fa fa-comment-edit mr5"></i><span class="pt1 h18">评论</span>',html+="\t\t\t\t\t</button>",html+="\t\t\t\t</div>",html+="\t\t\t</div>",html+='\t\t\t<div class="replay-comment">',trData.children)for(var cTrData,j=0;j<trData.children.length;j++)cTrData=trData.children[j],html+='\t\t<div class="comment-show-con clearfix">',html+='\t\t\t<div class="comment-show-con-img pull-left" onclick="viewUser(\''+cTrData.userId+'\')" title="'+cTrData.userName+'"><img src="'+cTrData.userImg+'"></div>',html+='\t\t\t<div class="comment-show-con-list pull-left clearfix">',html+='\t\t\t\t<div class="pl-text clearfix">',html+='\t\t\t\t\t<span class="comment-size-name"><span class="link-btn" onclick="viewUser(\''+cTrData.userId+"')\">"+cTrData.userName+"</span>",cTrData.replayId&&(html+='\t\t\t\t\t回复<span class="link-btn" onclick="viewUser(\''+cTrData.replayId+"')\">@"+cTrData.replayName+"</span>"),html+="\t\t\t\t\t：</span>",html+='\t\t\t\t\t<span class="my-pl-con">'+cTrData.remark+"</span>",html+="\t\t\t\t</div>",html+='\t\t\t\t<div class="date-dz">',html+='\t\t\t\t\t<span class="date-dz-left pull-left comment-time">'+cTrData.createdTime+"</span>",html+='\t\t\t\t\t<div class="date-dz-right pull-right comment-pl-block">',cTrData.isAllowDel&&(html+='\t\t\t\t\t<span class="removeBlock link-btn" onclick="removeComment($(this), \''+cTrData.id+'\')"><i class="fa fa-trash mr5"></i>删除</span>'),html+='\t\t\t\t\t\t<span class="date-dz-pl pl-hf hf-con-block pull-left link-btn" onclick="replayComment($(this))"><i class="fa fa-mail-reply-all mr5"></i>回复</span>',html+="\t\t\t\t\t</div>",html+='\t\t\t\t\t<div class="replay-textarea hide">',html+='\t\t\t\t\t\t<div class="clearfix"></div>',html+='\t\t\t\t\t\t<div class="reviewArea clearfix mt10">',html+='\t\t\t\t\t\t\t<div class="textWrap wordSumTotal">',html+='\t\t\t\t\t\t\t\t<div class="textarea-box">',html+='\t\t\t\t\t\t\t\t\t<textarea rows="3" class="input_textarea" maxlength="200" placeholder="请输入评论内容"></textarea>',html+="\t\t\t\t\t\t\t\t</div>",html+="\t\t\t\t\t\t\t</div>",html+='\t\t\t\t\t\t\t<button type="button" class="btn t-btn n-active mt10 fr" onclick="addComment($(this), \''+trData.id+"', '"+cTrData.userId+"', '"+cTrData.userName+"', '"+cTrData.userImg+"')\">",html+='\t\t\t\t\t\t\t\t<i class="fa fa-comment-edit mr5"></i><span class="pt1 h18">评论</span>',html+="\t\t\t\t\t\t\t</button>",html+="\t\t\t\t\t\t</div>",html+="\t\t\t\t\t</div>",html+="\t\t\t\t</div>",html+="\t\t\t</div>",html+="\t\t</div>";html+="\t\t\t</div>",html+="\t\t</div>",html+="\t</div>",html+="</div>",i%5==0&&($commmentContent.append(html),html="")}$commmentContent.append(html),hideLoading()}}})}function addComment(t,a,e,l){var s=t.closest(".reviewArea").find(".input_textarea"),c=s.val();if(!c)return s.focus(),void alert("请输入评论内容");var m=$("#id").val();m||(m=$("#objectId").val()),showLoading(),$.ajax({url:"/saveComment",type:"post",data:{objectType:$("#objectType").val(),objectId:m,remark:c,parentId:a,replyId:e},success:function(t){0==t.code&&(s.val(""),loadComment()),layer.msg(t.msg)}})}function replayComment(t){var a=t.closest(".comment-pl-block").next(".replay-textarea");a.is(":visible")?a.addClass("hide"):(a.removeClass("hide"),a.find(".wordSumTotal").textSum())}function removeComment(t,a){top.layer.confirm($.i18n.prop("common.del.comfirm"),{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){$.ajax({url:"/removeComment",type:"post",data:{id:a,objectType:$("#objectType").val()},success:function(t){0==t.code&&loadComment(),top.layer.closeAll("dialog"),layer.msg(t.msg)}})}))}function loadOperateRecord(){var $operateContent=$("#operate-content");if(!$operateContent.html()){var id=$("#id").val();id||(id=$("#objectId").val()),$.ajax({type:"post",url:"/getOpreateRecord",data:{objectId:id,objectType:$("#objectType").val(),workflowId:$("#workflowId").val()},async:!1,success:function(cData){if(cData&&(cData=eval("("+cData+")"),cData.totals?($("#operate-count").text(cData.totals),$("#operate-none").hide()):($("#operate-count").text(0),$("#operate-none").show()),cData.list)){for(var html="",trData,i=0;i<cData.list.length;i++)trData=cData.list[i],html+='<div class="comment-show-con clearfix">',trData.userId?html+='\t<div class="comment-show-con-img pull-left cp" onclick="viewUser(\''+trData.userId+'\')"><img src="'+trData.userImg+'"></div>':html+='\t<div class="comment-show-con-img pull-left cp"><img src="'+trData.userImg+'"></div>',html+='\t<div class="comment-show-con-list pull-left clearfix">',html+='\t\t<div class="pl-text clearfix">',trData.userId?html+='\t\t\t<span class="comment-size-name"><span class="link-btn" onclick="viewUser(\''+trData.userId+"')\">"+trData.userName+'&nbsp;&nbsp;</span><span class="green-light">'+trData.operate+'</span><span class="">&nbsp;&nbsp;'+trData.objectName+"</span></span>":html+='\t\t\t<span class="comment-size-name"><span class="link-btn">'+trData.userName+'&nbsp;&nbsp;</span><span class="green-light">'+trData.operate+'</span><span class="">&nbsp;&nbsp;'+trData.objectName+"</span></span>",html+="\t\t</div>",html+='\t\t<div class="date-dz">',html+="\t\t\t<div>"+trData.remark+"</div>",html+='\t\t\t<span class="date-dz-left pull-left comment-time">'+trData.createdTime+"</span>",html+="\t\t</div>",html+="\t</div>",html+="</div>",i%5==0&&($operateContent.append(html),html="");$operateContent.append(html)}}})}}function loadTabTrCount(){var id=$("#id").val();id||(id=$("#objectId").val()),$.ajax({type:"post",url:"/getTabTrCount",data:{objectId:id,objectType:$("#objectType").val()},async:!1,success:function(cData){cData&&(cData=eval("("+cData+")"),"TSK"==$("#objectType").val()&&$("#childTask-count").text(cData.childTaskCount),$("#file-count").text(cData.fileCount),$("#operate-count").text(cData.operateCount))}})}