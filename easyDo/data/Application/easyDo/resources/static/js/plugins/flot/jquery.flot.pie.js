!function(e){var t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:function(s){var a=null,r=null,l=null,n=null,o=null,p=0,c=!0,h=10,d=.95,u=0,g=!1,f=[];function v(i,s,l,n){g||(g=!0,a=i.getCanvas(),r=e(a).parent(),t=i.getOptions(),i.setData(function(e){e=function(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:void 0!==e[t].data&&void 0!==e[t].data[0]||(void 0!==e[t].data&&void 0!==e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}(e),function(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(p+=i)}}(e);for(var i=0,s=0,a=t.series.pie.combine.color,r=[],l=0;l<e.length;++l)e[l].data[0][1]=parseFloat(e[l].data[0][1]),e[l].data[0][1]||(e[l].data[0][1]=0),e[l].data[0][1]/p<=t.series.pie.combine.threshold?(i+=e[l].data[0][1],s++,a||(a=e[l].color)):r.push({data:[[1,e[l].data[0][1]]],color:e[l].color,label:e[l].label,angle:e[l].data[0][1]*(2*Math.PI)/p,percent:e[l].data[0][1]/p*100});s>0&&r.push({data:[[1,i]],color:a,label:t.series.pie.combine.label,angle:i*(2*Math.PI)/p,percent:i/p*100});return r}(i.getData())))}function b(i,s){if(r){ctx=s,u=r.children().filter(".legend").children().width(),l=Math.min(a.width,a.height/t.series.pie.tilt)/2,o=a.height/2+t.series.pie.offset.top,n=a.width/2,"auto"==t.series.pie.offset.left?t.legend.position.match("w")?n+=u/2:n-=u/2:n+=t.series.pie.offset.left,n<l?n=l:n>a.width-l&&(n=a.width-l);for(var p=i.getData(),g=0;c&&g<h;)c=!1,g>0&&(l*=d),g+=1,f(),t.series.pie.tilt<=.8&&v(),b();g>=h&&(f(),r.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),i.setSeries&&i.insertLegend&&(i.setSeries(p),i.insertLegend())}function f(){ctx.clearRect(0,0,a.width,a.height),r.children().filter(".pieLabel, .pieLabelBackground").remove()}function v(){if(t.series.pie.radius>1)var e=t.series.pie.radius;else e=l*t.series.pie.radius;if(!(e>=a.width/2-5||e*t.series.pie.tilt>=a.height/2-15||e<=10)){ctx.save(),ctx.translate(5,15),ctx.globalAlpha=.02,ctx.fillStyle="#000",ctx.translate(n,o),ctx.scale(1,t.series.pie.tilt);for(var i=1;i<=10;i++)ctx.beginPath(),ctx.arc(0,0,e,0,2*Math.PI,!1),ctx.fill(),e-=i;ctx.restore()}}function b(){if(startAngle=Math.PI*t.series.pie.startAngle,t.series.pie.radius>1)var i=t.series.pie.radius;else i=l*t.series.pie.radius;ctx.save(),ctx.translate(n,o),ctx.scale(1,t.series.pie.tilt),ctx.save();for(var s=startAngle,h=0;h<p.length;++h)p[h].startAngle=s,d(p[h].angle,p[h].color,!0);ctx.restore(),ctx.save(),ctx.lineWidth=t.series.pie.stroke.width,s=startAngle;for(h=0;h<p.length;++h)d(p[h].angle,t.series.pie.stroke.color,!1);function d(t,a,r){t<=0||(r?ctx.fillStyle=a:(ctx.strokeStyle=a,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(t-2*Math.PI)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(t-=1e-4),ctx.arc(0,0,i,s,s+t,!1),ctx.closePath(),s+=t,r?ctx.fill():ctx.stroke())}ctx.restore(),w(ctx),t.series.pie.label.show&&function(){var i=startAngle;if(t.series.pie.label.radius>1)var s=t.series.pie.label.radius;else s=l*t.series.pie.label.radius;for(var h=0;h<p.length;++h)p[h].percent>=100*t.series.pie.label.threshold&&d(p[h],i,h),i+=p[h].angle;function d(i,l,p){if(0!=i.data[0][1]){var h,d=t.legend.labelFormatter,u=t.series.pie.label.formatter;h=d?d(i.label,i):i.label,u&&(h=u(h,i));var g=(l+i.angle+l)/2,f=n+Math.round(Math.cos(g)*s),v=o+Math.round(Math.sin(g)*s)*t.series.pie.tilt,b='<span class="pieLabel" id="pieLabel'+p+'" style="position:absolute;top:'+v+"px;left:"+f+'px;">'+h+"</span>";r.append(b);var x=r.children("#pieLabel"+p),w=v-x.height()/2,y=f-x.width()/2;if(x.css("top",w),x.css("left",y),(0-w>0||0-y>0||a.height-(w+x.height())<0||a.width-(y+x.width())<0)&&(c=!0),0!=t.series.pie.label.background.opacity){var P=t.series.pie.label.background.color;null==P&&(P=i.color);var M="top:"+w+"px;left:"+y+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+x.width()+"px;height:"+x.height()+"px;"+M+"background-color:"+P+';"> </div>').insertBefore(x).css("opacity",t.series.pie.label.background.opacity)}}}}(),ctx.restore()}}function w(e){t.series.pie.innerRadius>0&&(e.save(),innerRadius=t.series.pie.innerRadius>1?t.series.pie.innerRadius:l*t.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=t.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function P(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}function M(e){m("plothover",e)}function k(e){m("plotclick",e)}function m(e,i){var a=s.offset(),p=function(e,t){for(var i=s.getData(),a=s.getOptions(),r=a.series.pie.radius>1?a.series.pie.radius:l*a.series.pie.radius,p=0;p<i.length;++p){var c=i[p];if(c.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,r,c.startAngle,c.startAngle+c.angle,!1),ctx.closePath(),x=e-n,y=t-o,ctx.isPointInPath){if(ctx.isPointInPath(e-n,t-o))return ctx.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:p}}else if(p1X=r*Math.cos(c.startAngle),p1Y=r*Math.sin(c.startAngle),p2X=r*Math.cos(c.startAngle+c.angle/4),p2Y=r*Math.sin(c.startAngle+c.angle/4),p3X=r*Math.cos(c.startAngle+c.angle/2),p3Y=r*Math.sin(c.startAngle+c.angle/2),p4X=r*Math.cos(c.startAngle+c.angle/1.5),p4Y=r*Math.sin(c.startAngle+c.angle/1.5),p5X=r*Math.cos(c.startAngle+c.angle),p5Y=r*Math.sin(c.startAngle+c.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],P(arrPoly,arrPoint))return ctx.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:p};ctx.restore()}}return null}(parseInt(i.pageX-a.left),parseInt(i.pageY-a.top));if(t.grid.autoHighlight)for(var c=0;c<f.length;++c){var h=f[c];h.auto!=e||p&&h.series==p.series||A(h.series)}p&&function(e,t){"number"==typeof e&&(e=series[e]);var i=I(e);-1==i?(f.push({series:e,auto:t}),s.triggerRedrawOverlay()):t||(f[i].auto=!1)}(p.series,e);var d={pageX:i.pageX,pageY:i.pageY};r.trigger(e,[d,p])}function A(e){null==e&&(f=[],s.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var t=I(e);-1!=t&&(f.splice(t,1),s.triggerRedrawOverlay())}function I(e){for(var t=0;t<f.length;++t){if(f[t].series==e)return t}return-1}function X(e,t){var s=e.getOptions(),a=s.series.pie.radius>1?s.series.pie.radius:l*s.series.pie.radius;for(t.save(),t.translate(n,o),t.scale(1,s.series.pie.tilt),i=0;i<f.length;++i)r(f[i].series);function r(e){e.angle<0||(t.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,a,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill())}w(t),t.restore()}s.hooks.processOptions.push((function(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=3/4:t.series.pie.radius=1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(v),e.hooks.drawOverlay.push(X),e.hooks.draw.push(b))})),s.hooks.bindEvents.push((function(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(M);i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(k)}))},options:t,name:"pie",version:"1.0"})}(jQuery);