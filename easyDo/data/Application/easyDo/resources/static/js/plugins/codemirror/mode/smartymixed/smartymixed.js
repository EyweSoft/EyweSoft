!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],t):t(CodeMirror)}((function(t){"use strict";t.defineMode("smartymixed",(function(e){var l=t.getMode(e,"htmlmixed"),i=t.getMode(e,"smarty"),r={rightDelimiter:"}",leftDelimiter:"{"};function a(t){return t.replace(/[^\s\w]/g,"\\$&")}e.hasOwnProperty("leftDelimiter")&&(r.leftDelimiter=e.leftDelimiter),e.hasOwnProperty("rightDelimiter")&&(r.rightDelimiter=e.rightDelimiter);var n=a(r.leftDelimiter),o=a(r.rightDelimiter),m={smartyComment:new RegExp("^"+o+"\\*"),literalOpen:new RegExp(n+"literal"+o),literalClose:new RegExp(n+"/literal"+o),hasLeftDelimeter:new RegExp(".*"+n),htmlHasLeftDelimeter:new RegExp("[^<>]*"+n)},c=function(t,e,l){return e.tokenize=l,l(t,e)},h=function(t,e,l){return e.tokenize=null,e.localState=null,e.localMode=null,"string"==typeof l?l||null:l(t,e)},d=function(t,e,l){var i=t.current(),r=i.search(e);return r>-1?t.backUp(i.length-r):i.match(/<\/?$/)&&(t.backUp(i.length),t.match(e,!1)||t.match(i[0])),l},u={html:function(t,e){var a=e.htmlMixedState.htmlState.context&&e.htmlMixedState.htmlState.context.tagName?e.htmlMixedState.htmlState.context.tagName:null;return!e.inLiteral&&t.match(m.htmlHasLeftDelimeter,!1)&&null===a||!e.inLiteral&&t.match(r.leftDelimiter,!1)?(e.tokenize=u.smarty,e.localMode=i,e.localState=i.startState(l.indent(e.htmlMixedState,"")),d(t,r.leftDelimiter,i.token(t,e.localState))):l.token(t,e.htmlMixedState)},smarty:function(t,e){if(t.match(r.leftDelimiter,!1)){if(t.match(m.smartyComment,!1))return c(t,e,u.inBlock("comment","*"+r.rightDelimiter))}else if(t.match(r.rightDelimiter,!1))return t.eat(r.rightDelimiter),e.tokenize=u.html,e.localMode=l,e.localState=e.htmlMixedState,"tag";return d(t,r.rightDelimiter,i.token(t,e.localState))},inBlock:function(t,e){return function(l,i){for(;!l.eol();){if(l.match(e)){h(l,i,"");break}l.next()}return t}}};return{startState:function(){var t=l.startState();return{token:u.html,localMode:null,localState:null,htmlMixedState:t,tokenize:null,inLiteral:!1}},copyState:function(e){var r=null,a=e.tokenize||e.token;return e.localState&&(r=t.copyState(a!=u.html?i:l,e.localState)),{token:e.token,tokenize:e.tokenize,localMode:e.localMode,localState:r,htmlMixedState:t.copyState(l,e.htmlMixedState),inLiteral:e.inLiteral}},token:function(t,e){if(t.match(r.leftDelimiter,!1)){if(!e.inLiteral&&t.match(m.literalOpen,!0))return e.inLiteral=!0,"keyword";if(e.inLiteral&&t.match(m.literalClose,!0))return e.inLiteral=!1,"keyword"}return e.inLiteral&&e.localState!=e.htmlMixedState&&(e.tokenize=u.html,e.localMode=l,e.localState=e.htmlMixedState),(e.tokenize||e.token)(t,e)},indent:function(e,r){return e.localMode==i||e.inLiteral&&!e.localMode||m.hasLeftDelimeter.test(r)?t.Pass:l.indent(e.htmlMixedState,r)},innerMode:function(t){return{state:t.localState||t.htmlMixedState,mode:t.localMode||l}}}}),"htmlmixed","smarty"),t.defineMIME("text/x-smarty","smartymixed")}));