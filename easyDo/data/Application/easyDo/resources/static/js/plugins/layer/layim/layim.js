!function(a,i){var e,s,t={msgurl:"mailbox.html?msg=",chatlogurl:"mailbox.html?user=",aniTime:200,right:-232,api:{friend:"js/plugins/layer/layim/data/friend.json",group:"js/plugins/layer/layim/data/group.json",chatlog:"js/plugins/layer/layim/data/chatlog.json",groups:"js/plugins/layer/layim/data/groups.json",sendurl:""},user:{name:"游客",face:"img/a1.jpg"},autoReplay:["您好，我现在有事不在，一会再和您联系。","你没发错吧？","洗澡中，请勿打扰，偷窥请购票，个体四十，团体八折，订票电话：一般人我不告诉他！","你好，我是主人的美女秘书，有什么事就跟我说吧，等他回来我会转告他的。","我正在拉磨，没法招呼您，因为我们家毛驴去动物保护协会把我告了，说我剥夺它休产假的权利。","<（@￣︶￣@）>","你要和我说话？你真的要和我说话？你确定自己想说吗？你一定非说不可吗？那你说吧，这是自动回复。","主人正在开机自检，键盘鼠标看好机会出去凉快去了，我是他的电冰箱，我打字比较慢，你慢慢说，别急……","(*^__^*) 嘻嘻，是贤心吗？"],chating:{},hosts:(e=location.href.match(/\:\d+/),e=e?e[0]:"","http://"+document.domain+e+"/"),json:function(a,i,e,s){return $.ajax({type:"POST",url:a,data:i,dataType:"json",success:e,error:s})},stopMP:function(a){a?a.stopPropagation():a.cancelBubble=!0}},l=[$(window),$(document),$("html"),$("body")],n={};n.tabs=function(a){var i=n.node;i.tabs.eq(a).addClass("xxim_tabnow").siblings().removeClass("xxim_tabnow"),i.list.eq(a).show().siblings(".xxim_list").hide(),0===i.list.eq(a).find("li").length&&n.getDates(a)},n.renode=function(){n.node={tabs:$("#xxim_tabs>span"),list:$(".xxim_list"),online:$(".xxim_online"),setonline:$(".xxim_setonline"),onlinetex:$("#xxim_onlinetex"),xximon:$("#xxim_on"),layimFooter:$("#xxim_bottom"),xximHide:$("#xxim_hide"),xximSearch:$("#xxim_searchkey"),searchMian:$("#xxim_searchmain"),closeSearch:$("#xxim_closesearch"),layimMin:$("#layim_min")}},n.expend=function(){var a=n.node;"1"!==n.layimNode.attr("state")?n.layimNode.stop().animate({right:t.right},t.aniTime,(function(){a.xximon.addClass("xxim_off");try{localStorage.layimState=1}catch(a){}n.layimNode.attr({state:1}),a.layimFooter.addClass("xxim_expend").stop().animate({marginLeft:t.right},t.aniTime/2),a.xximHide.addClass("xxim_show")})):(n.layimNode.stop().animate({right:1},t.aniTime,(function(){a.xximon.removeClass("xxim_off");try{localStorage.layimState=2}catch(a){}n.layimNode.removeAttr("state"),a.layimFooter.removeClass("xxim_expend"),a.xximHide.removeClass("xxim_show")})),a.layimFooter.stop().animate({marginLeft:0},t.aniTime))},n.layinit=function(){var a=n.node;try{"1"===localStorage.layimState&&(n.layimNode.attr({state:1}).css({right:t.right}),a.xximon.addClass("xxim_off"),a.layimFooter.addClass("xxim_expend").css({marginLeft:t.right}),a.xximHide.addClass("xxim_show"))}catch(a){}},n.popchat=function(a){var i=n.node,e={success:function(s){layer.setMove(),n.chatbox=s.find("#layim_chatbox"),e.chatlist=n.chatbox.find(".layim_chatmore>ul"),e.chatlist.html('<li data-id="'+a.id+'" type="'+a.type+'"  id="layim_user'+a.type+a.id+'"><span>'+a.name+"</span><em>×</em></li>"),n.tabchat(a,n.chatbox),n.chatbox.find(".layer_setmin").on("click",(function(){s.attr("times");s.hide(),i.layimMin.text(n.nowchat.name).show()})),n.chatbox.find(".layim_close").on("click",(function(){var a=s.attr("times");layer.close(a),n.chatbox=null,t.chating={},t.chatings=0})),e.chatlist.on("mouseenter","li",(function(){$(this).find("em").show()})).on("mouseleave","li",(function(){$(this).find("em").hide()})),e.chatlist.on("click","li em",(function(a){var i,s=$(this).parent(),l=s.attr("type"),c=s.attr("data-id"),m=s.index(),o=e.chatlist.find("li");t.stopMP(a),delete t.chating[l+c],t.chatings--,s.remove(),$("#layim_area"+l+c).remove(),"group"===l&&$("#layim_group"+l+c).remove(),s.hasClass("layim_chatnow")&&(i=m===t.chatings?m-1:m+1,n.tabchat(t.chating[o.eq(i).attr("type")+o.eq(i).attr("data-id")])),1===e.chatlist.find("li").length&&e.chatlist.parent().hide()})),e.chatlist.on("click","li",(function(){var a=$(this),i=a.attr("type"),e=a.attr("data-id");n.tabchat(t.chating[i+e])})),e.sendType=$("#layim_sendtype"),e.sendTypes=e.sendType.find("span"),$("#layim_enter").on("click",(function(a){t.stopMP(a),e.sendType.show()})),e.sendTypes.on("click",(function(){e.sendTypes.find("i").text(""),$(this).find("i").text("√")})),n.transmit()}};e.html='<div class="layim_chatbox" id="layim_chatbox"><h6><span class="layim_move"></span>    <a href="'+a.url+'" class="layim_face" target="_blank"><img src="'+a.face+'" ></a>    <a href="'+a.url+'" class="layim_names" target="_blank">'+a.name+'</a>    <span class="layim_rightbtn">        <i class="layer_setmin">—</i>        <i class="layim_close">&times;</i>    </span></h6><div class="layim_chatmore" id="layim_chatmore">    <ul class="layim_chatlist"></ul></div><div class="layim_groups" id="layim_groups"></div><div class="layim_chat">    <div class="layim_chatarea" id="layim_chatarea">        <ul class="layim_chatview layim_chatthis"  id="layim_area'+a.type+a.id+'"></ul>    </div>    <div class="layim_tool">        <i class="layim_addface fa fa-meh-o" title="发送表情"></i>        <a href="javascript:;"><i class="layim_addimage fa fa-picture-o" title="上传图片"></i></a>        <a href="javascript:;"><i class="layim_addfile fa fa-paperclip" title="上传附件"></i></a>        <a href="" target="_blank" class="layim_seechatlog"><i class="fa fa-comment-o"></i>聊天记录</a>    </div>    <textarea class="layim_write" id="layim_write"></textarea>    <div class="layim_send">        <div class="layim_sendbtn" id="layim_sendbtn">发送<span class="layim_enter" id="layim_enter"><em class="layim_zero"></em></span></div>        <div class="layim_sendtype" id="layim_sendtype">            <span><i>√</i>按Enter键发送</span>            <span><i></i>按Ctrl+Enter键发送</span>        </div>    </div></div></div>',t.chatings<1?$.layer({type:1,border:[0],title:!1,shade:[0],area:["620px","493px"],move:".layim_chatbox .layim_move",moveType:1,closeBtn:!1,offset:[($(window).height()-493)/2+"px",""],page:{html:e.html},success:function(a){e.success(a)}}):(e.chatmore=n.chatbox.find("#layim_chatmore"),e.chatarea=n.chatbox.find("#layim_chatarea"),e.chatmore.show(),e.chatmore.find("ul>li").removeClass("layim_chatnow"),e.chatmore.find("ul").append('<li data-id="'+a.id+'" type="'+a.type+'" id="layim_user'+a.type+a.id+'" class="layim_chatnow"><span>'+a.name+"</span><em>×</em></li>"),e.chatarea.find(".layim_chatview").removeClass("layim_chatthis"),e.chatarea.append('<ul class="layim_chatview layim_chatthis" id="layim_area'+a.type+a.id+'"></ul>'),n.tabchat(a)),e.chatgroup=n.chatbox.find("#layim_groups"),"group"===a.type&&(e.chatgroup.find("ul").removeClass("layim_groupthis"),e.chatgroup.append('<ul class="layim_groupthis" id="layim_group'+a.type+a.id+'"></ul>'),n.getGroups(a)),e.chatgroup.on("click","ul>li",(function(){n.popchatbox($(this))}))},n.tabchat=function(a){n.node;var i={},e=a.type+a.id;n.nowchat=a,n.chatbox.find("#layim_user"+e).addClass("layim_chatnow").siblings().removeClass("layim_chatnow"),n.chatbox.find("#layim_area"+e).addClass("layim_chatthis").siblings().removeClass("layim_chatthis"),n.chatbox.find("#layim_group"+e).addClass("layim_groupthis").siblings().removeClass("layim_groupthis"),n.chatbox.find(".layim_face>img").attr("src",a.face),n.chatbox.find(".layim_face, .layim_names").attr("href",a.href),n.chatbox.find(".layim_names").text(a.name),n.chatbox.find(".layim_seechatlog").attr("href",t.chatlogurl+a.id),i.groups=n.chatbox.find(".layim_groups"),"group"===a.type?i.groups.show():i.groups.hide(),$("#layim_write").focus()},n.popchatbox=function(a){var i=n.node,e=a.attr("data-id"),s={id:e,type:a.attr("type"),name:a.find(".xxim_onename").text(),face:a.find(".xxim_oneface").attr("src"),href:"profile.html?user="+e},l=s.type+e;t.chating[l]?n.tabchat(s):(n.popchat(s),t.chatings++),t.chating[l]=s;var c=$("#layim_chatbox");c[0]&&(i.layimMin.hide(),c.parents(".xubox_layer").show())},n.getGroups=function(a){var i=a.type+a.id,e="",s=n.chatbox.find("#layim_group"+i);s.addClass("loading"),t.json(t.api.groups,{},(function(a){if(1===a.status){var i=0,t=a.data.length;if(t>0)for(;i<t;i++)e+='<li data-id="'+a.data[i].id+'" type="one"><img src="'+a.data[i].face+'" class="xxim_oneface"><span class="xxim_onename">'+a.data[i].name+"</span></li>";else e='<li class="layim_errors">没有群员</li>'}else e='<li class="layim_errors">'+a.msg+"</li>";s.removeClass("loading"),s.html(e)}),(function(){s.removeClass("loading"),s.html('<li class="layim_errors">请求异常</li>')}))},n.transmit=function(){var a=n.node,i={};a.sendbtn=$("#layim_sendbtn"),a.imwrite=$("#layim_write"),i.send=function(){var e={content:a.imwrite.val(),id:n.nowchat.id,sign_key:"",_:+new Date};if(""===e.content.replace(/\s/g,""))layer.tips("说点啥呗！","#layim_write",2),a.imwrite.focus();else{var s=n.nowchat.type+n.nowchat.id;i.html=function(a,i){return'<li class="'+("me"===i?"layim_chateme":"")+'"><div class="layim_chatuser">'+("me"===i?'<span class="layim_chattime">'+a.time+'</span><span class="layim_chatname">'+a.name+'</span><img src="'+a.face+'" >':'<img src="'+a.face+'" ><span class="layim_chatname">'+a.name+'</span><span class="layim_chattime">'+a.time+"</span>")+'</div><div class="layim_chatsay">'+a.content+'<em class="layim_zero"></em></div></li>'},i.imarea=n.chatbox.find("#layim_area"+s),i.imarea.append(i.html({time:"2014-04-26 0:37",name:t.user.name,face:t.user.face,content:e.content},"me")),a.imwrite.val("").focus(),i.imarea.scrollTop(i.imarea[0].scrollHeight),setTimeout((function(){i.imarea.append(i.html({time:"2014-04-26 0:38",name:n.nowchat.name,face:n.nowchat.face,content:t.autoReplay[Math.random()*t.autoReplay.length|0]})),i.imarea.scrollTop(i.imarea[0].scrollHeight)}),500)}},a.sendbtn.on("click",i.send),a.imwrite.keyup((function(a){13===a.keyCode&&i.send()}))},n.event=function(){var a=n.node;a.tabs.eq(0).addClass("xxim_tabnow"),a.tabs.on("click",(function(){var a=$(this).index();n.tabs(a)})),a.list.on("click","h5",(function(){var a=$(this),i=a.siblings(".xxim_chatlist"),e=a.find("i");e.hasClass("fa-caret-down")?(i.hide(),e.attr("class","fa fa-caret-right")):(i.show(),e.attr("class","fa fa-caret-down"))})),a.online.on("click",(function(i){t.stopMP(i),a.setonline.show()})),a.setonline.find("span").on("click",(function(i){var e=$(this).index();t.stopMP(i),0===e?(a.onlinetex.html("在线"),a.online.removeClass("xxim_offline")):1===e&&(a.onlinetex.html("隐身"),a.online.addClass("xxim_offline")),a.setonline.hide()})),a.xximon.on("click",n.expend),a.xximHide.on("click",n.expend),a.xximSearch.keyup((function(){""!==$(this).val().replace(/\s/g,"")?(a.searchMian.show(),a.closeSearch.show(),a.list.eq(3).html('<li class="xxim_errormsg">没有符合条件的结果</li>')):(a.searchMian.hide(),a.closeSearch.hide())})),a.closeSearch.on("click",(function(){$(this).hide(),a.searchMian.hide(),a.xximSearch.val("").focus()})),t.chatings=0,a.list.on("click",".xxim_childnode",(function(){var a=$(this);n.popchatbox(a)})),a.layimMin.on("click",(function(){$(this).hide(),$("#layim_chatbox").parents(".xubox_layer").show()})),l[1].on("click",(function(){a.setonline.hide(),$("#layim_sendtype").hide()}))},n.getDates=function(a){var i=[t.api.friend,t.api.group,t.api.chatlog],e=n.node.list.eq(a);e.addClass("loading"),t.json(i[a],{},(function(i){if(1===i.status){var s,t=0,l=i.data.length,n="";if(l>1){if(2!==a)for(;t<l;t++){n+='<li data-id="'+i.data[t].id+'" class="xxim_parentnode"><h5><i class="fa fa-caret-right"></i><span class="xxim_parentname">'+i.data[t].name+'</span><em class="xxim_nums">（'+i.data[t].nums+'）</em></h5><ul class="xxim_chatlist">',s=i.data[t].item;for(var c=0;c<s.length;c++)n+='<li data-id="'+s[c].id+'" class="xxim_childnode" type="'+(0===a?"one":"group")+'"><img src="'+s[c].face+'" class="xxim_oneface"><span class="xxim_onename">'+s[c].name+"</span></li>";n+="</ul></li>"}else{for(n+='<li class="xxim_liston"><ul class="xxim_chatlist">';t<l;t++)n+='<li data-id="'+i.data[t].id+'" class="xxim_childnode" type="one"><img src="'+i.data[t].face+'"  class="xxim_oneface"><span  class="xxim_onename">'+i.data[t].name+'</span><em class="xxim_time">'+i.data[t].time+"</em></li>";n+="</ul></li>"}e.html(n)}else e.html('<li class="xxim_errormsg">没有任何数据</li>');e.removeClass("loading")}else e.html('<li class="xxim_errormsg">'+i.msg+"</li>")}),(function(){e.html('<li class="xxim_errormsg">请求失败</li>'),e.removeClass("loading")}))},n.view=(s=n.layimNode=$('<div id="xximmm" class="xxim_main"><div class="xxim_top" id="xxim_top">  <div class="xxim_search"><i class="fa fa-search"></i><input id="xxim_searchkey" /><span id="xxim_closesearch">×</span></div>  <div class="xxim_tabs" id="xxim_tabs"><span class="xxim_tabfriend" title="好友"><i class="fa fa-user"></i></span><span class="xxim_tabgroup" title="群组"><i class="fa fa-users"></i></span><span class="xxim_latechat"  title="最近聊天"><i class="fa fa-clock-o"></i></span></div>  <ul class="xxim_list" style="display:block"></ul>  <ul class="xxim_list"></ul>  <ul class="xxim_list"></ul>  <ul class="xxim_list xxim_searchmain" id="xxim_searchmain"></ul></div><ul class="xxim_bottom" id="xxim_bottom"><li class="xxim_online" id="xxim_online"><i class="xxim_nowstate fa fa-check-circle"></i><span id="xxim_onlinetex">在线</span><div class="xxim_setonline"><span><i class="fa fa-check-circle"></i>在线</span><span class="xxim_setoffline"><i class="fa fa-check-circle"></i>隐身</span></div></li><li class="xxim_mymsg" id="xxim_mymsg" title="我的私信"><i class="fa fa-comment"></i><a href="'+t.msgurl+'" target="_blank"></a></li><li class="xxim_seter" id="xxim_seter" title="设置"><i class="fa fa-gear"></i><div></div></li><li class="xxim_hide" id="xxim_hide"><i class="fa fa-exchange"></i></li><li id="xxim_on" class="xxim_icon xxim_on fa fa-ellipsis-v"></li><div class="layim_min" id="layim_min"></div></ul></div>'),l[3].append(s),n.renode(),n.getDates(0),n.event(),void n.layinit())}(window);