var charsToEncode,entitiesToDecode,htmlEncodeRe,htmlDecodeRe,__defProp=Object.defineProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__publicField=(e,t,r)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,r),r),BrowserHelper=class{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const r=this;r._isLinux=Boolean(e.match(/Linux/)),r._isMac=Boolean(e.match(/Mac/)),r._isWindows=Boolean(e.match(/Win32/)),r._isWebkit=Boolean(t.match(/WebKit/)&&!t.match(/Edg/)),r._firefoxVersion=r.getVersion(t,/Firefox\/(\d+)\./),r._isFirefox=r._firefoxVersion>0,r._chromeVersion=r.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),r._isChrome=r._chromeVersion>0,r._isSafari=Boolean(t.match(/Safari/))&&!r._isChrome,r._isMobileSafari=Boolean(t.match(/Mobile.*Safari/)),r._safariVersion=r.getVersion(t,/Version\/(.*).Safari/),r._isAndroid=Boolean(t.match(/Android/g))}static get supportsOverflowClip(){if(null==this._supportsOverflowClip){const e=document.createElement("div");e.style.overflow="clip",e.style.display="none",document.documentElement.appendChild(e),this._supportsOverflowClip="clip"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("overflow"),e.remove()}return this._supportsOverflowClip}static get supportsSticky(){return!0}static getVersion(e,t){const r=e.match(t);return r?parseFloat(r[1]):0}static get isTouchDevice(){return void 0===this._isTouchDevice&&(this._isTouchDevice=globalThis.matchMedia("(pointer:coarse)").matches),this._isTouchDevice}static get isHoverableDevice(){return void 0===this._isHoverableDevice&&(this._isHoverableDevice=globalThis.matchMedia("(any-hover: hover)").matches),this._isHoverableDevice}static get isBrowserEnv(){return"undefined"!=typeof window}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isAndroid(){return this._isAndroid}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get safariVersion(){return this._safariVersion}static get isMobileSafari(){return this._isMobileSafari}static get platform(){const e=this;return e._isLinux?"linux":e._isMac?"mac":e._isWindows?"windows":e._isAndroid?"android":e._isMobileSafari?"ios":null}static get supportsPassive(){return!0}static get storageAvailable(){let e,t;try{return e=localStorage,t="__storage_test__",e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}static searchParam(e,t=null,r=document.location.search){const n=new RegExp("[?&]"+e+"=?([^&]*)"),i=r.match(n);return i&&i[1]||t}static getCookie(e){const t=encodeURIComponent(e)+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let n=r[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}return""}static download(e,t){const r=document.createElement("a");r.download=e,r.href=t||e,r.style.cssText="display:none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}static downloadBlob(e,t){const r=globalThis.URL.createObjectURL(e);this.download(t,r),globalThis.URL.revokeObjectURL(r)}static get queryString(){var e;const t=new URL(globalThis.location.href).searchParams;return null==(e=Object.fromEntries)?void 0:e.call(Object,t.entries())}static copyToClipboard(e){let t=!0;const r=document.createElement("textarea");r.value=e,r.style.height=r.style.width=0,document.body.appendChild(r),r.select();try{document.execCommand("copy")}catch(e){t=!1}return r.remove(),t}static isGanttOnline(e){return e=Array.isArray(e)?e:[e],!0}static get isCSP(){const{gantt:e,document:t}=globalThis;return null==e.CSP&&(e.CSP=Boolean(t.querySelector('meta[http-equiv="Content-Security-Policy"]'))),e.CSP}static async setupClipboard(){return globalThis.gantt.clipboard||(globalThis.gantt.clipboard={hasNativeAccess:!0,async writeText(e,t){if(t&&this.hasNativeAccess)try{await navigator.clipboard.writeText(e)}catch(e){this.hasNativeAccess=!1}this._content=e},async readText(e){if(e&&this.hasNativeAccess)try{return await navigator.clipboard.readText()}catch(e){this.hasNativeAccess=!1}return this._content}}),globalThis.gantt.clipboard}static get supportsRandomUUID(){if(void 0===this._supportsRandomUUID)try{this._supportsRandomUUID=Boolean(globalThis.crypto.randomUUID().length>0)}catch(e){this._supportsRandomUUID=!1}return this._supportsRandomUUID}static async writeToClipboard(e,t=!0){const r=await this.setupClipboard();return await r.writeText(e,t)}static async readFromClipboard(e=!0){const t=await this.setupClipboard();return await t.readText(e)}};__publicField(BrowserHelper,"supportsPointerEvents",Boolean(globalThis.PointerEvent||globalThis.MSPointerEvent)),__publicField(BrowserHelper,"supportsPointerEventConstructor","undefined"!=typeof PointerEvent),__publicField(BrowserHelper,"PointerEventConstructor",globalThis.PointerEvent||globalThis.CustomEvent),BrowserHelper.isBrowserEnv&&BrowserHelper.cacheFlags(),BrowserHelper._$name="BrowserHelper";var camelLettersRe=/([a-z])([A-Z])/g,crlfRe=/[\n\r]/g,escapeRegExpRe=/[.*+?^${}()|[\]\\]/g,htmlRe=/[&<]/,idRe=/(^[^a-z]+[^\w]+)/gi,whiteSpaceRe=/\s+/,domIdRe=/^[^a-z]+|[^\w:.-]+/gi,htmlDecoder=(e,t)=>entitiesToDecode[t.toLowerCase()]||String.fromCharCode(parseInt(t.substr(2),10)),htmlEncoder=(e,t)=>charsToEncode[t],hyphenateCamelLetters=(e,t,r)=>t+"-"+r.toLowerCase(),separateCamelLetters=(e,t,r)=>t+" "+r.toLowerCase(),replaceNonIdChar=e=>e?"_x"+[...e].map((e=>e.charCodeAt(0).toString(16))).join(""):"__blank__",hyphenateCache={},separatedCache={},_StringHelper=class{static capitalize(e){return e&&e[0].toUpperCase()+e.substr(1)}static uncapitalize(e){return e&&e[0].toLowerCase()+e.substr(1)}static hyphenate(e){const t=hyphenateCache[e];return t||(hyphenateCache[e]=e.replace(camelLettersRe,hyphenateCamelLetters))}static separate(e){const t=separatedCache[e];return t||(separatedCache[e]=this.capitalize(e.replace(camelLettersRe,separateCamelLetters)))}static createId(e){return String(e).replace(idRe,replaceNonIdChar)}static makeValidDomId(e,t=""){return null==e?null:String(e).replace(domIdRe,t)}static escapeRegExp(e,t){let r=e.replace(escapeRegExpRe,"\\$&");return void 0!==t&&(r=new RegExp(r,t)),r}static decodeHtml(e){return e&&String(e).replace(htmlDecodeRe,htmlDecoder)}static encodeHtml(e=""){return e&&String(e).replace(htmlEncodeRe,htmlEncoder)}static encodeHtmlBR(e){var t;return null==(t=_StringHelper.encodeHtml(e))?void 0:t.replace(crlfRe,"<br>")}static isHtml(e){return"string"==typeof e&&htmlRe.test(e||"")}static initHtmlEntities(e){e=e||{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};const t=Object.keys(e);charsToEncode=e,entitiesToDecode=t.reduce(((t,r)=>(t[e[r]]=r,t)),{}),htmlEncodeRe=new RegExp("(["+t.map((e=>"[-]".includes(e)?"\\"+e:e)).join("")+"])","g"),htmlDecodeRe=new RegExp("("+Object.values(e).join("|")+"|&#[0-9]+;)","ig")}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(e){}return t}static safeJsonStringify(e,t=null,r=null){let n=null;try{n=JSON.stringify(e,t,r)}catch(e){}return n}static joinPaths(e,t="/"){return e.join(t).replace(new RegExp("\\"+t+"+","g"),t)}static split(e,t=whiteSpaceRe){let r=e;return"string"==typeof r&&(r=e.trim(),r=r?r.split(t):[]),r}static xss(e,...t){const r=[];let n=t.length;for(r[n]=e[n];n-- >0;)r[n]=e[n]+_StringHelper.encodeHtml(t[n]);return r.join("")}static xssBR(e,...t){const r=[];let n=t.length;for(r[n]=e[n];n-- >0;)r[n]=e[n]+_StringHelper.encodeHtmlBR(t[n]);return r.join("")}static toJavaScriptValue(e,t){const r=Objects.typeOf(e);if("boolean"===r||"string"===r||"number"===r||null===e)return _StringHelper.safeJsonStringify(e);if(e===globalThis)return"window";if("date"===r)return"new Date("+e.getFullYear()+", "+e.getMonth()+", "+e.getDate()+", "+e.getHours()+", "+e.getMinutes()+", "+e.getSeconds()+", "+e.getMilliseconds()+")";if("array"===r)return"["+e.map((e=>_StringHelper.toJavaScriptValue(e,t)))+"]";if("object"===r||"instance"===r)return this.toJavaScriptString(e,t);if("function"===r){let t=e.toString();return t.match(/^async (\w+?)\(/)?t=t.replace(/^async (\w+?)\(/,"async function("):!t.startsWith("async(")&&t.match(/^(\w+?)\(/)&&(t=t.replace(/^(\w+?)\(/,"function(")),t}return"class"===r?e.toJavaScriptValue?e.toJavaScriptValue(t):Object.prototype.hasOwnProperty.call(e,"$name")?e.$name:e.name:void 0}static toJavaScriptString(e,t={}){var r;const n=null!=(r=t.level)?r:0;return"{\n"+Object.keys(e).map((r=>" ".repeat(2*(n+1))+(r.match(/[- *]/)?'"'+r+'"':r)+": "+_StringHelper.toJavaScriptValue(e[r],{...t,level:n+1}))).join(",\n")+"\n"+" ".repeat(2*n)+"}"}static encodeAttributeSelector(e,t){return"["+e+'="'+String(t).replace(/["\\]/g,"\\$&")+'"]'}static generateUUID(){var e;return BrowserHelper.supportsRandomUUID?globalThis.crypto.randomUUID():(null==(e=globalThis.crypto)?void 0:e.getRandomValues)?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^globalThis.crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))):Date.now()+"-"+ ++_StringHelper.fakeNodeUUIDIndex}},StringHelper=_StringHelper;__publicField(StringHelper,"fakeNodeUUIDIndex",0),StringHelper.initHtmlEntities(),StringHelper._$name="StringHelper";var{hasOwnProperty:hasOwnProperty2,toString:toString}=Object.prototype,{isFrozen:isFrozen}=Object,afterRe=/\s*<\s*/,beforeRe=/\s*>\s*/,blendOptions={},typeCache={},emptyObject=Object.freeze({}),Objects=class{static assign(e,...t){for(let r,n,i=0;i<t.length;i++)if(r=t[i],r)for(n in r)e[n]=r[n];return e}static assignIf(e,...t){for(let r,n,i=0;i<t.length;i++)if(r=t[i],r)for(n in r)n in e&&void 0!==e[n]||(e[n]=r[n]);return e}static blend(e,t,r){r=r||blendOptions,e=e||{};const{clone:n=Objects.clone,merge:i=Objects.blend}=r;if(Array.isArray(t)){if(t.length>1)return t.forEach((t=>{e=Objects.blend(e,t,r)})),e;t=t[0]}if(t){let s,a,o;for(a in t)o=t[a],o&&Objects.isObject(o)&&(s=e[a],r.key=a,s&&Objects.isObject(s)?(isFrozen(s)&&(e[a]=s=n(s,r)),o=i(s,o,r)):o=isFrozen(o)?o:n(o,r)),e[a]=o}return e}static clone(e,t){let r,n=e;if(e&&"object"==typeof e){if(t&&"object"==typeof t&&t&&(t=null),Objects.isObject(e))if(e.skipClone)n=e;else for(r in n={},e)n[r]=Objects.clone(e[r]);else if(Array.isArray(e))for(n=[],r=e.length;r-- >0;)n[r]=Objects.clone(e[r]);else Objects.isDate(e)?n=new Date(e.getTime()):t&&(n=t(e))}return n}static createTruthyKeys(e){const t=StringHelper.split(e),r=t&&{};if(t)for(const e of t)e&&(r[e]=!0);return r}static getPath(e,t){return t.split(".").reduce(((e,t)=>(e||emptyObject)[t]),e)}static getPathDefault(e,t,r){const n=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=n.length-1;return n.reduce(((e,t,n)=>(r&&!(t in e)&&(e[t]=n===i?r:{}),(e||emptyObject)[t])),e)}static hasPath(e,t){return t.split(".").every((t=>t in e&&(e=e[t],!0)))}static getTruthyKeys(e){const t=[];for(const r in e)e[r]&&t.push(r);return t}static getTruthyValues(e){const t=[];for(const r in e)e[r]&&t.push(e[r]);return t}static isClass(e){var t;return"function"==typeof e&&(null==(t=e.prototype)?void 0:t.constructor)===e}static isDate(e){return Boolean(null==e?void 0:e.getUTCDate)&&"date"===Objects.typeOf(e)}static isPromise(e){if(Promise&&Promise.resolve)return Promise.resolve(e)===e||"function"==typeof(null==e?void 0:e.then);throw new Error("环境错误")}static isEmpty(e){if(e&&"object"==typeof e)for(const t in e)return!1;return!0}static isObject(e){const t=null==e?void 0:e.constructor;return Boolean(t?t===Object||t.getPrototypeOf&&t.prototype&&!Object.getPrototypeOf(t.prototype):e&&"object"==typeof e)}static isInstantiated(e){return!!e&&("object"==typeof e&&!Objects.isObject(e))}static merge(e,...t){return Objects.blend(e,t)}static mergeItems(e,t,r){let n,i,s,a,o,l,c;r=r||blendOptions;const{merge:d=Objects.blend}=r;if(e=e||{},Array.isArray(t))t.forEach((t=>{e=Objects.overlayElement(e,t,r)}));else if(t)for(o in t)if(c=t[o],n=null,o.includes(">")?([o,n]=o.split(beforeRe),i=0):o.includes("<")&&([n,o]=o.split(afterRe),i=1),o in e)c&&e[o]&&d&&(r.key=o,c=d(e[o],c,r)),e[o]=c;else if(n){if(!a){a=new Map,s=0;for(const t in e)a.set(t,s++)}if(s=a.get(n),e[o]=c,null==s&&i)s=a.size;else{l=l||[],s=(s||0)+i;for(const e of a){const[t,r]=e;s<=r&&(l&&(l[a.size-r-1]=t),a.set(t,r+1))}if(l)for(;l.length;){const t=l.pop(),r=e[t];delete e[t],e[t]=r}}a.set(o,s)}else e[o]=c,null==a||a.set(o,a.size);return e}static setPath(e,t,r){return t.split(".").reduce(((e,t,n,i)=>n===i.length-1?e[t]=r:(e[t]instanceof Object||(e[t]={}),e[t])),e),e}static typeOf(e){let t,r;return null===e?r="null":e!=e?r="nan":(r=typeof e,"object"===r?e.isBase?r="instance":Array.isArray(e)?r="array":(r=typeCache[t=toString.call(e)])||(typeCache[t]=r=t.slice(8,-1).toLowerCase()):"function"===r&&e.isBase&&(r="class")),r}};Object.defineProperty(Objects,"hasOwn",{value:Object.hasOwn||((e,t)=>hasOwnProperty2.call(e,t))}),Objects._$name="Objects";var VersionHelper=class{static setVersion(e,t){e=e.toLowerCase(),VH[e]={version:t,isNewerThan:e=>VersionHelper.semanticCompareVersion(e,t,"<"),isOlderThan:e=>VersionHelper.semanticCompareVersion(e,t,">")};let r="";"undefined"!=typeof productName&&(r=productName);const n=r+"."+e+t.replace(/\./g,"-");if(BrowserHelper.isBrowserEnv&&!globalThis.gantt.silenceBundleException)if(!0===globalThis.gantt[n]){if(!this.isTestEnv){let t=r||e;"core"===t&&(t="grid");let n=StringHelper.capitalize(t);throw"schedulerpro"===t&&(n="SchedulerPro"),new Error("加载文件异常")}globalThis.BUNDLE_EXCEPTION=!0}else globalThis.gantt[n]=!0}static getVersion(e){if(e=e.toLowerCase(),!VH[e])throw new Error("版本异常");return VH[e].version}static semanticCompareVersion(e,t,r="="){t=t||"";const n=(e=e||"").split(/[-.]/),i=t.split(/[-.]/),s=r.includes("<"),a=(e,t)=>{const r=["rc","beta","alpha"],n=e.map((e=>{if(r.includes(e))return-r.indexOf(e)-2;const t=Number.parseInt(e);return Number.isNaN(t)?-r.length:t}));for(;n.length<t;)n.push(-1);return n},o=()=>{const e=Math.max(n.length,i.length),t=a(n,e),r=a(i,e);for(let n=0;n<e;n++)if(t[n]!==r[n])return s?t[n]<r[n]:t[n]>r[n];return!0};switch(r){case"=":return e===t;case"<=":case">=":return e===t||o();case"<":case">":return e!==t&&o()}return!1}static checkVersion(e,t,r){return VersionHelper.semanticCompareVersion(VH.getVersion(e),t,r)}static deprecate(e,t,r){if(!VH.checkVersion(e,t,"<"))throw new Error("弃用的API. "+r);console.warn("您正在使用弃用的API"+t+". "+r)}static get isTestEnv(){var e,t,r;const n=Boolean(null==(e=globalThis.gantt)?void 0:e.isTestEnv);try{return n||Boolean(null==(r=null==(t=globalThis.parent)?void 0:t.gantt)?void 0:r.isTestEnv)}catch(e){return n}}static get isDebug(){return!1}},VH=VersionHelper;BrowserHelper.isBrowserEnv&&(VH.isTestEnv&&(BrowserHelper._isHoverableDevice=!0),globalThis.gantt=Object.assign(globalThis.gantt||{},{getVersion:VH.getVersion.bind(VH),checkVersion:VH.checkVersion.bind(VH),deprecate:VH.deprecate.bind(VH),license:"%LICENSE%"})),VersionHelper._$name="VersionHelper";var{defineProperty:defineProperty,getOwnPropertyDescriptor:getOwnPropertyDescriptor}=Reflect,{hasOwnProperty:hasOwnProperty3,toString:toString2}=Object.prototype,instancePropertiesSymbol=Symbol("instanceProperties"),configuringSymbol=Symbol("configuring"),lazyConfigValues=Symbol("lazyConfigValues"),DATE_TYPE=toString2.call(new Date),whitespace=/\s+/,createClsProps=(e,t)=>(e[t]=1,e),Config=class{static get(e,t){const{cache:r}=this,n=r[e]||(r[e]=new Config(e));let i,s=n;return t&&(i=Config.makeCacheKey(e,t),(s=i&&r[i])||(s=n.extend(t),i&&(r[i]=s))),s}constructor(e){const t=this,r=e[0].toUpperCase()+e.substr(1);t.base=t,t.name=e,t.field="_"+e,t.capName=r,t.changer="change"+r,t.initializing="initializing"+r,t.updater="update"+r}get descriptor(){let e=this._descriptor;return e&&hasOwnProperty3.call(this,"_descriptor")||(this._descriptor=e=this.makeDescriptor()),e}get initDescriptor(){let e=this._initDescriptor;return e&&hasOwnProperty3.call(this,"_initDescriptor")||(this._initDescriptor=e=this.makeInitter()),e}equal(e,t){return e===t}extend(e){const t=Object.assign(Object.create(this),e),{equal:r,merge:n}=e,{equalityMethods:i}=Config;return"string"==typeof r&&(r.endsWith("[]")?t.equal=Config.makeArrayEquals(i[r.substr(0,r.length-2)]):t.equal=i[r]),"string"==typeof n&&(t.merge=Config.mergeMethods[n]),t}define(e){const t=getOwnPropertyDescriptor(e,this.name);let r=this.descriptor;t&&t.get&&(r=Object.assign({},r),r.get=t.get),defineProperty(e,this.name,r)}defineInitter(e,t){const{name:r}=this,n=e[instancePropertiesSymbol];let i,s;n[r]||!(s=getOwnPropertyDescriptor(e,r))||"value"in s||(n[r]=s),defineProperty(e,r,this.initDescriptor),this.lazy&&(i=e[lazyConfigValues]||(e[lazyConfigValues]=new Map),i.set(r,t))}static makeArrayEquals(e){return(t,r)=>{let n,i=t&&r&&t.length===(n=r.length);if(i&&Array.isArray(t)&&Array.isArray(r))if(e)for(;i&&n-- >0;)i=e(t[n],r[n]);else for(;i&&n-- >0;)i=t[n]===r[n];else i=e?e(t,r):t===r;return i}}static makeCacheKey(e,t){const r=Object.keys(t).sort();for(let e,n,i,s=r.length;s-- >0;)if(i=t[e=r[s]],null==i&&!1===i)r.splice(s,1);else{if(n=typeof i,"function"===n)return null;"string"===n?r[s]=e+':"'+i+'"':"number"===n&&(r[s]=e+":"+i)}return r.length?e+">"+r.join("|"):e}makeDescriptor(){const e=this,{base:t,field:r,changer:n,updater:i,name:s}=e;return t!==e&&t.equal===e.equal?t.descriptor:{get(){var e;return null==(e=this.configObserver)||e.get(s,this),this[r]},set(t){var a,o;const l=this;let c,d,u=l[r];if("string"==typeof t){let e=t;t.startsWith("up.")?e=null==(a=l.owner)?void 0:a.resolveProperty(t.substr(3)):t.startsWith("this.")&&(e=l.resolveProperty(t.substr(5))),void 0!==e&&"function"!=typeof e&&(t=e)}l[n]&&(c=void 0===(d=l[n](t,u)),c||(t=d,u=l[r])),c||(e.equal===equal?u===t:e.equal(u,t))||(l[r]=t,c=!0,null==(o=l[i])||o.call(l,t,u)),!c||l.isDestroyed||l.onConfigChange.$nullFn||l.onConfigChange({name:s,value:t,was:u,config:e})}}}makeInitter(){const e=this;return e!==e.base?e.lazy?e.makeLazyInitter():e.base.initDescriptor:e.makeBasicInitter()}makeBasicInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this;return e.removeInitter(n),n[t]=!0,n[r]=n[configuringSymbol][r],n[t]=!1,n.configDone[r]=!0,n[r]},set(t){e.removeInitter(this),this.configDone[r]=!0,this[r]=t}}}makeLazyInitter(){const e=this,{initializing:t,name:r}=e;return{configurable:!0,get(){const n=this,i=n[lazyConfigValues].get(r);return e.removeInitter(n),n.isDestroying||(n[t]=!0,n[r]=i,n[t]=!1),n[r]},set(t){e.removeInitter(this),this[r]=t}}}removeInitter(e){const{name:t}=this,r=e[instancePropertiesSymbol][t],n=e[lazyConfigValues];r?defineProperty(e,t,r):delete e[t],(null==n?void 0:n.delete(t))&&!n.size&&delete e[lazyConfigValues]}setDefault(e,t){defineProperty(e.prototype,this.field,{configurable:!0,writable:!0,value:t})}merge(e,t){if(t&&e&&Objects.isObject(e)){if(t.isBase)return t.setConfig(e);Objects.isObject(t)&&(e=Objects.merge(Objects.clone(t),e))}return e}},{prototype:prototype}=Config,{equal:equal}=prototype;Config.symbols={configuring:configuringSymbol,instanceProperties:instancePropertiesSymbol,lazyConfigs:lazyConfigValues},Config.cache=Object.create(null),Config.equalityMethods={array:Config.makeArrayEquals(),date:(e,t)=>e===t||!(!e||!t||toString2.call(e)!==DATE_TYPE||toString2.call(t)!==DATE_TYPE)&&e.getTime()===t.getTime(),strict:Config.equal=equal},Config.mergeMethods={distinct(e,t){let r=t?t.slice():[];if(null!=e)if(Objects.isObject(e))if(void 0===t)r=e;else{let t,n;for(t in e)n=r.indexOf(t),e[t]?n<0&&r.push(t):n>-1&&r.splice(n,1)}else Array.isArray(e)?e.forEach((e=>!r.includes(e)&&r.push(e))):r.includes(e)||r.push(e);return r},merge:Config.merge=prototype.merge,classList(e,t){if("string"==typeof e){if(!e.length)return t;e=e.split(whitespace)}return Array.isArray(e)&&(e=e.reduce(createClsProps,{})),Config.merge(e,t)},objects:(e,t)=>!0===e?t||{}:Config.merge(e,t),replace:e=>e,items:(e,t,r,n)=>n?Objects.mergeItems(t,e,{merge:(e,t)=>prototype.merge(t,e)}):prototype.merge(e,t)},Object.assign(prototype,{_descriptor:null,_initDescriptor:null,lazy:!1,nullify:!1,render:!1}),Config._$name="Config";var MetaClass=class{constructor(e){e&&Object.assign(this,e)}getInherited(e,t=!0){var r;let n=this[e];return e in this||(n=null==(r=this.super)?void 0:r.getInherited(e,t),(n||t)&&(this[e]=n=Object.create(n||null))),n}},{getPrototypeOf:getPrototypeOf}=Object,{hasOwn:hasOwn}=Objects,{defineProperty:defineProperty2}=Reflect,metaSymbol=Symbol("classMetaData"),mixinTagSymbol=Symbol("mixinTag"),originalConfigSymbol=Symbol("originalConfig"),createdAtSymbol=Symbol("createdAt"),configuringSymbol2=Config.symbols.configuring,instancePropertiesSymbol2=Config.symbols.instanceProperties,lazyConfigsSymbol=Config.symbols.lazyConfigs,defaultConfigOptions={merge:"replace",simple:!0},emptyFn=()=>{},newMeta=e=>new MetaClass(e),setupNames={},emptyObject2=Object.freeze({}),emptyArray=Object.freeze([]),Base=class{static get isBase(){return!0}get isBase(){return!0}static get declarable(){return["declarable","configurable","defaultConfig","properties","prototypeProperties"]}constructor(...e){const t=this,r=t.constructor;t.$meta.class!==r&&emptyFn(r.$meta),t.construct(...e),t.afterConstruct(),t.isConstructing=!1}static new(...e){return new this((e=e.filter((e=>e))).length>1?this.mergeConfigs(...e):e[0])}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}static destroy(...e){const t=e=>{(null==e?void 0:e.destroy)?e.destroy():Array.isArray(e)&&e.forEach(t)};t(e)}destroy(){const e=this,{id:t}=e;e.isDestroying=!0,e.destroy=emptyFn,e.doDestroy(),Object.setPrototypeOf(e,null);for(const t in e)"destroy"!==t&&"isDestroying"!==t&&delete e[t];delete e[originalConfigSymbol],e.isDestroyed=!0,e.id=t}_thisIsAUsedExpression(e){}static get $$name(){return hasOwn(this,"$name")&&this.$name||hasOwn(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,r=emptyArray){const{handler:n,thisObj:i}=this.resolveCallback(e,"this"===t?this:t)||emptyObject2;return null==n?void 0:n.apply(i,r)}resolveProperty(e){let t=this;for(;t;){if(Objects.hasPath(t,e))return Objects.getPath(t,e);t=t.owner}}resolveCallback(e,t=this,r=!0){if(null==e?void 0:e.substring){if(e.endsWith("?")&&(r=!1,e=e.substring(0,e.length-1)),e.startsWith("up.")){for(e=e.substring(3),t=this.owner;t&&!t[e];t=t.owner);if(!t)return}else e.startsWith("this.")&&(e=e.substring(5),t=this);if(!(t&&t instanceof Object))return;e=t[e]}if("function"==typeof e)return{handler:e,thisObj:t};if(r)throw new Error("No method named "+e+" on "+(t.$$name||"thisObj object"))}bindCallback(e,t=this){if(e){const{handler:r,thisObj:n}=this.resolveCallback(e,t);if(r)return r.bind(n)}}delay(e,t,r=e.name||e){e=this.setTimeout?e:e.bind(this);return(this.setTimeout?this:globalThis)["number"==typeof t?"setTimeout":"requestAnimationFrame"](e,t,r)}doDestroy(){const e=this,{nullify:t}=e.$meta;if(t)for(let r=0;r<t.length;++r)null!=e[t[r].field]&&(e[t[r].name]=null)}destroyProperties(...e){const t=this;let r,n;for(r of e)!(r in t)||t[configuringSymbol2]&&t[configuringSymbol2][r]||(n=t[r],(null==n?void 0:n.destroy)&&n.destroy(),delete t[r])}configure(e={}){const t=this,r=t.$meta,{beforeConfigure:n}=e,i=r.configs,s=t.getDefaultConfiguration();let a,o,l;for(o in t.initialConfig=e,t.isConfiguring=!0,Object.assign(t,t.getProperties()),e)l=e[o],a=i[o],s[o]=a?a.merge(l,s[o],null,r):l;n&&(delete s.beforeConfigure,n(t,s)),t.setConfig(t[originalConfigSymbol]=s,!0),t.isConfiguring=!1}getConfig(e){return this[e]}setConfig(e,t){var r;const n=this,i=n[configuringSymbol2],s=i?n.configDone:n.configDone={},a=n.$meta.configs;let o,l;for(l in n[instancePropertiesSymbol2]={},n[configuringSymbol2]=i?Object.setPrototypeOf(Object.assign({},e),i):e,e)null!=e[l]||hasOwn(e,l)?(o=a[l]||Config.get(l),o.defineInitter(n,e[l]),t||(s[l]=!1)):s[l]=!0;for(l in t&&n.startConfigure(e),e)s[l]||(null==(r=a[l])?void 0:r.lazy)||(n[l]=e[l]);return i?n[configuringSymbol2]=i:delete n[configuringSymbol2],t&&n.finishConfigure(e),n}hasConfig(e){var t;const r=this,n=r[configuringSymbol2];return Boolean(null!=r["_"+e]||null!=(null==(t=r[lazyConfigsSymbol])?void 0:t.get(e))||!r.configDone[e]&&n&&(null!=n[e]||hasOwn(n,e)))}peekConfig(e){const t=this,r=t[lazyConfigsSymbol],n=t[configuringSymbol2];if(null==r?void 0:r.has(e))return r.get(e);if(n&&e in n){if(t.configDone[e])return t[e];if(null!=n[e]||hasOwn(n,e))return n[e]}}triggerConfig(e){const t=this,{configDone:r}=t,n=t[lazyConfigsSymbol],i=t[configuringSymbol2],s=(null==n?void 0:n.has(e))||i&&(null!=i[e]||hasOwn(i,e))?!r[e]:null;return s&&t.getConfig(e),s}triggerConfigs(e){const t=this,r=t.$meta.configs,n=t[lazyConfigsSymbol],i=n?[...n.keys()].filter((t=>r[t].lazy===e)):emptyArray;for(const e of i)t.triggerConfig(e);return i.length?i:null}onConfigChange(){}get config(){const e={},t=this[originalConfigSymbol];for(const r in t)e[r]=t[r];return e}static processConfigValue(e,t){if(e===globalThis)return globalThis;if(Array.isArray(e))return e.map((e=>Base.shiftPrevious(e,t)));if(e instanceof Base){if(t.visited.has(e))return;return e.getCurrentConfig(t)}if(e instanceof HTMLElement||e instanceof DocumentFragment)return null;if(Objects.isObject(e)){const r={};for(const n in e)"owner"!==n&&(r[n]=Base.processConfigValue(e[n],t));return r}return e}getConfigValue(e,t){var r;const n=this,i=n[lazyConfigsSymbol];return(null==(r=n.$meta.configs[e])?void 0:r.lazy)?(null==i?void 0:i.has(e))?Base.processConfigValue(i.get(e),t):void 0:Base.processConfigValue(n[e],t)}preProcessCurrentConfigs(){}getCurrentConfig(e={}){const t=this,r="all"===e.configs?t.config:Objects.clone(t.initialConfig),n=e.visited||(e.visited=new Set),i=e.depth||(e.depth=0),s={};if(!n.has(t)){n.add(t),this.preProcessCurrentConfigs(r);for(const n in r){const r=t.getConfigValue(n,{...e,depth:i+1});void 0!==r&&(s[n]=r)}return s}}getConfigString(e={}){return StringHelper.toJavaScriptString(this.getCurrentConfig(e))}getTestCase(e={}){const t=this.isGantt?"Gantt":this.isSchedulerPro?"SchedulerPro":this.isCalendar?"Calendar":this.isScheduler?"Scheduler":this.isGrid?"Grid":this.isTaskBoard?"TaskBoard":null;if(t){const r=t.toLowerCase(),n="../../build/"+r+".module.js";let i,s;"static"===e.import?(i='import * as module from "'+n+'";Object.assign(window, module);',s=""):(i='import("'+n+'").then(module => { Object.assign(window, module);\n',s="});");const a=VersionHelper.getVersion(r);return a&&(i+="\nconsole.log('"+t+" "+a+"');\n"),i+"      \nconst "+r+" = new "+t+"("+this.getConfigString(e)+");\n"+s}}downloadTestCase(e={}){e.output="return";const t=this.getTestCase(e);BrowserHelper.download("app.js","data:application/javascript;charset=utf-8,"+escape(t))}static initClass(){return this.$meta.class}static get $meta(){const e=this;let t=e[metaSymbol];return hasOwn(e,metaSymbol)||(e[metaSymbol]=t=newMeta(),t.class=e,e.setupClass(t)),t}static onClassMixedIn(){}static mergeConfigs(e,...t){const r=this.$meta.configs,n=Objects.clone(e)||{};let i,s,a,o;for(s=0;s<t.length;++s)if(i=t[s],i)for(a in i)o=i[a],r[a]?o=r[a].merge(o,n[a]):n[a]&&o&&(o=Config.merge(o,n[a])),n[a]=o;return n}static mixin(...e){let t,r=this;for(t=0;t<e.length;++t){const n=e[t],i=n[mixinTagSymbol]||(n[mixinTagSymbol]=Symbol("mixinTag"));r[i]||(r=n(r),r[i]=!0,hasOwn(r,"onClassMixedIn")&&r.onClassMixedIn())}return r}static setupClass(e){var t;const r=e.class,n=getPrototypeOf(r).$meta,i=r.$$name,s=n.names,a=r.prototype;if(defineProperty2(a,"$meta",{value:e}),Object.assign(e,{super:n,config:Object.create(n.config),configs:Object.create(n.configs),declarables:n.declarables,forkConfigs:n.forkConfigs,hierarchy:Object.freeze([...n.hierarchy,r]),names:s.includes(i)?s:Object.freeze([...s,i]),properties:n.properties,nullify:null==(t=n.nullify)?void 0:t.slice()}),s!==e.names){const e="is"+i,t=t=>{hasOwn(t,e)||defineProperty2(t,e,{get:()=>(hasOwn("object"==typeof t?t.constructor:t,"$name")||console.warn("$name static property or getter required for class "+i+" to provide class name for minified sources."+(VersionHelper.isTestEnv,"")),!0)})};t(a),t(r)}for(let t,n,i=0;i<e.declarables.length;++i)t=e.declarables[i],hasOwn(r,t)&&(n=setupNames[t]||(setupNames[t]="setup"+StringHelper.capitalize(t)),r[n](r,e))}static setupConfigs(e,t,r){const n=e.config,i=e.configs,s=e.class,a=e.super;let o,l,c,d,u,h,{nullify:g}=e;for(const p in t)u=t[p],r?(o=i[p])?u=o.merge(u,n[p],e,a):o=Config.get(p,defaultConfigOptions):(l=c=d=void 0,u&&"object"==typeof u&&"$config"in u&&(c=u.$config,c&&!Objects.isObject(c)&&(c=Objects.createTruthyKeys(c)),d="default"in u,l=d?u.default:l,u=u.value),(o=i[p])?(h=o.nullify,c&&(o=o.extend(c)),u=o.merge(u,n[p],e,a)):(o=Config.get(p,c),o.define(s.prototype),d=!(o.field in s.prototype),h=!1),d&&o.setDefault(s,l),o.nullify&&!h&&(g||(g=e.nullify||(e.nullify=[]))).push(o)),u&&(Objects.isObject(u)||Array.isArray(u))&&!Object.isFrozen(u)&&(e.forkConfigs=!0),i[p]=o,n[p]=u}static setupConfigurable(e,t){e.setupConfigs(t,e.configurable,!1)}static setupDefaultConfig(e,t){e.setupConfigs(t,e.defaultConfig,!0)}static setupDeclarable(e,t){const r=e.declarable;let n,i,s=t.declarables;for(i=0;i<r.length;++i)s.includes(r[i])||(n||(t.declarables=n=s=s.slice()),s.push(r[i]))}static setupProperties(e,t){t.properties=t.super.properties.slice(),t.properties.push(e),Object.freeze(t.properties)}static setupPrototypeProperties(e){Object.assign(e.prototype,e.prototypeProperties)}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.$meta,t=e.forkConfigs?Base.fork(e.config):Object.create(e.config);if(VersionHelper.isTestEnv&&BrowserHelper.isBrowserEnv&&t.testConfig&&globalThis.__applyTestConfigs)for(const e in t.testConfig)t[e]=t.testConfig[e];return t}static fork(e){let t,r,n=e;if(e&&Objects.isObject(e)&&!Object.isFrozen(e))for(t in n=Object.create(e),e)r=e[t],r&&(Objects.isObject(r)?n[t]=Base.fork(r):Array.isArray(r)&&(n[t]=r.slice()));return n}getProperties(){const e=this.$meta.properties,t={};for(let r=0;r<e.length;r++)Object.assign(t,e[r].properties);return t}static get superclass(){return getPrototypeOf(this)}classHierarchy(e){const t=this.$meta.hierarchy,r=e?t.indexOf(e):0;return r>0?t.slice(r):t}static isOfTypeName(e){return this.$meta.names.includes(e)}detachListeners(e){let t=this.$detachers;if(t=null==t?void 0:t[e],t)for(;t.length;)t.pop()()}trackDetacher(e,t){const r=this.$detachers||(this.$detachers={});(r[e]||(r[e]=[])).push(t)}untrackDetachers(e){const t=this.$detachers;if(t)for(const r in t){const n=t[r];for(let t=n.length;t-- >0;)n[t].eventer===e&&n.splice(t,1)}}},proto=Base.prototype;proto.onConfigChange.$nullFn=emptyFn.$nullFn=!0,Base[metaSymbol]=proto.$meta=newMeta({class:Base,config:Object.freeze({}),configs:Object.create(null),declarables:Base.declarable,forkConfigs:!1,hierarchy:Object.freeze([Base]),names:Object.freeze(["Base"]),nullify:null,properties:Object.freeze([]),super:null}),Object.assign(proto,{$detachers:null,configObserver:null,isConstructing:!0,isDestroyed:!1,isDestroying:!1}),Base.emptyFn=emptyFn,VersionHelper.setVersion("core",""),Base._$name="Base";var ArrayHelper=class{static clean(e){return e.reduce(((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e)),[])}static from(e,t,r){const n=[];if(e)for(const i of e)t&&!t(i)||n.push(r?r(i):i);return n}static remove(e,...t){let r,n,i=!1;t=t[0]instanceof Set?[...t[0]]:t;for(let s=0;s<t.length;s++)n=t[s],-1!==(r=e.indexOf(n))&&(e.splice(r,1),i=!0);return i}static findInsertionIndex(e,t,r=this.lexicalCompare,n){const i=t.length;let s,a;return n<i&&(s=n>0?r(t[n-1],e):0,a=n<i-1?r(e,t[n]):0,s<1&&a<1)?n:this.binarySearch(t,e,r)}static findLast(e,t,r){for(let{length:n}=e,i=n-1;i>=0;i--)if(t.call(r,e[i],i,e))return e[i]}static binarySearch(e,t,r=0,n=e.length,i=this.lexicalCompare){const s=e.length;let a,o;for(r instanceof Function?(i=r,r=0):n instanceof Function&&(i=n,n=s),--n;r<=n;)a=r+n>>1,o=i(t,e[a]),o>=0?r=a+1:o<0&&(n=a-1);return r}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},r=null){const n=[],i=Array.isArray(t)?t:[t];for(let t=0;t<e;t++)for(const e of i){const i=Object.assign({},e);r&&r(i,t),n.push(i)}return n}static populate(e,t,r=!1){const n=[];for(let i=0;i<e;i++)n.push(t(i+(r?1:0)));return n}static include(e,...t){for(const r of t)e.includes(r)||e.push(r)}static unique(e){return[...new Set(e)]}static allowNegative(e){return new Proxy(e,{get(e,t,r){if("string"!=typeof t)return Reflect.get(e,t,r);const n=Number(t);return Number.isNaN(n)?Reflect.get(e,t,r):e[n<0?e.length+n:n]},set(e,t,r,n){if("string"!=typeof t)return Reflect.set(e,t,r,n);const i=Number(t);return Number.isNaN(i)?Reflect.set(e,t,r,n):(e[i<0?e.length+i:i]=r,!0)}})}static delta(e,t,r=!1){if(!t)return r?{toAdd:e,toRemove:[],toKeep:[]}:{onlyInA:e,onlyInB:[],inBoth:[]};const n=[],i=[],s=new Set,a=new Set(t);for(let t=0;t<e.length;t++){const r=e[t];a.has(r)?s.add(r):n.push(r)}for(let e=0;e<t.length;e++){const r=t[e];s.has(r)||i.push(r)}return r?{toAdd:n,toRemove:i,toKeep:s}:{onlyInA:n,onlyInB:i,inBoth:[...s]}}static asArray(e){return null==e?e:e instanceof Set?Array.from(e):Array.isArray(e)?e:[e]}static identity(e){return e}static keyBy(e,t,r=ArrayHelper.identity){const n="string"==typeof t?e=>null==e?void 0:e[t]:t,i="string"==typeof r?e=>null==e?void 0:e[r]:r;return e.reduce(((e,t)=>(e[n(t)]=i(t),e)),{})}static groupBy(e,t){const r="string"==typeof t?e=>null==e?void 0:e[t]:t;return e.reduce(((e,t)=>{const n=r(t);return(e[n]=e[n]||[]).push(t),e}),{})}};ArrayHelper._$name="ArrayHelper";var commaSepRe=/,\s*/,decompiledSym=Symbol("decompiled"),fnRe1=/^\s*(async\s+)?([a-z_]\w*)\s*=>([\s\S]+)$/i,fnRe2=/^\s*(async\s*)?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)\s+=>([\s\S]+)$/i,fnRe3=/^(\s*async)?(?:\s*function)?(?:\s*([a-z_]\w*))?\s*\(((?:[a-z_]\w*(?:, [a-z_]\w*)*)?)\)([\s\S]+)$/i,{hasOwnProperty:hasOwnProperty4}=Object.prototype,FunctionHelper=class{static after(e,t,r,n,i){const s="string"==typeof r,a=!1!==(null==i?void 0:i.return),o=(...t)=>{const i=o.$nextHook.call(e,...t),l=(null==n?void 0:n.isDestroyed)?void 0:a?s?n[r](i,...t):r.call(n,i,...t):s?n[r](...t):r.call(n,...t);return void 0===l?i:l};return FunctionHelper.hookMethod(e,t,o)}static before(e,t,r,n){const i="string"==typeof r,s=(...t)=>{const a=(null==n?void 0:n.isDestroyed)?0:i?n[r](...t):r.call(n,...t);return!1===a?a:s.$nextHook.call(e,...t)};return FunctionHelper.hookMethod(e,t,s)}static curry(e){return function t(...r){return r.length>=e.length?e.apply(this,r):function(...e){return t.apply(this,r.concat(e))}}}static bindAll(e){for(const t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,r){return function(...n){const i=r||this;return!1!==t.call(i,...n)&&e.call(i,...n)}}static createSequence(e,t,r){return(...n)=>{const i=e.call(r,...n),s=t.call(r,...n);return void 0===s?i:s}}static createThrottled(e,t,r,n,i){let s,a,o=-Number.MAX_VALUE;const l=()=>{a=0,o=performance.now(),s.push.apply(s,n),e.apply(r,s)},c=function(...e){const c=performance.now()-o;s=e,c>=t?(clearTimeout(a),l()):(a||(a=setTimeout(l,t-c)),i&&(s.push.apply(s,n),i.apply(r,s)))};return c.cancel=()=>clearTimeout(a),c}static createBuffered(e,t,r,n){let i,s;const a=()=>{s=0,o.isPending=!1,i.push.apply(i,n),e.apply(r,i)},o=function(...e){i=e,s&&clearTimeout(s),o.isPending=!0,s=setTimeout(a,t)};return o.cancel=()=>{o.isPending=!1,clearTimeout(s)},o}static decompile(e){if(!(decompiledSym in e)){const t=e.toString();let r,n,i,s,a,o=fnRe1.exec(t);o?(r=[o[2]],n=o[3]):(o=fnRe2.exec(t))?(a=o[2].trim(),r=a?a.split(commaSepRe):[],n=o[3]):(o=fnRe3.exec(t))&&(i=o[2],a=o[3].trim(),r=a?a.split(commaSepRe):[],n=o[4]),n=null==n?void 0:n.trim(),e[decompiledSym]=s=o&&{args:r,async:Boolean(o[1]),body:(null==n?void 0:n.startsWith("{"))?n.substring(1,n.length-1).trim():n},i&&(s.name=i)}return e[decompiledSym]}static hookMethod(e,t,r){return r.$nextHook=e[t],e[t]=r,()=>{var n;if(hasOwnProperty4.call(e,t)){let i,s=e[t];if(s===r)(null==(n=Object.getPrototypeOf(e))?void 0:n[t])===r.$nextHook?delete e[t]:e[t]=r.$nextHook;else for(;i=null==s?void 0:s.$nextHook;s=i)if(i===r){s.$nextHook=r.$nextHook;break}}}}static noThrow(e,t,r){const n=e[t];e[t]=(...t)=>{try{return n.apply(e,t)}catch(e){return null==r?void 0:r(e)}}}static returnTrue(){return!0}static animate(e,t,r,n="linear"){let i=!1;const s=new Promise((s=>{const a=performance.now(),o=()=>{const l=Math.min((performance.now()-a)/e,1),c=r&&r.setTimeout?r:globalThis;i||!1===t.call(r,this.easingFunctions[n](l))&&s(),i||1===l?c.requestAnimationFrame((()=>s())):c.requestAnimationFrame(o)};o()}));return s.cancel=()=>(i=!0,!1),s}},half=.5,e1=1.70158,e2=7.5625,e3=1.525,e4=2/2.75,e5=2.25/2.75,e6=1/2.75,e7=1.5/2.75,e8=2.5/2.75,e9=2.625/2.75,e10=.75,e11=.9375,e12=.984375,s1=1.70158,s2=1.70158;FunctionHelper.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=half)<1?half*Math.pow(e,2):-half*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=half)<1?half*Math.pow(e,3):half*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=half)<1?half*Math.pow(e,4):-half*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=half)<1?half*Math.pow(e,5):half*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-half*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=half)<1?half*Math.pow(2,10*(e-1)):half*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=half)<1?-half*(Math.sqrt(1-e*e)-1):half*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+e10:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,easeInBack:e=>e*e*((e1+1)*e-e1),easeOutBack:e=>(e-=1)*e*((e1+1)*e+e1)+1,easeInOutBack:e=>{let t=s1;return(e/=half)<1?half*(e*e*((1+(t*=e3))*e-t)):half*((e-=2)*e*((1+(t*=e3))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=s2;return(e/=half)<1?half*(e*e*((1+(t*=e3))*e-t)):half*((e-=2)*e*((1+(t*=e3))*e+t)+2)},swingFrom:e=>e*e*((e1+1)*e-e1),swingTo:e=>(e-=1)*e*((e1+1)*e+e1)+1,bounce:e=>e<e6?e2*e*e:e<e4?e2*(e-=e7)*e+e10:e<e8?e2*(e-=e5)*e+e11:e2*(e-=e9)*e+e12,bouncePast:e=>e<e6?e2*e*e:e<e4?2-(e2*(e-=e7)*e+e10):e<e8?2-(e2*(e-=e5)*e+e11):2-(e2*(e-=e9)*e+e12),easeFromTo:e=>(e/=half)<1?half*Math.pow(e,4):-half*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},FunctionHelper._$name="FunctionHelper";var{isArray:isArray}=Array,{hasOwnProperty:hasOwnProperty5}=Object.prototype,specialProperties={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,expires:1,buffer:1,throttle:1,name:1,$internal:1},priorityComparator=(e,t)=>t.prio-e.prio,Events_default=e=>class t extends(e||Base){constructor(){super(...arguments),__publicField(this,"eventsSuspended",null)}static get $name(){return"Events"}static get declarable(){return["deprecatedEvents"]}static setupDeprecatedEvents(e,t){const r=t.getInherited("deprecatedEvents"),n=e.deprecatedEvents;for(const e in n)r[e.toLowerCase()]=r[e]=n[e]}static get configurable(){return{listeners:{value:null,$config:{merge(e,t){if(null!==e){if(!e)return t;t&&(e=e?[e]:[]).push[isArray(t)?"apply":"call"](e,t)}return e}}},internalListeners:null,bubbleEvents:null}}destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(e,...t){(this.configuredListeners=null==e?void 0:e.listeners)&&delete(e=Objects.assign({},e)).listeners,super.construct(e,...t),this.processConfiguredListeners()}processConfiguredListeners(){if(this.configuredListeners){const e=this,{isConfiguring:t}=e;e.isConfiguring=!1,e.listeners=e.configuredListeners,e.configuredListeners=null,e.isConfiguring=t}}doDestroy(){this.trigger("destroy"),this.removeAllListeners(!1),super.doDestroy()}static setupClass(e){super.setupClass(e),t.prototype.onListen.$nullFn=!0,t.prototype.onUnlisten.$nullFn=!0}addListener(e,t,r){if(isArray(e)){for(let r=0,{length:n}=e;r<n;r++)this.addListener(e[r],t);return}const n=this,i=n.$meta.getInherited("deprecatedEvents");if("string"==typeof e)return n.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:r});{t=e.thisObj=void 0!==e.thisObj?e.thisObj:t;for(const r in e)if(!specialProperties[r]&&null!=e[r]){const s=r.toLowerCase(),a=null==i?void 0:i[s],o=n.eventListeners||(n.eventListeners={}),l=e[r],c=l.expires||e.expires,d={fn:"object"==typeof l?l.fn:l,thisObj:void 0!==l.thisObj?l.thisObj:t,args:l.args||e.args,prio:void 0!==l.prio?l.prio:void 0!==e.prio?e.prio:0,once:void 0!==l.once?l.once:void 0!==e.once&&e.once,buffer:l.buffer||e.buffer,throttle:l.throttle||e.throttle,$internal:e.$internal,catchAll:"catchAll"===r};if(a){const{product:e,invalidAsOfVersion:t,message:r}=a;VersionHelper.deprecate(e,t,r)}if(c){const{alt:i}=c,a=i?c.delay:c,o=e.name||r,l=()=>{n.un(s,d),i&&!d.called&&n.callback(i,t)};n.isDelayable?n.setTimeout({fn:l,name:o,cancelOutstanding:!0,delay:a}):globalThis.setTimeout(l,a)}let u=o[s]||(o[s]=[]);u.$firing&&(o[s]=u=u.slice()),u.splice(ArrayHelper.findInsertionIndex(d,u,priorityComparator,u.length),0,d),!n.onListen.$nullFn&&u.length<2&&n.onListen(s)}e.relayAll&&n.relayAll(e.relayAll),t&&t!==n&&n.attachAutoDetacher(e,t);const r=!1!==e.detachable,s=e.name,a=e.expires||r||s?()=>{n.isDestroyed||n.removeListener(e,t)}:null;if(a&&(a.eventer=n,a.listenerName=s,s&&(null==t?void 0:t.trackDetacher)&&t.trackDetacher(s,a),e.expires&&n.delay(a,isNaN(e.expires)?e.expires.delay:e.expires,s),r))return a}}on(e,t,r){return this.addListener(e,t,r)}ion(e){return e.$internal=!0,this.on(e)}un(...e){this.removeListener(...e)}updateInternalListeners(e,t){null==t||t.detach(),e&&(e.detach=this.ion(e))}get listeners(){return this.eventListeners}changeListeners(e){if(!this.isConfiguring){if(Array.isArray(e))for(let t=0,r=e[0],{length:n}=e;t<n;r=e[++t])"thisObj"in r||(e[t]=Objects.assign({thisObj:this},r));else e&&!("thisObj"in e)&&(e=Objects.assign({thisObj:this},e));return e}this.getConfig("internalListeners"),e&&this.on(e,this)}updateListeners(e,t){t&&this.un(t),e&&this.on(e)}removeListener(e,t=e.thisObj,r){const n=this;if("string"==typeof e)return n.removeListener({[e]:t},r);Object.entries(e).forEach((([e,r])=>{if(!specialProperties[e]&&null!=r){e=e.toLowerCase();const i=n.eventListeners,s=n.findListener(e,r,t);if(s>=0){let t=i[e];t.length>1?(t.$firing&&(i[e]=t=t.slice()),t.splice(s,1)):(delete i[e],n.onUnlisten.$nullFn||n.onUnlisten(e))}}})),e.thisObj&&!e.thisObj.isDestroyed&&n.detachAutoDetacher(e)}findListener(e,t,r){var n;const i=null==(n=this.eventListeners)?void 0:n[e],s=t.fn||t,a=t.thisObj||r;if(i)for(let e,t=0,{length:r}=i;t<r;t++)if(e=i[t],e.fn===s&&e.thisObj===a)return t;return-1}hasListener(e){var t;return Boolean(null==(t=this.eventListeners)?void 0:t[null==e?void 0:e.toLowerCase()])}relayAll(e,t,r=!0){this.relayAllTargets||(this.relayAllTargets=[]);const n=this.relayAllTargets;e.on({beforeDestroy:({source:t})=>{if(t===e){n.filter((t=>t.through===e)).forEach((e=>ArrayHelper.remove(n,e)))}}}),n.push({through:e,prefix:t,transformCase:r})}removeAllListeners(e=!0){var t;const r=this.eventListeners;let n,i;for(const s in r){const a=r[s];for(n=a.length;n-- >0;){const r=a[n];r.$internal&&e||(this.removeListener(s,r),i=r.thisObj,null==(t=null==i?void 0:i.untrackDetachers)||t.call(i,this))}}}relayEvents(e,t,r=""){const n={detachable:!0,thisObj:this};return t.forEach((e=>{n[e]=(t,...n)=>this.trigger(r+e,t,...n)})),e.on(n)}onListen(){}onUnlisten(){}destructorInterceptor(){const{autoDetachers:e,target:t,oldDestructor:r}=this;for(let r=0;r<e.length;r++){const{dispatcher:n,config:i}=e[r];n.isDestroyed||n.removeListener(i,t)}r.call(t)}attachAutoDetacher(e,t){const r=e.thisObj||t,n="doDestroy"in r?"doDestroy":"destroy";if(n in r){let{$autoDetachers:t}=r;t||(r.$autoDetachers=t=[]),r.$oldDestructor||(r.$oldDestructor=r[n],r[n]=this.destructorInterceptor.bind({autoDetachers:t,oldDestructor:r.$oldDestructor,target:r})),t.push({config:e,dispatcher:this})}else r[n]=()=>{this.removeListener(e)}}detachAutoDetacher(e){const t=e.thisObj;t.$oldDestructor&&!t.isDestroying&&(ArrayHelper.remove(t.$autoDetachers,t.$autoDetachers.find((t=>t.config===e&&t.dispatcher===this))),t.$autoDetachers.length||(t["doDestroy"in t?"doDestroy":"destroy"]=t.$oldDestructor,t.$oldDestructor=null))}await(e,t={checkLog:!0,resetLog:!0,args:null}){const r=this;!1===t&&(t={checkLog:!1});const{args:n}=t;return new Promise((i=>{var s;if(t.checkLog&&(null==(s=r._triggered)?void 0:s[e])&&(i(),t.resetLog&&r.clearLog(e)),n){const s=r.on({[e]:(...a)=>{Object.keys(n).every((e=>e in a[0]&&a[0][e]===n[e]))&&(i(...a),t.resetLog&&r.clearLog(e),s())},prio:-1e4})}else r.on({[e]:(...n)=>{i(...n),t.resetLog&&r.clearLog(e)},prio:-1e4,once:!0})}))}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}trigger(e,t){var r,n,i,s;const a=this,o=e.toLowerCase(),{eventsSuspended:l,relayAllTargets:c,callOnFunctions:d}=a;let u,h,g=null==(r=a.eventListeners)?void 0:r[o];if(a._triggered||(a._triggered={}),a._triggered[e]=!0,l)return l.shouldQueue&&l.queue.push(arguments),!0;if((null==(n=a.eventListeners)?void 0:n.catchall)&&((g=g?g.slice():[]).push(...a.eventListeners.catchall),g.sort(priorityComparator)),!g&&!c&&!d)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=a:t=Object.setPrototypeOf({source:a},t)):t={source:a},t.type!==o&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>o}):t.type=o),t.eventName=e,!("bubbles"in t)&&(null==(i=a.bubbleEvents)?void 0:i[e])&&(t.bubbles=a.bubbleEvents[e]),d){const r="on"+StringHelper.capitalize(e);if(r in a){const e=!a[r]||a.callback(a[r],a,[t]);let n;if(Objects.isPromise(e)?(u||(u=[])).push(e):n=!1===e||n,!a.isDestroyed&&hasOwnProperty5.call(a,r)&&!(null==(s=a.pluginFunctionChain)?void 0:s[r])){const e=Object.getPrototypeOf(a);if(r in e){const i=e[r].call(a,t);if(Objects.isPromise(i)?(u||(u=[])).push(i):n=!1===i||n,a.isDestroyed)return}}if(n)return!1}}if(g){let e=0,r=!1;for(g.$firing=!0;e<g.length&&!a.isDestroyed&&!r;e++){const n=g[e];if(!1===h&&!n.$internal)continue;let i,s=n.thisObj;if(!s||!s.isDestroyed){if(n.called=!0,n.once&&a.removeListener(o,n),"string"==typeof n.fn){if(s&&(i=s[n.fn]),!i){const e=a.resolveCallback(n.fn);i=e.handler,s=e.thisObj}}else i=n.fn;if(n.buffer){if(!n.bufferFn){const e=Number(n.buffer);if("number"!=typeof e||isNaN(e))throw new Error('Incorrect type for buffer, got "'+e+'" (expected a Number)');n.bufferFn=FunctionHelper.createBuffered(i,e,s,n.args)}i=n.bufferFn}if(n.throttle){const e=Number(n.throttle);if("number"!=typeof e||isNaN(e))throw new Error("类型不正确，为“"+e+"”（应为数字）");n.throttledFn||(n.throttledFn=FunctionHelper.createThrottled(i,e,s,n.args)),i=n.throttledFn}const e=i.call(s||a,...n.args||[],t);!1!==h&&(h=e),n.$internal&&!1===e&&(r=!0),Objects.isPromise(e)&&(e.$internal=n.$internal,(u||(u=[])).push(e))}}if(g.$firing=!1,r)return!1}return null==c||c.forEach((r=>{let n=e;if(r.transformCase&&(n=StringHelper.capitalize(n)),r.prefix&&(n=r.prefix+n),!1===r.through.trigger(n,t))return!1})),t.bubbles&&a.owner&&!a.owner.isDestroyed?a.owner.trigger(e,t):(u=null==u?void 0:u.filter((e=>!1!==h||e.$internal)),(null==u?void 0:u.length)?new Promise((e=>{Promise.all(u).then((t=>{const r=!t.some((e=>!1===e));e(r)}))})):!1!==h)}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(const t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}},AsyncHelper=class{static animationFrame(){return new Promise((e=>{requestAnimationFrame(e)}))}static sleep(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}static yield(){return Promise.resolve()}};AsyncHelper._$name="AsyncHelper";var paramValueRegExp=/^(\w+)=(.*)$/,parseParams=function(e){const t={},r=e.split("&");for(const e of r){const[r,n,i]=paramValueRegExp.exec(e),s=decodeURIComponent(n),a=decodeURIComponent(i);if(r){let e=t[s];e?(Array.isArray(e)||(e=t[s]=[e]),e.push(a)):t[s]=a}}return t},_AjaxHelper=class{static get(e,t){return this.fetch(e,t)}static post(e,t,r={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json"),this.fetch(e,Object.assign({method:"POST",body:t},r))}static fetch(e,t){let r;if(t=Objects.merge({},_AjaxHelper.DEFAULT_FETCH_OPTIONS,t),"undefined"!=typeof AbortController&&(r=t.abortController=new AbortController,t.signal=r.signal),"credentials"in t||(t.credentials="include"),t.queryParams){const r=Object.entries(t.queryParams);if(r.length){let n=!1;if(t.headers&&!0===t.addQueryParamsToBody){let e;switch(new Headers(t.headers).get("Content-Type")){case"application/x-www-form-urlencoded":e=URLSearchParams;break;case"multipart/form-data":e=FormData}if(e){const i=t.body||(t.body=new e);i instanceof e&&(r.forEach((([e,t])=>i.set(e,t))),n=!0)}}n||(e+=(e.includes("?")?"&":"?")+r.map((([e,t])=>e+"="+encodeURIComponent(t))).join("&"))}}const n=new Promise(((r,i)=>{fetch(e,t).then((e=>{t.parseJson?e.json().then((t=>{e.parsedJson=t,r(e)})).catch((t=>{e.parsedJson=null,e.error=t,i(e)})):r(e)})).catch((e=>{e.stack=n.stack,i(e)}))}));return n.stack=(new Error).stack,n.abort=function(){null==r||r.abort()},n}static mockUrl(e,t){const r=this;(r.mockAjaxMap||(r.mockAjaxMap={}))[e]=t,_AjaxHelper.originalFetch||(_AjaxHelper.originalFetch=_AjaxHelper.fetch,_AjaxHelper.fetch=r.mockAjaxFetch.bind(r))}static async mockAjaxFetch(e,t){const r=e.split("?");let n=this.mockAjaxMap[r[0]],i=null;if(n){"function"==typeof n&&(n=await n(r[0],r[1]&&parseParams(r[1]),t));try{i=(null==t?void 0:t.parseJson)&&JSON.parse(n.responseText)}catch(e){i=null,n.error=e}return n=Object.assign({status:200,ok:!0,headers:new Headers,statusText:"OK",url:e,parsedJson:i,text:()=>new Promise((e=>{e(n.responseText)})),json:()=>new Promise((e=>{e(i)}))},n),new Promise((function(e,t){n.synchronous?e(n):setTimeout((function(){e(n)}),"delay"in n?n.delay:100)}))}return _AjaxHelper.originalFetch(e,t)}},AjaxHelper=_AjaxHelper;__publicField(AjaxHelper,"DEFAULT_FETCH_OPTIONS",{}),AjaxHelper._$name="AjaxHelper";var _LocaleHelper=class{static mergeLocales(...e){const t={};return e.forEach((e=>{Object.keys(e).forEach((r=>{"object"==typeof e[r]?t[r]={...t[r],...e[r]}:t[r]=e[r]}))})),t}static trimLocale(e,t){const r=(t,r)=>{e[t]&&(r?e[t][r]&&delete e[t][r]:delete e[t])};Object.keys(t).forEach((e=>{Object.keys(t[e]).length>0?Object.keys(t[e]).forEach((t=>r(e,t))):r(e)}))}static normalizeLocale(e,t){if(!e)throw new Error('"nameOrConfig" parameter can not be empty');if("string"==typeof e){if(!t)throw new Error('"config" parameter can not be empty');t.locale?t.name=e||t.name:t.localeName=e}else t=e;let r={};if(t.name||t.locale)r=Object.assign({localeName:t.name},t.locale),t.desc&&(r.localeDesc=t.desc),t.code&&(r.localeCode=t.code),t.path&&(r.localePath=t.path);else{if(!t.localeName)throw new Error("参数没有localeName属性");r=Object.assign({},t)}for(const e of["name","desc","code","path"])r[e]&&delete r[e];if(!r.localeName)throw new Error("Locale name can not be empty");return r}static get locales(){return globalThis.gantt.locales||{}}static set locales(e){globalThis.gantt.locales=e}static get localeName(){return globalThis.gantt.locale||"Ch"}static set localeName(e){globalThis.gantt.locale=e||_LocaleHelper.localeName}static get locale(){return _LocaleHelper.localeName&&this.locales[_LocaleHelper.localeName]||this.locales.Ch||Object.values(this.locales)[0]||{localeName:"",localeDesc:"",localeCoode:""}}static publishLocale(e,t){const{locales:r}=globalThis.gantt,n=_LocaleHelper.normalizeLocale(e,t),{localeName:i}=n;return r[i]&&!0!==t?r[i]=this.mergeLocales(r[i]||{},n||{}):r[i]=n,r[i]}},LocaleHelper=_LocaleHelper;__publicField(LocaleHelper,"skipLocaleIntegrityCheck",!1),globalThis.gantt=globalThis.gantt||{},globalThis.gantt.locales=globalThis.gantt.locales||{},LocaleHelper._$name="LocaleHelper";var LocaleManager=class extends(Events_default(Base)){static get defaultConfig(){return{throwOnMissingLocale:VersionHelper.isTestEnv}}construct(...e){var t;const r=this;if(super.construct(...e),BrowserHelper.isBrowserEnv){const e=document.querySelector("script[data-default-locale]");e?r.applyLocale(e.dataset.defaultLocale):(null==(t=r.locale)?void 0:t.localeName)&&r.applyLocale(r.locale.localeName)}}get locales(){return LocaleHelper.locales}set locales(e){LocaleHelper.locales=e}set locale(e){this.applyLocale(e)}get locale(){return LocaleHelper.locale}registerLocale(e,t){VersionHelper.deprecate("Core","6.0.0","LocaleManager.registerLocale deprecated, use LocaleHelper.publishLocale instead"),LocaleHelper.publishLocale(e,t)}extendLocale(e,t){VersionHelper.deprecate("Core","6.0.0","LocaleManager.extendLocale deprecated, use LocaleManager.applyLocale instead");const r=LocaleHelper.publishLocale(e,t);return this.applyLocale(r,!0)}applyLocale(e,t,r=!1){const n=this;let i;if("string"==typeof e)if("object"!=typeof t){if(i=n.locales.Ch,!i){if(r)return!0;throw new Error('Locale "'+e+'" is not published. Publish with LocaleHelper.publishLocale() before applying.')}}else i=LocaleHelper.publishLocale(e,t);else i=LocaleHelper.publishLocale(e);if(n.locale.localeName&&n.locale.localeName===i.localeName&&!0!==t)return n.locale;LocaleHelper.localeName=i.localeName;const s=()=>{n.trigger("locale",i)};return i.localePath?new Promise(((e,t)=>{n.loadLocale(i.localePath).then((t=>{t.text().then((t=>{new Function(t)(),BrowserHelper.isBrowserEnv&&(i=n.locales[i.localeName],i&&delete i.localePath),s(),e(i)}))})).catch((e=>t(e)))})):(s(),i)}loadLocale(e){return AjaxHelper.get(e)}set throwOnMissingLocale(e){this._throwOnMissingLocale=e}get throwOnMissingLocale(){return this._throwOnMissingLocale}},LocaleManagerSingleton=new LocaleManager,LocaleManager_default=LocaleManagerSingleton,ObjectProto=Object.getPrototypeOf(Object),localeRe=/L{.*?}/g,capturelocaleRe=/L{(.*?)}/g,classMatchRe=/((.*?)\.)?(.+)/g,escape2=e=>e.replace(/{(\d+)}/gm,"[[$1]]"),unescape=e=>e.replace(/\[\[(\d+)]]/gm,"{$1}"),emptyObject3=Object.freeze(Object.create(null)),Localizable_default=e=>class t extends(e||Base){static get $name(){return"Localizable"}static get configurable(){return{localeClass:null,localizable:null,localizableProperties:{value:[],$config:{merge:"distinct"}}}}static clsName(e){var t,r;return"string"==typeof e?e:e===ObjectProto?"Object":e.$$name||e.name||(null==(t=e.prototype)?void 0:t.$$name)||(null==(r=e.prototype)?void 0:r.name)}static parseLocaleString(e){const t=[];let r;if(null==e?void 0:e.includes("L{"))for(e=escape2(e),capturelocaleRe.lastIndex=0;null!=(r=capturelocaleRe.exec(e));){classMatchRe.lastIndex=0;const e=classMatchRe.exec(r[1]);t.push({match:unescape(r[0]),localeKey:unescape(e[3]),localeClass:e[2]})}return t.length>0?t:[{match:e,localeKey:e,localeClass:void 0}]}construct(e={},...t){super.construct(e,...t),LocaleManager_default.ion({locale:"updateLocalization",thisObj:this}),this.updateLocalization()}get localeClass(){return this._localeClass||null}localizeProperty(e){var r,n,i;const s=this,a=Objects.getPath(s,e),o=(null==(r=s.$meta.configs[e])?void 0:r.localeKey)||(null==(i=null==(n=s.fieldMap)?void 0:n[e])?void 0:i.defaultValue);let l;return o?(l=t.localize(o,s,s.localeClass||s),l&&!(e in(s.initialConfig||emptyObject3))&&Objects.setPath(s.isColumn?s.data:s,e,l)):"string"==typeof a&&(s.originalLocales=s.originalLocales||{},l=Objects.getPath(s.originalLocales,e),void 0===l&&(Objects.setPath(s.originalLocales,e,a),l=a),l&&Objects.setPath(s,e,l=s.optionalL(l,s))),l||a}updateLocalization(){var e,t;!1!==this.localizable&&(null==(e=this.localizableProperties)||e.forEach(this.localizeProperty,this),null==(t=this.trigger)||t.call(this,"localized"))}static getTranslation(e,r,n){const i=LocaleManager_default.locale;let s,a,o=null;if(i)for(const{match:l,localeKey:c,localeClass:d}of this.parseLocaleString(e)){const u=t=>{var s;const a=null==(s=i[t])?void 0:s[c];return a&&(o="function"==typeof a?null!=r?a(r):a:"object"==typeof a||e===l?a:(o||e).replace(l,a),"string"==typeof a&&a.includes("L{")&&(o=this.getTranslation(a,r,n))),a};let h=!1;for(a=n;a&&(s=t.clsName(a))&&!(h=u(s))&&"string"!=typeof a;a=Object.getPrototypeOf(a));!h&&d&&u(d)}return o}static localize(e,r=void 0,...n){0===(null==n?void 0:n.length)&&(n=[this]);let i=null;return n.some((n=>(i=t.getTranslation(e,r,n),null!=i))),i}static L(e,t=void 0,...r){0===(null==r?void 0:r.length)&&(r=[this]);const n=this.localize(e,t,...r);if(null==n&&LocaleManager_default.throwOnMissingLocale&&e.includes("L{"))throw new Error("找不到的本地国际化文件");return null!=n?n:e}L(e,r){const{localeClass:n,constructor:i}=this;return n&&t.clsName(n)!==t.clsName(i)?t.L(e,r,n,i):t.L(e,r,i)}static optionalL(e,r=void 0,...n){const i=LocaleManager_default.throwOnMissingLocale;LocaleManager_default.throwOnMissingLocale=i&&localeRe.test(e),0===(null==n?void 0:n.length)&&(n=[this]);const s=t.L(e,r,...n);return LocaleManager_default.throwOnMissingLocale=i,s}optionalL(e,t=this,r=!1){const n=LocaleManager_default.throwOnMissingLocale;LocaleManager_default.throwOnMissingLocale=n&&localeRe.test(e)&&!r;const i=this.L(e,t);return LocaleManager_default.throwOnMissingLocale=n,i}get localeManager(){return LocaleManager_default}get localeHelper(){return LocaleHelper}},locale={localeName:"Ch",localeDesc:"中文",localeCode:"ch",Object:{Yes:"是",No:"否",Cancel:"取消",Ok:"确定",Week:"周"},Combo:{noResults:"没有数据",recordNotCommitted:"无法添加记录",addNewValue:e=>"Add "+e},FilePicker:{file:"File"},Field:{badInput:"无效的字段值",patternMismatch:"数值必须遵循指定的格式",rangeOverflow:e=>"值必须小于或等于 "+e.max,rangeUnderflow:e=>"值必须大于或等于 "+e.min,stepMismatch:"值应符合步骤",tooLong:"值太短",tooShort:"值太长",typeMismatch:"值必须采用指定格式",valueMissing:"该字段必填",invalidValue:"值无效",minimumValueViolation:"最小值违规",maximumValueViolation:"最大值违规",fieldRequired:"该字段必填",validateFilter:"必须从列表中选择值"},DateField:{invalidDate:"日期格式无效"},DatePicker:{gotoPrevYear:"上一年",gotoPrevMonth:"上一月",gotoNextMonth:"下一月",gotoNextYear:"下一年"},NumberFormat:{locale:"ch",currency:"YUAN"},DurationField:{invalidUnit:"无效的单位"},TimeField:{invalidTime:"时间格式无效"},TimePicker:{hour:"时",minute:"分",second:"秒"},List:{loading:"加载中..."},GridBase:{loadMask:"加载中...",syncMask:"正在保存更改，请稍候..."},PagingToolbar:{firstPage:"首页",prevPage:"上一页",page:"页",nextPage:"下一页",lastPage:"尾页",reload:"重新加载当前页",noRecords:"没有要显示的记录",pageCountTemplate:e=>"总共"+e.lastPage,summaryTemplate:e=>"此页显示 "+e.start+" - "+e.end+"共"+e.allCount},PanelCollapser:{Collapse:"收缩",Expand:"展开"},Popup:{close:"关闭"},UndoRedo:{Undo:"撤销",Redo:"恢复",UndoLastAction:"撤消上次操作",RedoLastAction:"恢复上次撤消的操作",NoActions:"撤消队列中没有项目"},FieldFilterPicker:{equals:"等于",doesNotEqual:"不等于",isEmpty:"空",isNotEmpty:"不为空",contains:"包含",doesNotContain:"不包含",startsWith:"开始于",endsWith:"结尾于",isOneOf:"属于",isNotOneOf:"不属于",isGreaterThan:"大于",isLessThan:"小于",isGreaterThanOrEqualTo:"大于或等于",isLessThanOrEqualTo:"小于或等于",isBetween:"介于",isNotBetween:"不在",isBefore:"以前",isAfter:"以后",isToday:"今天",isTomorrow:"明天",isYesterday:"昨天",isThisWeek:"本周",isNextWeek:"下周",isLastWeek:"上周",isThisMonth:"本月",isNextMonth:"下一月",isLastMonth:"上一月",isThisYear:"今年",isNextYear:"明年",isLastYear:"去年",isYearToDate:"本年度截至现在为止",isTrue:"真",isFalse:"假",selectAProperty:"选择一个特性",selectAnOperator:"选择执行人",caseSensitive:"区分大小写",and:"和",dateFormat:"D/M/YY",selectOneOrMoreValues:"选择一个或多个值",enterAValue:"输入一个值",enterANumber:"输入一个数字",selectADate:"选择一个日期"},FieldFilterPickerGroup:{addFilter:"添加筛选条件"},DateHelper:{locale:"ch",weekStartDay:0,nonWorkingDays:{0:!0,6:!0},weekends:{0:!0,6:!0},unitNames:[{single:"毫秒",plural:"毫秒",abbrev:"ms"},{single:"秒",plural:"秒",abbrev:"s"},{single:"分",plural:"分",abbrev:"min"},{single:"时",plural:"时",abbrev:"h"},{single:"日",plural:"日",abbrev:"d"},{single:"周",plural:"周",abbrev:"w"},{single:"月",plural:"月",abbrev:"mon"},{single:"季",plural:"季",abbrev:"q"},{single:"年",plural:"年",abbrev:"yr"},{single:"十年",plural:"十年",abbrev:"dec"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],parsers:{L:"YYYY-MM-DD",LT:"HH:mm A",LTS:"HH:mm:ss A"},ordinalSuffix:e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t}}},En_default=LocaleHelper.publishLocale(locale),{toString:toString3}=Object.prototype,DATE_TYPE2=toString3.call(new Date),tempDate=new Date,MS_PER_HOUR=36e5,defaultValue=(e,t)=>isNaN(e)||null==e?t:e,rangeFormatPartRe=/([ES]){([^}]+)}/g,enOrdinalSuffix=e=>{let t="th";if(!["11","12","13"].find((t=>e.endsWith(t)))){t={1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"}return e+t},useIntlFormat=(e,t,r)=>(intlFormatterCache[e]||(intlFormatterCache[e]=new Intl.DateTimeFormat(locale2,t))).format(r),formatTime=(e,t,r,n=!1)=>{let i=useIntlFormat(e,t,r);return/am|pm/i.test(i)&&(i=i.replace(/^0/,""),n&&(i=i.replace(/:00/,""))),i},getDayDiff=(e,t)=>Math.floor((e.getTime()-t.getTime()-(e.getTimezoneOffset()-t.getTimezoneOffset())*validConversions.minute.millisecond)/validConversions.day.millisecond)+1,normalizeDay=e=>e>=0?e:e+7,msRegExp=/([^\w])(S+)/gm,msReplacer=(e,t)=>t+"SSS",splitRegExp=/[:.\-/\s]/,locale2="ch",ordinalSuffix=enOrdinalSuffix,formatCache={},formatRedirects={},intlFormatterCache={},parserCache={},redirectFormat=e=>{const t=intlFormatConfigs[e];if(!t)throw new Error("Only international formats should be used here");if(void 0!==formatRedirects[e])return formatRedirects[e];const r=new Intl.DateTimeFormat(locale2,t).formatToParts(new Date(2001,1,2,3,4,5,6)).map((e=>{const r=e.type,n=t[r];return"literal"===r?e.value.replace(/,/g,""):"day"===r?"numeric"===n?"D":"DD":"month"===r?"short"===n?"MMM":"long"===n?"MMMM":"numeric"===n?"M":"MM":"year"===r?"numeric"===n?"YYYY":"YY":void 0})).join("");return formatRedirects[e]=r},DEFAULT_YEAR=2020,DEFAULT_MONTH=0,DEFAULT_DAY=1,intlFormatConfigs={l:{year:"numeric",month:"numeric",day:"numeric"},ll:{year:"numeric",month:"numeric",day:"numeric"}},formats={M:e=>e.getMonth()+1,Mo:e=>ordinalSuffix(formats.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>useIntlFormat("MMM",{month:"short"},e),MMMM:e=>useIntlFormat("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/3),Qo:e=>ordinalSuffix(formats.Q(e).toString()),D:e=>e.getDate(),Do:e=>ordinalSuffix(formats.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/validConversions.day.millisecond),DDDo:e=>ordinalSuffix(formats.DDD(e).toString()),DDDD:e=>formats.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>ordinalSuffix(e.getDay().toString()),d1:e=>useIntlFormat("d1",{weekday:"narrow"},e).substr(0,1),dd:e=>formats.ddd(e).substring(0,2),ddd:e=>useIntlFormat("ddd",{weekday:"short"},e),dddd:e=>useIntlFormat("dddd",{weekday:"long"},e),u:e=>{const t=(intlFormatterCache.u||(intlFormatterCache.u=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}))).formatToParts(e);return""+t[4].value+t[2].value+t[0].value+"Z"},uu:e=>{const t=(intlFormatterCache.uu||(intlFormatterCache.uu=new Intl.DateTimeFormat("en-GB",{timeZone:"UTC",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))).formatToParts(e);return""+t[4].value+t[2].value+t[0].value+"T"+t[6].value+t[8].value+t[10].value+"Z"},e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>DateHelper.getWeekNumber(e)[1],Wo:e=>ordinalSuffix(formats.W(e).toString()),WW:e=>formats.W(e).toString().padStart(2,"0"),Wp:e=>DateHelper.localize("L{Week}")+" "+formats.W(e),WWp:e=>DateHelper.localize("L{Week}")+" "+formats.WW(e),Wp0:e=>""+DateHelper.localize("L{Week}")[0]+formats.W(e),WWp0:e=>""+DateHelper.localize("L{Week}")[0]+formats.WW(e),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>formats.h(e).toString().padStart(2,"0"),k:e=>e.getHours()||24,kk:e=>formats.k(e).toString().padStart(2,"0"),K:e=>formatTime("K",{hour:"numeric"},e),KK:e=>formatTime("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>formats.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>formats.s(e).toString().padStart(2,"0"),S:e=>Math.floor(e.getMilliseconds()/100).toString(),SS:e=>Math.floor(e.getMilliseconds()/10).toString().padStart(2,"0"),SSS:e=>e.getMilliseconds().toString().padStart(3,"0"),z:e=>useIntlFormat("z",{timeZoneName:"short"},e),zz:e=>useIntlFormat("zz",{timeZoneName:"long"},e),Z:e=>DH.getGMTOffset(e),LT:e=>formatTime("LT",{hour:"2-digit",minute:"2-digit"},e),LST:e=>formatTime("LST",{hour:"numeric",minute:"2-digit"},e,!0),LTS:e=>formatTime("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>useIntlFormat("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>useIntlFormat("l",intlFormatConfigs.l,e),LL:e=>useIntlFormat("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>useIntlFormat("ll",intlFormatConfigs.ll,e),LLL:e=>useIntlFormat("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>useIntlFormat("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>useIntlFormat("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>useIntlFormat("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},formatKeys=Object.keys(formats).sort(((e,t)=>t.length-e.length)),formatRegexp="^(?:"+formatKeys.join("|")+")",emptyFn2=()=>({}),isNumber=e=>numberRegex.test(e),parseMilliseconds=e=>isNumber(e)&&{milliseconds:parseInt(e.padEnd(3,"0").substring(0,3))},parsers={YYYY:e=>{const t=parseInt(e);return{year:t>=1e3&&t<=9999?t:NaN}},Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},M:e=>({month:parseInt(e)-1}),MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),MMM:e=>{const t=(e||"").toLowerCase();for(const[e,r]of Object.entries(DateHelper._monthShortNamesIndex))if(t.startsWith(e))return{month:r.value}},MMMM:emptyFn2,DD:e=>({date:parseInt(e)}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:emptyFn2,DDDo:emptyFn2,DDDD:emptyFn2,d:emptyFn2,do:emptyFn2,d1:emptyFn2,dd:emptyFn2,ddd:emptyFn2,dddd:emptyFn2,Q:emptyFn2,Qo:emptyFn2,W:emptyFn2,Wo:emptyFn2,WW:emptyFn2,e:emptyFn2,E:emptyFn2,HH:e=>({hours:parseInt(e)}),hh:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:parseMilliseconds,SS:parseMilliseconds,SSS:parseMilliseconds,A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"YYYY-MM-DD",LT:"HH:mm A",LTS:"HH:mm:ss A",l:{type:"dynamic",parser:()=>redirectFormat("l")},ll:{type:"dynamic",parser:()=>redirectFormat("ll")},Z:e=>{if(!e||!timeZoneRegEx.test(e)&&"Z"!==e)return null;let t=0;if("Z"!==e){const r=timeZoneRegEx.exec(e);if(r){t=("+"===r[1]?1:-1)*(60*(parseInt(r[2])||0)+(parseInt(r[3])||0))}else t=-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},parserKeys=Object.keys(parsers).sort(((e,t)=>t.length-e.length)),parserRegexp=new RegExp("("+parserKeys.join("|")+")"),localeStrRegExp=new RegExp("^(LL|LLL|lll|LLLL|llll)$"),validConversions={decade:{decade:1,year:10,quarter:40,month:120,week:520,day:3652,hour:87648,minute:5258880,second:315532800,millisecond:3155328e5},year:{decade:.1,year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{decade:1/40,year:1/4,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{decade:1/120,year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{decade:-1/520,year:-1/52,quarter:-1/13,month:-1/4,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{decade:-1/3652,year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{decade:-1/87648,year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{decade:-1/5258880,year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{decade:-1/315532800,year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{decade:-1/3155328e5,year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},normalizedUnits={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",mi:"minute",min:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",mo:"month",mon:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year",dec:"decade",decades:"decade"},withDecimalsDurationRegex=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,noDecimalsDurationRegex=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,canonicalUnitNames=["millisecond","second","minute","hour","day","week","month","quarter","year","decade"],canonicalUnitAbbreviations=[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"],["dec"]],deltaUnits=["decade","year","month","week","day","hour","minute","second","millisecond"],dateProperties=["milliseconds","seconds","minutes","hours","date","month","year"],parseNumber=e=>{const t=parseFloat(e);return isNaN(t)?null:t},numberRegex=/^[0-9]+$/,timeZoneRegEx=/([+-])(\d\d):*(\d\d)*$/,unitMagnitudes={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8,decade:9},snapFns={round:(e,t=1)=>Math.round(e/t)*t,floor:(e,t=1)=>Math.floor(e/t)*t,ceil:(e,t=1)=>Math.ceil(e/t)*t},keyCache={},_DateHelper=class extends(Localizable_default()){static get $name(){return"DateHelper"}static set defaultFormat(e){DH._defaultFormat=e}static get defaultFormat(){return DH._defaultFormat||"YYYY-MM-DDTHH:mm:ssZ"}static set defaultParseFormat(e){this._defaultParseFormat=e}static get defaultParseFormat(){return this._defaultParseFormat||this._defaultFormat||"YYYY-MM-DDTHH:mm:ss.SSSZ"}static buildParser(e){const t=e.split(parserRegexp),r=[];return 1===t.length||localeStrRegExp.test(e)?[]:(t.reduce(((t,n,i,s)=>{if(0!==i||""!==n)if(parserRegexp.test(n)){const a=(this.localize("L{parsers}")||{})[n]||parsers[n];if("Z"===n&&i<s.length-2)throw new Error("Invalid format "+e+" TimeZone (Z) must be last token");const o="function"==typeof a||"string"==typeof a?a:a.parser();if("string"==typeof o){const e=DH.buildParser(o),n=e.pop();delete n.last,r.push(...e),t=n}else t.pattern=n,t.fn=o}else t.splitter=n,r.push(t),t={};else Object.prototype.hasOwnProperty.call(t,"pattern")&&r.push(t);return t}),{}),r[r.length-1].last=!0,r)}static makeKey(e){if(10===e.length)return e;e.getTime&&(e=e.getTime());const t=keyCache[Math.trunc(e/MS_PER_HOUR)];if(t)return t;tempDate.setTime(e);const r=tempDate.getMonth()+1,n=tempDate.getDate();return keyCache[Math.trunc(e/MS_PER_HOUR)]=tempDate.getFullYear()+"-"+(r<10?"0"+r:r)+"-"+(n<10?"0"+n:n)}static parseKey(e){return DH.parse(e,"YYYY-MM-DD")}static parse(e,t=DH.defaultParseFormat,r=!1){if(e instanceof Date)return e;if("string"!=typeof e||!e)return null;const n={year:null,month:null,date:null,hours:null,minutes:null,seconds:null,milliseconds:null};t=t.replace(msRegExp,msReplacer);let i,s=parserCache[t];if(s||(s=parserCache[t]=DH.buildParser(t)),e.includes(" ")&&(e=e.replace(/\s/g," ")),s.reduce(((e,t)=>{var i;if(!t.last){let s,a,o;if("T"===t.splitter&&-1===e.indexOf("T"))s=e.indexOf(" ");else{const n=e.indexOf("+");let{splitter:a}=t;!r&&splitRegExp.test(a)&&(a=splitRegExp),s=""!==t.splitter?e.search(a):(null==(i=t.pattern)?void 0:i.length)||-1,n>-1&&s>n&&(s=-1)}if(-1===s||"SSS"===t.pattern&&e.match(/^\d+Z$/)){const t=e.split(/([Z\-+])/);1===t.length?(a=e,o=""):(a=t[0],o=""+t[1]+t[2])}else a=e.substring(0,s)||e,o=e.substring(s+t.splitter.length);if(t.fn){const e=t.fn(a);e?Object.assign(n,e):o=a+o}return o}Object.assign(n,t.fn(e))}),e),n.year&&!n.date&&(n.date=1),n.date>31||n.month>12)return null;const a=DH.create(n,r);return a?i=a:r||(i=new Date(e)),i}static create(e,t=!1){const r={...e};let n=isNaN(r.year)||t&&(isNaN(r.month)||isNaN(r.date)),i=!1;if(!n){let e=!0;dateProperties.forEach((t=>{t in r&&!isNaN(r[t])||(r[t]=0),e=e&&null===r[t]})),n=e}if(n)return null;if("am"===r.amPm?r.hours=r.hours%12:"pm"===r.amPm&&(r.hours=r.hours%12+12),"timeZone"in r&&(i=!0,r.minutes-=r.timeZone),t&&(null==r.year||null==r.month||null==r.date))return null;const s=[defaultValue(r.year,DEFAULT_YEAR),defaultValue(r.month,DEFAULT_MONTH),defaultValue(r.date,DEFAULT_DAY),r.hours,r.minutes,r.seconds,r.milliseconds];return i?new Date(Date.UTC(...s)):new Date(...s)}static toUTC(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))}static format(e,t=DH.defaultFormat){if(!e||isNaN(e))return null;let r=formatCache[t],n="";if(!r){r=formatCache[t]=[];for(let e=0;e<t.length;e++){const n=t.slice(e).match(formatRegexp),i=null==n?void 0:n[0];if(i){const t=(this.localize("L{formats}")||{})[i]||formats[i];r.push(t),e+=i.length-1}else if("{"===t[e]){const n=t.indexOf("}",e+1);-1===n?(r.push(t.substr(e+1)),e=t.length):(r.push(t.substring(e+1,n)),e=n)}else r.push(t[e])}}return r.forEach((t=>{n+="string"==typeof t?t:t(e)})),n}static formatRange(e,t){return t.replace(rangeFormatPartRe,((t,r,n)=>_DateHelper.format(e["S"===r?0:1],n)))}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),DH.as("millisecond",e,t)}static asMonths(e){const t=DH.as("ms",DH.daysInMonth(e),"day"),r=(e.valueOf()-DH.startOf(e,"month").valueOf())/t;return 12*e.getYear()+e.getMonth()+r}static monthsToDate(e){const t=Math.floor(e),r=e-t,n=new Date(0,t),i=DH.as("ms",DH.daysInMonth(n),"days");return n.setTime(n.getTime()+r*i),n}static formatDelta(e,t){let r,n;"boolean"==typeof t?r=t:t&&(r=t.abbrev);const i=this.getDelta(e,t),s=[],a=(null==t?void 0:t.separator)||(r?"":" ");for(n in i)s.push(""+i[n]+a+n);return!1===(null==t?void 0:t.asString)?s:s.join(", ")}static getDelta(e,t){let r,n,i,s,a,o,l;"boolean"==typeof t?r=t:t&&(r=t.abbrev,s=DH.normalizeUnit(t.precision),o=t.maxUnit,l=!r&&t.ignoreLocale);const c={},d=r?DH.getShortNameOfUnit:DH.getLocalizedNameOfUnit,u=o?deltaUnits.slice(deltaUnits.indexOf(o)):deltaUnits;for(a of u)if(n=DH.as(a,e),i=s===a,n=Math[i?"round":"floor"](n),(n||i&&!c.length)&&(c[l?a:d.call(DH,a,1!==n)]=n,e-=DH.as("ms",n,a)),i||!e)break;return c}static as(e,t,r="ms"){return"string"==typeof t&&(t=DH.parseDuration(t)),"object"==typeof t&&(r=t.unit,t=t.magnitude),e===r||(e=DH.normalizeUnit(e))===(r=DH.normalizeUnit(r))?t:unitMagnitudes[r]>unitMagnitudes[e]?t*Math.abs(validConversions[r][e]):t/Math.abs(validConversions[e][r])}static formatContainsHourInfo(e){return/([HhKkmSsAa]|LT|L{3,}|l{3,})/.test(e.replace(/(\\.)/g,""))}static is24HourFormat(e){return DH.format(DH.getTime(13,0,0),e).includes("13")}static add(e,t,r="ms",n=!0){let i;if(i="string"==typeof e?DH.parse(e):n?new Date(e.getTime()):e,"string"==typeof t){const e=_DateHelper.parseDuration(t);t=e.magnitude,r=e.unit}else t&&"object"==typeof t&&(r=t.unit,t=t.magnitude);if(!r||0===t)return i;switch(r=DH.normalizeUnit(r)){case"millisecond":i.setTime(i.getTime()+t);break;case"second":i.setTime(i.getTime()+1e3*t);break;case"minute":i.setTime(i.getTime()+6e4*t);break;case"hour":i.setTime(i.getTime()+36e5*t);break;case"day":t%1==0?(i.setDate(i.getDate()+t),23===i.getHours()&&0===e.getHours()&&i.setHours(i.getHours()+1)):i.setTime(i.getTime()+864e5*t);break;case"week":i.setDate(i.getDate()+7*t);break;case"month":{let e=i.getDate();e>28&&(e=Math.min(e,DH.getLastDateOfMonth(DH.add(DH.getFirstDateOfMonth(i),t,"month")).getDate())),i.setDate(e),i.setMonth(i.getMonth()+t);break}case"quarter":DH.add(i,3*t,"month",!1);break;case"year":i.setFullYear(i.getFullYear()+t);break;case"decade":i.setFullYear(i.getFullYear()+10*t)}return i}static diff(e,t,r="ms",n=!0){if(r=DH.normalizeUnit(r),!e||!t)return 0;let i;switch(r){case"year":i=DH.diff(e,t,"month")/12;break;case"quarter":i=DH.diff(e,t,"month")/3;break;case"month":i=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth()),0===i&&n&&(i=DH.diff(e,t,"day",n)/DH.daysInMonth(e));break;case"week":i=DH.diff(e,t,"day")/7;break;case"day":{const r=e.getTimezoneOffset()-t.getTimezoneOffset();i=(t-e+60*r*1e3)/864e5;break}case"hour":i=(t-e)/36e5;break;case"minute":i=(t-e)/6e4;break;case"second":i=(t-e)/1e3;break;case"millisecond":i=t-e}return n?i:Math.round(i)}static startOf(e,t="day",r=!0,n=DH.weekStartDay){if(!e)return null;switch(t=DH.normalizeUnit(t),r&&(e=DH.clone(e)),t){case"year":return e.setMonth(0,1),e.setHours(0,0,0,0),e;case"quarter":return e.setMonth(3*(DH.get(e,"quarter")-1),1),e.setHours(0,0,0,0),e;case"month":return e.setDate(1),e.setHours(0,0,0,0),e;case"week":{const t=e.getDay()-n;return e.setDate(e.getDate()-t),e.setHours(0,0,0,0),e}case"day":return e.setHours(0,0,0,0),e;case"hour":e.getMinutes()>0&&e.setMinutes(0);case"minute":e.getSeconds()>0&&e.setSeconds(0);case"second":e.getMilliseconds()>0&&e.setMilliseconds(0);case"millisecond":return e}}static endOf(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)}static clone(e){return new Date(e.getTime())}static clearTime(e,t=!0){return e?(t&&(e=new Date(e.getTime())),e.setHours(0,0,0,0),e):null}static midnight(e,t){let r=DH.clearTime(e);return t&&r<e&&(r=DH.add(r,1,"d")),r}static getTimeOfDay(e,t="ms"){const r=e.getHours()*validConversions.hour.millisecond+e.getMinutes()*validConversions.minute.millisecond+e.getSeconds()*validConversions.second.millisecond+e.getMilliseconds();return"ms"===t?r:DH.as(t,r,"ms")}static set(e,t,r){if(!t)return e;if("string"==typeof t)switch(DH.normalizeUnit(t)){case"millisecond":(0!==r||e.getMilliseconds()>0)&&e.setMilliseconds(r);break;case"second":(0!==r||e.getSeconds()>0)&&e.setSeconds(r);break;case"minute":(0!==r||e.getMinutes()>0)&&e.setMinutes(r);break;case"hour":e.setHours(r);break;case"day":case"date":e.setDate(r);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(r);break;case"quarter":e.setDate(1),e.setMonth(3*(r-1));break;case"year":e.setFullYear(r)}else Object.entries(t).sort(((e,t)=>unitMagnitudes[e[0]]-unitMagnitudes[t[0]])).forEach((([t,r])=>{DH.set(e,t,r)}));return e}static setDateToMidday(e,t=!0){return DH.set(DH.clearTime(e,t),"hour",12)}static constrain(e,t,r){return null!=t&&(e=DH.max(e,t)),null==r?e:DH.min(e,r)}static getTime(e,t=0,r=0,n=0){return e instanceof Date&&(n=e.getMilliseconds(),r=e.getSeconds(),t=e.getMinutes(),e=e.getHours()),new Date(DEFAULT_YEAR,DEFAULT_MONTH,DEFAULT_DAY,e,t,r,n)}static copyTimeValues(e,t){return e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),e}static get isDSTEnabled(){const e=(new Date).getFullYear(),t=new Date(e,0,1),r=new Date(e,6,1);return t.getTimezoneOffset()!==r.getTimezoneOffset()}static isDST(e){const t=e.getFullYear(),r=new Date(t,0,1),n=new Date(t,6,1);return e.getTimezoneOffset()<Math.max(r.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,r=null){return null===r?e&&t&&e.getTime()===t.getTime():DH.startOf(e,r)-DH.startOf(t,r)==0}static compare(e,t,r=null){return r&&(e=DH.startOf(e,r),t=DH.startOf(t,r)),e<t?-1:e>t?1:0}static clamp(e,t,r){if(!isNaN(e))return null!=t&&(e=Math.max(e,t)),null!=r&&(e=Math.min(e,r)),new Date(e)}static isSameDate(e,t){return 0===DH.compare(e,t,"d")}static isSameTime(e,t){}static isStartOf(e,t){return DH.isEqual(e,DH.startOf(e,t))}static betweenLesser(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<r.getTime()}static betweenLesserEqual(e,t,r){return t.getTime()<=e.getTime()&&e.getTime()<=r.getTime()}static intersectSpans(e,t,r,n){return DH.betweenLesser(e,r,n)||DH.betweenLesser(r,e,t)}static compareUnits(e,t){return Math.sign(unitMagnitudes[DH.normalizeUnit(e)]-unitMagnitudes[DH.normalizeUnit(t)])}static timeSpanContains(e,t,r,n){return r-e>=0&&t-n>=0}static get weekStartDay(){return null==DH._weekStartDay&&(DH._weekStartDay=this.localize("L{weekStartDay}")||0),DH._weekStartDay}static get nonWorkingDays(){return{...this.localize("L{nonWorkingDays}")}}static get nonWorkingDaysAsArray(){return Object.keys(this.nonWorkingDays).map(Number)}static get weekends(){return{...this.localize("L{weekends}")}}static get(e,t){switch(DH.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return formats.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInYear(e){const t=e.getFullYear(),r=new Date(t+1,0,1)-new Date(t,0,1);return this.as("day",r)}static daysInMonth(e){return 32-new Date(e.getFullYear(),e.getMonth(),32).getDate()}static hoursInDay(e){const t=e.getFullYear(),r=e.getMonth(),n=e.getDate(),i=new Date(t,r,n+1)-new Date(t,r,n);return this.as("hour",i)}static getNormalizedUnitDuration(e,t){let r;switch(t){case"month":r=DH.asMilliseconds(DH.daysInMonth(e),"day");break;case"year":r=DH.asMilliseconds(DH.daysInYear(e),"day");break;case"day":r=DH.asMilliseconds(DH.hoursInDay(e),"hour");break;default:r=DH.asMilliseconds(t)}return r}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,r=1,n=DH.weekStartDay){if("week"===t){const t=DH.clone(e),i=t.getDay();return DH.startOf(t,"day",!1),DH.add(t,n-i+7*(r-(n<=i?0:1)),"day",!1),t.getDay()!==n&&DH.add(t,1,"hour"),t}return DH.startOf(DH.add(e,r,t),t,!1)}static isValidDate(e){return DH.isDate(e)&&!isNaN(e)}static isDate(e){return e&&toString3.call(e)===DATE_TYPE2}static getStartOfNextDay(e,t=!1,r=!1){let n=DH.add(r?e:DH.clearTime(e,t),1,"day");if(n.getDate()===e.getDate()){const r=DH.add(DH.clearTime(e,t),2,"day").getTimezoneOffset(),i=e.getTimezoneOffset();n=DH.add(n,i-r,"minute")}return n}static getEndOfPreviousDay(e,t=!1){const r=t?e:DH.clearTime(e,!0);return r-e?r:DH.add(r,-1,"day")}static getWeekDescription(e,t=e){const r=e.getMonth()===t.getMonth()?_DateHelper.format(e,"MMMM"):_DateHelper.format(e,"MMM")+" - "+_DateHelper.format(t,"MMM"),n=_DateHelper.getWeekNumber(e);return n[1]+", "+r+" "+n[0]}static getWeekNumber(e,t=_DateHelper.weekStartDay){const r=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31),i=normalizeDay(r.getDay()-t),s=normalizeDay(n.getDay()-t),a=getDayDiff(e,r);let o;if(o=i<4?Math.floor((a+i-1)/7)+1:Math.floor((a+i-1)/7),o){let t=e.getFullYear();return 53===o&&s<3&&(t++,o=1),[t,o]}const l=_DateHelper.getWeekNumber(new Date(e.getFullYear()-1,11,31))[1];return[e.getFullYear()-1,l]}static formatCount(e,t){return t=DH.normalizeUnit(t),1!==e&&(t+="s"),e+" "+t}static getUnitToBaseUnitRatio(e,t,r=!1){return(e=DH.normalizeUnit(e))===(t=DH.normalizeUnit(t))?1:validConversions[e]&&validConversions[e][t]&&(r||validConversions[e][t]>0)?1/DH.as(t,1,e):validConversions[t]&&validConversions[t][e]&&(r||validConversions[t][e]>0)?DH.as(e,1,t):-1}static getShortNameOfUnit(e){return e=DH.parseTimeUnit(e),DH.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t=!1){const r=e.charAt(0)===e.charAt(0).toUpperCase();return e=DH.normalizeUnit(e),e=DH.parseTimeUnit(e),e=DH.unitLookup[e][t?"plural":"single"],r&&(e=StringHelper.capitalize(e)),e}static normalizeUnit(e){if(!e)return null;const t=e.toLowerCase();return"date"===t||canonicalUnitNames.includes(t)?t:normalizedUnits[e]||normalizedUnits[t]}static getUnitByName(e){return DH.normalizeUnit(e)||DH.normalizeUnit(DH.parseTimeUnit(e))}static getDurationInUnit(e,t,r,n){return DH.diff(e,t,r,n)}static doesUnitsAlign(e,t){return!(e!==t&&"week"===t)}static getSmallerUnit(e){return canonicalUnitNames[unitMagnitudes[DH.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return canonicalUnitNames[unitMagnitudes[DH.normalizeUnit(e)]+1]||null}static round(e,t,r,n){return DH.snap("round",e,t,r,n)}static floor(e,t,r,n){return DH.snap("floor",e,t,r,n)}static ceil(e,t,r,n){return DH.snap("ceil",e,t,r,n)}static snap(e,t,r,n,i=DH.weekStartDay){const s=snapFns[e];if("string"==typeof r&&(r=DH.parseDuration(r)),Objects.isObject(r)){const a=r.magnitude||r.increment;switch(r.unit){case"week":{const r=t.getDay();return n=DH.add(DH.clearTime(t),r>=i?i-r:-(r-i+7),"day"),DH[e](t,7*a+" days",n)}case"month":{let e;return t=DH.asMonths(t),e=n?t+s(t-(n=DH.asMonths(n)),a):s(t,a),DH.monthsToDate(e)}case"quarter":return DH[e](t,3*a+" months",n);case"year":return DH[e](t,12*a+" months",n);case"decade":return DH[e](t,10*a+" years",n)}r=DH.as("ms",a,r.unit)}if(n){const e=DH.as("ms",n.getTimezoneOffset()-t.getTimezoneOffset(),"ms");return new Date(n.valueOf()+s(DH.diff(n,t,"ms")+e,r))}{const e=60*t.getTimezoneOffset()*1e3;return new Date(s(t.valueOf()-e,r)+e)}}static parseDuration(e,t=!0,r){var n;const i=(t?withDecimalsDurationRegex:noDecimalsDurationRegex).exec(e);if(null==e||!i)return null;const s=parseNumber(null==(n=i[1])?void 0:n.replace(",",".")),a=DH.parseTimeUnit(i[2])||r;return a?{magnitude:s,unit:a}:null}static parseTimeUnit(e){const t=null==e?null:DH.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let e=0;e<canonicalUnitNames.length;e++)if(t[e+1])return canonicalUnitNames[e]}static getGMTOffset(e=new Date){if(!e)return;const t=e.getTimezoneOffset();return t?(t>0?"-":"+")+Math.abs(Math.trunc(t/60)).toString().padStart(2,"0")+":"+Math.abs(t%60).toString().padStart(2,"0"):"Z"}static fillDayNames(){const e=new Date("2000-01-01T12:00:00"),t=DH._dayNames||[],r=DH._dayShortNames||[];t.length=0,r.length=0;for(let n=2;n<9;n++)e.setDate(n),t.push(DH.format(e,"dddd")),r.push(DH.format(e,"d1"));DH._dayNames=t,DH._dayShortNames=r}static getDayNames(){return DH._dayNames}static getDayName(e){return DH._dayNames[e]}static getDayShortNames(){return DH._dayShortNames}static getDayShortName(e){return DH._dayShortNames[e]}static fillMonthNames(){const e=new Date("2000-01-15T12:00:00"),t=DH._monthNames||[],r=DH._monthShortNames||[],n={},i={};t.length=0,r.length=0;for(let s=0;s<12;s++){e.setMonth(s);const a=DH.format(e,"MMM");t.push(a);const o=DH.format(e,"MMM");r.push(o),n[a.toLowerCase()]={name:a,value:s},i[o.toLowerCase()]={name:o,value:s}}DH._monthNames=t,DH._monthShortNames=r,DH._monthNamesIndex=n,DH._monthShortNamesIndex=i}static getMonthShortNames(){return DH._monthShortNames}static getMonthShortName(e){return DH._monthShortNames[e]}static getMonthNames(){return DH._monthNames}static getMonthName(e){return DH._monthNames[e]}static set locale(e){locale2=e,intlFormatterCache={},formatCache={},formatRedirects={}}static get locale(){return locale2}static setupDurationRegEx(e=[],t=[]){const r=this,n={};let i="";for(let s=0;s<t.length;s++){const a=t[s],o=e[s];o.canonicalUnitName=canonicalUnitNames[s],n[o.single]=n[o.single.toUpperCase()]=n[o.canonicalUnitName]=n[o.canonicalUnitName.toUpperCase()]=o,i+=(s?"|":"")+"(";for(let e=0;e<a.length;e++)i+=a[e]+"|";if("en-US"!==(locale2=r.localize("L{locale}")||"en-US")){const e=canonicalUnitAbbreviations[s];for(let t=0;t<e.length;t++)i+=e[t]+"|"}i+=o.single+"|"+o.plural+"|"+o.canonicalUnitName+"|"+o.canonicalUnitName+"s)"}r.unitLookup=n,r.durationRegEx=new RegExp("^(?:"+i+")$")}static applyLocale(){const e=this,t=e.localize("L{unitAbbreviations}")||[],r=e.unitNames=e.localize("L{unitNames}");"unitNames"!==r&&(locale2=e.localize("L{locale}")||"en-US",ordinalSuffix="en-US"===locale2?enOrdinalSuffix:e.localize("L{ordinalSuffix}")||ordinalSuffix,formatCache={},formatRedirects={},parserCache={},intlFormatterCache={},DH._weekStartDay=null,DH.setupDurationRegEx(r,t),DH.fillDayNames(),DH.fillMonthNames())}},DateHelper=_DateHelper;__publicField(DateHelper,"MS_PER_DAY",24*MS_PER_HOUR);var DH=DateHelper;DH.useIntlFormat=useIntlFormat,LocaleManager_default.ion({locale:"applyLocale",prio:1e3,thisObj:DH}),LocaleManager_default.locale&&DH.applyLocale(),DateHelper._$name="DateHelper";var{hasOwn:hasOwn2}=Objects,toFixedFix="1.01"===1.005.toFixed(2)?null:function(e,t){const r=e.toString().split("."),n=+(r[1]?r.join(".")+"1":r[0]);return e.toFixed.call(n,t)},ObjectHelper=class extends Objects{static transformArrayToNamedObject(e,t="ref"){const r={};return e.forEach(((e,n)=>{const i=null!=e[t]&&e[t].toString().length?e[t]:n;r[i]=e})),r}static transformNamedObjectToArray(e,t="ref"){return Object.keys(e).filter((t=>e[t])).map((r=>{const n=e[r];return n[t]=r,n}))}static isEqual(e,t,r=!1){if(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e)return!1;if(null==e&&null==t)return!0;if(e===t)return!0;const n=typeof e;if(n===typeof t){switch(n){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e.getTime()===t.getTime();case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every(((e,n)=>OH.isEqual(e,t[n],r)));case"object"===n&&e.constructor.prototype===t.constructor.prototype:return r?OH.isDeeplyEqual(e,t,r):StringHelper.safeJsonStringify(e)===StringHelper.safeJsonStringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,r={}){if(e===t)return!0;if(!e||!t)return!1;const n=OH.keys(e,r.ignore),i=OH.keys(t,r.ignore);if(n.length!==i.length)return!1;for(let s=0;s<n.length;s++){const a=n[s],o=i[s];if(a!==o)return!1;const l=e[a],c=t[o];if(!r.shouldEvaluate||!1!==r.shouldEvaluate(a,{value:l,object:e},{value:c,object:t})){if(r.evaluate){const n=r.evaluate(a,{value:l,object:e},{value:c,object:t});if(!1===n)return!1;if(!0===n)continue}if(!OH.isEqual(l,c,r))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!==e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?DateHelper.isAfter(e,t):e>t}static fork(e){let t,r,n;if(e&&e.constructor===Object)for(r in t=Object.setPrototypeOf({},e),e)n=e[r],n&&(n.constructor===Object?t[r]=OH.fork(n):n instanceof Array&&(t[r]=n.slice()));else t=e;return t}static copyProperties(e,t,r){let n,i;for(i=0;i<r.length;i++)n=r[i],n in t&&(e[n]=t[n]);return e}static copyPropertiesIf(e,t,r){if(t)for(const n of r)n in e||(e[n]=t[n]);return e}static entries(e,t){const r=[],n="function"==typeof t;if(e)for(const i in e)(n?t(i,e[i]):null==t?void 0:t[i])||r.push([i,e[i]]);return r}static fromEntries(e,t){if(t=t||{},e)for(let r=0;r<e.length;++r)t[e[r][0]]=e[r][1];return t}static keys(e,t,r){const n=[],i="function"==typeof t;if(e){let s=0;for(const a in e)(i?t(a,e[a]):null==t?void 0:t[a])||(n.push(r?r(a,s):a),++s)}return n}static values(e,t,r){const n=[],i="function"==typeof t;if(e){let s=0;for(const a in e)(i?t(a,e[a]):null==t?void 0:t[a])||(n.push(r?r(e[a],s):e[a]),++s)}return n}static pathExists(e,t){return t.split(".").every((t=>!(!e||!(t in e))&&(e=e[t],!0)))}static pathifyKeys(e){const t={};for(const r in e)if(hasOwn2(e,r))if(Array.isArray(e[r]))t[r]=e[r].slice();else if(e[r]instanceof Object){const n=this.pathifyKeys(e[r]);for(const e in n)t[r+"."+e]=n[e]}else t[r]=e[r];return t}static deletePath(e,t){t.split(".").reduce(((e,t,r,n)=>{if(null==e)return null;if(hasOwn2(e,t)){if(r!==n.length-1)return e[t];delete e[t]}}),e)}static coerce(e,t){const r=Objects.typeOf(e),n=Objects.typeOf(t),i="string"==typeof e;if(r!==n)switch(n){case"string":return String(e);case"number":return Number(e);case"boolean":return!(i&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!i||e&&"null"!==e)&&null;case"undefined":return!(!i||e&&"undefined"!==e)&&void 0;case"date":return i&&isNaN(e)?DateHelper.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,r,n,i=!0){const s={};let a=Object.getPrototypeOf(e),o=Object.getOwnPropertyDescriptor(a,t);for(;!o&&a&&i;)a=Object.getPrototypeOf(a),a&&(o=Object.getOwnPropertyDescriptor(a,t));o?(o.set?s.set=t=>{o.set.call(e,t),n&&n.call(e,o.get.call(e))}:s.set=n,o.get?s.get=()=>{let t=o.get.call(e);return r&&(t=r.call(e,t)),t}:s.get=r):(s.set=r=>{e["_"+t]=r,n&&n.call(e,r)},s.get=()=>{let n=e["_"+t];return r&&(n=r.call(e,n)),n}),Object.defineProperty(e,t,s)}static hookProperty(e,t,r){const n=ObjectHelper.getPropertyDescriptor(r.prototype,"value"),i=ObjectHelper.getPropertyDescriptor(e,t),s="_"+t,a=class{get value(){return i?i.get.call(this):this[s]}set value(e){i?i.set.call(this,e):this[s]=e}},o=ObjectHelper.getPropertyDescriptor(a.prototype,"value");return Object.setPrototypeOf(r.prototype,a.prototype),Object.defineProperty(e,t,{configurable:!0,get:n.get||o.get,set:n.set||o.set}),()=>delete e[t]}static getPropertyDescriptor(e,t){let r=null;for(let n=e;n&&!r&&!hasOwn2(n,"isBase");n=Object.getPrototypeOf(n))r=Object.getOwnPropertyDescriptor(n,t);return r}static cleanupProperties(e,t=!1){return Object.entries(e).forEach((([r,n])=>{t?void 0===n&&delete e[r]:null==n&&delete e[r]})),e}static removeAllProperties(e){return Object.keys(e).forEach((t=>delete e[t])),e}static assertType(e,t,r){const n=Objects.typeOf(e);if(null!=e&&n!==t)throw new Error('Incorrect type "'+n+'" for '+r+', expected "'+t+'"')}static assertObject(e,t){OH.assertType(e,"object",t)}static assertInstance(e,t){OH.assertType(e,"instance",t)}static assertClass(e,t){OH.assertType(e,"class",t)}static assertFunction(e,t){if("function"!=typeof e||e.isBase||e.$$name)throw new Error("Incorrect type for "+t+', got "'+e+'" (expected a function)')}static assertNumber(e,t){const r=Number(e);if("number"!=typeof e||isNaN(r))throw new Error("Incorrect type for "+t+', got "'+e+'" (expected a Number)')}static assertBoolean(e,t){OH.assertType(e,"boolean",t)}static assertString(e,t){OH.assertType(e,"string",t)}static assertArray(e,t){OH.assertType(e,"array",t)}static toFixed(e,t){return toFixedFix?toFixedFix(e,t):e.toFixed(t)}static roundTo(e,t=1){return Math.round(e/t)*t}static round(e,t){if(null==t)return e;const r=10**t;return Math.round(e*r)/r}static getMapPath(e,t,r){const n=Array.isArray(t)?t:"string"==typeof t?t.split("."):[t],i=1===n.length,s=n[0],a=e.has(s)?e.get(s):e.set(s,i?r:{}).get(s);return i?a:OH.getPathDefault(a,n.slice(1),r)}},OH=ObjectHelper;ObjectHelper._$name="ObjectHelper";var allBorders=["border-top-width","border-right-width","border-bottom-width","border-left-width"],allMargins=["margin-top","margin-right","margin-bottom","margin-left"],allPaddings=["padding-top","padding-right","padding-bottom","padding-left"],borderNames={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},paddingNames={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},zeroBased=Object.freeze({x:0,y:0}),alignSpecRe=/^([trblc])(\d*)-([trblc])(\d*)$/i,alignPointRe=/^([trblc])(\d*)$/i,edgeNames=["top","right","bottom","left"],edgeIndices={t:0,r:1,b:2,l:3},defaultAlignments=["b-t","l-r","t-b","r-l"],edgeAligments={bt:1,tb:1,lr:2,rl:2},zeroOffsets=Object.freeze([0,0]),matchDimensions=["width","height"],parseEdges=(e,t=e,r=e,n=t)=>Array.isArray(e)?parseEdges.apply(null,e):[e,t,r,n];function parseAlign(e,t){const r=alignSpecRe.exec(e),n=r[1],i=r[3],s=parseInt(r[2]||50),a=parseInt(r[4]||50),o=!t||1&edgeIndices[n]?s:100-s,l=!t||1&edgeIndices[i]?a:100-a,c=edgeAligments[n+i];return{myAlignmentPoint:n+o,myEdge:n,myOffset:o,targetAlignmentPoint:i+l,targetEdge:i,targetOffset:l,startZone:edgeIndices[i],edgeAligned:c}}function flipAlign(e){return""+edgeNames[(edgeIndices[e.myEdge]+2)%4][0]+e.myOffset+"-"+edgeNames[(edgeIndices[e.targetEdge]+2)%4][0]+e.targetOffset}function createOffsets(e){return null==e?zeroOffsets:"number"==typeof e?[e,e]:e}var Rectangle=class{get isRectangle(){return!0}static from(e,t,r){if("string"==typeof e?e=document.querySelector(e):(null==e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host||e.ownerDocument),"string"==typeof t&&(t=document.querySelector(t)),null==e||e.isRectangle)return e;if(e=e.element||e,void 0===r&&"boolean"==typeof t&&(r=t,t=null),!(null==t?void 0:t.isRectangle))if(t){let{scrollLeft:e,scrollTop:r}=t;BrowserHelper.isSafari&&t===document.body&&(e=r=0),t=Rectangle.from(t).translate(-e,-r)}else t=zeroBased;const n=e===document||e===globalThis,i=e===document.body&&0===document.body.offsetHeight,s=i&&e.getBoundingClientRect(),a=i?new Rectangle(s.left,s.top,s.width,document.body.parentElement.scrollHeight):n?new Rectangle(0,0,globalThis.innerWidth,globalThis.innerHeight):e.getBoundingClientRect(),o=r||n?[0,0]:[globalThis.pageXOffset,globalThis.pageYOffset];return new Rectangle(a.left+o[0]-t.x,a.top+o[1]-t.y,a.width,a.height)}static fromScreen(e,t){return Rectangle.from(e,t,!0)}static inner(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders);n.x+=parseFloat(t[borderNames.l]),n.y+=parseFloat(t[borderNames.t]),n.right-=parseFloat(t[borderNames.r]),n.bottom-=parseFloat(t[borderNames.b])}return n}static content(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allBorders),r=DomHelper.getStyleValue(e,allPaddings);n.x+=parseFloat(t[borderNames.l])+parseFloat(r[paddingNames.l]),n.y+=parseFloat(t[borderNames.t])+parseFloat(r[paddingNames.t]),n.right-=parseFloat(t[borderNames.r])+parseFloat(r[paddingNames.r]),n.bottom-=parseFloat(t[borderNames.b])+parseFloat(r[paddingNames.b])}return n}static client(e,t,r=!1){const n=this.content(e,t,r),i=DomHelper.scrollBarWidth;let s;return i&&(e.scrollHeight>e.clientHeight&&"hidden"!==DomHelper.getStyleValue(e,"overflow-y")&&(s=parseFloat(DomHelper.getStyleValue(e,"padding-right")),n.right+=s-Math.max(s,i)),e.scrollWidth>e.clientWidth&&"hidden"!==DomHelper.getStyleValue(e,"overflow-x")&&(s=parseFloat(DomHelper.getStyleValue(e,"padding-bottom")),n.bottom+=s-Math.max(s,i))),n}static outer(e,t,r=!1){const n=this.from(e,t,r);if(document.body.contains(e)){const t=DomHelper.getStyleValue(e,allMargins);n.x-=parseFloat(t["margin-left"]),n.y-=parseFloat(t["margin-top"]),n.right+=parseFloat(t["margin-right"]),n.bottom+=parseFloat(t["margin-bottom"])}return n}static union(...e){let t,{x:r,y:n,right:i,bottom:s}=e[0];if(e.length>1)for(let a=1;a<e.length;a++)t=e[a],t.x<r&&(r=t.x),t.y<n&&(n=t.y),t.right>i&&(i=t.right),t.bottom>s&&(s=t.bottom);return new Rectangle(r,n,i-r,s-n)}roundPx(e=globalThis.devicePixelRatio||1){const t=this;return t._x=DomHelper.roundPx(t._x,e),t._y=DomHelper.roundPx(t._y,e),t._width=DomHelper.roundPx(t._width,e),t._height=DomHelper.roundPx(t._height,e),t}static get $$name(){return hasOwnProperty.call(this,"$name")&&this.$name||hasOwnProperty.call(this,"_$name")&&this._$name||this.name}get $$name(){return this.constructor.$$name}constructor(e,t,r,n){ObjectHelper.assertNumber(e,"Rectangle.x"),ObjectHelper.assertNumber(t,"Rectangle.y"),ObjectHelper.assertNumber(r,"Rectangle.width"),ObjectHelper.assertNumber(n,"Rectangle.height");const i=this;r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),i._x=e,i._y=t,i._width=r,i._height=n}clone(){const e=this,t=new Rectangle(e.x,e.y,e.width,e.height);return t.isAlignRectangle=e.isAlignRectangle,t.minHeight=e.minHeight,t.minWidth=e.minWidth,t}contains(e){const t=this;return!!e.isRectangle&&(e._x>=t._x&&e._y>=t._y&&e.right<=t.right&&e.bottom<=t.bottom)}intersect(e,t=!1,r=!1){const n=this,i=Math.max(n.y,e.y),s=Math.min(n.right,e.right),a=Math.min(n.bottom,e.bottom),o=Math.max(n.x,e.x);return!!(r?a>=i&&s>=o:a>i&&s>o)&&(!!t||new Rectangle(o,i,s-o,a-i))}equals(e,t=!1){const r=t?e=>Math.round(e):e=>e;return e.isRectangle&&r(e.x)===r(this.x)&&r(e.y)===r(this.y)&&r(e.width)===r(this.width)&&r(e.height)===r(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new Rectangle.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){const t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}get start(){return this.left}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){const t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}get end(){return this.right}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}getStart(e,t=!0){return t?e?this.right:this.left:this.top}getEnd(e,t=!0){return t?e?this.left:this.right:this.bottom}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.isAlignRectangle||(t.width=Math.max(t.width,t._minWidth)))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.isAlignRectangle||(t.height=Math.max(t.height,t._minHeight)))}get minHeight(){return this._minHeight}adjust(e,t,r,n){const i=this;return i.x+=e,i.y+=t,i.width+=r,i.height+=n,i}inflate(e,t=e,r=e,n=t){return Array.isArray(e)&&([e,t,r,n]=parseEdges(e)),this.adjust(-n,-e,t,r)}deflate(e,t=e,r=e,n=t){return Array.isArray(e)&&([e,t,r,n]=parseEdges(e)),this.adjust(n,e,-t,-r)}constrainTo(e,t){const r=this,n=r.height,i=r.y,s=r.minWidth||r.width,a=r.minHeight||r.height;if(r.height>=e.height){if(t&&a>e.height)return!1;r._y=e.y,r.height=e.height}if(r.width>=e.width){if(t&&s>e.width)return r.y=i,r.height=n,!1;r._x=e.x,r.width=e.width}return r.translate.apply(r,r.constrainVector=[Math.min(e.right-r.right,0),Math.min(e.bottom-r.bottom,0)]),r.translate(Math.max(e.x-r.x,0),Math.max(e.y-r.y,0)),r}alignTo(e){let t,r,n,i,s=this.clone(),{target:a,constrainTo:o,constrainPadding:l}=e;if(a&&!a.isRectangle&&(a=Rectangle.from(a.element?a.element:a)),o){if(!o.isRectangle){i=o===globalThis||o===document;const t="ignorePageScroll"in e?e.ignorePageScroll:!i;o=Rectangle.from(o.element?o.element:o,null,t)}l&&(l=parseEdges(l),l[0]=Math.min(l[0],a.top),l[1]=Math.min(l[1],o.right-a.right),l[2]=Math.min(l[0],o.bottom-a.bottom),l[3]=Math.min(l[0],a.left),o=o.deflate.apply(o.clone(),l))}const c=this,d=createOffsets(e.offset),{align:u,axisLock:h,anchorSize:g,anchorPosition:p,matchSize:m,position:f,rtl:v}=e,y=parseAlign(u,v),b=o&&o.clone(),C=[],D=[{zone:r=y.startZone,align:u}],S=m&&matchDimensions[1&y.startZone],E=c[S];if(S&&h?s[S]=a[S]:!y.edgeAligned&&m&&(s.width=a.width,s.height=a.height),o&&s.constrainTo(o),o&&null!=y.startZone)if(h)D.push({zone:r=(r+2)%4,align:flipAlign(y)}),"flexible"===h&&(D.push({zone:r=(y.startZone+1)%4,align:defaultAlignments[r]}),D.push({zone:r=(r+2)%4,align:defaultAlignments[r]}));else for(let e=1;e<4;e++)D.push({zone:r=(r+1)%4,align:defaultAlignments[r]});if(p){const e=1&y.startZone?"y":"x";t={[e]:p[e],edge:edgeNames[(y.startZone+2)%4]}}if(b&&a&&(b.adjust(-a.width,-a.height,a.width,a.height),a.constrainTo(b)),s.minWidth=c.minWidth,s.minHeight=c.minHeight,f)s.moveTo(f.x,f.y),o&&s.constrainTo(o);else{const e="c"===y.myEdge||"c"===y.targetEdge,r=g&&!e?[g[1]+d[0],g[1]+d[1]]:d,l=a.getAlignmentPoint(y.targetAlignmentPoint,r),u=s.getAlignmentPoint(y.myAlignmentPoint);s.translate(l[0]-u[0],l[1]-u[1]);let p=s.intersect(a,!0);if(p)o&&s.constrainTo(o),n=y.startZone,s.translate(...r);else if(o&&!o.contains(s)){const e=s.clone(),l=[];let d,u;t=null,C[0]=d=o.clone(),d.bottom=a.y-r[1],C[1]=d=o.clone(),d.x=a.right+r[0],C[2]=d=o.clone(),d.y=a.bottom+r[1],C[3]=d=o.clone(),d.right=a.x-r[0];for(let e=0;e<D.length;e++){if(S&&2==e&&(s[S]=E),d=C[n=D[e].zone],s=s.alignTo({target:a,offsets:r,align:D[e].align}),s.constrainTo(d,!0)&&(l.push({result:s,zone:n}),!u||s.width<c.width||s.height<c.height)){s.align=D[e].align;break}if(!u||d.area>u.area){const e=s.clone();switch(n){case 0:e.moveTo(null,d.bottom-e.height);break;case 1:e.moveTo(d.left);break;case 2:e.moveTo(null,d.top);break;case 3:e.moveTo(d.right-e.width)}u={area:d.area,result:e,zone:n}}}l.length?(l.length>1&&!h&&l.sort(((t,r)=>Math.sqrt((e.x-t.result.x)**2+(e.y-t.result.y)**2)-Math.sqrt((e.x-r.result.x)**2+(e.y-r.result.y)**2))),s=l[0].result,n=l[0].zone):(s=u.result,n=u.zone,i&&s.constrainTo(o))}else n=y.startZone;if(s.zone=n,s.overlap=p=s.intersect(a,!0),g&&!p){if(!t){const e=1&n,r=e?"y":"x",i=e?"bottom":"right",o=Math.max(a[r],s[r]);let l=o+(Math.min(a[i],s[i])-o)/2-g[0]/2;const c=l+g[0];c>s[i]&&(l-=c-s[i]),l<s[r]&&(l+=s[r]-l),t={[r]:l-s[r],edge:edgeNames[(n+2)%4]}}s.anchor=t}}return s}getAlignmentPoint(e,t=zeroOffsets){const r=this,n=alignPointRe.exec(e),i=n[1].toLowerCase(),s=Math.min(Math.max(parseInt(n[2]||50),0),100)/100;switch(i){case"t":return[r.x+r.width*s,r.y-t[1]];case"r":return[r.right+t[0],r.y+r.height*s];case"b":return[r.x+r.width*s,r.bottom+t[1]];case"l":return[r.x-t[0],r.y+r.height*s];case"c":return[r.x+r.width/2,r.y+r.height/2]}}highlight(){const e=this,t=DomHelper.createElement({parent:document.body,style:"position:absolute;z-index:9999999;pointer-events:none;left:"+e.x+"px;top:"+e.y+"px;width:"+e.width+"px;height:"+e.height+"px"});return DomHelper.highlight(t).then((()=>t.remove()))}visualize(e,t){const r=this,n=ObjectHelper.merge({style:{left:r.x+"px",top:r.y+"px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",...e.class?{}:{position:"absolute","z-index":9999999}}},e);return t?n:DomHelper.createElement(n)}toString(e=","){return[this.top+"px",this.right+"px",this.bottom+"px",this.left+"px"].join(e)}};Rectangle._$name="Rectangle";var valueSymbol=Symbol("value"),lengthSymbol=Symbol("length"),DomClassList=class{static change(e,t,r,n="string"){r=DomClassList.normalize(r,"object");const i=DomClassList.normalize(e,"array").filter((e=>!r[e]));if(t){t=DomClassList.normalize(t,"array");for(let e=0;e<t.length;++e)i.includes(t[e])||i.push(t[e])}return DomClassList.normalize(i,n)}static from(e,t){return e&&(e.isDomClassList?t=null==t||t:(t=null!=t?t:Objects.isObject(e)&&!Objects.isEmpty(e),e=new DomClassList(e)),e.value||t||(e=null)),e||(t?new DomClassList:null)}static normalize(e,t="string"){const r=typeof(e=e||""),n="array"===t,i=!n&&!("object"===t);let s,a,o,l="string"===r;for("object"===r&&(e.nodeType===Element.ELEMENT_NODE&&"function"==typeof e.getAttribute?(e=e.getAttribute("class")||"",l=!0):(null==e?void 0:e.isDomClassList)?e=e.values:e instanceof DOMTokenList?e=Array.from(e):e instanceof Map?e=Array.from(e.keys()).filter((t=>e.get(t))):e instanceof Set?e=Array.from(e):Array.isArray(e)||(e=Objects.getTruthyKeys(e))),l&&(e=[...new Set(StringHelper.split(e))]),a=e.length;a-- >0;)s=e[a],s.length?s.includes(" ")&&e.splice(a,1,...StringHelper.split(s)):e.splice(a,1);if(n)o=e;else if(i)o=e.join(" ");else for(o=Object.create(null),a=0;a<e.length;++a)o[e[a]]=!0;return o}constructor(...e){this.process(1,e)}clear(){for(const e in this)this[e]=!1;return this}set(...e){return this.clear().process(1,e)}get isDomClassList(){return!0}clone(){return new DomClassList(this)}contains(e){return!("string"!=typeof e||!e)&&Boolean(this[e])}toString(){return this.length?this.value+" ":""}toJSON(){return this.toString()}trim(){return this.value}isEqual(e){const t=DomClassList.normalize(e,"array"),r=t.length;if(this.length===r){for(let e=0;e<r;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){let e,t=this[valueSymbol];return null==t&&(e=Objects.getTruthyKeys(this),this[lengthSymbol]=e.length,this[valueSymbol]=t=e.join(" ")),t}set value(e){const t=this,r=Object.keys(t),n=r.length;for(let e=0;e<n;e++)delete t[r[e]];e?t.process(1,[e]):delete t[valueSymbol]}get values(){return Objects.getTruthyKeys(this)}get length(){return this.value?this[lengthSymbol]:0}process(e,t){for(let r,n,i=0;i<t.length;i++)if(t[i])if(r=t[i],r.isDomClassList||Objects.isObject(r))for(n in r)this[n]=e?r[n]:!r[n];else for(r=DomClassList.normalize(t[i],"array"),n=0;n<r.length;++n)this[r[n]]=e;return delete this[valueSymbol],this}assign(e){for(const t in e)!this[t]!=!e[t]&&(this[t]=e[t],delete this[valueSymbol]);return this}assignTo(e){const t=e.nodeType===Element.ELEMENT_NODE?e.classList:e,r=DomClassList.from(t);r.add(this),t.value=r.value}add(...e){return this.process(1,e)}remove(...e){return this.process(0,e)}toggle(e,t=Boolean(!this[e])){if(t=Boolean(t),Boolean(this[e])!==t)return this[e]=t,delete this[valueSymbol],!0}split(){return Objects.getTruthyKeys(this)}forEach(e){return Objects.getTruthyKeys(this).forEach(e)}};DomClassList.prototype[valueSymbol]=null,DomClassList._$name="DomClassList";var Point=class extends Rectangle{static from(e){const t=e.changedTouches;return new Point(t?t[0].screenX:e.screenX,t?t[0].screenY:e.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}};Object.getPrototypeOf(Point).Point=Point,Point._$name="Point";var touchProperties=["clientX","clientY","pageX","pageY","screenX","screenY"],isOption={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1,expires:1,block:1},configurable=!0,returnTrueProp={configurable:configurable,value:!0},normalizedKeyNames={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},ignoreModifierKeys={Meta:1,Control:1,Alt:1},specialKeys={Control:"ctrl",Alt:"alt",Shift:"shift"},longpressMoveThreshold=5,specialKeyRe=/^(ctrl|shift|alt|meta)$/,_EventHelper=class{static normalizeEvent(e){return ObjectHelper.copyPropertiesIf(e,e.changedTouches[0]||e.touches[0],touchProperties)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const r=EH.getXY(e),n=EH.getXY(t);return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))}static getPagePoint(e){return new Rectangle.Point(e.pageX,e.pageY)}static getClientPoint(e){return new Rectangle.Point(e.clientX,e.clientY)}static addListener(e,t,r,n){return n=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:r},n):Object.assign({element:e},t):e,EH.on(n)}static on(e){const t=e.element,r=e.thisObj,n=[];for(const i in e)if(!isOption[i]){let s=e[i];"object"!=typeof s&&(s={handler:s});const a=s.element||t;BrowserHelper.isTouchDevice&&!BrowserHelper.isAndroid&&"contextmenu"===i&&n.push(EH.addElementListener(a,"touchstart",{handler:EH.createContextMenuWrapper(s.handler,s.thisObj||r)},e)),n.push(EH.addElementListener(a,i,s,e))}const i=()=>{for(let e,t=0;t<n.length;t++)e=n[t],EH.removeEventListener(e[0],e[1],e[2]);n.length=0};return r&&!1!==e.autoDetach&&(r.doDestroy=FunctionHelper.createInterceptor(r.doDestroy,i,r)),i}static addElementListener(e,t,r,n){const i=EH.createHandler(e,t,r,n),{spec:s}=i,a=r.expires||n.expires,o=null!=s.capture||null!=s.passive?{capture:s.capture,passive:s.passive}:void 0;if(e.addEventListener(t,i,o),a){const s=r.thisObj||n.thisObj,o=(null==s?void 0:s.isDelayable)?s:globalThis,{alt:l}=a,c=l?a.delay:a,{spec:d}=i;d.expires=a,d.timerId=o["number"==typeof c?"setTimeout":"requestAnimationFrame"]((()=>{d.timerId=null,EH.removeEventListener(e,t,i),l&&!i.called&&("string"==typeof l?s[l]:l).call(s)}),c,"listener-timer-"+performance.now())}return[e,t,i,o]}static getComposedPathTarget(e){return e.composedPath()[0]||e.path[0]}static fixEvent(e){var t,r;if(e.fixed)return e;const{type:n,target:i}=e;if(((null==i?void 0:i.shadowRoot)||(null==(t=null==i?void 0:i.getRootNode)?void 0:t.call(i).host))&&e.composedPath){const t=this.getComposedPathTarget(e),r=i;Object.defineProperty(e,"target",{value:t,configurable:configurable}),Object.defineProperty(e,"originalTarget",{value:r,configurable:configurable})}if(Object.defineProperty(e,"fixed",returnTrueProp),n.startsWith("key")){const t=normalizedKeyNames[e.key];t&&Object.defineProperty(e,"key",{value:t,configurable:configurable})," "!==e.key||e.code||Object.defineProperty(e,"code",{value:"Space",configurable:configurable})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",returnTrueProp),i&&"offsetX"in e&&(Object.getOwnPropertyDescriptor(e,"borderOffsetX")||Object.defineProperty(e,"borderOffsetX",{get:()=>e.offsetX+(BrowserHelper.isSafari?0:parseInt(i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("border-left-width")))}),Object.getOwnPropertyDescriptor(e,"borderOffsetY")||Object.defineProperty(e,"borderOffsetY",{get:()=>e.offsetY+(BrowserHelper.isSafari?0:parseInt(i.ownerDocument.defaultView.getComputedStyle(i).getPropertyValue("border-top-width")))})),(null==i?void 0:i.nodeType)===Element.DOCUMENT_NODE&&"clientX"in e){const t=DomHelper.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{value:t,configurable:configurable})}if((null==i?void 0:i.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"target",{value:t,configurable:configurable})}if((null==(r=e.relatedTarget)?void 0:r.nodeType)===Element.TEXT_NODE){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{value:t,configurable:configurable})}return n.startsWith("touch")&&e.touches.length&&this.normalizeEvent(e),e}static createHandler(e,t,r,n){const i=r.delay||n.delay,s=r.throttled||n.throttled,a=r.block||n.block,o="once"in r?r.once:n.once,l="capture"in r?r.capture:n.capture,c="passive"in r?r.passive:n.passive,d="delegate"in r?r.delegate:n.delegate,u=r.handler,h=r.expires,g=r.thisObj||n.thisObj,{rtlSource:p=g}=g||{};let m=(e,...t)=>{EH.playingDemo&&e.isTrusted||(null==g?void 0:g.isDestroyed)||(e=EH.fixEvent(e,null==p?void 0:p.rtl),m.called=!0,("string"==typeof u?g[u]:u).call(g,e,...t),delete e.target,delete e.relatedTarget,delete e.originalarget,delete e.key,delete e.code,delete e.ctrlKey,delete e.fixed)};if(a){const e=m;let t,r;m=(n,...i)=>{const s=performance.now();(!t||n.target!==r||s-t>a)&&(r=n.target,t=s,e(n,...i))}}if(null!=i){const e=m,t=(null==g?void 0:g.setTimeout)?g:globalThis;m=(...r)=>{t.setTimeout((()=>{e(...r)}),i)}}if(null!=s){let e,t=s;s.buffer&&(e=e=>s.alt.call(EH,EH.fixEvent(e,null==p?void 0:p.rtl)),t=s.buffer),m=(null==g?void 0:g.isDelayable)?g.throttle(m,{delay:t,throttled:e}):FunctionHelper.createThrottled(m,t,g,null,e)}if(o){const r=m;m=(...n)=>{EH.removeEventListener(e,t,m),r(...n)}}if(d){const e=m;m=(t,...r)=>{var n;const i=(null==(n=(t=EH.fixEvent(t,null==p?void 0:p.rtl)).target.closest)?void 0:n.call)&&t.target.closest(d);i&&(Object.defineProperty(t,"currentTarget",{get:()=>i,configurable:!0}),e(t,...r))}}return r.thisObj&&!1!==r.autoDetach&&(g.doDestroy=FunctionHelper.createInterceptor(g.doDestroy,(()=>EH.removeEventListener(e,t,m)),g)),m.spec={delay:i,throttled:s,block:a,once:o,thisObj:g,capture:l,expires:h,passive:c,delegate:d},m}static removeEventListener(e,t,r){const{expires:n,timerId:i,thisObj:s,capture:a}=r.spec;if((null==n?void 0:n.alt)&&i){((null==s?void 0:s.isDelayable)?s:globalThis)["number"==typeof n.delay?"clearTimeout":"cancelAnimationFrame"](i)}e.removeEventListener(t,r,a)}static onTransitionEnd({element:e,animationName:t,property:r,handler:n,mode:i=(t?"animation":"transition"),duration:s=DomHelper["get"+("transition"===i?"Property":"")+StringHelper.capitalize(i)+"Duration"](e,r),thisObj:a=globalThis,args:o=[],timerSource:l,runOnDestroy:c}){let d;l=l||(a.isDelayable?a:globalThis);const u=[e,r,...o],h=()=>{g(),a.isDestroyed||(a.callback?a.callback(n,a,u):n.apply(a,u))},g=EH.on({element:e,[i+"end"]({animationName:n,propertyName:i,target:s}){s===e&&(i===r||(null==n?void 0:n.match(t)))&&(d&&(l.clearTimeout(d),d=null),h())}});return null!=s&&(d=l.setTimeout(h,s+50,"onTransitionEnd",c)),g}static async waitForTransitionEnd(e){return new Promise((t=>{e.handler=t,_EventHelper.onTransitionEnd(e)}))}static createContextMenuWrapper(e,t){return r=>{if(1===r.touches.length){if(r.target.closest("[data-feature]"))return;const n=r.touches[0],i=setTimeout((()=>{a();const i=new MouseEvent("contextmenu",n);Object.defineProperty(i,"target",{get:()=>n.target}),"string"==typeof e&&(e=t[e]),i.browserEvent=r,e.call(t,i),EH.contextMenuTouchId=n.identifier}),EH.longPressTime),s=({clientX:e,clientY:t,type:r})=>{let s="touchend"===r||"pointerup"===r;if(!s){const r=Math.abs(e-n.clientX),i=Math.abs(t-n.clientY);s=r>=longpressMoveThreshold||i>=longpressMoveThreshold}s&&(EH.contextMenuTouchId=null,a(),clearTimeout(i))},a=EH.on({element:document,touchmove:s,touchend:s,pointermove:s,pointerup:s,capture:!0})}}}static createDblClickWrapper(e,t,r){let n,i,s;return()=>{i||(i=EH.on({element:e,touchstart:e=>{n=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===n){e.preventDefault(),clearTimeout(s),n=i=null;const a=Rectangle.from(e.changedTouches[0].target,null,!0),o=e.changedTouches[0].pageX-a.x,l=e.changedTouches[0].pageY-a.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperties(d,{target:{value:e.target},offsetX:{value:o},offsetY:{value:l}}),"string"==typeof t&&(t=r[t]),t.call(r,d)}},once:!0}),s=setTimeout((()=>{i(),n=i=null}),EH.dblClickTime))}}static toSpecialKey(e,t=(BrowserHelper.isMac?"metaKey":"ctrlKey")){let r=!1;return!0===e?r=t:"string"==typeof e&&(e=e.toLowerCase()).match(specialKeyRe)&&(r=e+"Key"),r}static specialKeyFromEventKey(e){return specialKeys[e]||""}},EventHelper=_EventHelper;__publicField(EventHelper,"eventNameMap",{mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut",keyup:"KeyUp",keydown:"KeyDown",keypress:"KeyPress"});var EH=EventHelper;EH.longPressTime=500,EH.dblClickTime=300,EH.globalListenerDetacher=EH.on({element:document,capture:!0,passive:!0,pointerdown({target:e}){var t;const r=DomHelper.getRootElement(e);DomHelper.usingKeyboard=!1,null==(t=r.classList)||t.remove("b-using-keyboard"),DomHelper.removeClsGlobally(r,"b-using-keyboard")},keydown({target:e,key:t}){if(!ignoreModifierKeys[t]){DomHelper.usingKeyboard=!0;const t=DomHelper.getRootElement(e);t.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Array.from(t.children).forEach((e=>{e.matches(".b-outer")&&e.classList.add("b-using-keyboard")})):t.classList.add("b-using-keyboard")}}}),BrowserHelper.isTouchDevice&&EH.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0}),EventHelper._$name="EventHelper";var DEFAULT_FONT_SIZE=14,t0t0={align:"t0-t0"},ELEMENT_NODE=Node.ELEMENT_NODE,TEXT_NODE=Node.TEXT_NODE,{isObject:isObject}=ObjectHelper,numberRe=/[+-]?\d*\.?\d+[eE]?-?\d*/g,numberReSrc=numberRe.source,translateMatrix2dRe=/matrix\((?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?([+-]?\d*\.?\d+[eE]?-?\d*),\s?([+-]?\d*\.?\d+[eE]?-?\d*)/,translateMatrix3dRe=/matrix3d\((?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(-?\d*),\s?(-?\d*)/,translateMatrixRe=/(?:matrix\((?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?(?:[+-]?\d*\.?\d+[eE]?-?\d*),\s?([+-]?\d*\.?\d+[eE]?-?\d*),\s?([+-]?\d*\.?\d+[eE]?-?\d*))|(?:matrix3d\((?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(-?\d*),\s?(-?\d*))/,pxTtranslateXRe=/translate(3d|X)?\(([+-]?\d*\.?\d+[eE]?-?\d*)px(?:,\s?([+-]?\d*\.?\d+[eE]?-?\d*)px)?/,pxTtranslateYRe=/translate(3d|Y)?\(([+-]?\d*\.?\d+[eE]?-?\d*)px(?:,\s?([+-]?\d*\.?\d+[eE]?-?\d*)px)?/,whiteSpaceRe2=/\s+/,semicolonRe=/\s*;\s*/,colonRe=/\s*:\s*/,digitsRe=/^-?((\d+(\.\d*)?)|(\.?\d+))$/,elementPropKey="$gantt",elementCreateExpandos={elementData:"",for:"htmlFor",retainElement:""},elementCreateProperties={tag:1,html:1,text:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,class:1,className:1,unmatched:1,onlyChildren:1,listeners:1,compareHtml:1,syncOptions:1,keepChildren:1},styleIgnoreProperties={length:1,parentRule:1,style:1},nativeEditableTags={INPUT:1,TEXTAREA:1},nativeFocusableTags={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,BODY:1},win=globalThis,doc=document,emptyObject4=Object.freeze({}),arraySlice=Array.prototype.slice,immediatePromise=Promise.resolve(),fontProps=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],isHiddenWidget=e=>e._hidden,parentNode=e=>e.parentNode||e.host,mergeChildren=(e,t,r)=>"children"===r.key?ObjectHelper.mergeItems(e,t,r):ObjectHelper.blend(e,t,r),isVisible=e=>{const t=e.ownerDocument.defaultView.getComputedStyle(e);return"none"!==t.getPropertyValue("display")&&"hidden"!==t.getPropertyValue("visibility")},hasLayout=e=>e&&(e===doc.body||Boolean(e.offsetParent)||(e.ownerDocument.defaultView&&"offsetParent"in e&&"fixed"!==DomHelper.getStyleValue(e,"position")?e.offsetParent:hasLayout(e.parentNode))),elementOrConfigToElement=e=>e instanceof Node?e:"string"==typeof e?DH2.createElementFromTemplate(e):DH2.createElement(e),canonicalStyles=Object.create(null),canonicalizeStyle=(e,t)=>{const r=canonicalStyles[e]||[StringHelper.hyphenate(e),t];return canonicalStyles[e]||(canonicalStyles[r[0]]=canonicalStyles[e]=r),r},getOffsetParent=e=>e.ownerSVGElement?e.ownerSVGElement.parentNode:e.offsetParent,slideInAnimationName=/b-slide-in-from-\w+/;["top","right","bottom","left","width","height","maxWidth","maxHeight","minWidth","minHeight","borderSpacing","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","letterSpacing","lineHeight","outlineWidth","textIndent","wordSpacing"].forEach((e=>canonicalizeStyle(e,!0)));var templateElement,htmlParser,scrollBarMeasureElement,clearTouchTimer,scrollBarWidth=null,idCounter=0,themeInfo=null,DomHelper=class{static async slideIn(e,t=1){const r="b-slide-in-"+(t>0?"next":"previous"),{classList:n}=e,{style:i}=e.parentNode,{overflow:s,overflowX:a,overflowY:o}=i;i.overflow="hidden",n.add(r),await EventHelper.waitForTransitionEnd({element:e,animationName:slideInAnimationName}),i.overflow=s,i.overflowX=a,i.overflowY=o,n.remove(r)}static isFocusable(e,t=!1){if(!t&&(!DH2.isVisible(e)||DH2.Widget.fromElement(e,isHiddenWidget)))return!1;const r=e.nodeName;return nativeFocusableTags[r]||("A"===r||"LINK"===r)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isEditable(e){return e.isContentEditable||nativeEditableTags[e.nodeName]}static isInView(e,t=!1,r){if(!hasLayout(e))return!1;const n=(null==r?void 0:r.positioned)&&"fixed"!==DomHelper.getStyleValue(r.element,"position"),i=Rectangle.from(globalThis),s=t?"contains":"intersect",a=n&&r.element.offsetParent,o=n&&Rectangle.from(a);if(i.height=doc.scrollingElement.scrollHeight,e===doc.body)return i;const l=this.getViewportIntersection(e,i,s);return l&&n&&l.translate(doc.scrollingElement.scrollLeft,doc.scrollingElement.scrollTop),n&&l?l.translate(-o.x+a.scrollLeft,-o.y+a.scrollTop):l}static getViewportIntersection(e,t,r){const{parentNode:n}=e,{parentElement:i}=n.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.getRootNode().host:e,s=i.ownerDocument.defaultView.getComputedStyle(i),a="visible"!==s.overflowX||"visible"!==s.overflowY,o=getOffsetParent(e);let l=Rectangle.from(e,null,!0);for(let n=a?e.parentNode:o;l&&n!==doc.documentElement;n=n.parentNode){n.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&n.host&&(n=n.host.parentNode);const e=n===doc.body,i=n.ownerDocument.defaultView.getComputedStyle(n),s=e?t:Rectangle.inner(n,null,!0);(e||"visible"!==i.overflow)&&(l=s[r](l,!1,!0))}return l}static isVisible(e){const t=e.ownerDocument;for(;e;e=parentNode(e)){if(e===t)return!0;if(e.nodeType===e.ELEMENT_NODE&&!isVisible(e))return!1}return!1}static isDOMEvent(e){return e instanceof Event}static merge(e,...t){return ObjectHelper.blend(e,t,{merge:mergeChildren})}static normalizeChildren(e,t,r){var n;let i,s,a,o,l,c=null==e?void 0:e.children;if((null==(n=null==e?void 0:e.syncOptions)?void 0:n.ignoreRefs)&&(r=!0),c&&!(e instanceof Node))if(Array.isArray(c))for(s=0;s<c.length;++s)DH2.normalizeChildren(c[s],t,r);else for(a in o=c,e.children=c=[],o)i=o[a],(null==i?void 0:i.isWidget)&&(i=i.element),l=!a.startsWith("$")&&!DH2.isElement(i),l&&(null==t||t(a,!r)),i&&(i instanceof Node||(!1===i.reference?delete i.reference:l&&"string"!=typeof i&&(i.reference=a),DH2.normalizeChildren(i,t,r)),c.push(i));return e}static roundPx(e,t=globalThis.devicePixelRatio||1){const r=1/t;return Math.round(e/r)*r}static floorPx(e,t=globalThis.devicePixelRatio||1){const r=1/t;return Math.floor(e*r)/r}static isCustomElement(e){return Boolean(null==e?void 0:e.shadowRoot)}static elementFromPoint(e,t){let r=document.elementFromPoint(e,t);return DH2.isCustomElement(r)&&(r=r.shadowRoot.elementFromPoint(e,t)||r),r}static childFromPoint(e,t,r,n=e){const i=null==r?t:new Rectangle(t,r,0,0);let s=null;return Array.from(e.children).reverse().some((e=>{if(Rectangle.from(e,n).contains(i))return s=e.children.length&&DH2.childFromPoint(e,i,null,n)||e,!0})),s}static unitize(e,t,r="px"){const[n,i]=canonicalizeStyle(e);return null!=t&&(t=String(t),t=i&&digitsRe.test(t)?t+r:t),[n,t]}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getActiveElement(e){(null==e?void 0:e.isWidget)&&(e=e.element);let t=((null==e?void 0:e.getRootNode())||document).activeElement;for(;null==t?void 0:t.shadowRoot;)t=t.shadowRoot.activeElement;return t}static getRootElement(e){var t;const r=null==(t=e.getRootNode)?void 0:t.call(e),{nodeType:n}=r;return n===Node.DOCUMENT_NODE?r.body:n===Node.DOCUMENT_FRAGMENT_NODE?r:e.ownerDocument.contains(e)?e.ownerDocument.body:null}static getOutermostElement(e){var t;const r=null==(t=e.getRootNode)?void 0:t.call(e);if(null==r?void 0:r.body)return null==r?void 0:r.body;for(;e.parentNode!==r&&e.parentNode;)e=e.parentNode;return e}static isValidFloatRootParent(e){return e===document.body||"ShadowRoot"===e.constructor.name}static getId(e){return e.id||(e.id="b-element-"+ ++idCounter)}static getCommonAncestor(e,t){var r;if(e===t)return e;for(;e&&!(null==(r=e[e.isWidget?"owns":"contains"])?void 0:r.call(e,t))&&e!==t;)e=e.owner||e.parentNode;return e}static getElement(e){return e instanceof Element?e:doc.querySelector(e)}static setAttributes(e,t){const r=DH2.getElement(e);if(r&&t)for(const e in t)null==t[e]?r.removeAttribute(e):r.setAttribute(e,t[e])}static setLength(e,t,r){return r=1===arguments.length?"number"==typeof e?e+"px":null!=e?e:"":(e=DH2.getElement(e)).style[t]="number"==typeof r?r+"px":null!=r?r:""}static percentify(e,t=2){const r=Math.pow(10,t);return null==e||""===e||isNaN(e)?"":Math.round(e*r)/r+"%"}static getChild(e,t){return e.querySelector(":scope>"+t)}static hasChild(e,t){return null!=DH2.getChild(e,t)}static children(e,t){return(">"===t[0]||t.startsWith("# "))&&("#"===t[0]&&(t=t.substr(2)),t=":scope "+t),Array.from(e.querySelectorAll(t))}static getChildElementCount(e){return e.childElementCount}static down(e,t){return e?e.matches&&e.matches(t)?e:(t=":scope "+t,e.querySelector(t)):null}static isDescendant(e,t){const r=DH2.getRootElement(e),n=DH2.getRootElement(t);return n&&r!==n&&n.host?DH2.isDescendant(r,n.host):e.contains(t)}static getEventElement(e,t="target"){return!e||DH2.isElement(e)?e:e[t]}static isElement(e){return(null==e?void 0:e.nodeType)===document.ELEMENT_NODE&&DH2.isNode(e)}static isReactElement(e){return(null==e?void 0:e.$$typeof)===Symbol.for("react.element")}static isNode(e){return Boolean(e)&&"number"==typeof e.nodeType&&!isObject(e)}static forEachSelector(e,t,r){if("string"==typeof e)throw new Error("DomHelper.forEachSelector must provide a root element context (for shadow root scenario)");DH2.children(e,t).forEach(r)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){DH2.forEachSelector(e,t,(e=>e.remove()))}static removeClsGlobally(e,...t){t.forEach((t=>DH2.forEachSelector(e,"."+t,(e=>e.classList.remove(t)))))}static up(e,t){return VersionHelper.deprecate("Core","6.0.0","DomHelper.up() deprecated, use native `element.closest()` instead"),e.closest(t)}static getAncestor(e,t,r=null){let n,i=!1,s=e;for(t=ArrayHelper.asArray(t);s=s.parentElement;){if(t.includes(s)){i=!0;break}if(r&&s===r)break;n=s}return i?n||e:null}static getParents(e){const t=[];for(;e.parentElement;)t.push(e.parentElement),e=e.parentElement;return t}static makeValidId(e,t=""){return StringHelper.makeValidDomId(e,t)}static createElement(e={},t){var r,n;let i,s,a,o,l,c,d,u,h,g,p,m=t;if("boolean"==typeof m)throw new Error("Clean up");t&&(l=t.ignoreRefs,h=t.refOwner,g=t.refs,m=t.returnAll,p=t.syncIdField,l&&(a=!0,l="children"!==l)),"string"==typeof e.parent&&(e.parent=document.getElementById(e.parent));const f=e.parent||e.nextSibling&&e.nextSibling.parentNode,{dataset:v,html:y,reference:b,syncOptions:C,text:D}=e;if(C&&(p=C.syncIdField||p,o=C.ignoreRefs,o&&(a=!0,l="children"!==o,t={...t,ignoreRefs:!0})),l&&(h=null),i=e.ns?doc.createElementNS(e.ns,e.tag||"svg"):doc.createElement(e.tag||"div"),null!=D?DH2.setInnerText(i,D):null!=y&&(y instanceof DocumentFragment?i.appendChild(y):i.innerHTML=y),e.tooltip&&DH2.Widget.attachTooltip(i,e.tooltip),e.style&&DH2.applyStyle(i,e.style),v)for(d in v)u=v[d],null!=u&&(i.dataset[d]=u);f&&this.addChild(f,i,e.nextSibling),h&&(i.$refOwnerId=h.id),b&&!l&&(h?(i.$reference=b,h.attachRef(b,i,e)):(g||((t=Object.assign({},t)).refs=g={}),g[b]=i,i.setAttribute("data-reference",b)));const S=e.className||e.class,E=Object.keys(e);for(S&&i.setAttribute("class",DomClassList.normalize(S)),s=0;s<E.length;++s)d=E[s],u=e[d],null!=(c=elementCreateExpandos[d])?i[c||d]=u:!elementCreateProperties[d]&&d&&null!=u&&i.setAttribute(d,u);return e["aria-hidden"]||e.role||e.tabIndex||DomHelper.isFocusable(i,!0)||i.htmlFor||i.setAttribute("role","presentation"),null==(n=null==t?void 0:t.callback)||n.call(t,{action:"newElement",domConfig:e,targetElement:i,syncId:h?b:t.syncIdField&&(null==(r=e.dataset)?void 0:r[t.syncIdField])}),!0===m?t.returnAll=m=[i]:Array.isArray(m)&&m.push(i),e.children&&(p&&(i.syncIdMap={}),e.children.forEach((r=>{var n,s,o;if(r)if("string"==typeof r){const e=document.createTextNode(r);h&&(e.$refOwnerId=h.id),i.appendChild(e)}else if(isNaN(r.nodeType)){r.parent=i,!r.ns&&e.ns&&(r.ns=e.ns);const l=DH2.createElement(r,{...t,ignoreRefs:null!=(s=null==(n=e.syncOptions)?void 0:n.ignoreRef)?s:a}),c=null==(o=r.dataset)?void 0:o[p];null!=c&&(i.syncIdMap[c]=l),delete r.parent}else i.appendChild(r)}))),i.lastDomConfig=e,g||m||i}static createElementFromTemplate(e,t=emptyObject4){const{array:r,raw:n,fragment:i}=t;let s;if(DH2.supportsTemplate){if((templateElement||(templateElement=doc.createElement("template"))).innerHTML=e,s=templateElement.content,i)return s.cloneNode(!0)}else if(s=(htmlParser||(htmlParser=new DOMParser)).parseFromString(e,"text/html").body,i){const e=s.childNodes;for(s=document.createDocumentFragment();e.length;)s.appendChild(e[0]);return s}return s=n?s.childNodes:s.children,1!==s.length||r?arraySlice.call(s):s[0]}static triggerMouseEvent(e,t="contextmenu"){const r=(this.isInView(e)||Rectangle.from(e)).center,n=new MouseEvent(t,{clientX:r.x,clientY:r.y,bubbles:!0});e.dispatchEvent(n)}static insertFirst(e,t){return t&&t.nodeType!==ELEMENT_NODE&&t.tag&&(t=DH2.createElement(t)),e.insertBefore(t,e.firstElementChild)}static insertBefore(e,t,r){return t&&t.nodeType!==ELEMENT_NODE&&t.tag&&(t=DH2.createElement(t)),r?e.insertBefore(t,r):DH2.insertFirst(e,t)}static insertAt(e,t,r){const n=Array.from(e.children);if(r>=n.length)return DH2.append(e,t);const i=n[r];return DH2.insertBefore(e,t,i)}static append(e,t){if(t.forEach){if(Array.isArray(t)&&(t=t.map((e=>elementOrConfigToElement(e)))),e.append)e.append(...t);else{const r=document.createDocumentFragment();t.forEach((function(e){r.appendChild(e)})),e.appendChild(r)}return t}return e.appendChild(elementOrConfigToElement(t))}static getTranslateX(e){const t=e.style.transform;let r=pxTtranslateXRe.exec(t);return r?parseFloat(r[2]):(r=translateMatrixRe.exec(t)||translateMatrixRe.exec(DH2.getStyleValue(e,"transform")),r?parseFloat(r[1]||r[3]):0)}static getTranslateY(e){const t=e.style.transform;let r=pxTtranslateYRe.exec(t);if(r){const e=parseFloat(r["Y"===r[1]?2:3]);return isNaN(e)?0:e}return r=translateMatrixRe.exec(t)||translateMatrixRe.exec(DH2.getStyleValue(e,"transform")),r?parseFloat(r[2]||r[4]):0}static getTranslateXY(e){return[DH2.getTranslateX(e),DH2.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[DH2.getOffsetX(e,t),DH2.getOffsetY(e,t)]}static focusWithoutScrolling(e){if(!BrowserHelper.isSafari)e.focus({preventScroll:!0});else{const t=DH2.getParents(e).map((e=>({element:e,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})));e.focus(),setTimeout((()=>function(e){e.forEach((({element:e,scrollLeft:t,scrollTop:r})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==r&&(e.scrollTop=r)}))}(t)),0)}}static getPageX(e){return e.getBoundingClientRect().left+win.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+win.pageYOffset}static getExtremalSizePX(e,t){const r=StringHelper.hyphenate(t),n=r.split("-")[1];let i=DH2.getStyleValue(e,r);return i=/%/.test(i)?e.parentElement?parseInt(DH2.getStyleValue(e.parentElement,n),10):NaN:parseInt(i,10),i}static setScale(e,t,r=t){const n=DH2.getStyleValue(e,"transform").split(/,\s*/);n.length>1?(n[0].startsWith("matrix3d")?(n[0]="matrix3d("+t,n[5]=r):(n[0]="matrix("+t,n[3]=r),e.style.transform=n.join(",")):e.style.transform="scale("+t+", "+r+")"}static setTranslateX(e,t){const r=DH2.getStyleValue(e,"transform").split(/,\s*/);t=DH2.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=t,e.style.transform=r.join(",")):e.style.transform="translateX("+t+"px)"}static setTranslateY(e,t){const r=DH2.getStyleValue(e,"transform").split(/,\s*/);t=DH2.roundPx(t),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=t,e.style.transform=r.join(",")+")"):e.style.transform="translateY("+t+"px)"}static setTop(e,t){DH2.setLength(e,"top",t)}static setLeft(e,t){DH2.setLength(e,"left",t)}static setTopLeft(e,t,r){DH2.setLength(e,"top",t),DH2.setLength(e,"left",r)}static setRect(e,{x:t,y:r,width:n,height:i}){DH2.setTopLeft(e,r,t),DH2.setLength(e,"width",n),DH2.setLength(e,"height",i)}static setTranslateXY(e,t,r){if(null==t)return DH2.setTranslateY(e,r);if(null==r)return DH2.setTranslateX(e,t);t=DH2.roundPx(t),r=DH2.roundPx(r);const n=DH2.getStyleValue(e,"transform").split(/,\s*/),i=n[0].startsWith("matrix3d");n.length>1?(n[i?12:4]=t,n[i?13:5]=r,e.style.transform=n.join(",")+")"):e.style.transform="translate("+t+"px, "+r+"px)"}static addTranslateX(e,t){DH2.setTranslateX(e,DH2.getTranslateX(e)+t)}static addTranslateY(e,t){DH2.setTranslateY(e,DH2.getTranslateY(e)+t)}static addLeft(e,t){DH2.setLeft(e,DH2.getOffsetX(e)+t)}static addTop(e,t){DH2.setTop(e,DH2.getOffsetY(e)+t)}static alignTo(e,t,r=t0t0,n){t=t instanceof Rectangle?t:Rectangle.from(t,!0);const i=DH2.getTranslateXY(e),s=Rectangle.from(e,!0);n&&(s.roundPx(),t.roundPx());const a=s.alignTo(Object.assign(r,{target:t}));DH2.setTranslateXY(e,i[0]+a.x-s.x,i[1]+a.y-s.y)}static getStyleValue(e,t,r,n){const i=r?e.style:e.ownerDocument.defaultView.getComputedStyle(e,n);if(Array.isArray(t)){const e={};for(const r of t)e[r]=i.getPropertyValue(StringHelper.hyphenate(r));return e}return i.getPropertyValue(StringHelper.hyphenate(t))}static getEdgeSize(e,t,r){const n="border"===t?"-width":"",i={raw:{}};for(const s of["top","right","bottom","left"])r&&!r.includes(s[0])||(i[s]=parseFloat(i.raw[s]=DH2.getStyleValue(e,t+"-"+s+n)));return i.width=(i.left||0)+(i.right||0),i.height=(i.top||0)+(i.bottom||0),i}static parseStyle(e){if("string"==typeof e){const t=e.split(semicolonRe);e={};for(let r=0,{length:n}=t;r<n;r++){const n=t[r].split(colonRe);e[n[0]]=n[1]}}return e||{}}static applyStyle(e,t,r=!1){if("string"==typeof t)r?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else if(t){let n,i;for(n in r&&(e.style.cssText=""),t.style&&"string"!=typeof t.style&&(t=ObjectHelper.assign({},t,t.style)),t)styleIgnoreProperties[n]||([n,i]=DH2.unitize(n,t[n]),null==i?e.style.removeProperty(n):e.style.setProperty(n,i));"string"==typeof t.style&&(e.style.cssText+=t.style)}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(const r in e)styleIgnoreProperties[r]||(t+=StringHelper.hyphenate(r)+":"+e[r]+";");return t}static addClasses(e,t){VersionHelper.deprecate("Core","6.0.0","DomHelper.addClasses should be replaced by native classList.add"),e.classList.add(...t)}static removeClasses(e,t){VersionHelper.deprecate("Core","6.0.0","DomHelper.removeClasses should be replaced by native classList.remove"),e.classList.remove(...t)}static toggleClasses(e,t,r=null){t=ArrayHelper.asArray(t),!0===r?e.classList.add(...t):!1===r?e.classList.remove(...t):t.forEach((t=>e.classList.toggle(t)))}static addTemporaryClass(e,t,r,n=globalThis){r>0&&(e.classList.add(t),n.setTimeout({fn:t=>e.classList.remove(t),delay:r,name:t,args:[t],cancelOutstanding:!0}))}static getPropertyTransitionDuration(e,t){const r=globalThis.getComputedStyle(e),n=r.transitionProperty.split(", "),i=r.transitionDuration.split(", "),s=n.indexOf(StringHelper.hyphenate(t));let a;return-1!==s&&(a=1e3*parseFloat(i[s])),a}static getAnimationDuration(e){return 1e3*parseFloat(DH2.getStyleValue(e,"animation-duration"))}static highlight(e,t=globalThis){return e instanceof Rectangle?e.highlight():new Promise((r=>{t.setTimeout((()=>{e.classList.add("b-fx-highlight"),t.setTimeout((()=>{e.classList.remove("b-fx-highlight"),r()}),1e3)}),0)}))}static get scrollBarWidth(){if(null===scrollBarWidth&&doc.body){const e=scrollBarMeasureElement||(scrollBarMeasureElement=DH2.createElement({parent:doc.body,style:"position:absolute;top:-9999em;height:100px;overflow-y:scroll"}));e.parentNode!==doc.body&&doc.body.appendChild(e),scrollBarWidth=e.offsetWidth}return scrollBarWidth}static get scrollBarPadElement(){return{className:"b-yscroll-pad",children:[{className:"b-yscroll-pad-sizer"}]}}static resetScrollBarWidth(){scrollBarWidth=null}static measureText(e,t,r=!1,n=void 0){const i=DH2.getMeasureElement(t,n);i[r?"innerHTML":"innerText"]=e;const s=i.clientWidth;return i.className="",s}static measureSize(e,t,r=!0){if(!e)return 0;if("number"==typeof e)return e;if(!e.length)return 0;if(/^\d+(px)?$/.test(e))return parseInt(e);if(t){const n=DH2.getMeasureElement(t);n.innerHTML="",n.style.width=DH2.setLength(e);const i=r?n.offsetWidth:n.getBoundingClientRect().width;return n.style.width=n.className="",i}return/^\d+em$/.test(e)?parseInt(e)*DEFAULT_FONT_SIZE:isNaN(e)?0:parseInt(e)}static getMeasureElement(e,t=doc.body){const r=win.getComputedStyle(e),n=t.offScreenDiv=t.offScreenDiv||DH2.createElement({parent:t,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},{returnAll:!0})[1];return fontProps.forEach((e=>{n.style[e]!==r[e]&&(n.style[e]=r[e])})),n.className=e.className,n.parentElement.parentElement!==t&&t.appendChild(n.parentElement),n}static stripTags(e){return(DH2.$domParser||(DH2.$domParser=new DOMParser)).parseFromString(e,"text/html").body.textContent}static sync(e,t){if("string"==typeof e){if(""===e)return void(t.innerHTML="");e=DH2.createElementFromTemplate(e)}return DH2.performSync(e,t),t}static performSync(e,t){return e.outerHTML!==t.outerHTML&&(DH2.syncAttributes(e,t),DH2.syncContent(e,t),DH2.syncChildren(e,t),!0)}static getSyncAttributes(e){const t={},r=[];for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];if(i.specified){const e=i.name.toLowerCase();t[e]=i.value,r.push(e)}}return{attributes:t,names:r}}static syncAttributes(e,t){const{attributes:r,names:n}=DH2.getSyncAttributes(e),{attributes:i,names:s}=DH2.getSyncAttributes(t),a=n.includes("dataset"),o=n.filter((e=>!s.includes(e))),l=s.filter((e=>!(n.includes(e)||a&&e.startsWith("data-")))),c=n.filter((e=>s.includes(e)));if(o.length>0)for(let e=0;e<o.length;e++){const n=o[e];"style"===n?DH2.applyStyle(t,r.style,!0):"dataset"===n?Object.assign(t.dataset,r.dataset):t.setAttribute(n,r[n])}if(l.length>0)for(let e=0;e<l.length;e++)t.removeAttribute(l[e]);if(c.length>0)for(let e=0;e<c.length;e++){const n=c[e];if("style"===n)DH2.applyStyle(t,r.style,!0);else if("dataset"===n)Object.assign(t.dataset,r.dataset);else if("class"!==n||!r.class.isDomClassList&&"object"!=typeof r.class)i[n]!==r[n]&&t.setAttribute(n,r[n]);else{let e;e=r.class.isDomClassList?r.class:new DomClassList(r.class),e.isEqual(i.class)||t.setAttribute("class",e)}}}static syncContent(e,t){0===DH2.getChildElementCount(e)&&(t.innerText=e.innerText)}static setInnerText(e,t){const{firstChild:r}=e;(null==r?void 0:r.nodeType)===Element.TEXT_NODE?r.data=t:e.textContent=t}static syncChildren(e,t){const r=this,n=arraySlice.call(e.childNodes),i=arraySlice.call(t.childNodes);for(;n.length;){const e=n.shift(),s=i.shift();if(e&&e.nodeType!==TEXT_NODE&&e.nodeType!==ELEMENT_NODE)throw new Error("Source node type "+e.nodeType+" not supported by DomHelper.sync()");if(s&&s.nodeType!==TEXT_NODE&&s.nodeType!==ELEMENT_NODE)throw new Error("Target node type "+s.nodeType+" not supported by DomHelper.sync()");if(s)if(e.nodeType===s.nodeType)e.nodeType===TEXT_NODE?s.data=e.data:e.tagName===s.tagName?r.performSync(e,s):(t.insertBefore(e,s),s.remove());else{if(e.nodeType!==TEXT_NODE||s.nodeType!==ELEMENT_NODE){e.parentElement;throw new Error("当前不支持转换nodeType")}t.innerText=e.data.trim()}else t.appendChild(e)}i.forEach((e=>{e.remove()}))}static syncClassList(e,t){const{classList:r}=e,n="string"==typeof t,i=n?t.split(whiteSpaceRe2):DomClassList.normalize(t,"array"),s=i.length;let a,o=r.length!==s;for(a=0;!o&&a<s;a++)o=!r.contains(i[a]);return o&&(e.className=n?t:i.join(" ")),o}static updateClassList(e,t){const{classList:r}=e;let n,i,s=!1;for(n in t)i=Boolean(t[n]),r.contains(n)!==i&&(r[i?"add":"remove"](n),s=!0);return s}static setTheme(e,t){e=e.toLowerCase();const{head:r}=document,n=DH2.getThemeInfo(t).name.toLowerCase();let i=r.querySelectorAll("[data-gantt-theme]:not([data-loading])"),s=0;if(n===e)return immediatePromise;DH2.removeEachSelector(r,"#gantt-theme[data-loading],link[data-gantt-theme][data-loading]");const a={theme:e,prev:n};function o(t,r,o){const l=DomHelper.createElement({tag:"link",rel:"stylesheet",dataset:{loading:!0,ganttTheme:!0},href:t.href.replace(n,e),nextSibling:t});l.addEventListener("load",(()=>{delete l.dataset.loading,themeInfo=null,++s===i.length&&(i.forEach((e=>e.remove())),GlobalEvents_default.trigger("theme",a),r(a))})),l.addEventListener("error",(e=>{delete l.dataset.loading,o(e)}))}if(i.length)return new Promise(((e,t)=>{i.forEach(((r,n)=>{o(r,e,t,i.length)}))}));{const e=r.querySelector("#gantt-theme:not([data-loading])")||r.querySelector('[href*="'+n+'.css"]:not([data-loading])');if(!(null==e?void 0:e.href.includes(n+".css")))throw new Error("Theme link for "+n+" not found");return i=[e],new Promise(((t,r)=>o(e,t,r)))}}static get themeInfo(){return DomHelper.getThemeInfo()}static getThemeInfo(e){if(!themeInfo){const t=DH2.createElement({parent:document.body,className:"b-theme-info"}),r=DH2.getStyleValue(t,"content",!1,":before");if(r)try{themeInfo=JSON.parse(r.replace(/^["']|["']$|\\/g,""))}catch(e){themeInfo=null}themeInfo=themeInfo||(e?{name:e}:null),t.remove()}return themeInfo}static async transition({element:e,selector:t="[data-dom-transition]",duration:r,action:n,thisObj:i=this,addTransition:s={},removeTransition:a={}}){const o=new Set,l=Array.from(e.querySelectorAll(t)),c=new Map(l.map((t=>{let r=0,n=t.parentElement;for(;n&&n!==e;)r++,n=n.parentElement;t.$depth=r,t.scrollHeight>t.offsetHeight&&"auto"===getComputedStyle(t).overflow&&(t.$scrollTop=t.scrollTop,o.add(t));const{parentElement:i}=t,s=Rectangle.from(t,e),a=Rectangle.from(t,i),l=getComputedStyle(i),c=parseFloat(l.borderLeftWidth);return c&&(s.left-=c,a.left-=c),[t.id,{element:t,globalBounds:s,localBounds:a,depth:r,parentElement:i}]})));n.call(i);const d=Array.from(e.querySelectorAll(t)),u=new Map(d.map((t=>{const r=Rectangle.from(t,e),n=Rectangle.from(t,t.parentElement),i=globalThis.getComputedStyle(t.parentElement),s=parseFloat(i.borderLeftWidth);return s&&(r.left-=s,n.left-=s),[t.id,{element:t,globalBounds:r,localBounds:n}]}))),h=["position","top","left","width","height","padding","margin","zIndex","minWidth","minHeight","opacity","overflow"];for(const[t,r]of c){const n=u.get(t);if(n){const{element:t}=n,{style:i,parentElement:s}=t,a=parseInt(DH2.getStyleValue(t,"zIndex")),{globalBounds:l,localBounds:c,depth:d,parentElement:u}=r,g=u!==s;let p;ObjectHelper.copyProperties(t.$initial={parentElement:s},i,h),g?(n.bounds=n.globalBounds,p=l,e.appendChild(t)):(n.bounds=n.localBounds,p=c,u.appendChild(t));let m="hidden";o.has(t)&&(t.$scrollPlaceholder=DH2.createElement({parent:t,style:{height:t.scrollHeight}}),m="auto");const f={position:"absolute",top:p.top+"px",left:p.left+"px",width:p.width+"px",height:p.height+"px",minWidth:0,minHeight:0,margin:0,zIndex:d+(a||0),overflow:m};"preserve-padding"!==t.dataset.domTransition&&(f.padding=0),Object.assign(i,f),n.processed=!0}else{const{element:e,localBounds:n,depth:i,parentElement:s}=r;e.$initial={removed:!0},Object.assign(e.style,{position:"absolute",top:n.top+"px",left:n.left+"px",width:n.width+"px",height:n.height+"px",minWidth:0,minHeight:0,padding:0,margin:0,zIndex:i,overflow:"hidden"}),s.appendChild(e),u.set(t,{element:e,bounds:n,removed:!0,processed:!0}),d.push(e)}}for(const[,e]of u)if(!e.processed){const{element:t}=e,{style:r,parentElement:n}=t,i=e.bounds=e.localBounds;t.classList.add("b-dom-transition-adding"),ObjectHelper.copyProperties(t.$initial={parentElement:n},r,h),Object.assign(r,{position:"absolute",top:s.top?0:i.top+"px",left:s.left?0:i.left+"px",width:s.width?0:i.width+"px",height:s.height?0:i.height+"px",opacity:s.opacity?0:null,zIndex:n.$depth+1,overflow:"hidden"})}for(const e of o)e.scrollTop=e.$scrollTop;e.classList.add("b-dom-transition"),e.firstElementChild.offsetWidth;for(const[,{element:e,bounds:t,removed:r}]of u)r?Object.assign(e.style,{top:a.top?0:t.top+"px",left:a.left?0:t.left+"px",width:a.width?0:t.width+"px",height:a.height?0:t.height+"px",opacity:a.opacity?0:e.$initial.opacity}):Object.assign(e.style,{top:t.top+"px",left:t.left+"px",width:t.width+"px",height:t.height+"px",opacity:e.$initial.opacity});await AsyncHelper.sleep(r),e.classList.remove("b-dom-transition");for(const e of d)e.$initial&&(e.$initial.removed?e.remove():(ObjectHelper.copyProperties(e.style,e.$initial,h),e.$scrollPlaceholder&&(e.$scrollPlaceholder.remove(),delete e.$scrollPlaceholder),e.classList.remove("b-dom-transition-adding"),e.$initial.parentElement.appendChild(e)));for(const e of o)e.scrollTop=e.$scrollTop,delete e.$scrollTop}static async loadScript(e){return new Promise(((t,r)=>{const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=r,document.head.appendChild(n)}))}static isNamedColor(e){return e&&!/^(#|hsl|rgb|hwb)/.test(e)}static get NodeFilter(){return NodeFilter}static addChild(e,t,r){e.insertBefore(t,r)}},DH2=DomHelper,clearTouchEvent=()=>DH2.isTouchEvent=!1,setTouchEvent=()=>{DH2.isTouchEvent=!0,clearTimeout(clearTouchTimer),clearTouchTimer=setTimeout(clearTouchEvent,400)};if(doc.addEventListener("touchstart",setTouchEvent,!0),doc.addEventListener("touchend",setTouchEvent,!0),DH2.canonicalStyles=canonicalStyles,DH2.supportsTemplate="content"in doc.createElement("template"),DH2.elementPropKey=elementPropKey,DH2.numberRe=numberRe,!("children"in Node.prototype)){const e=e=>e.nodeType===e.ELEMENT_NODE;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let r=t.length;for(;--r>=0&&t.item(r)!==this;);return r>-1}),win.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){let t=this;if(!doc.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&t.nodeType===t.ELEMENT_NODE);return null}:Node.prototype.closest=function(e){var t;return null==(t=this.parentNode)?void 0:t.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach((function(e){Object.prototype.hasOwnProperty.call(e,"remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})),globalThis.addEventListener("resize",(()=>scrollBarWidth=null)),DomHelper._$name="DomHelper";var globaltouchStart,isFloatingWidget=e=>e.floating,GlobalEvents=new class extends(Base.mixin(Events_default)){suspendFocusEvents(){focusEventsSuspended=!0}resumeFocusEvents(){focusEventsSuspended=!1}setupFocusListenersOnce(e,t){e&&!GlobalEvents.observedElements.has(e)&&(GlobalEvents.setupFocusListeners(e,t),GlobalEvents.observedElements.add(e))}setupFocusListeners(e=document,t,r=!1){const n={element:e,touchstart(e){globaltouchStart=globaltouchStart||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{globaltouchStart&&(globaltouchStart.identifier===t.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===globaltouchStart.identifier&&GlobalEvents.trigger("globaltap",{event:e}),globaltouchStart=null)},passive:!1},mousedown:{handler:e=>{lastInteractionType="mouse",globaltouchStart||GlobalEvents.trigger("globaltap",{event:e}),currentMouseDown=e;const t=e.ctrlKey||e.altKey||e.shiftKey||e.metaKey;!currentKeyDown&&t?currentKeyDown=new KeyboardEvent("keydown",{key:e.ctrlKey?"Control":e.shiftKey?"Shift":e.altKey?"Alt":"Meta",ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey}):currentKeyDown&&!t&&(currentKeyDown=null)},passive:!1},mouseup(){currentMouseDown=null},pointerdown:{passive:!1,handler:e=>{currentPointerDown=e}},pointerup:{passive:!1,handler:e=>{(null==currentPointerDown?void 0:currentPointerDown.pointerId)===e.pointerId&&(currentPointerDown=null)}},keydown(e){lastInteractionType="key",currentKeyDown=e},keypress(){lastInteractionType="key"},keyup(){currentKeyDown=null},focusin(e){var t;const{Widget:r}=GlobalEvents;if(r.resetFloatRootScroll(),focusEventsSuspended)return;const n=e.relatedTarget?e.relatedTarget instanceof HTMLElement?e.relatedTarget:document.body:null,i=e.target||document.body,s=r.fromElement(n),a=r.fromElement(i),o=DomHelper.getCommonAncestor(s,a),l=!!(n&&4&i.compareDocumentPosition(n)),c=r.query(isTopVisibleModal);let d=null;if(d=i&&i!==document.body?DomHelper.getActiveElement(i):DomHelper.getActiveElement(document),c&&!c._isRevertingFocus&&(!a||!c.owns(a)&&!(4&c.element.compareDocumentPosition(a.element)&&a.up(isFloatingWidget))))return c.focus();let u=createWidgetEvent("focusout",n,e.target,s,a,l);for(let t,r=s;r&&r!==o;r=t)if(t=r.owner,!r.isDestroying&&r.onFocusOut&&(r.onFocusOut(u),e.target&&d!==DomHelper.getActiveElement(e.target)))return;if(o&&e.target===o.element)!o.isDestroying&&DomHelper.getActiveElement(o)===i&&o.focusElement&&o.focusElement!==o.element&&(o.element.contains(d)&&!o.focusDescendant||o.setTimeout((()=>{var e;return null==(e=o.focus)?void 0:e.call(o)}),0));else{u=createWidgetEvent("focusin",i,n,s,a,l);for(let e=a;e&&e!==o;e=e.owner)e.isDestroying||null==(t=e.onFocusIn)||t.call(e,u)}const h=DomHelper.getCommonAncestor((null==n?void 0:n.nodeType)===Element.ELEMENT_NODE?n:null,i)||i.parentNode;h&&(u=createWidgetEvent("focusmove",i,n,s,a,l,{bubbles:!0}),h.dispatchEvent(u))},focusout(e){if(!(focusEventsSuspended||e.relatedTarget&&GlobalEvents.Widget.fromElement(e.relatedTarget))){const t=e.relatedTarget&&e.relatedTarget instanceof HTMLElement?e.relatedTarget:null;n.focusin({target:t,relatedTarget:e.target}),currentKeyDown=currentMouseDown=null}},blur:{element:globalThis,handler(e){e.target===globalThis&&(currentKeyDown=null,currentMouseDown=null)}},capture:!0,passive:!0};r&&(null==detacher||detacher()),detacher=this.detachEvents=t.on(n)}get lastInteractionType(){return lastInteractionType}get shiftKeyDown(){return null==currentKeyDown?void 0:currentKeyDown.shiftKey}get ctrlKeyDown(){return(null==currentKeyDown?void 0:currentKeyDown.ctrlKey)||(null==currentKeyDown?void 0:currentKeyDown.metaKey)}get altKeyDown(){return null==currentKeyDown?void 0:currentKeyDown.altKey}isKeyDown(e){return e?(null==currentKeyDown?void 0:currentKeyDown.key)===e||!0===currentKeyDown[(null==e?void 0:e.toLowerCase())+"Key"]:Boolean(currentKeyDown)}isMouseDown(e=0){return(null==currentMouseDown?void 0:currentMouseDown.button)===e}get currentMouseDown(){return currentMouseDown}get currentPointerDown(){return currentPointerDown}get currentTouch(){return globaltouchStart}get currentKeyDown(){return currentKeyDown}},isTopVisibleModal=e=>e.isVisible&&e.isTopModal;GlobalEvents.observedElements=new Set;var lastInteractionType,currentKeyDown,currentMouseDown,currentPointerDown,detacher,focusEventsSuspended=!1;function createWidgetEvent(e,t,r,n,i,s,a){const o=new CustomEvent(e,a);return Object.defineProperty(o,"_target",{get:()=>t}),Object.defineProperty(o,"relatedTarget",{get:()=>r}),o.fromWidget=n,o.toWidget=i,o.backwards=s,o}var GlobalEvents_default=GlobalEvents;function getDescriptor(e,t){const r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t);return r&&(r.get||r.set)?r:null}var InstancePlugin=class extends(Base.mixin(Events_default,Localizable_default)){static get configurable(){return{clientListeners:null,disabled:!1,client:null,keyMap:null}}updateClient(e){this.owner||(this.owner=e)}updateKeyMap(e){const{client:t}=this;t.keyMap=t.mergeKeyMaps(t.keyMap,e,StringHelper.uncapitalize(this.constructor.$name))}static initPlugins(e,...t){const r=e.plugins||(e.plugins={});for(const n of t)r[n.$$name]=new n(e)}get enabled(){return!this.disabled}getFocusRevertTarget(){var e;return null==(e=this.client)?void 0:e.getFocusRevertTarget()}construct(...e){const t=this;let r,[n,i]=e;1===e.length?ObjectHelper.isObject(n)&&(i=n,n=i.client):(i=ObjectHelper.assign({},i),delete i.client),t.client=n,super.construct(i),t.applyPluginConfig(n),r=t.clientListeners,r&&(r=ObjectHelper.assign({},r),r.thisObj=t,n.ion(r))}applyPluginConfig(e){const t=this,r=t.pluginConfig||t.constructor.pluginConfig;if(r){const{assign:n,chain:i,after:s,before:a,override:o}=r;n&&t.applyAssign(e,n),(i||s)&&t.applyChain(e,i||s),a&&t.applyChain(e,a,!1),o&&t.applyOverride(e,o)}}applyAssign(e,t){t.forEach((t=>this.assign(e,t)))}applyChain(e,t,r=!0){if(Array.isArray(t))for(const n of t)this.chain(e,n,n,r);else for(const n in t)this.chain(e,n,t[n],r)}applyOverride(e,t){const r=this;r.overridden||(r.overridden={}),t.forEach((t=>{if(!r[t])throw new Error("Trying to chain fn "+e.$$name+"#"+t+", but plugin fn "+r.$$name+"#"+t+" does not exist");"function"==typeof e[t]&&(r.overridden[t]=e[t].bind(e)),e[t]=r[t].bind(r)}))}assign(e,t){const r=this,n=getDescriptor(r,t);n?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n.get&&n.get.bind(r),set:n.set&&n.set.bind(r)}):e[t]=r[t].bind(r)}chain(e,t,r,n=!0){let i=0;"object"==typeof t&&(t=t.fn),"object"==typeof r&&(i=r.prio||0,r=r.fn);const s=this,a=e.pluginFunctionChain||(e.pluginFunctionChain={}),o=s[r]&&s[r].bind(s),l=s.functionChainRunner;if(!o)throw new Error("Trying to chain fn "+e.$$name+"#"+r+", but plugin fn "+s.$$name+"#"+r+" does not exist");if(!a[t]){let r=e[t];r&&(r=r.bind(e),r.$this=e,r.$prio=0),a[t]=r?[r]:[],e[t]=(...e)=>l(a[t],e)}o.$this=s,o.$prio=i,a[t][n?"push":"unshift"](o),a[t].$sorted=!1}functionChainRunner(e,t){let r,n,i;for(e.$sorted||(e.sort(((e,t)=>t.$prio-e.$prio)),e.$sorted=!0),n=0;n<e.length&&(r=e[n],r.$this.isDestroyed||(i=r(...t),!1!==i));n++);return i}doDisable(e){var t,r;const n=this,{constructor:i}=n,s="featureClass"in i?i.featureClass:"b-"+i.$$name.toLowerCase();s&&(null==(r=null==(t=n.client)?void 0:t.element)||r.classList[e?"remove":"add"](s)),n.isConfiguring||(e?n.trigger("disable"):n.trigger("enable"))}updateDisabled(e){this.doDisable(e)}throwOverrideIsMissing(e){throw new Error("Trying to override fn "+e.plugIntoName+"#"+e.fnName+", but plugin fn "+e.pluginName+"#"+e.fnName+" does not exist")}get rootElement(){return this.client.rootElement}};__publicField(InstancePlugin,"$name","InstancePlugin"),InstancePlugin._$name="InstancePlugin";var performance2,Pluggable_default=e=>class extends(e||Base){static get $name(){return"Pluggable"}get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),InstancePlugin.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){InstancePlugin.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){var t;return"function"==typeof e&&(e=e.$$name),null==(t=this.plugins)?void 0:t[e]}get widgetClass(){}},{defineProperty:defineProperty3}=Reflect;performance2=BrowserHelper.isBrowserEnv?globalThis.performance:{now:()=>(new Date).getTime()};var globalDelays=null;if(VersionHelper.isTestEnv){const e=globalThis.gantt||(globalThis.gantt={});globalDelays=e.globalDelays={timeouts:new Map,intervals:new Map,animationFrames:new Map,idleCallbacks:new Map,isEmpty:(e=!1)=>globalDelays.timeouts.size+globalDelays.animationFrames.size+globalDelays.idleCallbacks.size+(e?globalDelays.intervals.size:0)===0,getFiltered({ignoreTimeouts:e=[],maxDelay:t=5e3,includeIntervals:r=!1}){const n=[],i=["timeouts","animationFrames","idleCallbacks"];r&&i.push("intervals");for(const r of i){const i=globalDelays[r];for(const[,r]of i.entries())e.includes(r.name)||Number.isInteger(r.delay)&&!(r.delay<t)||n.push(r)}return n}}}var makeInvoker=(e,t,r,n)=>{const i="string"==typeof t,s=(null==n?void 0:n.appendArgs)||[],a=()=>{r.timerId=null,r.lastCallTime=performance2.now();const n=r.args;r.args=null,i?e[t](...n,...s):t.call(e,...n,...s),r.called=!0,++r.calls};return n&&(e=n.thisObj||e),r.lastCallTime=-9e9,r.calls=0,r.invoker=a,a.wrapFn=r,a},decorateWrapFn=(e,t,r="clearTimeout")=>(t.cancel=()=>{t.isPending&&(e[r](t.timerId),t.args=t.timerId=null)},t.flush=()=>{t.isPending&&(e[r](t.timerId),t.timerId=null,t.invoker())},t.now=(...e)=>{t.cancel(),t.args=e,t.invoker()},t.resume=e=>{const r=t.suspended;t.suspended=e||r<1?0:r-1},t.suspend=()=>{++t.suspended},t.immediate=!1,t.suspended=0,t.timerId=null,defineProperty3(t,"isPending",{get:()=>null!==t.timerId}),t),Delayable_default=e=>class extends(e||Base){static get $name(){return"Delayable"}static get declarable(){return["delayable"]}doDestroy(){const e=this;super.doDestroy(),e.timeoutIds&&(e.timeoutIds.forEach(((e,t)=>{"function"==typeof e&&e(),clearTimeout(t),null==globalDelays||globalDelays.timeouts.delete(t)})),e.timeoutIds=null),e.timeoutMap&&(e.timeoutMap.forEach(((e,t)=>clearTimeout(t))),e.timeoutMap=null),e.intervalIds&&(e.intervalIds.forEach((e=>{clearInterval(e),null==globalDelays||globalDelays.intervals.delete(e)})),e.intervalIds=null),e.animationFrameIds&&(e.animationFrameIds.forEach((e=>{cancelAnimationFrame(e),null==globalDelays||globalDelays.animationFrames.delete(e)})),e.animationFrameIds=null),e.idleCallbackIds&&(e.idleCallbackIds.forEach((e=>{cancelIdleCallback(e),null==globalDelays||globalDelays.idleCallbacks.delete(e)})),e.idleCallbackIds=null)}hasTimeout(e){var t;return Boolean(null==(t=this.timeoutMap)?void 0:t.has(e))}setTimeout({fn:e,delay:t,name:r,runOnDestroy:n,cancelOutstanding:i,args:s}){(arguments.length>1||"function"==typeof arguments[0])&&([e,t,r,n]=arguments),"string"==typeof e?r=e:r||(r=e.name||e),i&&this.clearTimeout(r);const a=this,o=a.timeoutIds||(a.timeoutIds=new Map),l=a.timeoutMap||(a.timeoutMap=new Map),c=setTimeout((()=>{"string"==typeof e&&(e=a[r]),null==o||o.delete(c),null==l||l.delete(r),null==globalDelays||globalDelays.timeouts.delete(c),e.apply(a,s)}),t);return o.set(c,!n||e),null==globalDelays||globalDelays.timeouts.set(c,{fn:e,delay:t,name:r}),r&&l.set(r,c),c}clearTimeout(e){var t;let r=e;if("string"==typeof r){if(!this.timeoutMap)return;r=this.timeoutMap.get(e),this.timeoutMap.delete(e)}clearTimeout(r),null==(t=this.timeoutIds)||t.delete(r),null==globalDelays||globalDelays.timeouts.delete(r)}clearInterval(e){var t;clearInterval(e),null==(t=this.intervalIds)||t.delete(e),null==globalDelays||globalDelays.intervals.delete(e)}setInterval(e,t,r){const n=setInterval(e,t);return(this.intervalIds||(this.intervalIds=new Set)).add(n),null==globalDelays||globalDelays.intervals.set(n,{fn:e,delay:t,name:r}),n}requestAnimationFrame(e,t=[],r=this){const n=this.animationFrameIds||(this.animationFrameIds=new Set),i=requestAnimationFrame((()=>{null==globalDelays||globalDelays.animationFrames.delete(i),n.delete(i)&&e.apply(r,t)}));return n.add(i),null==globalDelays||globalDelays.animationFrames.set(i,{fn:e,extraArgs:t,thisObj:r}),i}requestIdleCallback(e,t=[],r=this){const n=this.idleCallbackIds||(this.idleCallbackIds=new Set),i=requestIdleCallback((()=>{null==globalDelays||globalDelays.idleCallbacks.delete(i),n.delete(i)&&e.apply(r,t)}));return n.add(i),null==globalDelays||globalDelays.idleCallbacks.set(i,{fn:e,extraArgs:t,thisObj:r}),i}createOnFrame(e,t=[],r=this,n){let i;const s=(...s)=>{null!=i&&n&&(this.cancelAnimationFrame(i),i=null),null==i&&(i=this.requestAnimationFrame((()=>{"string"==typeof e&&(e=r[e]),i=null,s.push(...t),e.apply(r,s)})))};return s.cancel=()=>this.cancelAnimationFrame(i),s}cancelAnimationFrame(e){var t;cancelAnimationFrame(e),null==(t=this.animationFrameIds)||t.delete(e),null==globalDelays||globalDelays.animationFrames.delete(e)}cancelIdleCallback(e){var t;cancelIdleCallback(e),null==(t=this.idleCallbackIds)||t.delete(e),null==globalDelays||globalDelays.idleCallbacks.delete(e)}async nextAnimationFrame(){return new Promise((e=>this.requestAnimationFrame(e)))}buffer(e,t){let r=t;t&&"number"!=typeof t?r=t.delay:t=null;const n=(...e)=>{if(n.suspended)return;const{delay:t}=n;n.cancel(),n.called=!1,n.args=e,n.immediate||!t?i():n.timerId=this.setTimeout(i,t)},i=makeInvoker(this,e,n,t);return n.delay=r,decorateWrapFn(this,n)}raf(e,t){let r=t;t&&"boolean"!=typeof t?r=t.cancelOutstanding:t=null;const n=(...e)=>{n.suspended||(n.cancelOutstanding&&n.cancel(),n.called=!1,n.args=e,n.immediate?i():n.isPending||(n.timerId=this.requestAnimationFrame(i)))},i=makeInvoker(this,e,n,t);return n.cancelOutstanding=r,decorateWrapFn(this,n,"cancelAnimationFrame")}idle(e,t){let r=t;t&&"boolean"!=typeof t?r=t.cancelOutstanding:t=null;const n=(...e)=>{n.suspended||(n.cancelOutstanding&&n.cancel(),n.called=!1,n.args=e,n.immediate?i():n.isPending||(n.timerId=this.requestIdleCallback(i)))},i=makeInvoker(this,e,n,t);return n.cancelOutstanding=r,this.setTimeout((()=>this.idleCallbackIds.delete(n.timerId)&&n.now()),100),decorateWrapFn(this,n,"cancelIdleCallback")}throttle(e,t){let r,n=t;t&&"number"!=typeof t?(n=t.delay,r=t.throttled):t=null;const i=this,s=(...e)=>{if(s.suspended)return;const{delay:t}=s,n=performance2.now()-s.lastCallTime;s.args=e,s.immediate||n>=t?(i.clearTimeout(s.timerId),a()):(s.isPending||(s.timerId=i.setTimeout(a,t-n),s.called=!1),r&&(r.wrapFn.args=e,r()))},a=makeInvoker(i,e,s,t);return s.delay=n,r&&(r=makeInvoker(i,r,(()=>{}),t)),decorateWrapFn(i,s)}static setupDelayable(e){e.setupDelayableMethods(e.delayable)}static setupDelayableMethods(e,t=null){const r=e.static,n=t||this.prototype;r&&delete e.static;for(const t in e){let r=e[t];const i=t+"Now",s=typeof r;n[i]||(n[i]=n[t]),"number"===s?r={type:"buffer",delay:r}:"string"===s&&(r={type:r}),defineProperty3(n,t,{get(){const e=this[r.type](((...e)=>{this[i](...e)}),r);return defineProperty3(this,t,{value:e}),e}})}}get widgetClass(){}},StateStorage=class{get data(){return Object.create(null)}get keys(){return[]}clear(){}getItem(e){return null}removeItem(e){}setItem(e,t){}};StateStorage._$name="StateStorage";var Local=class extends StateStorage{constructor(e){super(),this.prefix=e.prefix||""}get isLocal(){return!0}get data(){const e=empty(),t=this.keys;for(const r of t)e[r]=this.getItem(r);return e}get keys(){return getKeys(this.prefix,this.prefix.length)}clear(){const e=getKeys(this.prefix);for(const t of e)localStorage.removeItem(t)}getItem(e){const t=localStorage.getItem(this.prefix+e);return null===t?t:JSON.parse(t)}removeItem(e){return localStorage.removeItem(this.prefix+e)}setItem(e,t){return localStorage.setItem(this.prefix+e,JSON.stringify(t))}},Memory=class extends StateStorage{constructor(){super(),this.clear()}get isMemory(){return!0}get data(){return ObjectHelper.clone(this._data)}get keys(){return Object.keys(this._data)}clear(){this._data=empty()}getItem(e){return e in this._data?this._data[e]:null}removeItem(e){delete this._data[e]}setItem(e,t){this._data[e]=t}},empty=()=>Object.create(null),getKeys=(e,t=0)=>{const r=[],n=localStorage.length;for(let i,s=0;s<n;++s)i=localStorage.key(s),i.startsWith(e)&&r.push(i.slice(t));return r},nullStorage=new StateStorage,storageTypes={local:Local,memory:Memory},StateProvider=class extends(Base.mixin(Delayable_default,Events_default)){static get $name(){return"StateProvider"}static get configurable(){return{prefix:"gantt-state:",storage:"local"}}static get delayable(){return{writeStatefuls:50}}static get instance(){return this._instance}static set instance(e){null==e?e=nullProvider:(("string"==typeof e||ObjectHelper.isClass(e)||e instanceof StateStorage)&&(e={storage:e}),ObjectHelper.isObject(e)&&(e=new StateProvider(e))),this._instance=e}static setup(e){return this.instance=e,this.instance}doDestroy(){self.writeStatefuls.flush(),super.doDestroy()}get data(){return this.storage.data}set data(e){if(e)for(const t in e)this.setValue(t,e[t]);else this.clear()}clear(){return this.storage.clear(),this}changeStorage(e){if(null==e)e=nullStorage;else{if("string"==typeof e){if(!storageTypes[e])throw new Error('Invalid storage type "'+e+'" (expected one of: "'+Object.keys(storageTypes).join('", "')+'")');e=storageTypes[e]}ObjectHelper.isClass(e)&&(e=new e(this))}return e}saveStateful(e,t){(this.pendingSaves||(this.pendingSaves=[])).push([e,t]),this.writeStatefuls()}writeStatefuls(){const e=this,{pendingSaves:t}=e,r=null==t?void 0:t.length,n=[],i=[];if(e.pendingSaves=null,r){for(let e,s,a,o=0;o<r;++o)[s,e]=t[o],!s.isDestroying&&s.isSaveStatePending&&(a=s.saveState({...e,immediate:!0}),a&&(n.push(a),i.push(s)));n.length&&e.trigger("save",{stateIds:n,saved:i})}}getValue(e){return this.writeStatefuls.flush(),this.storage.getItem(e)}setValue(e,t){const r=this,{storage:n}=r,i=r.getValue(e);return null!=t?(n.setItem(e,t),r.trigger("set",{key:e,value:t,was:i})):null!==i&&(n.removeItem(e),r.trigger("remove",{key:e,was:i})),r}},nullProvider=new StateProvider({storage:nullStorage});StateProvider._instance=nullProvider,StateProvider._$name="StateProvider";var primitiveRe=/boolean|number|string/,State_default=e=>{var t;return __publicField(t=class extends(e||Base){afterConstruct(){super.afterConstruct(),this.loadState()}finalizeInit(){this.loadState(),super.finalizeInit()}get isStateful(){return!0}get isStatefulActive(){return!this.statefulSuspended&&!this.isResponsivePending&&!this.isResponsiveUpdating}get state(){return this._state=this.getState()}set state(e){this._state=e,e&&this.applyState(e)}updateStatefulEvents(e){var t;const r=this,n={name:"statefulEvents",thisObj:r};if(r.detachListeners(n.name),e&&("string"==typeof e?e=StringHelper.split(e):Array.isArray(e)||(e=ObjectHelper.getTruthyKeys(e)),e.length)){for(const t of e)n[t]="onStatefulEvent";null==(t=r.ion)||t.call(r,n)}}get statefulId(){const e=this,{responsiveState:t}=e;let r=e.stateId;return null==r&&!1===e.hasGeneratedId&&!1!==e.stateful&&(r=e.id),r&&t&&(r=r+"["+t+"]"),r}get statefulness(){const{stateful:e}=this;return Array.isArray(e)?ObjectHelper.createTruthyKeys(e):e}get stateProvider(){return this._stateProvider||StateProvider.instance}applyState(e){(e=this.pruneState(e))&&this.setConfig(e)}getState(){var e;const t=this,{statefulness:r}=t;let n,i,s=null;if(r)for(n in s={},r)if(r[n]){if(i=t[n],null==i?void 0:i.isStateful)i=i.state;else if(i===(null==(e=t.initialConfig)?void 0:e[n])||!primitiveRe.test(typeof i))continue;s[n]=i}return s}loadState(e,t){"boolean"==typeof e&&(t=e,e=null);const r=this,{statefulLoaded:n}=r;if(r.isStatefulActive&&(t||!n)){const t=r.loadStatefulData(e||(e=r.statefulId));!n&&e&&(r.defaultState=r.state,r.statefulLoaded=!0),t&&(r.state=t)}}loadStatefulData(e){var t;return(e=this.isStatefulActive?e||this.statefulId:null)&&(null==(t=this.stateProvider)?void 0:t.getValue(e))}resetDefaultState(){this.defaultState&&(this.state=this.defaultState)}resumeStateful(e=!1){this.statefulSuspended=e?0:Math.max(this.statefulSuspended-1,0)}saveState(e){e="string"==typeof e?{id:e}:e||{};const t=this,{stateProvider:r}=t,n=e.id||t.isStatefulActive&&t.statefulId;if(n&&r)return e.immediate?(t.isSaveStatePending=!1,r.setValue(n,t.state)):t.isSaveStatePending||(t.isSaveStatePending=!0,r.saveStateful(t,e)),n}suspendStateful(){++this.statefulSuspended}onConfigChange({name:e,value:t,was:r,config:n}){if(super.onConfigChange({name:e,value:t,was:r,config:n}),!this.isConstructing&&this.isStatefulActive&&this.statefulId){const{stateful:t}=this;(Array.isArray(t)?t.includes(e):null==t?void 0:t[e])&&this.saveState()}}onStatefulEvent(){this.isConstructing||this.saveState()}pruneState(e){const{statefulness:t}=this;if(t){const r={};for(const n in e)t[n]&&(r[n]=e[n]);e=r}return e}get widgetClass(){}},"$name","State"),__publicField(t,"configurable",{stateful:null,statefulEvents:{$config:{merge:"classList"},value:["stateChange"]},stateId:null,stateProvider:null}),__publicField(t,"prototypeProperties",{statefulLoaded:!1,statefulSuspended:0}),t},idCounts=ObjectHelper.getPathDefault(globalThis,"gantt.idCounts",Object.create(null)),idTypes={string:1,number:1},Identifiable_default=e=>class extends(e||Base){static get $name(){return"Identifiable"}static get declarable(){return["identifiable"]}static get configurable(){return{id:""}}static setupIdentifiable(e,t){const{identifiable:r}=e;r.idMap=Object.create(null),Reflect.defineProperty(e,"identifiable",{get:()=>r})}doDestroy(){this.constructor.unregisterInstance(this),super.doDestroy()}changeId(e){return(this.hasGeneratedId=!e)?this.generateAutoId():e}updateId(e,t){const r=this,n=r.constructor;t&&n.unregisterInstance(r,t),r.hasGeneratedId&&!1===n.identifiable.registerGeneratedId||n.registerInstance(r,e)}generateAutoId(){return this.constructor.generateId("b-"+this.$$name.toLowerCase()+"-")}static get all(){return Object.values(this.identifiable.idMap)}static generateId(e="generatedId"){return e+(idCounts[e]=(idCounts[e]||0)+1)}static registerInstance(e,t=e.id){const{idMap:r}=this.identifiable;if(t in r&&!this.disableThrow)throw new Error("Id "+t+" already in use");r[t]=e}static unregisterInstance(e,t=e.id){const{idMap:r}=this.identifiable;idTypes[typeof e]?delete r[e]:r[t]===e&&delete r[t]}static getById(e){const t=this.identifiable.idMap;if(t)return t[e]}static get registeredInstances(){const e=this.identifiable.idMap;return e?Object.values(e):[]}},STM_PROP=Symbol("STM_PROP"),unrecordedFields={parentIndex:1},ModelStm_default=e=>class extends(e||Base){static get $name(){return"ModelStm"}static get defaultConfig(){return{stm:null}}joinStore(e){this.stm||(this.stm=e.stm)}unjoinStore(e){var t;this.stm===e.stm&&(this.stm=null),null==(t=super.unjoinStore)||t.call(this,e)}get stm(){return this[STM_PROP]}set stm(e){this[STM_PROP]=e}beforeChronoFieldSet(e,t){var r;const n=this;return n.inSetting||!(null==(r=n.stm)?void 0:r.enabled)||unrecordedFields[e]||n.constructor.nonPersistableFields[e]||!n.getFieldDefinition(e)?null:{[e]:{value:t,oldValue:n[e]}}}afterChronoFieldSet(e,t,r){r&&this.afterSet(e,t,!1,!1,r,!0)}shouldRecordFieldChange(e,t,r){const n=this.firstStore;return!(this.constructor.nonPersistableFields[e]||null==t&&null==r||t===r||t instanceof Date&&r instanceof Date&&t.getTime()===r.getTime()||"id"===e||"$PhantomId"===e||"parentId"===e&&n&&n.oldIdMap[t]===n.getById(r))}afterSet(e,t,r,n,i,s){const{stm:a}=this,o=this.constructor.nonPersistableFields;if((null==a?void 0:a.isBase)&&a.enabled&&!unrecordedFields[e]&&!o[e]&&i){let e;const[t,r]=Object.keys(i).reduce(((t,r)=>{const{value:n,oldValue:s}=i[r];return this.shouldRecordFieldChange(r,s,n)&&(e=!0,t[0][r]=n,t[1][r]=s),t}),[{},{}]);e&&a.onModelUpdate(this,t,r,s)}}beforeInsertChild(e){var t;const r=(null==(t=super.beforeInsertChild)?void 0:t.call(this,e))||[],{stm:n}=this;return(null==n?void 0:n.enabled)&&r.push(e.reduce(((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e)),new Map)),r}afterInsertChild(e,t,r,n){var i;const{stm:s}=this;if(null==s?void 0:s.enabled){const t=r.pop();n&&s.onModelInsertChild(this,e,n,t)}null==(i=super.afterInsertChild)||i.call(this,e,t,r,n)}beforeRemoveChild(e,t){const r=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],{stm:n}=this;return(null==n?void 0:n.enabled)&&!t&&r.push(e.reduce(((e,t)=>(e.set(t,t.parentIndex),e)),new Map)),r}afterRemoveChild(e,t,r){var n;const{stm:i}=this;if((null==i?void 0:i.enabled)&&!r){const r=t.pop();e&&e.length&&i.onModelRemoveChild(this,e,r)}null==(n=super.afterRemoveChild)||n.call(this,e,t,r)}},defaultTraverseOptions={includeFilteredOutRecords:!1},fixTraverseOptions=e=>("boolean"==typeof(e=e||!1)&&(e={includeFilteredOutRecords:e}),e||defaultTraverseOptions),TreeNode_default=e=>class extends(e||Base){static get $name(){return"TreeNode"}static set convertEmptyParentToLeaf(e){!0===e?e={onLoad:!0,onRemove:!0}:!1===e&&(e={onLoad:!1,onRemove:!1}),this._convertEmptyParentToLeaf=e}constructor(...e){super(...e),this.children&&(this.orderedChildren=this.orderedChildren||[])}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf||{onLoad:!1,onRemove:!1}}ingestChildren(e,t=this.stores){const{inProcessChildren:r,constructor:n}=this,i=t[0];if(!0===e)return!!r||[];if(e){const t=(e=ArrayHelper.asArray(e)).length,r=[];for(let s,a=0;a<t;a++)s=e[a],s=s.isModel?s:i?i.createRecord(s,!1,!0):new n(s,null,null,!0),s=i?i.processRecord(s):s,r.push(s);if(!0===this.children&&i){const e=i.createSorterFn(i.sorters);r.sort(e)}return r}}processChildren(e=this.stores){const t=this,{meta:r}=t;t.inProcessChildren=!0;const n=t.ingestChildren(t.data[t.constructor.childrenField],e);if(n){const{convertEmptyParentToLeaf:e}=t.constructor;if(!0===e||e.onLoad?n.length:Array.isArray(n)){if(r.isLeaf=!1,!0===t.children)t.children=[];else if(0===n.length)return void(t.children=n);t.insertChild(n)}else!0===n?(r.isLeaf=!1,t.children=!0):t.isRoot||(r.isLeaf=t.constructor.convertEmptyParentToLeaf.onLoad)}t.inProcessChildren=!1}ancestorsExpanded(e=this.firstStore){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e=this.firstStore){const t=this.instanceMeta(e.id);return Object.prototype.hasOwnProperty.call(t,"collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){let e=this,t=-1;for(;e&&!e.isRoot;)++t,e=e.parent;return t}get isLeaf(){return!1!==this.meta.isLeaf&&!this.isRoot}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const{children:r}=this;return!r||!Array.isArray(r)||e&&!this.isExpanded(t)?0:r.reduce(((t,r)=>t+r.getDescendantCount(e)),r.length)}get allChildren(){const{children:e}=this;return e?e.reduce(((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e)),[]):[]}get firstChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[0]||null}get lastChild(){const{children:e}=this;return(null==e?void 0:e.length)&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get previousOrderedSibling(){var e;return null==(e=this.parent)?void 0:e.orderedChildren[this.orderedParentIndex-1]}get nextOrderedSibling(){var e;return null==(e=this.parent)?void 0:e.orderedChildren[this.orderedParentIndex+1]}get root(){var e;return(null==(e=this.parent)?void 0:e.root)||this}get parentId(){return this.parent&&!this.parent.isAutoRoot?this.parent.id:null}set parentId(e){const t=this,{parent:r}=t,n=null===e?t.firstStore.rootNode:t.firstStore.getById(e);n!==r&&(r||n)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:n?n.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}getChildren(e){let t;return t=e.includeFilteredOutRecords?this.unfilteredChildren||this.children:e.useOrderedTree?this.orderedChildren:this.children,t}traverse(e,t,r){r=fixTraverseOptions(r);const n=this,i=n.getChildren(r);t||e.call(n,n);for(let t=0,n=null==i?void 0:i.length;t<n;t++)i[t].traverse(e,!1,r)}traverseBefore(e,t,r){r=fixTraverseOptions(r);const n=this,i=n.getChildren(r);for(let t=0,n=null==i?void 0:i.length;t<n;t++)i[t].traverse(e,!1,r);t||e.call(n,n)}traverseWhile(e,t,r){r=fixTraverseOptions(r);const n=this;let i=t||!1!==e.call(n,n);if(i){const t=n.getChildren(r);(null==t?void 0:t.length)&&(i=t.every((t=>t.traverseWhile(e,!1,r))))}return i}bubble(e,t=!1){let r=this;for(t||e.call(r,r);r.parent;)r=r.parent,e.call(r,r)}bubbleWhile(e,t=!1){let r=this,n=!0;for(t||(n=e.call(r,r));n&&r.parent;)r=r.parent,n=e.call(r,r);return n}contains(e,t=!1){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile((t=>t.id!=e),t)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile((e=>(t.push(e),e.parent&&!e.parent.isRoot)))):(t=null,this.bubbleWhile((e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot)))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t=null,r=!1,n={}){var i,s,a,o,l,c,d;const u=this,h=Array.isArray(e);if(e=ArrayHelper.asArray(e),"number"==typeof t&&(t=null!=(s=null==(i=u.children)?void 0:i[t])?s:null),!r&&!u.stores.every((t=>!1!==t.trigger("beforeAdd",{records:e,parent:u}))))return null;e=u.ingestChildren(e);const g=null!=(l=null!=(o=null==t?void 0:t.parentIndex)?o:null==(a=u.children)?void 0:a.length)?l:0,p=null==(c=u.beforeInsertChild)?void 0:c.call(u,e),m=u.internalAppendInsert(e,t,r,n);return m.length&&u.convertToParent(r),null==(d=u.afterInsertChild)||d.call(u,g,e,p,m),h||!m?m:m[0]}convertToParent(e=!1){const t=this,r=t.isLeaf;t.meta.isLeaf=!1,t.children||(t.children=[]),!r||t.root.isLoading||e||t.signalNodeChanged({isLeaf:{value:!1,oldValue:!0}})}signalNodeChanged(e,t=this.stores){t.forEach((t=>{t.trigger("update",{record:this,records:[this],changes:e}),t.trigger("change",{action:"update",record:this,records:[this],changes:e})}))}tryInsertChild(){return this.insertChild(...arguments)}internalAppendInsert(e,t,r,n){const i=this,{stores:s,root:a,children:o}=i,{firstStore:l}=a,{parentIdField:c}=i.constructor,d=i.isAutoRoot?null:i.id;let u,h,g,p,m,f;if(!a.isLoading&&l)for(f={},m=[],g=0;g<e.length;g++){const t=e[g];f[t.id]=t.root===a,m[g]=t.parentIndex}if(t&&t.parent!==i&&(t=null),o){const r=t?t.parentIndex:o.length;if(o[h=r]===e[0]||o[h=r-1]===e[0])for(u=!0,g=0;u&&g<e.length;g++)e[g]!==o[h+g]&&(u=!1)}if(u)return e;for(g=0;g<e.length;g++){const t=e[g],s=t.parent;l&&!a.isLoading&&t.traverse((e=>{e.root===a&&(f[e.id]=!0)})),!1===(null==s?void 0:s.removeChild(t,null==f?void 0:f[t.id],r,{isInserting:!0,...n}))?(p||(e=e.slice(),p=!0),e.splice(g--,1)):(t.parent=i,t.data[c]=d,s&&(t.meta.oldParentId=s.id))}if(e.length){Array.isArray(o)||(i.children=[]),Array.isArray(i.orderedChildren)||(i.orderedChildren=[]);const a=i.addToChildren(t,e,n);s.forEach((t=>{t.isChained||(e.forEach((e=>{e.joinStore(t)})),t.onNodeAddChild(i,e,a,f,r),e.forEach(((e,n)=>{if(null!=e.meta.oldParentId&&!i.inProcessChildren&&!i.isLoading){const s={[c]:d,[i.getDataSource("parentIndex")]:e.parentIndex},a={},{modified:o,oldParentId:l}=e.meta,u=m[n];if(delete e.meta.oldParentId,i.id!==l&&(a[c]={value:d,oldValue:l}),e.parentIndex!==u&&(a.parentIndex={value:e.parentIndex,oldValue:u}),o[c]===i.id?Reflect.deleteProperty(o,c):c in o||(o[c]=l),f[e.id]){const e=t.getById(l);e.isLeaf&&!r&&e.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}},[t])}e.afterChange(s,a)}})))}))}return e}removeChild(e,t=!1,r=!1,n={}){var i,s;const a=this,o=[],l=a.isLeaf,{children:c,stores:d}=a;if(e=(e=ArrayHelper.asArray(e)).filter((e=>e.parent===a)),!r)for(const r of d)if(!r.isChained&&!1===r.trigger("beforeRemove",{parent:a,records:e,isMove:t}))return!1;const u=null==(i=a.beforeRemoveChild)?void 0:i.call(a,e,t);for(const i of e){const{parentIdField:e}=i.constructor,{modified:s}=i.meta,l=i.parent?i.parent.id:null;e in s||i.isLinked||(s[e]=l);const c=a.removeFromChildren(i,n);d.forEach((e=>{if(!e.isChained){const{isRemoving:n}=e;e.isRemoving=!0,o.push(...e.onNodeRemoveChild(a,[i],c,{isMove:t,silent:r})),e.isRemoving=n}})),t||(i.parent=i.parentIndex=i.unfilteredIndex=i.nextSibling=i.previousSibling=null,i.data[e]=null)}return 0===(a.unfilteredChildren||c).length&&a.constructor.convertEmptyParentToLeaf.onRemove&&!a.isRoot&&(a.meta.isLeaf=!0),a.isLeaf===l||r||t||a.signalNodeChanged({isLeaf:{value:!0,oldValue:!1}}),null==(s=a.afterRemoveChild)||s.call(a,e,u,t),o}clearParentId(){const e=this;Reflect.deleteProperty(e.data,e.parentIdField),Reflect.deleteProperty(e.originalData,e.parentIdField),e.meta.modified&&Reflect.deleteProperty(e.meta.modified,e.parentIdField)}replaceChildren(e){return this.clearChildren(),this.data[this.constructor.childrenField]=e,this.processChildren(),this.children}clearChildren(e=!1){const t=this,{stores:r}=t,n=t.unfilteredChildren||t.children;t.children=[],t.orderedChildren=[],n&&!0!==n&&(r.forEach((r=>{r.isChained||r.onNodeRemoveChild(t,n,0,{unfiltered:!0,silent:e})})),t.unfilteredChildren&&(t.unfilteredChildren=[]))}clear(){var e;const t=this,{stores:r}=t,n=null==(e=t.children)?void 0:e.slice();if(t.isRoot&&n){for(const e of r)if(!e.isChained&&!1===e.trigger("beforeRemove",{parent:t,records:n,isMove:!1,removingAll:!0}))return!1;t.children.length=0,t.unfilteredChildren&&(t.unfilteredChildren.length=0),r.forEach((e=>{n.forEach((t=>{t.stores.includes(e)&&t.unjoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null})),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})}))}}updateChildrenIndices(e,t,r=!1){let n=null;for(let i=0;i<e.length;i++){const s=e[i],a=s[t];"parentIndex"===t||"orderedParentIndex"===t?void 0===a||r?s.setData(t,i):a!==i&&s.set(t,i,!0):s[t]=i,"parentIndex"===t&&(s.previousSibling=n,n&&(n.nextSibling=s),i===e.length-1&&(s.nextSibling=null),n=s)}}addToChildren(e,t,r={}){var n,i;const s=this,a=[[s.children,"parentIndex",e],[s.unfilteredChildren,"unfilteredIndex",e],[s.orderedChildren,"orderedParentIndex",null!=(n=null==r?void 0:r.orderedBeforeNode)?n:e]];for(const e of a){const[n,a,o]=e;if(n){const l=o?o[a]:n.length;e.push(l),n.splice(l,0,...t),(null==(i=null==r?void 0:r[a])?void 0:i.skip)||s.updateChildrenIndices(n,a)}}return a[0][3]}removeFromChildren(e,t){var r;const n=[[this.children,"parentIndex"],[this.unfilteredChildren,"unfilteredIndex"],[this.orderedChildren,"orderedParentIndex"]];for(const i of n){const[n,s]=i;if(n){const a=n.indexOf(e);i.push(a),a>-1&&(n.splice(a,1),(null==(r=null==t?void 0:t[s])?void 0:r.skip)||this.updateChildrenIndices(n,s))}}return n[0][2]}sortOrderedChildren(e=!0,t=!1){const r=[];return this.isLeaf||(this.orderedChildren.sort(((e,n)=>{var i,s;if(t){const t=(null!=(i=e.meta.modified.orderedParentIndex)?i:e.orderedParentIndex)-(null!=(s=n.meta.modified.orderedParentIndex)?s:n.orderedParentIndex);return 0!==t&&(r.push(e),r.push(n)),t}return e.orderedParentIndex-n.orderedParentIndex})),e&&this.orderedChildren.forEach((n=>{r.push(...n.sortOrderedChildren(e,t))})),this.updateChildrenIndices(this.orderedChildren,"orderedParentIndex",!0)),new Set(r)}},propertyOverrides={id:1,stores:1,parentIndex:1,parent:1,previousSibling:1,nextSibling:1,unfilteredIndex:1},proxyConfig={get(e,t){return"proxyMeta"===t?this.proxyMeta:"constructor"===t?e.constructor:"setData"===t?this.setDataOverride:"set"===t?this.setOverride:propertyOverrides[t]?this.proxyMeta.data[t]:Reflect.get(e,t,this.proxyRecord)},set(e,t,r){return propertyOverrides[t]?this.proxyMeta.data[t]=r:e[t]=r,!0},setDataOverride(e,t){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.setData(e,t)},setOverride(e,t,...r){"parentIndex"===e?this.proxyMeta.data.parentIndex=t:this.proxyMeta.originalRecord.set(e,t,...r)}},ModelLink_default=e=>{var t;return __publicField(t=class extends(e||Base){link(){if(this.isLinked)return this.$original.link();const e=this,t={...proxyConfig,proxyMeta:{originalRecord:e,data:{id:e.id+"_link_"+StringHelper.generateUUID(),stores:[]}}},r=new Proxy(e,t);return t.proxyRecord=r,(e.meta.linkedRecords||(e.meta.linkedRecords=[])).push(r),r}get isLinked(){var e;return Boolean(null==(e=this.proxyMeta)?void 0:e.originalRecord)}get hasLinks(){return Boolean(!this.proxyMeta&&this.$links.length)}removeLink(e,t=null,r=!1){if(e.hasLinks)for(const n of e.$links.slice())t?ArrayHelper.include(t,n):n.remove(r);else e.isLinked&&ArrayHelper.remove(e.$original.$links,e)}beforeRemove(e){this.removeLink(this,e)}removeChild(e,t,r,n){if(!(null==n?void 0:n.isInserting)){e=ArrayHelper.asArray(e);for(const t of e)this.removeLink(t,null,r)}return super.removeChild(e,t,r,n)}get $originalId(){return this.$original.id}get $links(){var e;return null!=(e=this.meta.linkedRecords)?e:[]}},"$name","ModelLink"),t},{defineProperty:defineProperty4}=Reflect,ownerSymbol=Symbol("owner"),typeSplitRe=/[\s,]+/,Factoryable_default=e=>class extends(e||Base){static get $name(){return"Factoryable"}static get declarable(){return["factoryable","alias","type"]}static register(e,t,r=globalThis.__GANTT_EXAMPLE){const{factoryable:n}=this.initClass(),{caseless:i,registry:s}=n,a=StringHelper.split(e,typeSplitRe);for(let e,o,l=0;l<a.length;++l){if(o=a[l],e=i?o.toLowerCase():o,!r&&e in s)throw new Error('Type "'+o+'" already registered with '+n.class.name+" factory");s[o]=s[e]=t.initClass()}}static isA(e,t){return this.isType(e,t,!0)}static isType(e,t,r){const{factoryable:n}=this,{caseless:i,registry:s}=n,a=s[i?t.toLowerCase():t];return!!a&&(r?e instanceof a:e.constructor===a)}static setupAlias(e){e.register(e.alias,e)}static setupFactoryable(e,t){const r=t.super.class;let{factoryable:n}=e;n={caseless:!0,defaultType:null,extends:r.factoryable?[r]:null,typeKey:"type",...n},n.class=e,n.registry=Object.create(null),n.extends&&!Array.isArray(n.extends)&&(n.extends=[n.extends]),defineProperty4(e,"factoryable",{get:()=>n})}static setupType(e,t){const{type:r}=e;e.register(r,e,t.replaceType),defineProperty4(e.prototype,"type",{value:r})}static create(e,t){return this.reconfigure(null,e,t)}static reconfigure(e,t,r){const n=this,{factoryable:i}=n,{typeKey:s}=i;let a,o,l,c,d,u,h,g,p,m=r;if(r&&!ObjectHelper.isClass(r)&&(m=null,h=typeof r,"function"===h?u=r:"string"===h?m=r:ObjectHelper.isObject(r)?(a=r.cleanup,o=r.defaults,c=r.owner,u=r.setup,m=r.type,g=r.transform):c=r),g&&(t="string"==typeof g?c[g](t):g(t)),p=t,"string"==typeof p)t={};else if(t){if(!0===t&&(t={}),!ObjectHelper.isObject(t))return c&&t!==e&&(null==e?void 0:e[ownerSymbol])===c&&("string"==typeof a?c[a](e):null==a||a(e),e.destroy()),t;p=t[s]}if(p=p&&n.resolveType(p),e){if(t&&(!p||e.constructor===p))return s in t&&delete(t=ObjectHelper.assign({},t))[s],e.setConfig(t),e;c&&e[ownerSymbol]===c&&("string"==typeof a?c[a](e):null==a||a(e),e.destroy())}if(t){if(o){if(!(l=p)){if(!(l=o[s]||m||i.defaultType))throw new Error("No default mergeType defined for "+i.class.name+" factory");l=n.resolveType(l)}l&&(t=l.mergeConfigs(o,t))}if(u){if(d="string"==typeof u?c[u](t,p,o):u(t,p,o),null===d)return d;t=d||t}if(!p){if(!(p=t[s]||m||i.defaultType))throw new Error("No default type defined for "+i.class.name+" factory");p=n.resolveType(p)}o&&!l&&(t=p.mergeConfigs(o,t)),s in t&&delete(t=ObjectHelper.assign({},t))[s],t=new p(t),c&&(t[ownerSymbol]=c)}return t||null}static resolveType(e,t){if("string"!=typeof e)return e;const{factoryable:r}=this,n=r.extends;let i,s=r.registry[r.caseless?e.toLowerCase():e];for(i=0;!s&&n&&i<n.length;++i)s=n[i].resolveType(e,!0);if(!s&&!t)throw new Error('Invalid type name "'+e+'" passed to '+r.class.name+" factory");return s}},{getOwnPropertyDescriptor:getOwnPropertyDescriptor2}=Reflect,DataField=class extends(Base.mixin(Factoryable_default)){static get $name(){return"DataField"}static get type(){return"auto"}static get factoryable(){return{defaultType:"auto"}}static get prototypeProperties(){return{compare:null,compareItems:null,dataSource:null,alwaysWrite:!1,nullable:!0,nullText:null,nullValue:void 0,persist:!0,readOnly:!1,internal:!1}}construct(e){const t=this;e&&(t.name=e.name,Object.assign(t,e)),t.compare&&(t.compareItems=(e,r)=>t.compare(null==e?void 0:e[t.name],null==r?void 0:r[t.name]))}defineAccessor(e,t){const{name:r,dataSource:n}=this;!t&&r in e&&e.$meta.hierarchy.some((e=>{var t;return!1===(null==(t=getOwnPropertyDescriptor2(e.prototype,r))?void 0:t.enumerable)}))||Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,get:this.complexMapping?function(){return this.complexGet(r,n)}:function(){return this.batching&&r in this.meta.batchChanges?this.meta.batchChanges[r]:n in this.data?this.data[n]:this.data[r]},set(e){const t=this.$meta.fields.map[r];t&&t.readOnly||this.set(r,e)}})}isEqual(e,t){return ObjectHelper.isEqual(e,t)}print(e){return null==e?this.nullText:this.printValue(e)}printValue(e){return String(e)}};DataField._$name="DataField";var ArrayDataField=class extends DataField{static get $name(){return"ArrayDataField"}static get type(){return"array"}isEqual(e,t){return e===t}};ArrayDataField.initClass(),ArrayDataField._$name="ArrayDataField";var BooleanDataField=class extends DataField{static get $name(){return"BooleanDataField"}static get type(){return"boolean"}static get alias(){return"bool"}static get prototypeProperties(){return{nullValue:!1}}isEqual(e,t){return null==e&&null==t||super.isEqual(e,t)}convert(e){var t;return null==e?this.nullable?e:this.nullValue:"false"!==(null==(t=e.toLowerCase)?void 0:t.call(e))&&Boolean(e)}};BooleanDataField.initClass(),BooleanDataField._$name="BooleanDataField";var DateDataField=class extends DataField{static get $name(){return"DateDataField"}static get type(){return"date"}static get prototypeProperties(){return{format:null}}convert(e){return null==e?this.nullable||(e=this.nullValue):"now"===e?e=new Date:e instanceof Date||(e=DateHelper.parse(e,this.format||DateHelper.defaultParseFormat))&&!isNaN(e)||(e=void 0),e}serialize(e){return e instanceof Date&&(e=DateHelper.format(e,this.format||DateHelper.defaultFormat)),e}printValue(e){return DateHelper.format(e,this.format||DateHelper.defaultFormat)}};DateDataField.initClass(),DateDataField._$name="DateDataField";var StringDataField=class extends DataField{static get $name(){return"StringDataField"}static get type(){return"string"}static get prototypeProperties(){return{nullValue:""}}convert(e){return null==e?this.nullable?e:this.nullValue:String(e)}};StringDataField.initClass(),StringDataField._$name="StringDataField";var DurationUnitDataField=class extends StringDataField{static get $name(){return"DurationUnitDataField"}static get type(){return"durationunit"}isEqual(e,t){return 0===DateHelper.compareUnits(e,t)}};DurationUnitDataField.initClass(),DurationUnitDataField._$name="DurationUnitDataField";var IntegerDataField=class extends DataField{static get $name(){return"IntegerDataField"}static get type(){return"integer"}static get alias(){return"int"}static get prototypeProperties(){return{nullValue:0,rounding:"round"}}convert(e){return null==e?this.nullable?e:this.nullValue:Math[this.rounding](Number(e))}};IntegerDataField.initClass(),IntegerDataField._$name="IntegerDataField";var ModelDataField=class extends DataField{static get $name(){return"ModelDataField"}static get type(){return"model"}static get prototypeProperties(){return{complexMapping:!0}}isEqual(e,t){return e&&t&&t instanceof e.constructor&&t.id==e.id}};ModelDataField.initClass(),ModelDataField._$name="ModelDataField";var NumberDataField=class extends DataField{static get $name(){return"NumberDataField"}static get type(){return"number"}static get alias(){return"float"}static get prototypeProperties(){return{nullValue:0,precision:null}}isEqual(e,t){return isNaN(Number(e))&&isNaN(Number(t))||super.isEqual(e,t)}convert(e){if(null==e)return this.nullable?e:this.nullValue;if(e=Number(e),isNaN(e))return;let t=this.precision;return t?(t=10**t,e=Math.round(e*t)/t):0===t&&(e=Math.round(e)),e}};NumberDataField.initClass(),NumberDataField._$name="NumberDataField";var ObjectDataField=class extends DataField{static get $name(){return"ObjectDataField"}static get type(){return"object"}static get prototypeProperties(){return{complexMapping:!0}}};ObjectDataField.initClass(),ObjectDataField._$name="ObjectDataField";var StoreDataField=class extends DataField{init(e,t){var r;const n=this,i=n.name+"Store",s={skipStack:!0};if(n.modelClass&&(s.modelClass=n.modelClass),null==(r=t["init"+StringHelper.capitalize(i)])||r.call(t,s),!s.storeClass&&!n.storeClass)throw new Error('类型为“store”的字段 "'+n.name+'" 必须配置storeClass');const a=t.meta[i]=new(s.storeClass||n.storeClass)(s);n.complexMapping?ObjectHelper.setPath(e,n.dataSource,a):e[n.dataSource]=a,a.verifyNoGeneratedIds=!1,a.usesId=!a.count||!a.every((e=>e.hasGeneratedId)),a.$currentValue=n.getValue(a),a.ion({change:({action:e})=>{const r=n.getValue(a);if(!a.$isSettingStoreFieldData){const i=a.$preserveCurrentDataset;a.$preserveCurrentDataset=n.subStore&&("update"===e||"remove"===e||"add"===e),t.set(n.name,r),a.$preserveCurrentDataset=i}a.$currentValue=r}})}set(e,t,r){var n,i;const s=this,a=s.name+"Store",{[a]:o}=r.meta;if(!o)return r.meta.initableValues.set(s,e),!1;o.$isSettingStoreFieldData||(o.$isSettingStoreFieldData=!0,e=null!=(i=null==(n=r["process"+StringHelper.capitalize(a)+"Data"])?void 0:n.call(r,e,r))?i:e,o.$preserveCurrentDataset||(o.data=e),o.$isSettingStoreFieldData=!1,o.usesId=!o.count||!o.every((e=>e.hasGeneratedId)))}serialize(e,t){return t.meta[this.name+"Store"].$currentValue}getValue(e){return e.allRecords.map((t=>{const r=t.persistableData;return e.usesId||delete r.id,r}))}isEqual(e,t){return(null==e?void 0:e.isStore)&&(e=e.$currentValue),(null==t?void 0:t.isStore)&&(t=t.$currentValue),ObjectHelper.isDeeplyEqual(e,t)}getOldValue(e){const t=e.meta[this.name+"Store"];return t?ObjectHelper.clone(t.$currentValue):null}};__publicField(StoreDataField,"$name","StoreDataField"),__publicField(StoreDataField,"type","store"),StoreDataField.initClass(),StoreDataField._$name="StoreDataField";var{defineProperty:defineProperty5}=Reflect,{hasOwn:hasOwn3}=ObjectHelper,_undefined=void 0,internalProps={children:1,data:1,meta:1},abbreviationFields=["name","title","text","label","description"],fieldDataTypes={boolean:1,number:1,date:1,object:1},_Model=class extends(Base.mixin(ModelStm_default,TreeNode_default,ModelLink_default)){static get $name(){return"Model"}static get declarable(){return["fields"]}static get fields(){return[{name:"parentIndex",type:"number",persist:!1,internal:!0},{name:"orderedParentIndex",type:"number",persist:!1,internal:!0},{name:"readOnly",type:"boolean"},{name:"expanded",internal:!0}]}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){if(!this._childrenField){const e=this.fieldMap.children;this._childrenField=(null==e?void 0:e.dataSource)||"children"}return this._childrenField}get indexPath(){const e=[];let t=this,r=t.childLevel;for(t=this;t&&!t.isRoot;t=t.parent)e[r--]=t.parentIndex+1;return e}construct(e={},t=null,r=null,n=!1,i=!1,s=!1){var a,o;const l=this,c=null!=(a=ArrayHelper.asArray(t))?a:[],{constructor:d,fieldMap:u}=l;let h=null;if(t=c[0],l.meta={modified:{},...d.metaConfig,...r},d.applyConfigs)for(const t in l.getDefaultConfiguration())h||(h={},l.useRawData&&l.useRawData.enabled||(e={...e})),t in e&&(void 0!==e[t]&&(h[t]=e[t]),delete e[t]);if(super.construct(h),n||d.exposeProperties(e,s),!hasOwn3(d,"idFieldProcessed")){let e=l.meta.idField;e||(d._assignedIdField?e=d.idField:t&&(e=t.idField)),e&&e!==u.id.dataSource&&d.addField({name:"id",dataSource:e,internal:!0}),d._idField=u.id.dataSource,d.idFieldProcessed=!0}l._internalId=_Model._internalIdCounter++,l.stores=[],l.unjoinedStores=[],l.originalData||(l.originalData=e),l.data=d.processData(e,!1,t,l,i),(null==(o=l.meta.initableValues)?void 0:o.size)&&l.assignInitables(),null==l.id&&l.setData("id",l.generateId(t)),l.data[d.childrenField]&&l.processChildren(c),l.generation=0}set isCreating(e){const t=this;Boolean(t.meta.isCreating)!==e&&(t.meta.isCreating=e,t.stores.forEach((r=>{r.onIsCreatingToggle(t,e)})))}get isCreating(){return Boolean(this.meta.isCreating)}equals(e){if(e instanceof this.constructor){for(let t=this.$meta.fields.defs,r=0,{length:n}=t;r<n;r++){const n=t[r],{name:i}=n;if("id"!==i&&!n.isEqual(this[i],e[i]))return!1}return!0}return!1}get subclass(){return new this.constructor(Object.setPrototypeOf({id:_undefined},this.data),this.stores[0],null,!0)}static processData(e,t=!1,r,n,i){const{fieldMap:s,defaultValues:a}=this,{useRawData:o={enabled:!1}}=r||{},l=i||o.enabled?e:ObjectHelper.clone(e);let c;if(!(t=t||o.disableDefaultValue||i))for(c in a)if(l[c]===_undefined){let e=a[c];Array.isArray(e)&&(e=e.slice()),l[c]=e}if(!o.disableTypeConversion&&!i)for(c in s){const r=s[c],{name:i,dataSource:a}=r,d=a!==i,u=r.complexMapping,h=d&&(u?ObjectHelper.pathExists(e,a):a in e),g=i in e&&(!d||!h),p=!o.disableTypeConversion&&r.convert;if((g||p)&&(!t||g||h)){const t=g?l[i]:u?ObjectHelper.getPath(l,a):l[a],s=p?r.convert(t,e,n):t;u?ObjectHelper.setPath(l,a,s):l[a]=s,d&&delete l[i]}}return this.$meta.fields.initable.length&&this.initInitables(n,l),l}static setupClass(e){super.setupClass(e),e.fields||this.setupFields(this,e)}static setupFields(e,t){var r,n,i,s,a;const o=hasOwn3(e,"fields")&&e.fields,l=t.super.fields,c=t.fields={defs:null!=(r=null==l?void 0:l.defs.slice())?r:[],exposedData:!1,defaults:l?{...l.defaults}:{},exposed:Object.create(null!=(n=null==l?void 0:l.exposed)?n:null),ordinals:Object.create(null!=(i=null==l?void 0:l.ordinals)?i:null),map:Object.create(null!=(s=null==l?void 0:l.map)?s:null),sources:Object.create(null!=(a=null==l?void 0:l.sources)?a:null)};hasOwn3(e,"defaults")&&Object.assign(c.defaults,e.defaults),hasOwn3(e,"idField")&&(e.addField({name:"id",dataSource:e.idField,internal:!0}),c.exposed[e.idField]=!0),(null==o?void 0:o.length)&&o.map(e.addField,e),c.initable=c.defs.filter((e=>e.init)),e.exposeRelations()}static get defaultValues(){return this.$meta.fields.defaults}static get allFields(){return this.$meta.fields.defs}get allFields(){return this.$meta.fields.defs}static get fieldMap(){return this.$meta.fields.map}get fieldMap(){return this.$meta.fields.map}static get fieldDataSourceMap(){return this.$meta.fields.sources}static exposeProperties(e,t=!0){const r=this,n=r.$meta.fields,i=t?"exposed":"map";if(e&&r.autoExposeFields&&!n.exposedData){let t,s,a;for(t in e)n[i][t]||t===r.childrenField||(a=ObjectHelper.typeOf(e[t]),s={name:t,dataSource:t,fromData:!0},fieldDataTypes[a]&&(s.type=a),r.addField(s));n.exposedData=!0}r.exposeRelations()}static addField(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this.initClass(),r=t.$meta.fields,{ordinals:n}=r,i=r.exposed,{name:s}=e,a=r.map[s],o=e.dataSource||(e.dataSource=s);let l,c;if(!a||e.type&&e.type!==a.type)l=DataField.create(e),l.definedBy=a?a.definedBy:t,l.ordinal=a?a.ordinal:n[s]=r.defs.length;else for(c in l=Object.create(a),e)"type"!==c&&(l[c]=e[c]);return l.owner=t,r.defs[l.ordinal]=l,r.map[s]=l,r.sources[o]||(r.sources[o]=l),o.includes(".")&&(l.complexMapping=!0),l.complexMapping?i[o.split(".")[0]]=!0:i[o]=!0,"defaultValue"in l&&(r.defaults[o]=l.defaultValue),internalProps[s]||l.defineAccessor(t.prototype),t._nonPersistableFields=null,t._alwaysWriteFields=null,l}static removeField(e){const t=this.initClass(),r=t.$meta.fields,n=r.map[e],{ordinals:i}=r,s=i[e];if(n){r.defs.splice(s,1),delete i[e],delete r.defaults[e],delete r.exposed[e],delete r.map[e],delete r.sources[n.dataSource];for(const e in i)i[e]>s&&--i[e];delete t.prototype[e]}}static exposeRelations(){const e=this;if(!hasOwn3(e,"exposedRelations")&&e.relations){e.exposedRelations=[];for(const t in e.relations){const r=e.relations[t];r.relationName=t,e.exposedRelations.push(r),Reflect.ownKeys(e.prototype).includes(t)||defineProperty5(e.prototype,t,{enumerable:!0,get:function(){return this.getForeign(t)},set:function(e){this.setForeign(t,e,r)}})}}}static initInitables(e,t){const r=e.meta.initableValues=new Map;for(const n of this.$meta.fields.initable){const i=ObjectHelper.getPath(t,n.dataSource);void 0!==i&&r.set(n,i),!n.lazy&&n.init(t,e)}}assignInitables(){const{initableValues:e}=this.meta;for(const[t,r]of e)!1!==t.set(r,this.data,this)&&e.delete(t)}static get autoExposeFields(){return!0}get fields(){return this.$meta.fields.defs}getFieldDefinition(e){return this.$meta.fields.map[e]}getFieldDefinitionFromDataSource(e){return this.$meta.fields.sources[e]}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.$meta.fields.map[e]}static getFieldDataSource(e){return this.getFieldDefinition(e).dataSource}getDataSource(e){const t=this.constructor.getFieldDefinition(e);return(null==t?void 0:t.dataSource)||(null==t?void 0:t.name)}static processField(e,t,r){const n=this.fieldMap[e];return(null==n?void 0:n.convert)?n.convert(t,this.data,r):t}initRelations(){const e=this;e.constructor.exposedRelations&&e.stores.forEach((t=>{var r;t.modelRelations||t.initRelations();const n=[];null==(r=t.modelRelations)||r.forEach((t=>{n.push({related:e.initRelation(t),config:t})})),t.updateRecordRelationCache(e,n)}))}initRelation(e){const t=this,r=t.get(e.foreignKey),n=r!==_undefined&&"string"!=typeof e.foreignStore&&e.foreignStore.getById(r);return(t.meta.relationCache||(t.meta.relationCache={}))[e.relationName]=n||(null!=r?{id:r,placeHolder:!0}:null),n}removeRelation(e){const{relationName:t,foreignKey:r,nullFieldOnRemove:n}=e;this.meta.relationCache[t]&&(delete this.meta.relationCache[t],n&&this.setData(r,null))}getForeign(e){var t;return null==(t=this.meta.relationCache)?void 0:t[e]}setForeign(e,t,r){const n=_Model.asId(t);return this.set(r.foreignKey,n)}getRelationConfig(e){var t,r;return null==(r=null==(t=this.firstStore)?void 0:t.modelRelations)?void 0:r.find((t=>t.foreignKey===e))}flatGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:t in this.data?this.data[t]:this.data[e]}complexGet(e,t){return this.batching&&e in this.meta.batchChanges?this.meta.batchChanges[e]:ObjectHelper.getPath(this.data,t)}get(e){if(!e)return;const t=this.fieldMap[e];return!t&&e.includes(".")?this.complexGet(e,e):(null==t?void 0:t.complexMapping)?this.complexGet(e,t.dataSource):this.flatGet(e,(null==t?void 0:t.dataSource)||e)}setData(e,t){var r,n;const{data:i,fieldMap:s}=this;if("string"==typeof e){const n=s[e],a=null!=(r=null==n?void 0:n.dataSource)?r:e;(null==n?void 0:n.set)?n.set(t,this.data,this):(null==n?void 0:n.complexMapping)?ObjectHelper.setPath(i,a,t):i[a]=t}else{const r=Object.keys(e);for(let a=0;a<r.length;a++){const o=r[a],l=s[o],c=null!=(n=null==l?void 0:l.dataSource)?n:o;(null==l?void 0:l.set)?l.set(t,this.data,this):c&&((null==l?void 0:l.complexMapping)?ObjectHelper.setPath(i,c,e[o]):i[c]=e[o])}}}getData(e){var t;const r=this.fieldMap[e],n=null!=(t=null==r?void 0:r.dataSource)?t:e;if(n)return(null==r?void 0:r.complexMapping)?ObjectHelper.getPath(this.data,n):this.data[n]}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const r={id:{value:e,oldValue:t}};this.afterChange(r,r)}}set(e,t,r=!1,n=!1,i=!1,s=!1,a=!0){var o;const l=this;if(l.isBatchUpdating)return l.inBatchSet(e,t,r||l.$silenceBatch),null;{const c=l.inSet(e,t,r,n,i,s,a);return null==(o=l.afterSet)||o.call(l,e,t,r,n,c),c}}fieldToKeys(e,t){return"string"!=typeof e?ObjectHelper.assign({},e):{[e]:t}}inBatchSet(e,t,r){const n=this,{meta:i,constructor:s,fieldMap:a}=n,o={};let l,c=!1;if("string"!=typeof e?Object.keys(n.fieldToKeys(e,t)).forEach((r=>{l=a[r]||ObjectHelper,t=s.processField(r,e[r],n),l.isEqual(i.batchChanges[r],t)||(o[r]={value:t,oldValue:n.get(r)},i.batchChanges[r]=t,c=!0)})):(l=a[e]||ObjectHelper,l.isEqual(i.batchChanges[e],t)||(o[e]={value:t,oldValue:n.get(e)},i.batchChanges[e]=t,c=!0)),c&&(n.generation++,!r)){const e={action:"update",record:n,records:[n],changes:o};n.stores.forEach((t=>{t.trigger("batchedUpdate",{...e})})),n.forEachLinked(((t,r)=>t.trigger("batchedUpdate",{...e,record:r,records:[r]})))}}inSet(e,t,r,n,i=!1,s=!1,a=!0){var o,l,c;const d=this,{data:u,meta:h,fieldMap:g,constructor:p}=d,{prototype:m,childrenField:f}=p,v={},y=d.fieldToKeys(e,t),b=Object.keys(y);let C=!1;if(!r&&!d.triggerBeforeUpdate(y))return null;d.inSetting=!0;for(let e=0;e<b.length;e++){const t=b[e];if(t===f)continue;const r=g[t],a=r||ObjectHelper,D=null==r?void 0:r.readOnly,S=null!=(o=null==r?void 0:r.dataSource)?o:t,E=!i&&!r&&t in m,w=E?d[S]:(null==r?void 0:r.complexMapping)?ObjectHelper.getPath(u,S):u[S],R=p.processField(t,y[t],d),x=y[t]={value:R},T=d.getRelationConfig(t);D||a.isEqual(w,R)||s&&void 0===R||(d.generation++,x.oldValue=null!=(c=null==(l=null==r?void 0:r.getOldValue)?void 0:l.call(r,d))?c:w,C=!0,a.isEqual(d.meta.modified[t],R)?(Reflect.deleteProperty(h.modified,t),d.isReverting&&(d.data[S]=R)):d.ignoreBag||(t in h.modified||d.storeFieldChange(t,w),x.oldValue===_undefined&&Reflect.deleteProperty(x,"oldValue")),v[t]=x,d.applyValue(E,S,R,i,r),T&&!n&&(d.initRelation(T),d.stores.forEach((e=>e.cacheRelatedRecord(d,R,T.relationName,x.oldValue)))))}return C&&d.afterChange(y,v,r,n,i),d.inSetting=!1,C?v:null}applyValue(e,t,r,n,i){const s=this;let a=null==i?void 0:i.complexMapping;if(t!==s.constructor.parentIdField)if(e)s[(null==i?void 0:i.name)||t]=r;else if(null==i?void 0:i.set)i.set(r,s.data,s);else{if(!i&&t.includes(".")){const e=t.split(".")[0];a=(null==(i=s.constructor.fieldMap[e])?void 0:i.complexMapping)||"object"===(null==i?void 0:i.type)}a?ObjectHelper.setPath(s.data,t,r):s.data[t]=r}else(s.firstStore.getById(r)||s.firstStore.rootNode).insertChild(s,null,!1,{orderedParentIndex:{skip:!0}})}afterChange(e,t,r,n,i){for(const s of this.stores)s.onModelChange(this,e,t,r,n,i);this.forEachLinked(((s,a)=>s.onModelChange(a,e,t,r,n,i)))}forEachLinked(e){for(const t of this.$links)for(const r of t.stores)e(r,t)}get isPersistable(){return!this.isBatchUpdating&&!this.isCreating}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}get hasPersistableChanges(){return this.isPersistable&&!ObjectHelper.isEmpty(this.rawModificationData)}isFieldModified(e){return this.isModified&&e in this.meta.modified}getFieldPersistentValue(e){const t="string"==typeof e?this.getFieldDefinition(e):e,r=(null==t?void 0:t.name)||e;let n;return t&&!t.persist||(n=this[r],(null==t?void 0:t.serialize)&&(n=t.serialize(n,this))),n}get modifications(){const e=this.rawModifications;return e&&Object.keys(e).length&&(e[this.constructor.idField]=this.id),e}get rawModifications(){const e=this,t={};if(!e.isModified)return null;let r=!1;return Object.keys(e.meta.modified).forEach((n=>{const i=e.getFieldPersistentValue(n);i!==_undefined&&(t[n]=i,r=!0)})),r?t:null}get modificationData(){const e=this.rawModificationData;return e&&Object.keys(e).length&&ObjectHelper.setPath(e,this.constructor.idField,this.id),e}get rawModificationData(){const e=this,{fieldMap:t}=e.constructor,r={};if(!e.isModified)return null;let n=!1;return Object.keys(e.meta.modified).forEach((i=>{const s=t[i];if(null==s?void 0:s.persist){const t=e.getFieldPersistentValue(i);t!==_undefined&&(ObjectHelper.setPath(r,s.dataSource,t),n=!0)}})),n?r:null}get modificationDataToWrite(){const e=this.constructor.alwaysWriteFields,t=this.modificationData;return e.forEach((e=>{t[this.getFieldDefinition(e).dataSource]=this.getFieldPersistentValue(e)})),t}get persistableData(){const e=this,t={};return e.fields.forEach((r=>{const n=e.getFieldPersistentValue(r);n!==_undefined&&((null==r?void 0:r.complexMapping)?ObjectHelper.setPath(t,r.dataSource,n):t[r.dataSource]=n)})),t}get dataByFieldName(){const{data:e}=this;return this.fields.reduce(((t,r)=>(ObjectHelper.hasPath(e,r.dataSource)&&(t[r.name]=e[r.dataSource]),t)),{})}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0,r=null){const n=this,{meta:i}=n;if(r)for(const e in r)delete i.modified[e];else i.modified={};const s=ObjectHelper.isEmpty(i.modified);i.committing=!1,t&&n.stores.forEach((t=>{if(s&&t.modified.remove(n),t.added.remove(n),e){const e=t.collectDescendants(n).all;t.added.remove(e),s&&t.modified.remove(e)}}))}storeFieldChange(e,t){this.meta.modified[e]=t}revertChanges(e=!1){this.isReverting=!0,this.set(this.meta.modified,_undefined,e),this.isReverting=!1}applyChangeset(e,t="$PhantomId",r=!0){var n;const i=this,s=i.constructor,{idField:a,fieldDataSourceMap:o}=s,l=ObjectHelper.pathifyKeys(e),c=ObjectHelper.pathifyKeys(i.modificationData),d={},u=t in e;for(const e in l){const t=o[e],i=null!=(n=null==t?void 0:t.name)?n:e;(r||((null==t?void 0:t.name)===a?u:l[e]===c[e]))&&(d[i]=l[e])}const h=i.set(d);return i.clearChanges(!1,!0,r?null:d),h?Object.entries(h).reduce(((e,[t,r])=>(e[t]=r.value,e)),{}):{}}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get isModel(){return!0}get hasGeneratedId(){return"string"==typeof this.id&&this.id.startsWith("_generated")}static generateId(e=this.$$name){return"_generated"+e+"_"+StringHelper.generateUUID()}generateId(){return this.constructor.generateId()}static asId(e){return(null==e?void 0:e.isModel)?e.id:ObjectHelper.isObject(e)?e[this.fieldMap.id.dataSource]:e}get json(){return StringHelper.safeJsonStringify(this)}toJSON(){const{children:e,unfilteredChildren:t}=this,r=this.persistableData;return(t||e)&&(r[this.constructor.childrenField]=(t||e).map((e=>e.toJSON()))),r}toString(){const e=this,t=abbreviationFields.find((t=>t in e.constructor.fieldMap)),r=t?{[e.constructor.idField]:e.id,[t]:e[t]}:e.data;return StringHelper.safeJsonStringify(r)}get isBatchUpdating(){return Boolean(this.batching)}hasBatchedChange(e){var t,r;return null==(r=null==(t=this.meta)?void 0:t.batchChanges)?void 0:r[e]}beginBatch(e=!1){const t=this;t.batching||(t.batching=0,t.meta.batchChanges={}),e&&(t.$silenceBatch=(t.$silenceBatch||0)+1),t.batching++}endBatch(e=!1,t=!1,r=!0){const n=this,{parentIdField:i}=n.constructor;if(n.batching&&(n.batching--,n.$silenceBatch&&n.$silenceBatch--,!(n.batching>0||ObjectHelper.isEmpty(n.meta.batchChanges)))){let{batchChanges:s}=n.meta;n.meta.batchChanges=null,s[i]&&(s={...s},n.parentId=s[i],delete s[i]),n.set(s,_undefined,e,!1,t,void 0,r)}}cancelBatch(){if(this.batching){const e=this,{batchChanges:t}=e.meta,r={};if(e.batching=null,e.meta.batchChanges=null,e.generation++,!e.$silenceBatch){Object.entries(t).forEach((([t,n])=>{r[t]={oldValue:n,value:e[t]}}));const n={action:"update",record:e,records:[e],changes:r};e.stores.forEach((e=>{e.trigger("batchedUpdate",{...n})})),e.forEachLinked(((e,t)=>{e.trigger("batchedUpdate",{...n,record:t,records:[t]})}))}e.$silenceBatch&&e.$silenceBatch--}}triggerBeforeUpdate(e){var t;return!(null==(t=this.stores)?void 0:t.some((t=>!1===t.trigger("beforeUpdate",{record:this,changes:e}))))}copy(e=null,t){const r=this,n=ObjectHelper.clone(r.data),i=r.constructor.idField,s=ObjectHelper.isObject(t)?t.deep:t;let a;if(e&&"object"==typeof e?(a=e[i],Object.assign(n,e)):a=e,s&&r.children?n.children=r.children.map((e=>e.copy(void 0,t))):(delete n.children,delete n.expanded),r.$meta.fields.initable.length>0){const e=r.toJSON();for(const t of r.$meta.fields.initable)n[t.name]=e[t.name]}!1!==e&&(n[i]=a||r.generateId(r.firstStore));const o=new r.constructor(n,null,null,!1,!0);return o.originalInternalId=r.internalId,o}copyData(e,t,r){const n={};e.allFields.forEach((({name:r})=>{r!==e.constructor.idField&&(n[r]=t?e.get(r):e[r])})),this.set(n,null,r)}remove(e=!1){const t=this,{parent:r}=this;r?r.removeChild(t):t.stores.length&&!t.isSpecialRow&&t.stores.forEach((r=>r.remove(t,e,!1,!0)))}beforeRemove(e,t){return super.beforeRemove(e,t)}get isValid(){return!0}get firstStore(){return this.stores.length>0&&this.stores[0]}joinStore(e){const t=this,{stores:r}=t;if(!r.includes(e)){const{unjoinedStores:n}=t;super.joinStore(e),e.register(t),r.push(e),n.includes(e)&&n.splice(n.indexOf(e),1),t.isLoaded&&t.children.forEach((t=>t.joinStore(e))),t.initRelations(),e.tree&&!t.isRoot&&(t.instanceMeta(e.id).collapsed=!t.expanded)}}unjoinStore(e,t=!1){var r,n,i;const s=this,{stores:a,unjoinedStores:o}=s;a.includes(e)&&(e.isDestroying||(e.unregister(s),o.push(e)),null==(n=null==(r=s.unfilteredChildren||s.children)?void 0:r.forEach)||n.call(r,(r=>r.unjoinStore(e,t))),a.splice(a.indexOf(e),1),null==(i=super.unjoinStore)||i.call(this,e,t),e.uncacheRelatedRecord(s))}isPartOfStore(e){return e?e.includes(this):this.stores.length>0}get isRemoved(){return!this.isPartOfStore()}instanceMeta(e){const{meta:t}=this,r=e.id||e;return t.map||(t.map={}),t.map[r]||(t.map[r]={})}get isGroupHeader(){return"groupRowFor"in this.meta}get isGroupFooter(){return"groupFooterFor"in this.meta}get isSpecialRow(){var e;return Boolean(null==(e=this.meta)?void 0:e.specialRow)}get $original(){return this.isLinked?this.proxyMeta.originalRecord:this}static get nonPersistableFields(){const e=this;return e._nonPersistableFields||(e._nonPersistableFields={},e.allFields.forEach((t=>{t.persist&&!t.calculated||(e._nonPersistableFields[t.name]=1)}))),e._nonPersistableFields}static get alwaysWriteFields(){const e=this;return e._alwaysWriteFields||(e._alwaysWriteFields=[],e.allFields.forEach((t=>{t.alwaysWrite&&e._alwaysWriteFields.push(t.name)}))),e._alwaysWriteFields}get domId(){return"string"==typeof this.id?this.id.replace(/[ .]/g,"-"):this.id}static toJavaScriptValue(e){const{names:t}=this.$meta;return"class "+t[t.length-2]+" extends "+t[t.length-3]+" { static fields = "+StringHelper.toJavaScriptValue(this.fields,e)+"; }"}getCurrentConfig(e){const{data:t,children:r}=this,{defaultValues:n,applyConfigs:i}=this.constructor,s=i?super.getCurrentConfig(e):{};if(s){for(const r of this.fields)if(r.persist){const i=ObjectHelper.getPath(t,r.dataSource);r.isEqual(i,n[r.name])||ObjectHelper.setPath(s,r.dataSource,Base.processConfigValue(i,e))}if(r)if(Array.isArray(r)){s.children=[];for(const t of r)s.children.push(t.getCurrentConfig(e))}else s.children=r;this.hasGeneratedId&&delete s.id,delete s.parentId,delete s.parentIndex}return s}},Model=_Model;__publicField(Model,"relations",null),Model._idField="id",Model._internalIdCounter=1,Model._assignedIdField=!1,Model.exposeProperties(),Model._$name="Model";var Duration=class{constructor(e,t){"number"==typeof e||null===e?(this._magnitude=e,this._unit=t):("string"==typeof e&&Object.assign(this,DateHelper.parseDuration(e)),"object"==typeof e&&Object.assign(this,e))}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude="number"==typeof e&&e}get unit(){return this._unit}set unit(e){this._unit=DateHelper.parseTimeUnit(e)}get isValid(){return null!=this._magnitude&&Boolean(DateHelper.normalizeUnit(this._unit))}get milliseconds(){return this.isValid?Math.round(DateHelper.asMilliseconds(this._magnitude,this._unit)):0}isEqual(e){return Boolean(e)&&null!=this._magnitude&&null!=e._magnitude&&this.milliseconds===e.milliseconds}toString(e){const t=this,r=e?"getShortNameOfUnit":"getLocalizedNameOfUnit";return t.isValid?t._magnitude+" "+DateHelper[r](t._unit,1!==t._magnitude):""}toJSON(){return this.toString()}valueOf(){return this.milliseconds}};Duration._$name="Duration";var nestedValueReducer=(e,t)=>null==e?void 0:e[t],relativeDateUnitRegExp=/^is(this|next|last)(week|month|year)$/i,relativeDateOperators=["isToday","isTomorrow","isYesterday","isThisWeek","isNextWeek","isLastWeek","isThisMonth","isNextMonth","isLastMonth","isThisYear","isNextYear","isLastYear","isYearToDate"],_CollectionFilter=class extends(Base.mixin(Identifiable_default)){static get defaultConfig(){return{value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null,type:null,internal:null,disabled:!1}}static get configurable(){return{property:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),e.type?"date"!==e.type||null==e.value||Array.isArray(e.value)?"duration"!==e.type||null==e.value||Array.isArray(e.value)||(e.value=new Duration(e.value)):e.value=new Date(e.value):DateHelper.isDate(e.value)||Array.isArray(e.value)&&e.value.every(DateHelper.isDate)?e.type="date":e.value instanceof Duration&&(e.type="duration"),super.construct(e)}get id(){return this._id||(this.internal?this._id=_CollectionFilter.generateId("b-internal-"+this.property+"-filter-"):this._id=this.property||_CollectionFilter.generateId("b-filter-")),this._id}set id(e){this._id=e}onChange(e){var t;const r=this;r.isConfiguring||!(null==(t=r.owner)?void 0:t.onFilterChanged)||r.owner.isConfiguring||r.owner.onFilterChanged(r,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){const t=this;let r;return r=t._propertyItems.length>1?t._propertyItems.reduce(nestedValueReducer,e):e[t.property],t[t.operator](t.convert(r))}updateProperty(e){this._propertyItems=e.split("."),this.onChange("property")}set value(e){const t=this;t._value=e,Array.isArray(e)&&({date:1,duration:1}[t.type]||e.length>0&&"string"==typeof e[0])?t._filterValue=e.map((e=>t.convert(e))):!t.caseSensitive&&Array.isArray(e)&&e.length>0&&"string"==typeof e[0]?t._filterValue=e.map((e=>null==e?void 0:e.toLowerCase())):t.caseSensitive||"string"!=typeof e?t._filterValue=t.convert(e):t._filterValue=e.toLowerCase(),t.onChange("value")}get value(){return this._value}get filterValue(){return this._filterValue}set operator(e){this._operator=e,this.onChange("operator")}get operator(){const e=this;return e._operator?e._operator:Array.isArray(e.filterValue)?"isIncludedIn":"string"==typeof e.filterValue?"*":"="}convert(e){var t;return"sameTime"===this.operator||"string"==typeof this.filterValue&&e instanceof Date||("sameDay"===this.operator&&(e=DateHelper.clearTime(e)),e=null!=(t=null==e?void 0:e.valueOf())?t:e),e=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.filterValue)}endsWith(e){return String(e).endsWith(this.filterValue)}isIncludedIn(e){return 0===this.filterValue.length||this.filterValue.includes(e)}isNotIncludedIn(e){return!this.isIncludedIn(e)}includes(e){return 0===this.filterValue.length||String(e).includes(this.filterValue)}doesNotInclude(e){return!this.includes(e)}sameTime(e){return DateHelper.isSameTime(e,this.filterValue)}sameDay(e){return e===this.filterValue}"="(e){return ObjectHelper.isEqual(e,this.filterValue)}"!="(e){return!ObjectHelper.isEqual(e,this.filterValue)}">"(e){return ObjectHelper.isMoreThan(e,this.filterValue)}">="(e){return ObjectHelper.isMoreThan(e,this.filterValue)||ObjectHelper.isEqual(e,this.filterValue)}"<"(e){return ObjectHelper.isLessThan(e,this.filterValue)}"<="(e){return ObjectHelper.isLessThan(e,this.filterValue)||ObjectHelper.isEqual(e,this.filterValue)}"*"(e){return ObjectHelper.isPartial(e,this.filterValue)}between(e){const[t,r]=this._filterValue;return(ObjectHelper.isMoreThan(e,t)||ObjectHelper.isEqual(e,t))&&(ObjectHelper.isLessThan(e,r)||ObjectHelper.isEqual(e,r))}notBetween(e){return!this.between(e)}empty(e){return null==e||0===String(e).length}notEmpty(e){return!this.empty(e)}isToday(e){return this.between(e)}isTomorrow(e){return this.between(e)}isYesterday(e){return this.between(e)}isThisWeek(e){return this.between(e)}isNextWeek(e){return this.between(e)}isLastWeek(e){return this.between(e)}isThisMonth(e){return this.between(e)}isNextMonth(e){return this.between(e)}isLastMonth(e){return this.between(e)}isThisYear(e){return this.between(e)}isNextYear(e){return this.between(e)}isLastYear(e){return this.between(e)}isYearToDate(e){return this.between(e)}isTrue(e){return!0===e}isFalse(e){return!1===e}setRelativeDateValues(){this._filterValue=_CollectionFilter.getRelativeDateRange(this._operator).map((e=>e.valueOf()))}static getRelativeDateRange(e,t=new Date){let r,n,i,s,a,o,l;switch(e){case"isYearToDate":return[DateHelper.floor(t,"1 year"),t];case"isToday":return r=DateHelper.floor(t,"1 day"),[r,DateHelper.add(r,1,"day")];case"isYesterday":return r=DateHelper.floor(t,"1 day"),[DateHelper.add(r,-1,"day"),r];case"isTomorrow":return n=DateHelper.getStartOfNextDay(t),[n,DateHelper.add(n,1,"day")];case"isThisWeek":case"isNextWeek":case"isLastWeek":case"isThisMonth":case"isNextMonth":case"isLastMonth":case"isThisYear":case"isNextYear":case"isLastYear":if(i=e.toLowerCase().match(relativeDateUnitRegExp),!i)throw new Error("Unrecognized relative date expression: "+e);return[,o,l]=i,s="1 "+l,a=DateHelper.floor(t,s),"next"===o?a=DateHelper.add(a,1,l):"last"===o&&(a=DateHelper.add(a,-1,l)),[a,DateHelper.add(a,1,l)]}}static generateFiltersFunction(e){if(!e||!e.length&&!e.count)return FunctionHelper.returnTrue;for(const t of e)"date"===t.type&&relativeDateOperators.includes(t._operator)&&t.setRelativeDateValues();return function(t){let r=!0;for(const n of e)if(n.disabled||(r=n.filter(t)),!r)break;return r}}},CollectionFilter=_CollectionFilter;__publicField(CollectionFilter,"$name","CollectionFilter"),CollectionFilter._$name="CollectionFilter";var idCounts2=ObjectHelper.getPathDefault(globalThis,"gantt.idCounts",Object.create(null)),IdHelper=class{static generateId(e="generatedId"){return e+(idCounts2[e]=(idCounts2[e]||0)+1)}};IdHelper._$name="IdHelper";var CollectionSorter=class extends Base{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||IdHelper.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:r,property:n,useLocaleSort:i}=this,s="desc"===this.direction.toLowerCase()?-1:1;if(e=e[n],t=t[n],r&&(e=r(e),t=r(t)),i&&null!=e&&null!=t&&"string"==typeof e){if(!0===i)return String(e).localeCompare(t);if("string"==typeof i)return String(e).localeCompare(t,i);if("object"==typeof i)return String(e).localeCompare(t,i.locale,i)}return(e>t?1:e<t?-1:0)*s}static generateSortFunction(e,t){const r=e.isCollection?e.values:e,n=r.length;return(e,i)=>{let s,a;for(a=0;a<n;++a)if(s=r[a].sortFn(e,i),s)return s;return t?t(e,i):0}}};CollectionSorter._$name="CollectionSorter";var return0=()=>0,reverseNumericSortFn=(e,t)=>t-e,filteredIndicesProperty=Symbol("filteredIndicesProperty"),emptyArray2=Object.freeze([]),sortEvent=Object.freeze({action:"sort",added:emptyArray2,removed:emptyArray2,replaced:emptyArray2}),filterEvent=Object.freeze({action:"filter",added:emptyArray2,removed:emptyArray2,replaced:emptyArray2}),keyTypes={string:1,number:1};function addItemToIndex(e,t,r){if(!1!==t.unique)t.set(r,e);else{let n=t.get(r);n||(n=new Set,t.set(r,n)),n.add(e)}}function removeItemFromIndex(e,t,r){!1!==t.unique?t.delete(r):t.has(r)&&(t.get(r).delete(e),t.get(r).size||t.delete(r))}function doRebuildIndices(e,t,r,n){for(let i=0;i<e.length;i++){const s=e[i];for(let e=0;e<n;e++){const n=r[e],i=s[n];addItemToIndex(s,t[n],i)}}}var Collection=class extends(Base.mixin(Events_default)){constructor(){super(...arguments),__publicField(this,"_sortFunction",null),__publicField(this,"_addedValues",null)}static get configurable(){return{idProperty:"id",extraKeys:null,autoFilter:!0,autoSort:!0,sorters:{$config:["lazy"],value:[]}}}get isCollection(){return!0}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){var e;super.doDestroy();const t=this;t._values.length=0,t.isFiltered&&(t._filteredValues.length=0,t.filters.destroy()),null==(e=t._sorters)||e.destroy()}clear(){const e=this,t=e._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}equals(e,t){if(e.isCollection&&(e=e.values),e.length===this.count){let{values:r}=this;return t&&(e=e.map(t),r=r.map(t)),ArrayHelper.delta(e,r).inBoth.length===this.count}return!1}replaceValues({values:e,filteredValues:t,silent:r=!1,isNewDataset:n=!1}){const i=this;let s,a;if(i.isFiltered&&!n){Boolean(t)?e&&(s=i._values,i._values=e.slice()):(t=e.slice(),e=null),a=i._filteredValues,i._filteredValues=t.slice()}else s=i._values,i._values=e.slice(),t=null,i.isFiltered&&n&&i.autoFilter?(i._filterFunction=null,i._filteredValues=i._values.filter(i.filterFunction)):i._filteredValues&&(i._filteredValues.length=0);i._indicesInvalid=!0,i._addedValues=void 0,i.generation++,r||i.trigger("change",{action:"replaceValues",replacedValues:s,replacedFilteredValues:a,values:e,filteredValues:t})}set values(e){this.invalidateIndices(),this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}get filteredValues(){return this._filteredValues}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}get addedValues(){return this._addedValues}match(e,t=!0){const r=this,{_values:n}=r,i=[];return r.forEach((s=>{const a=e.get(s.id,!0);if(a){const e=r.indexOf(s,!0),t=n[e];n[e]=a,r.removeFromIndices(t),r.addToIndices(a)}else t&&i.push(s)})),i.length&&r.remove(i),r.isFiltered&&(r._filteredValues=r._values.filter(r.filterFunction)),i}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){for(e=ArrayHelper.asArray(e);e.length&&e[0]===t;)e.shift();if(!e.length)return;const r=this,{_values:n}=r,i=r.indexOf(e[0],!0);if(1===e.length&&n[i+1]===t)return;r.suspendEvents(),r.remove(e),r.resumeEvents();const s=t?r.indexOf(t,!0):n.length;if(-1===s)throw new Error("Collection move beforeItem parameter must be present in Collection");return n.splice(s,0,...e),r._indicesInvalid=1,r.trigger("change",{action:"move",items:e,from:i,to:s}),s}splice(e=0,t,...r){const n=this,i=n.idProperty,s=n._values,a={},o=[],l=[],c=n.totalCount;let d,u;if(!1!==n.trigger("beforeSplice",{index:e,toRemove:t,toAdd:r})){if(r)if(1===r.length&&Array.isArray(r[0])&&(r=r[0]),c&&r.length){const e=n.indices[i];d=[];for(let t=0;t<r.length;t++){const n=r[t],o=n[i],c=e.get(o),u=c?s.indexOf(c):-1;a[o]=!0,-1!==u?s[u]!==n&&(l.push([s[u],n]),s[u]=n):d.push(n)}}else d=r;if(t){if("number"==typeof t){t=Math.min(t,s.length-e);for(let r=e;t;--t){a[s[r][i]]?(e++,r++):(o.push(s[r]),s.splice(r,1),u=!0)}}else{let e,r=0===d.length;const l=(t=ArrayHelper.asArray(t)).reduce(((t,i)=>{const s="number"==typeof i,a=s?i:n.indexOf(i,!0);return r&&(null!=e&&a!==e+1||s)&&(r=!1),a>=0&&a<c&&t.push(a),e=a,t}),[]).sort(reverseNumericSortFn);if(r)l.length&&(o.push.apply(o,t),s.splice(l[l.length-1],l.length),u=!0);else for(let e=0;e<l.length;e++){const t=l[e];if(-1!==t){a[s[t][i]]||(o.unshift(s[t]),s.splice(t,1),u=!0)}}}o.length&&!n._indicesInvalid&&o.forEach(n.removeFromIndices,n)}if(d.length){s.splice(Math.min(e,s.length),0,...d),u=!0,n._indicesInvalid||d.forEach(n.addToIndices,n),n._addedValues||(n._addedValues=new Set);for(const e of d)n._addedValues.add(e)}if(o.length&&n._addedValues)for(const e of o)n._addedValues.delete(e);l.length&&!n._indicesInvalid&&l.forEach((e=>{n.removeFromIndices(e[0]),n.addToIndices(e[1])})),u||l.length?(n.isSorted?n.onSortersChanged():n.isFiltered&&(n.autoFilter?n.onFiltersChanged({action:"splice",oldCount:1}):n._filteredValues.splice(Math.min(e,n._filteredValues.length),0,...d)),n.generation++,n.trigger("change",{action:"splice",removed:o,added:d,replaced:l,oldCount:c})):n.trigger("noChange",{index:e,toRemove:t,toAdd:r})}}changeId(e,t){const r=this,{idProperty:n}=r,i=keyTypes[typeof e]?e:e[n],s=r.get(i);if(s){const a=r.get(t);if(a&&s!==a)throw new Error("尝试将项"+i+"设置为现有成员的id "+t);r.removeIndexEntry(e,n,i),r.addIndexEntry(e,n,t),s[n]=t}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,r=!1){return this.findItem(e,t,this.isFiltered&&r)}get count(){return this.values.length}get totalCount(){return this._values.length}updateIdProperty(e){this.addIndex({property:e,unique:!0})}changeSorters(e){return new Collection({values:ArrayHelper.asArray(e),internalListeners:{change:"onSortersChanged",thisObj:this}})}addSorter(e){const t=e instanceof CollectionSorter?e:new CollectionSorter(e);return this.sorters.add(t),t}get isSorted(){var e;return Boolean(null==(e=this._sorters)?void 0:e.count)}onSortersChanged(){const e=this;e._sortFunction=null,e._addedValues=null,e._values.sort(e.sortFunction),e.trigger("change",sortEvent)}get sortFunction(){return this._sortFunction||(this.isSorted?this._sortFunction=CollectionSorter.generateSortFunction(this.sorters.values):this._sortFunction=return0),this._sortFunction}get filters(){return this._filters||(this._filters=new Collection({internalListeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof CollectionFilter?e:new CollectionFilter(e);return this.filters.add(t),t}removeFilter(e){const{filters:t}=this;e.isCollectionFilter||(e=t.get(e)),t.remove(e)}clearFilters(){this.filters.clear()}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged({action:e,removed:t,oldCount:r}){const n=this,i=r||"clear"===e&&t.length?n._filteredValues:n._values;n._filterFunction=null,n._filteredValues=n._values.filter(n.filterFunction),n._indicesInvalid=!0;const{toAdd:s,toRemove:a}=ArrayHelper.delta(n._filteredValues,i,!0);n.trigger("change",{...filterEvent,added:s,removed:a})}get filterFunction(){return this._filterFunction||(this.isFiltered?this._filterFunction=CollectionFilter.generateFiltersFunction(this.filters.values):this._filterFunction=FunctionHelper.returnTrue),this._filterFunction}changeExtraKeys(e){return ArrayHelper.asArray(e).map((e=>"string"==typeof e?{property:e,unique:!0}:e))}updateExtraKeys(e){for(let t=0;t<e.length;t++)this.addIndex(e[t])}addIndex(e){const t=this;e&&((t._indices||(t._indices={}))[e.property]=new Map,Object.assign(t._indices[e.property],e),t.invalidateIndices(),e.dependentOn&&(t.hasCompositeIndex=!0))}findIndex(e,t,r=!1){const n=this.findItem(e,t,r);if(!n)return-1;return(this.isFiltered&&!r?this._filteredValues:this._values).indexOf(n)}findItem(e,t,r=!1){var n;const i=this,{isFiltered:s}=i,a=s&&!r?i.indices[filteredIndicesProperty][e]:i.indices[e];if(a){const e=null!=(n=a.get(t))?n:"string"==typeof t&&t.length&&!isNaN(t)&&a.get(Number(t))||null;if(null!=e)return e}else{const n=s&&!r?i._filteredValues:i._values,a=n.length;for(let r=0;r<a;r++){const i=n[r];if(i[e]==t)return i}}return null}removeIndex(e){delete this._indices[e],this.hasCompositeIndex=Object.values(this.indices).some((e=>e.dependentOn))}indexOf(e,t=!1){return this.findIndex(this.idProperty,keyTypes[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return Array.isArray(e)?e.some((e=>this.includes(e))):Boolean(this.findItem(this.idProperty,keyTypes[typeof e]?e:e[this.idProperty],t))}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}invalidateIndices(){this._indicesInvalid=!0}rebuildIndices(){const e=this,t=e.isFiltered,r=e._indices||(e._indices={}),n=Object.keys(r),i=n.length,s=e._values;let a;t&&(a=r[filteredIndicesProperty]={});for(let e=0;e<i;e++){const i=r[n[e]];if(i.clear(),t){let t=a[n[e]];t?t.clear():(t=a[n[e]]=new Map,t.unique=i.unique)}}doRebuildIndices(s,r,n,i),t&&doRebuildIndices(e._filteredValues,a,n,i),e._indicesInvalid=!1}getIndices(e){const t=[this.indices[e]];return this.isFiltered&&t.push(this.indices[filteredIndicesProperty][e]),t}addToIndices(e){Object.keys(this.indices).forEach((t=>{this.addIndexEntry(e,t,e[t])}))}removeFromIndices(e){Object.keys(this.indices).forEach((t=>{this.removeIndexEntry(e,t,e[t])}))}removeIndexEntry(e,t,r){this.getIndices(t).forEach((t=>removeItemFromIndex(e,t,r)))}addIndexEntry(e,t,r){this.getIndices(t).forEach((t=>addItemToIndex(e,t,r)))}onItemMutation(e,t){const r=this;!r._indicesInvalid&&Object.keys(r.indices).length>1&&Object.keys(t).forEach((n=>{var i;if(r.indices[n]){const{value:i,oldValue:s}=t[n];r.removeIndexEntry(e,n,s),r.addIndexEntry(e,n,i)}else if(r.hasCompositeIndex){const s=Object.values(r.indices).find((e=>{var t;return null==(t=e.dependentOn)?void 0:t[n]}));if(s){const n={};for(const r in s.dependentOn)n[r]=(null==(i=t[r])?void 0:i.oldValue)||e[r];const a=e.buildIndexKey(n);r.removeIndexEntry(e,s.property,a),r.addIndexEntry(e,s.property,e[s.property])}}}))}};Collection._$name="Collection";var nonPrimitives=new WeakMap,safeIndexKey=e=>{if(e&&"object"==typeof e){let t=nonPrimitives.get(e);void 0===t&&(t=Symbol("bscik"),nonPrimitives.set(e,t)),e=t}return e},Bag=class{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values))}get(e){return this.idMap[safeIndexKey(e)]}get count(){return this.items.size}add(...e){1===e.length&&Array.isArray(e[0])&&(e=e[0]);const t=this,{items:r,idMap:n,idProperty:i}=t,s=e.length;for(let a=0;a<s;a++){const s=e[a],o=keyTypes[typeof s]?s:safeIndexKey(s[i]),l=n[o];null==l?(n[o]=s,r.add(s),t.generation++):l!==s&&(n[o]=s,r.delete(l),r.add(s))}}at(e){let t,r;for(t of(e<0&&(e+=this.count),this.items))if(!e--){r=t;break}return r}remove(e){e=ArrayHelper.asArray(e);const{items:t,idMap:r,idProperty:n}=this,i=e.length;for(let s=0;s<i;s++){const i=e[s],a=keyTypes[typeof i]?i:safeIndexKey(i[n]),o=r[a];null!=o&&(t.delete(o),delete r[a],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}countOf(e){let t,r=0;for(t of this.items)e(t)&&++r;return r}changeId(e,t){const r=this,{idMap:n,idProperty:i}=r,s=keyTypes[typeof e]?e:safeIndexKey(e[i]),a=r.get(s);if(a){const e=r.get(t);if(e&&a!==e)throw new Error("尝试将项"+s+"设置为现有成员的id "+t);a[i]=t,delete n[s],n[t]=a}}filter(e,t){const{items:r}=this,n=[];let i=0;return r.forEach((s=>{e.call(t,s,i++,r)&&n.push(s)})),n}includes(e){const t=keyTypes[typeof e]?e:safeIndexKey(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:r}=this,n=new Array(r.size);let i=0;return r.forEach((s=>{n[i]=e.call(t,s,i++,r)})),n}forEach(e,t){return this.items.forEach(e,t)}find(e,t=0){let r,n;for(r of(t<0&&(t+=this.countOf(e)),this.items))if(e(r)&&!t--){n=r;break}return n}[Symbol.iterator](){return this.items[Symbol.iterator]()}indexOf(e,t){let r,n=-1;for(r of this.items)if((!t||t(r))&&(++n,r===e))return n;return-1}get values(){return[...this.items]}set values(e){e=ArrayHelper.asArray(e),this.clear(),this.add.apply(this,e),this.generation++}sort(e){this.values=this.values.sort(e)}some(e,t){return this.values.some(e,t)}};Bag._$name="Bag";var StoreBag=class extends Bag{add(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),super.add(...e.filter((e=>e.isPersistable)))}};StoreBag._$name="StoreBag";var StoreCRUD_default=e=>class extends(e||Base){static get $name(){return"StoreCRUD"}static get defaultConfig(){return{autoCommit:!1}}static get properties(){return{isRemoving:!1,suspendCount:0}}remove(e,t=!1){const r=this,{storage:n}=r;if(0===(e=ArrayHelper.asArray(e).reduce(((e,t)=>((t=r.getById(t))&&e.push(t),e)),[])).length)return e;if(!r.tree&&!t&&!1===r.trigger("beforeRemove",{records:e}))return[];if(r.isRemoving=!0,r.isGrouped){const t=n.count,i=[],s=new Set;for(const t of e){const{groupParent:e}=t.instanceMeta(r);e.meta.collapsed&&i.push(t),ArrayHelper.remove(e.groupChildren,t),ArrayHelper.remove(e.unfilteredGroupChildren,t),e.meta.childCount--,s.add(e)}for(const e of s)e.groupChildren.length>0&&r.onModelChange(e,{},{});i.length&&n.trigger("change",{action:"splice",removed:i,added:[],replaced:[],oldCount:t})}else if(r.tree){const i=[],s=e.length>1,a=e[0],o=s?void 0:n.indexOf(a),l=e.reduce(((e,t)=>{const{parent:r}=t;return r&&(e[r.id]||(e[r.id]=[r,[]]),e[r.id][1].push(t)),e}),{});if(!t&&!1===r.trigger("beforeRemove",{records:e,isMove:!1,parent:s?void 0:a.parent}))return r.isRemoving=!1,[];for(const e of Object.values(l)){const t=e[0],r=e[1];i.push(...t.removeChild(r,!1,!0))}return t||(r.trigger("remove",{parent:s?void 0:a.parent,index:o,isChild:!0,allRecords:i,isMove:!1,records:e}),r.trigger("change",{action:"remove",records:e})),r.isRemoving=!1,e}if(0===e.length)return r.isRemoving=!1,e;for(const t of e)t.beforeRemove(e);return t&&r.suspendEvents(),n.remove(e),t&&r.resumeEvents(),r.autoCommit&&r.doAutoCommit(),r.isRemoving=!1,e}clear(e=!1){var t,r;const n=this,{storage:i}=n;if(n.storage.totalCount||(null==(r=null==(t=n.rootNode)?void 0:t.unfilteredChildren)?void 0:r.length)){if(!e&&!1===n.trigger("beforeRemove",{records:i.allValues,removingAll:!0}))return null;if(n.rootNode)n.isChained||n.rootNode.clearChildren(e);else if(e){const e=n.registeredRecords;for(let t,r=e.length-1;r>=0;r--)t=e[r],t&&!t.isDestroyed&&t.unjoinStore(n)}e&&(n.removed.clear(),i.suspendEvents()),i.clear(),e&&i.resumeEvents(),n.added.clear(),n.modified.clear()}}removeAll(e=!1){const t=this,r=t.storage;let n;if(t.isRemoving=!0,e){r.suspendEvents();const e=t.registeredRecords;for(let r,n=e.length-1;n>=0;n--)r=e[n],!r||r.isDestroyed||r.isRoot||r.unjoinStore(t)}return n=t.tree?!1!==t.rootNode.clear():null!==t.clear(),e&&r.resumeEvents(),t.isRemoving=!1,n}add(e,t=!1,r={}){const n=this,{storage:i}=n;if(!(null==(e=ArrayHelper.asArray(e))?void 0:e.length))return;if(n.tree=n.tree||Boolean(n.autoTree&&e[0].children),n.tree){const i=new Map,s=n.modelClass.getFieldDataSource("parentIndex"),{parentIdField:a}=n.modelClass,o=[];return e.forEach((e=>{const t=e[a];i.has(t)||i.set(t,{append:[],insert:[]});const r=i.get(t);!e.isModel&&s in e?r.insert.push(e):r.append.push(e)})),i.forEach((({append:e,insert:i},a)=>{const l=null==a?n.rootNode:n.getById(a);if(!l)throw new Error("Parent node with id "+a+" not found, cannot add children.");if(e.length&&o.push(...l.appendChild(e,t)),i.length)for(const e of i)o.push(l.insertChild(e,e[s],t,r))})),n.reapplySortersOnAdd&&n.sort(),o}if(!t&&!1===n.trigger("beforeAdd",{records:e}))return null;if(n.tree=n.tree||Boolean(n.autoTree&&e[0].children),n.tree)return n.rootNode.appendChild(e);const s=n.processRecords(e);return t&&n.suspendEvents(),i.add(s),t&&n.resumeEvents(),n.autoCommit&&n.doAutoCommit(),s}processRecords(e,t){return e.map((e=>{const r=this.processRecord(e.isModel?e:this.createRecord(e));return null==t||t.call(this,r),r}))}insert(e,t,r=!1){var n;const i=this,s=i.storage,a=i.getAt(e),o=s.values,l=[];if(t=ArrayHelper.asArray(t),i.tree){const s=i.rootNode;return s.insertChild(t,null==(n=s.children)?void 0:n[e],r)}if(!r&&!1===i.trigger("beforeAdd",{records:t}))return null;let c,d,u;if(o[d=e]===t[0]||o[d=e-1]===t[0])for(c=!0,u=0;c&&u<t.length;u++)t[u]!==o[d+u]&&(c=!1);if(c)return null;const h=i.processRecords(t,(t=>{const r=s.indexOf(t);t.children&&t.children.length&&i.autoTree&&(i.tree=!0),r>-1&&(r<e&&a&&e--,l.push(r)),t.meta.previousIndex=r}));return i.suspendEvents(),i.storage.remove(l),i.resumeEvents(),r&&i.suspendEvents(),s.splice(e,0,...h),r&&i.resumeEvents(),i.autoCommit&&i.doAutoCommit(),h}move(e,t){this.isTree?t.parent.insertChild(e,t):this.storage.move(e,t)}setMultiple(e,t,r){const n=this,i=[],s=[];n.forEach((n=>{e(n)&&(s.push(n.set(t,r,!0)),i.push(n))})),n.trigger("updateMultiple",{records:i,all:n.records.length===i.length}),n.trigger("change",{action:"updatemultiple",records:i,all:n.records.length===i.length}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}setAll(e,t){const r=this,n=[];r.forEach((r=>{n.push(r.set(e,t,!0))})),r.trigger("updateMultiple",{records:r.records,all:!0}),r.trigger("change",{action:"updatemultiple",records:r.records,all:!0}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}acceptChanges(){const e=this;e.added.forEach((e=>e.clearChanges(!0,!1))),e.modified.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.modified.clear(),e.removed.clear()}commit(e=!1){const{changes:t}=this;return!(!e&&!1===this.trigger("beforeCommit",{changes:t}))&&(this.acceptChanges(),e||this.trigger("commit",{changes:t}),t)}revertChanges(){const e=this,{changes:t}=e;if(t){const r={action:"clearchanges",changes:t};e.add(e.removed.values,!0),e.remove(e.added.values,!0),e.modified.forEach((e=>e.revertChanges(!0))),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",r),e.trigger("refresh",r)}}get changes(){const e=this,t=e.modified.values.filter((e=>e.rawModifications));return e.added.count||t.length||e.removed.count?{added:e.added.values.slice(),modified:t,removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}suspendAutoCommit(){this.suspendCount++}resumeAutoCommit(e=!0){this.suspendCount--,this.autoCommit&&e&&this.doAutoCommit()}doAutoCommit(){this.suspendCount<=0&&this.commit()}},StoreChanges_default=e=>class extends(e||Base){static get $name(){return"StoreChanges"}static get configurable(){return{applyChangesetFilterSortTarget:"changes"}}applyChangesFromStore(e){const t=this,{changes:r}=e;r&&(r.added&&t.add(r.added),r.removed&&t.remove(r.removed.map((e=>e.id))),r.modified&&r.modified.forEach((e=>{t.getById(e.id).set(e.modifications)})))}applyChangeset(e,t=null,r="$PhantomId",n=!0,i=!1){var s,a,o,l;const c=this,{added:d,updated:u,modified:h,removed:g}=null!=(s=null==t?void 0:t(e,c))?s:e,p=null!=(a=null!=u?u:h)?a:[],m=c.modelClass.getFieldDataSource("id"),f=i?new Map:null,v=[],y=[];let b=!1,C=[];if(c._groupVisibleRecordIds=[],c.isGrouped&&c.forEach((e=>{c._groupVisibleRecordIds.push(e.id)})),(null==d?void 0:d.length)>0){const e=[],t=[];for(const n of d)c.getById(null!=(o=n[r])?o:ObjectHelper.getPath(n,m))?e.push(n):t.push(n);p.unshift.apply(p,e);const n=null!=(l=c.add(t,!1,{orderedParentIndex:{skip:!0}}))?l:[];if(v.push(...n),c.tree)for(const e of n){const{parent:t}=e;if(t.isRoot){b=!0,C=[t];break}!t.isRoot&&C.every((e=>!e.contains(t)))&&C.push(t)}for(const e of n)null==f||f.set(e.id,e.data),e.clearChanges()}if((null==p?void 0:p.length)>0)for(const e of p){const t=e[r],i=ObjectHelper.getPath(e,m),s=c.getById(null!=t?t:i);if(s){const t=s.applyChangeset(e,r,n);c.tree&&!b&&C.every((e=>!e.contains(s)))&&(s.parent.isRoot?(b=!0,C=[s.parent]):C.push(s.parent)),null==f||f.set(i,t),y.push(s)}}if((null==g?void 0:g.length)>0&&c.applyRemovals(g),"changes"===c.applyChangesetFilterSortTarget){const e=c.filterChangeset(v,y);C.push(...e)}return c.afterChangesetApplied(C),c._groupVisibleRecordIds=null,f}afterChangesetApplied(e){e.forEach((e=>{e.traverse((e=>{e.sortOrderedChildren(!1,!1),e.children&&e.updateChildrenIndices(e.children,"parentIndex",!0),e.unfilteredChildren&&e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0)}))}))}applyRemovals(e){const t=this,{removed:r}=t,n=t.modelClass.idField,i=[];for(const t of e){const e=ObjectHelper.getPath(t,n);r.includes(e)?r.remove(e):i.push(e)}t.remove(i);for(const e of i)r.remove(e)}filterChangeset(e,t){const r=this,{isFiltered:n,tree:i,isGrouped:s,filtersFunction:a}=r,o=r.isSorted?r.createSorterFn(r.sorters):void 0,{allValues:l,addedValues:c,isSorted:d}=r.storage,u=null!=o||d?null!=o?o:r.storage.sortFunction:null,h=new Set;if(!n)return[];let g,p=!1;if(s&&(g=r.groupers,r.clearGroupers(!0)),i){const n=new Set(t.filter(a));for(const t of e.filter(a))n.add(t);n.forEach((e=>e.bubble((e=>n.add(e))))),n.delete(r.rootNode);const i=ArrayHelper.groupBy(Array.from(n),"parentId");for(const e of Object.values(i)){const{parent:t}=e[0];t.unfilteredChildren&&(r.includeInSubset(t.unfilteredChildren,t.children,e),h.add(t))}}else if(u&&!s){const{filteredValues:e}=r.storage,n=c?e.findLastIndex((e=>!c.has(e)))+1:e.length,i=e.slice(0,n),s=new Set(t.filter(a));for(const t of e)s.has(t)&&s.delete(t);for(const e of s)i.push(e);i.sort(u),e.splice(0,n,...i),p=!0}else{const e=t.filter((e=>a(e)&&!r.storage.includes(e)));e.length>0&&(r.includeInSubset(l,r.storage.filteredValues,e),p=!0)}const m=new Set(e.filter((e=>!a(e))));if(m.size>0){if(i)for(const e of m)ArrayHelper.remove(e.parent.children,e),h.add(e.parent);else ArrayHelper.remove(r.storage.filteredValues,m);p=!0}return g&&(r.group(g[0],null,!1,!0,!0),p=!0),i&&h.size>0?r.storage.replaceValues({values:r.collectDescendants(r.rootNode).visible,silent:!0}):p&&(r._idMap=null,r.trigger("refresh")),[...h]}includeInSubset(e,t,r){const n=new Set(r);let i=0,s=0,a=0===n.size;for(;s<e.length&&!a;){const r=t[i];let o=e[s];for(;r!==o;)n.has(o)&&(t.splice(i,0,o),i++,n.delete(o),a=0===n.size),o=e[++s];n.has(r)&&n.delete(r),i<t.length&&i++}return t}},StoreFilter_default=e=>class extends(e||Base){static get $name(){return"StoreFilter"}static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set reapplyFilterOnAdd(e){this.storage.autoFilter=e}get reapplyFilterOnAdd(){return this.storage.autoFilter}set filters(e){const t=this,r=t.filters;if(r.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))"filterBy"===t[0]&&"function"==typeof t[1]?r.add(new CollectionFilter({filterBy:t[1]})):r.add(new CollectionFilter("Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?r.add(...e.map((e=>e instanceof CollectionFilter?e:new CollectionFilter(e)))):e.isCollection?r.add(...e.values):r.add(new CollectionFilter({filterBy:e}));r.forEach((e=>e.owner=t))}}get filters(){return this._filters||(this._filters=new Collection({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:r}=e;if(!e._filtersFunction)if(t.count){const n=CollectionFilter.generateFiltersFunction(t);e._filtersFunction=e=>r&&e.isSpecialRow?e.groupChildren.some(n):n(e)}else e._filtersFunction=FunctionHelper.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some((e=>!e.disabled))}traverseFilter(e){const t=this,r=!e.isRoot&&t.filtersFunction(e),n=e.unfilteredChildren||e.children;return n&&n.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter((e=>t.traverseFilter(e))),e.updateChildrenIndices(e.unfilteredChildren,"unfilteredIndex",!0),e.updateChildrenIndices(e.children,"parentIndex",!0),r||Boolean(e.children.length)):r}traverseClearFilter(e){const t=this;e.unfilteredChildren&&(e.children=e.unfilteredChildren.slice(),e.unfilteredChildren=null),e.children&&(e.children.forEach((e=>t.traverseClearFilter(e))),e.updateChildrenIndices(e.children,"parentIndex",!0))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}addFilter(e,t=!1){const r=this;if((e=e instanceof CollectionFilter?e:new CollectionFilter(e)).owner=r,r.filters.add(e),!t){if(r.remoteFilter)return r.filter().then((()=>e));r.filter()}return e}filter(e){const t=this;let r,n=!1;if(e){let i=typeof e;if("object"===i&&("silent"in e||"replace"in e||e.filters)&&(n=e.silent,e.replace&&t.clearFilters(0===e.filters.length),r=e.internal,i=typeof(e=e.filters)),e){const n=t.isFiltered;if(t.isConfiguring=!0,Array.isArray(e))e.forEach((e=>t.addFilter(e,!0)),t);else if("function"===i){const n=new CollectionFilter(e);n.internal=r,t.addFilter(n,!0)}else"string"===i?t.addFilter({property:e,value:arguments[1]},!0):t.addFilter(e,!0);if(t.isConfiguring=!1,!t.isFiltered&&!n)return null}}t.filtersFunction=null;const i=t.performFilter(n);return t._idMap=null,i}performFilter(e){const t=this,{storage:r,filters:n,rootNode:i}=t,s=t.count;let a,o;if(t.trigger("beforeFilter",{filters:n}),t.tree){const e=r.values;t.isFiltered?t.traverseFilter(i):t.traverseClearFilter(i);const n=t.collectDescendants(i).visible;r.replaceValues({values:n,silent:!0});const s=ArrayHelper.delta(n,e,!0);a=s.toAdd,o=s.toRemove}else r.ion({change({removed:e,added:t}){o=e,a=t},once:!0}),t.isFiltered?(t.isGrouped&&t.includeCollapsed(),r.addFilter({id:"primary-filter",filterBy:t.filtersFunction}),t.isGrouped&&t.excludeCollapsed()):r.filters.clear();t.afterPerformFilter(e||t.isRemoteDataLoading?null:{action:"filter",filters:n,oldCount:s,added:a,removed:o,records:t.storage.values})}afterPerformFilter(e){this.resetRelationCache(),e&&this.triggerFilterEvent(e)}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.remoteFilter||(this.trigger("refresh",e),this.trigger("change",e))}filterBy(e){return this.filter(e)}removeFilter(e,t=!1){const r=this,n=e instanceof CollectionFilter?e:r.filters.get(e);if(n){if(r.filters.remove(n),r._filtersFunction=null,!t){if(r.remoteFilter)return r.filter().then((()=>n));r.filter()}return n}}clearFilters(e=!0){if(this.filters.remove(this.filters.values.filter((e=>!e.internal))),e)return this.filter()}convertFilterToString(e){const t=this.filters.getBy("property",e);return t&&!t.filterBy?String(t):""}doDestroy(){var e;null==(e=this._filters)||e.destroy(),super.doDestroy()}},resortActions={add:1,replace:1},StoreGroup_default=e=>class extends(e||Base){static get $name(){return"StoreGroup"}static get defaultConfig(){return{groupers:null,useGroupFooters:!1,startGroupsCollapsed:null}}static get properties(){return{collapsedGroups:new Set}}construct(e){super.construct(e),this.ion({change:"onDataChanged",thisObj:this})}get groupers(){return this._groupers}set groupers(e){this.setGroupers(e)}setGroupers(e,t){const r=this,{storage:n}=r;let i;return(null==e?void 0:e.length)?r._groupers=e:r.groupers&&(delete r._groupers,r.includeCollapsed(),n.replaceValues({values:r.removeHeadersAndFooters(n._values),filteredValues:n.isFiltered?r.removeHeadersAndFooters(n._filteredValues):null,silent:!0}),i=r.group(null,null,null,!1,null==t?void 0:t.silent)),r._idMap=null,i}get groupRecords(){const e=[];if(this.isGrouped)for(const t of this)t.isSpecialRow&&e.push(t);return e}get unfilteredGroupRecords(){var e;const t=this;if(t.isGrouped){const{generation:r}=t.storage;(null==(e=t._unfilteredGroupRecords)?void 0:e.generation)!==r&&(t._unfilteredGroupRecords=t.storage.allValues.filter((e=>e.isSpecialRow)),t._unfilteredGroupRecords.generation=r)}return t._unfilteredGroupRecords||[]}getGroupHeaderForRecord(e,t=!1){if(this.isGrouped){let r;const n=t?this.storage._values:this.storage.values;for(const t of n)if(t.isGroupHeader)if(e){if(t===e||t.unfilteredGroupChildren.includes(e)){r=t;break}}else r=t;return r}}includeCollapsed(){for(const e of this.collapsedGroups)this.expand(this.getById(e),!1)}excludeCollapsed(){for(const e of this.collapsedGroups)this.collapse(this.getById(e))}onDataChange({source:e,action:t,removed:r}){var n;const i=this,{groupers:s}=i;s&&(s.length?("splice"===t&&(null==r?void 0:r.length)||"move"===t)&&e.replaceValues({...i.prepareGroupRecords(),silent:!0}):e.replaceValues({values:i.removeHeadersAndFooters(e._values),filteredValues:e.isFiltered?i.removeHeadersAndFooters(e._filteredValues):null,silent:!0})),null==(n=super.onDataChange)||n.call(this,...arguments)}move(e,t){const r=this;if(r.isGrouped&&!r.tree){let n=t;if((null==t?void 0:t.isSpecialRow)&&(n=r.getPrev(t,!1,!1),!n))return;const i=r.getGroupHeaderForRecord(n),s=r.groupers[0].field,a=i.meta.groupRowFor,{reapplyFilterOnUpdate:o}=r;if(r.reapplyFilterOnUpdate=!1,r.beginBatch(),e.forEach((e=>e[s]=a)),r.endBatch(),r.reapplyFilterOnUpdate=o,r.isFiltered&&(null==t?void 0:t.isSpecialRow)){const{unfilteredGroupRecords:e}=r,n=e.indexOf(i);t=e[n+1]}}super.move(e,t)}collapse(e){return!(!e||e.meta.collapsed)&&(this.excludeGroupRecords(e),e.meta.collapsed=!0,this.collapsedGroups.add(e.id),!0)}expand(e,t=!0){return!!(null==e?void 0:e.meta.collapsed)&&(this.includeGroupRecords(e),e.meta.collapsed=!1,t&&this.collapsedGroups.delete(e.id),!0)}removeHeadersAndFooters(e){return e.filter((e=>!e.isSpecialRow||(this.unregister(e),!1)))}prepareGroupRecords(e){const t=this,{isFiltered:r,reapplyFilterOnUpdate:n,startGroupsCollapsed:i}=t,s=t.collapsedGroups,{allValues:a}=t.storage,o=[],l=t._groupVisibleRecordIds||[],c=e=>{const i=!r||t.filtersFunction(e);return n?i:i||l.includes(e.id)};for(const e of a)e.isGroupHeader&&(e.meta.collapsed||s.has(e.id))&&(s.add(e.id),o.push(e));for(const e of o)t.includeGroupRecords(e);const d=t.removeHeadersAndFooters(t.storage._values);e&&d.sort(e),r&&(t.filtersFunction=null);const u=[],h=t.groupers[0].field;let g=null,p=null,m=0;function f(){const e=p.meta.groupRowFor,r="group-footer-"+("number"==typeof e?e:StringHelper.createId(e)),n=t.getById(r)||new t.modelClass({id:r},t,{specialRow:!0,groupFooterFor:e,groupRecord:p});return n.stores=[t],t.register(n),n.groupChildren=p.groupChildren,p.meta.collapsed||u.push(n),t.allRecords.push(n),p.groupChildren.push(n),p.unfilteredGroupChildren.push(n),m++,n}d.forEach((e=>{var r;const n=null==e[h]?"__novalue__":e[h],a="group-header-"+("number"==typeof n?n:StringHelper.createId(n));0!==(null==(r=e.unfilteredGroupChildren)?void 0:r.length)?(ObjectHelper.isEqual(n,g)||(p&&(t.useGroupFooters&&f(),p.meta.childCount=m),p=t.getById(a),p||(p=new t.modelClass({id:a},t,{specialRow:!0,groupRowFor:n,groupField:h}),i&&(s.add(a),t.startGroupsCollapsed=!1)),p.meta.collapsed=s.has(a),p.stores=[t],t.register(p),p.groupChildren=[],p.unfilteredGroupChildren=[],u.push(p),t.allRecords.push(p),g=n,m=0),e.instanceMeta(t.id).groupParent=p,s.has(a)||u.push(e),c(e)&&(p.groupChildren.push(e),m++),p.unfilteredGroupChildren.push(e)):t.unregister(e)})),p&&(t.useGroupFooters&&f(),p.meta.childCount=m),t._idMap=null;const v={values:u};return r&&(v.filteredValues=u.filter(c)),v}get isGrouped(){var e;return Boolean(null==(e=this.groupers)?void 0:e.length)}group(e,t,r=!1,n=!0,i=!1){var s,a;const o=this;let l,c;if(e&&"object"==typeof e&&(t=e.ascending,c=e.fn,e=e.field),r?o.groupers.push(l={field:e,ascending:t,complexMapping:e.includes(".")}):e&&(null==t&&(t=(null==(s=o.groupInfo)?void 0:s.field)!==e||(null==(a=o.groupInfo)?void 0:a.fn)!==c||!o.groupInfo.ascending),o.groupInfo=l={field:e,ascending:t,fn:c,complexMapping:e.includes(".")},o.groupers=[o.groupInfo]),l){const{prototype:t}=o.modelClass;l.complexMapping&&!Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(t,e,{get(){return ObjectHelper.getPath(this,e)}})}if(!1!==n){if(o.remoteSort&&!o.isRemoteDataLoading)return o.sort(null,null,!1,!0).then((()=>o.onAfterGrouping(i)));o.sort(null,null,!1,!0)}o.onAfterGrouping(i)}onAfterGrouping(e){if(e)return;const t=this,r=t.groupers||[];t.trigger("group",{isGrouped:t.isGrouped,groupers:r,records:t.storage.values}),t.trigger("refresh",{action:"group",isGrouped:t.isGrouped,groupers:r,records:t.storage.values})}addGrouper(e,t=!0){return this.group(e,t,!0)}removeGrouper(e){const t=this,{groupers:r}=t;if(!r)return;const n=r.findIndex((t=>t.field===e));return n>-1?(r.splice(n,1),r.length?t.group():t.clearGroupers()):void 0}clearGroupers(e=!1){return this.setGroupers(null,{silent:e})}isRecordInGroup(e,t){var r;if(!this.isGrouped)return null;return e[null==(r=this.groupers[0])?void 0:r.field]===t&&!e.isSpecialRow}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return null==t?void 0:t.meta.collapsed}getGroupRecords(e){return this.isGrouped?this.storage.values.filter((t=>this.isRecordInGroup(t,e))):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0].field):null}onDataChanged({changes:e,action:t}){this.isGrouped&&(!e&&resortActions[t]||e&&this.groupers.some((t=>t.field in e)))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const r=this,n=r.indexOf(e),i=r.allIndexOf(e),{id:s,storage:a}=r,{_filteredValues:o,_values:l}=a,{meta:c,groupChildren:d,unfilteredGroupChildren:u}=e;-1===i||c.collapsed&&!t||!c.collapsed&&t||(u.forEach((e=>e.instanceMeta(s).hiddenByCollapse=!t)),t?(o&&o.splice(n+1,0,...d.filter((e=>!r.isAvailable(e)))),a._values.splice(i+1,0,...u.filter((e=>!r.isAvailable(e))))):(o&&o.splice(n+1,d.length),l.splice(i+1,u.length)),a._indicesInvalid=!0,r._idMap=null)}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(e,t=!0){return(e?this.storage.allValues:this.storage.values).reduce(((e,r)=>(r.isSpecialRow&&(t&&!r.isGroupFooter&&e.push(r),r.isGroupHeader&&e.push.apply(e,r.groupChildren)),e)),[])}},StoreProxy_default=e=>class extends(e||Base){static get configurable(){return{objectify:null}}initProxy(){if(!globalThis.Proxy)throw new Error("Proxy not supported");return new Proxy(this,{get(e,t){if(t in e)return e[t];if("$store"===t)return e;let r=e.getById(t);return r||isNaN(parseInt(t))||(r=e.getAt(parseInt(t))),r},set:(e,t,r)=>(t in e||e.isDestroying?e[t]=r:e.add({[e.modelClass.idField]:t,...r}),!0),deleteProperty:(e,t)=>e.isDestroying?(delete e[t],!0):Boolean(e.remove(t).length),has(e,t){if(t in e)return!0;if(t.startsWith("{")&&t.endsWith("}")){const e=StringHelper.safeJsonParse(t);t=null==e?void 0:e.id}return e.includes(t)}})}},StoreRelation_default=e=>{var t;return __publicField(t=class extends(e||Base){initRelations(e){const t=this,r=t.modelClass.exposedRelations;e&&t.modelRelations&&t.modelRelations.forEach((e=>{var t;return null==(t=e.storeDetacher)?void 0:t.call(e)})),t.modelRelations&&0!==t.modelRelations.length&&!e||!r||(t.modelRelations=[],null==r||r.forEach((r=>{const n={...r},{foreignStore:i,relationName:s,relatedCollectionName:a}=n,o="string"==typeof i?t[i]:i;if(n.dependentStore=t,t.modelRelations.push(n),o){n.foreignStoreProperty=n.foreignStore,n.foreignStore=o;const r=o.dependentStoreConfigs;if(r.has(t)){const i=r.get(t);if(e){const e=i.find((e=>e.relationName===s));e&&ArrayHelper.remove(i,e)}i.push(n)}else r.set(t,[n]);a&&o.initRelationCollection(n,t),o.count>0&&o.updateDependentStores("dataset",o.records)}})))}initRelationCollection(e,t){const r=this,n=e.relatedCollectionName;(r.collectionStores||(r.collectionStores={}))[n]={store:t,config:e},r[n+"Store"]||(r[n+"Store"]=t),r.count>0&&r.initModelRelationCollection(n,r.records)}initModelRelationCollection(e,t){const r=this;t.forEach((t=>{t.traverse((t=>{const n=e in t?"$related"+StringHelper.capitalize(e):e;Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return r.getCollection(this,e)},set:function(t){return r.setCollection(this,e,t)}})}))}))}resetRelationCache(){this.relationCache={},this.forEach((e=>e.initRelations()))}updateRecordRelationCache(e,t){null==t||t.forEach((t=>{const{config:r}=t,n=t.related?t.related.id:e.get(r.foreignKey);void 0!==n&&this.cacheRelatedRecord(e,n,r.relationName,n)}))}getRelationCollection(e,t){const r=Model.asId(t);return this.relationCache[e]&&this.relationCache[e][r]||[]}getCollection(e,t){const{config:r,store:n}=this.collectionStores[t];return n.relationCache[r.relationName]&&n.relationCache[r.relationName][e.id]||[]}setCollection(e,t,r){const{config:n,store:i}=this.collectionStores[t],s=((i.relationCache[n.relationName]||(i.relationCache[n.relationName]={}))[e.id]||[]).slice(),a=[],o=[];i.suspendEvents(),s.forEach((e=>{r.includes(e)||(e[n.foreignKey]=null,i.remove(e),o.push(e))})),r.forEach((t=>{t.isModel instanceof Model?t.stores.includes(i)||(i.add(t),a.push(t)):([t]=i.add(t),a.push(t)),t[n.foreignKey]=e.id})),i.resumeEvents(),o.length&&(i.trigger("remove",{records:o}),i.trigger("change",{action:"remove",records:o})),a.length&&(i.trigger("add",{records:a}),i.trigger("change",{action:"add",records:a}))}cacheRelatedRecord(e,t,r,n=null){const i=this,s=i.relationCache[r]||(i.relationCache[r]={});null!==n&&i.uncacheRelatedRecord(e,r,n),null!=t&&ArrayHelper.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,r=null){const n=this;function i(t,r){const i=n.relationCache[t],s=null==i?void 0:i[r];if(s){const t=s.indexOf(e);t>=0&&s.splice(t,1),0===s.length&&delete i[r]}}null!=r?i(t,r):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach((([e,t])=>i(e,null==t?void 0:t.id)))}updateDependentStores(e,t){this.dependentStoreConfigs.forEach((r=>{r.forEach((r=>{const{dependentStore:n,relatedCollectionName:i,relationName:s,foreignKey:a}=r,o=n.relationCache[s];return"dataset"===e?(i&&this.initModelRelationCollection(i,t),void n.forEach((e=>{const t=e.initRelation(r);t&&n.cacheRelatedRecord(e,t.id,s,t.id)}))):"removeall"===e?(n.forEach((e=>e.removeRelation(r))),void delete n.relationCache[s]):("add"===e&&i&&this.initModelRelationCollection(i,t),void("add"!==e&&"remove"!==e||t.forEach((t=>{const i=null==o?void 0:o[t.id];switch(e){case"remove":i&&i.forEach((e=>e.removeRelation(r)));break;case"add":n.forEach((e=>{e.get(a)==t.id&&(e.initRelation(r),n.cacheRelatedRecord(e,t.id,s))}))}}))))}))}))}updateDependentRecordIds(e,t){var r;null==(r=this.dependentStoreConfigs)||r.forEach((r=>{r.forEach((r=>{var n;const{dependentStore:i,relationName:s,foreignKey:a}=r,o=i.relationCache[s],l=null==(n=null==o?void 0:o[e])?void 0:n.slice();null==l||l.forEach((r=>{i.cacheRelatedRecord(r,t,s,e),r.set(a,t,!1,!0)}))}))}))}},"$name","StoreRelation"),t},StoreSum_default=e=>class extends(e||Base){static get $name(){return"StoreSum"}sum(e,t=this.storage.values){return t?t.reduce(((t,r)=>{if(r.isSpecialRow)return t;const n=Number(r[e]);return isNaN(n)?t:t+n}),0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce(((t,r)=>{var n;return"number"===typeof(null==(n=r[e])?void 0:n.valueOf())&&r[e]<t&&(t=r[e]),t}),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce(((t,r)=>{var n;return"number"===typeof(null==(n=r[e])?void 0:n.valueOf())&&r[e]>t&&(t=r[e]),t}),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let r=0;const n=t.reduce(((t,n)=>{if(n.isSpecialRow)return t;const i=parseFloat(n[e]);return isNaN(i)?t:(r++,t+i)}),0);return r>0?n/r:0}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}},findInString=(e,t)=>String(e).toLowerCase().includes(t),matchFns={string:findInString,number:findInString,boolean:findInString,date:(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:String(e.getMonth()+1).includes(t)||String(e.getDate()).includes(t)||String(e.getFullYear()).includes(t),object:(e,t)=>e===t,undefined:(e,t)=>e===t},StoreSearch_default=e=>class extends(e||Base){static get $name(){return"StoreSearch"}search(e,t=null,r,n){const i=this.isTree&&!n?this.rootNode.allChildren:this.getAllDataRecords(n),s=i.length,a=[];if(null==e)return[];let o,l,c,d,u,h;for("string"==typeof e&&(e=e.toLowerCase()),o=0;o<s;o++){c=i[o],l=0;for(const n of t||c.fieldNames){d=c[n],u=d instanceof Date?"date":typeof d;const t=null==r?void 0:r[l];t&&(d=t(d),u="string"),h=matchFns[u],d&&(null==h?void 0:h(d,e))&&a.push({index:o,data:c,field:n,id:c.id}),l++}}return a}findByField(e,t,r=!1,n=!1){const i=this.getAllDataRecords(n),s=i.length,a=new Set,o=[];let l,c,d;for(null!=t&&(t=String(t).toLowerCase()),l=0;l<s;l++)if(c=i[l],d=c[e],!r||!a.has(d)){const e=d instanceof Date?"date":typeof d,n=matchFns[e];(null==t&&d===t||t&&n(d,t))&&(o.push({id:c.id,index:l,data:c}),r&&a.add(d))}return o}find(e,t=!1){return this.getAllDataRecords(t).find(e)}findRecord(e,t,r=!1){const n=r=>ObjectHelper.isEqual(r[e],t);return this.isTree?this.query(n,r)[0]:this.getAllDataRecords(r).find(n)}query(e,t=!1){if(this.isTree){const r=[];return this.traverse((t=>{e(t)&&r.push(t)}),void 0,void 0,t),r}return this.getAllDataRecords(t).filter(e)}some(e,t=!1){return this.getAllDataRecords(t).some(e)}},nestedRe=/\./,StoreSort_default=e=>class extends(e||Base){static get $name(){return"StoreSort"}static get defaultConfig(){return{useLocaleSort:null}}static get configurable(){return{sorters:[],reapplySortersOnAdd:!1}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}changeSorters(e){return e.map((e=>this.normalizeSorterConfig(e,!0)))}updateReapplySortersOnAdd(e){this.storage.autoSort=e}sort(e,t,r=!1,n=!1){const i=this,s=i.allRecords,a=i.sorters?i.sorters.slice():[];let o,l=null;if(e)if(Array.isArray(e))i.sorters=e.map((e=>i.normalizeSorterConfig(e,"string"==typeof e||t)));else{const n=i.normalizeSorterConfig(e,t);r?(o=i.getCurrentSorterByField(n.field),o?(l=o.ascending,o.ascending=n.ascending):i.sorters.push(n)):i.sorters=[n]}return n||!1!==i.trigger("beforeSort",{sorters:i.sorters,records:s,currentSorters:a})?i.performSort(n):(i.sorters=a,null!==l&&(o.ascending=l),null)}normalizeSorterConfig(e,t){var r,n,i;const s=this,a={ascending:t};if("object"==typeof e?(ObjectHelper.assign(a,e),e.fn&&(delete a.fn,a.sortFn=e.fn),a.ascending=null!=(r=e.ascending)?r:t):"function"==typeof e?a.sortFn=e:a.field=e,null==a.ascending){const e=s.getCurrentSorterByField(a.field);a.ascending=!e||!e.ascending}if(null==a.sortFn){const e=null==(i=null==(n=s.modelClass)?void 0:n.$meta.fields.map[a.field])?void 0:i.compareItems;e&&(a.sortFn=e)}return a}getCurrentSorterByField(e){return"string"==typeof e&&this.sorters.find((t=>t.field===e))||null}addSorter(e,t=!0){return this.sort(e,t,!0)}removeSorter(e){const t=this.sorters.findIndex((t=>t.field===e||t.sortFn===e));if(t>-1)return this.sorters.splice(t,1),this.sort()}clearSorters(e=!1){if(this.sorters.length)return this.sorters.length=0,this.sort(void 0,void 0,void 0,e)}createSorterFn(e){const t=this.useLocaleSort;return(r,n)=>{for(let i=0;i<e.length;i++){const s=e[i],{field:a,ascending:o=!0,useLocaleSort:l=t}=s,c=s.fn||s.sortFn,d=o?1:-1;if(c){const e=c.call(s,r,n);if(0===e)continue;if(null!==e)return e*d}const u=nestedRe.test(a),h=u?r.get(a):r[a],g=u?n.get(a):n[a];if(h!==g){if(null==h)return-d;if(null==g)return d;if(l&&"string"==typeof h){if(!0===l)return String(h).localeCompare(g)*d;if("string"==typeof l)return String(h).localeCompare(g,l)*d;if("object"==typeof l)return String(h).localeCompare(g,l.locale,l)*d}if(h>g)return d;if(h<g)return-d}}return 0}}get sorterFn(){const e=this,{sorters:t}=e;return e.createSorterFn(e.remoteSort?[{field:"_remoteSortIndex"}]:e.isGrouped?e.groupers.concat(t):t)}performSort(e){const t=this,{rootNode:r,storage:n,sorterFn:i}=t;t.tree?(!t.isChained&&r.traverse((e=>{e.isLoaded&&e.isParent&&(e.children.sort(i),e.updateChildrenIndices(e.children,"parentIndex",!0))})),n.replaceValues({values:t.collectDescendants(r).visible,silent:!0})):t.isGrouped?n.replaceValues({...t.prepareGroupRecords(i),silent:!0}):n.replaceValues({values:n.values.sort(i),silent:!0}),t.afterPerformSort(e||t.isRemoteDataLoading)}afterPerformSort(e){if(e)return;const t=this;t._idMap=null;const r={action:"sort",sorters:t.sorters,records:t.allRecords};t.trigger("sort",r),t.trigger("refresh",r)}},returnTrue=()=>!0,StoreChained_default=e=>class extends(e||Base){static get $name(){return"StoreChained"}static get defaultConfig(){return{chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert"],dontRelayToMaster:[],excludeCollapsedRecords:!0}}static get properties(){return{chainedStores:null}}construct(e){super.construct(e);const t=this,{masterStore:r}=t,n=t.syncOrder?"sort":"";r&&(t.methodNamesToRelay.forEach((e=>t[e]=(...r)=>t.relayToMaster(e,r))),t.removeAll=(...e)=>{r.remove(t.getRange(),...e)},r.ion({changePreCommit:t.onMasterDataChangedPreCommit,change:t.onMasterDataChanged,[n]:t.onMasterDataChanged,prio:1,thisObj:t}),r.chainedStores||(r.chainedStores=[]),r.chainedStores.push(t),t.fillFromMaster())}get $master(){return this.masterStore||this}get isChained(){return Boolean(this.masterStore)}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn||returnTrue}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter((e=>!t||!this.dontRelayToMaster.includes(e)))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach((e=>e.fillFromMaster()))}fillFromMaster(){const e=this,{masterStore:t,isTree:r}=e;let n=[];if(!e.isChained)throw new Error("fillFromMaster only allowed on chained store");if(t.isGrouped&&t.isFiltered?t.forEach((e=>n.push(e)),t,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}):n=t.allRecords.filter((t=>!t.isSpecialRow&&e.chainedFilterFn(t))),r&&(e.idRegister={},e.internalIdRegister={},n.forEach((t=>{t.stores.includes(e)?e.register(t):t.joinStore(e)})),e.excludeCollapsedRecords)){const t=e.getChildren(e.rootNode);n=e.doIncludeExclude(t,!0)}e.isFillingFromMaster=!0,e.data=n,e.isFillingFromMaster=!1}commitToMaster(){const e=this,t=e.masterStore;if(!e.isChained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){return this.masterStore[e](...t)}onMasterDataChangedPreCommit(e){this.onMasterDataChanged(e),this.$masterEventhandled=!0}onMasterDataChanged({action:e,changes:t,$handled:r,isMove:n}){var i;this.$masterEventhandled?this.$masterEventhandled=!1:n&&"remove"===e||("update"!==e||(null==(i=this.chainedFields)?void 0:i.some((e=>e in t))))&&this.fillFromMaster()}makeChained(e=returnTrue,t,r){return new((null==r?void 0:r.storeClass)||this.constructor)({...r||{},tree:!1,autoTree:!1,masterStore:this.$master,modelClass:this.modelClass,syncDataOnLoad:!1,chainedFilterFn:e,chainedFields:t})}chain(){return this.makeChained(...arguments)}doDestroy(){var e;null==(e=this.chainedStores)||e.forEach((e=>e.destroy())),super.doDestroy()}},StoreState_default=e=>class extends(e||Base){static get $name(){return"StoreState"}getState(){const{sorters:e,groupers:t,filters:r}=this,n={};return(null==e?void 0:e.length)&&(n.sorters=e.map((e=>{const t=ObjectHelper.cleanupProperties(ObjectHelper.clone(e));return delete t.fn,delete t.sortFn,t}))),(null==t?void 0:t.length)&&(n.groupers=t.map((e=>{const t=ObjectHelper.cleanupProperties(ObjectHelper.clone(e));return delete t.fn,t}))),(null==r?void 0:r.values.length)&&(n.filters=r.values.map((e=>{const t=ObjectHelper.cleanupProperties(ObjectHelper.clone(e.config));return t.value=e.value,t.caseSensitive&&delete t.caseSensitive,t}))),n}applyState(e){const t=this,{sorters:r=[],groupers:n=[],filters:i=[]}=e,{sortParamName:s,filterParamName:a}=t;t.sorters=r.filter((e=>e.field||e.sortFn&&!s)),t.groupers=n.slice(),t.sort(),t.filters=i.filter((e=>e.property||e.filterBy&&!a)),t.filter()}},zeroPad=e=>String(e).padStart(6,"0"),Wbs=class{constructor(e){this.value=e,this._padded=null}set value(e){this._value=String(null!=e?e:"")}get value(){return this._value}static from(e){return null==e||e instanceof Wbs?e:new Wbs(e)}static pad(e){return e instanceof Wbs?e.valueOf():Wbs.split(e).map(zeroPad).join(".")}static split(e){let t,r;if(e||0===e)switch(typeof e){case"object":e=String(e);case"string":for(r=e.split("."),t=r.length;t-- >0;)r[t]=parseInt(r[t],10);break;case"number":r=[e]}return r||[]}static compare(e,t){return e===t?0:e&&t?(e=Wbs.pad(e))<(t=Wbs.pad(t))?-1:t<e?1:0:e?1:t?-1:0}append(e){const t=this.value;return Wbs.from(t?t+"."+e:e)}isEqual(e){return!Wbs.compare(this,e)}match(e){let t=!1;if(e){const r=this.value,n="*"===e[0],i=e.endsWith("*"),s=e.length;t=n===i?r.indexOf(n?e.substr(1,s-2):e)>-1:n?r.endsWith(e.substr(1)):r.startsWith(e.substr(0,s-1))}return t}toString(){return this.value}toJSON(){return this.toString()}valueOf(){var e;return null!=(e=this._padded)?e:this._padded=Wbs.pad(this.value)}};Wbs._$name="Wbs";var emptyArray3=Object.freeze([]),StoreTree_default=e=>{var t;return __publicField(t=class extends(e||Base){get isTree(){return this.tree||this.masterStore&&this.masterStore.tree}get leaves(){const e=this,t=[];return e.isTree?(e.traverse((e=>{e.isLeaf&&t.push(e)})),t):(e.allRecords.forEach((e=>{e.isLeaf&&t.push(e),e.traverse((e=>{e.isLeaf&&t.push(e)}),!0)})),t)}async loadChildren(e){}onNodeAddChild(e,t,r,n,i=!1){var s;const a=this,o=e===a.rootNode&&e.isLoading,{storage:l}=a,c=[],d=[],{previousSibling:u}=t[0];let h;if(a.collectDescendants(t,c,d,{inCollapsedBranch:!(e.isExpanded(a)&&e.ancestorsExpanded(a))}),!o&&d.length)for(const e of d)a.modified.includes(e)||n[e.id]||(a.removed.includes(e)?a.removed.remove(e):e.isLinked||a.added.add(e));if(o&&a.rootVisible&&(c.unshift(e),d.unshift(e)),c.length?(h=0!==r&&u?l.indexOf(u)+u.getDescendantCount(!0,a):l.indexOf(e),l.suspendEvents(),a.storage.splice(++h,0,c),l.resumeEvents(),a._idMap=null):a._allRecords=null,a.updateDependentStores("add",t),o&&c.length){if(a.sorters.length&&a.sort(null,null,!1,!0),null==(s=a.afterLoadData)||s.call(a),!i){const e={action:"dataset",data:a._data,records:c};a.trigger("refresh",e),a.trigger("change",e)}}else if(!i){const r={action:"add",parent:e,isChild:!0,isMove:n,records:t,allRecords:d,index:h};if(a.trigger("add",r),a.trigger("change",r),Object.values(n).some((e=>e))){const r={newParent:e,records:t.filter((e=>n[e.id])),oldParents:t.map((e=>a.getById(e.meta.oldParentId)))};a.trigger("move",r)}}}onNodeRemoveChild(e,t,r,n={isMove:!1,silent:!1,unfiltered:!1}){const i=this,{storage:s}=i,a=[],o=[],{isMove:l,silent:c,unfiltered:d}=n,u=d&&i.isFiltered,h=u&&e.unfilteredChildren?e.unfilteredChildren:t;if(i.collectDescendants(h,a,o,{inCollapsedBranch:!(e.isExpanded(i)&&e.ancestorsExpanded(i)),unfiltered:u}),!l){for(const e of t)e.unjoinStore(i);for(const e of o)e.stores.includes(i)&&e.unjoinStore(i),i.added.includes(e)?i.added.remove(e):e.isLinked||i.removed.add(e);i.modified.remove(o)}if(a.length?(r=s.indexOf(a[0]))>-1&&(s.suspendEvents(),s.splice(r,a.length),s.resumeEvents(),i._idMap=null):(r=-1,i._allRecords=null),!c&&(i.fireRemoveEventForMoveAction||!l)){const n={action:"remove",parent:e,isChild:!0,isMove:l,records:t,allRecords:o,index:r};i.trigger("remove",n),i.trigger("change",n)}return o}collectDescendants(e,t=[],r=[],n){const i=this,{inCollapsedBranch:s=!1,unfiltered:a=!1}=n||0,o=Array.isArray(e)?e:i.getChildren(e,a);if(o)for(let e,n=0,l=o.length;n<l;n++)e=o[n],s||t.push(e),r.push(e),i.collectDescendants(e,t,r,{inCollapsedBranch:s||!e.isExpanded(i),unfiltered:a});return{visible:t,all:r}}getChildren(e,t=!1){const r=this,n=(t||r.isChained)&&e.unfilteredChildren||e.children;return(null==n?void 0:n.length)?r.isChained?n.filter(r.chainedFilterFn).sort(r.sorterFn):n:emptyArray3}internalToggleTreeSubRecords(e,t){const r=this,{storage:n}=r,i=n.indexOf(e),s=r.doIncludeExclude(r.getChildren(e),t);if(r.isFiltered&&t&&e.unfilteredChildren&&r.updateChildrenHiddenState(e),s.length&&!1!==i){if(n.suspendEvents(),t){n.splice(i+1,0,...s);const e={action:"add",isExpand:!0,records:s,index:i+1};r.trigger("add",e),r.trigger("change",e)}else{n.splice(i+1,s.length);const e={action:"remove",isCollapse:!0,records:s,index:i+1};r.trigger("remove",e),r.trigger("change",e)}n.resumeEvents(),r._idMap=null}}updateChildrenHiddenState(e){var t;null==(t=e.unfilteredChildren)||t.forEach((e=>{e.instanceMeta(this.id).hidden=!1,e.isLeaf||this.updateChildrenHiddenState(e)}))}doIncludeExclude(e,t,r=[]){const n=this,i=(null==e?void 0:e.length)||0;for(let s=0;s<i;s++){const i=e[s];if(!n.isChained||n.chainedFilterFn(i)){const e=i.instanceMeta(n.id);!t&&e.hidden||r.push(i),e.hidden=!t,i.isExpanded(n)&&n.doIncludeExclude(n.getChildren(i),t,r)}}return r}async toggleCollapse(e,t){const r=this,n=r.getById(e),i=n.instanceMeta(r);if(void 0===t&&(t=!i.collapsed),!i.isLoadingChildren&&!n.isLeaf&&n.isExpanded(r)===t){if(r.trigger("beforeToggleNode",{record:n,collapse:t}),i.collapsed=t,i.collapsed)return r.onNodeCollapse(n),!0;{r.onNodeExpand(n);let e=!0;if(!n.isLoaded){i.isLoadingChildren=!0;try{await r.loadChildren(n)}catch(t){i.collapsed=!0,e=!1,r.trigger("loadChildrenException",{record:n,exception:t})}finally{i.isLoadingChildren=!1}}return e}}}onNodeCollapse(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){if(e.ancestorsExpanded(this))return this.internalToggleTreeSubRecords(e,!0)}transformToTree(e){var t;const{parentIdField:r,idField:n,childrenField:i}=this.modelClass,s=new Map,a=[];for(const o of e){const l=o[r];if(null!=l){let r=s.get(l);void 0===r&&(r=null!=(t=e.find((e=>e[n]===l)))?t:null,s.set(l,r)),r&&(r[i]||(r[i]=[]),r[i].push(o))}else a.push(o)}return a}treeify(e,t,r=!1){const{length:n}=e,i=[],s={};let a,o;for(a=0;a<n;a++){if(!e[a].call){const t=e[a];e[a]=e=>e[t]}i[a]=new Map}this.rootNode.traverse((t=>{if(o=null,t.isLeaf){for(a=0;a<n;a++){const r=(null==o?void 0:o.path)||"",n=i[a],s=e[a](t),l=r+s+"/",c=StringHelper.makeValidDomId("generated_"+l,"_"),d=n.get(c)||n.set(c,{id:c,key:s,path:l,expanded:!0,readOnly:!0,children:[],generatedParent:!0}).get(c);o&&!o.children.includes(d)&&o.children.push(d),o=d}o.children.push(t)}}),!0),i.forEach((e=>e.forEach(((e,n,i)=>{null==t||t(e),r&&(e=this.createRecord(e),i.set(n,e))})))),s.children=[...i[0].values()];const l=t=>{t.children&&(t.children.sort(((t,r)=>{if(t.isLeaf){let i;for(let s=0;!i&&s<n;s++){const n=e[s](t),a=e[s](r);i=n<a?-1:a>n?1:0}return i}return"string"==typeof t.key||"string"==typeof r.key?t.key.localeCompare(r.key,void 0,{numeric:!0}):t.key<r.key?-1:t.key>r.key?1:0})),t.children.forEach(l))};return l(s),s}treeifyFlatData(e){const{childrenField:t,parentIdField:r}=this.modelClass;let n=!1,i=!0;for(const s of e){if(s.isModel||Array.isArray(s[t])){i=!1;break}null!=s[r]&&(n=!0)}return i&&n&&(e=this.transformToTree(e)),e}async indent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{let r=Boolean(t.previousSibling);for(;r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r}))).length&&!1!==t.trigger("beforeIndent",{records:e})){e.sort(((e,t)=>Wbs.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const r of e){const e=r.previousSibling;e.appendChild(r),t.toggleCollapse(e,!1)}t.endBatch(),t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e})}}async outdent(e){const t=this;if((e=(e=Array.isArray(e)?e:[e]).filter((t=>{const{parent:r}=t;let n=r&&!r.isRoot;for(;n&&!t.isRoot;)n=!e.includes(r),t=t.parent;return n}))).length&&!1!==t.trigger("beforeOutdent",{records:e})){e.sort(((e,t)=>Wbs.compare(e.wbsCode,t.wbsCode))),t.beginBatch();for(const r of e){const{parent:e}=r,n=e.children.slice(e.children.indexOf(r)+1);e.parent.insertChild(r,e.nextSibling),r.appendChild(n),t.toggleCollapse(r,!1)}t.endBatch(),t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e})}}},"$name","StoreTree"),__publicField(t,"configurable",{transformFlatData:null,fireRemoveEventForMoveAction:VersionHelper.checkVersion("core","6.0","<")}),t},WalkHelper=class{static preWalk(e,t,r){const n=[e];let i,s;for(;n.length;)i=n.pop(),r(i),s=t(i),s&&n.push.apply(n,s.slice().reverse())}static preWalkWithParent(e,t,r){const n=[{node:e,parent:null}];for(;n.length;){const{parent:e,node:i}=n.pop();r(e,i);const s=t(i);Array.isArray(s)&&n.push(...s.slice().reverse().map((e=>({node:e,parent:i}))))}}static preWalkUnordered(e,t,r){const n=[e];let i,s;for(;n.length;)i=n[n.length-1],r(i),s=t(i),s?n.splice(n.length-1,1,...s):n.length=n.length-1}static postWalk(e,t,r){const n=new Map,i=[e];let s,a;for(;i.length;)s=i[i.length-1],n.has(s)?(r(s),i.pop()):(a=t(s),a&&i.push(...a.slice().reverse()),n.set(s,s))}static prePostWalk(e,t,r,n){const i=new Map,s=[e];let a,o;for(;s.length;)a=s[s.length-1],i.has(a)?(n(a),s.pop()):(r(a),o=t(a),o&&s.push(...o.slice().reverse()),i.set(a,a))}};WalkHelper._$name="WalkHelper";var StoreSync_default=e=>class extends(e||Base){static get $name(){return"StoreSync"}static get configurable(){return{syncDataOnLoad:null}}syncDataset(e){const t=this,{storage:r}=t;t.isSyncingDataOnLoad=!0;const{toAdd:n,toRemove:i,toMove:s,updated:a,ids:o}=t.tree?t.syncTreeDataset(e):t.syncFlatDataset(e);let{threshold:l}=t.syncDataOnLoad,c=!1;if(l&&("string"==typeof l&&(l=parseInt(l,10)/100*t.count),c=n.length+i.length+s.length+a.length>l),t.tree){if(n.length){t.add(n,c).forEach((e=>e.clearParentId()))}if(s.length)for(const{parent:e,node:r,index:n}of s){t.getById(e.id).insertChild(r,n)}t.remove(i,c)}else c&&t.suspendEvents(),t.remove(i),t.add(n),c&&t.resumeEvents();l&&!c&&a.forEach((({record:e,toSet:r,wasSet:n})=>t.onModelChange(e,r,n))),t.acceptChanges();const d={added:n,removed:i,updated:a,thresholdSurpassed:c};if(t.isFiltered&&!t.remoteFilter&&t.filter({silent:t.isRemoteDataLoading}),t.isGrouped)t.group(null,null,!1,!0,t.isRemoteDataLoading);else if(t.isSorted)t.remoteSort?r.replaceValues({values:r.values.sort(t.createSorterFn(t.sorters)),silent:!0}):t.sort();else if(t.tree){let e=!1,r=0;WalkHelper.preWalk(t.rootNode,(t=>Array.isArray(t.children)&&!e?t.children:null),(t=>{t.id!==o[r++]&&(e=!0)})),e&&(t.sort(((e,t)=>o.indexOf(e.id)-o.indexOf(t.id)),void 0,void 0,!0),t.clearSorters(!0),!c&&t.afterPerformSort())}else r.values.some(((e,t)=>e.id!==o[t]))&&(r.replaceValues({values:r.values.sort(((e,t)=>o.indexOf(e.id)-o.indexOf(t.id))),silent:!0}),!c&&t.afterPerformSort());c&&t.trigger("refresh",{action:"batch",data:e,records:r.values,syncInfo:d}),t.isSyncingDataOnLoad=!1,t.trigger("loadSync",d)}syncFlatDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:r,allFields:n}=t.modelClass,i=[],s=[],a=[],o={},l=[],{threshold:c,keepMissingValues:d}=t.syncDataOnLoad;let u=0;return e.forEach((e=>{const i=(e=e.isModel?e.data:e)[r],h=t.getById(i);if(h){if(!1===d)for(const t of n)!(t.dataSource in e)&&t.dataSource in h.data&&(e[t.dataSource]=t.defaultValue);const t=h.set(e,null,Boolean(c));t&&a.push({record:h,wasSet:t,toSet:e}),u++}else s.push(t.processRecord(t.createRecord(e)));o[i]=1,l.push(i)})),u<t.storage.totalCount&&t.forEach((e=>{o[e.id]||i.push(e)})),{toAdd:s,toRemove:i,toMove:[],updated:a,ids:l}}syncTreeDataset(e){if(!e)return{toRemove:this.records};const t=this,{idField:r,parentIdField:n,childrenField:i,allFields:s}=t.modelClass,{keepMissingValues:a,threshold:o}=t.syncDataOnLoad,l=[],c=[],d=[],u=[],h=new Set,g=[];return t.transformFlatData&&(e=t.treeifyFlatData(e)),WalkHelper.preWalkWithParent({isRoot:!0,id:t.rootNode.id,children:e},(e=>e.children),((e,l)=>{if(e){const{id:p,node:m}=t.resolveSyncNode(l);if(m){let n;const c=m.children;if(!0!==c&&!0===l[i]&&(m.clearChildren(),m.data[i]=m.children=!0,delete l[i],t.toggleCollapse(m,!0),n=!0),m.parent.id!==e[r]&&d.push({node:m,parent:e,index:e[i].indexOf(l)}),!1===a)for(const e of s)"parentId"!==e.name&&!(e.dataSource in l)&&e.dataSource in m.data&&(l[e.dataSource]=e.defaultValue);const h=m.set(l,null,Boolean(o));h?u.push({record:m,wasSet:h,toSet:l}):n&&m.signalNodeChanged({[i]:{value:!0,oldValue:c}})}else l[n]=e[r],c.push({...l,...Array.isArray(l[i])?{children:[]}:void 0});h.add(m),g.push(p)}})),t.traverse((e=>{h.has(e)||l.push(e)})),{toAdd:c,toRemove:l,toMove:d,updated:u,ids:g}}resolveSyncNode(e){const t=e[this.modelClass.idField];return{id:t,node:this.getById(t)}}},STM_PROP2=Symbol("STM_PROP"),StoreStm_default=e=>class extends(e||Base){static get $name(){return"StoreStm"}static get defaultConfig(){return{stm:null,ignoreRemoteChangesInSTM:!1}}get stm(){return this[STM_PROP2]}set stm(e){var t;const r=this;r.stm!==e&&((null==(t=r.stm)?void 0:t.hasStore(r))&&r.stm.removeStore(r),r[STM_PROP2]=e,r.stm&&!r.stm.hasStore(r)&&r.stm.addStore(r))}add(e,t=!1,r={}){let n;const{stm:i}=this;return!this.tree&&(null==i?void 0:i.enabled)?(n=super.add(e,t),(null==n?void 0:n.length)&&i.onStoreModelAdd(this,n,t)):n=super.add(e,t,r),n}insert(e,t,r=!1){let n;const{stm:i}=this;if(!this.tree&&(null==i?void 0:i.enabled)){const s=(Array.isArray(t)?t:[t]).reduce(((e,t)=>{const r=t instanceof Model?this.indexOf(t):void 0;return void 0!==r&&-1!==r&&e.set(t,r),e}),new Map);n=super.insert(e,t),(null==n?void 0:n.length)&&(e=this.indexOf(n[0]),i.onStoreModelInsert(this,e,n,s,r))}else n=super.insert(e,t,r);return n}remove(e,t=!1,r){let n;const{stm:i}=this;if(!this.tree&&(null==i?void 0:i.enabled)){const s=(Array.isArray(e)?e:[e]).map((e=>this.getById(e))).filter((e=>!!e)).reduce(((e,t)=>{const r=this.indexOf(t);return void 0!==r&&-1!==r&&e.set(t,r),e}),new Map);n=super.remove(e,t,r),(null==n?void 0:n.length)&&i.onStoreModelRemove(this,n,s,t)}else n=super.remove(e,t,r);return n}removeAll(e){const{stm:t}=this;let r;if(null==t?void 0:t.enabled){const{tree:n,rootNode:i,allRecords:s}=this,a=s.length,o=n?i.children.slice():s.slice();r=super.removeAll(e),a&&0===this.count&&t.onStoreRemoveAll(this,o,e)}else r=super.removeAll(e);return r}beforeApplyChangeset(){const{stm:e,crudManager:t}=this;let r=!1;return!(null==t?void 0:t.applyingChangeset)&&(null==e?void 0:e.enabled)&&(r=!0,e.isRecording&&e.stash(),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),r}applyChangeset(e,t,r,n,i){const s=this.beforeApplyChangeset(),a=super.applyChangeset(e,t,r,n,i);return this.afterApplyChangeset(s),a}afterApplyChangeset(e){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash()}}},dataAddRemoveActions={splice:1,clear:1},defaultTraverseOptions2={includeFilteredOutRecords:!1,includeCollapsedGroupRecords:!1},fixTraverseOptions2=(e,t)=>("boolean"==typeof(t=t||!1)&&(t={includeFilteredOutRecords:t,includeCollapsedGroupRecords:!1}),t||defaultTraverseOptions2),Store=class extends(Base.mixin(Delayable_default,Identifiable_default,Events_default,Pluggable_default,State_default,StoreFilter_default,StoreChanges_default,StoreCRUD_default,StoreRelation_default,StoreSum_default,StoreSearch_default,StoreSort_default,StoreGroup_default,StoreChained_default,StoreState_default,StoreTree_default,StoreStm_default,StoreSync_default,StoreProxy_default)){static get $name(){return"Store"}static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get configurable(){return{id:!0,modelClass:Model,verifyNoGeneratedIds:!0}}static get defaultConfig(){return{fields:null,autoTree:!0,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:!1,allowNoId:!0,preventSubClassingModel:null}}static get identifiable(){return{registerGeneratedId:!1}}constructor(...e){if(super(...e),this.objectify)return this.initProxy()}construct(e={}){Object.assign(this,{added:new StoreBag,removed:new StoreBag,modified:new StoreBag,idRegister:{},internalIdRegister:{},oldIdMap:{}}),e.storeId&&(e=ObjectHelper.assign({id:e.storeId},e)),super.construct(e),this.initRelations()}static from(e,t={},r=null){return e&&!e.isStore&&("string"==typeof e?e=Store.getStore(e):(Array.isArray(e)&&(r&&(e=e.map((e=>e.isModel?e:r(e)))),e=ObjectHelper.assign({},t,{data:e})),e=new Store(e))),e}doDestroy(){var e,t,r,n;const i=this,s=i.registeredRecords;for(let e,t=s.length-1;t>=0;t--)e=s[t],(null==e?void 0:e.isDestroyed)||e.unjoinStore(i);null==(e=i._storage)||e.destroy(),null==(r=null==(t=i.stm)?void 0:t.removeStore)||r.call(t,i),i.isChained||null==(n=i.rootNode)||n.destroy(),super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;(null==e?void 0:e.isCollection)?t._storage=e:t._storage=new Collection(e),t._storage.autoFilter=t.reapplyFilterOnAdd,t._storage.autoSort=t.reapplySortersOnAdd;for(const e of t._storage)e.joinStore(t);t._storage.ion({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){var e;const t=this;if((null==(e=t._allRecords)?void 0:e.generation)!==t.storage.generation){if(t.isTree){const e=t.collectDescendants(t.rootNode,void 0,void 0,{unfiltered:!0}).all;t.rootVisible&&e.unshift(t.rootNode),t._allRecords=e}else t._allRecords=t.isGrouped?t.collectGroupRecords():t.storage.allValues;t._allRecords.generation=t.storage.generation}return t._allRecords}getAllDataRecords(e){return this.isGrouped?this.collectGroupRecords(e,!1):e?this.storage.allValues:this.storage.values}onIsCreatingToggle(e,t){const r=this,n=e.isPersistable&&!t;r.added[n?"add":"remove"](e),n&&(r.trigger("addConfirmed",{record:e}),r.autoCommit&&r.doAutoCommit())}joinRecordsToStore(e){const{allCount:t}=this;for(let r=0;r<e.length;r++){const n=e[r];n.setData("parentIndex",t+r-e.length),n.joinStore(this)}}onDataChange({source:e,action:t,added:r,removed:n,replaced:i,oldCount:s,items:a,from:o,to:l}){const c=this,d=dataAddRemoveActions[t],u=d&&(null==r?void 0:r.length),h=d&&(null==n?void 0:n.length);let g,p;if(c._idMap=null,u&&c.joinRecordsToStore(r),null==i||i.forEach((([e,t])=>{e.unjoinStore(c,!0),t.joinStore(c)})),super.onDataChange(...arguments),!c.isTree){if(u){for(const e of r)c.removed.includes(e)?c.removed.remove(e):e.isLinked||c.added.add(e);g=!c.remoteFilter&&c.filtered&&c.reapplyFilterOnAdd,g&&c.filter({silent:!0}),p=!c.remoteSort&&c.isSorted&&c.reapplySortersOnAdd,p&&c.sort(null,null,!1,!0)}if(h){for(const e of n)e.cancelBatch(),e.unjoinStore(c),c.added.includes(e)?c.added.remove(e):e._undoingInsertion||e.isCreating||e.isLinked||c.removed.add(e);c.modified.remove(n),g=!c.remoteFilter&&c.filtered,g&&c.filter({silent:!0})}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(u){c.updateDependentStores("add",r);const t=r.reduce(((e,t)=>{const{previousIndex:r}=t.meta;return r>-1&&r<e&&(e=r),e}),r[0].meta.previousIndex),n={records:r,index:e.indexOf(r[0],!e.autoFilter)};t>-1&&(n.oldIndex=t),c.trigger("add",n),c.trigger("change",Object.assign({action:"add"},n)),g&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:s,records:c.storage.allValues}),p&&c.trigger("sort",{action:"sort",sorters:c.sorters,records:c.storage.allValues})}n.length&&(c.updateDependentStores("remove",n),c.trigger("remove",{records:n}),c.trigger("change",{action:"remove",records:n})),i.length&&(c.trigger("replace",{records:i,all:c.records.length===i.length}),c.trigger("change",{action:"replace",replaced:i,all:c.records.length===i.length}));break;case"filter":(c.isGrouped||c.isSorted)&&c.performSort(!0);break;case"move":{const e=Math.min(o,l),r=Math.min(c.storage.allValues.length-1,Math.max(o,l));for(let t=c.storage.allValues,n=e;n<=r;n++)t[n].setData("parentIndex",n);c.trigger("move",{record:a[0],records:a,from:o,to:l}),c.isFiltered&&c.performFilter(),c.trigger("change",{action:t,record:a[0],records:a,from:o,to:l});break}}}onDataReplaced(e,t){var r;const n=this,{storage:i}=n,s=i.allValues,a=Boolean(n.sorters.length>0);for(let e=0;e<s.length;e++)s[e].joinStore(n);if(!n.remoteFilter&&n.isFiltered&&n.filter({silent:!0}),n.remoteSort?n.isGrouped&&i.replaceValues({...n.prepareGroupRecords(),silent:!0}):(n.isGrouped&&n.group(null,null,!1,!a,!0),a&&n.sort(null,null,!1,!0)),!n.useRawData.disableDuplicateIdCheck){const{idMap:e}=n;if(Object.keys(e).length<i.values.length){const t=[];throw i.values.forEach((r=>e[r.id]?delete e[r.id]:t.push(r))),new Error("Id collision on "+t.map((e=>e.id)))}}const o={action:e,data:t,records:i.values};n.updateDependentStores(e,o.records),null==(r=n.afterLoadData)||r.call(n),n.isRemoteDataLoading||n.trigger("refresh",o),n.trigger("change",o)}onModelChange(e,t,r,n,i){const s=this,a={record:e,records:[e],changes:r,batch:null!=e.batching,fromRelationUpdate:i},o=!e.ignoreBag&&!e.isLinked&&s.updateModifiedBagForRecord(e);if(s.storage.onItemMutation(e,r),"id"in r){const{oldValue:r,value:n}=t.id;s.updateDependentRecordIds(r,n),s.onRecordIdChange({record:e,oldValue:r,value:n})}if(!n){if("id"in r){const{oldValue:r,value:n}=t.id;s.trigger("idChange",{store:s,record:e,oldValue:r,value:n})}s.onUpdateRecord(e,r),s.trigger("update",a),s.trigger("change",Object.assign({action:"update"},a))}s.autoCommit&&o&&s.doAutoCommit()}updateModifiedBagForRecord(e){const t=this;let r=!1;return e.isModified?t.modified.includes(e)||t.added.includes(e)||!e.isPartOfStore(t)||e.isAutoRoot||(e.isPhantom?t.added.add(e):t.modified.add(e),r=!0):t.modified.remove(e),r}get idMap(){const e=this,t=!e._idMap,r=e._idMap||(e._idMap={});if(t){const t=e.storage.values;for(let e,n=0,i=0;n<t.length;n++)e=t[n],r[e.id]={index:n,visibleIndex:i,record:e},e.isSpecialRow||i++;if(e.isFiltered)for(let t=0,n=e.storage._values.length;t<n;t++){const n=e.storage._values[t];n.id in r?r[n.id].unfilteredIndex=t:r[n.id]={index:-1,unfilteredIndex:t,record:n}}}return r}changeModelClass(e){const{fields:t}=this;this.originalModelClass=e;let r=e;if(null==t?void 0:t.length){class n extends e{static get fields(){return t}}r=n}else if(!this.preventSubClassingModel){class t extends e{}r=t}return r.initClass(),r}set storeId(e){this.id=e}get storeId(){return this.id}changeId(e,t){return super.changeId(!0!==e&&e,t)}updateId(e,t){const r=Store.getById(e);r&&Store.unregisterInstance(r),super.updateId(e,t)}generateAutoId(){return Store.generateId("store-")}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode(),this.rootNode.isAutoRoot=!0)}buildRootNode(){return{}}static getStore(e,t){if(e instanceof Store)return e;if(this.getById(e))return this.getById(e);if(Array.isArray(e)){let r;const n=e.map((e=>(e instanceof Model?r=e.constructor:"string"==typeof e&&(e={text:e}),e)));if(!r){class e extends Model{}r=e}e={autoCreated:!0,data:n,modelClass:r,allowNoId:!0},t||(t=Store)}return t?new t(e):void 0}static get stores(){return Store.registeredInstances}get rootNode(){return this.masterStore?this.masterStore.rootNode:this._rootNode}set rootNode(e){var t;const r=this,n=r._rootNode;e!==n&&(n&&r.clear(!0),e instanceof Model?(e.instanceMeta(r).collapsed=!1,r._rootNode=e):r._rootNode=e=new r.modelClass(Object.assign({expanded:!0,[r.modelClass.idField]:r.id+"-rootNode"},e),r,null,!0),r._tree=!0,e.isRoot=!0,e.joinStore(r),((null==(t=e.children)?void 0:t.length)||r.rootVisible)&&(e.isLoading=!0,r.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),r.trigger("rootChange",{oldRoot:n,rootNode:e}))}set data(e){this.setStoreData(e)}setStoreData(e){const t=this,{idField:r,childrenField:n}=t.modelClass;if(t.transformFlatData&&(null==e?void 0:e.length)>0&&!Object.isExtensible(e[0])&&(t.useRawData=t.useRawData||{disableDuplicateIdCheck:!1,disableDefaultValue:!1,disableTypeConversion:!1},e=ObjectHelper.clone(e)),t.getConfig("plugins"),t.processConfiguredListeners(),e&&!Array.isArray(e)&&(e=ObjectHelper.transformNamedObjectToArray(e,r)),t.tree=!t.isChained&&(t.tree||Boolean(t.autoTree&&(null==e?void 0:e.some((e=>e[n]))))),e&&(t.remoteSort||t.remoteFilter))for(let t=0;t<e.length;t++)e[t]._remoteSortIndex=t;if(t.syncDataOnLoad&&t._data)t.syncDataset(e);else{if(t._data=e,t.tree){t.transformFlatData&&(e=t.treeifyFlatData(e));const r=t.rootNode;if(r.isLoading=!0,t._data.forEach((e=>delete e.parentId)),t.clear(!0),r.appendChild(e),t.updateDependentStores("dataset",[r]),r.isLoading=!1,0===e.length){const e={action:"dataset",data:[],records:[]};t.trigger("refresh",e),t.trigger("change",e)}else t.isFiltered&&t.filter()}else t.loadData(e);t.added.clear(),t.removed.clear(),t.modified.clear()}}loadData(e,t="dataset"){var r,n;const i=this,{storage:s,allowNoId:a}=i,o=i.modelClass.fieldMap.id.dataSource,l=i.find((e=>e.isCreating));l&&s.values.splice(i.records.indexOf(l),1);let c=i.verifyNoGeneratedIds;if(i.removeHeadersAndFooters(i.storage.values),i._idMap=null,i.oldIdMap={},e){if(!(e[0]instanceof Model)){i.modelClass.exposeProperties(e[0]);const t=e.length,l=new Array(t);for(let s=0;s<t;s++){const t=e[s];if(!a&&null==t[o])throw new Error("Id required but not found on row "+s);c&&(null==(n=null==(r=t[o])?void 0:r.startsWith)?void 0:n.call(r,"_generated"))&&(console.warn("Generated id found in data: "+t[o]+". Generated ids are temporary and should be replaced with real ids by the backend"),c=!1),l[s]=i.processRecord(i.createRecord(t,!0),!0),l[s].setData("parentIndex",s)}i.clear(!0),s.replaceValues({values:l,isNewDataset:!0,silent:!0})}else i.clear(!0),s.replaceValues({values:e.slice(),isNewDataset:!0,silent:!0});l&&s.values.push(l),i._data=e,i.onDataReplaced(t,e)}else i.clear(!0),i._data=null;i.isSyncingDataOnLoad=!1}get data(){return this._data}getRange(e,t,r=!0){return(r?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1,r=!1){return new this.modelClass(e,this,null,t,!1,r)}processRecord(e,t=!1){return e}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:r}){const n=this,i=n._idMap,{idRegister:s,oldIdMap:a}=n;if(n.storage._indicesInvalid=!0,a[t]=e,i&&!i[r]){const e=i[t];delete i[t],i[r]=e}n.added.changeId(t,r),n.removed.changeId(t,r),n.modified.changeId(t,r),delete s[t],s[r]=e,e.index=n.storage.indexOf(e)}onUpdateRecord(e,t){const r=this,{internalId:n}=t,{internalIdRegister:i}=r;n&&(this.storage._indicesInvalid=!0,delete i[n.oldValue],i[n.value]=e),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}get useRawData(){return this._useRawData}set useRawData(e){this._useRawData=!0===e?{enabled:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0,disableDefaultValue:!1}:e?Object.assign(e,{enabled:!0}):{enabled:!1}}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){var e;return this.storage.totalCount-((null==(e=this.groupRecords)?void 0:e.length)||0)}get count(){return this.storage.count}get allCount(){return this.isTree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this;if(!t.useRawData.disableDuplicateIdCheck){const r=t.isTree&&t.idRegister[e.id];if(r&&r!==e)throw new Error("Id collision on "+e.id)}t.idRegister[e.id]=e,t.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){if(null==e?void 0:e.isModel){const t=e;return t.hasLinks&&!this.storage.allValues.includes(t)?t.$links.find((e=>this.storage.allValues.includes(e))):t}return this.idRegister[e]}isAvailable(e){const t=this.getById(e);return t&&this.storage.includes(t)||!1}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.isTree?null!=this.idRegister[Model.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1,r=!1){if((null==e?void 0:e.isModel)&&!e.stores.includes(this.$store||this)){const r=e.$links.find((e=>this.storage.allValues.includes(e)));return r?this.indexOf(r,t):-1}if(this.isTree)return(r?this.rootNode.allChildren:this.storage.values).indexOf(this.getById(e));const n=Model.asId(e);if(null==n)return-1;const i=this.idMap[n];return i?i[t?"visibleIndex":"index"]:-1}allIndexOf(e){return this.isTree?this.allRecords.indexOf(this.getById(e)):this.storage.indexOf(e,!0)}getDistinctValues(e,t=!1){const r=[],n={};let i;return this.forEach((t=>{if(!t.isSpecialRow&&!t.isRoot){i=t.get(e);const s=i instanceof Date?i.getTime():i;n[s]||(r.push(i),n[s]=1)}}),this,t),r}getValueCount(e,t){let r=0;return this.forEach((n=>{ObjectHelper.isEqual(n.get(e),t)&&r++})),r}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.data=e}get json(){return StringHelper.safeJsonStringify(this)}get formattedJSON(){return StringHelper.safeJsonStringify(this,null,4)}toJSON(){return(this.isTree?this.rootNode.unfilteredChildren||this.rootNode.children||[]:this.allRecords).map((e=>e.toJSON()))}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.project}getInlineData(e){var t;const r=[];return this.tree?null==(t=this.rootNode.children)||t.forEach((t=>r.push(t.getCurrentConfig(e)))):this.forEach((t=>r.push(t.getCurrentConfig(e)))),r}getCurrentConfig(e){var t;const r=super.getCurrentConfig(e),{state:n}=this;return r&&(r.data&&(r.data=this.getInlineData(e)),delete r.project,delete r.stm,delete r.asyncEvents,(null==(t=r.modelClass)?void 0:t.$meta.hierarchy[r.modelClass.$meta.hierarchy.length-2])===this.constructor.defaultConfig.modelClass&&delete r.modelClass,this.tree||delete r.tree,n&&Object.assign(r,n)),r}forEach(e,t=this,r){const n=this,i=(r,n)=>{if(!r.isRoot&&!r.isSpecialRow)return e.call(t,r,n)};if(r=fixTraverseOptions2(n,r),n.isTree)n.isChained&&(r={...r,sorterFn:n.sorterFn}),n.rootNode.traverseWhile(i,!1,r);else{const e=r.includeFilteredOutRecords?n.storage.allValues:n.storage.values;if(n.isGrouped&&r.includeCollapsedGroupRecords)for(let t=0;t<e.length;t++){const n=e[t],s=r.includeFilteredOutRecords?n.unfilteredGroupChildren:n.groupChildren;if(s&&!0===n.meta.collapsed)for(let e=0;e<s.length;e++){if(!1===i(s[e],e))return}else if(!1===i(n,t))return}else for(let t=0;t<e.length;t++)if(!1===i(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}every(e,t=this,r){return this.storage[r?"allValues":"values"].every(e,t)}reduce(e,t=[],r=this){return r!==this&&(e=e.bind(r)),this.storage.values.reduce(e,t,r)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e,t=this.rootNode,r=t===this.rootNode,n){const i=this;if(n=fixTraverseOptions2(i,n),i.isTree){if("boolean"==typeof t&&(r=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverse(e,r,n)}else i.forEach((t=>t.traverse(e,!1,n)),i,n)}traverseWhile(e,t=this.rootNode,r=t===this.rootNode,n){const i=this;if(n=fixTraverseOptions2(i,n),i.isTree){if("boolean"==typeof t&&(r=t,t=i.rootNode),i.isChained){const t=e;e=e=>{i.chainedFilterFn(e)&&t(e)}}t.traverseWhile(e,r,n)}else for(const t of i.storage)if(!1===t.traverse(e,!1,n))break}getNext(e,t=!1,r=!1){const n=this,i=n.storage.values;let s=n.indexOf(e);if(s>=i.length-1){if(!t)return null;s=-1}const a=i[s+1];return r&&a&&a.isSpecialRow?n.getNext(i[s+1],t,!0):a}getPrev(e,t=!1,r=!1){const n=this,i=n.storage.values;let s=n.indexOf(e);if(0===s){if(!t)return null;s=i.length}const a=i[s-1];return r&&a&&a.isSpecialRow&&s>0?n.getPrev(i[s-1],t,!0):a}getAdjacent(e,t=!0,r=!1,n=!1){return t?this.getNext(e,r,n):this.getPrev(e,r,n)}getNextLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let i=r.indexOf(n);if(i>=r.length-1){if(!t)return null;i=-1}return r[i+1]}getPrevLeaf(e,t=!1){const r=this.leaves,n=this.getById(e);let i=r.indexOf(n);if(0===i){if(!t)return null;i=r.length}return r[i-1]}getAdjacentLeaf(e,t=!0,r=!1){return t?this.getNextLeaf(e,r):this.getPrevLeaf(e,r)}};Store.initClass(),Store._$name="Store";var processParamEntry=(e,t)=>(Array.isArray(t[1])?t[1].forEach((r=>e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(r)))):e.push(encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])),e),immediatePromise2=Promise.resolve(),prependZeros=e=>String(e).padStart(2,"0"),dateToString=e=>e.getFullYear()+"-"+prependZeros(e.getMonth()+1)+"-"+prependZeros(e.getDate())+"T"+prependZeros(e.getHours())+":"+prependZeros(e.getMinutes())+":"+prependZeros(e.getSeconds())+"."+e.getMilliseconds(),AjaxStore=class extends Store{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:null,writeAllFields:null,parentIdParamName:"id",responseSuccessProperty:"success",responseDataProperty:"data",responseTotalProperty:"total",filterParamName:null,restfulFilter:!1,sortParamName:null,pageParamName:null,pageStartParamName:null,pageSizeParamName:"pageSize",pageSize:50,useRestfulMethods:null,httpMethods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE"}}}static get configurable(){return{params:null}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch((()=>{}))}get isLoading(){return this._isLoading?2:!!this.loadTriggerPromise&&1}get isCommitting(){return Boolean(this.commitPromise)}set pageParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageStartParamName)throw new Error("Configs pageStartParamName and pageParamName are mutually exclusive");this._pageParamName=e}get pageParamName(){return this._pageParamName}set pageStartParamName(e){if(this.tree)throw new Error("Paging cannot be supported for tree stores");if(this.pageParamName)throw new Error("Configs pageParamName and pageStartParamName are mutually exclusive");this._pageStartParamName=e}get pageStartParamName(){return this._pageStartParamName}get isPaged(){return this.pageParamName||this.pageStartParamName}get allCount(){return"remoteTotal"in this?this.remoteTotal:super.allCount}get lastPage(){if(this.isPaged)return Math.floor((this.allCount+this.pageSize-1)/this.pageSize)}buildQueryString(e,...t){const r=e.includes("?"),n=Object.entries(Object.assign({},...t)).reduce(processParamEntry,[]).join("&");return n?(r?"&":"?")+n:""}async performSort(e){const t=this;if(t.remoteSort&&!t.isRemoteDataLoading){t.isRemoteDataLoading=!0;const r=await t.internalLoad({},"",(r=>{t.data=r.data,t.afterPerformSort(e)}));return t.isRemoteDataLoading=!1,r}super.performSort(e)}async performFilter(e){var t;const r=this;if(r.remoteFilter){null==(t=r.loadingPromise)||t.abort(),r.isRemoteDataLoading=!0;const n=r.count,{filters:i}=r;r.currentPage=1;const s=await r.internalLoad({},"",(t=>{r.data=t.data,t=e?null:{action:"filter",filters:i,oldCount:n,records:r.storage.values},r.afterPerformFilter(t),r.trigger("refresh",t)}));return r.isRemoteDataLoading=!1,s}super.performFilter(e)}encodeFilterParams(e){const t=[];for(const{property:r,operator:n,value:i,caseSensitive:s}of e)t.push({field:r,operator:n,value:i,caseSensitive:s});return JSON.stringify(t,(function(e,t){return""===e?t:this[e]instanceof Date?dateToString(this[e]):t}))}encodeSorterParams(e){return JSON.stringify(e.filter((e=>!e.sortFn)).map((e=>e)))}buildReadUrl(){const{readUrl:e}=this;if(this.restfulFilter&&this.filters.count){return(e.endsWith("/")?e:e+"/")+this.filters.first.value}return e}internalLoad(e,t,r,n=0){e=ObjectHelper.assign({},this.params,e);const i=this,s=i.buildReadUrl(),a={action:"read"+t,params:e,url:s};if(!s)throw new Error("No load url specified");if(!1===i.trigger("beforeLoad"+t,a))throw!1;return i.loadArgs=[s,a,e,t,r],!1===n?new Promise(((e,t)=>i.sendLoadRequest(e,t))):i.loadTriggerPromise||(i.loadTriggerPromise=new Promise(((e,t)=>{i.setTimeout({delay:n,fn:"sendLoadRequest",args:[e,t],cancelOutstanding:!0})})))}async sendLoadRequest(e,t){const r=this,[n,i,s,a,o]=r.loadArgs;if(r.loadTriggerPromise=null,n){if(r._isLoading=!0,r.trigger("load"+a+"Start",i),r.trigger("beforeRequest",i),r.filterParamName&&r.isFiltered&&(s[r.filterParamName]=r.encodeFilterParams(r.filters.values)),r.remoteSort&&r.isSorted&&(s[r.sortParamName]=r.encodeSorterParams(r.groupers?r.groupers.concat(r.sorters):r.sorters)),r.isPaged){if(!(r.pageParamName in s)&&!(r.pageStartParamName in s)){const e=Math.min(r.currentPage||1,r.allCount?r.lastPage:1/0);r.pageParamName?s[r.pageParamName]=e:s[r.pageStartParamName]=(e-1)*r.pageSize}s[r.pageSizeParamName]=r.pageSize}const n={headers:r.headers,parseJson:!0};r.useRestfulMethods&&(n.method=r.httpMethods.read,i.body&&(n.body=JSON.stringify(i.body)));try{const l=r.loadingPromise=AjaxHelper.get(i.url+r.buildQueryString(i.url,s),ObjectHelper.assign(n,r.fetchOptions)),c=await l,d=c.parsedJson,u=Array.isArray(d),h=u||d&&!1!==ObjectHelper.getPath(d,r.responseSuccessProperty),g=u?null:ObjectHelper.getPath(d,r.responseTotalProperty);if(r.isDestroyed)return;if(r.loadingPromise=null,r._isLoading=!1,i.response=c,i.json=d,h){if(null!=g&&(r.remoteTotal=parseInt(g,10)),r.isPaged){if(!(r.remoteTotal>=0))throw new Error("A paged store must receive its responseTotalProperty in each data packet");{const e=r.pageParamName?s[r.pageParamName]:s[r.pageStartParamName]/r.pageSize+1;r.currentPage=Math.min(e,r.lastPage)}}i.data=u?d:ObjectHelper.getPath(d,r.responseDataProperty),await o(i),!r.isDestroyed&&r.trigger("load"+a,i),e(i)}else Object.assign(i,{exception:!0,exceptionType:"server",error:null==d?void 0:d.error}),!r.isDestroyed&&r.trigger("exception",i),t(i);!r.isDestroyed&&r.trigger("afterRequest",i)}catch(e){r._isLoading=!1,i.exception=!0,e instanceof Response?(i.exceptionType=e.ok?"server":"network",i.response=e,i.error=e.error):(i.exceptionType="server",i.error=e),!r.isDestroyed&&r.trigger("exception",i),t(i),!r.isDestroyed&&r.trigger("afterRequest",i)}}}async load(e){const t=this;return t.isPaged?t.loadPage(t.currentPage||1,e):t.internalLoad(e,"",(e=>{t.data=e.data}))}async loadChildren(e){return this.readUrl?this.internalLoad({[this.parentIdParamName]:e.id},"Children",(t=>{t.parentRecord=e,e.children.length&&e.clearChildren(!0),e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)}),!1):this.immediatePromise}async loadPage(e,t){this.allCount&&(e=Math.min(e,this.lastPage));const r=this,n=r.pageParamName?{[r.pageParamName]:e}:{[r.pageStartParamName]:(e-1)*r.pageSize};return n[r.pageSizeParamName]=r.pageSize,r.internalLoad(ObjectHelper.assign(n,t),"Page",(e=>{r.loadData(e.data,"pageLoad")}))}async nextPage(e){const t=this;return t.isPaged&&t.currentPage!==t.lastPage?t.loadPage(t.currentPage+1,e):immediatePromise2}async previousPage(e){return this.isPaged&&1!==this.currentPage?this.loadPage(this.currentPage-1,e):immediatePromise2}async commit(){const e=this,{changes:t}=e,r=[];if(e.commitPromise)return!1;if(!t)return e.modified.count&&(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear()),immediatePromise2;if(!1!==e.trigger("beforeCommit",{changes:t})){[...t.added,...t.modified,...t.removed].forEach((e=>e.meta.committing=!0)),e.trigger("commitStart",{changes:t});const n={action:"commit",exception:!1,changes:t};let i=e.commitRemoved(n);return i&&r.push(i),i=e.commitAdded(n),i&&r.push(i),i=e.commitModified(n),i&&r.push(i),r.length?(i=1===r.length?r[0]:Promise.all(r),e.commitPromise=new Promise(((r,s)=>{i.then((()=>{e.commitPromise=null,n.exception?(e.trigger("exception",n),s(n)):(e.trigger("commit",{changes:t}),r(n))})).catch((()=>{e.commitPromise=null,s(n)}))}))):(e.modified.forEach((e=>e.clearChanges(!0,!1))),e.modified.clear(),e.added.forEach((e=>e.clearChanges(!0,!1))),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),immediatePromise2)}}doAutoCommit(){this.suspendCount<=0&&this.commit().catch((e=>{const{response:t}=e;if(!t||!(t.ok&&t.parsedJson||[500,404].includes(t.status)))throw e}))}commitAdded(e){const t=this,r=t.added,n={action:"create",params:t.params};return r.count&&t.createUrl?new Promise((i=>{const s=r.values.map((e=>e.persistableData));e.create=n,n.body={data:s},t.trigger("beforeRequest",n);let a=n.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),a=e}const o={headers:t.headers,parseJson:!0},l=t.createUrl+t.buildQueryString(t.createUrl,t.params);t.useRestfulMethods&&(o.method=t.httpMethods.create),AjaxHelper.post(l,a,ObjectHelper.assign(o,t.fetchOptions)).then((s=>{const a=s.parsedJson,o=Array.isArray(a),l=o||a&&!1!==a.success;e.response=s,n.json=a,n.response=s,l?(t.processReturnedData(r.values,o?a:ObjectHelper.getPath(a,t.responseDataProperty)),r.clear(),t.trigger("commitAdded"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,e.exceptionType=n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null}commitModified(e){const t=this,{modified:r}=t.changes,n={action:"update",params:t.params},i=r.length&&t.updateUrl?new Promise((i=>{const s=r.map((e=>t.writeAllFields?e.persistableData:e.modificationDataToWrite)).filter((e=>!ObjectHelper.isEmpty(e)));if(0===s.length)return t.modified.clear(),r.forEach((e=>e.meta.committing=!1)),void i();e.update=n,n.body={data:s},t.trigger("beforeRequest",n);let a=n.body;if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(s)),a=e}const o={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(o.method=t.httpMethods.update),AjaxHelper.post(t.updateUrl+t.buildQueryString(t.updateUrl,t.params),a,ObjectHelper.assign(o,t.fetchOptions)).then((s=>{const a=s.parsedJson,o=Array.isArray(a),l=o||a&&!1!==a.success;e.response=s,n.json=a,n.response=s,l?(t.processReturnedData(r,o?a:ObjectHelper.getPath(a,t.responseDataProperty),!0),t.modified.clear(),t.trigger("commitModified"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null;return!r.length&&t.modified.count&&t.modified.clear(),i}processReturnedData(e,t,r=!1){const n=this,i=n.modelClass,s=i.fieldMap.id.dataSource;t.forEach(((t,a)=>{const o=e[a];o.clearChanges(!0,!1),o.syncId(t[s]),Object.assign(e[a].data,i.processData(t,r,n,o))}))}commitRemoved(e){const t=this,r=t.removed,n={action:"delete",params:t.params};return r.count&&t.deleteUrl?new Promise((i=>{e.delete=n,n.body={ids:r.map((e=>e.id))},t.trigger("beforeRequest",n);let s=n.body;if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(s.ids)),s=e}const a={headers:t.headers,parseJson:!0};t.useRestfulMethods&&(a.method=t.httpMethods.delete),AjaxHelper.post(t.deleteUrl+t.buildQueryString(t.deleteUrl,t.params),s,ObjectHelper.assign(a,t.fetchOptions)).then((s=>{const a=s.parsedJson,o=Array.isArray(a)||a&&!1!==a.success;e.response=s,n.json=a,n.response=s,o?(r.forEach((e=>e.meta.committing=!1)),r.clear(),t.trigger("commitRemoved"),t.trigger("refresh",n),i(e)):(r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,n.exceptionType="server",t.trigger("exception",n),i(e)),t.trigger("afterRequest",n)})).catch((s=>{r.forEach((e=>e.meta.committing=!1)),e.exception=n.exception=!0,s instanceof Response?(e.response=s,n.exceptionType=s.ok?"server":"network",n.response=s,n.error=s.error):(n.exceptionType="server",n.error=s),t.trigger("exception",n),i(e),t.trigger("afterRequest",n)}))})):null}get remoteFilter(){return Boolean(this.filterParamName||this.restfulFilter)}get remoteSort(){return Boolean(this.sortParamName)}};__publicField(AjaxStore,"$name","AjaxStore"),AjaxStore._$name="AjaxStore";var DomDataStore=class{static get(e,t){const r=e._domData||(e._domData={});return null!=t?r[t]:r}static remove(e,t){const{_domData:r}=e,n=null==r?void 0:r[t];return null==r||delete r[t],n}static set(e,t,r){3===arguments.length?(e._domData||(e._domData={}))[t]=r:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}};DomDataStore._$name="DomDataStore";var throwAbstractMethodCall=()=>{throw new Error("Abstract method call!")},ActionBase=class extends Base{get type(){return this.constructor.name}undo(){throwAbstractMethodCall()}redo(){throwAbstractMethodCall()}};ActionBase._$name="ActionBase";var throwAbstractMethodCall2=()=>{throw new Error("Abstract method call!")},throwInvalidMethodCall=()=>{throw new Error("Method cannot be called at this state!")},StateBase=class extends Base{canUndo(e){throwAbstractMethodCall2()}canRedo(e){throwAbstractMethodCall2()}onUndo(e){throwAbstractMethodCall2()}onRedo(e){throwAbstractMethodCall2()}onStartTransaction(e){throwAbstractMethodCall2()}onStopTransaction(e){throwAbstractMethodCall2()}onStopTransactionDelayed(e){throwAbstractMethodCall2()}onRejectTransaction(e){throwAbstractMethodCall2()}onEnable(e){throwAbstractMethodCall2()}onDisable(e){throwAbstractMethodCall2()}onAutoRecordOn(e){throwAbstractMethodCall2()}onAutoRecordOff(e){throwAbstractMethodCall2()}onResetQueue(e){throwAbstractMethodCall2()}onModelUpdate(e){throwAbstractMethodCall2()}onStoreModelAdd(e){throwAbstractMethodCall2()}onStoreModelInsert(e){throwAbstractMethodCall2()}onStoreModelRemove(e){throwAbstractMethodCall2()}onStoreModelRemoveAll(e){throwAbstractMethodCall2()}onModelInsertChild(e){throwAbstractMethodCall2()}onModelRemoveChild(e){throwAbstractMethodCall2()}};StateBase._$name="StateBase";var STATE_PROP=Symbol("STATE_PROP"),STORES_PROP=Symbol("STORES_PROP"),QUEUE_PROP=Symbol("QUEUE_PROP"),POS_PROP=Symbol("POS_PROP"),TRANSACTION_PROP=Symbol("TRANSACTION_PROP"),TRANSACTION_TIMER_PROP=Symbol("TRANSACTION_TIMER_PROP"),AUTO_RECORD_PROP=Symbol("AUTO_RECORD_PROP"),PROPS=Object.freeze([STATE_PROP,STORES_PROP,QUEUE_PROP,POS_PROP,TRANSACTION_PROP,TRANSACTION_TIMER_PROP,AUTO_RECORD_PROP]),registry=new Map,registerStmState=(e,t)=>{registry.set(e,t)},resolveStmState=e=>("string"==typeof e&&(e=registry.get(e)),e),Registry_default={registerStmState:registerStmState,resolveStmState:resolveStmState},resetQueue=(e,t)=>{const{undo:r,redo:n}=t;let i;return i=r&&!n?{[QUEUE_PROP]:e[QUEUE_PROP].slice(e.position),[POS_PROP]:0}:n&&!r?{[QUEUE_PROP]:e[QUEUE_PROP].slice(0,e.position)}:{[QUEUE_PROP]:[],[POS_PROP]:0},[i,()=>{e.notifyStoresAboutQueueReset(t)}]},DisabledStateClass=class extends StateBase{canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},DisabledState=new DisabledStateClass,DisabledState_default=DisabledState;Registry_default.registerStmState("disabledstate",DisabledState);var ACTION_QUEUE_PROP=Symbol("ACTION_QUEUE_PROP"),Transaction=class extends Base{get defaultConfig(){return{title:null}}construct(...e){this[ACTION_QUEUE_PROP]=[],super.construct(...e)}get queue(){return this[ACTION_QUEUE_PROP].slice(0)}get length(){return this[ACTION_QUEUE_PROP].length}addAction(e){this[ACTION_QUEUE_PROP].push(e)}undo(){const e=this[ACTION_QUEUE_PROP];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[ACTION_QUEUE_PROP];for(let t=0,r=e.length;t<r;++t)e[t].redo()}};Transaction._$name="Transaction";var ReadyStateClass=class extends StateBase{canUndo(e){let t=0<e.position&&e.position<=e.length;return t?$("#undoBtn").removeClass("disabled"):($("#undoBtn").addClass("disabled"),$("#saveBtn").hide()),t}canRedo(e){let t=0<=e.position&&e.position<e.length;return t?$("#redoBtn").removeClass("disabled"):$("#redoBtn").addClass("disabled"),t}onUndo(e,t){let r=e.position;const n=e[QUEUE_PROP],i=Math.max(0,r-t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];for(;r!==i;){const e=n[--r];e.undo(),t.push(e)}return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"undo",transactions:t})}]}]}onRedo(e,t){let r=e.position;const n=e[QUEUE_PROP],i=Math.min(n.length,r+t);return[{[STATE_PROP]:"restoringstate",[POS_PROP]:i},()=>{e.notifyStoresAboutStateRestoringStart();const t=[];do{const e=n[r++];e.redo(),t.push(e)}while(r!==i);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop({cause:"redo",transactions:t})}]}]}onEnable(){throwInvalidMethodCall()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[STATE_PROP]:"autoreadystate",[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"recordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r)}]}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},ReadyState=new ReadyStateClass,ReadyState_default=ReadyState;Registry_default.registerStmState("readystate",ReadyState);var RecordingStateClass=class extends StateBase{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){const t=e[TRANSACTION_PROP];return e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null}}onAutoRecordOn(e){return[{[STATE_PROP]:"autorecordingstate",[AUTO_RECORD_PROP]:!0},()=>{e.stopTransactionDelayed()}]}onAutoRecordOff(){throwInvalidMethodCall()}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(e,t){const r=e[TRANSACTION_PROP],n=e[QUEUE_PROP];let i=e[POS_PROP];return r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),n[i]=r,n.length=++i),[{[STATE_PROP]:"readystate",[POS_PROP]:i,[TRANSACTION_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onRejectTransaction(e){const t=e[TRANSACTION_PROP];return[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){throwInvalidMethodCall()}onResetQueue(e,t){return resetQueue(e,t)}onModelUpdate(e,t,r,n,i){e[TRANSACTION_PROP].addAction(e.makeModelUpdateAction(t,r,n,i))}onModelInsertChild(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeModelInsertChildAction(t,r,n,i,s))}onModelRemoveChild(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeModelRemoveChildAction(t,r,n))}onStoreModelAdd(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreModelAddAction(t,r,n))}onStoreModelInsert(e,t,r,n,i,s){e[TRANSACTION_PROP].addAction(e.makeStoreModelInsertAction(t,r,n,i,s))}onStoreModelRemove(e,t,r,n,i){e[TRANSACTION_PROP].addAction(e.makeStoreModelRemoveAction(t,r,n,i))}onStoreRemoveAll(e,t,r,n){e[TRANSACTION_PROP].addAction(e.makeStoreRemoveAllAction(t,r,n))}},RecordingState=new RecordingStateClass,RecordingState_default=RecordingState;Registry_default.registerStmState("recordingstate",RecordingState);var RestoringStateClass=class extends StateBase{static get $name(){return"RestoringStateClass"}canUndo(){return!1}canRedo(){return!1}onUndo(){throwInvalidMethodCall()}onRedo(){throwInvalidMethodCall()}onEnable(){throwInvalidMethodCall()}onDisable(){throwInvalidMethodCall()}onAutoRecordOn(){return{[AUTO_RECORD_PROP]:!0}}onAutoRecordOff(){return{[AUTO_RECORD_PROP]:!1}}onStartTransaction(){throwInvalidMethodCall()}onStopTransaction(){throwInvalidMethodCall()}onStopTransactionDelayed(){throwInvalidMethodCall()}onRejectTransaction(){throwInvalidMethodCall()}onQueueReset(){throwInvalidMethodCall()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}},RestoringState=new RestoringStateClass,RestoringState_default=RestoringState;Registry_default.registerStmState("restoringstate",RestoringState);var AutoReadyStateClass=class extends ReadyStateClass{onAutoRecordOn(){throwInvalidMethodCall()}onAutoRecordOff(){return{[STATE_PROP]:"readystate",[AUTO_RECORD_PROP]:!1}}onStartTransaction(e,t){const r=new Transaction({title:t});return[{[STATE_PROP]:"autorecordingstate",[TRANSACTION_PROP]:r},()=>{e.notifyStoresAboutStateRecordingStart(r),e.stopTransactionDelayed()}]}onModelUpdate(e,t,r,n){e.startTransaction(),e.onModelUpdate(t,r,n)}onModelInsertChild(e,t,r,n,i){e.startTransaction(),e.onModelInsertChild(t,r,n,i)}onModelRemoveChild(e,t,r,n){e.startTransaction(),e.onModelRemoveChild(t,r,n)}onStoreModelAdd(e,t,r,n){e.startTransaction(),e.onStoreModelAdd(t,r,n)}onStoreModelInsert(e,t,r,n,i,s){e.startTransaction(),e.onStoreModelInsert(t,r,n,i,s)}onStoreModelRemove(e,t,r,n,i){e.startTransaction(),e.onStoreModelRemove(t,r,n,i)}onStoreRemoveAll(e,t,r,n){e.startTransaction(),e.onStoreRemoveAll(t,r,n)}},AutoReadyState=new AutoReadyStateClass,AutoReadyState_default=AutoReadyState;Registry_default.registerStmState("autoreadystate",AutoReadyState);var AutoRecordingStateClass=class extends(RecordingStateClass.mixin(Delayable_default)){onDisable(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[STATE_PROP]:"disabledstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null}}onAutoRecordOn(e){throwInvalidMethodCall()}onAutoRecordOff(e){const t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),{[STATE_PROP]:"recordingstate",[AUTO_RECORD_PROP]:!1,[TRANSACTION_TIMER_PROP]:null}}onStopTransaction(e,t){const r=e[TRANSACTION_PROP],n=e[TRANSACTION_TIMER_PROP],i=e[QUEUE_PROP];let s=e[POS_PROP];return n&&this.clearTimeout(n),r.length&&(r.title||t||!e.getTransactionTitle?t&&(r.title=t):r.title=e.getTransactionTitle(r),i[s]=r,i.length=++s),[{[STATE_PROP]:"autoreadystate",[POS_PROP]:s,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>{e.notifyStoresAboutStateRecordingStop(r,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[TRANSACTION_TIMER_PROP];return t&&this.clearTimeout(t),t=this.setTimeout((()=>{e.stopTransaction()}),e.autoRecordTransactionStopTimeout),{[STATE_PROP]:AutoRecordingState,[TRANSACTION_TIMER_PROP]:t}}onResetQueue(e,t){return resetQueue(e,t)}onRejectTransaction(e){const t=e[TRANSACTION_PROP],r=e[TRANSACTION_TIMER_PROP];return r&&this.clearTimeout(r),[{[STATE_PROP]:"restoringstate",[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}},AutoRecordingState=new AutoRecordingStateClass,AutoRecordingState_default=AutoRecordingState;Registry_default.registerStmState("autorecordingstate",AutoRecordingState);var MODEL_PROP=Symbol("MODEL_PROP"),NEW_DATA_PROP=Symbol("NEW_DATA_PROP"),OLD_DATA_PROP=Symbol("OLD_DATA_PROP"),UpdateAction=class extends ActionBase{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0,isInitialUserAction:!1}}get type(){return"UpdateAction"}get model(){return this[MODEL_PROP]}set model(e){this[MODEL_PROP]=e}get newData(){return this[NEW_DATA_PROP]}set newData(e){this[NEW_DATA_PROP]={...e}}get oldData(){return this[OLD_DATA_PROP]}set oldData(e){this[OLD_DATA_PROP]={...e}}undo(){const{model:e,oldData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}redo(){const{model:e,newData:t}=this;e.$&&Object.assign(e,t),e.set(t,null,null,null,!0)}};UpdateAction._$name="UpdateAction";var PARENT_MODEL_PROP=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP=Symbol("CHILD_MODELS_PROP"),INSERT_INDEX_PROP=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP=Symbol("CONTEXT_PROP"),InsertChildAction=class extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[PARENT_MODEL_PROP]}set parentModel(e){this[PARENT_MODEL_PROP]=e}get childModels(){return this[CHILD_MODELS_PROP]}set childModels(e){this[CHILD_MODELS_PROP]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP]}set insertIndex(e){this[INSERT_INDEX_PROP]=e}get context(){return this[CONTEXT_PROP]}set context(e){this[CONTEXT_PROP]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort(((e,r)=>{const{lhsParent:n,lhsIndex:i}=t.get(e)||{},{rhsParent:s,rhsIndex:a}=t.get(r)||{};return n&&n===s?i-a:0})),r.forEach((r=>{const{parent:n,index:i}=t.get(r)||{};if(n)if(n===e){let e;e=i>r.parentIndex?i+1:i,e=i===n.children.length-1?null:e;const t=n.children[e];n.insertChild(r,t)}else n.insertChild(r,n.children[i]);else e.removeChild(r)}))}redo(){const{parentModel:e,insertIndex:t,childModels:r}=this,n=e.children[t];e.insertChild(r,n)}};InsertChildAction._$name="InsertChildAction";var PARENT_MODEL_PROP2=Symbol("PARENT_MODEL_PROP"),CHILD_MODELS_PROP2=Symbol("CHILD_MODELS_PROP"),CONTEXT_PROP2=Symbol("CONTEXT_PROP"),RemoveChildAction=class extends ActionBase{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[PARENT_MODEL_PROP2]}set parentModel(e){this[PARENT_MODEL_PROP2]=e}get childModels(){return this[CHILD_MODELS_PROP2]}set childModels(e){this[CHILD_MODELS_PROP2]=e.slice(0)}get context(){return this[CONTEXT_PROP2]}set context(e){this[CONTEXT_PROP2]=e}undo(){const{parentModel:e,context:t,childModels:r}=this;r.sort(((e,r)=>t.get(e)-t.get(r))),r.forEach((r=>{e.insertChild(r,t.get(r))}))}redo(){this.parentModel.removeChild(this.childModels)}};RemoveChildAction._$name="RemoveChildAction";var STORE_PROP=Symbol("STORE_PROP"),MODEL_LIST_PROP=Symbol("MODEL_LIST_PROP"),AddAction=class extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[STORE_PROP]}set store(e){this[STORE_PROP]=e}get modelList(){return this[MODEL_LIST_PROP]}set modelList(e){this[MODEL_LIST_PROP]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}};AddAction._$name="AddAction";var STORE_PROP2=Symbol("STORE_PROP"),MODEL_LIST_PROP2=Symbol("MODEL_LIST_PROP"),INSERT_INDEX_PROP2=Symbol("INSERT_INDEX_PROP"),CONTEXT_PROP3=Symbol("CONTEXT_PROP"),InsertAction=class extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[STORE_PROP2]}set store(e){this[STORE_PROP2]=e}get modelList(){return this[MODEL_LIST_PROP2]}set modelList(e){this[MODEL_LIST_PROP2]=e.slice(0)}get insertIndex(){return this[INSERT_INDEX_PROP2]}set insertIndex(e){this[INSERT_INDEX_PROP2]=e}get context(){return this[CONTEXT_PROP3]}set context(e){this[CONTEXT_PROP3]=e}undo(){const{store:e,modelList:t,context:r,silent:n}=this;t.sort(((e,t)=>{const n=r.get(e),i=r.get(t);return void 0!==n&&void 0!==i?n-i:0})),t.forEach((t=>{const i=r.get(t);t._undoingInsertion=!0,void 0!==i?e.insert(i,t,n):e.remove(t,n),t._undoingInsertion=!1}))}redo(){const e=this;e.store.insert(e.insertIndex,e.modelList,e.silent)}};InsertAction._$name="InsertAction";var STORE_PROP3=Symbol("STORE_PROP"),MODEL_LIST_PROP3=Symbol("MODEL_LIST_PROP"),CONTEXT_PROP4=Symbol("CONTEXT_PROP"),RemoveAction=class extends ActionBase{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[STORE_PROP3]}set store(e){this[STORE_PROP3]=e}get modelList(){return this[MODEL_LIST_PROP3]}set modelList(e){this[MODEL_LIST_PROP3]=e.slice(0)}get context(){return this[CONTEXT_PROP4]}set context(e){this[CONTEXT_PROP4]=e}undo(){const{store:e,context:t,modelList:r,silent:n}=this;r.sort(((e,r)=>t.get(e)-t.get(r))),r.forEach((r=>{const i=t.get(r);e.insert(i,r,n)}))}redo(){this.store.remove(this.modelList,this.silent)}};RemoveAction._$name="RemoveAction";var STORE_PROP4=Symbol("STORE_PROP"),ALL_RECORDS_PROP=Symbol("ALL_RECORDS_PROP"),RemoveAllAction=class extends ActionBase{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[STORE_PROP4]}set store(e){this[STORE_PROP4]=e}get allRecords(){return this[ALL_RECORDS_PROP]}set allRecords(e){this[ALL_RECORDS_PROP]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:r}=this;e.add(t,r)}redo(){this.store.removeAll(this.silent)}};RemoveAllAction._$name="RemoveAllAction";var makeModelUpdateAction=(e,t,r,n)=>new UpdateAction({model:e,newData:t,oldData:r,isInitialUserAction:n}),makeModelInsertChildAction=(e,t,r,n)=>new InsertChildAction({parentModel:e,childModels:r,insertIndex:t,context:n}),makeModelRemoveChildAction=(e,t,r)=>new RemoveChildAction({parentModel:e,childModels:t,context:r}),makeStoreModelAddAction=(e,t,r)=>new AddAction({store:e,modelList:t,silent:r}),makeStoreModelInsertAction=(e,t,r,n,i)=>new InsertAction({store:e,insertIndex:t,modelList:r,context:n,silent:i}),makeStoreModelRemoveAction=(e,t,r,n)=>new RemoveAction({store:e,modelList:t,context:r,silent:n}),makeStoreRemoveAllAction=(e,t,r)=>new RemoveAllAction({store:e,allRecords:t,silent:r}),stateTransition=(e,t,...r)=>{const n=e.state,i=t.call(e[STATE_PROP],e,...r);if("string"==typeof i)e[STATE_PROP]=Registry_default.resolveStmState(i);else if(i instanceof StateBase)e[STATE_PROP]=i;else if(Array.isArray(i)){const[t,n]=i;"string"==typeof t?e[STATE_PROP]=Registry_default.resolveStmState(t):t instanceof StateBase?e[STATE_PROP]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[STATE_PROP]=Registry_default.resolveStmState(e[STATE_PROP])),"function"==typeof n&&stateTransition(e,n,...r)}else i&&"object"==typeof i&&((e=Object.assign(e,i))[STATE_PROP]=Registry_default.resolveStmState(e[STATE_PROP]));n!==ReadyState_default&&n!==AutoReadyState_default&&i!==ReadyState_default&&i!==AutoReadyState_default&&e.trigger("ready")},StateTrackingManager=class extends(Events_default(Base)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:makeModelUpdateAction,makeModelInsertChildAction:makeModelInsertChildAction,makeModelRemoveChildAction:makeModelRemoveChildAction,makeStoreModelAddAction:makeStoreModelAddAction,makeStoreModelInsertAction:makeStoreModelInsertAction,makeStoreModelRemoveAction:makeStoreModelRemoveAction,makeStoreRemoveAllAction:makeStoreRemoveAllAction,getTransactionTitle:null}}construct(...e){Object.assign(this,{[STATE_PROP]:ReadyState_default,[STORES_PROP]:[],[QUEUE_PROP]:[],[POS_PROP]:0,[TRANSACTION_PROP]:null,[TRANSACTION_TIMER_PROP]:null,[AUTO_RECORD_PROP]:!1}),super.construct(...e)}get state(){return this[STATE_PROP]}get position(){return this[POS_PROP]}get length(){return this[QUEUE_PROP].length}get stores(){return Array.from(this[STORES_PROP])}hasStore(e){return this[STORES_PROP].includes(e)}addStore(e){this.hasStore(e)||(this[STORES_PROP].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[STORES_PROP]=this[STORES_PROP].filter((t=>t!==e)),e.stm=null)}forEachStore(e){this[STORES_PROP].forEach((t=>e(t,t.id)))}get disabled(){return this.state===DisabledState_default}set disabled(e){const t=this;t.disabled!==e&&(stateTransition(t,e?t.state.onDisable:t.state.onEnable,t),t.trigger("stmDisabled",{disabled:e}),t.trigger("disabled",{disabled:e}))}get enabled(){return!this.disabled}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===ReadyState_default||this.state===AutoReadyState_default}waitForReadiness(){return this.await("ready",!1)}get isRecording(){return this.state===RecordingState_default||this.state===AutoRecordingState_default}get autoRecord(){return this[AUTO_RECORD_PROP]}set autoRecord(e){const t=this;t.autoRecord!=e&&stateTransition(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){stateTransition(this,this.state.onStartTransaction,e)}stopTransaction(e=null){stateTransition(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){stateTransition(this,this.state.onStopTransactionDelayed)}rejectTransaction(){stateTransition(this,this.state.onRejectTransaction)}get transaction(){return this[TRANSACTION_PROP]}get queue(){return this[QUEUE_PROP].map((e=>e.title))}get isRestoring(){return this.state===RestoringState_default}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}async undo(e=1){this.isReady||await this.waitForReadiness(),stateTransition(this,this.state.onUndo,e)}async undoAll(){this.isReady||await this.waitForReadiness(),this.undo(this.length)}async redo(e=1){this.isReady||await this.waitForReadiness(),stateTransition(this,this.state.onRedo,e)}async redoAll(){this.isReady||await this.waitForReadiness(),this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){stateTransition(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore((t=>{var r;return null==(r=t.onStmRecordingStart)?void 0:r.call(t,this,e)})),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore((r=>{var n;return null==(n=r.onStmRecordingStop)?void 0:n.call(r,this,e,t)})),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore((e=>{var t;return null==(t=e.onStmRestoringStart)?void 0:t.call(e,this)})),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop({cause:e,transactions:t}){this.forEachStore((e=>{var t;return null==(t=e.onStmRestoringStop)?void 0:t.call(e,this)})),this.trigger("restoringStop",{stm:this,cause:e,transactions:t})}notifyStoresAboutQueueReset(e){this.forEachStore((t=>{var r;return null==(r=t.onStmQueueReset)?void 0:r.call(t,this,e)})),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,r,n){stateTransition(this,this.state.onModelUpdate,e,t,r,n)}onModelInsertChild(e,t,r,n){stateTransition(this,this.state.onModelInsertChild,e,t,r,n)}onModelRemoveChild(e,t,r){stateTransition(this,this.state.onModelRemoveChild,e,t,r)}onStoreModelAdd(e,t,r){stateTransition(this,this.state.onStoreModelAdd,e,t,r)}onStoreModelInsert(e,t,r,n,i){stateTransition(this,this.state.onStoreModelInsert,e,t,r,n,i)}onStoreModelRemove(e,t,r,n){stateTransition(this,this.state.onStoreModelRemove,e,t,r,n)}onStoreRemoveAll(e,t,r){stateTransition(this,this.state.onStoreRemoveAll,e,t,r)}onUndoKeyPress(e){const t=this;t.enabled&&(e.shiftKey?t.canRedo&&(e.preventDefault(),t.redo()):t.canUndo&&(e.preventDefault(),t.undo()))}stash(){this.transaction&&(this.stashedTransaction=this.transaction,this.rejectTransaction())}applyStash(){this.stashedTransaction&&(this.startTransaction(this.stashedTransaction.title),this.stashedTransaction.redo(),delete this.stashedTransaction)}};StateTrackingManager._$name="StateTrackingManager";var arraySlice2=Array.prototype.slice,emptyArray4=Object.freeze([]),emptyObject5=Object.freeze({}),htmlRe2=/[&<]/,{getPrototypeOf:getPrototypeOf2}=Object,{toString:toString4}=Object.prototype,{isEqual:isEqual,isObject:isObject2}=ObjectHelper,checkEqualityIgnore={parent:1,elementData:1,ns:1,syncOptions:1},makeCheckEqualityOptions=()=>({ignore:checkEqualityIgnore,refsFound:new Set}),isClass={class:1,className:1,classname:1},simpleTypes={bigint:1,boolean:1,function:1,number:1,string:1,symbol:1},syncIgnoreAttributes={tag:1,html:1,text:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,elementData:1,retainElement:1,compareHtml:1,syncOptions:1,listeners:1,isReleased:1,null:1,"":1,keepChildren:1},addAndCacheCls=(e,t)=>{const r="className"in t?"className":"class",n=t[r];if(n)if("string"==typeof n){const i=n.split(" ");i.includes(e)||(i.push(e),t[r]=i.join(" "))}else Array.isArray(n)?n.includes(e)||n.push(e):n.isDomClassList?n.add(e):ObjectHelper.isObject(n)&&(n[e]=1)},removeAndUncacheCls=(e,t)=>{const r="className"in t?"className":"class",n=t[r];if(n)if("string"==typeof n){const i=n.split(" ");i.includes(e)&&(i.splice(i.indexOf(e),1),t[r]=i.join(" "))}else Array.isArray(n)?n.includes(e)&&n.splice(n.indexOf(e),1):n.isDomClassList?n.remove(e):ObjectHelper.isObject(n)&&delete n[e]},DomSync=class{static checkEquality(e,t,r,n){var i;if(e===t)return!0;if(null==e)return null==t;if(!e||!t)return!1;const s=typeof e;if(s!==typeof t||simpleTypes[s])return!1;let a,o,l,c,d,u,h,g=r.equalityCache||(r.equalityCache=new Map),p=Boolean(n);if(g=g.get(e)||g.set(e,new Map).get(e),a=g.get(t),void 0===a){if(a=!0,getPrototypeOf2(e)!==getPrototypeOf2(t)||e instanceof Node)a=!1;else if(Array.isArray(e)){if(o=e.length,o!==t.length)a=!1;else for(;o-- >0;)if(!DomSync.checkEquality(e[o],t[o],r,p)){a=!1;break}}else{for(d in u=e.syncOptions,c=null==u?void 0:u.ignoreRefs,c&&(p=!0,n="children"!==c),l=r.ignore||emptyObject5,t)if(!(l[d]||d in e||n&&"reference"===d)){a=!1;break}if(a)if("[object Date]"===toString4.call(t))a=e.getTime()===t.getTime();else for(d in e)if(!(l[d]||n&&"reference"===d)){if(!(d in t)){a=!1;break}if(h=e[d],!DomSync.checkEquality(h,t[d],r,p)){a=!1;break}}}!n&&isObject2(e)&&e.reference&&(null==(i=r.refsFound)||i.add(e.reference)),g.set(t,a)}return a}static sync(e){const t=e,{refOwner:r}=e,n=null==r?void 0:r.byRef,i=makeCheckEqualityOptions();let s,a,o,l,c=e.affected;if("string"==typeof c&&(c=[c]),e={...e,checkEqualityOptions:i},r){if(r.byRef={},c)for(a in n)c.includes(a)||(r.byRef[a]=n[a]);e.refsWas=n}if(t.changed=DomSync.performSync(e,e.targetElement),r)for(c||(c=Object.keys(n)),s=0;s<c.length;++s)a=c[s],o=n[a],i.refsFound.has(a)||o.retainElement?r.byRef[a]=o:(l=o.lastDomConfig,o.remove(),r.detachRef(a,o,l));return e.targetElement}static performSync(e,t){const{domConfig:r,callback:n}=e,{lastDomConfig:i}=t;return(e.configEquality||DomSync.checkEquality)(r,i,e.checkEqualityOptions,e.ignoreRefs)?(null==n||n({action:"none",domConfig:r,targetElement:t}),!1):(r?(r.onlyChildren||(DomSync.syncAttributes(r,t,e),DomSync.syncContent(r,t)),r.keepChildren||DomSync.syncChildren(e,t)):(t.innerHTML=null,t.syncIdMap=null),t.lastDomConfig=(null==r?void 0:r.onlyChildren)&&i?{...i,children:r.children}:r,!0)}static syncDataset(e,t){const{lastDomConfig:r}=t,n=e===r,i=Object.keys(e.dataset),s=r&&r.dataset&&Object.keys(r.dataset),a=ArrayHelper.delta(i,s);let o,l,c,d;for(l=0;l<a.onlyInA.length;l++)o=a.onlyInA[l],d=e.dataset[o],null!=d&&t.setAttribute("data-"+StringHelper.hyphenate(o),d);for(l=0;l<a.inBoth.length;l++)o=a.inBoth[l],d=e.dataset[o],(n||d!=r.dataset[o])&&(c="data-"+StringHelper.hyphenate(o),null==d?t.removeAttribute(c):t.setAttribute(c,d));for(l=0;l<a.onlyInB.length;l++)t.removeAttribute("data-"+StringHelper.hyphenate(a.onlyInB[l]))}static addCls(e,t){const{lastDomConfig:r}=t;(e=DomClassList.normalize(e,"array")).forEach((e=>{t.classList.add(e),addAndCacheCls(e,r)}))}static removeCls(e,t){const{lastDomConfig:r}=t;(e=DomClassList.normalize(e,"array")).forEach((e=>{t.classList.remove(e),removeAndUncacheCls(e,r)}))}static syncClassList(e,t,r){let n,i,s,a,o,l,c=e.className||e.class,d=!1;if(r){for(i=DomClassList.normalize(t,"array"),c=DomClassList.normalize(c,"object"),l=DomClassList.normalize(r.className||r.class,"object"),o=[],s=0,a=i.length;s<a;++s)n=i[s],c[n]||!(n in l)?(l[n]=1,o.push(n)):d=!0;for(n in c)l[n]||(o.push(n),d=!0);if(!d)return;c=o.join(" ")}else c=DomClassList.normalize(c);t.setAttribute("class",c)}static getSyncAttributes(e){const t={},r=[];return e&&Object.keys(e).forEach((n=>{if(!syncIgnoreAttributes[n]){const i=n.toLowerCase();t[i]=e[n],r.push(i)}})),{attributes:t,names:r}}static syncAttributes(e,t,r){const{lastDomConfig:n}=t,i=e===n,s=DomSync.getSyncAttributes(e),{attributes:a,names:o}=s,{attributes:l,names:c}=i?s:DomSync.getSyncAttributes(n),{onlyInA:d,onlyInB:u,inBoth:h}=i?{onlyInA:emptyArray4,onlyInB:emptyArray4,inBoth:o}:ArrayHelper.delta(o,c);let g,p;for(p=0;p<d.length;p++){g=d[p];const r=a[g];"style"===g&&null!=r?DomHelper.applyStyle(t,r,!0):"dataset"===g?DomSync.syncDataset(e,t):isClass[g]?DomSync.syncClassList(e,t):null!=r&&t.setAttribute(g,r)}for(p=0;p<u.length;p++)t.removeAttribute(u[p]);for(p=0;p<h.length;p++){g=h[p];const n=a[g],s=l[g];null==n?t.removeAttribute(g):"style"===g?r.strict?i?DomSync.syncStyles(t,n):isEqual(n,s,!0)||DomSync.syncStyles(t,n,s):!i&&isEqual(n,s,!0)||DomHelper.applyStyle(t,n,!0):"dataset"===g?DomSync.syncDataset(e,t):isClass[g]?DomSync.syncClassList(e,t,r.strict&&t.lastDomConfig):(i||n!==s)&&t.setAttribute(g,n)}}static syncStyles(e,t,r){let n,i,s;if(r){if(n={},t=DomHelper.parseStyle(t),r=DomHelper.parseStyle(r),t)for(i in t)s=t[i],r[i]!==s&&(n[i]=s);for(i in r)i in t||(n[i]="")}else n=t;DomHelper.applyStyle(e,n)}static syncContent(e,t){var r;const{html:n,text:i}=e,s=null!=i?i:n;if(t.didSetTextContent=!1,e.elementData&&(t.elementData=e.elementData),s instanceof DocumentFragment)1===t.childNodes.length&&0===DomHelper.getChildElementCount(t)&&1===s.childNodes.length&&0===DomHelper.getChildElementCount(s)?DomHelper.setInnerText(t,s.firstChild.data):(t.innerHTML="",t.appendChild(s));else if(null!=n&&htmlRe2.test(n))t.innerHTML=String(n);else if(null!=s){const{lastDomConfig:e}=t;(null==(r=null==e?void 0:e.children)?void 0:r.length)||(null==e?void 0:e.html)&&htmlRe2.test(t.lastDomConfig.html)?t.innerHTML=s:(DomHelper.setInnerText(t,String(s)),t.didSetTextContent=!0)}}static insertTextNode(e,t,r,n,i=null){const s=document.createTextNode(e);t.insertBefore(s,i),n&&(s.$refOwnerId=n.id),null==r||r({action:"newNode",domConfig:e,targetElement:s})}static insertElement(e,t,r,n,i,s,a){var o;const l=a.ns?document.createElementNS(a.ns,e.tag||"svg"):document.createElement(e.tag||"div");t.insertBefore(l,r),DomSync.performSync(a,l),null!=s&&(i[s]=l),e.role||e.tabIndex||e["aria-hidden"]||DomHelper.isFocusable(l,!0)||l.htmlFor||l.setAttribute("role","presentation"),n&&(l.$refOwnerId=n.id,s&&(l.$reference=s,n.attachRef(s,l,e))),null==(o=a.callback)||o.call(a,{action:"newElement",domConfig:e,targetElement:l,syncId:s})}static syncChildren(e,t){var r,n,i;let s,a,o,{domConfig:l,syncIdField:c,callback:d,releaseThreshold:u,configEquality:h,ns:g,refOwner:p,refsWas:m,strict:f,checkEqualityOptions:v,ignoreRefs:y}=e,b=null;const C=l.syncOptions||{};if(null!=(r=l.html)?r:l.text)return;y=Boolean(null!=(n=C.ignoreRefs)?n:y),y&&(p=m=null),"strict"in C&&(f=C.strict);const D=p?p.byRef:{},S=arraySlice2.call(l.children||[]),E=arraySlice2.call(t.childNodes),w=m||t.syncIdMap||{},R=t.releasedIdMap||{},x=e=>{for(;E.length&&E[0].parentNode!==t;)E.shift();return(e?E.shift():E[0])||null};c=C.syncIdField||c,f=C.strict||f,d=C.callback||d,h=C.configEquality||h,u="releaseThreshold"in C?C.releaseThreshold:u,c&&(t.syncIdMap=D);const T={checkEqualityOptions:v||makeCheckEqualityOptions(),ignoreRefs:y,refOwner:p,refsWas:m,strict:f,syncIdField:c,releaseThreshold:u,callback:d,configEquality:h};for(;S.length;){const e=S.shift();if(o=null,!e)continue;if(DomHelper.isReactElement(e)){d({jsx:e,targetElement:t});continue}if(e instanceof Node){a=x(),e!==a&&t.insertBefore(e,a),s=E.indexOf(e),s>-1&&E.splice(s,1);continue}const r="string"==typeof e;if(T.domConfig=e,T.ns=e.ns||g,!r){if(p?o=e.reference:c&&e.dataset&&(o=e.dataset[c]),null!=o&&!e.unmatched){const r=w[o]||R[o];if(r){const{lastDomConfig:n}=r;r.retainElement||DomSync.performSync(T,r)&&(null==d||d({action:"reuseOwnElement",domConfig:e,targetElement:r,lastDomConfig:n,syncId:o})),e.retainElement&&(r.retainElement=!0),D[o]=r,ArrayHelper.remove(E,r),delete R[o],r.isReleased=!1,a=x(),(r.parentNode!==t||f&&r.nextSibling!==a)&&t.insertBefore(r,a)}else f?DomSync.insertElement(e,t,x(),p,D,o,T):(S.push(e),e.unmatched=!0);continue}e.unmatched&&delete e.unmatched}let n,l=null,u=null;for(;!u&&(n=x(!0));){if(p){if(n.$refOwnerId!==p.id)continue;if(n.$reference){if(!f)continue;l=n;break}u=n}else n.retainElement||(u=n);u||(b||(b=[])).push(n)}if(l||!u)r?DomSync.insertTextNode(e,t,d,p,l):DomSync.insertElement(e,t,l,p,D,o,T);else if(r||u.nodeType!==Node.ELEMENT_NODE||(e.tag||"div").toLowerCase()!==u.tagName.toLowerCase())r&&u.nodeType===Node.TEXT_NODE?u.data=e:(r?DomSync.insertTextNode(e,t,d,p,u):DomSync.insertElement(e,t,u,p,D,o,T),u.remove());else{const{lastDomConfig:t}=u,r=DomSync.performSync(T,u);if(c&&null!=(null==(i=null==t?void 0:t.dataset)?void 0:i[c])){const e=t.dataset[c];delete R[e],delete w[e]}null!=o&&(D[o]=u),u.isReleased=!1,r&&(null==d||d({action:"reuseElement",domConfig:e,targetElement:u,lastDomConfig:t,syncId:o}))}}if(!t.didSetTextContent||1!==E.length||E[0].nodeType!==Node.TEXT_NODE){for(;a=x(!0);)p&&(a.$refOwnerId!==p.id||a.$reference)||(b||(b=[])).push(a);b&&DomSync.syncChildrenCleanup(t,b,D,d,p,u,c)}}static syncChildrenCleanup(e,t,r,n,i,s,a){let o,l=0;for(const c of t){const{lastDomConfig:t}=c;c.nodeType!==Element.TEXT_NODE?c.retainElement?a&&t&&(r[c.dataset[a]]=c):!i&&a&&(null==s||l<s)?(c.isReleased||(c.className="b-released",c.isReleased=!0,(null==t?void 0:t.dataset)&&(e.releasedIdMap||(e.releasedIdMap={}),e.releasedIdMap[t.dataset[a]]=c),null==n||n({action:"releaseElement",domConfig:t,lastDomConfig:t,targetElement:c}),t&&(t.isReleased=!0,t.className&&(t.className="b-released"),t.class&&(t.class="b-released"),t.style&&(t.style=null))),l++):(c.remove(),i&&(o=c.$reference,o&&i.detachRef(o,c,t)),e.releasedIdMap&&a&&(null==t?void 0:t.dataset)&&delete e.releasedIdMap[t.dataset[a]],null==n||n({action:"removeElement",domConfig:c.lastDomConfig,lastDomConfig:c.lastDomConfig,targetElement:c})):c.remove()}}static removeChild(e,t){if(e.contains(t)){const r=e.syncIdMap;if(r){const e=Object.values(r).indexOf(t);e>-1&&delete r[Object.keys(r)[e]]}e.removeChild(t)}}static addChild(e,t,r){e.appendChild(t),e.syncIdMap||(e.syncIdMap={}),e.syncIdMap[r]=t}static getChild(e,t){var r;const n=String(t).split(".");for(const t of n)if(!(e=null==(r=null==e?void 0:e.syncIdMap)?void 0:r[t]))return null;return e}};DomSync._$name="DomSync";var Fullscreen=class{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map((e=>{let r=t+StringHelper.capitalize(e);return"moz"===t&&(r=r.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(r="mozCancelFullScreen")),r}));this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const r=["fullscreenchange","fullscreenerror"],n=e=>r.map((t=>e+StringHelper.capitalize(t)));this.events="fullscreenEnabled"in document&&r||"webkitFullscreenEnabled"in document&&n("webkit")||"mozFullscreenEnabled"in document&&n("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[],this.onFullscreenChange(this.onInternalFullscreenChange.bind(this))}static get enabled(){return Boolean(this.functions[0]&&document[this.functions[0]])}static async request(e){return this.functions[1]&&(null==e?void 0:e[this.functions[1]]())}static async exit(){return this.functions[2]&&document[this.functions[2]]()}static get isFullscreen(){return!!this.element}static get element(){return this.functions[3]&&document[this.functions[3]]}static onFullscreenChange(e){this.events[0]&&document.addEventListener(this.events[0],e)}static unFullscreenChange(e){this.events[0]&&document.removeEventListener(this.events[0],e)}static onInternalFullscreenChange(){const e=this,{element:t}=e;if(t){if(!t.closest(".b-floatroot")){const r=DomHelper.getRootElement(t),{floatRoot:n}=r;n&&(e._floatRoot=n,e._oldParent=n.parentElement,t.appendChild(n))}}else e._floatRoot&&e._oldParent.appendChild(e._floatRoot),e._oldParent=null,e._floatRoot=null}};Fullscreen.init(),Fullscreen._$name="Fullscreen";var resizeFireTimer=null,resizedQueue=[],isAbsolutelyPositioned=e=>{var t;return e.nodeType===e.ELEMENT_NODE&&"absolute"===(null==(t=e.ownerDocument.defaultView)?void 0:t.getComputedStyle(e).getPropertyValue("position"))},ResizeMonitor=class{static addResizeListener(e,t){const r=this;if(e!==document&&e!==globalThis||(e=document.body),e.nodeType===e.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)r.hasWindowResizeListener||(globalThis.addEventListener("resize",r.onWindowResize),r.hasWindowResizeListener=!0);else if(globalThis.ResizeObserver)r.resizeObserver||(r.resizeObserver=new ResizeObserver(r.onElementResize)),r.resizeObserver.observe(e);else{e.classList.add("b-no-resizeobserver");const[n,i,s]=DomHelper.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},{returnAll:!0});i.scrollLeft=i.scrollTop=s.scrollLeft=s.scrollTop=1e6,i.addEventListener("scroll",r.onSizeMonitorScroll,!0),s.addEventListener("scroll",r.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver((e=>{const t=[],r=[];for(const n of e)"childList"===n.type&&(t.push.apply(t,n.addedNodes),r.push.apply(r,n.removedNodes));const n=[...t.filter((e=>!r.includes(e))),...r.filter((e=>!t.includes(e)))];0!==n.length&&(n.length>0&&n.every(isAbsolutelyPositioned)||i.dispatchEvent(new CustomEvent("scroll",{bubbles:!1})))}))).observe(e,{childList:!0,subtree:!0}),t.monitorElement=n}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==globalThis||(e=document.body);const r=e._bResizemonitor;let n=0;r&&r.handlers&&(ArrayHelper.remove(r.handlers,t),n=r.handlers.length),n||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(const t of e){const e=t.target,r=e._bResizemonitor,n=t.contentRect||e.getBoundingClientRect();if(hasLayout(e)&&(!r.rectangle||n.width!==r.rectangle.width||n.height!==r.rectangle.height)){const t=r.rectangle;r.rectangle=n;for(const i of r.handlers)i(e,t,n)}}}static onSizeMonitorScroll(e){var t;if(null==(t=document.body)?void 0:t.contains(e.target)){e.stopImmediatePropagation();const t=e.target.parentNode,r=t.parentNode,n=r._bResizemonitor,i=r.getBoundingClientRect();n.rectangle&&i.width===n.rectangle.width&&i.height===n.rectangle.height||(resizedQueue.push([r,n.rectangle,i]),n.rectangle=i,resizeFireTimer||(resizeFireTimer=requestAnimationFrame(ResizeMonitor.fireResizeEvents))),t.firstChild.scrollLeft=t.firstChild.scrollTop=t.childNodes[1].scrollTop=t.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){const t=document.body,r=t._bResizemonitor,n=r.rectangle;r.rectangle=document.documentElement.getBoundingClientRect();for(const e of r.handlers)e(t,n,r.rectangle)}static fireResizeEvents(){for(const e of resizedQueue)for(const t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);resizeFireTimer=null,resizedQueue.length=0}static removeGlobalListeners(){globalThis.removeEventListener("resize",this.onWindowResize)}};ResizeMonitor._$name="ResizeMonitor";var scrollLiterals={auto:"auto",true:"auto",false:"hidden","hidden-scroll":"auto",clip:BrowserHelper.supportsOverflowClip?"clip":"hidden"},scrollerCls="b-widget-scroller",defaultScrollOptions={block:"nearest"},immediatePromise3=Promise.resolve(),scrollPromise=e=>new Promise((t=>EventHelper.on({element:e===document.documentElement?globalThis:e,scroll:t,once:!0}))),xAxis={x:1},isScrollable={auto:1,scroll:1},isScrollableConfig={true:1,auto:1},allScroll={overflowX:"auto",overflowY:"auto"},normalizeEdgeOffset=e=>{var t,r,n,i;let s,a,o,l;return e?"number"==typeof e?s=a=o=l=e:(s=null!=(t=e.top)?t:0,a=null!=(r=e.bottom)?r:0,o=null!=(n=e.start)?n:0,l=null!=(i=e.end)?i:0):s=a=o=l=0,{top:s,bottom:a,start:o,end:l}},Scroller=class extends(Delayable_default(Events_default(Base))){static get configurable(){return{widget:null,element:{$config:{nullify:!0},value:null},contentElement:{$config:{nullify:!0},value:null},overflowX:null,overflowY:null,translate:null,x:0,y:0,rtlSource:null}}static get delayable(){return{onScrollEnd:{type:"buffer",delay:100}}}get isRTL(){var e;return Boolean(null==(e=this.rtlSource)?void 0:e.rtl)}syncOverflowState(){const e=this,{element:t}=e,r=new DomClassList(t.classList),n=e.hasOverflowX=t.scrollWidth>t.clientWidth,i=e.hasOverflowY=t.scrollHeight>t.clientHeight;r.value=t.classList;(r.toggle("b-horizontal-overflow",n)||r.toggle("b-vertical-overflow",i))&&(DomHelper.syncClassList(t,r),e.isConfiguring||e.trigger("overflowChange",{x:n,y:i}))}hasOverflow(e="y"){const t=this["overflow"+e.toUpperCase()],r=this["overflow"+("y"===e?"x":"y")];if(DomHelper.scrollBarWidth&&isScrollableConfig[t]&&"hidden-scroll"!==r&&!BrowserHelper.isFirefox)return this["hasOverflow"+e.toUpperCase()];{const t="y"===e?"Height":"Width";return this["scroll"+t]>this["client"+t]}}hasScrollbar(e="y"){const{element:t}=this;if(t&&DomHelper.scrollBarWidth){const r="y"===e,n=r?"Width":"Height",i=t["client"+n],s=parseInt(DomHelper.getStyleValue(t,"border"+(r?"Left":"Top")+"Width"))+parseInt(DomHelper.getStyleValue(t,"border"+(r?"Right":"Bottom")+"Width")),a=t["offset"+n]-s-i;return Math.abs(a-DomHelper.scrollBarWidth)<2}}addPartner(e,t=xAxis){const r=this;"string"==typeof t&&(t={[t]:1}),r.partners||(r.partners={}),r.partners[e.id]={scroller:e,axes:t},t.x&&(e.x=r.x),t.y&&(e.y=r.y),e.isPartneredWith(r)||e.addPartner(r,t)}eachPartner(e){const{partners:t}=this;t&&Object.values(t).forEach(e)}removePartner(e){this.isPartneredWith(e)&&(delete this.partners[e.id],e.removePartner(this))}isPartneredWith(e){var t;return Boolean(null==(t=this.partners)?void 0:t[e.id])}clearPartners(){this.partners&&Object.values(this.partners).forEach((e=>e.scroller.removePartner(this)))}async scrollIntoView(e,t=defaultScrollOptions){const r=this,{isRectangle:n}=e,i=n?e:Rectangle.from(e),{xDelta:s,yDelta:a}=r.getDeltaTo(e,t),o=r.scrollBy(s,a,t);return(t.highlight||t.focus)&&o.then((()=>{n&&(e=i.translate(-s,-a)),t.highlight&&(isNaN(t.highlight)?(r.widget||r).callback(t.highlight,null,[e]):DomHelper.highlight(e,r)),t.focus&&DomHelper.focusWithoutScrolling(e)})),o}static async scrollIntoView(e,t=defaultScrollOptions,r=!1){const n=Rectangle.from(e),i="object"==typeof t?t.animate:t,s=Scroller._globalScroller||(Scroller._globalScroller=new Scroller),a=[];s.rtlSource={rtl:r};let o,l=0,c=0;for(let r=e.parentNode;r.nodeType===Node.ELEMENT_NODE;r=r.parentNode){if(r===document.body&&r!==document.scrollingElement)continue;const e=r===document.scrollingElement?allScroll:r.ownerDocument.defaultView.getComputedStyle(r);if(!1!==t.y&&isScrollable[e.overflowY]&&r.scrollHeight>r.clientHeight||!1!==t.x&&isScrollable[e.overflowX]&&r.scrollWidth>r.clientWidth){s.element=r,s.positionDirty=!0;const{xDelta:e,yDelta:i}=s.getDeltaTo(n,t);(e||i)&&(a.push({element:r,x:r.scrollLeft,y:r.scrollTop,xDelta:e,yDelta:i}),n.translate(-e,-i),l+=e,c+=i)}}if(a.length){const e=Math.abs(l),t=Math.abs(c);let n=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(n&&(e>10||t>10))Math.max(e,t)<50&&(n=Math.min(n,500)),o=s.scrollAnimation=FunctionHelper.animate(n,(e=>{const t=1===e;for(const{element:n,x:i,y:o,xDelta:l,yDelta:c}of a)s.element=n,l&&(s.x=Math[r?"min":"max"](i+(t?l:Math.round(l*e)),0)),c&&(s.y=Math.max(o+(t?c:Math.round(c*e)),0))}),null,i.easing),o.then((()=>{s.scrollAnimation=null}));else{for(const{element:e,xDelta:t,yDelta:r}of a)e.scrollTop+=r,e.scrollLeft+=t;o=scrollPromise(a[a.length-1].element)}}else o=immediatePromise3;return(t.highlight||t.focus)&&o.then((()=>{t.highlight&&(isNaN(t.highlight)?s.callback(t.highlight,null,[e]):DomHelper.highlight(e,s)),t.focus&&e.focus()})),o}async scrollBy(e=0,t=0,r=defaultScrollOptions){const n=this,i="object"==typeof r?r.animate:r,s=Math.abs(e),a=Math.abs(t);n.scrollAnimation&&(n.scrollAnimation.cancel(),n.scrollAnimation=null),(e||t)&&(n.silent=r.silent);let o=i&&("number"==typeof i?i:"number"==typeof i.duration?i.duration:300);if(o&&(s>10||a>10)){const{x:l,y:c}=n;let d=l,u=c;return Math.max(s,a)<50&&(o=Math.min(o,500)),n.scrollAnimation=FunctionHelper.animate(o,(i=>{var s,a;const o=1===i;if(e){if(n.x!==d&&!r.force)return null==(s=n.scrollAnimation)?void 0:s.cancel();n.x=Math.max(l+(o?e:Math.round(e*i)),0)}if(t){if(n.y!==u&&!r.force)return null==(a=n.scrollAnimation)?void 0:a.cancel();n.y=Math.max(c+(o?t:Math.round(t*i)),0)}d=n.x,u=n.y}),n,i.easing),n.element.classList.add("b-scrolling"),n.scrollAnimation.then((()=>{n.isDestroyed||(n.element.classList.remove("b-scrolling"),n.scrollAnimation=null)})),n.scrollAnimation}if(e|t){const r=n.x,i=n.y;if(n.x+=e,n.y+=t,n.x!==r||n.y!==i)return scrollPromise(n.element)}return immediatePromise3}async scrollTo(e,t,r){const{x:n,y:i}=this,s=null==e?0:e-n,a=null==t?0:t-i;return this.scrollBy(s,a,r)}doDestroy(){var e,t;const r=this;r._element&&(r._element.removeEventListener("scroll",r.scrollHandler),null==(e=r.wheelListenerRemover)||e.call(r)),null==(t=r.scrollAnimation)||t.cancel(),Object.values(r.partners||{}).forEach((({scroller:e})=>e.removePartner(r))),super.doDestroy()}onElMutation(e){const t=this,[r,n]=DomHelper.getTranslateXY(t.element);if(t._x!==-r||t.y!==-n){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onElResize(){const e=this,{widget:t}=e;(null==t?void 0:t.isAnimating)?-1===t.findListener("animationend","onElResize",e)&&t.ion({animationEnd:"onElResize",thisObj:e,once:!0}):e.syncOverflowState()}onScroll(e){const t=this,{_x:r,_y:n,element:i}=t;let s=0;"clip"===t.overflowX&&i.scrollLeft!==r&&(i.scrollLeft=r,++s),"clip"===t.overflowY&&i.scrollTop!==n&&(i.scrollTop=n,++s),2!==s&&(t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,i.classList.contains("b-scrolling")||i.classList.add("b-scrolling"),e.widget=t.widget,t.silent||t.trigger("scroll",e),t.syncPartners(),t.controllingPartner=null,t.onScrollEnd(e)))}syncPartners(e,t){const r=this;r.partners&&Object.values(r.partners).forEach((({axes:n,scroller:i})=>{(i!==r.controllingPartner||e)&&i.sync(r,n)&&t&&i.syncPartners(e,t)}))}onScrollEnd(e){const t=this;t.silent&&(t.silent=!1),t.trigger("scrollEnd",e),t.controllingPartner=null,t.element.classList.remove("b-scrolling")}getDeltaTo(e,t){const r=this;if(!r.viewport)return{xDelta:0,yDelta:0};const{x:n,y:i,scrollWidth:s,scrollHeight:a,isRTL:o}=r,l=e instanceof Rectangle?e:Rectangle.from(e),c=t.block||"nearest",d=r.viewport,u=normalizeEdgeOffset(t.edgeOffset),h=d.width>=l.width+(u.start+u.end)?u:{start:0,end:0},g=d.height>=l.height+(u.top+u.bottom)?u:{top:0,bottom:0},p=new Rectangle(o?d.right- -n-s:d.x-n,d.y-i,s,a),m=l.clone().adjust(-h.start,-g.top,h.end,g.bottom).constrainTo(p),f=m.clone(),v=r.isRTL?-1:1;let y=0,b=0;if("start"===c)f.moveTo(d.x+(r.isRTL?d.width:0),d.y),y=m.x-f.x,b=m.y-f.y;else if("end"===c)r.isRTL?f.moveTo(d.left+(r.isRTL?f.width:0),d.y):f.translate(d.right-f.right,d.bottom-f.bottom),y=m.x-f.x,b=m.y-f.y;else if("center"===c){const e=d.center;f.moveTo(e.x-f.width/2,e.y-f.height/2),y=y||m.x-f.x,b=b||m.y-f.y}else f.width>d.width?y=f.x-d.x:f.right>d.right?y=f.right-d.right:f.x<d.x&&(y=f.x-d.x),f.height>d.height?b=f.y-d.y:f.bottom>d.bottom?b=f.bottom-d.bottom:f.y<d.y&&(b=f.y-d.y);return y=v*Math.round(y),b=Math.round(b),{xDelta:!1===t.x?0:Math.max(Math.min(y,r.maxX-n),-n),yDelta:!1===t.y?0:Math.max(Math.min(b,r.maxY-i),-i)}}get viewport(){return Rectangle.client(this.element)}updateWidget(e){this.rtlSource=this.owner=e}updateElement(e,t){var r;const n=this;if(n===Scroller._globalScroller)return n._element=e,void(n.positionDirty=!0);const i=n.scrollHandler||(n.scrollHandler=n.onScroll.bind(n)),s=n.resizeHandler||(n.resizeHandler=n.onElResize.bind(n));if(t&&(n.translate?null==(r=n.mutationObserver)||r.disconnect():(t.removeEventListener("scroll",i),t.classList.remove(scrollerCls),t.style.overflowX=t.style.overflowY=""),ResizeMonitor.removeResizeListener(t,s)),e){if(n.translate){if(n.mutationObserver||(n.mutationObserver=new MutationObserver(n.mutationHandler||(n.mutationHandler=n.onElMutation.bind(n)))),n._x=n._y=0,document.contains(e)){const[t,r]=DomHelper.getTranslateXY(e);n._x=-t,n._y=-r}n.mutationObserver.observe(e,{attributes:!0})}else e.addEventListener("scroll",i),e.classList.add(scrollerCls);ResizeMonitor.addResizeListener(e,s),n.widget||(n.rtlSource={get rtl(){return"rtl"===DomHelper.getStyleValue(e,"direction")}}),n.isRTL&&e.classList.add("b-rtl"),n.positionDirty&&(n.updateOverflowX(n.overflowX),n.updateOverflowY(n.overflowY)),n.syncOverflowState(),n.isConfiguring&&(n._x&&n.updateX(n._x),n._y&&n.updateY(n._y))}n.positionDirty=!0}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=Math.abs(t.scrollLeft),e._y=t.scrollTop;e.positionDirty=!1}return e._x}get scrollLeft(){return this.element.scrollLeft}changeX(e){if(e=Math.max(e,0),!this.isConfiguring||e)return e;this._x=e}updateContentElement(e){e&&(e="string"==typeof e?this.element.querySelector(e):e,ResizeMonitor.addResizeListener(e,this.resizeHandler))}updateX(e){var t;const{element:r}=this;r&&!(null==(t=this.widget)?void 0:t.isConfiguring)&&(e=Math.round(e),this.trigger("scrollStart",{x:e}),this.translate?DomHelper.setTranslateX(r,-e):r.scrollLeft=this.isRTL?-e:e),this.positionDirty=!0}sync(e,t){const r=this,{x:n,y:i}=t;let s=!1;return null!=n&&r.x!==e.x&&(r.controllingPartner=e,r.x=e.x,s=!0),null!=i&&r.y!==e.y&&(r.controllingPartner=e,r.y=e.y,s=!0),s}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[r,n]=DomHelper.getTranslateXY(t);e._x=-r,e._y=-n}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}changeY(e){if(!this.isConfiguring||e)return e;this._y=e}updateY(e){const{element:t,widget:r}=this;t&&!(null==r?void 0:r.isConfiguring)&&(this.trigger("scrollStart",{y:e}),this.translate?DomHelper.setTranslateY(t,-e):t.scrollTop=e),this.positionDirty=!0}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get lastScrollLeft(){return(this.scrollWidth-this.clientWidth)*(this.isRTL?-1:1)}updateOverflowX(e,t){const r=this,{element:n,translate:i}=r,{style:s,classList:a}=n;if("hidden-scroll"===t&&a.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){isScrollable[s.overflowY]?(e="hidden",r.enableWheel()):a.add("b-hide-scroll")}i||(s.overflowX=scrollLiterals[e]||e),r.isConfiguring||(r.positionDirty=!0,r.syncOverflowState())}updateOverflowY(e,t){const r=this,{element:n,translate:i}=r,{style:s,classList:a}=n;if("hidden-scroll"===t&&a.remove("b-hide-scroll"),"hidden-scroll"===e&&!i){isScrollable[s.overflowX]?(e="hidden",r.enableWheel()):a.add("b-hide-scroll")}i||(s.overflowY=scrollLiterals[e]||e),r.isConfiguring||(r.positionDirty=!0,r.syncOverflowState())}enableWheel(){this.wheelListenerRemover||(this.wheelListenerRemover=EventHelper.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&"hidden-scroll"===this.overflowX?this.x+=e.deltaX:"hidden-scroll"===this.overflowY&&(this.y+=e.deltaY)}get scrollWidth(){var e,t;return null!=(t=null==(e=this.element)?void 0:e.scrollWidth)?t:0}set scrollWidth(e){const t=this,{element:r,isRTL:n}=t;let i=t.widthStretcher;i&&null==e?(i.remove(),t.widthStretcher=null):e&&(e=Math.abs(e),i||(i=t.widthStretcher=DomHelper.createElement({className:"b-scroller-stretcher b-horizontal-stretcher",retainElement:!0})),i.style.transform="translateX("+(e-1)*(n?-1:1)+"px)",r&&!r.contains(i)&&r.insertBefore(i,r.firstElementChild)),!1!==t.propagate&&t.eachPartner((({scroller:t})=>{t.propagate=!1,t.scrollWidth=e,delete t.propagate})),t.positionDirty=!0,t.syncOverflowState()}get scrollHeight(){var e,t;return null!=(t=null==(e=this.element)?void 0:e.scrollHeight)?t:0}set scrollHeight(e){const t=this,r=t.stretcher||(t.stretcher=DomHelper.createElement({className:"b-scroller-stretcher"}));r.style.transform="translateY("+(e-1)+"px)",t.element&&t.element.lastChild!==r&&t.element.appendChild(r),t.positionDirty=!0,t.syncOverflowState()}get clientWidth(){var e;return(null==(e=this.element)?void 0:e.clientWidth)||0}get clientHeight(){var e;return(null==(e=this.element)?void 0:e.clientHeight)||0}get id(){return this._id||(this.widget?this._id=this.widget.id+"-scroller":this._id=IdHelper.generateId("scroller-")),this._id}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(),delete e.widget,delete e.element}};Scroller._$name="Scroller";var Promissory=class{constructor(e){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),e&&e(this)}};Promissory._$name="Promissory";var{defineProperty:defineProperty6}=Reflect,Renderable=class extends(Base.mixin(Localizable_default,Events_default,Delayable_default,Identifiable_default)){static get configurable(){return{element:null}}static get delayable(){return{refreshDom:"raf"}}static get identifiable(){return{}}static get renderConfigs(){const e=this,t=e.$meta;let r,n,i=t.renderConfigs;if(void 0===i){for(n in i=null,r=t.configs,r)r[n].render&&(i||(i=new Set)).add(n);t.renderConfigs=e.prototype.$renderConfigs=i}return i}construct(...e){this.$iid=++Renderable.$idSeed,this.byRef={},super.construct(...e),this.onDraw!==Renderable.prototype.onDraw&&this.initDrawable()}startConfigure(e){this.element=this.renderContext.renderDom(),super.startConfigure(e)}get element(){return this.refreshDom.flush(),this._element}changeElement(e,t){const r=this;return t&&t.remove(),e&&(e.id=r.id,e=DomHelper.createElement(e,{refOwner:r})),e}updateId(e,t){const r=this;if(t){const n=r.element;n.id=e,r.fixRefOwnerId(n,e,t)}}get classes(){return this.element.classList}fixRefOwnerId(e,t,r){if(e.$refOwnerId===r){e.$refOwnerId=t;const n=e.$reference;n&&(e.id=t+"-"+n);for(const n of e.childNodes)this.fixRefOwnerId(n,t,r)}}onConfigChange({name:e}){!this.isConfiguring&&this.$renderConfigs.has(e)&&this.refreshDom()}attachRef(e,t,r){const n=this,i="_"+e,{listeners:s}=r;i in n||defineProperty6(n,e,{get:()=>(n.refreshDom.flush(),n[i]),set(e){n[i]=e}}),t.id=n.id+"-"+e,n.byRef[e]=t,n[e]=t,s&&(r.listeners={on:s,un:EventHelper.on(Object.assign({element:t,thisObj:n},s))})}detachRef(e,t,r){r.listeners&&(r.listeners.un(),r.listeners=null),this[e]=null,delete this.byRef[e]}renderDom(){return{}}get renderContext(){const e=this,t=e.$meta,r=e.constructor;let n=t.renderConfigs||r.renderConfigs,i=e;if(!n){i=Object.create(e),n=new Set;for(const r in t.configs)defineProperty6(i,r,{get:()=>(n.add(r),e[r])});i.renderDom=()=>e.renderDom.call(i),e.$renderConfigs=n}return defineProperty6(e,"renderContext",{value:i}),i}refreshDom(){DomSync.sync({targetElement:this.element,domConfig:this.renderContext.renderDom(),refOwner:this,strict:!0})}onListen(e){"draw"===e&&this.initDrawable()}initDrawable(){const e=this;if(!e.intersector){let t=Object.values(e.byRef).find((e=>e.classList.contains("b-drawable")));t||(t=e.element,t.classList.add("b-drawable")),e.intersector=new IntersectionObserver((t=>{e.isDestroyed||t.forEach((t=>{t.isIntersecting&&e.onDraw({count:++e.drawCounter})}))})),e.intersector.observe(t)}}onDraw(e){this.trigger("draw",e)}};Renderable.$idSeed=0,Object.assign(Renderable.prototype,{drawCounter:0,hasGeneratedId:!1,intersector:null}),Renderable._$name="Renderable";var _Mask=class extends Renderable{construct(e){if(e){let t,r=e.element;r&&(VersionHelper.deprecate("Core","4.0.0",'Mask "element" config has been renamed to "target"'),e=t=Object.assign({},e),delete t.element,t.target=r),r=e.target,"string"==typeof r&&(e=t=t||Object.assign({},e),t.target=e.owner[r])}super.construct(e);const t=this,{type:r}=t;t.target||(t.target=document.body),t.maskName="mask"+("string"==typeof r?r.trim():"")+"-"+_Mask.counter++,t.show()}doDestroy(){const e=this,{element:t}=e;if("trial"===e.type)return!1;t&&(e.element=null,e.mode.endsWith("blur")&&DomHelper.forEachChild(t,(t=>{t.classList.remove("b-masked-"+e.mode)})),e.target.classList.remove("b-masked"),e.target[e.maskName]=null,ArrayHelper.remove(_Mask.masks,e)),super.doDestroy()}get maskElement(){return this.element}set error(e){this.setConfig(this.errorDefaults),this.text=e}renderDom(){const e=this,{maxProgress:t}=e;return{class:{"b-mask":1,"b-delayed-show":e.showDelay,"b-widget":1,["b-mask-"+e.mode]:1,"b-progress":t,"b-prevent-transitions":!e.useTransition},children:[{reference:"maskContent",class:"b-mask-content b-drawable",children:[t?{reference:"progressElement",class:"b-mask-progress-bar",style:{width:Math.max(0,Math.min(100,Math.round(e.progress/t*100)))+"%"}}:null,{reference:"maskText",class:"b-mask-text",html:(e.icon?'<i class="b-mask-icon '+e.icon+'"></i>':"")+e.text}]}]}}static mergeConfigs(...e){const t={};for(const r of e)"string"==typeof r?t.text=r:ObjectHelper.assign(t,r);return t}static mask(e,t=document.body){return _Mask.new({target:t},"string"!=typeof e?{...e}:{text:e})}static unmask(e=document.body){const t=this.getElementMasks(e);return t.length>0?t[t.length-1].close():null}static unmaskAll(e=document.body){return this.getElementMasks(e).forEach((e=>e.close()))}static getElementMasks(e){return this.masks.filter((t=>t.target===e))}updateAutoClose(e){this.deferredClose.cancel(),e&&(this.deferredClose.delay=e,this.deferredClose())}updateCover(){this.syncCover()}syncCover(){var e,t;null==(t=null==(e=this.owner)?void 0:e.syncMaskCover)||t.call(e,this)}onOwnerResize(){this.syncCover()}updateOwner(e){this.detachListeners("cover"),null==e||e.ion({name:"cover",recompose:"onOwnerResize",resize:"onOwnerResize",thisObj:this})}updateShowDelay(e){const{delayedShow:t}=this;t.delay=e,e||t.flush()}deferredClose(){var e;const{owner:t}=this;this.close().then((()=>{var e;null==(e=null==t?void 0:t.onMaskAutoClose)||e.call(t,this)})),null==(e=null==t?void 0:t.onMaskAutoClosing)||e.call(t,this)}delayedShow(){this.classes.remove("b-delayed-show")}show(){const e=this,{element:t,target:r,hiding:n,maskName:i}=e;n&&(n.resolve(),e.hiding=null,e.clearTimeout("hide")),e.showDelay&&(t.classList.add("b-delayed-show"),e.delayedShow()),t.classList.add("b-visible"),t.classList.remove("b-hidden"),r.classList.add("b-masked"),r[i]||(r[i]=e,r.appendChild(t)),ArrayHelper.include(_Mask.masks,e),e.shown=!0,e.trigger("show"),e.mode.endsWith("blur")&&DomHelper.forEachChild(r,(r=>{r!==t&&r.classList.add("b-masked-"+e.mode)}))}hide(){const e=this,{target:t,element:r}=e;let{hiding:n}=e;if(!n){if(!e.shown)return Promise.resolve();e.hiding=n=new Promissory,e.shown=!1,r.classList.remove("b-visible"),r.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&DomHelper.forEachChild(t,(t=>{t!==r&&t.classList.remove("b-masked-"+e.mode)})),n.promise=n.promise.then((()=>{e.hiding===n&&(e.hiding=null)})),e.setTimeout((()=>n.resolve()),500,"hide")}return n.promise}async close(){await this.hide(),this.destroy()}},Mask=_Mask;__publicField(Mask,"$name","Mask"),__publicField(Mask,"type","mask"),__publicField(Mask,"configurable",{autoClose:null,cover:null,icon:"gt-icon gt-icon-spinner",errorDefaults:{icon:"gt-icon gt-icon-warning",autoClose:3e3,showDelay:0},maxProgress:null,mode:"dark",progress:null,owner:{$config:"nullify",value:null},target:null,text:null,type:null,showDelay:null,useTransition:!1}),__publicField(Mask,"delayable",{deferredClose:0,delayedShow:0,syncCover:{type:"throttle",delay:100}}),__publicField(Mask,"counter",0),__publicField(Mask,"masks",[]),Mask._$name="Mask";var KeyMap_default=e=>{var t;return __publicField(t=class extends(e||Base){get widgetClass(){}get keyMapElement(){return this.element}get keyMapSubComponents(){return this.features}matchKeyMapEntry(e,t=this.keyMap){if(t&&!e.handled&&void 0!==e.key)return ObjectHelper.keys(t).find((t=>{const r=t.split("+"),n=r.includes("Alt"),i=r.includes("Shift"),s=r.includes("Ctrl");let a=r[r.length-1].toLowerCase();return"space"===a&&(a=" "),a===e.key.toLowerCase()&&(!e.altKey&&!n||e.altKey&&n)&&(!e.ctrlKey&&!s||e.ctrlKey&&s)&&(!e.shiftKey&&!i||e.shiftKey&&i)}))}performKeyMapAction(e){var t;const{keyMap:r}=this;let n=!1;if(r&&!e.handled&&void 0!==e.key){const i=this.matchKeyMapEntry(e);if(r[i]){const s=ArrayHelper.asArray(r[i]);let a;e.fromKeyMap=!0;for(let r of s){if(a=!0,ObjectHelper.isObject(r)){if(!r.handler)continue;!1===r.preventDefault&&(a=!1),r=r.handler}if("string"==typeof r){const{thisObj:s,handler:a}=this.resolveKeyMapAction(r);if(!1!==(null==(t=s.isActionAvailable)?void 0:t.call(s,i,r,e))&&!1!==a.call(s,e)){n=!0;break}}else if(!1!==r.call(this)){n=!0;break}}delete e.fromKeyMap,n&&(a&&e.preventDefault(),e.handled=!0)}}return n}resolveKeyMapAction(e){const{keyMapSubComponents:t}=this;if(e.startsWith("up.")||e.startsWith("this."))return this.resolveCallback(e);if(t&&e.includes(".")){const[r,n]=e.split(".");if(r&&n)return{thisObj:t[r],handler:t[r][n]}}return{thisObj:this,handler:this[e]}}updateKeyMap(e){var t;null==(t=this.keyMapDetacher)||t.call(this),ObjectHelper.isEmpty(e)||(this.keyMapDetacher=EventHelper.on({element:this.keyMapElement,keydown:"keyMapOnKeyDown",thisObj:this}))}keyMapOnKeyDown(e){this.performKeyMapAction(e)}mergeKeyMaps(e,t,r=null){const n={};e&&ObjectHelper.assign(n,e);for(const i in t){if(!t[i])continue;const s=ArrayHelper.asArray(null==e?void 0:e[i]),a=[];(null==s?void 0:s.length)&&a.push(...s);for(const e of ArrayHelper.asArray(t[i]))ObjectHelper.isObject(e)&&e.handler?a.push(ObjectHelper.assignIf({handler:(r?r+".":"")+e.handler},e)):a.push((r?r+".":"")+e);a.sort(((e,t)=>{const r=(e.weight||0)-(t.weight||0);return 0===r&&(null==s?void 0:s.length)?s.indexOf(e)-s.indexOf(t):r})),n[i]=a}return n}},"$name","KeyMap"),__publicField(t,"configurable",{keyMap:{value:null,$config:{merge:"objects",nullify:!0}}}),t},RTL_default=e=>{var t;return __publicField(t=class extends(e||Base){get widgetClass(){}updateRtl(e){const{element:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}startConfigure(e){var t,r;if(null==(t=super.startConfigure)||t.call(this,arguments),!e.floating&&null==e.rtl){const t=this,n=e.rootElement||e.forElement||(null==(r=t.parent)?void 0:r.contentElement)||(t.floating?t.floatRoot:t.changeElementRef(t.getRenderContext(e)[0]||e.adopt||document.body)),i=e.owner||e.parent||t.constructor.fromElement(n);e.rtl=i?i[i.isConfiguring?"peekConfig":"getConfig"]("rtl"):1===(null==n?void 0:n.nodeType)&&"rtl"===getComputedStyle(n).getPropertyValue("direction"),e.rtl&&(t.configDone.rtl=!1)}}render(...e){var t,r;super.render&&super.render(...e),(BrowserHelper.isChrome&&BrowserHelper.chromeVersion<87||BrowserHelper.isFirefox&&BrowserHelper.firefoxVersion<66||BrowserHelper.isSafari&&BrowserHelper.safariVersion<14.1)&&this.element.classList.add("b-legacy-inset"),("rtl"===getComputedStyle(this.element).direction||(null==(t=this.owner)?void 0:t.rtl))&&(this.rtl=!0,null==(r=this.childItems)||r.forEach((e=>e.rtl=!0)))}},"$name","RTL"),__publicField(t,"configurable",{rtl:null}),t},assignValueDefaults=Object.freeze({highlight:!1,onlyName:!1}),floatRoots=[],highlightExternalChange="highlightExternalChange",isTransparent=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,textInputTypes={INPUT:1,TEXTAREA:1},addElementListeners=(e,t,r,n)=>{let i=(null==r?void 0:r.listeners)||(null==r?void 0:r.internalListeners);if(i=(null==i?void 0:i.on)||i,i){const s=EventHelper.on(ObjectHelper.assign({element:t,thisObj:e},i));n?(e._refListeners||(e._refListeners=Object.create(null)))[n]=s:r.listeners={on:i,un:s}}},mergeAnim=(e,t)=>e&&t&&t[ObjectHelper.keys(e)[0]]?Config.merge(e,t):e,widgetTriggerPaint=e=>{e.isVisible&&e.triggerPaint()},negationPseudo=/^:not\((.+)\)$/,nonFlowedPositions=/absolute|fixed/i,isScaled=e=>null!=e.scale,{hasOwnProperty:hasOwnProperty6}=Object.prototype,{defineProperty:defineProperty7}=Reflect,parseDuration=e=>parseFloat(e)*(e.endsWith("ms")?1:1e3),alignedClass=["b-aligned-above","b-aligned-right","b-aligned-below","b-aligned-left"],returnFalseProp={configurable:!0,get:()=>!1},localizeRE=/(?:L\{([^}.]+)\})/,localizeTooltip=(e,t)=>"L{Tooltip."+t+"}",alignSpecRe2=/^([trblc])(\d*)-([trblc])(\d*)$/i,mergeAlign=(e,t)=>(alignSpecRe2.test(e)&&(e={align:e}),alignSpecRe2.test(t)&&(t={align:t}),Config.merge(e,t)),callbackRe=/^[\w.]+$/,Widget=class extends(Base.mixin(Localizable_default,Events_default,Delayable_default,Identifiable_default,Factoryable_default,KeyMap_default,RTL_default)){static mergeCls(e,t){return t&&e?e=new DomClassList(t).assign("string"==typeof e?new DomClassList(e):e):e&&!e.isDomClassList&&(e=new DomClassList(e)),e}static get $name(){return"Widget"}static get type(){return"widget"}static get configurable(){return{element:!0,callOnFunctions:!0,id:"",html:null,content:null,cls:{$config:{merge:"classList"},value:null},ui:{$config:{merge:"classList"},value:null},collapsify:null,contentElementCls:{$config:{merge:"classList"},value:null},defaultCls:{$config:{merge:"classList"},value:null},dock:null,forwardTwinEvents:{$config:{merge:"classList"},value:null},parent:null,tab:null,elementAttributes:null,htmlCls:{$config:{merge:"classList"},value:{"b-html":1}},style:null,disabled:null,readOnly:{value:null,default:!1,$config:null},ignoreParentReadOnly:null,adopt:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:{$config:["lazy","nullify"],value:null},showTooltipWhenDisabled:!0,preventTooltipOnTouch:null,monitorResize:{$config:["lazy","nullify"],value:null},masked:{$config:"nullify",value:null},maskDefaults:{target:"element"},cache:{},floating:null,positioned:null,draggable:null,align:{$config:{merge:mergeAlign},value:"t-b"},centered:null,constrainTo:void 0,anchor:null,owner:null,scrollAction:null,hideAnimation:{$config:{merge:mergeAnim},value:null},showAnimation:{$config:{merge:mergeAnim},value:null},x:null,y:null,scrollable:{$config:["lazy","nullify"],value:null},scrollerClass:Scroller,defaultBindProperty:"html",defaultAction:null,overflowable:{value:null,default:!0,$config:null},width:null,height:null,maxHeight:null,maxWidth:null,minWidth:null,minHeight:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,weight:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title","ariaLabel","ariaDescription"],requireSize:!1,ref:null,hidden:null,textAlign:null,ignoreScrollDuration:500,tag:"div",recomposeAsync:null,rootElement:null,htmlMutationObserver:{$config:["lazy","nullify"],value:{childList:!0,subtree:!0}},role:{$config:"lazy",value:"presentation"},ariaLabel:{$config:"lazy",value:null},ariaDescription:{$config:"lazy",value:null},ariaElement:"element",ariaHasPopup:null,realignTimeout:300,testConfig:{ignoreScrollDuration:100,realignTimeout:50}}}static get prototypeProperties(){return{hasGeneratedId:!1,innerItem:!0}}static get declarable(){return["renderConfigs"]}static get delayable(){return{recompose:"raf",doHideOrRealign:"raf",onAlignConstraintChange:"raf"}}static get factoryable(){return{defaultType:"widget"}}static get identifiable(){return{}}static get all(){return super.all}static get recomposeAsync(){return Widget._recomposeAsync}static set recomposeAsync(e){if(Widget._recomposeAsync=e,null!=e){const{all:t}=Widget;for(let r=0;r<t.length;++r)t[r].isComposable&&(t[r].recomposeAsync=e)}}isType(e,t){return Widget.isType(this,e,t)}static setupRenderConfigs(e,t){let r,{renderConfigs:n}=e;if(n){const e=t.getInherited("renderConfigs",!1)||Object.create(null);if(Array.isArray(n)){for(r=0;r<n.length;++r)e[n[r]]=!0;n=e}else n=Object.assign(e,n)}t.renderConfigs=n}construct(e={},...t){const r=this,{domSyncCallback:n}=r;r.configureAriaDescription=e.ariaDescription,r._isAnimatingCounter=0,r.alignConstrained=0,r.byRef=Object.create(null),r.onTargetResize=r.onTargetResize.bind(r),r.onFullscreenChange=r.onFullscreenChange.bind(r),r.domSyncCallback=n.$nullFn?null:n.bind(r),r._isUserAction=!1,super.construct(e,...t);const{recomposeAsync:i}=Widget;null!=i&&null==r.recomposeAsync&&(r.recomposeAsync=i),r.finalizeInit()}startConfigure(e){super.startConfigure(e);const t=this,{adopt:r,element:n}=t;r&&(t.adoptElement(n,r,e.id),t.updateElement(t._element,n))}finalizeInit(){var e;const t=this,r=t.insertBefore||t.appendTo||t.insertFirst||t.adopt;r&&(t.owner||(null==(e=r.nodeType?r:document.getElementById(r))?void 0:e.isConnected)?t.render():(t.onFirstResizeAfterConnect=t.onFirstResizeAfterConnect.bind(t),ResizeMonitor.addResizeListener(r,t.onFirstResizeAfterConnect)))}onFirstResizeAfterConnect(e){ResizeMonitor.removeResizeListener(e,this.onFirstResizeAfterConnect),this.isDestroyed||this.rendered||this.render()}doDestroy(){var e,t,r,n;const i=this,{preExistingElements:s,element:a,_refListeners:o}=i;if(Fullscreen.element===a&&Fullscreen.exit(),o&&(Object.values(o,(e=>e())),i._refListeners=null),a){const n=!i._tooltip&&i._rootElement&&(null==(e=Widget.Tooltip)?void 0:e.getSharedTooltip(i._rootElement,!0));if((null==n?void 0:n.owner)===i&&(n.owner=null,n.hide()),i.onExitFullscreen(),i.clearTimeout(i.scrollListenerTimeout),i.clearTimeout(i.resizeListenerTimeout),i.removeTransientListeners(),i.floating||i.positioned?i.hide(!1):i.revertFocus(),ResizeMonitor.removeResizeListener(a.parentElement,i.onParentElementResize),ResizeMonitor.removeResizeListener(a,i.onElementResize),i.adopt){for(let e=Array.from(a.childNodes),t=0,{length:r}=e;t<r;t++){const r=e[t];s.includes(r)||r===i.floatRoot||r.remove()}a.className=i.adoptedElementClassName,a.style.cssText=i.adoptedElementCssText}else a.remove();null==(t=i.dragEventDetacher)||t.call(i),null==(r=i.dragOverEventDetacher)||r.call(i),i.dragGhost.remove()}null==(n=i.connectedObserver)||n.disconnect(),super.doDestroy()}get assignValueDefaults(){return assignValueDefaults}get valueName(){return this.name||this.ref||this.id}getValueName(e){return(e=e&&"object"==typeof e?e.onlyName:e)?this.name:this.valueName}assignFieldValue(e,t,r){const n=this,i=n.defaultBindProperty;i in n&&(n[i]=r)}assignValue(e,t=assignValueDefaults){const r=this,n=r[highlightExternalChange],i=r.getValueName(t);!i||e&&!(i in e)||(!1===t.highlight&&(r[highlightExternalChange]=!1),r.assignFieldValue(e,i,e?e[i]:null),r[highlightExternalChange]=n)}gatherValue(e){const t=this,r=t.defaultBindProperty;t.constructor!==Widget&&r in t&&(e[t.name||t.ref||t.id]=t[r])}gatherValues(e){this.eachWidget((t=>t.gatherValue(e)),!1)}get forwardTwinEvents(){const e=this._forwardTwinEvents;return e&&ObjectHelper.getTruthyKeys(e)}configureOverflowTwin(e){var t;const r=this;let n=ObjectHelper.clone(r.initialConfig);return delete n.id,n.hidden=!1,n.type=r.type,n._overflowTwinOrigin=r,n.disabled=r.disabled,"value"in r&&(n.value=r.value),null==(t=r.forwardTwinEvents)||t.forEach((e=>{delete n["on"+StringHelper.capitalize(e)]})),e&&(n="function"==typeof e?e(n)||n:ObjectHelper.assign(n,e)),n}createOverflowTwin(e){var t;const r=this,n=r.configureOverflowTwin(e),i=Widget.create(n);return null==(t=r.forwardTwinEvents)||t.forEach((e=>{i.ion({[e]:e=>{r.overflowTwin===e.source&&(delete(e=ObjectHelper.assign({},e)).source,r.trigger(e.type,e))}})})),i}ensureOverflowTwin(e,t){let{overflowTwin:r}=this;return r||(this.overflowTwin=r=this.createOverflowTwin(e),null==t||t(r)),r}get isComposable(){return!this.compose.$nullFn}adoptElement(e,t,r){var n;const i=this,s="string"==typeof t?document.getElementById(t):t,a=Widget.fromElement(s);if(a&&a.adopt&&a!==i){("string"==typeof a.adopt?document.getElementById(a.adopt):a.adopt)===s&&a.destroy()}i.preExistingElements=Array.from(s.childNodes),i.adoptedElementClassName=s.className,i.adoptedElementCssText=s.style.cssText,s.id&&!r&&(i.id=e.id=s.id),DomHelper.syncAttributes(e,s);for(let t=0,{length:r}=e.childNodes;t<r;t++)s.appendChild(e.childNodes[0]);delete i._contentRange,i._element=s;const o=e.lastDomConfig,l=null==o?void 0:o.listeners;l&&i.isComposable&&(null==(n=l.un)||n.call(l),addElementListeners(i,s,o)),s.lastDomConfig=o||s.lastDomConfig,s.$refOwnerId=i.id,i.scaleToFitWidth||i.getConfig("monitorResize")}addRefAccessor(e,t){const{prototype:r}=this.constructor;defineProperty7(r,t,{writable:!0,value:null}),defineProperty7(r,e,{get(){return this.recompose.flush(),this[t]},set(e){this[t]=e}})}attachRef(e,t,r){const n=this,i="_"+e;t.dataset&&(t.dataset.ownerCmp=n.id),n.isComposable&&(i in n||n.addRefAccessor(e,i),addElementListeners(n,t,r,e)),n.byRef[e]=t,n[e]=t}detachRef(e,t,r){const n=this,i=n._refListeners;(null==i?void 0:i[e])&&(i[e](),delete i[e]),n[e]=null,delete n.byRef[e]}afterRecompose(){}compose(){return{class:DomClassList.normalize(this.widgetClassList,"object")}}doCompose(){const e=this,{$meta:t}=e,r=t.hierarchy;let n,i,s,a,o,l,{composers:c}=t,d=null;if(e.recompose.suspend(),!c){for(s=!0,t.composers=c=[],a=r.indexOf(Widget);a<r.length;++a)o=r[a].prototype,hasOwnProperty6.call(o,"compose")&&c.push(o);(l=t.getInherited("renderConfigs",!1))||(l=Object.create(null),e.configObserver={get(e){l[e]=!0}}),t.$renderConfigs=l}for(a=0;a<c.length;++a)n=c[a].compose.call(e,d),d=d?DomHelper.merge(d,n):n;return hasOwnProperty6.call(e,"compose")&&(n=e.compose)&&(n=n.call(e,d),DomHelper.merge(d,n)),s&&delete e.configObserver,DomHelper.normalizeChildren(d,((t,r)=>{r&&(i="_"+t,i in e||e.addRefAccessor(t,i))}))}get element(){return this.isComposable&&!this.isDestroying&&this.recompose.flush(),this._element}domSyncCallback(e){}changeElement(e){const t=this,r=t.isComposable;return r&&(e=t.doCompose()),"string"==typeof e?e=DomHelper.createElementFromTemplate(e):ObjectHelper.isObject(e)?(e=DomHelper.createElement(e,{refOwner:t,callback:t.domSyncCallback}),t.recompose.resume(),r&&addElementListeners(t,e,e.lastDomConfig)):DomHelper.isReactElement(t.peekConfig("html"))?e=document.createElement("div"):1!==e.nodeType&&(e=DomHelper.createElementFromTemplate(t.template(t))),e.id=t.id,t.elementAttributes&&DomHelper.setAttributes(e,t.elementAttributes),e}updateElement(e){const t=this,{className:r}=e,{contentElement:n,contentElementCls:i,isComposable:s}=t,a=n!==e,o=!s&&e.querySelectorAll("[data-reference]"),l=s?[]:t.widgetClassList;let c=(a||!s)&&t.uiClasses;if(r&&l.unshift(r),t._hidden&&l.push("b-hidden"),t._readOnly&&l.push("b-readonly"),FunctionHelper.noThrow(e,"remove"),c?((null==i?void 0:i.value)&&(c=c.slice(),c.push(i.value)),c=c.join(" ")):c=null==i?void 0:i.value,c&&(a?n.className+=" "+c:l.push(c)),!t.parent){const{defaultCls:e}=t,{outerCls:r}=Widget;l.push(...e?r.filter((t=>!(t in e)||e[t])):r)}if(e.className=l.join(" "),o)for(let e,r=0;r<o.length;++r)e=o[r],t.attachRef(e.getAttribute("data-reference"),e),e.removeAttribute("data-reference");t.adopt||t.scaleToFitWidth||t.getConfig("monitorResize"),t.getConfig("role"),t.getConfig("ariaLabel"),t.getConfig("ariaDescription"),t._html&&t.getConfig("htmlMutationObserver"),t.trigger("elementCreated",{element:e})}updateAriaDescription(e){const{ariaElement:t}=this,r=this.id+"-aria-desc-el";if(e){const n=this._ariaDescEl||(this._ariaDescEl=DomHelper.createElement({className:"b-aria-desc-element",id:r,parent:t}));n.innerText=e.match(localizeRE)?this.L(e,this):e,t.setAttribute("aria-describedBy",n.id)}else t.getAttribute("aria-describedby")===r&&t.removeAttribute("aria-describedBy")}updateAriaLabel(e){DomHelper.setAttributes(this.ariaElement,{"aria-label":(null==e?void 0:e.match(localizeRE))?this.L(e,this):e})}updateAriaHasPopup(e){DomHelper.setAttributes(this.ariaElement,{"aria-haspopup":e})}updateRole(e){var t,r;e?null==(t=this.ariaElement)||t.setAttribute("role",e):null==(r=this.ariaElement)||r.removeAttribute("role")}get ariaElement(){this.getConfig("element");const{_ariaElement:e}=this;return e.nodeType===Node.ELEMENT_NODE?e:ObjectHelper.getPath(this,e)}isCollapsified(e,t){const{collapsify:r}=this;let n=!t;return null==r?n=t?e:!e:"overlay"===r&&(n=t),Boolean(n)}async recompose(){const e=this,t={targetElement:e.element,domConfig:e.doCompose(),refOwner:e,callback:e.domSyncCallback,strict:!0};if(e.transitionRecompose){if(e.isTransitioningDom=!0,await DomHelper.transition(ObjectHelper.assign({element:e.element,action(){DomSync.sync(t)}},e.transitionRecompose)),e.isDestroyed)return;e.isTransitioningDom=!1,e.trigger("transitionedRecompose")}else DomSync.sync(t);t.changed&&(e.afterRecompose(),e.trigger("recompose")),e.recompose.resume()}changeElementRef(e){if("string"==typeof e){const t=e;if(!(e=document.getElementById(t)))throw new Error('找不到ID为 "'+t+'"的元素')}return e}changeAppendTo(e){return this.changeElementRef(e)}updateAppendTo(e){!this.isConfiguring&&e&&this.render()}changeInsertBefore(e){return this.changeElementRef(e)}updateInsertBefore(e){!this.isConfiguring&&e&&this.render()}changeInsertFirst(e){return this.changeElementRef(e)}updateInsertFirst(e){!this.isConfiguring&&e&&this.render()}getRenderContext(e=this,t){let r=t||e.appendTo,{insertFirst:n,insertBefore:i}=e;return n&&(r=n,i=r.firstChild),i&&(r||(r=i.parentElement)),[r,i||void 0]}render(e,t=!0){const r=this,{element:n}=r,[i,s]=r.getRenderContext(r,e);r.emptyCache(),r.syncElement&&r.currentElement?DomHelper.sync(n,r.currentElement):(null==i||i.insertBefore(n,s),r.currentElement=n),Widget.fromElement(n.parentElement)&&n.classList.remove(...Widget.outerCls),super.render(i,t),r.rendered=!0,r.getConfig("role"),t&&(r.getConfig("contentRange"),r.triggerPaint()),r.setupFocusListeners()}template({tag:e,html:t,htmlCls:r,name:n}){const i=this;"string"==typeof t&&callbackRe.test(t)&&i.resolveCallback(t,i,!1)&&(t=i.callback(t,i,[i]));const s=(null==t?void 0:t.call)?t.call(i,i):t;return"<"+e+' class="'+(s?r:"")+'" '+(n?'data-name="'+n+'"':"")+">"+(s||"")+"</"+e+">"}updateRecomposeAsync(e){this.recompose.immediate=!e}onConfigChange({name:e}){var t;this._element&&!this.isDestroying&&(null==(t=this.$meta.$renderConfigs)?void 0:t[e])&&this.recompose()}preProcessCurrentConfigs(e){super.preProcessCurrentConfigs(e),delete e.parent}getConfigValue(e,t){return"style"===e?this._style:super.getConfigValue(e,t)}getCurrentConfig(e){const t=super.getCurrentConfig(e);return(null==e?void 0:e.depth)>0&&(t.type=this.type),t}get dataset(){return this.element.dataset}changeDataset(e){Object.assign(this.dataset,e)}get dragGhost(){return this.constructor._dragGhost||(this.constructor._dragGhost=DomHelper.createElement({html:" ",style:"position:absolute;top:-10000em;left:-10000em"}))}updateParent(e){const{_element:t}=this;t&&t.classList[e?"remove":"add"](...Widget.outerCls)}get constrainTo(){let e=this._constrainTo;if(e=void 0===e?globalThis:(null==e?void 0:e.nodeType)===Node.DOCUMENT_FRAGMENT_NODE?e.host||e.ownerDocument:e,this.positioned){const{offsetParent:t}=this.element;if(t&&"hidden"===DomHelper.getStyleValue(t,"overflow"))e=Rectangle.from(t).moveTo(0,0);else if(e&&!e.isRectangle){const r=e===document||e===globalThis;e=Rectangle.from(e,t),r&&e.translate(globalThis.pageXOffset,globalThis.pageYOffset)}}return e}updateCentered(e){const{element:t,_anchorElement:r}=this;if(e&&!this.floating&&!this.positioned)throw new Error("`centered` is only relevant when a Widget is `floating` or `positioned`");e?(t.classList.add("b-centered"),t.style.transform=t.style.left=t.style.top="",null==r||r.classList.add("b-hide-display"),t.classList.remove("b-anchored")):t.classList.remove("b-centered")}get contentElement(){return this.element}get contentRange(){const e=this,{contentElement:t}=e,r=e._contentRange||(e._contentRange=new Range);return r.collapsed&&(r.setStart(t,e.contentRangeStartOffset||0),r.setEnd(t,e.contentRangeEndOffset||t.childNodes.length)),r}fixRefOwnerId(e,t,r){if(e.$refOwnerId===r){e.$refOwnerId=t;for(let{childNodes:n}=e,i=n.length;i-- >0;)this.fixRefOwnerId(n[i],t,r)}}get placement(){var e;const{element:t}=this;let r,n,i;if((null==t?void 0:t.offsetParent)&&!nonFlowedPositions.test(DomHelper.getStyleValue(t,"position"))){const s=t.nextElementSibling,a=t.previousElementSibling,o=!s&&a;n=DomHelper.getStyleValue(t.parentElement,"flex-direction"),n?n=n.startsWith("row")?"h":"v":(r=null==(e=s||a)?void 0:e.getBoundingClientRect(),i=r&&t.getBoundingClientRect(),n=r&&Math.abs(r.top-i.top)<Math.abs(r.left-i.left)?"h":"v"),n+="h"===n?o?"r":"l":o?"b":"t"}return n}updateId(e,t){if(super.updateId(e,t),t){const{byRef:r,element:n}=this;for(const t in r)r[t].dataset&&(r[t].dataset.ownerCmp=e);n.id=e,this.fixRefOwnerId(n,e,t)}}get style(){const{element:e}=this;return(null==e?void 0:e.ownerDocument.defaultView.getComputedStyle(e))||this._style}updateStyle(e){this.element&&DomHelper.applyStyle(this.element,e)}updateTitle(e){this.titleElement&&(this.titleElement.innerHTML=e)}beforeAlignTo(e){}alignTo(e){var t;const r=this,{lastAlignSpec:n,element:i}=r,{offsetParent:s,style:a,classList:o}=i;if(n&&(n.monitorIntersection&&r.intersectionObserver.unobserve(n.target),isFinite(n.zone)&&i.classList.remove(alignedClass[n.zone])),!e)return r.removeTransientListeners(),void(r.anchor=r.lastAlignSpec=null);r.beforeAlignTo(e),(e.nodeType===Element.ELEMENT_NODE||e.isWidget||"Point"===e.$$name)&&(e={target:e}),r.releaseSizeConstraints();const{scrollable:l,constrainTo:c}=r,d=r.positioned&&"fixed"!==DomHelper.getStyleValue(i,"position"),u=r.scale||1,h=e.target,g=e.domEvent||e.event||h,p=(null==h?void 0:h.isRectangle)?h:(null==h?void 0:h.element)||h,m=Rectangle.from(i,d?s:null,!0),{width:f,height:v}=m,y=(null==p?void 0:p.nodeType)===Element.ELEMENT_NODE,b=(null==(t=null==g?void 0:g.target)?void 0:t.nodeType)===Element.ELEMENT_NODE,C=(e=e.realignTarget?e:ObjectHelper.assign({aligningToEvent:b,aligningToElement:y,constrainTo:c,align:"b-t",axisLock:r.axisLock,anchor:r.anchor},r.align,e)).minWidth||r.minWidth,D=e.minHeight||r.minHeight;if(m.isAlignRectangle=!0,C&&(m.minWidth=C*u),D&&(m.minHeight=D*u),r.lastAlignSpec=e,b)delete e.target,e.domEvent=g,e.anchoredTo=g.target,e.position=new Point(g.clientX+1,g.clientY+1);else if(y&&(e.target=p,hasLayout(p instanceof SVGElement?p.closest("svg"):p))){if((e=Object.setPrototypeOf({},e)).target=r.lastAlignSpec.targetRect=e.realignTarget||(e.allowTargetOut?Rectangle.from(p,d?s:null,!d):DomHelper.isInView(p,!1,r)),!e.target){const e=r.hide();return r.isDestroyed||(r.lastAlignSpec.targetOutOfView=!0),e}e.target.height=Math.max(e.target.height,1),e.target.width=Math.max(e.target.width,1),r.lastAlignSpec.anchoredTo=p}e.anchor&&(e.anchorSize=r.anchorSize,i.contains(r.anchorPathElement)||i.appendChild(r.anchorElement)),r.isAligning=!0,r.trigger("beforeAlign",e),r.isAligning=!1,e.rtl=r.rtl,(e.align.includes("s")||e.align.includes("e"))&&(r.rtl?e.align=e.align.replace(/s/g,"r").replace(/e/g,"l"):e.align=e.align.replace(/s/g,"l").replace(/e/g,"r"));const S=r.lastAlignSpec.result=m.alignTo(e);let{align:E,anchor:w,x:R,y:x,width:T,height:M,overlap:P}=S;if(r.lastAlignSpec.zone=S.zone,M!=v&&("configuredHeight"in r||(r.configuredHeight=a.height),r.height=M/u,r.minHeight||(a.minHeight="unset"),r.alignConstrained=1|r.alignConstrained,l&&(l.overflowY=!0)),T!=f&&("configuredWidth"in r||(r.configuredWidth=a.width),r.width=T/u,r.minWidth||(a.minWidth="unset"),r.alignConstrained=2|r.alignConstrained,l&&(l.overflowX=l.clientWidth>l.scrollWidth)),E&&r.alignConstrained){e.align=E;const t=r.lastAlignSpec.result=Rectangle.from(i,d?s:null,!0).alignTo(e);w=t.anchor,R=t.x,x=t.y,T=t.width,M=t.height}if(r.centered||r.setXY(R,x),!S.overlap&&isFinite(S.zone)&&o.add(alignedClass[S.zone]),null==w?void 0:w.edge){const{edge:e}=w,{anchorElement:t}=r,n=Rectangle.from(i),s=[];"top"===e||"bottom"===e?(s[0]=w.x,s[1]="top"===e?1:n.height-1):(s[0]="left"===e?1:n.width-1,s[1]=w.y);let a=DomHelper.childFromPoint(i,...s);if((null==a?void 0:a.matches(":hover,:focus"))&&i.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(a=a.parentNode),a&&a!==document){let e=DomHelper.getStyleValue(a,"background-color");for(;e.match(isTransparent)&&"absolute"!==DomHelper.getStyleValue(a,"position")&&(a=a.parentNode,a!==document);)e=DomHelper.getStyleValue(a,"background-color");e.match(isTransparent)?r.anchorPathElement.setAttribute("fill",r.defaultAnchorBackgroundColor):r.anchorPathElement.setAttribute("fill",e)}t.classList.remove("b-hide-display"),t.style.transform="",t.className="b-anchor b-anchor-"+e,w.x&&(w.x/=u),w.y&&(w.y/=u),DomHelper.setTranslateXY(t,w.x,w.y),o.add("b-anchored")}else r._anchorElement&&(r.anchorElement.classList.add("b-hide-display"),o.remove("b-anchored"));if(!y){a.pointerEvents="none";const e=DomHelper.elementFromPoint(R,x);r.owns(e)||(r.lastAlignSpec.anchoredTo=e),a.pointerEvents=""}if(("realign"===r.scrollAction&&y||"hide"===r.scrollAction)&&!r.documentScrollListener){if(r.clearTimeout(r.scrollListenerTimeout),e.monitorTargetMutation&&!r.targetObserver){(r.targetObserver||(r.targetObserver=new MutationObserver(r.onTargetParentMutation.bind(r)))).observe(DomHelper.getRootElement(p),{childList:!0,attributes:!0,subtree:!0})}r.scrollListenerTimeout=r.setTimeout((()=>{var e,t;const n=null==(t=(e=y?p:r.lastAlignSpec.anchoredTo).getRootNode)?void 0:t.call(e);r.documentScrollListener=EventHelper.addListener(document,"scroll","doHideOrRealign",{capture:!0,thisObj:r}),(null==n?void 0:n.mode)&&(r.targetRootScrollListener=EventHelper.addListener(n,"scroll","doHideOrRealign",{capture:!0,thisObj:r}))}),"hide"===r.scrollAction?r.ignoreScrollDuration:0)}if(y&&(e.monitorResize&&!r.targetResizeListener&&(ResizeMonitor.addResizeListener(p,r.onTargetResize),r.targetResizeListener=!0),e.monitorIntersection&&!(P||p.contains(i)||p.ownerSVGElement)&&r.intersectionObserver.observe(p)),!BrowserHelper.isAndroid&&!r.constrainListeners){const e=(null==c?void 0:c.isRectangle)?globalThis:c;r.clearTimeout(r.resizeListenerTimeout),r.resizeListenerTimeout=r.setTimeout((()=>{r.constrainListeners=!0,ResizeMonitor.addResizeListener(e||globalThis,r.onAlignConstraintChange)}),r.ignoreScrollDuration)}}onTargetParentMutation(e){var t;const{element:r,lastAlignSpec:n}=this;(null==n?void 0:n.aligningToElement)&&((null==(t=n.target)?void 0:t.isConnected)?e.some((({target:e})=>e.contains(n.target)&&!r.contains(e)))&&this.realign():this.hide())}get intersectionObserver(){return this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.onTargetIntersectionchange.bind(this),{root:BrowserHelper.isSafari?this.rootElement:this.rootElement.ownerDocument}))}onTargetIntersectionchange(e){if(!this.isDestroyed){const t=e[e.length-1];t.isIntersecting||this.onAlignTargetOutOfView(t.target)}}onTargetResize(){const{lastAlignSpec:e}=this;if(e){const{width:t,height:r}=e.targetRect,{width:n,height:i}=e.target.getBoundingClientRect();n===t&&i===r||this.onAlignConstraintChange(...arguments)}}onAlignTargetOutOfView(e){this.hide(),this.lastAlignSpec&&(this.lastAlignSpec.targetOutOfView=!0)}onAlignConstraintChange(e,t,{height:r}){const{style:n}=this.contentElement,{overflowY:i}=n;this.setTimeout(this.realign,50),t&&r>t.height&&(n.overflowY="hidden",this.requestAnimationFrame((()=>n.overflowY=i)))}realign(){const e=this,{lastAlignSpec:t}=e;if((e.floating||e.positioned)&&t&&e.isVisible){if(t.aligningToElement){const r=t.target.contains(this.element),n=DomHelper.isInView(t.target,!1,e);if(!(t.allowTargetOut||hasLayout(t.target)&&n))return e.hide(),void(e.isDestroyed||(e.lastAlignSpec.targetOutOfView=!0));t.realignTarget=r?null:n}DomHelper.addTemporaryClass(e.element,"b-realigning",e.realignTimeout,e),e.alignTo(t)}}rectangle(e,t,r){return this.rectangleOf("element",e,t,r)}rectangleOf(e,t,r,n){return"string"!=typeof t?(n=r,r=t,t=""):"border"===t&&(t=""),"boolean"==typeof r&&(n=r,r=void 0),"element"!==e&&void 0===r&&(r=this.element),r=(null==r?void 0:r.isWidget)?r.element:r,Rectangle[t||"from"](this[e],r,n)}releaseSizeConstraints(){const e=this,{scrollable:t}=e,{style:r}=e.element;1&e.alignConstrained&&(e.height=e.configuredHeight,r.minHeight=e._minHeight||"",t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,r.minWidth=e._minWidth||"",t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){const{element:e}=this,t=this.floating?this.floatRoot:this.positioned?null==e?void 0:e.parentNode:null;if(null==e?void 0:e.nextSibling){const r=this._toFrontRange||(this._toFrontRange=document.createRange());r.setStartBefore(e.nextSibling),r.setEndAfter(t.lastElementChild),t.insertBefore(r.extractContents(),e)}}updateRef(e){this.element.dataset.ref=e}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}changeAlign(e){return"string"==typeof e?{align:e}:e}changeScrollable(e,t){return"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),e?(e.element=this.overflowElement,e.widget=this,e.isScroller||(e=t?t.setConfig(e):new this.scrollerClass(e)),e.syncOverflowState()):null==t||t.destroy(),e}handleReactElement(e){const t=this.closest((e=>e.reactComponent));(null==t?void 0:t.reactComponent)&&t.reactComponent.processWidgetContent({reactElement:e,widget:this,reactComponent:t.reactComponent})}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}updateHtml(e){const t=this,r=null==e,{element:n,contentElement:i,htmlCls:s}=t;if(n||!DomHelper.isReactElement(e)){if(n){t.updatingHtml=!0;const a=i===n&&t._anchorElement;s&&s.values.forEach((e=>n.classList[r?"remove":"add"](e))),a&&n.removeChild(a),e&&"object"==typeof e?DomHelper.isReactElement(e)?t.handleReactElement(e):DomSync.sync({domConfig:{...e,onlyChildren:!0},targetElement:t.contentElement}):t.contentElement.innerHTML=r?"":e,t.getConfig("htmlMutationObserver"),a&&n.appendChild(a),t.isComposable?t.recompose():(t.floating||t.positioned)&&(t.isAligning||t.realign())}}else t.whenVisible((()=>t.handleReactElement(e)))}changeHtmlMutationObserver(e,t){const r=this,{contentElement:n}=r;if(null==t||t.disconnect(),e){const t=new MutationObserver((()=>{r.updatingHtml?r.updatingHtml=!1:r._html=n.innerHTML}));return t.observe(n,e),t}}updateContent(e){const t=this,r=null==e,{element:n,htmlCls:i}=t;if(n){const{contentRange:s}=t;i&&i.values.forEach((e=>n.classList[r?"remove":"add"](e))),n.isConnected?(s.deleteContents(),r||s.insertNode(DomHelper.createElementFromTemplate(e,{fragment:!0}))):t.contentElement.innerHTML=e,t.contentRangeStartOffset=s.startOffset,t.contentRangeEndOffset=s.endOffset,!t.floating&&!t.positioned||t.isAligning||t.realign()}}onThemeChange(){var e;(null==(e=this.anchorElement)?void 0:e.offsetParent)&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const r=parseFloat(DomHelper.getStyleValue(e.element,"border-top-width")),n=DomHelper.getStyleValue(e.element,"border-top-color"),i=e.anchorElement,{className:s}=i,a=i.firstElementChild,o=e.anchorPathElement=a.lastElementChild,l=e._hidden;i.className="b-anchor b-anchor-top";let c=DomHelper.getStyleValue(e.contentElement,"background-color");c.match(isTransparent)&&(c=DomHelper.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=c,t=i.getBoundingClientRect();const[d,u]=t=e._anchorSize=[t.width,t.height];i.className=s,a.setAttribute("height",u+r),a.setAttribute("width",d),o.setAttribute("d","M0,"+u+"L"+d/2+",0.5L"+d+","+u),r&&(o.setAttribute("stroke-width",r),o.setAttribute("stroke",n)),t[1]-=r,l&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=GlobalEvents_default.ion({theme:"onThemeChange",thisObj:e})),e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}return t}get anchorElement(){const e=this;if(!e._anchorElement){const t=e.floating,r="";e._anchorElement=DomHelper.createElement({parent:e.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[t?{tag:"defs",children:[{tag:"filter",id:r,children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:1,"flood-opacity":.2}]}]}:null,{tag:"path",[t?"filter":""]:"url(#"+r+")"}]}]})}return e._anchorElement}updateAnchor(e){this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}updateDraggable(e){var t,r,n;const i=this,{element:s}=i;e?(i.dragEventDetacher=EventHelper.addListener({element:s,dragstart:"onWidgetDragStart",dragend:"onWidgetDragEnd",thisObj:i}),i.dragDetacher=EventHelper.on({element:s,mousedown(e){const{target:t}=e,r=Widget.fromElement(t);(!e.target.closest(".b-field-inner")&&r===this||this.strips&&Object.values(this.strips).includes(r))&&s.setAttribute("draggable","true")},thisObj:i})):(null==(t=i.dragEventDetacher)||t.call(i),null==(r=i.dragOverEventDetacher)||r.call(i),null==(n=i.dragDetacher)||n.call(i))}onWidgetDragStart(e){var t;const r=this;if(!r.validateDragStartEvent(e))return;const{element:n,align:i,constrainTo:s}=r,a=r.positioned&&"fixed"!==DomHelper.getStyleValue(n,"position"),o=a?n.parentElement:r.rootElement,l=Rectangle.from(n,a?o:null),c=e.clientX,d=e.clientY,u=document.scrollingElement||document.body,[h,g]=a?DomHelper.getOffsetXY(n,o):r.getXY(),p=null==(t=a?Rectangle.content(o).moveTo(0,0):s&&((null==s?void 0:s.isRectangle)?s:Rectangle.from(s)))?void 0:t.deflate(i.constrainPadding||0),m={element:o,dragover:e=>{n.classList.remove("b-centered"),l.moveTo(h+e.clientX-c-(a?0:u.scrollLeft),g+e.clientY-d-(a?0:u.scrollTop)),p&&l.constrainTo(p),DomHelper.setTranslateXY(n,l.x,l.y)}};BrowserHelper.isTouchDevice&&(m.touchmove=e=>e.preventDefault()),r.floatRoot.appendChild(r.dragGhost),r.setDragImage(e),e.dataTransfer.effectAllowed="none",r.dragOverEventDetacher=EventHelper.addListener(m),r.alignTo()}validateDragStartEvent(e){var t;const{element:r}=this,n=DomHelper.elementFromPoint(e.clientX,e.clientY),{handleSelector:i}=this.draggable;if(i){const s=null==(t=negationPseudo.exec(i))?void 0:t[1];if(s){if(n.closest("#"+r.id+" "+s))return e.preventDefault(),!1}else if(!n.closest("#"+r.id+" "+i))return e.preventDefault(),!1}return!0}setDragImage(e){e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(this.dragGhost,-9999,-9999))}setStyle(e,t){return DomHelper.applyStyle(this.element,ObjectHelper.isObject(e)?e:{[e]:t}),this}onWidgetDragEnd(){this.dragGhost.remove(),this.dragOverEventDetacher(),this.element.removeAttribute("draggable")}changeFloating(e){return Boolean(e)}changePositioned(e){return Boolean(e)}updatePositioned(e){this.element.classList[e?"add":"remove"]("b-positioned")}getXY(){return[DomHelper.getPageX(this.element),DomHelper.getPageY(this.element)]}setXY(e,t){const r=this,{element:n}=r;if(r.floating||r.positioned){if(null!=e&&(r._x=e),null!=t&&(r._y=t),"fixed"===DomHelper.getStyleValue(n,"position")){const r=n.getBoundingClientRect(),[i,s]=DomHelper.getTranslateXY(n),a=e-r.x,o=t-r.y;DomHelper.setTranslateXY(n,i+a,s+o)}else DomHelper.setTranslateXY(n,r._x||0,r._y||0);r.isConstructing?r.centered=!1:n.classList.remove("b-centered")}}get x(){return this.getXY()[0]}changeX(e){this.setXY(e)}get y(){return this.getXY()[1]}changeY(e){this.setXY(null,e)}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}changeWidth(e){const t=this;DomHelper.setLength(t.element,"width",e),t._lastWidth=e,t._width=null,t._flex=null,t.element.style.flex=""}clearWidthCache(){this._width=null}get maxWidth(){return DomHelper.measureSize(this.element.style.maxWidth,this.element)}updateMaxWidth(e){DomHelper.setLength(this.element,"maxWidth",e)}get minWidth(){return DomHelper.measureSize(this.element.style.minWidth,this.element)}updateMinWidth(e){DomHelper.setLength(this.element,"minWidth",e)}updateFlex(e){this.getConfig("width"),"number"!=typeof e&&isNaN(e)||(e=e+" "+e),this.element.style.flex=e,this.element.style.width=""}updateAlignSelf(e){this.element.style.alignSelf=e}updateMargin(e){this.element.style.margin=this.parseTRBL(e).join(" ")}updateTextAlign(e,t){t&&this.element.classList.remove("b-text-align-"+t),this.element.classList.add("b-text-align-"+e)}updatePlaceholder(e){this.input&&(null==e?this.input.removeAttribute("placeholder"):this.input.placeholder=e)}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}changeHeight(e){DomHelper.setLength(this.element,"height",e),this._lastHeight=e,this._height=null}get maxHeight(){return DomHelper.measureSize(this.maxHeightElement.style.maxHeight,this.element)}updateMaxHeight(e){DomHelper.setLength(this.maxHeightElement,"maxHeight",e)}get minHeight(){return DomHelper.measureSize(this.element.style.minHeight,this.element)}updateMinHeight(e){DomHelper.setLength(this.element,"minHeight",e)}updateDisabled(e=!1){const{element:t,focusElement:r,ariaElement:n}=this;this.trigger("beforeUpdateDisabled",{disabled:e}),e&&(this.revertFocus(),this._disabled!==e)||(t&&(t.classList[e?"add":"remove"]("b-disabled"),r&&(r.disabled=e),n&&n.setAttribute("aria-disabled",e)),this.onDisabled(e))}onDisabled(e){}disable(){this.disabled=!0}enable(){this.disabled=!1}requestFullscreen(){const e=this,t=Fullscreen.request(e.floating?e.floatRoot:e.element);return Fullscreen.onFullscreenChange(e.onFullscreenChange),e.element.classList.add("b-fullscreen"),t}exitFullscreen(){return Fullscreen.exit()}onFullscreenChange(){Fullscreen.isFullscreen||this.onExitFullscreen()}onExitFullscreen(){Fullscreen.unFullscreenChange(this.onFullscreenChange),this.element.classList.remove("b-fullscreen")}get tooltip(){var e;if(this._tooltip)return this._tooltip;{const t=null==(e=Widget.Tooltip)?void 0:e.getSharedTooltip(this.rootElement);if(t&&t.activeTarget===this._element&&t.isVisible)return t}}changeTooltip(e,t){var r;const n=this,{element:i}=n;if(e){if(!n.preventTooltipOnTouch||!BrowserHelper.isTouchDevice){if(e.isTooltip||"Object"===e.constructor.name||(e={html:"string"==typeof e?e:n.placeholder,textContent:!0}),n.configureAriaDescription||(n.ariaDescription=(null==(r=e.html)?void 0:r.match(localizeRE))?e.html.replace(localizeRE,localizeTooltip):e.html),!(null==t?void 0:t.isTooltip)&&!e.newInstance)return i.dataset.btip=!0,void(n.tipConfig=e);e.type="tooltip",e.forElement||(e.forElement=i),"showOnHover"in e||e.forSelector||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),e=Widget.reconfigure(t,e,n),n.detachListeners("tooltipValueListener"),n.configureAriaDescription||e.ion({name:"tooltipValueListener",innerHtmlUpdate:"onTooltipValueChange",thisObj:n})}}else if(t){if(null!=e||!t.isTooltip)return void(t.html=null);t.destroy()}else delete i.dataset.btip;return e}onTooltipValueChange({value:e,source:t}){this.ariaDescription="string"==typeof e?e:t.contentElement.innerText}get tooltipText(){const e=this._tooltip;return e?e.isTooltip?e.contentElement.innerText:"string"==typeof e?e:e.html:this.tipConfig?this.tipConfig.html:void 0}get isVisible(){const e=this,{element:t}=e;let r;return Boolean(t&&!e._hidden&&!e.isDestroying&&t.isConnected&&(!e.requireSize||hasLayout(t))&&(!(r=e.containingWidget)||r.isVisible))}whenVisible(e,t=this,r,n=e){const i=this;i.isVisible&&i.isPainted?i.callback(e,t,r):(i.toCallWhenVisible||(i.toCallWhenVisible=new Map)).set(n,{callback:e,thisObj:t,args:r})}focus(){this.isFocusable&&DomHelper.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=!this.isDestroying&&this.isVisible&&!this.disabled&&this.focusElement;return e&&(e===document.body||e.offsetParent)}async show({align:e,animate:t=!0}={}){const r=this,{element:n,floating:i}=r,{style:s}=n,a=t&&r.showAnimation;let o,l,c=!r.isVisible;return c&&(c=r.trigger("beforeShow"),ObjectHelper.isPromise(c)&&(c=await c)),!1===c||r.internalBeforeShow&&!1===r.internalBeforeShow()?Promise.resolve():new Promise((t=>{if(r.cancelHideShowAnimation(),r.updateCentered(r._centered),i){const e=r.floatRoot;e.contains(n)||(r.rendered?e.appendChild(r.element):r.render(e,!1)),s.transform.includes("scale")&&(r.scale=null,s.transform=s.transformOrigin="");const t=r.closest(isScaled);if(t){const{scale:e}=t;r.scale=e,s.transform="scale("+e+")",s.transformOrigin="0 0"}}if(r._hidden=!1,n.classList.remove("b-hidden"),i&&!isVisible(n)&&(r.hide(!1),t()),r.onConfigChange({name:"hidden",value:!1,was:!0,config:r.$meta.configs.hidden}),a){o=Object.keys(a)[0],l=a[o];const e=r.currentAnimation={showing:!0,styleProp:o,resolve:t};r.isAnimating=!0,s.transition="none",s[o]=l.from,DomHelper.getStyleValue(n,o),r.currentAnimation.detacher=EventHelper.onTransitionEnd({element:n,property:o,duration:parseDuration(l.duration)+20,handler:()=>r.afterHideShowAnimate(e),thisObj:r}),s.transition=o+" "+l.duration+" ease "+l.delay,s[o]=l.to}r.afterShow(e,a?null:t)}))}async showBy(e,t,r){const n=this,i=Array.isArray(e);if(i||"number"==typeof e){const n=i?e:[e,t];e=Object.assign({target:new Point(n[0]+1,n[1]+1),matchSize:!1,align:"t0-b0"},i?t:r)}if(n.requireSize=!0,!n.isVisible)return n.show({align:e});DomHelper.addTemporaryClass(n.element,"b-realigning",300,n),n.alignTo(e)}async showByPoint(){return VersionHelper.deprecate("Core","6.0.0","Widget.showByPoint() replaced by Widget.showBy() with the same signature"),this.showBy(...arguments)}afterShow(e,t){var r,n;const i=this;i.trigger("show"),i._configuredAnchorState=i.anchor,null==(n=null==(r=i.owner)?void 0:r.onChildShow)||n.call(r,i),i.triggerPaint(),(i.floating||i.positioned)&&(e?i.alignTo(e):i.centered?i.alignTo({target:i.constrainTo,align:"c-c"}):i.forElement&&i.alignTo(i.forElement)),null==t||t()}onChildHide(e){e.floating&&this.ariaElement.removeAttribute("aria-owns")}onChildShow(e){e.floating&&(this.ariaHasPopup=e.role,this.ariaElement.setAttribute("aria-owns",e.id))}triggerPaint(){const e=this,{element:t,toCallWhenVisible:r}=e,n=!e.isPainted;if(e.isVisible){if(n&&(e.getConfig("scrollable"),e.scaleToFitWidth&&!e.monitorResize&&(e.onParentElementResize=e.onParentElementResize.bind(e),ResizeMonitor.addResizeListener(t.parentElement,e.onParentElementResize),e.updateScale()),!e.hideGanttDomMessage&&(e.isTaskBoardBase||e.isGridBase||e.isCalendar)&&t.insertBefore(new Comment,t.firstChild),e.onConnectedCallback&&globalThis.ResizeObserver&&(e.connectedObserver=new ResizeObserver((()=>{e.isElementConnected&&!t.isConnected?(e.onConnectedCallback(!1),e.isElementConnected=!1):!e.isElementConnected&&t.isConnected&&(e.onConnectedCallback(!0,null==e.isElementConnected),e.isElementConnected=!0)})),e.connectedObserver.observe(t))),e.eachWidget(widgetTriggerPaint,!1),n&&(e.rootElement=DomHelper.getRootElement(t),e.getConfig("tooltip"),!Widget.Ripple&&Widget.RippleClass&&(Widget.Ripple=new Widget.RippleClass({rootElement:e.rootElement})),globalThis.DocsBrowser&&e.floating&&e.closest((e=>{var t;return null==(t=e.element)?void 0:t.closest(".fiddlePanelResult,.b-owned-by-fiddle")}))&&t.classList.add("b-owned-by-fiddle")),e.isPainted=!0,n&&e.triggerConfigs("paint"),e.trigger("paint",{firstPaint:n}),null==r?void 0:r.size){for(const{callback:t,thisObj:n,args:i}of r.values())e.callback(t,n,i);r.clear()}n&&e.monitorResize&&!e.scaleToFitWidth&&ResizeMonitor.onElementResize([{target:t}])}}cancelHideShowAnimation(){const e=this,{currentAnimation:t,element:r}=e;t&&(e.isAnimating=!1,r.classList.contains("b-hiding")&&(r.classList.remove("b-hiding"),e._hidden=!1),t.detacher(),t.resolve(),r.style.transition=r.style[t.styleProp]="",e.currentAnimation=null,e.trigger((t.showing?"show":"hide")+"AnimationEnd"))}afterHideShowAnimate(e){const t=this;e===t.currentAnimation&&(t.element.classList.remove("b-hiding"),t.cancelHideShowAnimation(),t._hidden&&t.afterHideAnimation())}suspendVisibility(){this._visibilitySuspended=(this._visibilitySuspended||0)+1,Object.defineProperty(this,"isVisible",returnFalseProp)}resumeVisibility(e=!0){--this._visibilitySuspended||(delete this.isVisible,e&&this.triggerPaint())}hide(e=!0){return new Promise((t=>{const r=this,{element:n,lastAlignSpec:i}=r,{style:s}=n,a=e&&r.hideAnimation;if(r.clearTimeout(r.scrollListenerTimeout),r.clearTimeout(r.resizeListenerTimeout),!r._hidden&&!1!==r.trigger("beforeHide",{animate:e})){if(r._hidden=!0,i&&(i.targetOutOfView=null,i.monitorIntersection&&(r.intersectionObserver.takeRecords(),r.intersectionObserver.unobserve(i.target))),r.onConfigChange({name:"hidden",value:!0,was:!1,config:r.$meta.configs.hidden}),!n)return void t();if(n.contains(DomHelper.getActiveElement(n))&&r.revertFocus(!0),r.isDestroyed)return void t();if(r.cancelHideShowAnimation(),a){const e=Object.keys(a)[0],i=a[e];if(Number(getComputedStyle(r.element)[e])!==i.to){const a=r.currentAnimation={hiding:!0,styleProp:e,resolve:t};n.classList.add("b-hiding"),r.isAnimating=!0,r.currentAnimation.detacher=EventHelper.onTransitionEnd({element:n,property:e,duration:parseDuration(i.duration)+20,handler:()=>r.afterHideShowAnimate(a),thisObj:r}),s[e]=i.from,DomHelper.getStyleValue(n,e),s.transition=e+" "+i.duration+" ease "+i.delay,s[e]=i.to}else n.classList.add("b-hidden")}else n.classList.add("b-hidden");r.afterHide(!a&&t,a)}}))}doHideOrRealign({target:e,isTrusted:t}){const r=this,{lastAlignSpec:n,element:i}=r,s=null==n?void 0:n.anchoredTo,a=null==n?void 0:n.target,o=null==n?void 0:n.position,l=DomHelper.getActiveElement(r);if(!t||!hasLayout(i)||e&&(i.contains(e)||e.nodeType===Element.ELEMENT_NODE&&r.owns(e)||e.nodeType===Element.DOCUMENT_NODE&&i.contains(l)&&textInputTypes[l]&&globalThis.innerHeight<document.body.offsetHeight))return;if(n.aligningToElement){const e=DomHelper.isInView(a,!1,r);if(e&&e.equals(n.targetRect))return}const c="hide"===r.scrollAction&&r.getXY();if(r.realign(),!r.isDestroyed&&isVisible(i)&&"hide"===r.scrollAction){const[t,i]=r.getXY(),l=t!==c[0]||i!==c[1];((null==n?void 0:n.aligningToEvent)||(l||"Point"===(null==a?void 0:a.$$name)||o)&&(!s||!hasLayout(s)||e&&DomHelper.isDescendant(e,s)))&&r.hide()}}afterHide(e=null,t=this.hideAnimation){var r,n;const i=this;i._anchor=i._configuredAnchorState,i.removeTransientListeners(),t||i.afterHideAnimation(),i.trigger("hide"),null==(n=null==(r=i.owner)?void 0:r.onChildHide)||n.call(r,i),e&&e()}removeTransientListeners(){var e,t,r;const n=this,{targetObserver:i,lastAlignSpec:s}=n;if(n.clearTimeout(n.resizeListenerTimeout),n.clearTimeout(n.scrollListenerTimeout),i&&(i.disconnect(),delete n.targetObserver),n.documentScrollListener=null==(e=n.documentScrollListener)?void 0:e.call(n),n.targetRootScrollListener=null==(t=n.targetRootScrollListener)?void 0:t.call(n),n.targetResizeListener&&(ResizeMonitor.removeResizeListener(s.target,n.onTargetResize),n.targetResizeListener=!1),n.constrainListeners){const e=(null==(r=s.constrainTo)?void 0:r.isRectangle)?globalThis:s.constrainTo;ResizeMonitor.removeResizeListener(e||globalThis,n.onAlignConstraintChange),n.constrainListeners=!1}}afterHideAnimation(){const e=this,{element:t}=e;e.floating&&e.floatRoot.contains(t)?t.remove():t.classList.add("b-hidden"),e.defaultAnchorBackgroundColor&&e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor)}changeHidden(e){const t=this;let r;return t.isConfiguring?(r=Boolean(e),t.element.classList[e?"add":"remove"]("b-hidden")):(t.trigger("beforeChangeHidden",{hidden:e}),e?t.hide():t.show()),r}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||this.containingWidget}get containingWidget(){var e,t;let r=this.parent;if(!r){const n=(null==(e=this.forElement)?void 0:e.nodeType)===Element.ELEMENT_NODE?this.forElement:null==(t=this.element)?void 0:t.parentNode;r=(null==n?void 0:n.closest(".b-widget"))&&Widget.fromElement(n)}return r}get previousSibling(){return this.getSibling(-1)}get nextSibling(){return this.getSibling(1)}getSibling(e){const t=this,{parent:r}=t,n=r?r.childItems:Array.from(t.element.parentElement.querySelectorAll(".b-widget"));return r?n[n.indexOf(t)+e]:Widget.fromElement(n[n.indexOf(t.element)+e])}up(e,t,r){var n;const{owner:i}=this;return e?null==(n=null==i?void 0:i.closest)?void 0:n.call(i,e,t,r):i}closest(e,t,r){const n=typeof r,i="number"===n,s="string"===n;for(let n=this,a=1;n;n=n.owner,a++){if(Widget.widgetMatches(n,e,t))return n;if(i&&a>=r)return;if(s&&Widget.widgetMatches(n,r,t))return;if(n===r)return}}owns(e){if(e){if("eventPhase"in e&&(e=e.target),e.nodeType===Element.ELEMENT_NODE){if(this.element.contains(e))return!0;e=Widget.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}}return!1}eachAncestor(e){let t=this.owner;for(;t;){if(!1===e(t))return!1;t=t.owner}return!0}changeMonitorResize(e,t){const r=!this.scaleToFitWidth&&Boolean(e);if(r!==Boolean(t))return r}updateMonitorResize(e){const t=this;hasOwnProperty6.call(t,"onElementResize")||(t.onElementResize=t.onElementResize.bind(t)),ResizeMonitor[e?"addResizeListener":"removeResizeListener"](t.element,t.onElementResize)}changeReadOnly(e){if(e=Boolean(e),Boolean(this._readOnly)!==e)return e}updateReadOnly(e){var t;null==(t=this.element)||t.classList[e?"add":"remove"]("b-readonly"),this.isConfiguring||(this.eachWidget((t=>{t.ignoreParentReadOnly||("_originalReadOnly"in t||(t._originalReadOnly=t.config.readOnly||!1),t.readOnly=e||t._originalReadOnly)}),!1),this.trigger("readOnly",{readOnly:e}))}eachWidget(e,t=!0){const r=this.childItems,n=(null==r?void 0:r.length)||0,i={};for(let s=0;s<n;s++){const n=r[s];if(i.down=t,!1===e(n,i))return!1;if(i.down&&n.eachWidget&&!1===n.eachWidget(e,t))return!1}return!0}queryAll(e){const t=[];return this.eachWidget((r=>{e(r)&&t.push(r)})),t}query(e){let t=null;return this.eachWidget((r=>{if(e(r))return t=r,!1})),t}getWidgetByRef(e){var t,r;return e instanceof Widget?e:(null==(t=null==this?void 0:this.widgetMap)?void 0:t[e])||(null==(r=null==this?void 0:this.owner)?void 0:r.getWidgetByRef(e))}onFocusIn(e){const t=this,{element:r}=t;t.containsFocus=!0,t.focusInEvent=e,(t.floating||t.positioned)&&t.toFront(),r.classList.add("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),r.contains(e._target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=EventHelper.on({element:r,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(e.relatedTarget||t.revertFocus(!t.isVisible),t.containsFocus=!1,t.element.classList.remove("b-contains-focus"),t.updateAriaLabel(t.localizeProperty("ariaLabel")),t.updateAriaDescription(t.localizeProperty("ariaDescription")),t.trigger("focusout",e))}captureFocus(){const e=this,t=DomHelper.getActiveElement(e),r=e.contains(t)&&e.captureFocusItem(t);return(n,i)=>{if(r&&!e.isDestroying){(DomHelper.getActiveElement(e)!==t||i)&&r(n)}}}captureFocusItem(e){return(t=!0)=>{this.contains(e)&&(t?e.focus():DomHelper.focusWithoutScrolling(e))}}contains(e,t){const{element:r}=this;if(e&&r)return e.isWidget&&(e=e.element),r.contains(e)&&(!t||r!==e)}revertFocus(e){var t;const r=this,n=DomHelper.getActiveElement(r);let i=null==(t=r.focusInEvent)?void 0:t.relatedTarget;(e||r.containsFocus&&(null==i?void 0:i.nodeType)===Element.ELEMENT_NODE&&r.element.contains(n))&&(i&&DomHelper.isFocusable(i)||(i=r.getFocusRevertTarget()),r._isRevertingFocus=!0,i&&DomHelper.isFocusable(i)?(i._isRevertingFocus=!0,DomHelper.focusWithoutScrolling(i),i._isRevertingFocus=!1):null==n||n.blur(),r._isRevertingFocus=!1)}getFocusRevertTarget(){var e;const t=this,{owner:r,focusInEvent:n}=t,i=n&&n.backwards?1:-1;let s=n&&n.relatedTarget;const a=s&&Widget.fromElement(s);if(r&&!r.isDestroyed&&(!s||!DomHelper.isFocusable(s)||a&&!a.isFocusable)){if(s=null,r.eachWidget){const e=[];if(r.eachWidget((r=>{(r===t||r.isFocusable)&&e.push(r)}),!1),e.length>1){const r=e.indexOf(t);s=e[r+i]||e[r-i]}}!s&&r.isFocusable&&(s=r),s=s?s.focusElement:null==(e=r.getFocusRevertTarget)?void 0:e.call(r)}return s}getStaticWidgetClasses(e,t){const r=new DomClassList,n=this.$meta.hierarchy;let i,s,a,o,l;for(s=n.indexOf(e);s<n.length;++s)i=n[s],l=Reflect.getOwnPropertyDescriptor(i.prototype,"widgetClass"),(null==l?void 0:l.get)?o=l.get.call(this):(a=hasOwnProperty6.call(i,"$$name")||hasOwnProperty6.call(i,"$name")||hasOwnProperty6.call(i,"_$name")?i.$$name:i.name,(a.length<3||a.includes("$"))&&console.warn('Class "'+a+'" extending "'+i.$name+'" should have "$name" static getter with no less than 3 chars.'),o="b-"+a.toLowerCase()),o&&r.add(t?o+t:o);return r}get rootUiClass(){return Widget}get staticClassList(){const{$meta:e}=this;let t=e.staticClassList;return t||(e.staticClassList=t=this.getStaticWidgetClasses(Widget),BrowserHelper.isTouchDevice&&t.add("b-touch")),t}get uiClasses(){return this.getConfig("ui"),this._uiClasses}get uiClassList(){return this.getConfig("ui"),this._uiClassList}get widgetClassList(){const e=this,{cls:t,defaultCls:r,uiClasses:n}=e;let{staticClassList:i}=e;(r||t)&&(i=i.clone(),r&&i.assign(r),t&&i.assign(t));const s=i.values;return n&&s.push(...n),e.floating&&s.push("b-floating"),"hide"===e.collapsify&&s.push("b-collapsify-hide"),s}changeCls(e){return DomClassList.from(e)}updateCls(e,t){if(!this.isConfiguring&&!this.isComposable){const{element:r}=this;t&&ObjectHelper.getTruthyKeys(t).forEach((e=>r.classList.remove(e))),e.assignTo(r)}}changeContentElementCls(e){return DomClassList.from(e)}changeHtmlCls(e){return DomClassList.from(e)}changeDefaultCls(e){return DomClassList.from(e,!0)}changeUi(e){return DomClassList.from(e)}updateUi(e){let t,r,n=null;if(e){const i=this.getStaticWidgetClasses(this.rootUiClass);for(r in e)if(e[r])for(t in i)i[t]&&((n||(n=new DomClassList))[t+"-ui-"+r]=1)}this._uiClasses=null==n?void 0:n.values,this._uiClassList=n}fromCache(e,t=!1,r=this.element){if(!r)return null;const n=this;return n.cache[e]||(n.cache[e]=t?DomHelper.children(r,e):DomHelper.down(r,e)),n.cache[e]}emptyCache(){this.cache={}}changeMasked(e,t){var r;if("trial"!==(null==(r=this.masked)?void 0:r.type)){if(!0!==e&&""!==e||(e=" "),t&&!t.isDestroyed)"string"==typeof e?(t.text=e,e=t):e?(t.setConfig(e),e=t):t.destroy();else if(e){const t=Widget.resolveType("mask");(e=t.mergeConfigs(this.maskDefaults,e)).owner=this,e=t.mask(e)}return e||null}}onMaskAutoClose(e){e.isDestroyed&&e===this.masked&&(this.masked=null)}mask(e){return this.masked=e,this.masked}unmask(){this.masked=null}onInternalResize(e,t,r,n,i){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e,t){const r=this,{element:n}=r,i=r._width,s=r._height,a=n.offsetWidth,o=n.offsetHeight;r.floating&&t&&r.onFloatingWidgetResize(...arguments),r.suspendResizeMonitor||i===a&&s===o||(r.onInternalResize(n,a,o,i,s),r.trigger("resize",{width:a,height:o,oldWidth:i,oldHeight:s}))}onFloatingWidgetResize(e,t,r){const n=this,{lastAlignSpec:i,constrainTo:s}=n;if(n.isVisible&&i&&i.target){const e=!t||r.height!==t.height,a=!t||r.width!==t.width,o=s&&!Rectangle.from(s).contains(Rectangle.from(n.element,null,!0));(e&&2!==i.zone||a&&1!==i.zone||o)&&n.requestAnimationFrame((()=>n.realign()))}}updateScale(){const e=this,t=e.element,r=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),t.style.display="none";const n=Rectangle.client(r).width/e.configuredWidth,i=e.scale=e.allowGrowWidth?Math.min(n,1):n;t.style.transform="scale("+i+")",t.style.transformOrigin="top left",t.style.display="",e.allowGrowWidth&&n>1&&(e.width=e.configuredWidth*n)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[""+e+t,""+e+t,""+e+t,""+e+t];const r=e.split(" "),n=r.length;return 1===n?r[1]=r[2]=r[3]=r[0]:2===n?(r[2]=r[0],r[3]=r[1]):3===n&&(r[3]=r[1]),[isFinite(r[0])?""+r[0]+t:r[0],isFinite(r[1])?""+r[1]+t:r[2],isFinite(r[2])?""+r[2]+t:r[3],isFinite(r[3])?""+r[3]+t:r[4]]}get documentRoot(){var e;return(null==(e=this.owner)?void 0:e.documentRoot)||this.element.getRootNode()}get rootElement(){var e;const t=this;if(!t._rootElement){let r=(null==(e=t.owner)?void 0:e.rootElement)||DomHelper.getRootElement(t.forElement||(t.element.isConnected?t.element:t.getRenderContext()[0]||t.element));r||(r=document.body),t._rootElement=r}return t._rootElement}get floatRoot(){var e,t;const r=this.rootElement||(null==(e=this.owner)?void 0:e.rootElement);let{floatRoot:n}=r;if(n)r.contains(n)||r.appendChild(n);else{const{outerCls:e}=Widget,i=null==(t=DomHelper.getThemeInfo(null,r))?void 0:t.name;if(!DomHelper.isValidFloatRootParent(r))throw new Error("Attaching float root to wrong root");i&&e.push("b-theme-"+i.toLowerCase()),n=r.floatRoot=DomHelper.createElement({className:"b-float-root "+e.join(" "),parent:r}),floatRoots.push(n),BrowserHelper.isAndroid&&(n.style.height=screen.height+"px",EventHelper.on({element:globalThis,orientationchange:()=>n.style.height=screen.height+"px",thisObj:this})),!BrowserHelper.isHoverableDevice&&globalThis.visualViewport&&EventHelper.on({element:globalThis.visualViewport,resize:({target:e})=>n.style.height=e.height+"px",thisObj:this}),GlobalEvents_default.ion({theme:({theme:e,prev:t})=>{n.classList.add("b-theme-"+e.toLowerCase()),n.classList.remove("b-theme-"+t.toLowerCase())}})}return n}get floatRootMaxZIndex(){let e=1;return Array.from(this.floatRoot.children).forEach((t=>{const r=parseInt(getComputedStyle(t).zIndex||0,10);r>e&&(e=r)})),e}static resetFloatRootScroll(){floatRoots.forEach((e=>e.scrollTop=e.scrollLeft=0))}static get floatRoots(){return floatRoots}static removeFloatRoot(e){floatRoots.splice(floatRoots.indexOf(e),1)}static get outerCls(){const e=["b-outer"],{platform:t}=BrowserHelper;return t&&e.push("b-"+t),BrowserHelper.isTouchDevice&&e.push("b-touch-events"),DomHelper.scrollBarWidth?e.push("b-visible-scrollbar"):e.push("b-overlay-scrollbar"),BrowserHelper.isChrome?e.push("b-chrome"):BrowserHelper.isSafari?e.push("b-safari"):BrowserHelper.isFirefox&&e.push("b-firefox"),globalThis.ResizeObserver||e.push("b-no-resizeobserver"),e}get isAnimating(){return this._isAnimatingCounter>0}set isAnimating(e){const t=this,{_isAnimatingCounter:r}=t;t._isAnimatingCounter=Math.max(0,r+(e?1:-1)),0===r&&e?(t.element.classList.add("b-animating"),t.trigger("animationStart")):1!==r||e||(t.element.classList.remove("b-animating"),t.trigger("animationEnd"))}async waitForAnimations(){this.isAnimating&&await this.await("animationend",{checkLog:!1})}static query(e,t=!1){const{idMap:r}=Widget.identifiable;for(const n in r)if(Widget.widgetMatches(r[n],e,t))return r[n];return null}static queryAll(e,t=!1){const{idMap:r}=Widget.identifiable,n=[];for(const i in r)Widget.widgetMatches(r[i],e,t)&&n.push(r[i]);return n}static fromElement(e,t,r){const n=typeof t;e&&!e.nodeType&&(e=e.target),("number"===n||t&&t.nodeType===Element.ELEMENT_NODE)&&(r=t,t=null);let i,s,a,o=e,l=0;for("number"!=typeof r&&(i=r,r=Number.MAX_VALUE),"string"===n&&(t=t.toLowerCase());o&&o.nodeType===Element.ELEMENT_NODE&&l<r&&o!==i;){if(s=o.dataset&&o.dataset.ownerCmp||o.id,s){if(a=Widget.getById(s),a){if(!t)return a;if("function"===n){if(t(a))return a}else if(Widget.widgetMatches(a,t,!0))return a}l++}o=o.parentNode}return null}static fromSelector(e){const t=document.querySelector(e);return t?Widget.fromElement(t):null}triggerFieldChange(e,t=!0){t&&this.trigger("change",e),this.eachAncestor((t=>{var r,n;if(null==(r=t.onFieldChange)||r.call(t,e),null==(n=t.isolateFieldChange)?void 0:n.call(t,this))return!1}))}isolateFieldChange(e){return this.isolateFields}setupFocusListeners(){GlobalEvents_default.setupFocusListenersOnce(this._rootElement,EventHelper)}static widgetMatches(e,t,r){return"*"===t||("function"==typeof t?t(e):Widget.isType(e,t,r))}static attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),Widget.create(Object.assign({forElement:e},t),"tooltip"),e}changeDock(e){return"start"===e?"left":"end"===e?"right":e}updateRtl(e){super.updateRtl(e),this.eachWidget((t=>{"rtl"in t.initialConfig||(t.rtl=e)}))}},proto2=Widget.prototype;["compose","domSyncCallback"].forEach((e=>proto2[e].$nullFn=!0)),Widget.initClass(),Widget.register("mask",Mask),DomHelper.Widget=Widget,GlobalEvents_default.Widget=Widget,Mask.identifiable.idMap=Widget.identifiable.idMap,Object.assign(globalThis.gantt||(globalThis.gantt={}),{get:Widget.getById.bind(Widget),query:Widget.query,queryAll:Widget.queryAll,fromElement:Widget.fromElement,fromSelector:Widget.fromSelector}),Widget._$name="Widget";var Layout=class extends(Base.mixin(Events_default,Factoryable_default)){get contentElement(){var e;return null==(e=this.owner)?void 0:e.contentElement}onChildAdd(e){}onChildRemove(e){}renderChildren(){const e=this,{owner:t,itemCls:r}=e,{contentElement:n,items:i}=t,s=t.itemCls,a=null==i?void 0:i.length;if(a){t.textContent=!1;for(let e=0;e<a;e++){const a=i[e],{element:o}=a,{classList:l}=o;o.dataset.itemIndex=e,l.contains("b-outer")&&l.remove(...Widget.outerCls),r&&l.add(r),s&&l.add(s),a.render(n,Boolean(t.isPainted))}}e.syncPendingConfigs(),e.syncChildCount()}removeChild(e){const t=this,{element:r}=e,{owner:n,itemCls:i}=t,{contentElement:s}=n,a=n.itemCls;s.contains(r)&&r.remove(),delete r.dataset.itemIndex,i&&r.classList.remove(i),a&&r.classList.remove(a),t.fixChildIndices(),t.syncChildCount()}appendChild(e){const{element:t}=e,{owner:r,itemCls:n}=this,{contentElement:i}=r,s=r.itemCls;t.dataset.itemIndex=r.indexOfChild(e),r.textContent=!1,n&&t.classList.add(n),s&&t.classList.add(s),e.render(i,Boolean(r.isPainted)),this.syncChildCount()}insertChild(e,t){const r=this,{element:n}=e,{owner:i,itemCls:s}=r,{contentElement:a}=i,o=DomHelper.getChild(a,'[data-item-index="'+t+'"]'),l=i.itemCls;i.textContent=!1,s&&n.classList.add(s),l&&n.classList.add(l),a.insertBefore(n,o),e.render(null,Boolean(i.isPainted)),r.fixChildIndices(),r.syncChildCount()}fixChildIndices(){this.owner.items.forEach(((e,t)=>{e.element.dataset.itemIndex=t}))}syncChildCount(){var e;const{owner:t}=this,{length:r}=t.items;null==(e=t.contentElement)||e.classList[1===r?"add":"remove"]("b-single-child")}syncConfigLater(e){const t=this.pendingConfigs||(this.pendingConfigs=[]);t.includes(e)||t.push(e)}syncConfigStyle({name:e,style:t,classes:r,map:n}){const i=this,s="b-box-"+e+"-",{contentElement:a}=i,o=i[e];let l=(null==n?void 0:n[o])||o;if(a){if(r){const{classList:e}=a;r.forEach((t=>{t!==l&&e.remove(s+t)})),r.includes(l)&&(e.add(s+l),l="")}a.style[t]=l}else i.syncConfigLater(e)}syncPendingConfigs(){const e=this,{pendingConfigs:t}=e;let r;if(t)for(e.pendingConfigs=null;r=t.pop();)e[e.$meta.configs[r].updater](e[r])}};__publicField(Layout,"type","default"),__publicField(Layout,"configurable",{owner:null,containerCls:"b-auto-container",itemCls:null}),__publicField(Layout,"factoryable",{defaultType:"default"}),Layout.initClass(),Layout._$name="Layout";var lastTouchTime=0,hasRipple=e=>e.ripple,Ripple=class extends Widget{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),EventHelper.on({element:this.rootElement,mousedown:"onRippleControllingEvent",thisObj:this,capture:!0,once:!0})}onRippleControllingEvent(e){var t;const r=this;r.show();const n=DomHelper.getStyleValue(r.circleElement,"animationName");r.hide(),null==(t=r.listenerDetacher)||t.call(r),n&&"none"!==n&&(r.listenerDetacher=EventHelper.on({mousedown:{element:r.rootElement,capture:!0,handler:"onMousedown"},touchstart:{element:r.rootElement,capture:!0,handler:"onTouchStart"},animationend:{element:r.circleElement,handler:"onAnimationEnd"},thisObj:r}),"mousedown"===e.type&&(r.onMousedown(e),GlobalEvents_default.ion({theme:"onRippleControllingEvent",thisObj:this})))}onTouchStart(e){lastTouchTime=performance.now(),this.handleTriggerEvent(e)}onMousedown(e){performance.now()-lastTouchTime>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=Widget.fromElement(e.target,hasRipple);if(t){const r=t.ripple,n=r.delegate?e.target.closest(r.delegate):t.focusElement||t.element;if(n){const i=ObjectHelper.assign({event:e,target:n,radius:this.radius},r);if("string"==typeof i.clip&&(i.clip=t[i.clip]||e.target.closest(i.clip),!i.clip))return;this.ripple(i)}}}ripple({event:e,point:t=EventHelper.getClientPoint(e),target:r=e.target,clip:n=r,radius:i=this.radius,color:s=this.color}){this.clip=n;const a=this,o=(n=Rectangle.from(n,null,!0)).getDelta(t),l=a.rippleElement.style,c=a.circleElement,d=DomHelper.getStyleValue(r,"border-radius");a.hide(),l.transform="translateX("+o[0]+"px) translateY("+o[1]+"px)",l.height=l.width=i+"px",a.element.style.borderRadius=d,c.setAttribute("r",i),c.setAttribute("fill",s),a.showBy({target:n,align:"c-c",matchSize:!0})}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}};Widget.RippleClass=Ripple,Ripple._$name="Ripple";var emptyObject6=Object.freeze({}),{isArray:isArray2}=Array,returnWeight=e=>e.weight,sortByWeight=({weight:e},{weight:t})=>"string"==typeof e||"string"==typeof t?String(e).localeCompare(String(t)):(null!=e?e:Number.MAX_SAFE_INTEGER)-(null!=t?t:Number.MAX_SAFE_INTEGER),isNotHidden=e=>e&&!e.hidden,stylesToCheck=["display","flex-direction"],boxLayouts={default:1,box:1},Container=class extends Widget{static get $name(){return"Container"}static get type(){return"container"}static get configurable(){return{items:null,lazyItems:{$config:["lazy"],value:null},defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:{type:"default"},namedItems:null,overflowable:{value:null,default:!1,$config:null},textContent:!0,record:null,strictRecordMapping:null,autoUpdateRecord:null,autoUpdateFields:null,hideWhenEmpty:null,contentElMutationObserver:{$config:["lazy","nullify"],value:!0},isolateFields:!1,focusDescendant:!1,defaultBindProperty:null,defaultFocus:null}}static get prototypeProperties(){return{flexRowCls:"b-flex-row",flexColCls:"b-flex-column",initialItems:!0}}startConfigure(e){const t=e.items||e.lazyItems;(this.hasItems=Boolean(t&&(isArray2(t)?t:Object.keys(t)).length))||(this.initialItems=!1),super.startConfigure(e)}get firstItem(){return this.getAt(0)}get lastItem(){return this.getAt(-1)}getAt(e){return this.ensureItems().at(e)}remove(...e){let t=!0;1===e.length&&(isArray2(e[0])?e=e[0]:t=!1);const r=this,{_items:n}=r,i=[];for(let t=0;t<e.length;t++){const s=e[t];n.includes(s)&&(n.remove(s),r.layout.removeChild(s),i.push(s),r.onChildRemove(s))}return t?i:i[0]}removeAll(){return this.remove(this.items)}add(...e){const t=this,r=t.ensureItems(),n=[];let i,s,a,o=!0;for(1===e.length&&(isArray2(e[0])?e=e[0]:o=!1),s=0;s<e.length;s++)i=e[s],i.isWidget?i.parent=t:i=t.createWidget(i),null!=(null==i?void 0:i.weight)?(a=ArrayHelper.findInsertionIndex(i,r.values,sortByWeight),n.push(t.insert(i,a))):i&&(r.includes(i)||(r.add(i),t.onChildAdd(i),t.layout.appendChild(i),n.push(i)));return o?n:n[0]}ensureItems(){const e=this;return e.getConfig("items"),e.getConfig("lazyItems"),e._items||(e.items=[]),e._items}insert(e,t){const r=this,n=r.ensureItems();e instanceof Widget?e.parent=r:e=r.createWidget(e),n.includes(t)&&(t=r.indexOfChild(t)),t=Math.min(t,n.count);const i=n.values;return i.splice(t,0,e),n.values=i,r.onChildAdd(e),r.layout.insertChild(e,t),e}indexOfChild(e){return this.items.indexOf(e)}changeLazyItems(e){this.items=e,this.layout.renderChildren()}changeItems(e,t){const r=this,n=[],i=new Bag;return isArray2(e)?r.processItemsArray(e,n):e&&r.processItemsObject(e,r.namedItems,n),n.some(returnWeight)&&n.sort(sortByWeight),i.add(n),t&&t.forEach((e=>{r.remove(e),i.includes(e)||e._createdBy!==r||e.destroy()})),i}afterConstruct(){const{rtl:e}=this,{classList:t}=this.contentElement;t.toggle("b-rtl",!0===e),t.toggle("b-ltr",!1===e)}updateRtl(e){super.updateRtl(e);const{contentElement:t}=this;t&&(t.classList.toggle("b-rtl",!0===e),t.classList.toggle("b-ltr",!1===e))}updateItems(e,t){let r=0;e.forEach((e=>{this.onChildAdd(e),t&&!t.temporary&&this.layout.insertChild(e,r),++r})),this.initialItems=!1}updateHideWhenEmpty(){this.syncChildCount(this.rendered)}get items(){const e=this;if(e.getConfig("lazyItems"),!e._items){if(e.initializingItems)return[];e._items=new Bag,e._items.temporary=!0}return e._items.values}processItemsArray(e,t){const r=e.length;let n,i;for(n=0;n<r;n++)i=e[n],i instanceof Widget?(i.parent=this,i.element.classList.remove(...Widget.outerCls)):i=this.createWidget(i),i&&((i.ref||i.id)&&this.addDescendant(i),t.push(i))}processItemsObject(e,t,r){let n,i;for(i in e)n=e[i],n&&(t&&i in t&&(n="object"==typeof n?ObjectHelper.merge(ObjectHelper.clone(t[i]),n):t[i]),n&&(n instanceof Widget?n.parent=this:(n instanceof Object&&(n.ref=i),n=this.createWidget(n)),n&&(n.ref=i,this.addDescendant(n),r.push(n))))}onChildAdd(e){if(e.innerItem&&this.readOnly&&!e.ignoreParentReadOnly&&(e.readOnly=!0),this.onChildAddLayout(e),e.ref||e.id)for(let t=this;t;t=t.parent)t.addDescendant(e);this.syncChildCount(!0)}onChildAddLayout(e){e.innerItem&&this.layout.onChildAdd(e)}onChildHide(e){var t;super.onChildHide(e),(null==(t=this._items)?void 0:t.includes(e))&&this.syncChildCount(!0)}onChildShow(e){var t;super.onChildShow(e),(null==(t=this._items)?void 0:t.includes(e))&&this.syncChildCount(!0)}syncChildCount(e){if(!this.isConfiguring){const t=this,{items:r,hasItems:n}=t,i=r.filter(isNotHidden),{length:s}=i;if(t.visibleChildCount=s,t.hideWhenEmpty&&e){const e=Boolean(!s);Boolean(t._hidden)!==e&&(t.hidden=e)}r.forEach((e=>e.element.classList.remove("b-last-visible-child","b-first-visible-child"))),s&&(i[0].element.classList.add("b-first-visible-child"),i[s-1].element.classList.add("b-last-visible-child")),t.hasItems=Boolean(t.childItems.length),t.contentElement.classList[s?"remove":"add"]("b-no-visible-children"),t.isComposable?n!==t.hasItems&&t.recompose():t.updateTextContent(t._textContent)}}syncFlexDirection(){const{contentElement:e,flexColCls:t,flexRowCls:r}=this,n=new DomClassList(e.className),i=DomHelper.getStyleValue(e,stylesToCheck);n[r]=n[t]=0,"flex"===i.display&&(n["row"===i["flex-direction"]?r:t]=1),DomHelper.syncClassList(e,n)}addDescendant(e){const t=e.ref||e.id,r=this._widgetMap||(this._widgetMap={});r[t]||(r[t]=e)}onChildRemove(e){const t=this,r=e.ref||e.id;if(r)for(let n=t;n;n=n.parent)n.widgetMap[r]===e&&delete n.widgetMap[r];t.layout.onChildRemove(e),t.syncChildCount(!0)}get widgetMap(){return this._widgetMap||(this._widgetMap={}),this.initializingItems||this.getConfig("items"),this._widgetMap}changeRecord(e){return this._record=null==e?emptyObject6:null,e}updateRecord(e){var t;const r=this;null==(t=r.recordUpdateDetacher)||t.call(r),r.trigger("beforeSetRecord",{record:e}),r.setValues(e,{onlyName:r.strictRecordMapping,highlight:Boolean(r.$highlight)}),r.autoUpdateFields&&(null==e?void 0:e.firstStore)&&(r.recordUpdateDetacher=e.firstStore.ion({update:r.onRecordUpdated,thisObj:r}))}setRecord(e,t){this.$highlight=t,this.record=e,this.$highlight=!1}onRecordUpdated({record:e}){e===this.record&&this.setValues(this.record,!0,!0)}onFieldChange({source:e,userAction:t}){if(this.autoUpdateRecord&&t){const{record:t,strictRecordMapping:r}=this,{name:n,ref:i,isValid:s=!0,value:a}=e,o=r?n:n||i;t&&o&&s&&(t[o]=a)}}getValues(e){const t={};return this.eachWidget(((r,n)=>{r.isolateFields?n.down=!1:!("name"in r)||e&&!e(r)||(t[r.name]=r.value)}),!0),t}get values(){const e={};return this.gatherValue(e),e}set values(e){this.assignValue(e)}get isSettingValues(){return Boolean(this.assigningValues)}get assigningValues(){var e;return this._assigningValues||(null==(e=this.parent)?void 0:e.assigningValues)}set assigningValues(e){this._assigningValues=e}assignValue(e,t){super.assignValue(e,t),this.isolateFields||this.setValues(e,t)}gatherValue(e){super.gatherValue(e),this.isolateFields||this.gatherValues(e)}setValues(e,t=this.assignValueDefaults){this.assigningValues=t,this.eachWidget((r=>r.assignValue(e,t)),!1),this.assigningValues=!1}get hasNoChildren(){const e=this,{items:t,lazyItems:r}=e.initialConfig,n=t&&(isArray2(t)?t:ObjectHelper.values(t)),i=r&&(isArray2(r)?r:ObjectHelper.values(r)),s=e.isConfiguring?i||n:e.items;return!(null==s?void 0:s.filter(isNotHidden).length)}afterRecompose(){super.afterRecompose(),this.realign()}updateTextContent(e){const t=this;if(!t.isComposable){const r=Boolean(e&&t.hasNoChildren),{classList:n}=t.contentElement;r!==n.contains("b-text-content")&&(n[r?"add":"remove"]("b-text-content"),t.rendered&&t.realign())}}updateLayoutStyle(e){DomHelper.applyStyle(this.contentElement,e)}updateElement(e){if(super.updateElement(...arguments),e){const{classList:e}=this.contentElement,{containerCls:t}=this.layout;e.add("b-content-element"),t&&e.add(t)}}onPaint(){var e;null==(e=super.onPaint)||e.call(this,...arguments),this.getConfig("contentElMutationObserver")}changeContentElMutationObserver(e,t){if(t&&(t.takeRecords(),t.disconnect()),e){const t=this,{element:r,contentElement:n}=t;(e=new MutationObserver((e=>t.onContentElMutation(e)))).observe(n,{attributes:!0}),n!==r&&e.observe(r,{attributes:!0}),t.syncFlexDirection()}return e}onContentElMutation(){boxLayouts[this.layout.type]&&this.isVisible&&this.syncFlexDirection()}changeLayout(e,t){return Layout.reconfigure(t,e,{owner:this,defaults:{owner:this}})}get childItems(){return this.items}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}setupWidgetConfig(e,t){const r=this;"string"==typeof e?e={html:e}:e.nodeType===Element.ELEMENT_NODE&&(e={element:e,id:e.id}),("string"==typeof t||!t&&(t=e.type))&&(t=Widget.resolveType(t,!0));for(let n=(e=(t||Widget).mergeConfigs(r.defaults,e,{parent:r})).parent;n;n=n.parent)if(!1===n.processWidgetConfig(e))return null;return!1===r.trigger("beforeWidgetCreate",{widgetConfig:e})?null:e}createWidget(e){const t=Widget.create(this.setupWidgetConfig(e),this.defaultType);return t&&(t._createdBy=this),t}updateDefaults(e,t){if(!this.isConfiguring&&e){const r=Object.entries(e);this.eachWidget((e=>{r.forEach((([r,n])=>{t&&e[r]!==t[r]||(e[r]=n)}))}),!1)}}render(){this.getConfig("lazyItems"),this.layout.renderChildren(),this.syncChildCount(),super.render(...arguments)}get focusElement(){const e=this.query(this.defaultFocus||(e=>{var t;return e.isFocusable&&"close"!==e.ref&&!(null==(t=e.ref)?void 0:t.endsWith("collapse"))}));return e?e.focusElement:super.focusElement}doDestroy(){var e;null==(e=this._items)||e.forEach((e=>{var t;return null==(t=e.destroy)?void 0:t.call(e)})),this.layout.destroy(),super.doDestroy()}get isValid(){let e=!0;return this.eachWidget((t=>{t.isVisible&&"isValid"in t&&!t.isValid&&(e=!1)}),!0),e}};Container.initClass(),Container._$name="Container";var{assign:assign}=ObjectHelper,now=()=>performance.now(),nostart={start:!1},unitRe=/^[.\d]+([^\d].*)?$/,getTransitions=e=>{const t=e.$gantt||(e.$gantt={});return t.transitions||(t.transitions=Object.create(null))},milliseconds=(e,t)=>{var r;return"string"==typeof e&&(t=null==(r=unitRe.exec(e))?void 0:r[1],e=parseFloat(e)),e&&e*("s"===t||!t&&e<10?1e3:1)},syncTransitions=e=>{const t=ObjectHelper.values(getTransitions(e)).filter((e=>null==e.completed)).map((e=>e.toString()));e.style.transition=t.join(", ")},Anim=e=>class extends e{static get prototypeProperties(){return{_delay:null,_duration:null,_retain:null,_timing:null,_unit:null,owner:null,reverting:null}}constructor(...e){super(...e),this.id=++idSeed}start(){this.startTime=now()}get delay(){var e,t,r;return milliseconds(null!=(r=null!=(t=this._delay)?t:null==(e=this.owner)?void 0:e.delay)?r:0,this.unit)}set delay(e){this._delay=e}get duration(){var e;const{owner:t,unit:r}=this;return milliseconds(null!=(e=this._duration)?e:t?t.duration:Animator.defaultDuration,r)}set duration(e){this._duration=e}get elapsed(){return now()-this.startTime}get remaining(){return this.duration-this.elapsed}get retain(){var e,t;return null!=(t=this._retain)?t:null==(e=this.owner)?void 0:e.retain}set retain(e){this._retain=e}get timing(){var e,t;return null!=(t=this._timing)?t:null==(e=this.owner)?void 0:e.timing}set timing(e){this._timing=e}get unit(){var e,t;return null!=(t=this._unit)?t:null==(e=this.owner)?void 0:e.unit}set unit(e){this._unit=e}},idSeed=0,AnimatorTransition=class extends(Base.mixin(Anim)){static get $name(){return"AnimatorTransition"}static get prototypeProperties(){return{element:null,property:null,from:null,to:null,completed:null,promissory:null,reverting:null}}afterConstruct(){super.afterConstruct();const e=this,{element:t,transitions:r}=e;let{property:n}=e;[n,e.to]=DomHelper.unitize(n,e.to),e.from=DomHelper.unitize(n,e.from)[1],e.promissory=new Promissory,e.property=n;const i=r[n];r[n]=e;let{from:s}=e;i&&(e.from=i.to,s=null,i.destroy()),null===s&&(s=e.getCurrentStyleValue(),i||(e.from=s)),t.style[n]=s,e.getCurrentStyleValue()}doDestroy(){const e=this;e.finish(!1),e.completed&&!e.retain&&e.clearStyle(),super.doDestroy()}get promise(){var e;return null==(e=this.promissory)?void 0:e.promise}get transitions(){return getTransitions(this.element)}clearStyle(){this.setStyle("")}finish(e){const t=this,{transitions:r,promissory:n,property:i}=t;n&&(t.completed=e,t.promissory=null,n.resolve(e),r[i]===t?(delete r[i],e||(syncTransitions(t.element),t.clearStyle())):t.completed=!1)}getCurrentStyleValue(){return DomHelper.getStyleValue(this.element,this.property)}revert(){const{duration:e,elapsed:t,element:r,from:n,property:i,_retain:s,_timing:a}=this;return new AnimatorTransition({element:r,property:i,retain:s,timing:a,duration:Math.round(Math.min(e,t)),reverting:this,to:n,unit:"ms"})}setStyle(e){this.element.style[this.property]=e}start(){const e=this,{delay:t,duration:r,element:n,property:i}=e;EventHelper.onTransitionEnd({element:n,property:i,duration:t+r+20,thisObj:e.owner,handler:()=>{var t;return null==(t=e.finish)?void 0:t.call(e,!0)}}),super.start(),e.setStyle(e.to)}toString(){const{delay:e,duration:t,property:r,timing:n}=this;return r+" "+t+"ms "+(n||"ease-in-out")+(e?" "+e+"ms":"")}};AnimatorTransition.initClass();var Animator=class extends(Base.mixin(Anim)){static get $name(){return"Animator"}static get prototypeProperties(){return{element:null,finalize:null,prefinalize:null,completed:null,items:null}}static register(e,t){ObjectHelper.isObject(e)?ObjectHelper.entries(e).forEach((e=>Animator.register(...e))):(Animator.fx[e]=t,Animator[e]=t=>(DomHelper.isElement(t)?t={element:t,[e]:{}}:delete(t={element:t.element,[e]:t})[e].element,Animator.run(t)))}static run(e){return new Animator(e).start()}constructor(e){var t;super(null);const r=this,n=[],i={};let s,a,o,l;if(Array.isArray(e))r.items=e;else for(o in e)(Animator.specialPropsRe.test(o)?r:i)[o]=e[o];ObjectHelper.keys(i).forEach((e=>{l=i[e],null!=l&&!1!==l&&l==l&&((a=Animator.fx[e])?(l=assign(r.defaults,a(l,r,e)),l.owner=r,s=new Animator(l)):(l=assign(r.defaults,"object"==typeof l?l:{to:l}),l.owner=r,l.property=e,s=new AnimatorTransition(l)),n.push(s))})),null==(t=r.items)||t.forEach((e=>{ObjectHelper.isInstantiated(e)?e.owner=r:((e=assign(r.defaults,e)).owner=r,e=new Animator(e)),n.push(e)})),r.items=n,r.promise=(1===n.length?n[0].promise:Promise.all(n.map((e=>e.promise)))).then((e=>{var t;return null==(t=r.finish)||t.call(r,e),r.completed||!1}))}doDestroy(){this.items.forEach((e=>e.destroy())),super.doDestroy()}get defaults(){return{element:this.element}}get retain(){const{_retain:e,finalize:t,owner:r}=this;return null!=e?e:!t&&(!r||r.retain)}set retain(e){super.retain=e}done(){return this.promise}finish(e){var t,r;const n=this,{items:i}=n;for(syncTransitions(n.element),n.completed="boolean"==typeof e?e:!e.some((e=>!e)),null==(t=n.prefinalize)||t.call(n,n.completed,n);i.length;)i.pop().destroy();null==(r=n.finalize)||r.call(n,n.completed,n)}revert(e){var t;const r=this,{reverting:n}=r,i=!e||null==(t=e.start)||t;let s=r.defaults;return n&&(n.finalize&&(s.finalize=n.finalize),n.prefinalize&&(s.prefinalize=n.prefinalize),s.retain=n._retain),s=assign(s,e,{items:r.items.map((e=>e.revert(nostart))),reverting:r}),s=new Animator(s),i&&s.start(),s}start(){const{element:e,items:t}=this;return super.start(),t.length&&(syncTransitions(e),t.forEach((e=>e.start()))),this}};Animator.initClass().Transition=AnimatorTransition,Animator.specialPropsRe=new RegExp("^(?:"+Object.keys(Animator.prototypeProperties).concat(Object.keys(Animator.superclass.prototypeProperties)).map((e=>"_"===e[0]?e.substr(1):e)).join("|")+")$"),Animator.defaultDuration=200,Animator.fx={},Animator.register({puff:e=>(!0===e?e={}:"object"!=typeof e?e={transform:"scale("+e+")"}:e.scale&&((e=ObjectHelper.clone(e)).transform="scale("+e.scale+")",delete e.scale),assign({opacity:0,transform:"scale(8)"},e))}),Animator._$name="Animator";var ClickRepeater=class extends(Base.mixin(Delayable_default)){static get configurable(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3,pressedCls:"b-pressed"}}doDestroy(){var e;null==(e=this.mousedownRemover)||e.call(this),this.cancel(),super.doDestroy()}cancel(){var e,t,r;const n=this;null==(e=n.activeElement)||e.classList.remove(n.pressedCls),n.activeElement=null,null==(t=n.acceleration)||t.cancel(),n.activeListenerRemover=null==(r=n.activeListenerRemover)?void 0:r.call(n),n.clearTimeout(n.autoRepeatTimer),n.clearTimeout(n.repeatTimer)}updateElement(e){var t;null==(t=this.mousedownRemover)||t.call(this),this.mousedownRemover=EventHelper.on({element:e,mousedown:"onMouseDown",thisObj:this})}onMouseDown(e){const t=this,r=t.delegate?e.target.closest(t.delegate):t.element;t.cancel(),r&&(t.activeElement=r,t.triggerEvent=e,r.classList.add(t.pressedCls),t.activeListenerRemover=EventHelper.on({mouseup:{element:document,capture:!0,handler:"onMouseUp"},mousemove:{element:r,handler:"onTargetMouseMove"},mouseleave:{element:r,handler:"onTargetMouseLeave"},mouseenter:{element:r,handler:"onTargetMouseEnter"},thisObj:t}),t.autoRepeatTimer=t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(){this.cancel()}onTargetMouseLeave(){this.activeElement.classList.remove(this.pressedCls),this.clearTimeout(this.repeatTimer)}onTargetMouseEnter(e){const t=this;e.buttons?(t.activeElement.classList.add(t.pressedCls),t.triggerEvent=e,t.fireClick()):t.cancel()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=FunctionHelper.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}};ClickRepeater._$name="ClickRepeater";var autoRotateRe=/^(?:undefined|null|LEFT|RIGHT)$/,inverted={TOP:"BOTTOM",RIGHT:"LEFT",BOTTOM:"TOP",LEFT:"RIGHT"},canonicalDock=e=>{const t=null==e?void 0:e.toUpperCase();return[t,"LEFT"===t||"RIGHT"===t]},Rotatable_default=e=>class extends(e||Base){static get $name(){return"Rotatable"}static get configurable(){return{rotate:null,invertRotate:null}}compose(){const{rotate:e}=this;return{class:{["b-rotate-"+(e||"").toLowerCase()]:e,"b-rotate-vertical":e}}}syncRotationToDock(e){if(autoRotateRe.test(String(this.rotate))){const[t,r]=canonicalDock(e);this.rotate=r?this.invertRotate?inverted[t]:t:null}}get widgetClass(){return null}},Tool=class extends(Widget.mixin(Rotatable_default)){compose(){const{align:e,href:t}=this;return{tag:null!=t?"a":"button",class:{["b-align-"+(e||"end")]:1,"gt-icon":1},listeners:{click:"onInternalClick"}}}get focusElement(){return this.element}get panel(){var e,t;if((null==(e=this.parent)?void 0:e.isPanel)&&(null==(t=this.element)?void 0:t.parentNode.matches(".b-panel-header")))return this.parent}changeAlign(e){return e}onInternalClick(e){const t=this,{handler:r,panel:n}=t,i={domEvent:e,tool:t};t.disabled||(t.trigger("click",i),t.isDestroyed||(t.trigger("action",i),t.isDestroyed||!1===(null==n?void 0:n.trigger("toolClick",i))||r&&t.callback(r,n,[e,n,t])))}onInternalKeyDown(e){"Enter"===(e.key.trim()||e.code)&&(e.cancelBubble=!0,e.stopPropagation())}updateDisabled(e,t){var r;super.updateDisabled(e,t),e&&(null==(r=this.repeat)||r.cancel())}changeRepeat(e,t){return null==t||t.destroy(),e&&ClickRepeater.new({element:this.element},e)}};__publicField(Tool,"$name","Tool"),__publicField(Tool,"type","tool"),__publicField(Tool,"configurable",{align:{value:null,$config:{merge:"replace"}},href:null,repeat:null,defaultBindProperty:null}),Tool.initClass(),Tool._$name="Tool";var rightRe=/right/i,autoAlign=e=>(e.collapsed||e.collapsing)&&"top"===e.owner.expandedHeaderDock&&e.owner.collapsible.direction.match(rightRe)?"start":"end",CollapseTool=class extends Tool{static get $name(){return"CollapseTool"}static get type(){return"collapsetool"}static get configurable(){return{autoAlign:!0,collapsed:null,collapsing:null,collapsify:!1,direction:"up",defaultBindProperty:null}}compose(){const{collapsed:e,direction:t}=this;return{class:{["gt-icon-collapse-"+t]:1,"b-collapsed":e}}}changeAutoAlign(e){return!0===e?autoAlign:e}syncAutoAlign(){const{autoAlign:e}=this;e&&(this.align=e(this))}updateAutoAlign(){this.syncAutoAlign()}updateCollapsed(){this.syncAutoAlign()}updateCollapsing(){this.syncAutoAlign()}updateDirection(){this.syncAutoAlign()}};CollapseTool.initClass(),CollapseTool._$name="CollapseTool";var defaultedDirectionRe=/^(?:UP|DOWN|LEFT|RIGHT)$/,dockBeforeRe=/^(left|top)$/i,emptyArray5=[],emptySplit=[emptyArray5,emptyArray5],headerDockRe=/^b-dock-(top|left|right|bottom)$/,revealerCls="b-panel-collapse-revealer",sideDockRe=/^(?:left|right)$/i,unflexCls="b-collapse-unflex",{round:round}=Math,canonicalDirection=["up","down","left","right"].reduce(((e,t)=>(e[t.toUpperCase()]=e[t]=t,e)),{}),clipByDock={top:["top","bottom"],right:["right","left"],bottom:["bottom","top"],left:["left","right"]},collapseDirectionByPlacement={hl:"LEFT",hr:"RIGHT",vb:"DOWN",vt:"UP"},crossAxis={h:"w",w:"h"},dockByDirection={up:"top",right:"right",down:"bottom",left:"left"},dockIsHorz={top:!1,right:!0,bottom:!1,left:!0},directionByDock={top:"UP",right:"RIGHT",bottom:"DOWN",left:"LEFT"},transverseTransform={top:e=>"translate(0, -"+round(e.height||0)+"px)",bottom:e=>"translate(0, "+round(e.height||0)+"px)",right:e=>"translate("+round(e.width||0)+"px, 0)",left:e=>"translate(-"+round(e.width||0)+"px, 0)"},idSeed2=0,PanelCollapser=class extends(Base.mixin(Factoryable_default)){static get $name(){return"PanelCollapser"}static get type(){return"inline"}static get configurable(){return{animation:{duration:200},collapsed:{value:null,$config:null,default:!1},direction:null,collapseTooltip:"L{Collapse}",expandTooltip:"L{Expand}",panel:{value:null,$config:"nullify"},supportAxis:null,tool:{type:"collapsetool",handler(e){var t;null==(t=this.collapsible)||t.onCollapseClick(e)}}}}static get factoryable(){return{defaultType:"inline"}}get collapsing(){return"collapsing"===this.collapsingExpanding}get collapsingExpanding(){var e;const t=null==(e=this.currentOperation)?void 0:e.collapsing;return null==t?null:t?"collapsing":"expanding"}get currentDock(){var e,t,r,n;return null!=(n=null==(r=null==(t=null==(e=this.panel)?void 0:e.header)?void 0:t.dock)?void 0:r.toLowerCase())?n:"top"}get expanding(){return"expanding"===this.collapsingExpanding}get collapseTool(){var e,t;return null==(t=null==(e=this.panel)?void 0:e.tools)?void 0:t.collapse}get collapseDim(){return sideDockRe.test(this.collapseDir)?"width":"height"}getCollapseDir(e){var t;let{direction:r,panel:n}=this;if(!r||defaultedDirectionRe.test(r)){const e=null==n?void 0:n.placement;r=e?collapseDirectionByPlacement[e]:directionByDock[(null==(t=null==n?void 0:n.header)?void 0:t.dock)||"top"]}return e?canonicalDirection[r]:r}get collapseDir(){return this.getCollapseDir(!0)}get collapseDock(){return this.collapseInfo[0]}get collapseInfo(){const{panel:e}=this,t=e.hasHeader&&e.expandedHeaderDock;let r=dockByDirection[this.collapseDir],n=!1;return t&&((n=dockIsHorz[r]!==dockIsHorz[t])||(r=t)),[r,n]}get toolsConfig(){const{direction:e,tool:t}=this;return t&&{collapse:ObjectHelper.assign({direction:e.toLowerCase()},t)}}beforeCollapse(e){const{panel:t}=this,{element:r}=t;r.contains(DomHelper.getActiveElement(r))&&t.revertFocus(!0)}changeTool(e){const t=this,{panel:r}=t;if(t.isConfiguring||t.isDestroying||!r||r.isDestroying)return e;r.tools={collapse:e}}collapse(e){var t,r;const n=this,{panel:i}=n,s={id:++idSeed2,completed:!1,panel:i};let{currentOperation:a}=n;return e=null==e||e,ObjectHelper.isObject(e)&&(s.collapsed=!0,ObjectHelper.assign(s,e),e=s.collapsed,delete s.collapsed),s.collapsing=e,s.previous=null!=a?a:null,e!==n.collapsed?a?a.collapsing!==e&&(s.animation=a.animation.revert({finalize(){var e;null==(e=n.collapseFinalize)||e.call(n,s,!0)}}),s.collapsing=e,a=s):(s.animation=ObjectHelper.clone(("animation"in s?s:n).animation),!1!==n.beforeCollapse(s)&&(s.animation&&(s.animation.finalize=e=>{var t;return null==(t=n.collapseFinalize)?void 0:t.call(n,s,e)}),i.changingCollapse=!0,n[e?"collapseBegin":"expandBegin"](s),s.animation?a=s:(s.completed=!0,n[e?"collapseEnd":"expandEnd"](s)),i.changingCollapse=!1,s.animation||n.onComplete(e?"collapse":"expand"))):a&&a.collapsing!==e&&(n[e?"expandRevert":"collapseRevert"](s),s.animation=a.animation.revert({finalize(){var e;null==(e=n.collapseFinalize)||e.call(n,s,!1)}}),a=s),n.currentOperation=a,null!=(r=null==(t=null==a?void 0:a.animation)?void 0:t.done())?r:Promise.resolve(e===n.collapsed)}collapseFinalize(e,t){const r=this,{currentOperation:n,panel:i}=r,s=i.collapsed?"expand":"collapse";n===e&&(r.currentOperation=null,e.completed=t,i.changingCollapse=!0,r[s+"End"](e),i.changingCollapse=!1,t&&r.onComplete(s))}applyHeaderDock(e,t=!0){const{currentDock:r,panel:n}=this,i=e?this.collapseDock:n.expandedHeaderDock;i!==r&&n.hasHeader&&(n.header={dock:i},t&&n.recompose.flush())}composeHeader(e){const{panel:t}=this,{class:r}=e,n=t.expandedHeaderDock||Object.keys(r).filter((e=>r[e]&&headerDockRe.test(e))).map((e=>headerDockRe.exec(e)[1][0]));return r[revealerCls]=1,r["b-collapsible-"+n[0]+this.collapseDir[0]]=1,e}composeTitle(e){return e.class[revealerCls]=1,e}collapseBegin(e){var t;const r=this,{animation:n}=e,{collapseDim:i,collapseTool:s,panel:a}=r,{element:o,placement:l}=a,[c,d]=r.collapseInfo,u=null==s?void 0:s.element.classList,h=!l||"h"===l[0]&&"width"===i||"v"===l[0]&&"height"===i;r.configuredWidth=a._lastWidth,r.configuredHeight=a._lastHeight,r.transverseCollapse=d,r.applyHeaderDock(!0);const g=a.rectangle(),p=r.lockInnerSize().moveTo(0,0),m=p.clone(),f=clipByDock[c],v=null==(t=a.headerElement)?void 0:t.getBoundingClientRect(),y=round((null==v?void 0:v[i])||0);o.classList.toggle(unflexCls,h),n?(m[f[0]]=m[f[1]],o.classList.add("b-collapsing"),null==u||u.add("b-collapsed","b-collapsing"),s&&(s.collapsing=!0),u&&(u.remove("b-collapsed"),a.rectangle(),u.remove("b-collapsing"),u.add("b-collapsed")),n.element=o,n.retain=!0,n[i]={from:round(g[i]),to:y},n.items=[{element:r.innerElement,retain:!1,clip:{from:"rect("+p+")",to:"rect("+m+")"}}],d&&n.items.push({element:a.headerElement,duration:n.duration,retain:!1,transform:{from:transverseTransform[c](v),to:"translate(0, 0)"}}),e.animation=Animator.run(n)):(o.style[i]=y+"px",s&&(u.add("b-collapsing","b-collapsed"),s.rectangle(),u.remove("b-collapsing")))}collapseEnd(e){const t=this,{collapseTool:r}=t;t.panel.element.classList.remove("b-collapsing"),r&&(r.collapsing=!1),e.completed?t.collapsed=!0:(t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}collapseRevert(e){var t;null==(t=this.collapseTool)||t.element.classList.remove("b-collapsed")}expandBegin(e){const t=this,{animation:r}=e,{collapseDim:n,collapseTool:i,panel:s}=t,[a,o]=t.collapseInfo,{element:l}=s,c=l.classList,d=c.contains(unflexCls),u=s.rectangle();c.remove("b-collapsed","b-collapsing"),s.element.style[n]="",t.restoreConfiguredSize(),t.lockInnerSize(!1);const h=s.rectangle(),g=t.lockInnerSize().moveTo(0,0),p=g.clone(),m=clipByDock[t.collapseDock];null==i||i.element.classList.remove("b-collapsed"),r&&(p[m[0]]=p[m[1]],c.add("b-collapsed","b-expanding"),d&&c.add(unflexCls),r.element=l,r[n]={from:round(u[n]),to:round(h[n])},r.items=[{element:t.innerElement,retain:!1,clip:{from:"rect("+p+")",to:"rect("+g+")"}}],o&&r.items.push({element:s.headerElement,duration:r.duration,retain:!1,transform:{from:"translate(0, 0)",to:transverseTransform[a](u)}}),e.animation=Animator.run(r))}expandEnd(e){const t=this;t.panel.element.classList.remove("b-expanding"),e.completed&&(t.collapsed=!1,t.applyHeaderDock(!1),t.restoreConfiguredSize(),t.lockInnerSize(!1))}expandRevert(e){var t;null==(t=this.collapseTool)||t.element.classList.add("b-collapsed")}get innerElement(){return this.panel.collapseWrapElement||this.panel.bodyWrapElement}get innerSizeElement(){return this.transverseCollapse?this.panel.element:this.innerElement}get supportAxis(){let{_supportAxis:e}=this;const t=!0===e;return(t||null==e)&&(e=this.collapseDim[0],(t||"absolute"===DomHelper.getStyleValue(this.panel.element,"position"))&&(e+=crossAxis[e])),e||""}lockInnerSize(e=!0){const t=this,{innerElement:r,panel:n}=t,i=e?t.supportAxis:"",s=n.element,a=n.headerElement,o=e&&a&&Rectangle.from(a,s),l=e&&Rectangle.from(t.innerSizeElement,s),c=r.style;return a&&(a.style.minWidth=i.includes("w")?o.width+"px":"",a.style.minHeight=i.includes("h")?o.height+"px":""),c.width=e?l.width+"px":"",c.height=e?l.height+"px":"",r.classList[e?"add":"remove"]("b-panel-collapse-size-locker"),l}onCollapseClick(e){let t=!this.collapsing&&(!!this.expanding||!this.collapsed);e.altKey&&(t={animation:null,collapsed:t}),this.collapse(t)}onComplete(e){var t;null==(t=this.panel)||t.trigger(e)}onHeaderClick({event:e}){0===e.button&&this.panel.collapsed&&e.target.classList.contains(revealerCls)&&this.onRevealerClick()}onPanelConfigChange({name:e,value:t}){const r=this,{panel:n}=r;"collapsed"===e?n.isPainted&&(r.collapsed=t):"header"!==e||n.changingCollapse||r.syncDirection()}onPanelPaint(){this.syncDirection(),this.panel.collapsed&&!this.collapsed&&this.collapse({animation:null,collapsed:!0})}onRevealerClick(){this.panel._collapse({collapsed:!1})}restoreConfiguredSize(e){const{configuredHeight:t,configuredWidth:r,panel:n}=this;e=null!=e?e:"wh",n.element.classList.remove(unflexCls),null!=r&&e.includes("w")&&(n.width=r),null!=t&&e.includes("h")&&(n.height=t)}splitHeaderItems(){return emptySplit}syncDirection(){const e=this,{direction:t}=e;t&&!defaultedDirectionRe.test(t)||(e.direction=e.getCollapseDir())}updateCollapsed(e){const{collapseTool:t,panel:r}=this;r&&(r.collapsed=e,r.element.classList[e?"add":"remove"]("b-collapsed")),t&&(t.collapsed=e)}updateDirection(e){const{collapseTool:t,panel:r}=this;t&&(t.direction=canonicalDirection[e]),(null==r?void 0:r.rendered)&&r.recompose()}updatePanel(e){var t;const r=this;r.syncDirection(),null==(t=r.panelChangeDetacher)||t.call(r),r.panelChangeDetacher=e&&FunctionHelper.after(e,"onConfigChange","onPanelConfigChange",r,{return:!1})}wrapCollapser(e,t){var r;const n=this,[i,s]=n.collapseInfo;if(!s)return[e,t];const{collapseDir:a,panel:o}=n,{expandedHeaderDock:l,header:c,uiClassList:d}=o,u=null==(r=o.tools)?void 0:r.recollapse,[h,g]=n.splitHeaderItems({dock:i,as:"element"}),p=o.hasHeader?o.title||(null==c?void 0:c.title)||" ":null,m=p&&{tag:"header",class:new DomClassList({...d,["b-dock-"+l]:1,"b-panel-header":1,"b-panel-collapser-header":1},null==c?void 0:c.cls),children:[...h,{reference:"collapserTitleElement",html:p,class:{...d,["b-align-"+((null==c?void 0:c.titleAlign)||"start")]:1,"b-header-title":1}},...g]};return u&&(u.direction=a),["collapseWrapElement",{class:{...d,["b-panel-collapser-header-"+l]:1,["b-panel-collapser-"+a]:1,["b-"+(dockIsHorz[l]?"h":"v")+"box"]:1,"b-panel-collapser":1,"b-box-center":1},children:dockBeforeRe.test(l)?{collapserHeaderElement:m,[e]:t}:{[e]:t,collapserHeaderElement:m}}]}};PanelCollapser.maps={clipByDock:clipByDock,dockByDirection:dockByDirection,dockIsHorz:dockIsHorz},PanelCollapser.initClass(),PanelCollapser._$name="PanelCollapser";var PENDING=Symbol("pendingCreate"),DynamicObject=class extends Base{static get prototypeProperties(){return{cleanup:null,configName:null,created:null,factory:null,inferType:"name",owner:null,ownerName:null,proxyable:"undefined"!=typeof Proxy,setup:null,transform:null}}static get properties(){return{defaults:{},instances:{},object:Object.create({})}}get proxy(){const e=this;let t=null;return e.proxyable&&(t=new Proxy(e.instances,{get:(t,r)=>e.get(r),set:(t,r,n)=>(e.set(r,n),!0),deleteProperty:(t,r)=>(e.set(r,null),!0)})),Reflect.defineProperty(e,"proxy",{configurable:!0,value:t}),t}get target(){return this.proxy||this.object}define(e,t){const r=this,{transform:n}=r,i=n?n(t,e):t,s=ObjectHelper.isInstantiated(i);r.instances[e]=PENDING,s||r.setDefaults(e,i),r.defineProp(e,!0),s&&r.set(e,i)}defineProp(e,t){const r=this,{object:n}=r;r.proxy||Reflect.defineProperty(t?Object.getPrototypeOf(n):n,e,{configurable:!t,enumerable:!0,get:()=>r.get(e),set:t=>r.set(e,t)})}flush(){var e;const t=this;try{t.updating=!0;for(const e in t.defaults)t.get(e);t.afterConfigureOwner=null==(e=t.afterConfigureOwner)?void 0:e.call(t)}finally{t.updating=!1}}get(e){const{defaults:t,instances:r}=this;return r[e]===PENDING&&this.set(e,PENDING),r[e]||t[e]&&null}set(e,t){var r;const n=this,{cleanup:i,configName:s,defaults:a,factory:o,instances:l,owner:c,setup:d,transform:u,updating:h}=n,g=c&&s&&!h,p=l[e]===PENDING?null:l[e],m=o.reconfigure(p,t===PENDING?{}:t||null,{cleanup:i&&(t=>i(t,e)),defaults:a[e]||n.setDefaults(e,{}),owner:n.owner,setup:d&&((t,r,n)=>d(t,e,r,n)),transform:u&&(t=>u(t,e))});if(m!==p){const t=g&&{...l};l[e]=m,m?(n.defineProp(e),null==(r=n.created)||r.call(n,m,e)):(delete n.object[e],delete l[e]),g&&c.onConfigChange({name:s,config:c.$meta.configs[s],value:n.target,was:t})}}setDefaults(e,t){const{defaults:r,factory:n,inferType:i,instances:s,owner:a,ownerName:o}=this,{typeKey:l}=n.factoryable;return t=!0===t?{}:ObjectHelper.assign({},t),("name"===i||!0===i&&!t[l])&&(t[l]=e),o&&(t[o]=a),t.beforeConfigure=t=>{s[e]=t},r[e]=t}update(e){const t=this,{owner:r}=t;let n,i;try{if(t.updating=!0,e)for(n in e)i=e[n],t.defaults[n]?t.set(n,i):i&&t.define(n,i);else for(n in t.instances)t.set(n,null)}finally{t.updating=!1}r&&(r.isConfiguring?t.afterConfigureOwner||(t.afterConfigureOwner=FunctionHelper.before(r,"afterConfigure","flush",t)):t.flush())}};DynamicObject.initClass(),DynamicObject._$name="DynamicObject";var emptyArray6=[],emptyObject7={},toolConfigs={align:1,weight:1},Toolable_default=e=>class extends(e||Widget){static get $name(){return"Toolable"}static get configurable(){return{tools:{value:null,$config:{nullify:!0}},toolDefaults:{"*":{type:"tool",align:"end"}}}}byWeightSortFn(e,t){return(e.weight||0)-(t.weight||0)}byWeightReverseSortFn(e,t){return(t.weight||0)-(e.weight||0)}gatherTools({align:e,overlay:t,refs:r}=emptyObject7){var n,i,s;const{collapsed:a,tools:o}=this;let l,c,d,u,h,g=[];for(c in o)h=o[c],l=null!=(s=null!=(i=null==(n=null==h?void 0:h.align)?void 0:n.align)?i:null==h?void 0:h.align)?s:"end",l===e&&h.isCollapsified(a,t)&&g.push(h);if(g.sort(this["end"===e?"byWeightReverseSortFn":"byWeightSortFn"]),r){const e="widget"===r,t={};for(d=0;d<g.length;++d)u=g[d],t[u.ref]=e?u:u.element;g=t}return g}getEndTools({overlay:e,refs:t}=emptyObject7){return this.gatherTools({align:"end",overlay:e,refs:t})}getStartTools({overlay:e,refs:t}=emptyObject7){return this.gatherTools({align:"start",overlay:e,refs:t})}get childItems(){return[...this.getStartTools(),...this._items||emptyArray6,...this.getEndTools()]}changeTools(e,t){const r=this,n=r.$tools||(r.$tools=new DynamicObject({configName:"tools",factory:Widget,inferType:!1,owner:r,created(e){var t,i;e.innerItem=!1,null==(i=e.syncRotationToDock)||i.call(e,null==(t=r.header)?void 0:t.dock),FunctionHelper.after(e,"onConfigChange",((e,{name:t})=>{toolConfigs[t]&&r.onConfigChange({name:"tools",value:n.target})})),r.onChildAdd(e)},setup:(e,t)=>((e=ObjectHelper.merge({},r.toolDefaults["*"],r.toolDefaults[t],e)).parent=r,e.ref=t,e)}));if(n.update(e),!t)return n.target}get widgetClass(){}},directionCls=["b-hbox","b-vbox"],syncAlign={name:"align",style:"alignItems"},syncContentAlign={name:"contentAlign",style:"alignContent"},syncDirection={name:"direction",style:"flexDirection"},syncJustify={name:"justify",style:"justifyContent",classes:["stretch"]},syncWrap={name:"wrap",style:"flexWrap",map:{false:"nowrap",true:"wrap",reverse:"wrap-reverse"}},Box=class extends Layout{get vertical(){return!1===this.horizontal}set vertical(e){return this.horizontal=!e}updateAlign(){this.syncConfigStyle(syncAlign)}updateContentAlign(){this.syncConfigStyle(syncContentAlign)}updateDirection(){this.syncConfigStyle(syncDirection)}updateHorizontal(){var e;const t=this,r=null==(e=t.contentElement)?void 0:e.classList,n=Number(t.vertical);r?(r.remove(directionCls[1-n]),r.add(directionCls[n])):t.syncConfigLater("horizontal"),t.syncDirection()}updateJustify(){this.syncConfigStyle(syncJustify)}updateReverse(){this.syncDirection()}updateWrap(){this.syncConfigStyle(syncWrap)}syncDirection(){const e=this,{reverse:t}=e;e.direction=t?(e.vertical?"column":"row")+(t?"-reverse":""):null}};__publicField(Box,"$name","Box"),__publicField(Box,"type","box"),__publicField(Box,"alias","hbox"),__publicField(Box,"configurable",{itemCls:"b-box-item",align:null,contentAlign:null,direction:null,horizontal:!0,justify:null,reverse:null,wrap:null}),Box.initClass(),Box._$name="Box";var VBox=class extends Box{};__publicField(VBox,"$name","VBox"),__publicField(VBox,"type","vbox"),__publicField(VBox,"configurable",{horizontal:!1}),VBox.initClass(),VBox._$name="VBox";var Badge_default=e=>class extends(e||Base){static get $name(){return"Badge"}static get configurable(){return{badge:null}}compose(){const{badge:e}=this;return{dataset:{badge:e},class:{"b-badge":null!=e&&""!==e}}}},bIcon=/(?:^|\s)gt-icon-/,bFa=/(?:^|\s)b-fa-/,defaultToggleable=Symbol("defaultToggleable"),fullConfigKeys=["items","type","widgets","html","listeners"],menuListenersName=Symbol("defaultListener"),Button=class extends(Widget.mixin(Badge_default,Rotatable_default)){static get $name(){return"Button"}static get type(){return"button"}static get configurable(){return{icon:null,menuIcon:"gt-icon-picker",pressedIcon:null,iconAlign:"start",text:{value:null,$config:null,default:""},color:null,toggleable:defaultToggleable,pressed:!1,toggleGroup:null,ripple:{radius:75},forwardTwinEvents:["action","toggle"],localizableProperties:["text"],menu:{$config:["lazy","nullify"],value:null},menuDefaults:{type:"menu",autoShow:!1,autoClose:!0,floating:!0,scrollAction:"realign",align:"t0-b0"},href:null,target:null,defaultBindProperty:null}}updateElement(e,t){var r,n,i;const s=this,{constructor:a}=s,o=super.updateElement(e,t),l=s.peekConfig("menu"),c=!!l&&(l.isWidget?l.role:(null==(n=null==(r=a.resolveType(l.type))?void 0:r.configurable)?void 0:n.role)||(null==(i=a.configurable.menuDefaults)?void 0:i.type)||"menu");return s.ariaHasPopup=c,o}compose(){const{color:e,href:t,icon:r,iconAlign:n,pressed:i,pressedIcon:s,target:a,text:o,toggleable:l,toggleGroup:c,menuIcon:d}=this,u=this.hasConfig("menu"),h=i&&s?s:r;return{tag:t?"a":"button",href:t,target:a,class:{["gt-icon-align-"+n]:r,[e]:Boolean(e),"b-pressed":i&&l,"b-text":Boolean(o),"b-has-menu":u},"aria-pressed":i,dataset:{group:c},listeners:{click:"onInternalClick",mousedown:"onInternalMousedown"},children:{iconElement:(r||s)&&{"aria-hidden":!0,tag:"i",class:{...DomClassList.normalize(h,"object"),"gt-icon":bIcon.test(h),"b-fa":bFa.test(h)}},label:o&&{tag:"label",text:o},menuIconElement:u&&d&&{tag:"i",class:{"gt-icon":bIcon.test(d),"b-fa":bFa.test(d),"b-button-menu-icon":1,[d]:1}}}}}configureOverflowTwin(e){const t=this,r=super.configureOverflowTwin(e);return r.text||(r.text=t.text||t.tooltipText),r}onHide(){var e;null==(e=this._menu)||e.hide()}get childItems(){return this._menu&&[this.menu]}onFocusOut(e){var t;super.onFocusOut(e),null==(t=this.menu)||t.hide()}get focusElement(){return this.element}changeText(e){return null==e?"":e}changeToggleable(e){return e===defaultToggleable?this.toggleGroup||this.config.menu:e}changeMenu(e,t){const r=this,{element:n}=r;return e?(e.isWidget?(e.forElement=n,e.owner=r,e.constrainTo=r.rootElement):("object"!=typeof e||fullConfigKeys.some((t=>t in e))||(e={lazyItems:e}),e=Widget.reconfigure(t,e?ObjectHelper.merge({owner:r,constrainTo:r.rootElement,forElement:n},r.menuDefaults,e):null,r)),e.align.constrainPadding=10,r.detachListeners(menuListenersName),e.ion({name:menuListenersName,beforeShow:"onMenuBeforeShow",hide:"onMenuHide",show:"onMenuShow",thisObj:this})):null==t||t.destroy(),e}onMenuBeforeShow({source:e}){return this.trigger("beforeShowMenu",{menu:e})}onMenuShow(){this.ariaElement.setAttribute("aria-expanded",!0)}onMenuHide(){this.ariaElement.setAttribute("aria-expanded",!1),this.toggle(!1)}updateMenu(e){this.toggleable=Boolean(e)}updatePressed(e){var t,r;const n=this;if(!n.toggleable||n.isConfiguring)return;const{menu:i}=n;e&&DomHelper.forEachSelector(n.rootElement,"button[data-group="+n.toggleGroup+"]",(e=>{e!==n.element&&(Widget.getById(e.id).pressed=!1)})),i&&(i.initialConfig.minWidth||(i.minWidth=n.width),i.align.minHeight=null!=(t=i._minHeight)?t:100,i.align.minWidth=null!=(r=i._minWidth)?r:100,i[e?"show":"hide"]()),n.trigger("toggle",{pressed:e})}onInternalMousedown(e){var t;(null==(t=this._menu)?void 0:t.containsFocus)&&this.pressed&&e.preventDefault()}onInternalClick(e){const t=this,r={event:e};if(!t.disabled){if(t.toggleable){if(t.toggleGroup&&t.pressed)return;if(t.toggle(!t.pressed),t.isDestroyed)return}t.trigger("click",r),t.isDestroyed||t.trigger("action",r),t.href||(e.preventDefault(),e.stopPropagation())}}toggle(e=!this.pressed){!1!==this.trigger("beforeToggle",{pressed:e})&&(this.pressed=e)}};Button.initClass(),Button._$name="Button";var asElementRefs={refs:"element"},onCreateTwin=e=>e.element.style.margin="",isToolbar=e=>e.isToolbar,itemScoreFn=e=>e[0]+(e[1].minifiable?0:9e9),twinOverrides={hidden:!1,width:""},twinOverridesHorz={...twinOverrides,flex:""},_axisProps=[{box:"hbox",clientSizeProp:"clientWidth",edgeProp:"right",flexDir:"row",horizontal:!0,max:"maxX",overflow:"overflowX",pos:"x",scrollSize:"scrollWidth",sizeProp:"width"},{box:"vbox",clientSizeProp:"clientHeight",edgeProp:"bottom",flexDir:"column",horizontal:!1,max:"maxY",overflow:"overflowY",pos:"y",scrollSize:"scrollHeight",sizeProp:"height"}],defaultRepeat={delay:0,startRate:40,endRate:200,accelerateDuration:500},nonSyncedConfigs={menu:1,pressed:1},Toolbar=class extends(Container.mixin(Toolable_default)){static get $name(){return"Toolbar"}static get type(){return"toolbar"}static get delayable(){return{syncOverflowVisibility:{type:"raf",cancelOutstanding:!0}}}static get configurable(){return{defaultType:"button",dock:"top",layout:{type:"box"},overflow:{$config:["lazy","nullify"],value:{type:"menu"}},toolDefaults:{overflowMenuButton:{type:"button",hidden:!0,icon:"gt-icon-menu",menuIcon:null,defaultCls:{"b-overflow-button":1}},overflowScrollEnd:{handler:"up.onEndScrollClick",hidden:!0,defaultCls:{"gt-icon-angle-right":1,"b-overflow-button":1,"gt-icon":1}},overflowScrollStart:{align:"start",handler:"up.onStartScrollClick",hidden:!0,defaultCls:{"gt-icon-angle-left":1,"b-overflow-button":1,"gt-icon":1}}},widgetCls:null,ignoreParentReadOnly:!0}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}static getEvictionList(e){const t=e.filter((e=>"none"!==e.overflowable));return t.forEach(((e,r)=>t[r]=[r,e])),t.sort(((e,t)=>itemScoreFn(t)-itemScoreFn(e))),t}compose(){const e=this,{axisProps:t,dock:r}=e,n=e.getEndTools(asElementRefs),i=e.getStartTools(asElementRefs);return{class:{["b-dock-"+r]:1,["b-"+r+"-toolbar"]:1,["b-"+t.box]:1},children:{...i,toolbarContent:{class:{"b-box-center":1,"b-toolbar-content":1}},...n}}}get axisProps(){return _axisProps[this.layout.horizontal?0:1]}get contentElement(){return this.toolbarContent}get overflowMenuButton(){var e;return null==(e=this.tools)?void 0:e.overflowMenuButton}get overflowType(){const{overflow:e}=this;return"string"==typeof e?e:null==e?void 0:e.type}onChildAdd(e){var t;super.onChildAdd(e),this.processAddedLeafItem(e),null==(t=e.syncRotationToDock)||t.call(e,this.dock)}onChildRemove(e){super.onChildRemove(e),this.syncOverflowVisibility()}processAddedLeafItem(e){FunctionHelper.after(e,"onConfigChange",this.onLeafItemConfigChange,e),e.isContainer&&e.eachWidget((e=>this.processAddedLeafItem(e)))}onPaint({firstPaint:e}){var t;null==(t=super.onPaint)||t.call(this,...arguments),e&&this.getConfig("overflow")}updateDock(e){var t;const r=this,{layout:n}=r,{vertical:i}=n;if(n.vertical=canonicalDock(e)[1],!r.initialItems){i!==n.vertical&&r.updateOverflow(r.overflow);for(const n of r.childItems)null==(t=n.syncRotationToDock)||t.call(n,e)}}updateOverflow(e,t){var r,n;const i=this,{axisProps:s,contentElement:a,overflowType:o}=i,{flexDir:l}=s,c=null==(r=i.overflowMenuButton)?void 0:r._menu,d={};if(c&&(e?null==c||c.removeAll():c.eachWidget((e=>{e._overflowTwinOrigin.overflowTwin=null}))),"menu"===t?d.overflowMenuButton=null:"scroll"===t&&(d.overflowScrollStart=d.overflowScrollEnd=null),"menu"===o)null==(n=i.scrollable)||n.destroy(),a.style.overflow=a.style.overflowX=a.style.overflowY="",d.overflowMenuButton={cls:{["b-"+l+"-menu"]:1}};else if("scroll"===o){const t="object"==typeof e&&(null==e?void 0:e.repeat)||defaultRepeat;i.scrollable={[s.overflow]:"hidden-scroll",element:a,internalListeners:{scroll:"onContentScroll",thisObj:i}},d.overflowScrollStart={repeat:t,invertRotate:!0,cls:{["b-"+l+"-start-scroller"]:1}},d.overflowScrollEnd={repeat:t,invertRotate:!0,cls:{["b-"+l+"-end-scroller"]:1}}}i.tools=d,o?(a.classList.add("b-overflow"),i.monitorResize=!0,i.syncOverflowVisibility()):(a.classList.remove("b-overflow"),i.monitorResize=!1)}onContentScroll(){this.syncScrollerState()}onStartScrollClick(){this.scrollable[this.axisProps.pos]-=2}onEndScrollClick(){this.scrollable[this.axisProps.pos]+=2}onInternalResize(){super.onInternalResize(...arguments),this.isPainted&&this.syncOverflowVisibility()}syncOverflowVisibility(){const e=this,{overflowType:t,contentElement:r,isVisible:n}=e,{clientSizeProp:i,edgeProp:s,sizeProp:a}=e.axisProps,{overflowMenuButton:o,overflowScrollStart:l,overflowScrollEnd:c}=e.tools,d=e.rtl&&e.layout.horizontal,u="menu"===t,h=()=>Math.ceil(r[i]+(!l||l.hidden?0:l.rectangle("outer")[a])+(!c||c.hidden?0:c.rectangle("outer")[a])),g=()=>{if(0===R.length)return 0;const e=R[R.length-1].rectangle(r);return Math.floor(d?r[i]-e.left:e[s])};let p,m,f,v,y,b,C,D,S,E,w,R;if(n&&t&&0!==e.items.length){if(e.inSyncOverflowVisibility=!0,null==o||o.hide(),e.eachWidget(((e,t)=>{C=e.minifiable,E=e.overflowable,E=C?E||C:E,e.floating?t.down=!1:(t.down=!E,e.innerItem&&(e._toolbarOverflow&&(e.hidden=e._toolbarOverflow=!1),e._toolbarMinified&&(e.minified=e._toolbarMinified=!1),e.isVisible&&(C&&(D||(D=[])).push(e),E&&(R||(R=[])).push(e))))})),R&&(p=h(),m=g()),R&&m>p)if(u){for(;m>p&&(y=null==D?void 0:D.pop());)b=m,y._toolbarMinified=!0,y.minified=!0,m=g(),b-=m,(S||(S=[])).push([y,b]);if(m>p){for(f of(o.show(),p=h(),v=Toolbar.getEvictionList(R),v))m>p&&(y=f[1],y._toolbarOverflowWidth=y.width,y._toolbarOverflow=!0,y.hidden=!0,R.splice(R.indexOf(y),1),(w||(w=[])).push(f),m=g());if(w){for(w.sort(((e,t)=>e[0]-t[0])).forEach(((e,t)=>w[t]=e[1]));null==S?void 0:S.length;)[y,b]=S.pop(),m+b<=p&&!y._toolbarOverflow&&(m+=b,y.minified=y._toolbarMinified=!1);e.syncOverflowMenuButton(w)}else o.hide()}}else c.show(),l.show(),e.syncScrollerState();else u||(null==c||c.hide(),null==l||l.hide());e.inSyncOverflowVisibility=!1}}syncOverflowMenuButton(e){var t;const r=this,{axisProps:n,overflowMenuButton:i}=r,s={cls:"b-toolbar-overflow-menu",minWidth:280,items:[],align:{align:n.horizontal?"t100-b100":"r100-l100",axisLock:"flexible"}};if(r.addToMenu(s,e.filter((e=>r.overflowItemFilter(e)))),null==(t=i._menu)?void 0:t.isMenu){const e=i.menu,{toAdd:t,toRemove:r}=ArrayHelper.delta(s.items,e.items,1);if(e.remove(r),e.items.length)for(let r=t.length-1;r>=0;r--)e.insert(t[r],0);else e.add(t)}else i.menu=s}syncScrollerState(){const{axisProps:e,scrollable:t}=this,{overflowScrollStart:r,overflowScrollEnd:n}=this.tools,i=t[e.pos],s=t[e.max];r.disabled=!i,n.disabled=Math.abs(Math.ceil(i))>=Math.abs(s)}overflowItemFilter(e){const{filter:t}=this.overflow;return Boolean(t?t.call(this,e):DomHelper.getChildElementCount(e.element))}addToMenu(e,t){const r=this.horizontal?twinOverridesHorz:twinOverrides;for(const n of t){const t=n.ensureOverflowTwin(r,onCreateTwin);e.items.push(t)}}onLeafItemConfigChange(e,{name:t,value:r}){const n=this,i=n.up(isToolbar),s=i.hasConfig("overflow"),{overflowTwin:a}=n;!s||(null==i?void 0:i.inSyncOverflowVisibility)||"hidden"===t&&r===n._toolbarOverflow||(a&&!nonSyncedConfigs[t]&&(a[t]=r),(null==i?void 0:i.isPainted)&&"overflowMenuButton"!==n.ref&&(n.isTextField&&"value"===t&&(n.containsFocus||(null==a?void 0:a.containsFocus))||i.syncOverflowVisibility()))}createWidget(e){"->"===e?e={type:"widget",cls:"b-toolbar-fill"}:"|"===e?e={type:"widget",cls:"b-toolbar-separator"}:"string"==typeof e&&(e={type:"widget",cls:"b-toolbar-text",html:e});const t=super.createWidget(e);return this.widgetCls&&t.element.classList.add(this.widgetCls),t}};Toolbar.initClass(),Toolbar._$name="Toolbar";var acceptNode=e=>!e.classList.contains("b-focus-trap")&&DomHelper.isFocusable(e)?DomHelper.NodeFilter.FILTER_ACCEPT:DomHelper.NodeFilter.FILTER_SKIP,emptyArray7=[],emptyObject8={},emptySplit2=[emptyArray7,emptyArray7],finishBodyWrap=(e,t,r)=>{const{vertical:n}=e;return delete e.vertical,{...e,class:{...t,["b-"+(n?"v":"h")+"box"]:1,"b-box-center":1,"b-panel-bar-wrap":!r}}},wrapBody=(e,t,r=!1)=>{const n={vertical:r,children:e?[e]:[]};return t&&(n.tag=t),n},barConfigs={dock:1,hidden:1,weight:1},dockDirection={top:[!0,!0],bottom:[!0,!1],left:[!1,!0],right:[!1,!1]},headerDock={header:1,"pre-header":1},Panel=class extends(Container.mixin(State_default,Toolable_default)){static get $name(){return"Panel"}static get type(){return"panel"}static get configurable(){return{localizableProperties:["title"],collapsed:{value:null,$config:null,default:!1},collapsible:{value:null,$config:"nullify"},bodyCls:{$config:{merge:"classList"},value:null},bodyTag:null,bodyWrapTag:null,trapFocus:null,title:null,header:null,stateful:["collapsed"],stripDefaults:{"*":{type:"toolbar",dock:"top"},bbar:{dock:"bottom",weight:-1e3},tbar:{weight:-1e3}},strips:{value:null,$config:"nullify"},toolDefaults:{close:{weight:-1e3},collapse:{weight:-990}},footer:null,revealed:null,tbar:null,bbar:null,role:"region"}}updateElement(e,t){const r=super.updateElement(e,t);return this.titleElement&&DomHelper.setAttributes(this.ariaElement,{"aria-describedby":this.titleElement.id}),r}compose(){const e=this,{collapsible:t,focusable:r,hasItems:n,revealed:i,tools:s}=e,a=e.composeHeader(),o=(null==a?void 0:a.class["b-dock-left"])||(null==a?void 0:a.class["b-dock-right"]);let l=e.composeBody(),c="bodyWrapElement";return t&&([c,l]=t.wrapCollapser(c,l)),{tabIndex:n&&!1!==r||r?0:null,class:{["b-panel-collapsible-"+(null==t?void 0:t.type)]:t,["b-panel-collapse-"+(null==t?void 0:t.collapseDir)]:t,["b-"+(o?"h":"v")+"box"]:1,"b-panel-collapsible":t,"b-panel-has-header":a,"b-panel-has-tools":s?1:0,"b-panel-overlay-revealed":i},children:{topFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1}},headerElement:a,[c]:l,bottomFocusTrap:{"aria-hidden":!0,tabIndex:0,class:{"b-focus-trap":1,"b-end-focus-trap":1}}}}}composeBody(){const e=this,{bodyCls:t,bodyConfig:r,bodyWrapTag:n,footer:i,uiClassList:s}=e,a=ObjectHelper.values(e.strips,((e,t)=>!dockDirection[null==t?void 0:t.dock])).sort(e.byWeightSortFn);let o,l,c,d,u,h,g;for(i&&(c=i.dock||"bottom",a.unshift({dock:c,element:{tag:"footer",reference:"footerElement",html:"string"==typeof i?i:i.html,class:{...s,["b-dock-"+c]:1,[""+(i.cls||"")]:1}}})),t&&(r[u="className"]||(u="class"),r[u]=new DomClassList(r[u]).assign(t)),d=a.length;d-- >0;)o=a[d],[h,l]=dockDirection[o.dock],g?g.vertical!==h&&(g=wrapBody(finishBodyWrap(g,s),"",h)):g=wrapBody(r,n,h),g.children[l?"unshift":"push"](o.element);const p=finishBodyWrap(g||wrapBody(r,n),s,!0);return p.class["b-panel-body-wrap"]=1,p.class["b-"+e.$$name.toLowerCase()+"-body-wrap"]=1,p}get hasHeader(){if(!1===this.header)return!1;const{header:e,title:t,tools:r,parent:n}=this,i=this.maximizable||Object.values(r||{}).some((e=>!e.hidden));return e||!(null==n?void 0:n.suppressChildHeaders)&&(t||i)}get rootUiClass(){return Panel}composeHeader(e){var t;const r=this;if(!r.hasHeader&&!e)return;const n=r.header||{},i=n.dock||"top",[s,a]=r.splitHeaderItems({dock:i,as:"element"}),o=r.$meta.hierarchy,l=r.composeTitle(n),c=new DomClassList({["b-dock-"+i]:1,...r.uiClassList},n.cls);let d,u;for(d=o.indexOf(Panel);d<o.length;++d)u=o[d].$$name,"Grid"!==u&&(c["b-"+u.toLowerCase()+"-header"]=1);const h={tag:"header",class:c,children:[...s,l,...a]};return(null==(t=r.collapsible)?void 0:t.composeHeader(h))||h}composeTitle(e){var t;const r="string"==typeof e?e:this.title||e.title,n={reference:"titleElement",id:this.id+"-panel-title",html:null!=r?r:" ",class:{["b-align-"+(e.titleAlign||"start")]:1,"b-header-title":1,...this.uiClassList}};return ObjectHelper.isObject(r)&&(delete n.html,ObjectHelper.merge(n,r)),(null==(t=this.collapsible)?void 0:t.composeTitle(n))||n}updateTitle(){}afterRecompose(){var e;super.afterRecompose();const t=this,{headerElement:r}=t;null==(e=t._headerClickDetacher)||e.call(t),t._headerClickDetacher=r&&EventHelper.on({element:r,click:e=>{var r;return null==(r=t.trigger)?void 0:r.call(t,"headerClick",{event:e})}})}onHeaderClick(e){var t;null==(t=this.collapsible)||t.onHeaderClick(e)}onPaint(){var e;super.onPaint(...arguments),null==(e=this.collapsible)||e.onPanelPaint(this)}splitHeaderItems({as:e,overlay:t,dock:r}=emptyObject8){var n,i,s,a;const o=this,l="element"===e,{collapsed:c}=o,d=o.getEndTools({overlay:t}),u=o.getStartTools({overlay:t}),h=ObjectHelper.values(o.strips,((e,r)=>!headerDock[null==r?void 0:r.dock]&&r.isCollapsified(c,t)));let g,p,m,f=emptySplit2;if(h.length+d.length+u.length){for(f=[p=[...u,...h.filter((e=>"pre-header"===e.dock)).sort(o.byWeightSortFn)],g=[...h.filter((e=>"header"===e.dock)).sort(o.byWeightReverseSortFn),...d]],m=0;m<p.length;++m)r&&(null==(i=(n=p[m]).syncRotationToDock)||i.call(n,r)),l&&(p[m]=p[m].element);for(m=0;m<g.length;++m)r&&(null==(a=(s=g[m]).syncRotationToDock)||a.call(s,r)),l&&(g[m]=g[m].element)}return f}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){const e=this,{bodyTag:t}=e,r=ObjectHelper.merge({reference:"bodyElement",className:{...e.getStaticWidgetClasses(Panel,"-content"),"b-box-center":1,"b-text-content":e.textContent&&e.hasNoChildren}},e._bodyConfig);return t&&(r.tag=t),!e.initializingElement&&e._element||(r.html=e.content||e._html),r}changeBodyCls(e){return DomClassList.from(e)}changeTbar(e){return this.getConfig("strips"),this.strips={tbar:e},this.strips.tbar}changeBbar(e){return this.getConfig("strips"),this.strips={bbar:e},this.strips.bbar}get childItems(){var e;const t=this,r=ObjectHelper.values(t.strips,((e,t)=>!dockDirection[null==t?void 0:t.dock])).sort(t.byWeightSortFn),[n,i]=t.splitHeaderItems(),[s,a]=(null==(e=t.collapsible)?void 0:e.splitHeaderItems())||emptySplit2;return[...n,...s,...i,...a,...r.filter((e=>dockDirection[e.dock][1])),...t._items||emptyArray7,...r.filter((e=>!dockDirection[e.dock][1])).reverse()]}changeStrips(e,t){const r=this,n=r.$strips||(r.$strips=new DynamicObject({configName:"strips",factory:Widget,inferType:!1,owner:r,created(e){var t;const{dock:i}=e;if(!headerDock[i]&&!dockDirection[i])throw new Error('Invalid dock value "'+i+'"; must be: top, left, right, bottom, header, or pre-header');FunctionHelper.after(e,"onConfigChange",((e,{name:t})=>{barConfigs[t]&&r.onConfigChange({name:"strips",value:n.target})})),e.innerItem=!1,r.onChildAdd(e),e.parent=r,null==(t=e.layout)||t.renderChildren(),e.hasItems&&(r.hasItems=!0)},setup:(e,t)=>((e=ObjectHelper.merge(ObjectHelper.clone(r.stripDefaults["*"]),r.stripDefaults[t],e)).parent=r,e.ref=t,e),transform:e=>(Array.isArray(e)&&(e={items:e}),e||null)}));if(n.update(e),!t)return n.target}get collapsing(){var e;return null==(e=this.collapsible)?void 0:e.collapsing}get collapsingExpanding(){var e;return null==(e=this.collapsible)?void 0:e.collapsingExpanding}get expanding(){var e;return null==(e=this.collapsible)?void 0:e.expanding}changeCollapsed(e){const t=this,{collapsible:r}=t;if(t.recompose.flush(),e=Boolean(e),!r||t.changingCollapse||!t.isPainted)return e;null==r||r.collapse({animation:null,collapsed:e})}changeCollapsible(e,t){const r=this;return r.getConfig("tools"),e&&(!0===e?e={}:"string"==typeof e&&(e={[dockDirection[e]?"direction":"type"]:e})),PanelCollapser.reconfigure(t,e,{owner:r,defaults:{panel:r},cleanup(){r.collapsed&&(t.collapse({animation:null,collapsed:!1}),r._collapsed=1)}})}updateCollapsible(e){const t=this,r=null==e?void 0:e.toolsConfig;t.tools={collapse:(null==r?void 0:r.collapse)||null,recollapse:(null==r?void 0:r.recollapse)||null},e&&t.isPainted&&t.collapsed&&(t._collapsed=1),1===t.collapsed&&(t.collapsed=!0)}_collapse(e,t){var r;return!0!==t&&void 0!==t&&(!1===t?e.collapsed=!e.collapsed:"number"==typeof t?e.animation={duration:t}:null===t?e.animation=t:!0===t||("animation"in t?ObjectHelper.merge(e,t):e.animation=t)),null==(r=this.collapsible)?void 0:r.collapse(e)}collapse(e){return this._collapse({collapsed:!0},e)}expand(e){return this._collapse({collapsed:!1},e)}toggleCollapsed(e){return this.collapsed?this.expand(e):this.collapse(e)}get expandedHeaderDock(){var e,t,r;return null!=(r=null!=(t=this._expandedHeaderDock)?t:null==(e=this.initialConfig.header)?void 0:e.dock)?r:"top"}set expandedHeaderDock(e){this._expandedHeaderDock=null==e?void 0:e.toLowerCase()}updateHeader(e){this.changingCollapse||(this.expandedHeaderDock=null==e?void 0:e.dock)}updateTrapFocus(e){var t;const r=this;r.element.classList[e?"add":"remove"]("b-focus-trapped"),r.focusTrapListener=null==(t=r.focusTrapListener)?void 0:t.call(r),e&&(r.focusTrapListener=EventHelper.on({element:r.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:r}),r.treeWalker||(r.treeWalker=this.setupTreeWalker(r.element,DomHelper.NodeFilter.SHOW_ELEMENT,acceptNode)))}setupTreeWalker(e,t,r){return document.createTreeWalker(e,t,r)}onFocusTrapped(e){const t=this,r=t.treeWalker;if(e.target===t.bottomFocusTrap)r.currentNode=t.topFocusTrap,r.nextNode();else{if(e.target!==t.topFocusTrap)return;r.currentNode=t.bottomFocusTrap,r.previousNode()}t.requestAnimationFrame((()=>r.currentNode.focus()))}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){var e;const t=this,r=super.widgetClassList;return t.hasHeader&&r.push("b-panel-has-header","b-header-dock-"+((null==(e=t.header)?void 0:e.dock)||"top")),t.tbar&&r.push("b-panel-has-top-toolbar"),t.bbar&&r.push("b-panel-has-bottom-toolbar"),r}};Panel.initClass(),Panel._$name="Panel";var Popup=class extends Panel{static get $name(){return"Popup"}static get type(){return"popup"}static get configurable(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},stripDefaults:{bbar:{layout:{justify:"flex-end"}}},testConfig:{hideAnimation:null,showAnimation:null},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,maximizable:null,modal:null,maximized:null,tools:{close:{cls:"b-popup-close",handler:"close",weight:-1e3,ariaLabel:"L{Popup.close}",hidden:!0},maximize:{cls:"b-popup-expand",handler:"toggleMaximized",weight:-999,hidden:!0}},highlightReturnedFocus:!0,role:"dialog"}}finalizeInit(){const e=this,{forElement:t}=e;e.anchoredTo=t,e.initialAnchor=e.anchor,t&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),EventHelper.on({element:t,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),!e.autoShow||t&&!DomHelper.isVisible(t)||(!0===e.autoShow?e.show():e.setTimeout((()=>e.show()),e.autoShow))}onPaint({firstPaint:e}){var t;null==(t=super.onPaint)||t.call(this,...arguments);const r=this;e&&r.headerElement&&EventHelper.on({element:r.headerElement,dblclick:r.onHeaderDblClick,thisObj:r})}doDestroy(){this.syncModalMask(),super.doDestroy()}compose(){const{hasNoChildren:e,textContent:t}=this;return{class:{"b-text-popup":Boolean(t&&e)}}}close(){const e=this;if(!e._hidden&&!1!==e.trigger("beforeClose")||e._hidden&&"destroy"===e.closeAction)return e.modal&&"destroy"===e.closeAction&&e.revertFocus(),e.unmask(),e.containsFocus&&e.highlightReturnedFocus&&e.setTimeout((()=>e.element.classList.add("b-using-keyboard")),0),e[e.closeAction]()}toggleMaximized(){this.maximized=!this.maximized}updateMaximized(e){DomHelper.toggleClasses(this.element,["b-maximized"],e)}onInternalKeyDown(e){const t=this;"Escape"===e.key&&(e.stopImmediatePropagation(),t.floating||t.positioned?t.close(!0):t.collapsible&&(t.revealed?t.collapsible.toggleReveal():t.collapse()))}onDocumentMouseDown({event:e}){const t=this,{owner:r}=t,{target:n}=e;if("touchend"!==e.type&&(null==r?void 0:r.isButton)&&r._menu===t&&r.element.contains(n))return e.preventDefault(),!1;t.modal&&n===Popup.modalMask?(e.preventDefault(),t.modal.closeOnMaskTap?t.close():t.containsFocus||t.focus()):t.owns(n)||!t.autoClose||t.containsFocus||t.close()}get isTopModal(){return DomHelper.isVisible(Popup.modalMask)&&this.element.previousElementSibling===Popup.modalMask}onFocusIn(e){const t=DomHelper.getActiveElement(this);super.onFocusIn(e),DomHelper.getActiveElement(this)===t&&e.target===this.element&&this.focus()}onFocusOut(e){globalThis.visualViewport&&globalThis.visualViewport.height<document.documentElement.clientHeight-1||this.modal||!this.autoClose||this.close(),super.onFocusOut(e)}onShow(){var e;const t=this;t.autoClose&&t.addDocumentMouseDownListener(),t.focusOnToFront&&t.focus(),null==(e=super.onShow)||e.call(this),t.syncModalMask()}addDocumentMouseDownListener(){this.mouseDownRemover||(this.mouseDownRemover=GlobalEvents_default.ion({globaltap:"onDocumentMouseDown",thisObj:this}))}updateModal(e){e&&(this.floating=!0)}syncModalMask(){const e=this,{modal:t,element:r}=e;if(r.setAttribute("aria-modal",Boolean(t)),t&&e.isVisible)"number"!=typeof e._x&&"number"!=typeof e._y&&(e.centered=!0,e.anchor=!1),e.modalMask.classList.remove("b-hide-display"),r.classList.add("b-modal");else if(e.isPainted){r.classList.remove("b-modal");const t=e.floatRoot.querySelectorAll(".b-modal"),n=t.length?Popup.fromElement(t[t.length-1],"popup"):null;n?n.syncModalMask():Popup.modalMask.classList.add("b-hide-display")}}onHide(){var e,t;const r=this;null==(e=r.mouseDownRemover)||e.call(r),r.mouseDownRemover=null,null==(t=super.onHide)||t.call(this),r.syncModalMask()}onElementUserAction(){this.show()}onHeaderDblClick(){this.maximizable&&this.toggleMaximized()}updateClosable(e){this.tools.close.hidden=!e}updateMaximizable(e){this.tools.maximize.hidden=!e}get modalMask(){const{modalMask:e}=Popup;return e.nextElementSibling!==this.element&&this.floatRoot.insertBefore(e,this.element),e}static get modalMask(){return this._modalMask||(this._modalMask=DomHelper.createElement({className:"b-modal-mask b-hide-display"}),EventHelper.on({element:this._modalMask,wheel:e=>e.preventDefault()})),this._modalMask}};Popup.initClass(),Popup._$name="Popup";var bIcon2=/^gt-icon-/,bFa2=/^b-fa-/,MenuItem=class extends Widget{static get $name(){return"MenuItem"}static get type(){return"menuitem"}static get configurable(){return{checked:null,separator:null,toggleGroup:null,menu:{value:null,$config:["lazy","nullify"]},icon:null,closeParent:null,href:null,target:null,localizableProperties:["text"],role:"menuitem",closeMenuDelay:200}}updateElement(e,t){const r=super.updateElement(e,t);return"boolean"==typeof this.checked&&(this.role="menuitemcheckbox"),this.ariaHasPopup=!!this.hasMenu&&"menu",r}compose(){var e;const t=this,{checked:r,href:n,hasMenu:i,separator:s,target:a,text:o,toggleGroup:l}=t,c="boolean"==typeof r,d=t.icon||(c?"b-fw-icon":""),u="gt-icon-"+(l?"radio-":""),h="object"==typeof o;return{tag:n?"a":"div",tabIndex:-1,href:n,target:a,class:{"b-has-submenu":i,"b-checked":r,"b-separator":s||(null==(e=t.cls)?void 0:e["b-separator"])},dataset:{group:t.toggleGroup},[c?"aria-checked":""]:r,[i?"aria-expanded":""]:!1,children:{iconElement:d&&{"aria-hidden":!0,tag:"i",class:{"b-fa":bFa2.test(d),"gt-icon":bIcon2.test(d),"b-menuitem-icon":1,[u+"checked"]:!0===r,[u+"unchecked"]:!1===r,...DomClassList.normalize(d,"object")}},textElement:{tag:"span",html:h?null:o,class:{"b-menu-text":1,"b-menu-custom-content":h},children:h?[o]:null},subMenuIcon:i&&{"aria-hidden":!0,tag:"i",class:{"b-fw-icon":1,"gt-icon-sub-menu":1}}}}}doAction(e){const t=this,r=this.parent,n={menu:r,item:t,element:t.element,bubbles:!0};if("boolean"==typeof t.checked){const e=!t.checked;t.toggleGroup&&!e||(t.checked=!t.checked)}t.trigger("beforeItem",n),t.trigger("item",n),t.closeParent&&r&&(r.rootMenu.close(),e&&!t.href&&e.preventDefault())}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const{focusElement:e}=this;return e&&this.isVisible&&(e===document.body||e.offsetParent)}get hasMenu(){return this.hasConfig("menu")}get childItems(){const{_menu:e}=this;return e?[e]:[]}get text(){return this.html}set text(e){this.html=e}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.delay("openMenu",200)}onFocusOut(e){this.clearTimeout("openMenu"),super.onFocusOut(e),this._menu&&(this.menu.closeTimer=this.menu.setTimeout((()=>this.closeMenu()),this.closeMenuDelay))}openMenu(e){const{menu:t}=this;!this.disabled&&t&&(t.focusOnToFront=e,t.show())}onChildShow(e){super.onChildShow(e),this.ariaElement.setAttribute("aria-expanded",!0)}closeMenu(){this._menu instanceof Widget&&this.menu.close()}onChildHide(e){super.onChildHide(e),this.ariaElement.setAttribute("aria-expanded",!1)}changeToggleGroup(e){return e&&"boolean"!=typeof this.checked&&(this.checked=!1),e}changeChecked(e,t){if(this.isConfiguring||"boolean"==typeof t)return Boolean(e)}updateChecked(e){const t=this;t.isConfiguring||(t.toggleGroup&&t.uncheckToggleGroupMembers(),t.element.setAttribute("aria-checked",e),t.trigger("toggle",{menu:t.owner,item:t,element:t.element,bubbles:!0,checked:e}))}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:r,element:n}=e,i=[];return t&&r&&DomHelper.forEachSelector(e.rootElement,"[data-group="+r+"]",(e=>{if(e!==n){const t=Widget.fromElement(e);t&&i.push(t)}})),i}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}changeMenu(e,t){const r=this,{constrainTo:n,scrollAction:i}=r.owner;return!e||"object"!=typeof e||"items"in e||"widgets"in e||"html"in e||(e={lazyItems:e}),Menu.reconfigure(t,e,{owner:r,defaults:{type:"menu",align:"s0-e0",anchor:!0,autoClose:!0,autoShow:!1,cls:"b-sub-menu",forElement:r.element,owner:r,ariaLabel:r.text,constrainTo:n,scrollAction:i}})}};MenuItem.initClass(),MenuItem._$name="MenuItem";var contextMenuKeyEvent,validKeys={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},Menu=class extends Popup{static get $name(){return"Menu"}static get type(){return"menu"}static get configurable(){return{focusable:!0,align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem",tools:{close:!1},role:"menu",ariaElement:"bodyElement"}}construct(e){Array.isArray(e)&&(e={lazyItems:e}),super.construct(e),EventHelper.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",thisObj:this})}afterShow(){const{items:e,element:t}=this;e.some((e=>Boolean(e._menu)))&&t.classList.add("b-menu-with-submenu");e.some((e=>e.icon))&&t.classList.add("b-menu-with-icon"),super.afterShow(...arguments)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){var e;const t=this,r=null==(e=t.parentMenu)?void 0:e.element.contains(DomHelper.getActiveElement(t.parentMenu)),n=t.items[0];return!r&&!DomHelper.usingKeyboard&&n instanceof MenuItem?t.element:super.focusElement}onDocumentMouseDown({event:e}){if(!this.parentMenu||!this.parentMenu.owns(e.target))return super.onDocumentMouseDown(...arguments)}hide(e){var t,r;const n=this;super.hide(e),n.isVisible||(null==(r=null==(t=n.currentSubMenu)?void 0:t.hide)||r.call(t,e),n.parentMenu&&(n.parentMenu.currentSubMenu=null))}show(){super.show(...arguments);const{parentMenu:e}=this;this.isVisible&&e&&(e.currentSubMenu=this)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&this.triggerElement(t,e)}onMouseOver(e){var t;if(!1!==this.focusOnHover){const r=null==(t=e.relatedTarget)?void 0:t.closest(".b-widget"),n=e.target.closest(".b-widget"),i=Widget.fromElement(n);!DomHelper.isTouchEvent&&n&&n!==r&&i.parent===this&&this.setTimeout({fn:"handleMouseOver",delay:30,args:[i],cancelOutstanding:!0})}}handleMouseOver(e){e.focus()}onMouseEnter(){this.clearTimeout(this.closeTimer)}onMouseLeave(e){const t=this,{relatedTarget:r}=e,n=r&&t.owns(r);let i=r instanceof HTMLElement&&Widget.fromElement(r),s=!n;if(i){for(;i.ownerCmp;)i=i.ownerCmp;s&=!DomHelper.getAncestor(i.element,[e.target])}!n&&s&&(t.currentSubMenu&&!t.currentSubMenu.closeTimer&&t.currentSubMenu.hide(),t.element.contains(DomHelper.getActiveElement(t))&&DomHelper.getActiveElement(t).matches(".b-menuitem")&&t.focusElement.focus())}onInternalKeyDown(e){const t=Widget.fromElement(e),r=t&&t!==this&&!(t instanceof MenuItem);if("Escape"===e.key)return void(r?this:this.rootMenu).close();if(super.onInternalKeyDown(e),r)return;validKeys[e.key]&&e.preventDefault();const n=this.element,i=DomHelper.getActiveElement(n);this.navigateFrom(i!==n&&n.contains(i)?i:null,e.key,e)}navigateFrom(e,t,r){const n=this,{treeWalker:i}=n,s=e&&n.getItem(e),a=n.rtl?"ArrowLeft":"ArrowRight",o=n.rtl?"ArrowRight":"ArrowLeft";let l;switch(t){case"ArrowUp":i.currentNode=e||(e=n.bottomFocusTrap),i.previousNode(),l=i.currentNode;break;case"ArrowDown":i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),l=i.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&((null==s?void 0:s.menu)?n.openSubMenu(e,s):n.triggerElement(e,r));break;case a:if(e&&(null==s?void 0:s.menu)&&!e.classList.contains("b-disabled")){const t=n.openSubMenu(e,s);null==t||t.focus()}else i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),l=i.currentNode;break;case o:n.isSubMenu?n.hide():e||(i.currentNode=e||(e=n.topFocusTrap),i.nextNode(),l=i.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&n.triggerElement(e,r)}l&&(l===n.element?n.navigateFrom(n.bottomFocusTrap,"ArrowUp",r):l===e?n.navigateFrom(n.topFocusTrap,"ArrowDown",r):l.focus())}getItem(e){if(null!=e)return"number"==typeof e?this.items[e]:e.nodeType===Element.ELEMENT_NODE?Widget.fromElement(e,"menuitem",this.contentElement):this.items.find((t=>t.id==e))}triggerElement(e,t){const r=this.getItem(e);r&&!r.disabled&&r.doAction(t)}get isSubMenu(){var e;return this===(null==(e=this.owner)?void 0:e.menu)}openSubMenu(e,t){var r;const n=this,i=t.menu;if(i){if(!i.isVisible){const s={item:t,element:e};if(!1===n.trigger("beforeSubMenu",s))return;if(!1===(null==(r=t.onBeforeSubMenu)?void 0:r.call(t,s)))return;i.show()}return n.currentSubMenu=i}}set selectedElement(e){const t=this,r=t._selectedElement;if(r){const e=t.getItem(r),n=null==e?void 0:e.menu;null==n||n.hide(),r.classList.remove("b-active")}if(t._selectedElement=e,e){const r=DomHelper.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!r,focus:r})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame((()=>e.currentNode.focus()))}get parentMenu(){var e;const t=this.owner;return t&&(t.isMenu?t:null==(e=t.up)?void 0:e.call(t,"menu"))}get rootMenu(){let e=this;for(;e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}};Menu.initClass(),Menu._$name="Menu";var ContextMenuBase=class extends InstancePlugin{static get $name(){return"ContextMenuBase"}static get configurable(){return{type:null,menu:{$config:["lazy","nullify"],value:{type:"menu",autoShow:!1,closeAction:"hide",scrollAction:"hide",constrainTo:globalThis}},items:{},triggerEvent:!1,keyMap:{" ":{handler:"showContextMenuByKey",weight:100},"Ctrl+Space":"showContextMenuByKey"}}}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick"]}}construct(...e){var t;if(super.construct(...e),!(null==(t=this.type)?void 0:t.length))throw new Error('需要为上下文菜单指定配置"类型"')}onElementContextMenu(e){this.onElementEvent(e)}onElementClick(e){this.onElementEvent(e)}onElementDblClick(e){this.onElementEvent(e)}onElementEvent(e){if(!e.handled&&this.triggerEvent===e.type){if(!0===e.ctrlKey&&!BrowserHelper.isMac)return void e.preventDefault();const t=e;if(contextMenuKeyEvent){const{target:r}=contextMenuKeyEvent;e=EventHelper.fixEvent(new MouseEvent(e.type,e)),Object.defineProperty(e,"target",{get:()=>r,configurable:!0}),e.preventDefault=function(){t.preventDefault(),t.handled=!0}}this.internalShowContextMenu(e)}}showContextMenuByKey(e){if(!DomHelper.isEditable(e.target)){const t=this.getKeyboardContextMenuTarget(e.target);if(t)return contextMenuKeyEvent=e,DomHelper.triggerMouseEvent(t,this.triggerEvent),e.handled=!0,e.preventDefault(),e.stopImmediatePropagation(),contextMenuKeyEvent=null,!0}return!1}getKeyboardContextMenuTarget(e){const t=DomHelper.isInView(e);return e.children.length?DomHelper.childFromPoint(e,t.width/2,t.height/2):e}internalShowContextMenu(e){const t=this;if(t.disabled)return;const r=t.getDataFromEvent(e);!e.handled&&!e.defaultPrevented&&r&&t.shouldShowMenu(r)&&("contextmenu"===e.type&&BrowserHelper.isSafari&&e.ctrlKey&&!e.metaKey&&EventHelper.on({element:e.target,capture:!0,once:!0,thisObj:this,click(e){e.preventDefault(),e.stopImmediatePropagation()}}),r.domEvent=e,t.showContextMenu(r))}getDataFromEvent(e){return{event:e,targetElement:this.getTargetElementFromEvent(e)}}getTargetElementFromEvent(e){return e.target}async showContextMenu(e,t){var r,n;const i=this,s=DomHelper.isDOMEvent(e),a=s?i.getDataFromEvent(e):e,o=s?e:a.domEvent;if(null==(r=i._menu)||r.hide(),i.disabled)return;i.menuContext=a;const{type:l,client:c,processItems:d}=i,u=DomHelper.isInView(a.targetElement).center;if(Objects.assign(a,{feature:i,point:(null==o?void 0:o.clientX)?[o.clientX+1,o.clientY+1]:[u.x,u.y],menu:i,items:{},selection:c.selectedRecords}),i.callChainablePopulateMenuMethod(a),Objects.merge(a.items,i.baseItems),i.preventDefaultEvent(a),(!d||!1!==i.callback(d,c,[a]))&&i.hasActiveMenuItems(a)&&(i.populateItemsWithData(a),!1!==i.beforeContextMenuShow(a))){const{menu:e}=i;let r=c.trigger(l+"MenuBeforeShow",a);ObjectHelper.isPromise(r)&&(o.handled=!0,r=await r),!1!==r&&(e.items=a.items,e.showBy(t||{target:a.domEvent}),null==(n=i.touchMoveDetacher)||n.call(i),i.touchMoveDetacher=EventHelper.on({element:c.element,touchmove:()=>e.hide(),thisObj:e,once:!0}),o&&(o.preventDefault(),o.handled=!0))}}get baseItems(){if(!this._baseItems){const e=this,{namedItems:t}=e,r=e._baseItems=Objects.assign({},e.items);for(const e in r){const n=r[e];n&&(t&&e in t?r[e]="object"==typeof n?Objects.merge(Objects.clone(t[e]),n):t[e]:!0===n&&delete r[e])}}return this._baseItems}hideContextMenu(e){var t;null==(t=this.menu)||t.hide(e)}callChainablePopulateMenuMethod(e){var t,r;null==(r=(t=this.client)["populate"+StringHelper.capitalize(this.type)+"Menu"])||r.call(t,e)}hasActiveMenuItems(e){return Object.values(e.items).some((e=>e&&!e.hidden))}shouldShowMenu(){return!0}beforeContextMenuShow(e){}populateItemsWithData(e){}preventDefaultEvent(e){var t;null==(t=e.event)||t.preventDefault()}changeTriggerEvent(e){return e||this.client.contextMenuTriggerEvent}changeMenu(e,t){const r=this,{client:n,type:i}=r;if(e)return Menu.reconfigure(t,e?Menu.mergeConfigs({owner:n,rootElement:n.rootElement,onItem(e){n.trigger(i+"MenuItem",e)},onToggle(e){n.trigger(i+"MenuToggleItem",e)},onDestroy(){r.menu=null},onBeforeItem(e){Object.assign(e,r.menuContext)},onShow({source:e}){r.menuContext.menu=e,n.trigger(i+"MenuShow",r.menuContext)}},e):null,r);(null==t?void 0:t.isWidget)&&t.destroy()}};ContextMenuBase._$name="ContextMenuBase";var CSSHelper=class{static insertRule(e,t=document.head){const r=this.getStyleSheet(t),n=r.cssRules.length;if(r.insertRule(e,0),r.cssRules.length>n)return r.cssRules[0]}static findRule(e){let t;const r="function"==typeof e;return Array.prototype.find.call(document.head.querySelectorAll("link[rel=stylesheet],style[type*=css]"),(n=>{if(t=Array.prototype.find.call(n.sheet.rules||n.sheet.cssRules,(t=>r?e(t):t.selectorText===e)),t)return!0})),t}static getStyleSheet(e=document.head){return e.$ganttStylesheet||(e.$ganttStylesheet=DomHelper.createElement({tag:"style",id:"gantt-private-styles",type:"text/css",parent:e}).sheet),e.$ganttStylesheet}};CSSHelper._$name="CSSHelper";var DragHelperContainer_default=e=>class extends(e||Base){static get $name(){return"DragHelperContainer"}initContainerDrag(){const e=this;if(e.mode||(e.mode="container"),"container"===e.mode&&!e.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!e.target.closest(t.ignoreSelector)){const r=DomHelper.getAncestor(e.target,t.containers,t.outerElement);if(r){const n=r.getBoundingClientRect();t.context={element:r,valid:!0,action:"container",offsetX:e.pageX-n.left,offsetY:e.pageY-n.top,originalPosition:{parent:r.parentElement,prev:r.previousElementSibling,next:r.nextElementSibling}}}return!0}return!1}startContainerDrag(e){var t;const r=this,{context:n,floatRootOwner:i}=r,{element:s}=n,a=s.cloneNode(!0),o=s.getBoundingClientRect(),l=null==i?void 0:i.element.closest(".b-outer");a.classList.add(r.dragProxyCls),a.classList.add(r.draggingCls),((null==i?void 0:i.floatRoot)||DomHelper.getRootElement(s)).appendChild(a),n.dragProxy=a,a.style.width=o.width+"px",a.style.height=o.height+"px",DomHelper.setTranslateXY(n.dragProxy,o.left,o.top),n.dragging=s,s.classList.add(r.dropPlaceholderCls),(null==(t=null==l?void 0:l.parentElement)?void 0:t.matches(".b-float-root"))&&(a.style.zIndex=i.floatRootMaxZIndex+1)}updateContainerDrag(e){var t;const r=this,{context:n}=r;if(!n.started||!n.targetElement)return;const i=DomHelper.getAncestor(n.targetElement,r.containers,"b-gridbase"),s=null==(t=n.dragging)?void 0:t.contains(DomHelper.getActiveElement(n.dragging));i&&DomHelper.isDescendant(n.element,i)||(s&&GlobalEvents_default.suspendFocusEvents(),i&&n.valid?r.moveNextTo(i,e):r.revertPosition(),s&&GlobalEvents_default.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,{context:r}=t,{dragging:n,dragProxy:i,valid:s,draggedTo:a,insertBefore:o,originalPosition:l}=r;n&&(r.valid=s&&a&&(n!==o||l.parent!==a),r.finalize=(e=r.valid)=>{!e&&t.context&&t.revertPosition(),n.classList.remove(t.dropPlaceholderCls),i.remove(),t.reset()},r.async=!1,t.trigger("drop",{context:r,event:e}),r.async||r.finalize())}abortContainerDrag(e=!1,t=null,r=!1){const n=this,{context:i}=n;i.dragging&&(i.dragging.classList.remove(n.dropPlaceholderCls),i.dragProxy.remove(),n.revertPosition()),r||n.trigger(e?"drop":"abort",{context:i,event:t}),n.reset()}updateContainerProxy(e){const t=this,{context:r}=t,n=r.dragProxy;let i,s=e.pageX-r.offsetX,a=e.pageY-r.offsetY;if("number"==typeof t.minX&&(s=Math.max(t.minX,s)),"number"==typeof t.maxX&&(s=Math.min(t.maxX-n.offsetWidth,s)),"number"==typeof t.minY&&(a=Math.max(t.minY,a)),"number"==typeof t.maxY&&(a=Math.min(t.maxY-n.offsetHeight,a)),t.lockX?DomHelper.setTranslateY(n,a):t.lockY?DomHelper.setTranslateX(n,s):DomHelper.setTranslateXY(n,s,a),"touchmove"===e.type){const t=e.changedTouches[0];i=DomHelper.elementFromPoint(t.clientX,t.clientY)}else i=e.target;r.targetElement=i}moveNextTo(e,t){const{context:r}=this,n=r.dragging,i=e.parentElement;if(e!==n){const s=Rectangle.from(e).center.x;this.isRTL&&t.pageX>s||!this.isRTL&&t.pageX<s?(i.insertBefore(n,e),r.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==n?(r.insertBefore=e.nextElementSibling,i.insertBefore(n,e.nextElementSibling)):r.insertBefore||n.parentElement.lastElementChild===n||(r.insertBefore=e.nextElementSibling):(i.appendChild(n),r.insertBefore=null),r.draggedTo=i}}revertPosition(){const{context:e}=this,{dragging:t}=e,{parent:r,next:n}=e.originalPosition;if(n){n.previousSibling===t||!n&&t===r.lastChild||r.insertBefore(t,n)}else r.appendChild(t);e.draggedTo=null}},noScroll={pageXOffset:0,pageYOffset:0},DragHelperTranslate_default=e=>class extends(Delayable_default(e||Base)){static get $name(){return"DragHelperTranslate"}static get configurable(){return{positioning:null,skipUpdatingElement:null}}initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=t=>t.closest(e.targetSelector))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,element:t,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return e.target.closest(this.targetSelector)}getX(e){return"absolute"===this.positioning?parseFloat(e.style.left,10):DomHelper.getTranslateX(e)}getY(e){return"absolute"===this.positioning?parseFloat(e.style.top,10):DomHelper.getTranslateY(e)}getXY(e){return"absolute"===this.positioning?[e.offsetLeft,e.offsetTop]:DomHelper.getTranslateXY(e)}setXY(e,t,r){this.skipUpdatingElement||("absolute"===this.positioning?(e.style.left=t+"px",e.style.top=r+"px"):DomHelper.setTranslateXY(e,t,r))}startTranslateDrag(e){const t=this,{context:r,outerElement:n,proxySelector:i}=t,s=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body;let a=r.dragProxy||r.element;const o=a,l=a.parentElement;if(t.cloneTarget){const n=i?a.querySelector(i):a,{width:l,height:c,x:d,y:u}=Rectangle.from(n,s);a=t.createProxy(a);let h=d,g=u;if(t.autoSizeClonedTarget&&(a.style.width=l+"px",a.style.height=c+"px"),a.classList.add(t.dragProxyCls,t.draggingCls),a.classList.remove("b-hover","b-selected","b-focused"),s.appendChild(a),!t.autoSizeClonedTarget||i){const t=a.getBoundingClientRect(),{x:n,y:i}=s.getBoundingClientRect(),o=e.clientX-n,l=e.clientY-i+(s!==document.body?document.body.getBoundingClientRect().y:0);h=o-t.width/2,g=l-t.height/2,r.startPageX=e.pageX,r.startPageY=e.pageY}t.setXY(a,h,g),o.classList.add("b-drag-original"),t.hideOriginalElement&&o.classList.add("b-hidden")}a.classList.add(t.draggingCls),Object.assign(r,{element:a,grabbed:o,grabbedParent:l,grabbedNextSibling:a.nextElementSibling,elementStartX:t.getX(a),elementStartY:t.getY(a),elementX:DomHelper.getOffsetX(a,s||n),elementY:DomHelper.getOffsetY(a,s||n),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||s===n}),s&&(r.parentElement=a.parentElement,s!==a.parentElement&&s.appendChild(a),t.updateTranslateProxy(e))}onDragStarted(){const e=this,{context:t}=e;let{relatedElements:r}=t;if(e.unifiedProxy&&t.element.classList.add("b-drag-main","b-drag-unified-proxy"),(null==r?void 0:r.length)>0){t.relatedElStartPos=[],t.relatedElDragFromPos=[];const{proxySelector:n}=e;let[i,s]=[t.elementStartX,t.elementStartY];t.originalRelatedElements=r,r=t.relatedElements=r.map(((r,a)=>{const o=n?r.querySelector(n):r,{x:l,y:c,width:d,height:u}=Rectangle.from(o,e.dragWithin),h=e.cloneTarget?e.createProxy(r):r;return h.classList.add(e.draggingCls),h.classList.remove("b-hover","b-selected","b-focused"),e.cloneTarget&&(e.setXY(h,l,c),e.dragWithin.appendChild(h),h.classList.add(e.dragProxyCls),e.autoSizeClonedTarget&&(h.style.width=d+"px",h.style.height=u+"px"),e.hideOriginalElement&&r.classList.add("b-hidden"),r.classList.add("b-drag-original")),t.relatedElStartPos[a]=t.relatedElDragFromPos[a]=e.getXY(h),e.unifiedProxy&&(h.classList.add("b-drag-unified-animation","b-drag-unified-proxy"),i+=e.unifiedOffset,s+=e.unifiedOffset,e.setXY(h,i,s),t.relatedElDragFromPos[a]=[i,s],h.style.zIndex=100-a),h})),e.unifiedProxy&&r&&r.length>0&&EventHelper.onTransitionEnd({element:r[0],property:"transform",handler(){r.forEach((e=>e.classList.remove("b-drag-unified-animation")))},thisObj:e,once:!0})}}applyConstraints(e,t,r){const n=this,{constrain:i,dragWithin:s}=n,{pageXOffset:a,pageYOffset:o}=s===document.body?globalThis:noScroll;return s&&i&&(t<0&&(t=0),t+e.offsetWidth>s.scrollWidth&&(t=s.scrollWidth-e.offsetWidth),r<0&&(r=0),r+e.offsetHeight>s.scrollHeight&&(r=s.scrollHeight-e.offsetHeight)),"number"==typeof n.minX&&(t=Math.max(n.minX+a,t)),"number"==typeof n.maxX&&(t=Math.min(n.maxX+a,t)),"number"==typeof n.minY&&(r=Math.max(n.minY+o,r)),"number"==typeof n.maxY&&(r=Math.min(n.maxY+o,r)),{constrainedX:t,constrainedY:r}}updateTranslateProxy(e,t){const r=this,{lockX:n,lockY:i,context:s}=r,a=s.dragProxy||s.element,{relatedElements:o,relatedElDragFromPos:l}=s;s.scrollManagerElementContainsDragProxy&&t&&(s.scrollX=t.getRelativeLeftScroll(a),s.scrollY=t.getRelativeTopScroll(a)),s.pageX=e.pageX,s.pageY=e.pageY,s.clientX=e.clientX,s.clientY=e.clientY;let c=s.elementStartX+e.pageX-s.startPageX+s.scrollX,d=s.elementStartY+e.pageY-s.startPageY+s.scrollY;if(r.snapCoordinates){const e=r.snapCoordinates({element:a,newX:c,newY:d});c=e.x,d=e.y}const{constrainedX:u,constrainedY:h}=r.applyConstraints(a,c,d);if((s.started||u!==c||h!==d)&&r.setXY(a,n?void 0:u,i?void 0:h),o){const e=n?0:u-s.elementStartX,t=i?0:h-s.elementStartY;o.forEach(((n,i)=>{const[s,a]=l[i];r.setXY(n,s+e,a+t)}))}s.newX=u,s.newY=h}async finishTranslateDrag(e){const t=this,r=t.context,{target:n}=e,i=!t.lockX&&Math.round(r.newX)!==Math.round(r.elementStartX),s=!t.lockY&&Math.round(r.newY)!==Math.round(r.elementStartY),a=r.dragProxy||r.element,{relatedElements:o}=r;if(!t.ignoreSamePositionDrop||i||s)if(!1===r.valid)await t.abortTranslateDrag(!0,e);else{const i=!t.allowDropOutside&&Rectangle.from(t.dragWithin||t.outerElement);i&&("number"!=typeof t.minX&&!0!==t.minX&&e.pageX<i.left||"number"!=typeof t.maxX&&!0!==t.maxX&&e.pageX>i.right||"number"!=typeof t.minY&&!0!==t.minY&&e.pageY<i.top||"number"!=typeof t.maxY&&!0!==t.maxY&&e.pageY>i.bottom)?(r.valid=!1,await t.abortTranslateDrag(!0,e)):(r.finalize=async(i=r.valid)=>{r.finalized?console.warn("DragHelper: Finalizing already finalized drag"):(r.finalized=!0,!i&&t.context&&await t.abortTranslateDrag(!0,null,!0),t.isDestroyed||(t.trigger("dropFinalized",{context:r,event:e,target:n}),t.reset()),t.cloneTarget||a.parentElement===r.grabbedParent||[a,...o||[]].forEach((e=>e.style.transform="")))},r.async=!1,await t.trigger("drop",{context:r,event:e,target:n}),r.async||await r.finalize())}else t.abortTranslateDrag(!1,e)}async abortTranslateDrag(e=!1,t=null,r=!1){var n,i;const s=this,{cloneTarget:a,context:o,proxySelector:l,dragWithin:c,draggingCls:d}=s,{relatedElements:u,relatedElStartPos:h,grabbed:g}=o,p=o.dragProxy||o.element;if(null==(n=s.scrollManager)||n.stopMonitoring(),o.aborted)return void console.warn("DragHelper: Aborting already aborted drag");let{elementStartX:m,elementStartY:f}=o;if(p&&o.started){if(!a&&c&&c!==o.grabbedParent&&o.grabbedParent.insertBefore(p,o.grabbedNextSibling),a&&l){const e=g.querySelector(l)||g,{x:t,y:r}=Rectangle.from(e);m=t,f=r}p.classList.add("b-aborting"),s.setXY(p,m,f),null==u||u.forEach(((e,t)=>{e.classList.remove(d),e.classList.add("b-aborting"),s.setXY(e,h[t][0],h[t][1])})),r||s.trigger(e?"drop":"abort",{context:o,event:t}),p.isConnected&&!s.isDestroying&&await EventHelper.waitForTransitionEnd({element:p,property:DomHelper.getPropertyTransitionDuration(p,"transform")?"transform":"all",thisObj:s,once:!0,runOnDestroy:!0}),s.isDestroyed||s.trigger("abortFinalized",{context:o,event:t})}(null==(i=s.context)?void 0:i.started)&&s.reset()}cleanUp(){const{context:e,cloneTarget:t,draggingCls:r,dragProxyCls:n}=this,i=e.dragProxy||e.element,{relatedElements:s,originalRelatedElements:a,grabbed:o}=e,l=t&&(this.removeProxyAfterDrop||!e.valid),c=[r,"b-aborting",n,"b-drag-main","b-drag-unified-proxy"];i.classList.remove(...c),l&&i.remove(),null==s||s.forEach((e=>{l?e.remove():e.classList.remove(...c)})),o.classList.remove("b-drag-original","b-hidden"),null==a||a.forEach((e=>e.classList.remove("b-hidden","b-drag-original")))}},rootElementListeners={move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},DragHelper=class extends(Base.mixin(Events_default,DragHelperContainer_default,DragHelperTranslate_default)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",dragThreshold:5,outerElement:document.body,dragWithin:null,unifiedProxy:null,monitoringConfig:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:"translateXY",isElementDraggable:null,targetSelector:null,dropTargetSelector:null,dropTargetCls:null,proxySelector:null,cloneTarget:!1,autoSizeClonedTarget:!0,hideOriginalElement:!1,containers:null,ignoreSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,scrollManager:null,snapCoordinates:null,unifiedOffset:5,removeProxyAfterDrop:!0,clickSwallowDuration:50,ignoreSamePositionDrop:!0,allowDropOutside:null,floatRootOwner:null,mouseMoveListenerElement:document,testConfig:{transitionDuration:10,clickSwallowDuration:50,touchStartDelay:100},rtlSource:null,createProxy:null}}construct(e){const t=this;super.construct(e),t.initListeners(),t.isContainerDrag?t.initContainerDrag():t.initTranslateDrag(),t.onScrollManagerScrollCallback=t.onScrollManagerScrollCallback.bind(t)}doDestroy(){this.reset(!0),super.doDestroy()}initListeners(){const e=this,{outerElement:t}=e,r={element:t,pointerdown:"onPointerDown",thisObj:e};e.mouseMoveListenerElement=e.getMouseMoveListenerTarget(t),EventHelper.on(r)}getMouseMoveListenerTarget(e){const t=e.getRootNode();let r=this.mouseMoveListenerElement;return t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&"closed"===t.mode&&(r=e.closest(".b-outer")||r),r}get isRTL(){var e;return Boolean(null==(e=this.rtlSource)?void 0:e.rtl)}onPointerDown(e){const t=this;if(0!==e.button||!DomHelper.isVisible(e.target)||t.context)return;if(t.isElementDraggable&&!t.isElementDraggable(e.target,e))return;t.startEvent=e;if(t.isContainerDrag?t.grabContainerDrag(e):t.grabTranslateDrag(e)){t.blurDetacher=EventHelper.on({element:globalThis,blur:t.onWindowBlur,thisObj:t});const r={element:t.mouseMoveListenerElement,thisObj:t,capture:!0,keydown:rootElementListeners.keydown};if("touch"===e.pointerType?(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay"),r.touchmove={handler:rootElementListeners.touchmove,passive:!1},r.touchend=r.pointerup=rootElementListeners.touchend):(r.pointermove=rootElementListeners.move,r.pointerup=rootElementListeners.up),t.dragListenersDetacher=EventHelper.on(r),t.dragWithin&&t.dragWithin!==t.outerElement&&t.outerElement.contains(t.dragWithin)){const e=Rectangle.from(t.dragWithin,t.outerElement);t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}internalMove(e){var t,r,n;if(e.scrollInitiated)return;const i=this,{context:s}=i,a=EventHelper.getDistanceBetween(i.startEvent,e);if(i.touchStartTimer&&a>i.dragThreshold)i.abort(!0);else if(!i.touchStartTimer&&(null==s?void 0:s.element)&&(s.started||a>=i.dragThreshold)&&(null==(t=e.target)?void 0:t.nodeType)===Node.ELEMENT_NODE){if(!s.started){if(!1===i.trigger("beforeDragStart",{context:s,event:e}))return i.abort();i.isContainerDrag?i.startContainerDrag(e):i.startTranslateDrag(e),s.started=!0,null==(r=i.scrollManager)||r.startMonitoring(ObjectHelper.merge({scrollables:[{element:i.dragWithin||i.outerElement}],callback:i.onScrollManagerScrollCallback},i.monitoringConfig)),s.outermostEl=DomHelper.getOutermostElement(e.target),s.outermostEl.classList.add("b-draghelper-active"),i.dropTargetSelector&&i.dropTargetCls&&DomHelper.getRootElement(i.outerElement).querySelectorAll(i.dropTargetSelector).forEach((e=>e.classList.add(i.dropTargetCls))),i.trigger("dragStart",{context:s,event:e}),null==(n=i.onDragStarted)||n.call(i),i.trigger("afterDragStart",{context:s,event:e})}i.update(e),"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation())}}onScrollManagerScrollCallback(e){var t;const{lastMouseMoveEvent:r}=this;(null==(t=this.context)?void 0:t.element)&&r&&(r.isScroll=!0,this.update(r,e))}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const r=this,{context:n}=r,i=document.scrollingElement||document.body;let s=r.getMouseMoveEventTarget(e);if("touchmove"===e.type){const t=e.changedTouches[0];s=DomHelper.elementFromPoint(t.clientX+i.scrollLeft,t.clientY+i.scrollTop)}n.target=s;let a=r.allowDropOutside||!r.dragWithin||r.dragWithin.contains(e.target);a&&r.dropTargetSelector&&(a=a&&Boolean(null==s?void 0:s.closest(r.dropTargetSelector))),r.isContainerDrag?r.updateContainerProxy(e,t):r.updateTranslateProxy(e,t),n.valid=a,r.trigger("drag",{context:n,event:e}),r.isContainerDrag&&r.updateContainerDrag(e,t),n.valid=n.valid&&a;for(const e of r.draggedElements)e.classList.toggle(r.invalidCls,!n.valid);e&&(r.lastMouseMoveEvent=e)}get draggedElements(){var e;const{context:t}=this;return[t.dragProxy||t.element,...null!=(e=t.relatedElements)?e:[]]}async abort(e=!1){var t,r;const n=this,{context:i}=n;null==(r=null==(t=n.scrollManager)?void 0:t.stopMonitoring)||r.call(t),n.removeListeners(),(null==i?void 0:i.started)&&!i.aborted?(i.element.getBoundingClientRect(),i.valid=!1,n.isContainerDrag?n.abortContainerDrag(void 0,void 0,e):n.abortTranslateDrag(void 0,void 0,e),i.aborted=!0):n.reset(!0)}removeListeners(){var e,t;null==(e=this.dragListenersDetacher)||e.call(this),null==(t=this.blurDetacher)||t.call(this)}reset(e){const t=this,{context:r}=t;if(null==r?void 0:r.started){for(const e of t.draggedElements)e.classList.remove(t.invalidCls);r.outermostEl.classList.remove("b-draghelper-active"),t.isContainerDrag?r.dragProxy.remove():t.cleanUp(),t.dropTargetSelector&&t.dropTargetCls&&DomHelper.getRootElement(t.outerElement).querySelectorAll(t.dropTargetSelector).forEach((e=>e.classList.remove(t.dropTargetCls)))}t.removeListeners(),e||t.trigger("reset"),t.context=t.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){var t;const r=this,{context:n}=r;r.removeListeners(),n&&(null==(t=r.scrollManager)||t.stopMonitoring(),n.started?(e.stopPropagation(),n.finalizing=!0,r.isContainerDrag?r.finishContainerDrag(e):r.finishTranslateDrag(e),EventHelper.on({element:document,thisObj:r,click:rootElementListeners.docclick,capture:!0,expires:r.clickSwallowDuration,once:!0})):r.reset(!0))}onKeyDown(e){var t;(null==(t=this.context)?void 0:t.started)&&"Escape"===e.key&&(e.stopImmediatePropagation(),this.abort())}onWindowBlur(){this.context&&!this.context.finalizing&&this.abort()}createProxy(e){this.proxySelector&&(e=e.querySelector(this.proxySelector)||e);const t=e.cloneNode(!0);return t.removeAttribute("id"),t}get isContainerDrag(){return"container"===this.mode}async animateProxyTo(e,t={align:"c-c"}){const{context:r,draggedElements:n}=this,{element:i}=r,s=e.isRectangle?e:Rectangle.from(e);n.forEach((e=>{e.classList.add("b-drag-final-transition"),DomHelper.alignTo(e,s,t)})),await EventHelper.waitForTransitionEnd({element:i,property:"all",thisObj:this,once:!0}),n.forEach((e=>e.classList.remove("b-drag-final-transition")))}get isDragging(){var e;return Boolean(null==(e=this.context)?void 0:e.started)}getMouseMoveEventTarget(e){return e.isScroll?DomHelper.elementFromPoint(e.clientX,e.clientY):e.target}};DragHelper._$name="DragHelper";var documentListeners={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:{handler:"onTouchStart",passive:!1},touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},ResizeHelper=class extends(Events_default(Base)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,dynamicHandleSize:null,reservedSpace:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal",clickSwallowDuration:50,rtlSource:null}}construct(e){const t=this;super.construct(e),t.handleSelector||BrowserHelper.isHoverableDevice||(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}updateSkipUpdatingElement(e){e&&(this.skipTranslate=!0)}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=t=>t.closest(e.targetSelector)),e.grab){const{edge:t,element:r,event:n}=e.grab;e.startEvent=n;const i=e.getCursorOffsetToElementEdge(n,r,t);e.context={element:r,edge:t,valid:!0,async:!1,elementStartX:DomHelper.getTranslateX(r)||r.offsetLeft,elementStartY:DomHelper.getTranslateY(r)||r.offsetTop,newX:DomHelper.getTranslateX(r)||r.offsetLeft,newY:DomHelper.getTranslateY(r)||r.offsetTop,elementWidth:r.offsetWidth,elementHeight:r.offsetHeight,cursorOffset:i,startX:n.clientX+i.x+e.scrollLeft,startY:n.clientY+i.y+e.scrollTop,finalize:()=>{var t;return null==(t=e.reset)?void 0:t.call(e)}},r.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:documentListeners.down,touchstart:documentListeners.touchstart,thisObj:e};!e.handleSelector&&BrowserHelper.isHoverableDevice&&(t.mousemove={handler:documentListeners.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),EventHelper.on(t)}get isRTL(){var e;return Boolean(null==(e=this.rtlSource)?void 0:e.rtl)}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t={element:document,keydown:documentListeners.keydown,thisObj:this};e?(t.touchmove=documentListeners.touchmove,t.touchend=t.pointerup=documentListeners.touchend):(t.mousemove=documentListeners.move,t.mouseup=documentListeners.up),this.removeDragListeners=EventHelper.on(t)}removeDragListeners(){}reset(){var e;null==(e=this.removeDragListeners)||e.call(this),this.context=null,this.trigger("reset")}canResize(e,t){return!this.isElementResizable||this.isElementResizable(e,t)}onPointerDown(e,t){const r=this;r.startEvent=t,r.canResize(t.target,t)&&r.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),"touchstart"===t.type&&t.preventDefault(),r.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){var r;const n=this,{context:i,direction:s}=n;(null==i?void 0:i.element)&&(i.started||EventHelper.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)?(i.started||(null==(r=n.scrollManager)||r.startMonitoring(ObjectHelper.merge({scrollables:[{element:n.dragWithin||n.outerElement,direction:s}],callback:e=>{var t;return(null==(t=n.context)?void 0:t.element)&&n.lastMouseMoveEvent&&n.update(n.lastMouseMoveEvent,e)}},n.monitoringConfig)),n.trigger("resizeStart",{context:i,event:t}),i.started=!0),n.update(t)):e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}onPointerUp(e,t){var r,n,i;const s=this,a=s.context;null==(r=s.removeDragListeners)||r.call(s),a?(null==(n=s.scrollManager)||n.stopMonitoring(),a.started&&EventHelper.on({element:document,thisObj:s,click:documentListeners.docclick,expires:s.clickSwallowDuration,capture:!0,once:!0}),s.finishResize(t)):null==(i=s.reset)||i.call(s)}onTouchEnd(e){this.onPointerUp(!0,e)}onMouseUp(e){this.onPointerUp(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,r=t.context,n=Rectangle.from(t.outerElement);r.currentX=Math.max(Math.min(e.clientX+r.cursorOffset.x,n.right),n.x)+t.scrollLeft,r.currentY=Math.max(Math.min(e.clientY+r.cursorOffset.y,n.bottom),n.y)+t.scrollTop,e&&(t.updateResize(e)&&(t.trigger("resizing",{context:r,event:e}),r.element.classList.toggle(t.invalidCls,!1===r.valid)),t.lastMouseMoveEvent=e)}abort(e=!1){var t,r;const n=this;null==(r=null==(t=n.scrollManager)?void 0:t.stopMonitoring)||r.call(t),n.context?n.abortResize(null,e):n.isDestroyed||n.reset()}grabResizeHandle(e,t){const r=this;if(r.allowResize&&!r.allowResize(t.target,t))return!1;const n=r.handleSelector,i="touchstart"===t.type?t.changedTouches[0]:t,s=i.clientX,a=i.clientY,o=r.targetSelector?t.target.closest(r.targetSelector):t.target;if(o){let l;if(n){if(!t.target.matches(n))return!1;l="horizontal"===r.direction?t.pageX<DomHelper.getPageX(o)+o.offsetWidth/2?r.isRTL?"right":"left":r.isRTL?"left":"right":t.pageY<DomHelper.getPageY(o)+o.offsetHeight/2?"top":"bottom"}else if("horizontal"===r.direction?r.overLeftHandle(t,o)?l=r.isRTL?"right":"left":r.overRightHandle(t,o)&&(l=r.isRTL?"left":"right"):r.overTopHandle(t,o)?l="top":r.overBottomHandle(t,o)&&(l="bottom"),!l)return r.context=null,!1;"touchstart"===t.type&&t.preventDefault();const c=r.getCursorOffsetToElementEdge(i,o,l);if(!1!==r.trigger("beforeResizeStart",{element:o,event:t}))return r.context={element:o,edge:l,isTouch:e,valid:!0,async:!1,direction:r.direction,elementStartX:DomHelper.getTranslateX(o)||o.offsetLeft,elementStartY:DomHelper.getTranslateY(o)||o.offsetTop,newX:DomHelper.getTranslateX(o)||o.offsetLeft,newY:DomHelper.getTranslateY(o)||o.offsetTop,elementWidth:o.offsetWidth,elementHeight:o.offsetHeight,cursorOffset:c,startX:s+c.x+r.scrollLeft,startY:a+c.y+r.scrollTop,finalize:()=>{var e;return null==(e=r.reset)?void 0:e.call(r)}},o.classList.add(r.resizingCls),!0}return!1}getCursorOffsetToElementEdge(e,t,r){const n=Rectangle.from(t);let i=0,s=0;switch(r){case"left":i=n.x-(this.isRTL?n.width:0)-e.clientX;break;case"right":i=n.x+(this.isRTL?0:n.width)-e.clientX;break;case"top":s=n.y-e.clientY;break;case"bottom":s=n.y+n.height-e.clientY}return{x:i,y:s}}checkResizeHandles(e){const t=this,r=t.targetSelector?e.target.closest(t.targetSelector):e.target;if(!r||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement){let n;n="horizontal"===t.direction?t.overLeftHandle(e,r)||t.overRightHandle(e,r):t.overTopHandle(e,r)||t.overBottomHandle(e,r),n?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?e.target.closest(t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,{context:r,allowEdgeSwitch:n,skipTranslate:i,skipUpdatingElement:s}=t;let a;n&&("horizontal"===t.direction?r.edge=r.currentX>r.startX?"right":"left":r.edge=r.currentY>r.startY?"bottom":"top");const{element:o,elementStartX:l,elementStartY:c,elementWidth:d,elementHeight:u,edge:h}=r,{style:g}=o,p=r.currentX-r.startX,m=r.currentY-r.startY,f=DomHelper.getExtremalSizePX(o,"minWidth")||t.minWidth,v=DomHelper.getExtremalSizePX(o,"maxWidth")||t.maxWidth,y=DomHelper.getExtremalSizePX(o,"minHeight")||t.minHeight,b=DomHelper.getExtremalSizePX(o,"maxHeight")||t.maxHeight,C="right"===h&&!t.isRTL||"bottom"===h?1:-1,D=d+p*C,S=u+m*C;let E=Math.max(f,D),w=Math.max(y,S);if(v>0&&(E=Math.min(E,v)),b>0&&(w=Math.min(w,b)),g.flex&&(g.flex=""),"horizontal"===t.direction&&d!==E){if(s||(g.width=Math.abs(E)+"px"),r.newWidth=E,"left"===h||E<0){const e=Math.max(Math.min(l+d-t.minWidth,l+p),0);i||DomHelper.setTranslateX(o,Math.round(e)),r.newX=e}else"right"===h&&n&&!i&&DomHelper.setTranslateX(o,l);a=!0}else"vertical"===t.direction&&u!==S&&(s||(g.height=Math.abs(w)+"px"),r.newHeight=w,"top"===h||w<0?(r.newY=Math.max(Math.min(c+u-t.minHeight,c+m),0),i||DomHelper.setTranslateY(o,r.newY)):"bottom"===h&&n&&!i&&DomHelper.setTranslateY(o,c),a=!0);return a}finishResize(e){var t;const r=this,n=r.context,i={context:n,event:e};if(n.element.classList.remove(r.resizingCls),n.started){let e=!1;e="horizontal"===r.direction?n.newWidth&&n.newWidth!==n.elementWidth:n.newHeight&&n.newHeight!==n.elementHeight,r.trigger(e?"resize":"cancel",i),n.async||n.finalize()}else null==(t=r.reset)||t.call(r)}abortResize(e=null,t=!1){const r=this,n=r.context;n.element.classList.remove(r.resizingCls),"horizontal"===r.direction?(("left"===n.edge||n.allowEdgeSwitch&&!n.skipTranslate)&&DomHelper.setTranslateX(n.element,n.elementStartX),n.element.style.width=n.elementWidth+"px"):(DomHelper.setTranslateY(n.element,n.elementStartY),n.element.style.height=n.elementHeight+"px"),!t&&r.trigger("cancel",{context:n,event:e}),r.isDestroyed||r.reset()}highlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?e.currentElement.closest(e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}getDynamicHandleSize(e,t){const r=e?2:1,{handleSize:n}=this;return this.dynamicHandleSize&&n*r>t-this.reservedSpace?Math.max(Math.floor((t-this.reservedSpace)/r),0):n}overLeftHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.leftHandle&&r.canResize(t,e)&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.width=r.getDynamicHandleSize(r.rightHandle,n),i.width>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overRightHandle(e,t){const r=this,{offsetWidth:n}=t;if(r.rightHandle&&r.canResize(t,e)&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.x=i.right-r.getDynamicHandleSize(r.leftHandle,n),i.width>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overTopHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.topHandle&&r.canResize(t,e)&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.height=r.getDynamicHandleSize(r.bottomHandle,n),i.height>0&&i.contains(EventHelper.getPagePoint(e))}return!1}overBottomHandle(e,t){const r=this,{offsetHeight:n}=t;if(r.bottomHandle&&r.canResize(t,e)&&(n>=r.handleVisibilityThreshold||r.dynamicHandleSize)){const i=Rectangle.from(t);return i.y=i.bottom-r.getDynamicHandleSize(r.bottomHandle,n),i.height>0&&i.contains(EventHelper.getPagePoint(e))}return!1}};__publicField(ResizeHelper,"configurable",{skipUpdatingElement:null}),ResizeHelper._$name="ResizeHelper";var tagSpaceRe=/>[ \t\r\n]+</g,multiSpaceRe=/\s\s+/g,TemplateHelper=class{static tpl(e,...t){let r=0,n=t.map(((t,n)=>{let i=e[n];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),r++,i})).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(tagSpaceRe,"><").replace(multiSpaceRe," ").trim()}static docsTpl(e,...t){let r=0,n=t.map(((t,n)=>{let i=e[n];return Array.isArray(t)?i+=t.reduce(((e,t)=>e+(("string"==typeof t?t.trim():t)+"\n")),""):(void 0===t&&(t=""),i+="string"==typeof t?t.trim():t),r++,i})).join("");return r<=e.length&&(n+=e[e.length-1]),n.replace(tagSpaceRe,"><").trim()}static repeat(e){return function(...t){return TemplateHelper.tpl(...t).repeat(e)}}static loop(e){}};TemplateHelper._$name="TemplateHelper";var TimeZoneOffsetInfo=class extends Array{constructor(e,t){super(),this.timeZone=e,this.year=t}},TimeZoneDate=class{constructor(e,t){this.asString=e,this.timeZone=t,this.asArray=parseStringDate(e)}get asLocalDate(){return this._asLocalDate||(this._asLocalDate=new Date(...this.asArray)),this._asLocalDate}get asTicksUtc(){return this._asTicksUtc||(this._asTicksUtc=new Date(Date.UTC(...this.asArray)).getTime()),this._asTicksUtc}},toTimeZoneInternal=(e,t)=>{const r=e.toLocaleString("sv-SE",{timeZone:t});return new TimeZoneDate(r,t)},getOffsetUtc=(e,t)=>{const{asTicksUtc:r,asString:n}=toTimeZoneInternal(new Date(e),t);return{offset:(e-r)/6e4,tzTicksUtc:r,tzString:n}},parseStringDate=e=>{const t=e.split(/[\s-:]/).map((e=>1*e));return t[1]-=1,t},min=-6e4,hour=36e5,day=-864e5,month=2592e6,findOffsetDates=(e,t)=>{const r=offsetDateCache.get(e,t);if(r)return r;const n=new TimeZoneOffsetInfo(e,t),i=new Date(Date.UTC(t,0,1)).getTime();let s,a,o,l,c=i,d=month,u=0,h=[],g=null;for(;!l;)({offset:o,tzTicksUtc:s,tzString:a}=getOffsetUtc(c,e)),null==g?(g=o,n.push({offset:o})):d>0&&o!==g?d=d===month?day:min:d<0&&o===g&&(d===day?d=hour:(1===n.length?(n.push(h),g=h.offset):(n[0].startTicks=h.startTicks,n[0].startDateString=h.startDateString,l=!0),d=month)),h={offset:o,startDateString:a,startTicks:s},d===month&&(c=i,c+=u*month,u+=1),c+=d,u>11&&(l=!0);return offsetDateCache.set(n),n},offsetDateCache={_cache:{},get(e,t){var r;return null==(r=this._cache[e])?void 0:r[t]},set(e){const{timeZone:t}=e,{_cache:r}=this;r[t]||(r[t]={}),r[t][e.year]=e}},TimeZoneHelper=class{static get $name(){return"TimeZoneHelper"}static toTimeZone(e,t){if("number"==typeof t)return this.toUtcOffset(e,t);const r=toTimeZoneInternal(e,t);return r.asArray[3]!==r.asLocalDate.getHours()&&console.warn("Incorrect time zone conversion due to local DST-switch detected"),r.asLocalDate}static fromTimeZone(e,t){if("number"==typeof t)return this.fromUtcOffset(e,t);const r=this.dateAsArray(e),n=findOffsetDates(t,e.getUTCFullYear());let i=n[0].offset;if(2===n.length){const e=Date.UTC(...r);e>=n[1].startTicks&&e<n[0].startTicks&&(i=n[1].offset)}return r[4]+=i,new Date(Date.UTC(...r))}static toUtcOffset(e,t){const r=e.getTimezoneOffset()+t;return new Date(e.getTime()+60*r*1e3)}static fromUtcOffset(e,t){const r=-e.getTimezoneOffset()-t;return new Date(e.getTime()+60*r*1e3)}static dateAsArray(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]}};TimeZoneHelper.findOffsetDates=findOffsetDates,TimeZoneHelper._$name="TimeZoneHelper";var Toast=class extends Widget{static get $name(){return"Toast"}static get type(){return"toast"}static get configurable(){return{testConfig:{destroyTimeout:1,timeout:100},floating:!0,timeout:2500,autoDestroy:null,destroyTimeout:200,showProgress:!0,color:null,bottomMargin:20}}compose(){const{appendTo:e,color:t,html:r,showProgress:n,style:i,timeout:s}=this;return{parent:e||this.floatRoot,class:{...DomClassList.normalize(t,"object"),"b-toast-hide":1},html:r,style:i,children:{progressElement:n&&{style:"animation-duration:"+s/1e3+"s;",class:{"b-toast-progress":1}}},listeners:{click:"hide"}}}doDestroy(){this.untoast(),super.doDestroy()}get nextBottom(){const{bottomMargin:e,element:t}=this;return parseInt(t.style.bottom,10)+t.offsetHeight+e}async show(){var e,t;await super.show(...arguments);const r=this,{element:n}=r,{toasts:i}=Toast;i.includes(r)||(n.style.bottom=(null!=(t=null==(e=i[0])?void 0:e.nextBottom)?t:r.bottomMargin)+"px",i.unshift(r),n.getBoundingClientRect(),n.classList.remove("b-toast-hide"),r.timeout>0&&(r.hideTimeout=r.setTimeout("hide",r.timeout)))}async hide(){const e=this;e.untoast(),e.element.classList.add("b-toast-hide"),e.autoDestroy&&!e.destroyTimer&&(e.destroyTimer=e.setTimeout("destroy",e.destroyTimeout))}untoast(){const{toasts:e}=Toast;e.includes(this)&&e.splice(e.indexOf(this),1)}static hideAll(){Toast.toasts.slice().reverse().forEach((e=>e.hide()))}static show(e){const t=Toast.new({autoDestroy:!0,rootElement:document.body},"string"==typeof e?{html:e}:e);return t.show(),t}};Toast.toasts=[],Toast.initClass(),Toast._$name="Toast";var WidgetHelper=class{static getById(e){return Widget.getById(e)}static fromElement(e,t,r){return Widget.fromElement(e,t,r)}static createWidget(e={}){return e.isWidget?e:Widget.create(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return e.map((e=>Widget.create(ObjectHelper.assign({},t||{},e))))}static openPopup(e,t){return Widget.create(ObjectHelper.assign({forElement:e},"string"==typeof t?{html:t}:t),"popup")}static showContextMenu(e,t){const r=this;return r.currentContextMenu&&r.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new Point(...e)}:e instanceof Point&&(t.forElement={target:e}),r.currentContextMenu=Widget.create(t,"menu"),r.currentContextMenu.ion({destroy:()=>{r.currentContextMenu=null}}),r.currentContextMenu}static attachTooltip(e,t){return Widget.attachTooltip(e,t)}static hasTooltipAttached(e){return Widget.resolveType("tooltip").hasTooltipAttached(e)}static destroyTooltipAttached(e){return Widget.resolveType("tooltip").destroyTooltipAttached(e)}static mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={target:e,text:t}),Mask.mask(e,e.target)}static unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}static toast(e){return Toast.show(e)}};WidgetHelper._$name="WidgetHelper";var XMLHelper=class{static convertFromObject(e,t={}){Objects.assignIf(t,{rootName:"root",elementName:"element",includeHeader:!0,rootElementForArray:!0});const{rootName:r,elementName:n,includeHeader:i,rootElementForArray:s}=t;let{xmlns:a}=t;a=a?' xmlns="'+a+'"':"";const o=e=>{const t=[];for(const r in e){const i=e[r];if(Array.isArray(i)){s&&t.push("<"+r+">");for(const e of i)n.length?t.push("<"+n+">"):t.push("<"+r+">"),t.push(o(e)),n.length?t.push("</"+n+">"):t.push("</"+r+">");s&&t.push("</"+r+">")}else Objects.isObject(i)?t.push("<"+r+">"+o(i)+"</"+r+">"):null==i?t.push("<"+r+"/>"):t.push("<"+r+">"+StringHelper.encodeHtml(i)+"</"+r+">")}return t.join("")};return(i?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>':"")+"<"+r+a+">"+o(e)+"</"+r+">"}};XMLHelper._$name="XMLHelper";var RandomGenerator=class{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){const{randomCache:t}=this;let r;return t[e]?r=t[e]:(r=this.random100.filter((t=>t<e)),t[e]=r),r[this.rndIndex++%r.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}randomArray(e,t){const r=[],n=this.nextRandom(t+1),i={};for(let t=0,s=this.nextRandom(e.length);t<n;t++){for(;i[s];)s=this.nextRandom(e.length);i[s]=!0,r.push(e[s])}return r}};RandomGenerator._$name="RandomGenerator";var lorem=["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.","Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.","Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.","Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui atione voluptatem sequi nesciunt.","Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.","Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur?","Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"],DataGenerator=class{static reset(){this.rnd.reset(),this.rndTime.reset(),this.rndRating.reset()}static*generate(e,t=!1,i=1){var a;let l,c;"object"==typeof e&&(t=e.randomHeight,i=null!=(a=e.initialId)?a:1,l=e.addSkills,c=e.rowCallback,e=e.count);const{rnd:d,rndTime:u,rndRating:h,rndText:g,colors:f}=this;for(let a=0;a<e;a++){const v=d.fromArray(m),y=d.fromArray(n),b=v+" "+String.fromCharCode(65+a%25)+" "+y,C=d.nextRandom(60)+1,D=new Date(2019,0,C),S=new Date(2019,0,C+d.nextRandom(30)+2),E={id:i>-1?a+i:void 0,title:"Row "+a,name:b,firstName:v,surName:y,city:d.fromArray(r),team:d.fromArray(r)+" "+d.fromArray(o),age:10+d.nextRandom(80),food:d.fromArray(p),color:d.fromArray(f),score:10*d.nextRandom(100),rank:d.nextRandom(100)+1,start:D,finish:S,time:DateHelper.getTime(u.nextRandom(24),5*u.nextRandom(12)),percent:d.nextRandom(100),done:d.nextRandom(100)<50,rating:h.nextRandom(5),relatedTo:Math.min(e-1,a+i+d.nextRandom(10)),notes:lorem[g.nextRandom(7)+1]};l&&(E.skills=d.randomArray(s,7));const w=null==c?void 0:c(E);w&&Object.assign(E,w),t&&(E.rowHeight=5*d.nextRandom(!0===t?20:t)+20),yield E}}static generateData(e,t=!1,r=1,n=!0){let i=e;"object"!=typeof e&&(i={count:e,randomHeight:t,initialId:r,reset:n}),!1!==i.reset&&this.reset(),DataGenerator.overrideRowCount&&(i.count=DataGenerator.overrideRowCount);const s=[],a=this.generate(i);for(let e=0;e<i.count;e++)s.push(a.next().value);return s}static generateEvents({viewStartDate:e,viewEndDate:t,nbrResources:r=50,nbrEvents:n=5,dependencies:i,tickUnit:s="days",minDuration:a=2,maxDuration:o=10}){const l=this.generateData(r),c=[];i=[];for(let l=0;l<r;l++)for(let r=0;r<n;r++){const n=DateHelper.getDurationInUnit(e,t,s),d=DateHelper.add(e,Math.round(.9*Math.random()*n),s),u=Math.round(Math.random()*(o-a))+a,h=DateHelper.add(d,u,"days"),g=c.length+1;c.push({id:g,name:this.tasks[(l+r)%(this.tasks.length-1)],startDate:d,duration:u,endDate:h,resourceId:l}),i&&l>0&&i.push({id:i.length+1,from:g-1,to:g})}return{resources:l,events:c,dependencies:i}}static generateRow(){return DataGenerator.generateData(1,!1,-1,!1)[0]}};Object.assign(DataGenerator,{rnd:new RandomGenerator,rndTime:new RandomGenerator,rndRating:new RandomGenerator,rndText:new RandomGenerator,colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),DataGenerator._$name="DataGenerator";var knownProps=["action","target","to","deltaX","deltaY","x","y","text"],DemoBot=class extends(Events_default(Delayable_default())){static get defaultConfig(){return{repeat:!0,outerElement:document.body,callOnFunctions:!0}}construct(e){super.construct(e);const t=this;t.widget&&(t.outerElement=t.widget.element,t.widget.playingDemo=!0),EventHelper.playingDemo=!0,Object.assign(t,{prevTarget:null,currentStep:0,mouse:DomHelper.createElement({parent:t.outerElement,tag:"div",className:"simulated-mouse"}),timeoutId:null,innerIntervalId:null,mouseOutElements:[]}),t.intervalId=t.setInterval(t.nextStep.bind(t),1e3),t.outerElement.classList.add("b-playing-demo"),t.outerElement.addEventListener("click",(e=>{e.isTrusted&&t.abort()}))}doDestroy(){this.abort()}abort(e=!1){const t=this;t.mouse.style.top="-100px",t.clearInterval(t.intervalId),t.timeoutId&&t.clearTimeout(t.timeoutId),t.innerIntervalId&&t.clearInterval(t.innerIntervalId),t.outerElement.classList.remove("b-playing-demo"),t.widget&&(t.widget.playingDemo=!1),EventHelper.playingDemo=!1,t.trigger(e?"done":"abort")}triggerEvent(e,t,r){if(!e)return null;let n;if(t.startsWith("mouse")){const e=this.mouse.getBoundingClientRect();n=new MouseEvent(t,Object.assign({view:globalThis,bubbles:!0,cancelable:!0,clientX:e.left,clientY:e.top},r||{}))}else n=document.createEvent("Event"),n.initEvent(t,!0,!1);return e.dispatchEvent(n),n}handleMouseMove(e,t){const r=this,n=r.mouse;n.classList.add("quick"),r.mouseDown&&n.classList.add("drag");const i=Rectangle.from(n,r.outerElement),s=i.x,a=i.y;let o=0,l=0;if(e.to)if("string"==typeof e.to){const t=r.outerElement.querySelector(e.to);if(t){const e=Rectangle.from(t,r.outerElement),n=e.x+e.width/2,i=e.y+e.height/2;o=(n-s)/10,l=(i-a)/10}}else e.to.x?o=(e.to.x-s)/10:(o=e.to[0]/10,l=e.to[1]/10);else e.deltaX?o=e.deltaX/10:e.x&&(o=(e.x-s)/10);e.deltaY&&(l=e.deltaY/10);let c=0;r.innerIntervalId=r.setInterval((()=>{if(r.shouldPause)return;9==c++&&(clearInterval(r.innerIntervalId),e.then&&e.then());const t=s+o*c,i=a+l*c;n.style.left=t+"px",n.style.top=i+"px";const d=n.getBoundingClientRect(),u=d.left,h=d.top,g=DomHelper.elementFromPoint(u,h);g!==r.prevTarget&&(r.prevTarget&&(r.mouseOutElements.push(r.prevTarget),DomHelper.isDescendant(r.mouseOutElements[0],g)||(r.mouseOutElements.forEach((e=>r.triggerEvent(e,"mouseout"))),r.mouseOutElements.length=0)),r.prevTarget=g,r.triggerEvent(g,"mouseover")),r.triggerEvent(g,e.action,{clientX:u,clientY:h})}),50)}getTarget(e){const t=this,r=e.target;return r?"function"==typeof r?r(e):document.querySelector(r):t.prevTarget||t.outerElement}normalizeStep(e){if(e.action)return"function"==typeof e.action?e.action(e):e;if("function"==typeof e)return e(),e;for(const t in e)Object.hasOwnProperty.call(e,t)&&!knownProps.includes(t)&&(e.action=t.toLowerCase(),e.to=e[t]);return e.target||"string"!=typeof e.to&&"function"!=typeof e.to||(e.target=e.to),e}get isScrolling(){const e=this,t=e.outerElement.getBoundingClientRect(),r=e.lastTop&&t.top!==e.lastTop;return e.lastTop=t.top,r}get isInView(){const e=this.outerElement.getBoundingClientRect();return e.top<globalThis.innerHeight&&e.bottom>0}get shouldPause(){return!this.isInView||this.isScrolling||document.hidden||!document.hasFocus()}nextStep(){const e=this;if(e.shouldPause)return;if(e.currentStep===e.steps.length){if(!e.repeat)return e.abort(!0);e.currentStep=0}0===e.currentStep&&e.trigger("initialize");const t=e.mouse,r=e.normalizeStep(e.steps[e.currentStep++]),n=e.getTarget(r),i=r.action;if(n&&i)if(t.className="simulated-mouse","mousemove"===i)e.handleMouseMove(r,n);else{if(n!==e.prevTarget){const r=Rectangle.from(n,e.outerElement);t.style.left=r.x+r.width/2+"px",t.style.top=r.y+r.height/2+"px"}"mousedown"===i&&(e.mouseDown=!0),"mouseup"===i&&(e.mouseDown=!1),e.timeoutId=e.setTimeout((()=>{if(e.prevTarget=n,t.classList.add(i),"type"===i){const e=Widget.fromElement(n),t=r.text.split("|");e.value=t[1===t.length||e.value!=t[0]?0:1]}else e.triggerEvent(n,i)}),"type"===i?100:550)}}};DemoBot._$name="DemoBot";var hasOwnProperty7=Object.prototype.hasOwnProperty,cacheKey=null;function setParser(e,t){return Object.defineProperty(e,"parser",{value:t}),t}var Default=class{constructor(e){this.formatter=e}format(e){return this.formatter.defaultFormat(e)}parse(e,t){return this.formatter.defaultParse(e,t)}resolvedOptions(){return null}},Formatter=class{static get(e){if(null==e)return this.NULL;if(e instanceof this)return e;const t="string"==typeof e?e:JSON.stringify(e),r=this.cache;let n=r.get(t);return n||(cacheKey=t,n=new this(e),r.set(t,n)),n}static get cache(){return hasOwnProperty7.call(this,"_cache")&&this._cache||(this._cache=new Map)}static get NULL(){return hasOwnProperty7.call(this,"_null")?this._null:this._null=new this(null)}constructor(e){const t=this;if(t.cacheKey=cacheKey,cacheKey=null,t.initialize(),null===e)t.formatter=new Default(t);else{t.configure(e);for(const[e,r]of Object.entries(t.resolvedOptions()))null!=r&&e in t.defaults&&(t[e]=r)}}get parser(){return setParser(this,new this.constructor.Parser(this))}defaultFormat(e){return null==e?e:String(e)}defaultParse(e){return e}format(e){return null==e?e:this.formatter.format(e)}parse(e,t){return null==e?e:this.parser.parse(e,t)}parseStrict(e){return this.parse(e,!0)}resolvedOptions(){return this.formatter.resolvedOptions()}};Formatter._$name="Formatter";var Navigator=class extends(Base.mixin(Events_default,Factoryable_default)){static get $name(){return"Navigator"}static get type(){return"navigator"}static get configurable(){return{ownerCmp:null,itemsTabbable:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,activeItem:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null,scrollDuration:50,disabled:null,datasetIdProperty:"id",testConfig:{scrollDuration:1}}}static get factoryable(){return{defaultType:"navigator"}}get activeItem(){const{_activeItem:e}=this;if(this.target.contains(e))return e;this._activeItem=null}updateOwnerCmp(e){this.itemSelector||(this.itemSelector="."+this.ownerCmp.itemCls),DomHelper.setAttributes(this.keyEventTarget,{"aria-activedescendant":this.owner.id+"-active-descendant"})}set navigationEvent(e){const{owner:t}=this;this._navigationEvent=t.navigationEvent=e,e&&Promise.resolve(1).then((()=>this.navigationEvent=null))}get navigationEvent(){return this._navigationEvent}static getComposedKeyName(e){const t=(e.key||"").trim()||e.code;return(e.ctrlKey?"CTRL+":"")+(e.shiftKey?"SHIFT+":"")+(e.altKey?"ALT+":"")+t}onKeyDown(e){var t;const r=this,{ownerCmp:n,itemSelector:i,activeItem:s,itemsTabbable:a}=r,{target:o}=e,l=r.target.querySelector(i),c=(e.key||"").trim()||e.code,d=r.constructor.getComposedKeyName(e),u=o.matches(i)||o===r.keyEventTarget;if(!r.disabled&&r.processEvent&&(e=r.processEvent.call(n,e)),e&&!r.disabled&&l&&r.target.offsetParent&&u){if(!a){if(null==r.inlineFlow){const e=l.parentNode,t=DomHelper.getStyleValue(l,"position"),n=DomHelper.getStyleValue(l,"display"),i=DomHelper.getStyleValue(l,"float");r.inlineFlow="absolute"===t||"inline"===n||"inline-block"===n||"left"===i||"right"===i||"flex"===DomHelper.getStyleValue(e,"display")&&"row"===DomHelper.getStyleValue(e,"flex-direction")}r.prevKey||(r.inlineFlow?(r.prevKey="ArrowLeft",r.nextKey="ArrowRight"):(r.prevKey="ArrowUp",r.nextKey="ArrowDown"))}if(r.navigationEvent=e,s)switch(c){case r.prevKey:if(r.disabled||e.ctrlKey&&!r.allowCtrlKey)return;if(e.shiftKey&&!r.allowShiftKey)return;e.preventDefault(),e.handled=!0,r.navigatePrevious(e);break;case r.nextKey:if(r.disabled||e.ctrlKey&&!r.allowCtrlKey)return;if(e.shiftKey&&!r.allowShiftKey)return;e.preventDefault(),e.handled=!0,r.navigateNext(e);break;default:{const i=null==(t=r.keys)?void 0:t[d];if(i&&!r.disabled){if(!1===r.callback(i,r.thisObj||n,[e]))return}else n.onInternalKeyDown&&n.onInternalKeyDown(e);if(DomHelper.getActiveElement(o)!==o&&e.preventDefault(),a)return}}else{if(a)return;c!==r.nextKey&&c!==r.prevKey||(r.activeItem=r.getDefaultNavigationItem(e))}r.activeItem!==s&&r.triggerNavigate(e)}}getDefaultNavigationItem(e){const{target:t,itemSelector:r,prevKey:n,nextKey:i}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===n?t.querySelector(r+":last-of-type"):2&t.compareDocumentPosition(e.target)&&e.key===i?t.querySelector(""+r):void 0}navigatePrevious(e){const t=this,r=t.previous;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then((()=>{t.activeItem=r,t.triggerNavigate(e)}))}navigateNext(e){const t=this,r=t.next;e.preventDefault(),r&&t.ownerCmp.scrollable.scrollIntoView(r,{animate:t.scrollDuration}).then((()=>{t.activeItem=r,t.triggerNavigate(e)}))}get owner(){return this.ownerCmp}get previous(){return this.getAdjacent(-1)}get next(){return this.getAdjacent(1)}getAdjacent(e=1,t=this.activeItem){const r=this.treeWalker;if(r.currentNode=t,r[e<0?"previousNode":"nextNode"](),r.currentNode!==this.activeItem)return r.currentNode}onTargetFocusIn(e){var t;const r=this,{target:n,relatedTarget:i}=e,{owner:s,itemsTabbable:a,skipScrollIntoView:o,previousActiveItem:l}=r;if(!n.matches(".b-focus-trap"))if(n.matches(r.itemSelector))r.skipScrollIntoView=!0,r.activeItem=n,r.skipScrollIntoView=o,r.activeItem&&a&&r.triggerNavigate(e);else if(n===r.target){(i?n.compareDocumentPosition(i):0)&Node.DOCUMENT_POSITION_CONTAINED_BY?null==(t=s.previousSibling)||t.focus():r.activeItem=l&&r.target.contains(l)?l:0}}onTargetFocusOut(e){const t=this,{relatedTarget:r}=e;(null==r?void 0:r.matches(".b-focus-trap"))||r&&t.target.contains(r)&&r.matches(t.itemSelector)||t.activeItem&&(t.activeItem=null,t.itemsTabbable&&t.triggerNavigate(e))}onTargetMouseDown(e){const t=this,r=e.target.closest(t.itemSelector);t.navigationEvent=e,t.itemsTabbable?r===t.activeItem&&t.triggerNavigate(e):!1===t.ownerCmp.itemsFocusable?t.onFocusGesture(e):r&&(e.preventDefault(),DomHelper.focusWithoutScrolling(r))}onTargetClick(e){var t;const r=this,{skipScrollIntoView:n}=r;r.skipNextClick||(null==(t=r.navigationEvent)?void 0:t.ignoreNavigation)?r.skipNextClick=!1:r.disabled||(r.skipScrollIntoView=!0,r.processEvent&&(e=r.processEvent.call(r.ownerCmp,e)),e&&(r.activeItem=e.target.closest(r.itemSelector),r.triggerNavigate(e)),r.skipScrollIntoView=n)}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?DomHelper.NodeFilter.FILTER_ACCEPT:DomHelper.NodeFilter.FILTER_SKIP}changeActiveItem(e){return null!=e&&this.ownerCmp.getItem&&(e=this.ownerCmp.getItem(e)),e}updateActiveItem(e,t){var r;const n=this,{ownerCmp:i}=n,s=t&&n.target.contains(t),a=e&&DomHelper.isFocusable(e)&&e!==DomHelper.getActiveElement(e);if(s&&(n.previousActiveItem=t),t&&(t.classList.remove(n.focusCls),t.removeAttribute("id")),null!=e){if(n.skipScrollIntoView?a&&DomHelper.focusWithoutScrolling(e):null==(r=i.scrollable)||r.scrollIntoView(e,{block:"nearest",focus:a,silent:n.scrollSilently}),e===t&&s)return;e.classList.add(n.focusCls),e.id=n.owner.id+"-active-descendant",n._activeItem=e}else n._activeItem=null,t===DomHelper.getActiveElement(t)&&i.revertFocus()}updateTarget(e,t){const r=this,n={element:e,thisObj:r,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",mousedown:{handler:"onTargetMouseDown",delegate:r.itemSelector}};r.itemsTabbable||r.itemsFocusable||(n.click="onTargetClick"),Object.prototype.hasOwnProperty.call(r,"acceptNode")||(r.acceptNode=r.acceptNode.bind(r),r.acceptNode.acceptNode=r.acceptNode),EventHelper.on(n),r.treeWalker=r.setupTreeWalker(e,DomHelper.NodeFilter.SHOW_ELEMENT,r.acceptNode),r.keyEventTarget||(r.keyEventTarget=e),(r.targetMutationMonitor=new MutationObserver(r.onTargetChildListChange.bind(r))).observe(e,{childList:!0,subtree:!0})}setupTreeWalker(e,t,r){return document.createTreeWalker(e,t,r)}onTargetChildListChange(){var e;const t=this,{activeItem:r,datasetIdProperty:n}=t;r&&(t.target.contains(r)?r.classList.contains(t.focusCls)||r.classList.add(t.focusCls):t.activeItem=t.target.querySelector(t.itemSelector+"."+t.focusCls+"[data-"+StringHelper.hyphenate(n)+'="'+r.dataset[n]+'"]')||(null==(e=t.target.querySelector(t.itemSelector+"."+t.focusCls))?void 0:e[r.dataset.index])||null)}changeKeyEventTarget(e){this._keyEventTarget=e,EventHelper.on({element:e,keydown:"onKeyDown",thisObj:this})}triggerNavigate(e,t=this.activeItem){var r;const n={event:e,item:t,oldItem:this.previousActiveItem};this.trigger("navigate",n),null==(r=this.ownerCmp)||r.trigger("navigate",n)}};Navigator._$name="Navigator";var escapeRegExp=StringHelper.escapeRegExp,digitsRe2=/[\d+-]/g,newFormatter=(e,t)=>new Intl.NumberFormat(e||void 0,t),numFormatRe=/^(?:([$])\s*)?(?:(\d+)>)?\d+(,\d+)?(?:\.((\d*)(?:#*)|[*]))?(?:\s*([%])?)?$/,unicodeMinus="−",NumberParser=class{constructor(e){const t=this,r=e.locale,n=newFormatter(r,{maximumFractionDigits:3}),i=e.is.currency?t._decodeStyle(r,{style:"currency",currency:e.currency,currencyDisplay:e.currencyDisplay}):null,s=e.is.percent?t._decodeStyle(r,{style:"percent"}):null,a=n.format(1.2).replace(digitsRe2,"")[0],o=n.format(1e9).replace(digitsRe2,"")[0]||"";Object.assign(t,{currency:i,decimal:a,formatter:e,grouper:o,percent:s}),t.decimal=a,t.decimalRe=escapeRegExp(a,"g"),t.grouper=o,t.stripRe=new RegExp("(?:\\s+|"+escapeRegExp(o)+")"+(i?"|(?:"+escapeRegExp(i.text)+")":"")+(s?"|(?:"+escapeRegExp(s.text)+")":""),"g")}decimalPlaces(e){const t=(e=e.replace(this.stripRe,"")).indexOf(this.decimal)+1;return t&&e.length-t}parse(e,t){return"string"==typeof e&&(e=e.replace(this.stripRe,"").replace(this.decimalRe,".").replace(unicodeMinus,"-"),e=t?Number(e):parseFloat(e),this.formatter.is.percent&&(e/=100)),e}_decodeStyle(e,t){const r=newFormatter(e,t),n=newFormatter(e,Object.assign(r.resolvedOptions(),{style:"decimal"})),i=r.format(0),s=n.format(0);return{suffix:i.startsWith(s),text:i.replace(s,"").trim()}}},NumberFormat=class extends Formatter{static get $name(){return"NumberFormat"}initialize(){this._as={},this.is={decimal:!1,currency:!1,percent:!1,null:!0,from:null}}get truncator(){const e=this.maximumFractionDigits;return null==e?null:this.as({style:"decimal",maximumFractionDigits:Math.min(20,e+1)},"truncator")}configure(e){const t=this;"string"!=typeof e?Object.assign(t,e):t.template=e;const r={},n=t.locale?LocaleManager_default.locales[t.locale]:LocaleManager_default.locale,i=n&&n.NumberFormat,s=t.template;if(i)for(const e in i)null==t[e]&&"function"!=typeof i[e]&&(t[e]=i[e]);if(s){const e=numFormatRe.exec(s),r=e[2],n=e[4];t.useGrouping=!!e[3],t.style=e[1]?"currency":e[6]?"percent":"decimal",r&&(t.integer=+r),"*"===n?t.fraction=[0,20]:null!=n&&(t.fraction=[e[5].length,n.length])}t._minMax("fraction",!0,!0),t._minMax("integer",!0,!1),t._minMax("significant",!1,!0);for(const e in t.defaults)null!=t[e]&&(r[e]=t[e]);t.is.from=t.from&&t.from.is,t.is[t.style]=!(t.is.null=!1),t.formatter=newFormatter(t.locale,r)}as(e,t=null){const r=this.resolvedOptions()||{template:"9.*"},n=this._as;let i=t&&n[t];return i||("string"==typeof e?r.style=e:Object.assign(r,e),r.from=this,i=new NumberFormat(r)),t&&(n[t]=i),i}defaultParse(e,t){return null==e?e:t?Number(e):parseFloat(e)}format(e){if("string"==typeof e){const t=Number(e);e=isNaN(t)?this.parse(e):t}return super.format(e)}round(e){return this.parse(this.format(e))}truncate(e){const t=this,r=t.maximumFractionDigits,{truncator:n}=t;let i,s=t.parse(e);return n&&(s=n.format(s),i=s.indexOf(n.parser.decimal),i>-1&&s.length-i-1>r&&(s=s.substr(0,i+r+1)),s=n.parse(s)),s}resolvedOptions(){const e=super.resolvedOptions();for(const t in e)void 0===e[t]&&(e[t]=this[t]);return e}_minMax(e,t,r){const n=this,i=n[e];if(null!=i){const s=StringHelper.capitalize(e),a="maximum"+s+"Digits",o="minimum"+s+"Digits";"number"==typeof i?(t&&(n[o]=i),r&&(n[a]=i)):(n[o]=i[0],n[a]=i[1])}}};NumberFormat.Parser=NumberParser,Object.assign(NumberFormat.prototype,{defaults:{style:"decimal",currency:null,currencyDisplay:"symbol",locale:null,maximumFractionDigits:null,minimumFractionDigits:null,minimumIntegerDigits:null,maximumSignificantDigits:null,minimumSignificantDigits:null,useGrouping:!0},fraction:null,from:null,integer:null,significant:null,template:null}),Object.assign(NumberFormat.prototype,NumberFormat.prototype.defaults),Formatter.number=(e,t)=>NumberFormat.format(e,t),NumberFormat._$name="NumberFormat";var WebSocketManager=class extends(Events_default(Base)){construct(e={}){const t=this;super.construct(e),t.onWsOpen=t.onWsOpen.bind(t),t.onWsClose=t.onWsClose.bind(t),t.onWsMessage=t.onWsMessage.bind(t),t.onWsError=t.onWsError.bind(t),t.autoConnect&&t.address&&t.open()}doDestroy(){const e=this;e.connector&&(e.detachSocketListeners(e.connector),e.connector.close(),e.connector=null),super.doDestroy()}get isConnecting(){var e;return(null==(e=this.connector)?void 0:e.readyState)===this.constructor.webSocketImplementation.CONNECTING}get isOpened(){var e;return(null==(e=this.connector)?void 0:e.readyState)===this.constructor.webSocketImplementation.OPEN}get isClosing(){var e;return(null==(e=this.connector)?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSING}get isClosed(){var e;return(null==(e=this.connector)?void 0:e.readyState)===this.constructor.webSocketImplementation.CLOSED}createWebSocketConnector(){const e=this.connector=new this.constructor.webSocketImplementation(this.address);this.attachSocketListeners(e)}destroyWebSocketConnector(){this.detachSocketListeners(this.connector),this.connector.close(),this.connector=null}attachSocketListeners(e){const t=this;e.addEventListener("open",t.onWsOpen),e.addEventListener("close",t.onWsClose),e.addEventListener("message",t.onWsMessage),e.addEventListener("error",t.onWsError)}detachSocketListeners(e){const t=this;e.removeEventListener("open",t.onWsOpen),e.removeEventListener("close",t.onWsClose),e.removeEventListener("message",t.onWsMessage),e.removeEventListener("error",t.onWsError)}async open(){const e=this;if(e._openPromise)return e._openPromise;if(!e.address)return void console.warn("Server me.address cannot be empty");if(e.isOpened)return!0;let t;return e.createWebSocketConnector(),e._openPromise=new Promise((r=>{t=e.ion({open(){r(!0)},error(){r(!1)}})})).then((r=>(t(),e._openPromise=null,r||e.destroyWebSocketConnector(),r))).catch((()=>{e._openPromise=null,e.destroyWebSocketConnector()})),e._openPromise}close(){this.connector&&(this.destroyWebSocketConnector(),this.trigger("close"))}send(e,t={}){var r;null==(r=this.connector)||r.send(JSON.stringify({command:e,...t}))}onWsOpen(e){this.trigger("open",{event:e})}onWsClose(e){this.trigger("close",{event:e})}onWsMessage(e){try{const t=JSON.parse(e.data);this.trigger("message",{data:t})}catch(e){this.trigger("error",{error:e})}}onWsError(e){this.trigger("error",{error:e})}};__publicField(WebSocketManager,"webSocketImplementation","undefined"==typeof WebSocket?null:WebSocket),__publicField(WebSocketManager,"configurable",{address:"",userName:"User",autoConnect:!0}),WebSocketManager._$name="WebSocketManager";var Finalizable_default=e=>class extends(e||Base){static get $name(){return"Finalizable"}construct(...e){super.construct(...e),this.finalizer=null,this.finalizing=null,this.isFinalized=!1,this.isFinalizing=!1}doFinalize(){this.destroy()}finalize(){const e=this;let t=e.finalizing;return t||e.isFinalized||(e.isFinalizing=!0,e.finalizing=t=e._awaitFinalizer()),t}async _awaitFinalizer(){const e=this;try{await e.finalizer}finally{e.finalizing=null,e.isFinalized=!0,e.doFinalize()}}},ABORTED=Symbol("dragAbort"),INIT=Symbol("dragInit"),DRAGGING=Symbol("dragDrag"),DROPPED=Symbol("dragDrop"),lockDirections={x:"horizontal",y:"vertical"},DragContext=class extends(Base.mixin(Finalizable_default,Delayable_default,Identifiable_default)){static get configurable(){return{itemElement:null,scrollManager:null,monitoringConfig:null,source:null,target:null,targetElement:null,threshold:5,touchStartDelay:300}}static get identifiable(){return{}}construct(...e){super.construct(...e);const t=this,{event:r}=t;Object.assign(t,{altKey:null,cleaners:[],ctrlKey:null,data:new Map,element:r.target,endEvent:null,lastMoveEvent:null,metaKey:null,previousTarget:null,scrollerAction:null,shiftKey:null,state:INIT,startEvent:r,touchStartTimer:null,_valid:!0}),"touches"in r&&t.touchStartDelay&&(t.touchStartTimer=t.setTimeout((()=>t.touchStartTimer=null),t.touchStartDelay,"touchStartDelay")),EventHelper.on({element:globalThis,blur:"onWindowBlur",thisObj:t})}doDestroy(){const e=this,{source:t,target:r}=e;e.cleanup(),(null==r?void 0:r.dropping)===e&&(r.dropping=null),(null==t?void 0:t.dragging)===e&&(t.dragging=null),super.doDestroy()}onWindowBlur(){this.started&&this.abort()}get aborted(){return this.state===ABORTED}get completed(){return this.isDestroying||this.aborted||null!==this.endEvent}get pending(){return this.state===INIT}get started(){return this.state!==INIT&&!this.aborted}get valid(){return this.started&&null!=this.targetElement&&this._valid}set valid(e){this._valid=e}async get(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(!this.completed)throw new Error("Data is not available until drag completion");if(Array.isArray(e))return Promise.all(e.map((e=>this.get(e))));let t=this.data.get(e);return"function"==typeof t&&(t=await t(),this.data.set(e,t)),t}has(e){return this.data.has(e)}peek(e){if(this.aborted)throw new Error("Data is not available on aborted drag");if(Array.isArray(e))return e.map((e=>this.peek(e)));let t=this.data.get(e);return"function"==typeof t&&(t=!0),t}set(e,t){this.data.set(e,t)}changeTarget(e,t){if(e!==t){const r=this;r._target=e,r.previousTarget=t,t&&(t.dropping=null),e&&(e.dropping=r,e.dropping!==r&&(e=null,r.valid=!1)),r._target=t}return e}updateTarget(e,t){const r=this;t&&r.source.dragLeaveTarget(r,t),e&&(r.valid=!0,e.dragMove(r),r.source.dragEnterTarget(r))}updateTargetElement(e){let t,r,n,i,s;for(s=e;s;s=s.parentElement)if(r=DomDataStore.get(s,"droppables"),r)for(i=0;i<r.length;++i)if(t=r[i],t.dropRootElement.contains(e)&&(n=t.droppableSelector,(!n||e.closest("#"+DomHelper.getId(t.dropRootElement)+" "+n))&&(this.target=t,this.target===t)))return}abort(){const e=this,{element:t,source:r}=e;null==t||t.getBoundingClientRect(),e.state!==DROPPED&&(e.state=ABORTED,e.cleanup()),null==r||r.endDrag(e)}begin(){const e=this,{source:t}=e,r=t.beforeDrag(e);return!1!==r&&(t.dragging=e),r}cleanup(){let e;for(;e=this.cleaners.pop();)e()}end(e){const t=this,{lastMoveEvent:r,target:n}=t,{dragSwallowClickTime:i}=t.source;t.event=t.endEvent=e,t.syncFlags(),t.started&&((null==r?void 0:r.clientX)===e.clientX&&(null==r?void 0:r.clientY)===e.clientY&&(null==r?void 0:r.target)===e.target||t.track(),i&&EventHelper.on({element:document,capture:!0,expires:i,once:!0,click(e){e.stopPropagation()}}),t.state=DROPPED,n!==t.source&&(null==n||n.dragDrop(t)))}fakeKey(e,t){const r=this,{lastMoveEvent:n}=r;if(n&&r.element){let i;n.isKey=!0,"Alt"===e.key?r.altKey!==t&&(r.altKey=t,i=!0):"Control"===e.key&&r.ctrlKey!==t&&(r.ctrlKey=t,i=!0),i&&(r.event=n,r.track())}}keyDown(e){this.completed||("Escape"===e.key?this.abort():this.isDragToggleKey(e.key)&&this.fakeKey(e,!0))}keyUp(e){!this.completed&&this.isDragToggleKey(e.key)&&this.fakeKey(e,!1)}getDistance(e){return EventHelper.getDistanceBetween(this.startEvent,e)}isDragToggleKey(e){return"Control"===e||"Alt"===e}move(e){const t=this,{target:r}=e,n=t.getDistance(e)>=t.threshold;if(t.syncFlags(),t.touchStartTimer)n&&t.abort();else if(r&&r.nodeType===Node.ELEMENT_NODE){if(n&&!t.started&&(t.event=e,!1===t.start()))return void t.abort();t.started&&!t.completed&&(t.lastMoveEvent=t.event=e,"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.track())}}start(){const e=this,{scrollManager:t,monitoringConfig:r,source:n}=e,{draggingBodyCls:i,dragLock:s}=n,a=n.dragRootElement;if(e.state=DRAGGING,t){const n=t.startMonitoring(Objects.merge({scrollables:[{element:a}],direction:lockDirections[s]||s||"both",callback(t){const{lastMoveEvent:r}=e;r&&e.element&&(r.isScroll=!0,e.event=r,e.scrollerAction=t,e.track(),e.scrollerAction=null)}},r));e.cleaners.push(n)}const o=n.dragRootElement.closest(".b-outer")||document.body;if(o.classList.add(i),e.cleaners.push((()=>o.classList.remove(i))),!1===n.startDrag(e))return e.cleanup(),!1}syncFlags(){const e=this,{event:t}=e;e.altKey=t.altKey,e.ctrlKey=t.ctrlKey||t.metaKey,e.metaKey=t.metaKey,e.shiftKey=t.shiftKey}track(){const e=this,{event:t,source:r,target:n}=e;let i,s=t.target;"touchmove"===t.type&&(i=t.changedTouches[0],s=DomHelper.elementFromPoint(i.clientX,i.clientY)),e.targetElement=s,n===e.target&&(null==n||n.dragMove(e)),r.trackDrag(e)}};__publicField(DragContext,"$name","DragContext"),DragContext.prototype.STATE=DragContext.STATE=Object.freeze({ABORTED:ABORTED,INIT:INIT,DRAGGING:DRAGGING,DROPPED:DROPPED}),DragContext._$name="DragContext";var DragProxy=class extends(Base.mixin(Factoryable_default)){static get type(){return"default"}static get configurable(){return{dragging:null}}static get factoryable(){return{defaultType:DragProxy}}updateDragging(e,t){t&&this.close(t),e&&this.open(e)}close(e){}open(e){}dragStart(e){this.dragging=e}dragMove(e){}dragEnd(e){this.dragging=null}};DragProxy.initClass(),DragProxy._$name="DragProxy";var Draggable_default=e=>class extends(e||Base){static get $name(){return"Draggable"}static get configurable(){return{dragging:{$config:"nullify",value:null},draggingClsSelector:null,dragDocumentListeners:{element:document,keydown:"onDragKeyDown",keyup:"onDragKeyUp",contextmenu:"onDragContextMenu",mousemove:"onDragPointerMove",mouseup:"onDragPointerUp",pointerup:"onDragPointerUp",touchend:"onDragPointerUp",touchmove:{handler:"onDragPointerMove",passive:!1}},dragItemSelector:null,dragItemOverCls:null,dragLock:null,dragMinDistance:1,dragProxy:{$config:["lazy","nullify"],value:null},dragRootElement:{$config:"nullify",value:null},dragSameTargetDrop:!1,dragSelector:null,ignoreSelector:null,dragSwallowClickTime:50,dragThreshold:5,dragTouchStartDelay:300,dropTargetSelector:null,overItem:null,testConfig:{dragSwallowClickTime:50}}}static get properties(){return{draggingCls:"b-draggable-active",draggingBodyCls:"b-draghelper-active",draggingItemCls:"b-dragging-item",draggingStartedCls:"b-draggable-started",draggableCls:"b-draggable"}}beforeDrag(e){const{dragRootElement:t,dragSelector:r,ignoreSelector:n}=this,i=r&&e.element.closest(r);return!r||Boolean(i&&i===t||t.contains(i)&&(!n||!e.element.matches(n)))}dragStart(e){}dragOver(e){}dragEnterTarget(e){}dragLeaveTarget(e,t){}dragDrop(e){}dragEnd(e){}get activeDrag(){const{dragging:e}=this;return(null==e?void 0:e.started)&&!e.completed?e:null}get dragEventer(){return this.trigger?this:null}get draggingClassElement(){const{draggingClsSelector:e,dragRootElement:t}=this;return e?null==t?void 0:t.closest(e):t}beginDrag(e){const{draggingCls:t,draggingClassElement:r}=this;t&&r&&(r.classList.add(t),e.cleaners.push((()=>r.classList.remove(t))))}async endDrag(e){const t=this,{dragEventer:r,dragProxy:n}=t;e.valid&&await t.dragDrop(e),t.isDestroyed||(e.pending?e.destroy():(t.dragEnd(e),null==n||n.dragEnd(e),null==r||r.trigger(e.valid?"drop":"dragCancel",{drag:e,event:e.event}),t.finalizeDrag(e)))}async finalizeDrag(e){var t;await(null==(t=e.finalize)?void 0:t.call(e))}moveDrag(e){if(!1!==this.dragOver(e)){const{dragEventer:t,dragProxy:r}=this;null==r||r.dragMove(e),null==t||t.trigger("drag",{drag:e,event:e.event})}}setupDragContext(e){const t=this,{dragItemSelector:r,id:n}=t,{target:i}=e;return{event:e,id:n?n+"-drag-"+(t._nextDragId=(t._nextDragId||0)+1):null,itemElement:r?i.closest(r):i,touchStartDelay:t.dragTouchStartDelay,source:t,threshold:t.dragThreshold}}startDrag(e){const{draggingStartedCls:t,draggingClassElement:r,draggingItemCls:n,dragEventer:i,dragProxy:s}=this,{itemElement:a}=e;if(!1===(null==i?void 0:i.trigger("beforeDragStart",{drag:e,event:e.event})))return!1;t&&r&&(r.classList.add(t),e.cleaners.push((()=>r.classList.remove(t)))),n&&a&&(a.classList.add(n),e.cleaners.push((()=>a.classList.remove(n)))),null==s||s.dragStart(e);const o=this.dragStart(e);return!1!==o&&(null==i||i.trigger("dragStart",{drag:e,event:e.event})),o}trackDrag(e){var t;const{dropTargetSelector:r}=this;e.valid=!(r&&!(null==(t=e.targetElement)?void 0:t.closest(r))),this.moveDrag(e)}configureListeners(e){const t=ObjectHelper.assign({thisObj:this},this.dragDocumentListeners);return"touches"in e.startEvent?(delete t.mousemove,delete t.mouseup):(delete t.contextmenu,delete t.touchmove,delete t.touchend,delete t.pointerup),t}updateDragging(e,t){const r=this;if(e){const t=r.configureListeners(e);e.cleaners.push(EventHelper.on(t)),r.beginDrag(e)}else t&&t.destroy()}changeDragProxy(e,t){return DragProxy.reconfigure(t,e,{owner:this,defaults:{owner:this}})}updateDragRootElement(e,t){var r;const n=this,{draggableCls:i,dragItemSelector:s,onDragItemMouseMove:a}=n;if(null==t||t.classList.remove(i),null==(r=n._dragRootDetacher)||r.call(n),e){const t={thisObj:n,element:e,mousedown:"onDragMouseDown",touchstart:"onDragTouchStart",pointerdown:e=>{var t,r;return e.pointerId&&(null==(r=(t=e.target).releasePointerCapture)?void 0:r.call(t,e.pointerId))}};a&&(t.mousemove={delegate:s,handler:"onDragItemMouseMove"}),(n.dragItemOverCls||a||n.onDragItemMouseEnter||n.onDragItemMouseLeave)&&Object.assign(t,{mouseover:{delegate:s,handler:"onDragItemMouseOver"},mouseout:{delegate:s,handler:"onDragItemMouseOut"}}),e.classList.add(i),n._dragRootDetacher=EventHelper.on(t)}}onDragItemMouseOver(e){this.overItem=e}onDragItemMouseOut(e){this.dragging||(this.overItem=e)}changeOverItem(e){var t;return this.enterLeaveEvent=e,"mouseout"===e.type?(null==(t=e.relatedTarget)?void 0:t.closest(this.dragItemSelector))||null:e.target.closest(this.dragItemSelector)}updateOverItem(e,t){var r,n;const i=this,{dragItemOverCls:s}=i;t&&(s&&t.classList.remove(s),null==(r=i.onDragItemMouseLeave)||r.call(i,i.enterLeaveEvent,t)),e&&(s&&e.classList.add(s),null==(n=i.onDragItemMouseEnter)||n.call(i,i.enterLeaveEvent,e))}onDragContextMenu(e){e.preventDefault()}onDragKeyDown(e){this.dragging.keyDown(e)}onDragKeyUp(e){this.dragging.keyUp(e)}onDragMouseDown(e){0===e.button&&this.onDragPointerDown(e)}onDragPointerDown(e){let{dragging:t}=this;t?t.isFinalizing||t.abort():(t=this.setupDragContext(e),t&&(t=new DragContext(t),!1===t.begin()&&t.destroy()))}changeDragging(e,t){return null==t||t.destroy(),e}onDragPointerMove(e){const{dragging:t}=this;t&&!t.completed&&(null==t||t.move(e))}onDragPointerUp(e){const{dragging:t}=this;t&&!t.completed&&(t.end(e),this.endDrag(t))}onDragTouchStart(e){1===e.touches.length&&this.onDragPointerDown(e)}},Droppable_default=e=>class extends(e||Base){static get $name(){return"Droppable"}static get configurable(){return{droppableSelector:null,dropping:null,dropRootElement:{$config:"nullify",value:null}}}get dropEventer(){return this.trigger?this:null}get droppableCls(){return"b-droppable"}dragEnter(e){var t;return null==(t=this.dropEventer)?void 0:t.trigger("dragEnter",{drag:e,event:e.event})}dragMove(e){var t;return null==(t=this.dropEventer)?void 0:t.trigger("dragMove",{drag:e,event:e.event})}dragDrop(e){var t;return null==(t=this.dropEventer)?void 0:t.trigger("drop",{drag:e,event:e.event})}dragLeave(e){var t;return null==(t=this.dropEventer)?void 0:t.trigger("dragLeave",{drag:e,event:e.event})}changeDropping(e,t){if(e!==t){const r=this;t&&(!t.aborted&&t.completed||r.dragLeave(t)),e&&(r._dropping=e,!1===r.dragEnter(e)&&(e=null),r._dropping=t)}return e}updateDropRootElement(e,t){const r=this,{droppableCls:n}=r;let i,s,a;t&&(i=DomDataStore.get(t,"droppables"),a=!0,Array.isArray(i)&&(s=i.indexOf(r))>-1&&(i.length<2?DomDataStore.remove(t,"droppables"):(i.splice(s,1),i.forEach((e=>{n===e.droppableCls&&(a=!1)})))),a&&t.classList.remove(n)),e&&(i=DomDataStore.get(e,"droppables"),i?i.push(r):DomDataStore.set(e,"droppables",[r]),e.classList.add(n))}},Featureable_default=e=>class extends(e||Base){static get $name(){return"Featureable"}static get configurable(){return{features:null}}static get declarable(){return["featureable"]}static setupFeatureable(e){const t={ownerName:"client",...e.featureable};t.factory.initClass(),Reflect.defineProperty(e,"featureable",{get:()=>t})}doDestroy(){var e;const t=this.features;super.doDestroy();for(const r in t){const n=t[r];null==(e=n.destroy)||e.call(n)}}hasFeature(e){var t;return Boolean(null==(t=this.features)?void 0:t[e])}changeFeatures(e,t){if(this.isDestroying)return;const r=this,{featureable:n}=r.constructor,i=r.$features||(r.$features=new DynamicObject({configName:"features",factory:n.factory,owner:r,ownerName:n.ownerName}));return i.update(e),t?void 0:i.target}get widgetClass(){}getCurrentConfig(e){const t=super.getCurrentConfig(e),{features:r}=t;if(r)for(const e in r)0===Object.keys(r[e]).length&&(r[e]=!0);return t}},EDGES={e:"b-hover-edge",t:"b-hover-top",r:"b-hover-right",b:"b-hover-bottom",l:"b-hover-left"},EDGE_CLASSES={[EDGES.e]:1,[EDGES.t]:1,[EDGES.r]:1,[EDGES.b]:1,[EDGES.l]:1},ZONES={t:[EDGES.e,EDGES.t],r:[EDGES.e,EDGES.r],b:[EDGES.e,EDGES.b],l:[EDGES.e,EDGES.l],tr:[EDGES.e,EDGES.t,EDGES.r],bl:[EDGES.e,EDGES.b,EDGES.l],tl:[EDGES.e,EDGES.t,EDGES.l],br:[EDGES.e,EDGES.b,EDGES.r]},Hoverable_default=e=>class extends(e.mixin(Delayable_default)){static get $name(){return"Hoverable"}static get configurable(){return{hoverCls:null,hoverAnimationCls:null,hoverRootCls:null,hoverRootActiveCls:null,hoverDelay:null,hoverElement:null,hoverIgnoreElement:null,hoverEdges:null,hoverEdgeSize:10,hoverRootElement:{$config:"nullify",value:null},hoverSelector:null,hoverTarget:{$config:"nullify",value:null},hoverTrack:null,hoverZone:null}}static get delayable(){return{setHoverTarget:0}}hoverEnter(e){}hoverIgnore(e){var t;return null==(t=this.hoverIgnoreElement)?void 0:t.contains(e)}hoverLeave(e){}hoverMove(e){}onHoverMouseMove(e){const t=this,{hoverEdges:r,hoverEdgeSize:n,hoverTarget:i}=t;if(i){if(r){const{top:s,left:a,width:o,height:l,right:c,bottom:d}=i.getBoundingClientRect(),{clientX:u,clientY:h}=e,g=a+o/2,p=s+l/2,m=h<(n?s+n:p),f=u>=(n?c-n:g),v=m||h>=(n?d-n:p)?m?"t":"b":"",y=f||u<(n?a+n:g)?f?"r":"l":"";t.hoverZone=(r.includes(v)?v:"")+(r.includes(y)?y:"")}t.hoverEvent=e,t.hoverTrack&&t.hoverMove(e)}}onHoverMouseOver(e){this.hoverEvent=e,this.hoverElement=e.target}onHoverMouseOut(e){this.hoverEvent=e,this.hoverElement=e.relatedTarget}updateHoverDelay(e){this.setHoverTarget.delay=e}changeHoverEdges(e){return!0===e?"trbl":(e||"").replace("v","tb").replace("h","lr")}updateHoverEdges(){this.syncHoverListeners()}changeHoverElement(e){if(!this.hoverIgnore(e))return e}updateHoverElement(e){const{hoverSelector:t}=this;t&&(e=null==e?void 0:e.closest(t)),this.setHoverTarget(e)}updateHoverRootElement(e,t){const{hoverRootCls:r}=this;r&&(null==t||t.classList.remove(r),null==e||e.classList.add(r)),this.syncHoverListeners()}changeHoverTarget(e,t){return t&&(this.hoverZone=null),e}updateHoverTarget(e,t){const r=this,{hoverCls:n,hoverAnimationCls:i,hoverRootActiveCls:s,hoverRootElement:a}=r;s&&(null==a||a.classList[e?"add":"remove"](s)),t&&(n&&t.classList.remove(n),i&&t.classList.remove(i),r.hoverLeave(t)),e&&(n&&e.classList.add(n),r.hoverEnter(t),r.hoverTrack&&r.hoverMove(r.hoverEvent),i&&(e.getBoundingClientRect(),e.classList.add(i)))}updateHoverTrack(){this.syncHoverListeners()}updateHoverZone(e){const{hoverAnimationCls:t,hoverTarget:r}=this;if(r){const{className:n}=r,i=DomClassList.change(n,e?ZONES[e]:null,EDGE_CLASSES);n!==i&&(r.className=i,e&&t&&(r.classList.remove(t),r.getBoundingClientRect(),r.classList.add(t)))}}setHoverTarget(e){this.hoverTarget=e}syncHoverListeners(){var e;const t=this,r=t.hoverRootElement,n={element:r,thisObj:t,mouseover:"onHoverMouseOver",mouseout:"onHoverMouseOut"};(t.hoverTrack||t.hoverEdges)&&(n.mousemove="onHoverMouseMove"),null==(e=t._hoverRootDetacher)||e.call(t),t._hoverRootDetacher=r&&EventHelper.on(n)}},LoadMaskable_default=e=>class extends e{static get $name(){return"LoadMaskable"}static get configurable(){return{loadMaskDefaults:{useTransition:!0,showDelay:1e3},loadMaskError:{icon:"gt-icon gt-icon-warning",autoClose:3e3,showDelay:0},loadMask:{text:"L{GridBase.loadMask}"},syncMask:{text:"L{GridBase.syncMask}"},localizableProperties:["loadMask.text","syncMask.text"],testConfig:{loadMaskError:{icon:"gt-icon gt-icon-warning",autoClose:500,showDelay:0}}}}applyLoadMask(){const e=this,{loadMask:t}=e;return t&&(e.masked=Mask.mergeConfigs(e.loadMaskDefaults,t)),e.masked}applyMaskError(e){const{loadMaskError:t,masked:r}=this;return!1===t?r.hide():r&&(ObjectHelper.assign(r.errorDefaults,t),r.error=e),r}get widgetClass(){}},excludedPropNames={constructor:1,prototype:1,name:1,length:1,arguments:1,caller:1,callee:1,__proto__:1},Override=class{static apply(e){if(!e.target)throw new Error("Override must specify what it overrides, using static getter target");if(!e.target.class)throw new Error("Override must specify which class it overrides, using target.class");if(!this.shouldApplyOverride(e))return!1;const t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(e.prototype);return t.splice(t.indexOf("target"),1),this.internalOverrideAll(e.target.class,t,e),this.internalOverrideAll(e.target.class.prototype,r,e.prototype),!0}static internalOverrideAll(e,t,r){Reflect.ownKeys(r).forEach((n=>{if(t.includes(n)&&!excludedPropNames[n]){const t=Object.getOwnPropertyDescriptor(r,n);let i=e,s=null;for(;!s&&i;)s=Object.getOwnPropertyDescriptor(i,n),s||(i=Object.getPrototypeOf(i));s&&this.internalOverride(i,n,t,s)}}))}static internalOverride(e,t,r,n){(e._overridden=e._overridden||{})[t]=e[t],n.get?Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:r.get}):e[t]=r.value}static shouldApplyOverride(e){const t=e.target;if(!t.maxVersion&&!t.minVersion)return!0;if(!t.product)throw new Error("Override must specify product when using versioning");return(!t.maxVersion||!VersionHelper[t.product].isNewerThan(t.maxVersion))&&(!t.minVersion||!VersionHelper[t.product].isOlderThan(t.minVersion))}};Override._$name="Override";var{defineProperty:defineProperty8}=Object,{hasOwn:hasOwn4}=ObjectHelper,fencibleSymbol=Symbol("fencible"),NONE=[],distinct=e=>Array.from(new Set(e)),parseNames=e=>e?distinct(StringHelper.split(e)):NONE,fenceMethod=(e,t,r)=>{!0===r&&(r=t),ObjectHelper.isObject(r)||(r={all:r});let n=parseNames(r.any);const i=parseNames(r.all),s=r.lock?parseNames(r.lock):distinct(i.concat(n)),a=t+"Impl";n=n.length?n:null,!e[a]&&defineProperty8(e,a,{configurable:!0,value:e[t]}),defineProperty8(e,t,{configurable:!0,value:function(...e){const t=this,r=hasOwn4(t,fencibleSymbol)?t[fencibleSymbol]:t[fencibleSymbol]={},o=e=>!r[e];if(i.every(o)&&(!n||n.some(o)))try{return s.forEach((e=>r[e]=(r[e]||0)+1)),t[a](...e)}finally{s.forEach((e=>--r[e]))}}})},Fencible_default=e=>{var t;return __publicField(t=class extends(e||Base){static setupFenced(e){let{fenced:t}=e;const r=t.static,n=[];r&&(t={...t},delete t.static,n.push([r,e])),n.push([t,e.prototype]);for(const[e,t]of n)for(const r in e)fenceMethod(t,r,e[r])}get widgetClass(){}},"$name","Fencible"),__publicField(t,"declarable",["fenced"]),t},MILLIS_PER_MINUTE=6e4,MILLIS_PER_HOUR=60*MILLIS_PER_MINUTE,MILLIS_PER_DAY=24*MILLIS_PER_HOUR,timeRe=/(\d+)?:?(\d*)/,DayTime=class{static format(e){const t=Math.floor(e/MILLIS_PER_HOUR),r=Math.floor(e/MILLIS_PER_MINUTE)%60;return t+":"+(r<10?"0":"")+r}static parse(e){const t=typeof e;if("string"===t){const t=timeRe.exec(e);e=Number(t[1]||0)*MILLIS_PER_HOUR+Number(t[2]||0)*MILLIS_PER_MINUTE}else"number"!==t?e=DateHelper.getTimeOfDay(e):e<=24&&(e*=MILLIS_PER_HOUR);return Math.min(Math.max(Math.floor(e),0),MILLIS_PER_DAY)}constructor(e){let t,r,n=0;(null==e?void 0:e.isDayView)?(n=e.dayStartShift,t=e.dayStartTime,r=e.dayEndTime):"number"==typeof e?n=t=r=e:e&&(n=e.startShift,t=e.timeStart,r=e.timeEnd),this.startShift=n=DayTime.parse(n||0),this.timeEnd=(null==r?(n+MILLIS_PER_DAY)%MILLIS_PER_DAY:DayTime.parse(r))||MILLIS_PER_DAY,this.timeStart=null==t?n:DayTime.parse(t)}get startHour(){return Math.floor(this.timeStart/MILLIS_PER_HOUR)}get endHour(){return Math.floor(this.timeEnd/MILLIS_PER_HOUR)}get startTimeOffsetMs(){const{startShift:e,timeStart:t}=this;return t<e?MILLIS_PER_DAY-e+t:t-e}get today(){return this.startOfDay(new Date)}ceil(e){const t=this.startOfDay(e);return t<e&&t.setDate(t.getDate()+1),t}contains(e){return!this.outside(e)}dateKey(e){return e=this.shiftDate(e,-1),DateHelper.makeKey(e)}dayOfDate(e){return this.shiftDate(DateHelper.clearTime(e))}dayOfWeek(e){return(e=this.shiftDate(e,-1)).getDay()}delta(e,t="ms"){const{timeStart:r}=this,n=DayTime.parse(e),i=(this.startShift&&n<r?n+MILLIS_PER_DAY:n)-r;return"ms"===t?i:DateHelper.as(t,i,"ms")}duration(e="ms"){const{timeStart:t,timeEnd:r}=this,n=t<r?r-t:MILLIS_PER_DAY-t+r;return"ms"===e?n:DateHelper.as(e,n,"ms")}equals(e){return this.startShift===(null==e?void 0:e.startShift)&&this.timeStart===e.timeStart&&this.timeEnd===e.timeEnd}intersects(e,t){const r=this,{timeStart:n,timeEnd:i}=r,[s,a]=r._dateRangeArgs(e,t),[o,l]=r.timeRange(s,a);return n<i?o<l?o<i&&n<=l:o<i||n<=l:!(o<l)||o<i||n<=l}isIntraDay(e,t){const[r,n]=this._dateRangeArgs(e,t),i=this.startOfDay(r),s=MILLIS_PER_DAY-DateHelper.diff(i,n,"ms");return!(s<0)&&(s>0||i<r)}isInterDay(e){return e.allDay||!this.isIntraDay(...arguments)}outside(e){const{startShift:t,timeStart:r,timeEnd:n}=this,i=DayTime.parse(e);return r<n?i<r?i<t?1:-1:i<n?0:i<t?-1:1:i<n||i>=r?0:i<t?1:-1}parseKey(e){return this.dayOfDate(DateHelper.parseKey(e))}shiftDate(e,t=1){const{startShift:r}=this,n=typeof e;return e="number"===n?new Date(e):"string"===n?DateHelper.parse(e):new Date(e.getTime()),t&&r&&e.setMilliseconds(t>0?r:-r),e}sortEvents(e,t){const r=this.startOfDay(e);return null==t?void 0:t.sort(((e,t)=>{e=e.eventRecord||e,t=t.eventRecord||t;let{startDate:n}=e,{startDate:i}=t;return n?i?(n=n<r?r:n,i=i<r?r:i,n-i||t.endDate-i-(e.endDate-n)):1:-1}))}startOfDay(e){return e=this.shiftDate(e,-1),e=DateHelper.clearTime(e),e=this.shiftDate(e)}timeRange(e,t){const[r,n]=this._dateRangeArgs(e,t);return[DateHelper.getTimeOfDay(r),DateHelper.getTimeOfDay(n)]}toString(){const{startShift:e,timeEnd:t,timeStart:r}=this,n=e?"@"+DayTime.format(e):"",i=DayTime.format(r);return r===t?e?n:i:i+"-"+DayTime.format(t)+n}_dateRangeArgs(e,t){return e.isModel?[e.startDate,e.endingDate]:[e,t]}};DayTime.MIDNIGHT=new DayTime({startShift:0,timeStart:0,timeEnd:24}),DayTime.MILLIS_PER_MINUTE=MILLIS_PER_MINUTE,DayTime.MILLIS_PER_HOUR=MILLIS_PER_HOUR,DayTime.MILLIS_PER_DAY=MILLIS_PER_DAY,DayTime._$name="DayTime";var _Month=class extends(Events_default(Base)){static get configurable(){return{date:{$config:{equal:"date"},value:DateHelper.clearTime(new Date)},month:null,year:null,weekStartDay:null,hideNonWorkingDays:null,nonWorkingDays:null,sixWeeks:null}}configure(e){super.configure(e),this.updateDayNumbers(),e.date&&(this.date=e.date),this.generation=0}changeDate(e){if(!this.isConfiguring){if(e="string"==typeof e?DateHelper.parse(e,"YYYY-MM-DD"):new Date(e),isNaN(e))throw new Error("月日期摄入必须通过日期或有效的YYYY-MM-DD日期字符串");return e}}updateDate(e,t){const r=this,{dayColumnIndex:n,weekCount:i}=r,s=DateHelper.getFirstDateOfMonth(e),a=DateHelper.getLastDateOfMonth(s),o=n[s.getDay()],l=n[a.getDay()],c=!t||e.getFullYear()!==t.getFullYear(),d=!t||e.getMonth()!==t.getMonth(),u=r.eventListeners&&(t?e.getDate()!==t.getDate()|(r.getWeekId(e)!==r.getWeekId(t))<<1|d<<2|c<<3:15);if(r._year=e.getFullYear(),r._month=e.getMonth(),r.startDayOfMonth=1-o,r.endDayOfMonth=a.getDate()+(6-l),r.sixWeeks&&(r.endDayOfMonth+=7*(6-r.weekCount)),r.weekBase&&!c||r.calculateWeekBase(),(d||c)&&r.generation++,u){const n={newDate:e,oldDate:t,changes:{d:!0,w:Boolean(2&u),m:Boolean(12&u),y:Boolean(8&u),r:r.weekCount!==i}};r.trigger("dateChange",n),2&u&&r.trigger("weekChange",n),12&u&&r.trigger("monthChange",n),8&u&&r.trigger("yearChange",n)}}calculateWeekBase(){const e=this,{dayColumnIndex:t}=e,r=new Date(e.year,0,1),n=new Date(e.year,11,31),i=e.month?e.getOtherMonth(r):e;e.dayColumnIndex[r.getDay()]>3?e.weekBase=i.startDate:e.weekBase=new Date(e.year,0,i.startDayOfMonth-7);const s=Math.floor(DateHelper.diff(e.weekBase,n,"day")/7);e.has53weeks=53===s&&t[n.getDay()]>2}getWeekStart(e){if("number"==typeof e)return DateHelper.add(this.weekBase,7*Math.max(e,1),"day");const t=this,[r,n]=e;return r===t.year?t.getWeekStart(n):t.getOtherMonth(new Date(r,0,1)).getWeekStart(n)}getOtherMonth(e){const t=this,r=t===otherMonth?new _Month(null):otherMonth;return r.configure({weekBase:null,weekStartDay:t.weekStartDay,nonWorkingDays:t.nonWorkingDays,hideNonWorkingDays:t.hideNonWorkingDays,sixWeeks:t.sixWeeks,date:new Date(e.getFullYear(),0,1)}),r.date=e,r.updateDate(r.date,r.date),r}changeYear(e){const t=new Date(this.date);t.setFullYear(e),this.date=t}changeMonth(e){const t=new Date(this.date);t.setMonth(e),this.date=t}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:DateHelper.weekStartDay}updateWeekStartDay(){const e=this;e.updateDayNumbers(),!e.isConfiguring&&e.date&&(e.weekBase=null,e.updateDate(e.date,e.date))}get nonWorkingDays(){return this._nonWorkingDays||DateHelper.nonWorkingDays}changeNonWorkingDays(e){return ObjectHelper.assign({},e)}updateNonWorkingDays(){this.updateDayNumbers()}updateHideNonWorkingDays(){this.updateDayNumbers()}updateSixWeeks(){this.isConfiguring||this.updateDate(this.date,this.date)}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.startDayOfMonth)}get endDate(){const e=this;if(null!=e.year&&null!=e.month&&null!=e.startDayOfMonth)return new Date(e.year,e.month,e.endDayOfMonth)}eachDay(e){for(let t=this.startDayOfMonth;t<=this.endDayOfMonth;t++)e(new Date(this.year,this.month,t))}eachWeek(e){const t=this,{weekCount:r}=t;for(let n=t.startDayOfMonth,i=0;i<r;i++){const r=[],i=t.getWeekNumber(new Date(t.year,t.month,n));for(let e=0;e<7;e++,n++)r.push(new Date(t.year,t.month,n));e(i,r)}}getWeekNumber(e){const t=this;if((e=DateHelper.clearTime(e)).getFullYear()!==t.year)return t.getOtherMonth(new Date(e.getFullYear(),0,1)).getWeekNumber(e);let r=Math.floor(DateHelper.diff(t.weekBase,e,"day")/7),n=e.getFullYear();return r?(53!==r||t.has53weeks?r>53&&(r%=52):(r=1,n++),[n,r]):t.getOtherMonth(new Date(t.year-1,0,1)).getWeekNumber(new Date(t.year,0,0))}getWeekId(e){const t=this.getWeekNumber(e);return 100*t[0]+t[1]}getCellData(e,t,r=DayTime.MIDNIGHT){const n=this,i=e.getDay(),s=n.visibleDayColumnIndex[i],a=n.nonWorkingDays[i],o=n.hideNonWorkingDays&&a;return(e<n.startDate||e>n.endDate)&&(n.month=e.getMonth()),{day:i,dayTime:r,visibleColumnIndex:s,isNonWorking:a,week:n.getOtherMonth(e).getWeekNumber(e),key:DateHelper.format(e,"YYYY-MM-DD"),columnIndex:n.dayColumnIndex[i],date:new Date(e),dayEnd:r.duration("s"),tomorrow:r.dayOfDate(DateHelper.add(e,1,"day")),isOtherMonth:Math.sign(e.getMonth()+12*e.getFullYear()-(t.month+12*t.year)),visible:!o&&e>=t.startDate&&e<DateHelper.add(t.endDate,1,"day"),isRowStart:0===s,isRowEnd:s===n.visibleColumnCount-1}}updateDayNumbers(){const e=this,{weekStartDay:t,nonWorkingDays:r,hideNonWorkingDays:n}=e,i=e.dayColumnIndex=[],s=e.canonicalDayNumbers=[],a=e.visibleDayColumnIndex=[];let o=0;for(let e=0;e<7;e++){const l=(t+e)%7;s[e]=l,i[l]=e,n&&r[l]||(a[l]=o++)}e.visibleColumnCount=o,e.weekLength=n?7-ObjectHelper.keys(r).length:7}},Month=_Month;__publicField(Month,"$name","Month");var otherMonth=new Month(null);Month._$name="Month";var nextObjectIdentity=0,objectIdentityMap=new WeakMap,argsToCacheKey=(...e)=>e.map((e=>{let t;return e&&"object"==typeof e||"function"==typeof e?(t=objectIdentityMap.get(e),void 0===t&&(t=++nextObjectIdentity,objectIdentityMap.set(e,t))):t=String(e),t})).join("-"),memo=e=>{const t=new Map;return(...r)=>{const n=argsToCacheKey(r);let i=t.get(n);return void 0===i&&(i=e(...r),t.set(n,i)),i}},memoCps=e=>{const t=new Map,r=e=>e[0],n=e=>e[1],i=(e,t)=>r(e).push(t);return(s,a)=>{const o=(e=>{let r=t.get(e);return void 0===r&&(r=[[],[]],t.set(e,r)),r})(s);(e=>!n(e).length&&!r(e).length)(o)?(i(o,a),e(s,(e=>{((e,t)=>n(e).some((e=>ObjectHelper.isEqual(e,t))))(o,e)||(((e,t)=>{n(e).push(t)})(o,e),r(o).forEach((t=>t(e))))}))):(i(o,a),n(o).forEach((e=>a(e))))}},SUCCESS=Symbol("success"),FAILURE=Symbol("failure"),success=(e,t)=>[SUCCESS,e,t],failure=e=>[FAILURE,e],isSuccess=e=>e.length&&e[0]===SUCCESS,resolveParser=e=>"function"!=typeof e||e.length?e:e(),succeed=memo((e=>memoCps(((t,r)=>r(success(e,t)))))),string=memo((e=>memoCps(((t,r)=>{const n=Math.min(e.length,t.length),i=t.substr(0,n),s=t.substr(n);r(i===e?success(i,s):failure(s))})))),bind=(e,t)=>(r,n)=>resolveParser(e)(r,(e=>{if(isSuccess(e)){const[,r,i]=e;t(r)(i,n)}else n(e)})),seq=memo(((...e)=>{const t=memo(((e,t)=>memoCps(bind(e,(e=>bind(t,(t=>succeed([].concat(e,t)))))))));return e.reduce(t,succeed([]))})),alt=memo(((...e)=>memoCps(((t,r)=>e.forEach((e=>resolveParser(e)(t,r))))))),regexp=memo((e=>(t,r)=>{const n=new RegExp("^"+e).exec(t);if(n){const e=n[0],i=t.substr(e.length);r(success(e,i))}else r(failure(t))})),red=memo(((e,t)=>bind(e,((...e)=>succeed(t(...[].concat.apply([],e))))))),runParser=(e,t)=>{const r=[];return e(t,(e=>{if(isSuccess(e)){const[,,t]=e;""===t&&r.push(e)}})),r},defineParser=e=>(t,r)=>r?resolveParser(e)(t,r):runParser(resolveParser(e),t),Parser_default={memo:memo,memoCps:memoCps,success:success,failure:failure,isSuccess:isSuccess,resolveParser:resolveParser,succeed:succeed,string:string,bind:bind,seq:seq,alt:alt,regexp:regexp,red:red,runParser:runParser,defineParser:defineParser},ScrollManager=class extends(Delayable_default(Base)){static get configurable(){return{element:null,zoneWidth:50,scrollSpeed:5,direction:"both",startScrollDelay:500,stopScrollWhenPointerOut:!1,testConfig:{scrollSpeed:2,startScrollDelay:100},activeScroll:{$config:["lazy"],value:{}},monitoring:{$config:["lazy","nullify"],value:!0},owner:null}}changeMonitoring(e,t){return null==t||t.clear(),new Map}doDestroy(){this.stopMonitoring(),super.doDestroy()}get isScrolling(){return 0!==Object.keys(this.activeScroll).length}get rtl(){var e;return null==(e=this.owner)?void 0:e.rtl}startMonitoring(e={}){const t=this,{element:r,direction:n}=t,{scrollables:i=[],direction:s=n,callback:a}=e,o=[];return i.length||i.push({element:r}),i.forEach((e=>{const n=e.element;"string"==typeof n?DomHelper.forEachSelector(r,n,(r=>{t.createMonitor(r,e.direction||s,e.callback||a),o.push(r)})):(t.createMonitor(n,e.direction||s,e.callback||a),o.push(n))})),function(){var e;null==(e=t.stopMonitoring)||e.call(t,o)}}createMonitor(e,t,r){const{monitoring:n}=this;n.has(e)||n.set(e,new ScrollManagerMonitor({scrollManager:this,element:e,direction:t,callback:r}))}stopMonitoring(e){const t=this,{monitoring:r}=t;if(e=ArrayHelper.asArray(e),r){if(!e)return void r.forEach((e=>t.stopMonitoring(e.element)));e.forEach((e=>{const t=r.get(e);e.classList.remove("b-scrolling"),t&&(t.destroy(),r.delete(e))}))}}requestScroll(e,t){const{activeScroll:r}=this;return(!(e in r)||r[e]===t)&&(r[e]=t,!0)}releaseScroll(e){const{activeScroll:t={}}=this;Object.keys(t).forEach((r=>{t[r]===e&&delete t[r]}))}getRelativeScroll(e,t="left"){let r=0;return this.monitoring.forEach(((n,i)=>{DomHelper.isDescendant(i,e)&&(r+="left"===t?n.scrollRelativeLeft:n.scrollRelativeTop)})),r}},ScrollManagerMonitor=class extends Base{construct(e){const{element:t}=e,r=t.scrollLeft,n=t.scrollTop;Object.assign(e,{startScrollLeft:r,startScrollTop:n}),super.construct(e),EventHelper.on({element:t,scroll:"onElementScroll",pointermove:"onMouseMove",capture:!0,thisObj:this}),EventHelper.on({element:t,pointerleave:"onPointerLeave",thisObj:this})}doDestroy(){this.stopScroll(),super.doDestroy()}startScroll(){this.scrolling=!0,this.performScroll()}stopScroll(){const e=this;e.scrolling=!1,e.scrollRequested&&(e.scrollManager.cancelAnimationFrame(e.frameId),e.scrollRequested=!1),e.scrollManager.clearTimeout(e.scrollTimeout),e.scrollManager.releaseScroll(e),e.scrollTimeout=null}onPointerLeave(){this.scrollManager.stopScrollWhenPointerOut&&this.stopScroll()}onMouseMove(e){const t=this,{scrollManager:r}=t,n=t.element.getBoundingClientRect(),i=r.zoneWidth,s=r.scrollSpeed;if(t.scrollDeltaX=t.scrollDeltaY=0,"vertical"!==t.direction){const{scrollLeft:a,scrollWidth:o,clientWidth:l}=t.element;r.rtl?e.clientX<n.left+i&&o+a-l>=1?t.scrollDeltaX=-Math.round((i+(n.left-e.clientX))/s)-1:e.clientX>n.right-i&&a<0&&(t.scrollDeltaX=Math.round((i-(n.right-e.clientX))/s)+1):e.clientX>n.right-i&&o-a-l>=1?t.scrollDeltaX=Math.round((i-(n.right-e.clientX))/s)+1:e.clientX<n.left+i&&a>0&&(t.scrollDeltaX=-Math.round((i+(n.left-e.clientX))/s)-1)}if("horizontal"!==t.direction){const{scrollTop:r,scrollHeight:a,clientHeight:o}=t.element;e.clientY>n.bottom-i&&a-r-o>=1?t.scrollDeltaY=Math.round((i-(n.bottom-e.clientY))/s)+1:e.clientY<n.top+i&&r>0&&(t.scrollDeltaY=-Math.round((i+(n.top-e.clientY))/s)-1)}0===t.scrollDeltaX||r.requestScroll("horizontal",t)||(t.scrollDeltaX=0),0===t.scrollDeltaY||r.requestScroll("vertical",t)||(t.scrollDeltaY=0),0===t.scrollDeltaX&&0===t.scrollDeltaY?t.scrolling&&t.stopScroll():t.scrollTimeout||(t.scrollTimeout=r.setTimeout((()=>t.startScroll()),r.startScrollDelay))}performScroll(){const e=this,{element:t}=e;if(e.scrolling&&!e.scrollRequested){if(0!==e.scrollDeltaX){const r=t.scrollLeft,n=Math.min(r+e.scrollDeltaX,t.scrollWidth-t.clientWidth);n!==r&&(t.scrollLeft=n)}if(0!==e.scrollDeltaY){const r=t.scrollTop,n=Math.min(r+e.scrollDeltaY,t.scrollHeight-t.clientHeight);n!==r&&(t.scrollTop=n)}e.scrollRequested=!0,e.frameId=e.scrollManager.requestAnimationFrame((()=>{e.scrollRequested=!1,e.performScroll(e)}))}}onElementScroll(){var e,t;null==(t=null==(e=this.config)?void 0:e.callback)||t.call(this.thisObj||this.scrollManager,this)}get scrollLeft(){return this.element.scrollLeft}get scrollTop(){return this.verticalElement?this.verticalElement.scrollTop:this.element.scrollTop}get scrollRelativeLeft(){return this.scrollLeft-this.startScrollLeft}get scrollRelativeTop(){return this.scrollTop-this.startScrollTop}getRelativeLeftScroll(e){return this.scrollManager.getRelativeScroll(e,"left")}getRelativeTopScroll(e){return this.scrollManager.getRelativeScroll(e,"top")}};ScrollManager._$name="ScrollManager";var realignTransitions={left:!0,right:!0,top:!0,bottom:!0,transform:!0},isBoolean={true:1,false:1},immediatePromise4=Promise.resolve(),Tooltip=class extends Popup{static get $name(){return"Tooltip"}static get type(){return"tooltip"}static get configurable(){return{mouseOffsetX:15,mouseOffsetY:15,html:{$config:{equals:()=>!1}},getHtml:null,forElement:null,trackMouse:null,updateContentOnMouseMove:!1,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:null,anchor:!0,align:{align:"b-t",minHeight:300},axisLock:!0,activeTarget:null,testConfig:{hideDelay:100,hoverDelay:100,showAnimation:null,hideAnimation:null}}}afterConfigure(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.anchorToTarget||(e.trackMouse=!0),e.forElement=e.rootElement.host||e.rootElement)),super.afterConfigure(),e.forElement&&e.showOnHover&&(e.pointerOverOutDetacher=EventHelper.on({element:e.forElement,pointerover:"internalOnPointerOver",pointerout:"internalOnPointerOut",thisObj:e}))}doDestroy(){var e;null==(e=this.pointerOverOutDetacher)||e.call(this),super.doDestroy()}set focusOnToFront(e){super.focusOnToFront=e}get focusOnToFront(){return super.focusOnToFront&&DomHelper.usingKeyboard}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget&&!this.trackMouse}get anchor(){return super.anchor&&!this.trackMouse}set anchor(e){super.anchor=e}onDocumentMouseDown({event:e}){const t=this,{triggeredByEvent:r}=t;r&&DomHelper.isTouchEvent&&e.pageX===r.pageX&&e.pageY===r.pageY&&t.activeTarget.contains(e.target)&&performance.now()-r.timeStamp<500||(t.abortDelayedShow(),super.onDocumentMouseDown({event:e}))}internalOnPointerOver(e){const t=this,{target:r,relatedTarget:n}=e,{forElement:i,forSelector:s,activeTarget:a}=t;let o;if(!(t.disabled||t.owner&&!t.owner.showTooltipWhenDisabled&&t.owner.disabled||t.allowOver&&t.element.contains(r))){if(s){if(o=t.filterTarget(r),(null==a?void 0:a.contains(r))&&a.contains(n)&&o===a)return;if(o&&(null==n?void 0:n.closest(s))===o)return}else{if(i.contains(n))return;o=i}o?t.handleForElementOver(e,o):a&&t.handleForElementOut()}}filterTarget(e){return e.closest(this.forSelector)}onTransitionEnd(e){var t;const r=this,{currentOverElement:n}=Tooltip;if(realignTransitions[e.propertyName]){if(r.allowOver&&r.element.contains(n))return;(null==(t=r.activeTarget)?void 0:t.contains(n))&&!r.trackMouse&&r.realign()}}async handleForElementOver(e,t){const r=this,{activeTarget:n,hideOnDelegateChange:i,anchorToTarget:s}=r,a=t!==n,o=a&&i;if(!1===r.trigger("pointerOver",{event:e,target:t}))r.internalOnPointerOut(e);else{if(r.triggeredByEvent=e,r.hasTimeout("hide")&&(r.abortDelayedHide(),!a))return;if(!i&&r.element.classList.contains("b-hiding")&&r.cancelHideShowAnimation(),!r._hidden&&o&&r.hide(!1),r.activeTarget=t,r.isVisible){const e=r.updateContent();if(Objects.isPromise(e)&&!r.loadingMsg&&await e,!1===r.trigger("beforeShow"))return r.hide();r.alignTo({[s?"target":"position"]:s?t:"mouse",overlap:!(s&&r.anchor)}),r.trigger("show"),r.afterShowByTarget()}else r.delayShow(t)}}async delayShow(e){var t;const r=this;if((null==(t=r.currentAnimation)?void 0:t.showing)&&r.cancelHideShowAnimation(),r.isVisible||r.hasTimeout("show"))r.isVisible&&r.showByTarget(e);else if(!r.hoverDelay||r.forSelector&&Date.now()-r.lastHidden<r.quickShowInterval){const t=r.updateContent();Objects.isPromise(t)&&!r.loadingMsg&&await t,r.showByTarget(e)}else r.addDocumentMouseDownListener(),r.listeningForMouseMove||r.anchorToTarget||(r.mouseMoveRemover=EventHelper.on({element:r.rootElement,mousemove:"onMouseMove",thisObj:r})),r.setTimeout((async()=>{if(e.isConnected){const t=r.updateContent();Objects.isPromise(t)&&!r.loadingMsg&&await t,r.showByTarget(e)}}),r.triggeredByEvent&&"pointerover"!==r.triggeredByEvent.type?0:r.hoverDelay,"show")}changeAllowOver(e){return this.inAfterShow||(this.configuredAllowOver=e),e}updateAllowOver(e){var t;const r=this,{element:n}=r;n.classList.toggle("b-allow-over",Boolean(e)),e?r.allowOverlisteners=EventHelper.on({element:n,mouseenter:"onOwnElementMouseEnter",mouseleave:"internalOnPointerOut",thisObj:r}):null==(t=r.allowOverlisteners)||t.call(r)}updateContent(){const e=this;if(e.getHtml){const t=e.callback(e.getHtml,e,[{tip:e,element:e.element,activeTarget:e.activeTarget,event:e.triggeredByEvent}]);return e.html=t,t}}get hasContent(){return Boolean(DomHelper.isReactElement(this._html)||""!==this._html&&"string"==typeof this.html&&this.html.length||this.items.length)}internalBeforeShow(){return(this.updateContentOnMouseMove||this.hasContent)&&!this.disabled}showAsyncMessage(e=this.optionalL(this.loadingMsg)){e&&(this.html='<div class="b-tooltip-loading"><i class="gt-icon gt-icon-spinner"></i>'+e+"\n                </div>\n            ")}showByTarget(e){var t;const r=this,{anchorToTarget:n}=r;r.mouseMoveRemover=null==(t=r.mouseMoveRemover)?void 0:t.call(r),r.showBy({[n?"target":"position"]:n?e:"mouse",overlap:!(n&&r.anchor)})}afterShowByTarget(){const e=this,{dismissDelay:t}=e;e.abortDelayedShow(),t&&e.setTimeout("hide",t),e.toFront(),e.mouseMoveRemover||!e.trackMouse&&!e.updateContentOnMouseMove||(e.mouseMoveRemover=EventHelper.on({element:e.rootElement,pointermove:"onMouseMove",thisObj:e})),e.inAfterShow=!0,e.allowOver=e.allowOver||0!=e.configuredAllowOver&&e.childItems.some((e=>e.isVisible&&!e.disabled&&e.focusElement)),e.inAfterShow=!1}updateActiveTarget(e,t){e&&!this.isConfiguring&&this.trigger("overTarget",{newTarget:e,lastTarget:t})}internalOnPointerOut(e){var t;const r=this,n=e.relatedTarget;r.allowOver&&r.element.contains(n)||r.element.contains(e.target)&&(null==(t=r.activeTarget)?void 0:t.contains(n))||r.activeTarget&&!r.activeTarget.contains(n)&&r.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;!1!==e.trigger("pointerOut")?(e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())):e.activeTarget=null}show(e){const t=this;!e&&t.forElement&&t.anchorToTarget&&!t.forSelector?t.showByTarget(t.forElement):super.show(...arguments),t.isVisible&&(t.afterShowByTarget(),!t.forElement||t.transitionEndDetacher||t._hidden||(t.transitionEndDetacher=EventHelper.on({element:t.forElement,transitionend:"onTransitionEnd",thisObj:t})))}hide(){var e,t;const r=this;if(r.abortDelayedShow(),r._hidden)return immediatePromise4;{r.abortDelayedHide();const n=super.hide(...arguments);return r.lastHidden=Date.now(),r.activeTarget=null,null==(e=r.mouseMoveRemover)||e.call(r),r.mouseMoveRemover=null,null==(t=r.transitionEndDetacher)||t.call(r),r.transitionEndDetacher=null,n}}abortDelayedShow(){var e,t,r;const n=this;n.hasTimeout("show")&&(null==(e=n.mouseDownRemover)||e.call(n),n.mouseDownRemover=null,n.clearTimeout("show"),null==(t=n.mouseMoveRemover)||t.call(n),n.mouseMoveRemover=null,null==(r=n.transitionEndDetacher)||r.call(n),n.transitionEndDetacher=null)}abortDelayedHide(){this.clearTimeout("hide")}realign(){const e=this,t=e.lastAlignSpec;e.isConfiguring||e.isVisible||!(null==t?void 0:t.targetOutOfView)||(t.allowTargetOut||DomHelper.isInView(t.target,!1,e))&&(e.show(),t.targetOutOfView=!1),super.realign()}alignTo(e){const t=this,{mouseOffsetX:r,mouseOffsetY:n}=t;if(!t.isVisible)return;let i;t.anchorToTarget||"mouse"!==e.position||(i=new Point(t.triggeredByEvent.pageX-globalThis.scrollX,t.triggeredByEvent.pageY-globalThis.scrollY),e.position=new Point(i.x+t.mouseOffsetX*(t.rtl?-1:1),i.y+t.mouseOffsetY)),!e||t.triggeredByEvent&&t.element.contains(t.triggeredByEvent.target)||e.nodeType===Node.ELEMENT_NODE&&(e={target:e}),super.alignTo(e),i&&t.lastAlignSpec.result.inflate(5).contains(i)&&(t.lastAlignSpec.position="mouse",t.mouseOffsetY=-n-t.height,t.mouseOffsetX=-r-t.width,t.realign(),t.mouseOffsetY=n,t.mouseOffsetX=r)}changeHtml(e){const t=this;return Objects.isPromise(e)?(t.showAsyncMessage(),e.target=t.activeTarget,void e.then((r=>{e.target===t.activeTarget&&(t.html=r)}))):("object"!=typeof e&&(e=null!=e?t.optionalL(String(e)):""),e)}updateHtml(e,t){const r=this;let n=""===e;n||(super.updateHtml(e,t),r.hasContent?(r.isVisible&&r.realign(),Objects.isPromise(e)||r.trigger("innerHtmlUpdate",{value:e})):n=!0),n&&r.hide()}onMouseMove(e){const t=this,{forElement:r,activeTarget:n}=t,i=t.hasTimeout("hide"),s=e.target;if(t.triggeredByEvent=e,!t._hidden){let a;const o=!(null==n?void 0:n.contains(s))&&t.forSelector&&n&&!i&&s.nodeType===Node.ELEMENT_NODE&&!s.matches(t.forSelector)&&!(t.allowOver&&t.element.contains(s)),l=(null==r?void 0:r.document)?r.document.documentElement:r,c=l&&(l.contains?l.contains(s):16&l.compareDocumentPosition(s));if(o&&(a=t.handleForElementOut()),a||!i||c){if(t.dismissDelay&&!i&&t.setTimeout("hide",t.dismissDelay),t.updateContentOnMouseMove&&t.getHtml&&(t.html=t.callback(t.getHtml,t,[{tip:t,element:t.element,forElement:n,event:e}]),!t.html))return void t.hide();t.trackMouse&&t.alignTo({position:"mouse",ignorePageScroll:!0})}}}onOwnElementMouseEnter(e){this.abortDelayedHide()}static getSharedTooltip(e,t){var r,n,i;let s=null==(n=null==(r=e.gantt)?void 0:r.tooltip)?void 0:n.get(Tooltip);if(!s&&!t){(null==(i=e.gantt)?void 0:i.tooltip)||ObjectHelper.setPath(e,"gantt.tooltip",new Map);const t=e.gantt.tooltip;t.set(Tooltip,!0),s=new Tooltip({forElement:e,rootElement:e,forSelector:"[data-btip]",resetCfg:{},isShared:!0,cls:"b-tooltip-shared",internalListeners:{pointerOver({source:e,target:t}){for(const t in e.resetCfg)"listeners"===t?e.un(e.resetCfg[t].set):"html"!==t&&(e[t]=e.resetCfg[t].was);e.resetCfg={};const r=Widget.getById(t.id),n=(null==r?void 0:r.tipConfig)||e.gatherDataConfigs(t.dataset);if(r&&r.element!==t||!r&&t.matches(".b-widget")||(null==r?void 0:r.disabled)&&!r.showTooltipWhenDisabled)return!1;e.owner=r;for(const t in n)e.resetCfg[t]={set:n[t],was:e[t]},"listeners"===t?e.ion(n[t]):e[t]=n[t]},hide({source:e}){e.owner=null}},gatherDataConfigs(e){const t=this,r={};for(const n in e)if(n.startsWith("btip"))if(n.length>4){const i=StringHelper.uncapitalize(n.substr(4));if(i in t.getDefaultConfiguration()){const t=e[n];r[i]=isBoolean[t]?"true"===t:isNaN(t)?t:parseInt(t,10)}}else r.html=e[n];return r},filterTarget(e){const t=e.closest(this.forSelector);if(t)return t;if(Tooltip.showOverflow)for(;(null==e?void 0:e.nodeType)===Element.ELEMENT_NODE;){if("ellipsis"===DomHelper.getStyleValue(e,"text-overflow")&&e.clientWidth<e.scrollWidth)return this.html=StringHelper.encodeHtml(e.textContent),e;e=e.parentNode}}}),EventHelper.on({element:e,mouseenter:e=>Tooltip.currentOverElement=e.target,keydown:e=>Tooltip.currentOverElement=e.target,capture:!0,thisObj:s}),t.set(Tooltip,s)}return s}static encodeConfig(e){const t={};if("string"==typeof e)t.btip=e;else for(const r in e)t["btip"+("html"===r?"":StringHelper.capitalize(r))]=e[r];return t}};Tooltip.initClass(),Object.defineProperty(Widget,"tooltip",{get:()=>Tooltip.getSharedTooltip(document.body)}),Widget.Tooltip=Tooltip,Tooltip._$name="Tooltip";var DragTipProxy=class extends DragProxy{static get type(){return"tip"}static get configurable(){return{align:"t10-b50",offset:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip"}}}}open(){this.getConfig("tooltip")}close(){var e;null==(e=this.tooltip)||e.hide()}dragMove(e){const{offset:t,tooltip:r}=this,{event:n}=e;r&&(r.isVisible||r.show(),r.alignTo({align:this.align,target:new Rectangle(n.clientX-t,n.clientY-t,2*t,2*t)}))}changeTooltip(e,t){return Widget.reconfigure(t,e,this)}};DragTipProxy.initClass(),DragTipProxy._$name="DragTipProxy";var Labelable_default=e=>class extends(e||Base){static get $name(){return"Labelable"}static get configurable(){return{label:null,labelPosition:"before",labelCls:null,labelWidth:{value:null,$config:{localeKey:"L{labelWidth}"}}}}get hasLabel(){return Boolean(this.label)}compose(){const{hasLabel:e,labelPosition:t}=this;return{class:{["b-label-"+t]:e,"b-has-label":e}}}changeLabel(e){return e||""}setupLabel(e){return ObjectHelper.assign({tag:"label",for:this.id+"-input",class:"b-label b-align-"+(e.align||"start")},e)}updateLabelWidth(e){this.labelElement&&(this.labelElement.style.flex="0 0 "+DomHelper.setLength(e),this.inputWrap.style.flexBasis=null==e?"":"auto")}get widgetClass(){}},FieldContainer=class extends Container{static get $name(){return"FieldContainer"}static get type(){return"fieldcontainer"}static get configurable(){return{animation:{duration:300},collapsed:null,collapser:{value:null,$config:"nullify"},syncableConfigs:null,syncConfigTriggers:{$config:{merge:"classList"},value:null},testConfig:{animation:{duration:10}}}}static get delayable(){return{syncChildConfigs:"raf"}}get inline(){var e;return null!=(e=this.owner.inline)?e:1===this.ensureItems().count}changeCollapsed(e){if(this.togglingCollapse)return this.togglingCollapse=!1,e;this.toggleCollapse(Boolean(e))}updateCollapsed(e){var t;this.collapser=null==(t=this.collapser)?void 0:t.destroy(),this.setCollapsedCls(e)}updateCollapser(e,t){t&&null==t.completed&&(t.reverting&&e||t.destroy()),this.setOwnerCls("b-collapsing",e)}get collapsing(){const{collapser:e}=this;return null!=e&&e.collapsed}get collapsingExpanding(){return null!=this.collapser}get expanding(){const{collapser:e}=this;return null!=e&&!e.collapsed}collapse(e){this.toggleCollapse(!0,e)}expand(e){this.toggleCollapse(!1,e)}setCollapsedCls(e){this.setOwnerCls("b-collapsed",e)}setOwnerCls(e,t){var r,n;null==(n=null==(r=this.owner)?void 0:r.element)||n.classList[t?"add":"remove"](e)}syncChildConfigs(){const e=this,{owner:t,syncableConfigs:r}=e;if(r){let n,i;for(n in r)i=r[n](t),e.eachWidget((e=>{e[n]=i}),!1)}t.afterSyncChildConfigs(e)}syncContainer(){const{inline:e,layout:t}=this;this.autoLayout&&(t.horizontal=e,t.justify=e?"center":"stretch")}toggleCollapse(e,t){const r=this,{animation:n,collapser:i,inline:s}=r,{containerWrapElement:a}=r.owner,o=t=>{t&&(r.element.style.height="",r.togglingCollapse=!0,r.collapsed=e,r.collapser=null)};if(null==e&&(e=!r.collapsed),!1!==t&&null!==t&&(a&&r.isVisible?(!0===t?t={}:"number"==typeof t&&(t={duration:t}),t=n||t?ObjectHelper.merge({},n,t):null):t=null),t){if(i&&e!==i.collapsed)r.collapser=i.revert({finalize:o}),r.collapser.collapsed=e;else if(!i&&e!==r.collapsed){!e&&r.setCollapsedCls(!1);const{element:n}=r,{height:i}=n.getBoundingClientRect(),l=s?1:i;!e&&r.setCollapsedCls(!0),n.style.height=i+"px",r.collapser=Animator.run(ObjectHelper.merge({finalize:o,element:a,[s?"opacity":"height"]:{from:e?l:0,to:e?0:l}},t)),r.collapser.collapsed=e}}else r.togglingCollapse=!0,r.collapsed=e}};FieldContainer.initClass(),FieldContainer._$name="FieldContainer";var byWeight=(e,t)=>(e.weight||0)-(t.weight||0),byWeightReverse=(e,t)=>(t.weight||0)-(e.weight||0),emptyArray8=[],triggerConfigs={align:!0,weight:!0},Field=class extends(Widget.mixin(Badge_default,Labelable_default)){static get $name(){return"Field"}static get type(){return"field"}static get configurable(){return{defaultBindProperty:"value",placeholder:null,value:"",name:null,labels:null,required:null,clearable:null,revertOnEscape:null,hint:null,hintHtml:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title","placeholder","labelWidth"],autoSelect:!1,autoComplete:"off",spellCheck:null,validateOnInput:!0,inputAttributes:null,inputType:"text",inputAlign:null,attributes:{value:["placeholder","autoComplete","spellCheck","minLength","maxLength","pattern","tabIndex","min","max"],$config:{merge:"distinct"}},nullValue:{$config:null,value:null,default:null},updatedClsDuration:500,inputReadOnly:!1,ariaElement:"input",container:{$config:"nullify",value:null},containerDefaults:{type:"fieldcontainer",syncableConfigs:{disabled:e=>e.disabled},syncConfigTriggers:{disabled:1}},containValues:null,inline:null,testConfig:{updatedClsDuration:10},keyMap:{}}}static get delayable(){return{highlightChanged:"raf"}}doDestroy(){var e,t,r;const n=this,{triggers:i}=n,s=n.isPainted&&Field.getSharedErrorTooltip(n.rootElement,!0);if(null==(e=n.inputListenerRemover)||e.call(n),null==(t=n.keyListenerRemover)||t.call(n),null==(r=n.container)||r.destroy(),super.doDestroy(),i)for(const e of Object.values(i))e.destroy();(null==s?void 0:s.field)===n&&s.hide()}get childItems(){const{container:e,triggers:t}=this,r=t?Object.values(t):[];return e?[...r,...e.childItems]:r}get invalidValueError(){return"L{invalidValue}"}get errorTip(){return this.constructor.getSharedErrorTooltip(this.rootElement)}static getSharedErrorTooltip(e,t){var r;let n=null==(r=e.gantt)?void 0:r.errorTooltip;return n||t||(e.gantt=e.gantt||{},n=new Tooltip({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:{align:"l-r",monitorTargetMutation:!0},scrollAction:"realign",trapFocus:!1,rootElement:e,onBeforeShow(){const e=this,t=Widget.fromElement(e.activeTarget);if(t){const r=t.getErrors();if(r)return e.html=r.join("<br>"),e.field=t,!0}return!1}}),e.gantt.errorTooltip=n),n}static get errorTip(){return this.getSharedErrorTooltip(document.body)}construct(e){super.construct(e);const t=this;t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}changeKeyMap(e){var t;const r=this;let n={};e&&(r._fieldKeyMap?ObjectHelper.assign(n,r._fieldKeyMap):(r._fieldKeyMap=e,ObjectHelper.assign(n,e)));for(const e in r.triggers)(null==(t=r.triggers[e])?void 0:t.keyMap)&&(n=r.mergeKeyMaps(n,r.triggers[e].keyMap,e));return n}get keyMapSubComponents(){return this.triggers}onFocusIn(e){const t=this;t.valueOnFocus=ObjectHelper.clone(t.value),t.validOnFocus=!(t.errors&&Object.keys(t.errors).length),super.onFocusIn(e),t.focusing=!0,t.syncInvalid(),t.focusing=!1}onFocusOut(e){super.onFocusOut(e),this.syncRequired(),this.onEditComplete()}onEditComplete(){}get rootUiClass(){return Field}compose(){this.getConfig("clearable");const e=this,{container:t,innerElements:r,label:n,labels:i,labelCls:s,readOnly:a,triggers:o}=e,l=ObjectHelper.values(o,((e,t)=>!t)),c=l.filter((e=>"start"===e.align)).sort(byWeight),d=l.filter((e=>"start"!==e.align)).sort(byWeightReverse),u=e.setupLabel.bind(e),h=[...c.map((e=>e.element)),...r,...d.map((e=>e.element))];return{class:{"b-has-start-trigger":c.length,"b-no-input":!r.length,"b-readonly":a,"b-field-container":Boolean(t),"b-field-container-inline":null==t?void 0:t.inline},children:[...(i||emptyArray8).filter((e=>e&&"end"!==e.align)).map(u),n?u({reference:"labelElement",class:"b-label b-align-start "+(s||""),html:n}):null,h.length?{class:"b-field-inner",reference:"inputWrap",children:h}:null,...(i||emptyArray8).filter((e=>"end"===(null==e?void 0:e.align))).map(u),...t?[{reference:"containerWrapElement",children:[t.element],class:{"b-field-container-wrap":1}}]:emptyArray8]}}updateElement(e,t){var r;const n=this,i=n.initialConfig.value,{input:s}=n;super.updateElement(e,t),null!=i&&(n.value=i),n.syncEmpty(),n.updateInputReadOnly(n.inputReadOnly),n.syncInvalid();const a=s||n.focusElement;null==(r=n.keyListenerRemover)||r.call(n),n.keyListenerRemover=a&&EventHelper.on({element:a,thisObj:n,keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}get innerElements(){return[this.inputElement]}get inputElement(){const{attributes:e,inputAttributes:t,id:r,inputCls:n,inputType:i,name:s}=this,a=ObjectHelper.assign({reference:"input",tag:"input",type:i,name:s||r,id:r+"-input",retainElement:!0},t);n&&(a.class=n);for(let t,r,n=e.length;n-- >0;)t=e[n],r=this[t],null!=r&&(a[t]=r);return a}get caretPos(){return this.textSelection[0]}set caretPos(e){this.textSelection=e}get focusElement(){return this.input}get textSelection(){var e;const t=this.input;let r;try{r=[t.selectionStart,t.selectionEnd,t.selectionDirection]}catch(n){r=(null==(e=t.value)?void 0:e.length)||0,r=[r,r]}return r}set textSelection(e){"number"==typeof e?this.select(e,e):this.select(...e)}get hasTextSelection(){const[e,t]=this.textSelection;return e&&t-e>0}getAfterValue(e){const[t,r]=this.textSelection,n=this.input.value;return""+n.substr(0,t)+e+n.substr(r||t)}select(e,t){const r=this.focusElement;if(r.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;r.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}syncEmpty(){var e;const{isEmptyInput:t,isEmpty:r,element:n}=this,i=null==(e=this.triggers)?void 0:e.clear,s=t&&r;n&&(i&&i[s?"hide":"show"](),n.classList.toggle("b-empty",s))}updateHint(){this.syncHint()}updateHintHtml(){this.syncHint()}syncHint(){const e=this,{input:t,hint:r,hintHtml:n}=e,i=null==t?void 0:t.parentElement;if(t){let s=n||r;const a=e.hintElement||s&&(e.hintElement=DomHelper.createElement({parent:i,className:"b-field-hint",nextSibling:t.nextSibling,children:[{className:"b-field-hint-content"}]}));a&&("function"==typeof s&&(s=s({source:e,value:e.value})),a.firstChild[n?"innerHTML":"textContent"]=s||""),e.element.classList[s?"remove":"add"]("b-field-no-hint")}}syncInvalid(){const e=this,{isPainted:t}=e;if(e.updatingInvalid=!0,t){const{isValid:t,element:r,inputWrap:n}=e;if(r.classList[t?"remove":"add"]("b-invalid"),t){const t=e.constructor.getSharedErrorTooltip(e.rootElement,!0);(null==t?void 0:t.isVisible)&&t.field===e&&t.hide()}else{const t=e.errorTip;t&&(e.containsFocus||e.isVisible&&n.contains(Tooltip.currentOverElement))&&(t.activeTarget===n&&t.isVisible?t.onBeforeShow():(t.activeTarget=n,t.showBy(n)))}}e.updatingInvalid=!1}updateEditable(){this.syncInputReadOnly()}syncInputReadOnly(){this.getConfig("readOnly"),this.inputReadOnly=this._readOnly||!1===this.editable}updateInputReadOnly(e){const t=this,{input:r,inputListenerRemover:n}=t;r&&(r.readOnly=e?"readOnly":null,e?t.inputListenerRemover=null==n?void 0:n():n||(t.inputListenerRemover=EventHelper.on({element:r,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput"})))}changeReadOnly(e){return Boolean(e)}updateReadOnly(e){this.syncInputReadOnly()}updateClearable(e){const t=this;t.getConfig("triggers"),t.triggers={clear:e&&ObjectHelper.assign({cls:"gt-icon-remove",weight:1e3,key:"Shift+backspace",handler(){t._isUserAction=!0,t.clear(...arguments),t._isUserAction=!1}},e)||null}}changeTriggers(e,t){const r=this,n=r.$triggers||(r.$triggers=new DynamicObject({configName:"triggers",factory:Field.Trigger,inferType:!1,owner:r,created(e){FunctionHelper.after(e,"onConfigChange",((e,{name:t})=>{triggerConfigs[t]&&r.onConfigChange({name:"triggers",value:n.target})}))},setup(e,t){e.reference=e.ref=t,e.parent=r}}));if(!1===r.stepTriggers&&(e.back||e.forward)&&(delete(e=ObjectHelper.assign({},e)).back,delete e.forward),n.update(e),r.element&&(r.keyMap=r.keyMap),!t)return n.target}updateInputWidth(e){this.input.style.width=DomHelper.setLength(e),this.element.classList.add("b-has-width")}updateInputAlign(e){this.input.style.textAlign=e}get isValid(){const e=this;if(!e.disabled){if(e.syncRequired(),e.errors&&Object.keys(e.errors).length)return!1;const t=e.validity;if(t)return t.valid}return!0}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get validity(){const e=this.input;return null==e?void 0:e.validity}changeValue(e,t){return null==e&&(e=this.nullValue),this.hasChanged(t,e)?e:(""===e&&this.syncRequired(),t)}updateValue(e,t){const r=this;r.isConfiguring||(r.syncRequired(),r.inputting||r.triggerChange()),r.inputting||(r._lastValue=e),r.syncInputFieldValue(),r.overflowTwin&&!r._overflowTwinSync&&(r._overflowTwinSync=!0,r.overflowTwin.value=e,r._overflowTwinSync=!1)}hasChanged(e,t){return t!==e}syncInputFieldValue(e=!1){const t=this,{input:r,parent:n,inputValueAttr:i,inputValue:s}=t;if(r&&!t.inputting&&r[i]!==s&&(r[i]=s,!t.isConfiguring&&!t.containsFocus&&t.highlightExternalChange)){if(r.classList.remove("b-field-updated"),t.clearTimeout("removeUpdatedCls"),n){const{assigningValues:t}=n;!0!==t&&!1!==(null==t?void 0:t.highlight)||(e=!0)}e||t.highlightChanged()}t.syncEmpty(),t.syncInvalid()}highlightChanged(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",this.updatedClsDuration)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get inputValueAttr(){return"value"}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&/text|search|password|tel|url/.test(e.type))}internalOnInputFocus(){this.autoSelect&&this.selectAll()}internalOnChange(e){const t=this;t.hasChanged(t._lastValue,t.value)&&t.isValid&&(t.triggerChange(e,!0),t._lastValue=t.value)}triggerChange(e,t=Boolean(this._isUserAction)){const r=this,{value:n,_lastValue:i,isValid:s}=r;r.syncHint(),r.triggerFieldChange({value:n,oldValue:i,event:e,userAction:t,valid:s}),"change"===r.defaultAction&&r.trigger("action",{value:n,oldValue:i,event:e,userAction:t,valid:s})}fetchInputValue(){this.value=this.input[this.inputValueAttr]}internalOnInput(e){var t;const r=this;r.validateOnInput||r.errorTip.hide(),r.inputting=!0,r.fetchInputValue(),r.inputting=!1,r.trigger("input",{value:r.value,event:e}),null==(t=r.changeOnKeyStroke)||t.call(r,e)}get needsInputSync(){var e;return this.input[this.inputValueAttr]!==String(null!=(e=this.inputValue)?e:"")}internalOnKeyEvent(e){const t=this,{value:r}=t;let n=!1;if("keydown"===e.type&&"Escape"===e.key&&!t.readOnly&&!t.disabled){const e=t.isValid,i="initialValue"in t?t.initialValue:t.valueOnFocus,s=t.hasChanged(i,r),{needsInputSync:a}=t;t.revertOnEscape&&(!e||s||a)&&(s&&(t.value=i),a&&t.syncInputFieldValue(!0),t.clearError(),n=(s||a)&&t.isValid||e!==t.validOnFocus)}t.isDestroyed||(n&&e.stopImmediatePropagation(),t.trigger(e.type,{event:e}))}clear(e){const t=this,{value:r}=t;(r!==t.nullValue||t.input.value.length>0)&&(t.value=t.nullValue,t.clearError(),t.syncInvalid(),t.trigger("clear",{event:e}))}onDisabled(){this.syncInvalid()}syncRequired(){var e;const t=this;t.isConfiguring||t.focusing||!t.required||!t.isEmpty||(null==(e=t.parent)?void 0:e.isSettingValues)?t.clearError("L{fieldRequired}",t.updatingInvalid):t.setError("L{fieldRequired}",t.updatingInvalid)}setError(e,t,r){const n=this;if((n.errors||(n.errors={}))[n.optionalL(e)]=1,t||n.syncInvalid(),r){const t=()=>{n.clearError(e),r()},r=n.ion({keydown:t,focusOut:t})}}clearError(e,t){const r=this;r.errors&&(e?delete this.errors[this.optionalL(e)]:r.errors={}),t||r.syncInvalid()}getErrors(){const e=this;if(!e.isValid){const t=e.validity,r=ObjectHelper.keys(t).find((e=>"valid"!==e&&"customError"!==e&&t[e])),n=e.errors&&Object.keys(e.errors);let i;if(i=(null==n?void 0:n.length)?n:t.customError?[e.input.validationMessage]:r?[e.L(r,{min:e.min,max:e.max})]:[e.L(e.invalidValueError)],(null==i?void 0:i.length)>0)return i}}createOverflowTwin(e){const t=this,r=super.createOverflowTwin(e);return r.ion({change({value:e}){t._overflowTwinSync=!0,t.value=e,t._overflowTwinSync=!1}}),r}get containerCollapsed(){var e;return null==(e=this.container)?void 0:e.collapsed}set containerCollapsed(e){const{container:t}=this;t&&(t.collapsed=e)}afterSyncChildConfigs(e){}changeContainer(e,t){e&&(Array.isArray(e)||!("type"in e)&&!("items"in e))&&(e={items:e});const r=this,n=e&&ObjectHelper.merge({owner:r,layout:"box"},r.containerDefaults),i=Widget.reconfigure(t,e,{owner:r,defaults:n});if(!i||(i.autoLayout="box"===(null==n?void 0:n.layout),i!==t))return i;i.syncContainer()}onConfigChange(e){var t,r;super.onConfigChange(e),(null==(r=null==(t=this.container)?void 0:t.syncConfigTriggers)?void 0:r[e.name])&&this.container.syncChildConfigs()}assignValue(e,t){const{container:r,containValues:n}=this,i=this.getValueName(t);r&&!1!==n?e&&"nested"===n?e&&i in e&&(e=ObjectHelper.clone(e[i]),super.assignValue({[i]:e&&!("value"in e)||e.value},t),e&&delete e.value,r.assignValue(e,t)):(super.assignValue(e,t),r.assignValue(e,t)):super.assignValue(e,t)}gatherValue(e){super.gatherValue(e),this.gatherValues(e)}gatherValues(e,t){const r=this,{container:n,containValues:i,valueName:s}=r,a=typeof i;t=null!=t?t:s in e,n&&!1!==i&&("nested"===i?t&&(e[s]={value:e[s],...n.values}):(!0===i||null==i&&t||"string"===a&&r[i]||"function"===a&&i(r))&&n.gatherValues(e))}updateContainer(e,t){t&&this.detachListeners(t.id),e&&(e.rendered||e.render(),e.syncContainer(),e.syncChildConfigs())}};Field.Trigger=class extends Widget{static get $name(){return"FieldTrigger"}static get factoryable(){return{defaultType:Field.Trigger,extends:null}}static get type(){return"trigger"}static get configurable(){return{align:null,weight:null,role:void 0}}get field(){return this.parent}construct(){super.construct(...arguments),this.key&&(this.keyMap={[this.key]:"onClick"})}compose(){return{"aria-hidden":!0,class:{["b-align-"+(this.align||"end")]:1,"gt-icon":1},listeners:{click:"onClick",mousedown:"onMousedown"}}}changeAlign(e){return e}onClick(e){const t=this,{field:r}=t;r.disabled||r.readOnly||(e.key&&e.preventDefault(),!1!==r.trigger("trigger",{trigger:t})&&t.handler&&r.callback(t.handler,r,[e,t]))}onMousedown(e){const t=this.field;!("key"in e)&&DomHelper.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout((()=>t.editable=!0),500)),e.preventDefault(),DomHelper.getActiveElement(t.input)!==t.input&&t.focus()}},Field.SpinTrigger=class extends Field.Trigger{static get $name(){return"SpinTrigger"}static get type(){return"spintrigger"}static get configurable(){return{repeat:{$config:["nullify"],value:!0}}}compose(){return{children:{upButton:{class:{"gt-icon":1,"b-spin-up":1}},downButton:{class:{"gt-icon":1,"b-spin-down":1}}}}}updateRepeat(e){var t;null==(t=this.clickRepeater)||t.destroy(),this.clickRepeater=e?ClickRepeater.new({element:this.element},e):null}onClick(e){const t=this,{field:r}=t;r.disabled||r.readOnly||(e.target===t.upButton?r.doSpinUp(e.shiftKey):e.target===t.downButton&&r.doSpinDown(e.shiftKey))}},Field.Trigger.initClass(),Field.SpinTrigger.initClass(),Widget.register(Field.Trigger,"trigger"),Widget.register(Field.SpinTrigger,"spintrigger"),Field._$name="Field";var TextField=class extends Field{static get type(){return"textfield"}static get alias(){return"text"}static get configurable(){return{nullValue:""}}static get $name(){return"TextField"}construct(e){"hidden"===(null==e?void 0:e.inputType)&&(e.hidden=!0),super.construct(...arguments)}};TextField.initClass(),TextField._$name="TextField";var PickerField=class extends TextField{static get $name(){return"PickerField"}static get type(){return"pickerfield"}static get configurable(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:{value:{floating:!0},$config:["lazy","nullify"]},inputType:"text",monitorResize:!0,nullValue:null}}doDestroy(){var e;null==(e=this.globalTapListener)||e.call(this),super.doDestroy()}updateEditable(e){var t;const r=this,{element:n,ariaElement:i,nonEditableClickTarget:s}=r;super.updateEditable(...arguments),n.classList.toggle("b-not-editable",!e),!1===e?(i.removeAttribute("aria-autocomplete"),null==(t=r.globalTapListener)||t.call(r),EventHelper.on({element:s,click:e=>{const t=s.getRootNode().elementFromPoint(e.clientX,e.clientY);e.target===s&&t===s&&r.onTriggerClick(e)},thisObj:r})):(i.setAttribute("aria-autocomplete","list"),r.globalTapListener=GlobalEvents_default.ion({globaltap:"showKeyboard",thisObj:r}))}get nonEditableClickTarget(){return this.input}updateElement(e,t){var r;const n=super.updateElement(e,t),i=this.peekConfig("picker"),s=!!i&&(i.isWidget?i.role:null==(r=this.constructor.resolveType(i.type))?void 0:r.$meta.config.role);return this.ariaHasPopup=s,n}changePicker(e,t){throw new Error("changePicker(oldPicker, newPicker) must be implemented in PickerField subclass implementations")}get childItems(){const e=super.childItems;return this._picker&&e.push(this.picker),e}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){const t=this;t.pickerVisible&&t.picker.requestAnimationFrame(t.picker.realign,null,t.picker),super.onElementResize(e)}internalOnKeyEvent(e){const t=this;let r=!0;if("keydown"===e.type&&!t.disabled&&!e.shiftKey&&!e.ctrlKey)if(t.pickerVisible){const{picker:n}=t;"Escape"===e.key?(e.preventDefault(),e.stopImmediatePropagation(),t.hidePicker(),r=!1):n.onInternalKeyDown?n.onInternalKeyDown(e):"ArrowDown"===e.key&&n.focusable&&n.focus()}else"ArrowDown"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),t.onTriggerClick(e));r&&super.internalOnKeyEvent(e)}onFocusIn(e){const t=this;super.onFocusIn(e),t.autoExpand&&(t.minChars=0,t.onTriggerClick(e),t.ignoreTriggerClick=!0,t.setTimeout((()=>t.ignoreTriggerClick=!1),100))}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;DomHelper.isTouchEvent&&DomHelper.getActiveElement(t)===t&&e.target===t&&(GlobalEvents_default.suspendFocusEvents(),t.blur(),t.focus(),GlobalEvents_default.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,{picker:r}=t;t.pickerHideShowListenersAdded||(r.ion({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),DomHelper.setAttributes(t.ariaElement,{"aria-controls":r.id,"aria-expanded":!0}),r.autoClose=t.autoClose,r.show(),r.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=GlobalEvents_default.ion({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=EventHelper.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){var e,t;const r=this;r.ariaElement.setAttribute("aria-expanded",!1),r.pickerVisible=!1,r.element.classList.remove("b-open"),r.trigger("togglePicker",{show:!1}),null==(e=r.pickerTapOutRemover)||e.call(r),null==(t=r.pickerKeyDownRemover)||t.call(r)}onPickerTapOut({event:e}){this.containsFocus||this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key&&!this.picker.trapFocus){const t=DomHelper.getActiveElement(this.input),r=new KeyboardEvent("keydown",e);this.input.dispatchEvent(r),r.defaultPrevented&&e.preventDefault(),DomHelper.getActiveElement(this.input)===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;DomHelper.isTouchEvent&&this.editable&&(e.readOnly=!0,this.setTimeout((()=>e.readOnly=!1),500)),super.focus()}};PickerField._$name="PickerField";var itemRange=document.createRange(),List=class extends Widget{static get $name(){return"List"}static get type(){return"list"}static get configurable(){return{itemCls:"b-list-item",selectedCls:"b-selected",selectIconCls:"gt-icon-check",tag:"ul",items:null,displayField:"text",store:null,navigator:!0,scrollable:{overflowX:!1,overflowY:!0},itemsFocusable:!0,multiSelect:!1,toggleAllIfCtrlPressed:!1,selectAllItem:!1,itemTpl(e){let t=StringHelper.encodeHtml(e[this.displayField]);return null!=t&&""!==t||(t="&nbsp;"),t},getItemStyle:null,getItemCls:null,groupHeaderTpl:(e,t)=>{let r=StringHelper.encodeHtml(t);return null!=r&&""!==r||(r="&nbsp;"),r},allowGroupSelect:!0,selected:{$config:"nullify",value:{}},activateOnMouseover:null,role:"listbox",keyMap:{"Ctrl+a":"selectAll"}}}construct(e,...t){var r;const n=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const{element:i}=n,{classList:s}=i;n.multiSelect&&s.add("b-multiselect"),(null==(r=n.store)?void 0:r.count)?n.refresh():s.add("b-empty"),EventHelper.on({element:i,delegate:n.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:n})}doDestroy(){var e;this.detachListeners("store"),null==(e=this.navigator)||e.destroy(),super.doDestroy()}onFocusIn(e){var t;this.restoreActiveItem(null==(t=e._target)?void 0:t.closest(this.itemSelector)),super.onFocusIn(e)}contentTpl(){const e=this,t=e.store.records.map(((t,r)=>e.itemWrapperTpl(t,r)));return e.multiSelect&&!1!==e.selectAllItem&&t.unshift(e.selectAllItemTpl()),TemplateHelper.tpl`${t}`}itemWrapperTpl(e,t){const{selected:r,getItemStyle:n}=this,i=n?'style="'+this.callback(n,this,[e])+'"':"";return TemplateHelper.tpl`<li ${i} class="${this.getItemClasses(e,t)}" role="option" aria-selected="${r.includes(e)}" data-index="${t}" data-id="${StringHelper.encodeHtml(e.id)}" ${this.itemsFocusable?'tabindex="-1"':""}>${this.itemContentTpl(e,t)}</li>`}itemContentTpl(e,t){return"groupRowFor"in e.meta?this.groupHeaderTpl(e,StringHelper.capitalize(e.groupChildren[0][e.meta.groupField])):""+this.itemIconTpl(e,t)+this.itemTpl(e,t)}itemIconTpl(e,t){return this.multiSelect?'<i class="b-selected-icon gt-icon '+this.selectIconCls+'"></i>':""}selectAllItemTpl(){const e=this.allSelected?"b-selected":"";return'<li class="'+this.itemCls+" b-select-all-item "+e+'" data-noselect data-select-all data-id="select-all">'+this.itemIconTpl({})+"<div>"+this.optionalL("Select All")+"</div></li>"}getItemClasses(e){var t;const r=this,{getItemCls:n}=r,i=null==(t=r._navigator)?void 0:t.activeItem,s=(null==i?void 0:i.dataset.id)==e.id,a="groupRowFor"in e.meta?"b-list-item-group-header":"",o=r.selected.includes(e),l=n?this.callback(n,this,[e]):"";return r.itemCls+" "+(e.cls||"")+" "+l+" "+(o?r.selectedCls:"")+" "+(s?r.navigator.focusCls:"")+" "+a}onBeforeStoreLoad(){this.mask(this.L("L{loading}"))}onAfterStoreRequest(){this.unmask()}onStoreChange({source:e,action:t,records:r,record:n,changes:i}){const s=this,{selected:a}=s;switch(t){case"dataset":a.match(e.storage,!s._externallyOwnedSelection);break;case"remove":a.remove(r);break;case"clear":s.deselectAll();break;case"update":{const{id:e}=i;return e&&DomHelper.setAttributes(s.contentElement.querySelector(StringHelper.encodeAttributeSelector("data-id",e.oldValue)),{"data-id":e.value}),void s.refreshItem(n)}}s.refresh()}onStoreRefresh(){this.refresh()}refresh(){var e;const t=this;if(t.isVisible){const r=null==(e=t.navigator)?void 0:e.activeItem;t.paintListener=null;const n=DomHelper.createElementFromTemplate(t.contentTpl(),{fragment:!0});t.clearItems().insertNode(n),r&&t.restoreActiveItem(r),t.refreshCount=(t.refreshCount||0)+1,t.element.classList[t.store.count>0?"remove":"add"]("b-empty"),t.updateSelectAllState()}else t.paintListener||(t.paintListener=t.ion({paint:"refresh",thisObj:t,once:!0}))}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),r=e.contentElement.lastChild;if(t){const r=e.contentElement.querySelectorAll(e.itemSelector+":not(.b-mask)");itemRange.setStartBefore(t),itemRange.setEndAfter(r[r.length-1]),itemRange.deleteContents()}else r?(itemRange.setStartAfter(r),itemRange.setEndAfter(r)):(itemRange.setStart(e.contentElement,0),itemRange.setEnd(e.contentElement,0));return itemRange}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const r=this.store.indexOf(t),n=DomHelper.createElementFromTemplate(this.itemWrapperTpl(t,r));DomHelper.sync(n,e)}}}getItem(e){if(null!=e)return"number"==typeof e?this.contentElement.querySelector('[data-index="'+(e<0?this.store.count+e:e)+'"]'):(e.nodeType===Element.ELEMENT_NODE&&(e=e.dataset.id),null!=(null==e?void 0:e.id)&&(e=e.id),this.contentElement.querySelector(StringHelper.encodeAttributeSelector("data-id",e)))}getRecordFromElement(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}updateItems(e){const t=this;t.store&&t.store.autoCreated&&t.store.destroy(),t.store=Store.getStore(e)}updateDisabled(e){super.updateDisabled(...arguments),this.navigator&&(this.navigator.disabled=e)}changeSelected(e,t){if(e){let t;e.isCollection?this._externallyOwnedSelection=!0:(Array.isArray(e)?(t=e,e={}):e.values&&(t=e.values,e={...e,values:[]}),e=new Collection(e)),e.ion({change:"onSelectionChange",thisObj:this}),this.initialSelection=t}else null==t||t.destroy();return e}get itemSelector(){return"."+this.itemCls}get selected(){return this._selected}get store(){return this.getConfig("items"),this._store}changeStore(e){const t=this;if(e instanceof Store||(Array.isArray(e)&&(e={data:e}),e=new Store(e)),t.detachListeners("store"),e){const r={name:"store",change:"onStoreChange",refresh:"onStoreRefresh",thisObj:t};e.readUrl&&(r.beforeLoad="onBeforeStoreLoad",r.afterRequest="onAfterStoreRequest"),e.isGrouped&&(t.element.classList.add("b-grouped"),r.groupchange="onStoreRefresh"),e.ion(r)}return e}updateStore(e){const{initialSelection:t}=this;(null==t?void 0:t.length)&&(e.count?this.select(t):e.ion({refresh:()=>this.select(t),once:!0})),this.refresh()}changeNavigator(e,t){const r=this,{element:n}=r;return n&&((null==(e=Navigator.reconfigure(t,e?Navigator.mergeConfigs({ownerCmp:r,disabled:r.disabled,target:n,keyEventTarget:n},e):null,r))?void 0:e.keyEventTarget)!==n||r.itemsTabbable||(n.tabIndex=0)),e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return e?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){return this.navigator&&(this.navigator.activeItem=null),super.hide(...e)}show(){const{refreshCount:e}=this,{previousActiveItem:t}=this.navigator;super.minHeight=this._minHeight;const r=super.show(...arguments);return this.refreshCount===e&&this.restoreActiveItem(t,!0),r}restoreActiveItem(e=this.navigator.previousActiveItem,t="nearest"){const r=this,{navigator:n,lastAlignSpec:i}=r;if(null!=e){if("string"!=typeof t){const e=i?i.zone:1;t=1&e?"nearest":e?"start":"end"}(e=r.getItem(e))&&!r.disabled&&(r.scrollable.scrollIntoView(e,{block:t}),n.activeItem=e)}}onMouseOver(e){const t=this,r=e.currentTarget;!DomHelper.isTouchEvent&&r&&t.navigator&&t.activateOnMouseover&&t.setTimeout({fn:"handleMouseOver",delay:30,args:[r],cancelOutstanding:!0})}handleMouseOver(e){this.navigator.activeItem=e}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;if(!this.disabled)switch(e.key){case" ":if("INPUT"===e.target.nodeName.toUpperCase()&&!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const r=this,n=parseInt(e.dataset.index);let i=r.store.getAt(n);if(!r.disabled&&!1!==r.trigger("beforeItem",{item:e,record:i,index:n,event:t,userAction:!0})){if(r._isUserAction=!0,r.allowGroupSelect||i&&!i.isSpecialRow)if(e.contains(t.target.closest("[data-noselect]")))e.contains(t.target.closest("[data-select-all]"))&&r.onSelectAllClick(e,t);else{const e=r.selected;let n=e.includes(i);r.multiSelect?(r.toggleAllIfCtrlPressed&&t.ctrlKey?i=r.store.records:r.allowGroupSelect&&i.isSpecialRow&&(n=!i.groupChildren.some((t=>!e.includes(t))),i=i.groupChildren),e[n?"remove":"add"](i)):e.splice(0,e.count,i)}r.lastClicked=i,r.trigger("item",{item:e,record:i,index:n,event:t,userAction:!0}),r._isUserAction=!1}}onSelectionChange({action:e,removed:t,added:r,replaced:n}){const i=this,{selectedCls:s,unselectedCls:a}=i;let o,l;if("clear"===e)for(l of i.element.querySelectorAll("."+s))l.classList.remove(s),l.setAttribute("aria-selected",!1),a&&l.classList.remove(a);else if("replaceValues"!==e){for(o of t)l=i.getItem(o),l&&(l.classList.remove(s),l.setAttribute("aria-selected",!1));for(o of r)l=i.getItem(o),l&&(l.classList.add(s),l.setAttribute("aria-selected",!0))}i.selectAllItem&&i.updateSelectAllState()}onSelectAllClick(e){e.classList.contains(this.selectedCls)?this.deselectAll():this.selectAll()}updateSelectAllState(){var e;null==(e=this.element.querySelector(".b-select-all-item"))||e.classList.toggle(this.selectedCls,this.allSelected)}get allSelected(){const{selected:e,store:t}=this;return e.count&&(t.isFiltered?t.records.every((t=>e.includes(t))):t.count===e.count)}selectAll(e){const t=this;!t.multiSelect&&e||(t.selected.add(t.store.records),e&&!t.navigator.activeItem&&(t.navigator.activeItem=t.getItem(-1)))}deselectAll(){this.selected.clear()}select(e){const{store:t}=this,{modelClass:r}=t;e=ArrayHelper.asArray(e).reduce(((e,n)=>((n=t.getById(r.asId(n)))&&e.push(n),e)),[]),this.selected.add(e)}deselect(e){const{modelClass:t}=this.store;e=ArrayHelper.asArray(e).reduce(((e,r)=>((r=this.selected.get(t.asId(r)))&&e.push(r),e)),[]),this.selected.remove(e)}};List.initClass(),List.prototype.navigatorClass=Navigator,List._$name="List";var ChipView=class extends List{static get $name(){return"ChipView"}static get type(){return"chipview"}static get configurable(){return{itemCls:"b-chip",multiSelect:!1,closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){const r=this;return TemplateHelper.tpl`${r.iconTpl?this.iconTpl(e):""}
            
    ${r.itemTpl(e,t)}
            
    ${r.closable?'<div class="gt-icon b-close-icon gt-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){const t=this;t.closable&&t.selected.count&&("Delete"===e.key||"Backspace"===e.key)?t.callback(t.closeHandler,t.owner,[t.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}updateClosable(e){this.element.classList[e?"add":"remove"]("b-chips-closable"),this.navigator&&(this.navigator.disabled=!e),this.isConfiguring||this.refresh()}onClick(e){const t=this,r=e.target.closest("."+t.itemCls);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(r.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}};ChipView.initClass(),ChipView._$name="ChipView";var errorFieldRequired="L{Field.fieldRequired}",errorValidateFilter="L{Field.validateFilter}",errorRecordNotCommitted="L{Combo.recordNotCommitted}",Combo=class extends PickerField{static get $name(){return"Combo"}static get type(){return"combo"}static get alias(){return"combobox,dropdown"}static get configurable(){return{primaryFilter:{},picker:{type:"list",floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},multiSelect:null,items:null,store:null,valueField:void 0,displayField:"text",pickerWidth:null,minChars:null,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"gt-icon-picker",handler:"onTriggerClick"}},filterParamName:null,encodeFilterParams:e=>e.map((e=>e.value)),filterOnEnter:!1,hideTrigger:null,overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:"all",filterOperator:"startsWith",caseSensitive:!1,hidePickerOnSelect:null,chipView:{$config:["lazy","nullify"],value:{type:"combochipview"}},chipStore:{$config:["lazy","nullify"],value:{}},filterSelected:null,emptyText:null,value:null,valueCollection:{$config:["nullify","lazy"],value:{}},validateFilter:!0,clearTextOnPickerHide:!0,destroyStore:!1,multiValueSeparator:",",createOnUnmatched:null,role:"combobox",inlinePicker:null,testConfig:{keyStrokeFilterDelay:0},localizeDisplayFields:!1,buildItems:null}}static get queryLast(){return"last"}construct(e){super.construct(...arguments),this.store||(this.items=[]),this.filterOnEnter&&(this.hideTrigger=!0)}startConfigure(e){this.usingRecordAsValue=null===e.valueField,super.startConfigure(...arguments)}afterConfigure(){super.afterConfigure();const e=this;ObjectHelper.hasOwn(e,"_value")||(e._value=e.valueField===e.displayField?"":null,e._lastValue=e._lastValue||e._value)}get childItems(){const{_chipView:e,_picker:t}=this,r=super.childItems;return e&&r.push(e),t&&r.push(t),r}get innerElements(){var e;const t=null==(e=this._chipView)?void 0:e.element,{input:r,inputElement:n}=this;return t&&DomSync.sync({targetElement:r,domConfig:n}),[t||n]}updateInlinePicker(e){e&&(this.element.classList.add("b-inline-picker"),this.getConfig("picker"),this.triggers.expand=null,this.pickerVisible=!0)}hidePicker(){if(!this.inlinePicker)return super.hidePicker(...arguments)}changeChipStore(e){return!e||e instanceof Store||(e=new Store(Store.mergeConfigs({storage:this.valueCollection},e))),e}updateChipStore(e,t){null==t||t.destroy()}changeChipView(e,t){const r=this;if(r.element.classList[e?"add":"remove"]("b-uses-chipview"),e){const{input:n}=r;return r.chipStore||(r.chipStore={}),ComboChipView.reconfigure(t,e,{defaults:{parent:r,insertBefore:n,store:r.chipStore,closable:!r.readOnly,navigator:{type:"combochipnavigator",keyEventTarget:n}}})}null==t||t.destroy()}updateChipView(e){var t;const r=this;r._chipViewEventDetacher=null==(t=r._chipViewEventDetacher)?void 0:t.call(r),r.chipStore=null==e?void 0:e.store,e&&(e.element.appendChild(r.input),r._chipViewEventDetacher=EventHelper.on({element:e.element,mousedown:"onChipViewMousedown",thisObj:r}))}updateMultiSelect(e,t){const r=this,{input:n,element:i}=r,s=!r.isConfiguring;let{value:a}=r;if(i.classList[e?"add":"remove"]("b-multiselect"),e){const{chipView:e}=r,{parentNode:t}=n,i=null==e?void 0:e.element;i&&i!==t&&(t.insertBefore(i,n),i.appendChild(n),r.chipView.refresh()),n.value="",s&&(a=ArrayHelper.asArray(a))}else{const e=r._chipView,{parentNode:t}=n,o=null==e?void 0:e.element;o===t&&(o.parentNode.insertBefore(n,o),o.remove(),i.classList.remove("b-uses-chipview")),s&&"string"!=typeof a&&(a=(null==a?void 0:a.length)?a[0]:null)}s&&(r.value=a)}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&(this._isUserAction=!0,this.valueCollection.remove(e),this._isUserAction=!1)}updateFilterParamName(e){!1!==this.hideTrigger&&(this.hideTrigger=Boolean(e))}updateHideTrigger(e){this.element.classList[e?"add":"remove"]("b-hide-trigger")}updateKeyStrokeFilterDelay(e){this.filterOnInput.delay=e}updateReadOnly(e){super.updateReadOnly(...arguments),this._chipView&&(this._chipView.closable=!e)}updateDisabled(e){super.updateDisabled(...arguments),this._chipView&&(this._chipView.closable=!e)}updateFilterOperator(e){this.primaryFilter&&(this.primaryFilter.operator=e)}get minChars(){const e=this._minChars;return null!=e?e:this.remoteFilter?4:1}get validateFilter(){return this._validateFilter&&!this.createOnUnmatched}get items(){return this.store.allRecords}updateBuildItems(e){e&&(this.items=e.call(this))}changeItems(e){const t=this;if(null==e){if(t.store&&!t.store.isItemStore)return;e=[]}if(t.buildItems&&!(null==e?void 0:e.length)&&(e=t.buildItems()),e instanceof Store)return void(t.store=e);const r=t.displayField;let n,i,s=t.valueField;if(Array.isArray(e)?i=e.map((e=>{let i=e;return e instanceof Model?(n=e.constructor,s||(t.valueField=s=n.idField)):"string"==typeof e||"number"==typeof e?(s||(t.valueField=s=t.displayField),i={[s]:e,[r]:e}):(s||(t.valueField=s="value"),Array.isArray(e)&&(i={[s]:e[0],[r]:e[1]})),e.selected&&(t.value=i),i})):(s||(t.valueField=s="value"),i=[],Object.entries(e).forEach((([e,t])=>{i.push({[s]:e,[r]:t})}))),t.store)t.store.data=i;else{const e=s===r?{name:"value",dataSource:r}:s;if(!n){class i extends Model{static get idField(){return t.valueField}static set idField(e){super.idField=e}static get fields(){return[e,r]}}n=i}t.store=new Store({isItemStore:!0,data:i,idField:s,verifyNoGeneratedIds:!1,modelClass:n})}}get value(){const e=this,{valueCollection:t,valueField:r}=e;if(null==r)return e.multiSelect?t.values.slice():t.first;let n;return n=e.multiSelect?t.count?t.map((e=>e[r])):e._lastValue||[]:t.count?t.first[r]:e._lastValue,n}set value(e){super.value=e}get needsInputSync(){return!this.usesChipView&&!this.editable}changeValue(e,t){var r,n;const i=this;if(e===t)return void i.syncInputFieldValue(!0);if(!i.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("不能将多个值设置为非多选组合");i.triggerConfig("items"),i.inputting||null==(r=i._chipView)||r.selected.clear(),i.store||(i.items=[]);const{valueField:s,displayField:a,store:o,valueCollection:l,_picker:c}=i,{storage:d}=o,u=null!=(n=i.hidePickerOnSelect)?n:!i.multiSelect,h=i._isUserAction||(null==c?void 0:c._isUserAction)||u&&i.pickerVisible||!1;if(!i.remoteFilter&&o.isAjaxStore&&!o.count)return o.ion({load:()=>i.value=e,once:!0,thisObj:i}),void(i._lastValue=e);if(i.remoteFilter){if(null!=e){if(ObjectHelper.isObject(e)||e.isModel)i.store.data=[e],i.valueCollection.splice(0,i.valueCollection.count,i.store.first);else{const t=i.isConfiguring;i.primaryFilter.setConfig({value:e,disabled:!1}),o.performFilter(!0).then((()=>{if(i.isDestroyed)return;const{isConfiguring:e}=i;i.isConfiguring=t,l.splice(0,l.count,o.allRecords),i.isConfiguring=e}))}return}}else o.filtered&&(i.primaryFilter.disabled=!0,o.filter());let g;if(null!=e){const r=Array.isArray(e),n=r?e.slice():[e];for(let e=0,t=n.length;e<t;e++){let r=n[e];if(r instanceof Model)d.includes(r,!0)||o.add(r);else{const i=ObjectHelper.isObject(r);i&&(r=r[o.modelClass.fieldMap[s].dataSource]),g=d.getBy(a,r)||d.getBy(s,r)||l.getBy(a,r)||l.getBy(s,r),g instanceof Set&&(g=[...g][0]),g?(i&&g.set(n[e]),n[e]=g):(n.splice(e,1),t--,e--)}}const c=!n.length,u=l.generation;l.splice(0,l.count,n),c&&(i._value=r&&0===e.length?null:e,i._lastValue=i._value),(c||l.generation===u)&&i.syncInputFieldValue(),i.syncEmpty(),c&&!i.isConfiguring&&i.triggerFieldChange({value:e,oldValue:t,userAction:h,valid:i.isValid})}else if(l.count)l.clear();else{const t=i._value;i._value=null,i.syncInputFieldValue(),i.syncEmpty(),i.isConfiguring||i.triggerFieldChange({value:e,oldValue:t,userAction:h,valid:i.isValid})}i._lastValue=i._value}hasChanged(e,t){return this.multiSelect?!ObjectHelper.isEqual(e,t):super.hasChanged(...arguments)}onComboStoreChange({action:e}){"filter"!==e&&this.syncInputFieldValue(!0)}syncInputFieldValue(e){var t;this.usesChipView?null==(t=this.chipView)||t.refresh():super.syncInputFieldValue(e)}get usesChipView(){return Boolean(this.multiSelect&&this._chipView)}get isEmpty(){return 0===this.valueCollection.count}get inputValue(){const e=this;let t=e.selected?e.selected[e.displayField]:e.value;return e.displayValueRenderer&&(t=e.callback(e.displayValueRenderer,e,[e.selected,e])),null==t?"":t}get nonEditableClickTarget(){var e;return this.multiSelect&&(null==(e=this.chipView)?void 0:e.element)||super.nonEditableClickTarget}changeValueCollection(e,t){if(null==t||t.destroy(),e)return e.isCollection||(e=new Collection({internalListeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),e}changePrimaryFilter(e){return e.isCollectionFilter?e.setConfig({disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive}):("function"==typeof e&&(e={filterBy:e}),e=new CollectionFilter({id:"primary",disabled:!0,property:this.displayField,operator:this.filterOperator,caseSensitive:this.caseSensitive,...e})),e}changeStore(e){const t=this,r=[],{valueCollection:n,keyStrokeFilterDelay:i,filterParamName:s}=t;if(Array.isArray(e))return void(t.items=e);let a;if(e){if(e.isStore){const n=e.filters.get("primary");t.remoteFilter&&(e.filterParamName=s),a=e.remoteFilter||e.restfulFilter,n?t.primaryFilter=n:r.push(t.primaryFilter)}else"string"==typeof e?e=Store.getStore(e):(e=new(e.readUrl?AjaxStore:Store)(e),t.destroyStore=!0),a=t.remoteFilter||e.restfulFilter,a&&s&&(e.filterParamName=s,t.encodeFilterParams&&(e.encodeFilterParams=t.encodeFilterParams)),r.push(t.primaryFilter);if(t.valueField||t.usingRecordAsValue||(t.valueField=e.modelClass.idField),t.filterSelected){const i=e=>!t.containsFocus||!n.includes(e);a?(e.storage.autoFilter=!0,e.storage.addFilter({id:t.id+"-selected-filter",filterBy:i})):(r.push(i),e.reapplyFilterOnAdd=!0)}n.addIndex({property:t.displayField,unique:!1}),n.addIndex({property:t.valueField,unique:!0}),r.forEach((t=>e.addFilter(t,!0))),t.keyStrokeFilterDelay=a?Math.max(300,i||0):null!=i?i:10}return e}updateStore(e,t){const r=this,{_picker:n}=r;let i;r.destroyStore&&t&&t.destroy(),n&&(n.store=e),e.storage.addIndex({property:r.displayField,unique:!1}),e.storage.addIndex({property:r.valueField,unique:!0}),i={filter:"onStoreFilter"},r.displayValueRenderer&&((i||(i={})).change="onComboStoreChange"),r.detachListeners("store"),(null==e?void 0:e.storage)&&r.valueCollection.match(e.storage),r.syncInputFieldValue(),i&&(i.name="store",i.thisObj=r,e.ion(i))}get remoteFilter(){var e;return Boolean(this.filterParamName||(null==(e=this._store)?void 0:e.restfulFilter))}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){const{store:e}=this;return this.multiSelect?this.valueCollection.values.slice().sort(((t,r)=>e.indexOf(t)-e.indexOf(r)))[0]:this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(errorValidateFilter),e.syncInputFieldValue()),e.required&&!t&&e.setError(errorFieldRequired)}onTriggerClick(e){var t;const r=this,n="key"in e;if(!(r.ignoreTriggerClick||r.remoteFilter&&r.filterOnEnter))if(r.pickerVisible)r.hidePicker();else if(!r.readOnly&&!r.disabled)switch(null==(t=r.triggerAction)?void 0:t.toLowerCase()){case"all":r.doFilter(null,n);break;case"last":r.doFilter(r.lastQuery,n);break;default:r.doFilter(r.input.value,n)}}internalOnInput(e){const t=this;t.syncEmpty(),t.syncInputWidth(),t.filterOnInput(e),t.trigger("input",{value:t.input.value,event:e})}filterOnInput(e){const t=this,{value:r}="input"===e.type?e.target:t.input,n=r.length;t.inputting=!0,t.inlinePicker||n>=t.minChars&&(!t.filterOnEnter||"Enter"===e.key)?t.doFilter(r):(t.validateFilter&&!t.remoteFilter&&t[n?"setError":"clearError"](errorValidateFilter),t.hidePicker()),t.inputting=!1}syncInputWidth(){const e=this;if(e.usesChipView){const t=e.input,r=e._inputPadding||(e._inputPadding=DomHelper.getEdgeSize(t,"padding","lr")),n=t.value||"",i=DomHelper.measureText(n+"W",t,!1,e.element)+r.width;t.style.flex="1 1 "+Math.ceil(i)+"px"}}doFilter(e,t){var r;const n=this,{store:i,picker:s}=n,a=null==e||""===e;n.lastQuery=e,n.primaryFilter.setConfig({value:e,disabled:a}),n.remoteFilter&&i.clear(!0);const o=()=>{const{navigator:e,isVisible:t}=s;i.count?!a&&e&&(e.activeItem=0):n.remoteFilter||a||(e&&(e.activeItem=null),n.validateFilter&&n.setError(errorValidateFilter)),t&&s.realign()};null==(r=n.filterPromise=i.filter())||r.then((()=>{n.filterPromise=null,o()})),n.inlinePicker||((null==s?void 0:s.isVisible)?0===s.lastAlignSpec.zone&&s.realign():n.showPicker(t)),n.filterPromise||o()}onStoreFilter({source:e}){const t=this,r=t._picker,n=null==r?void 0:r.element.dataset,{count:i}=e;t.remoteFilter&&(i?r&&(r.navigator.activeItem=0):t.validateFilter&&t.setError(errorValidateFilter),t.filterSelected&&t.valueCollection.count&&(e.storage.onFiltersChanged({action:"splice",oldCount:1}),r&&r.refresh())),n&&(t.createOnUnmatched&&!i?n.addNewValue=t.L("L{addNewValue}")(t.primaryFilter.value):null==n||delete n.addNewValue)}onValueCollectionChange({source:e}){var t;const r=this,{multiSelect:n,_picker:i}=r,s=null!=(t=r.hidePickerOnSelect)?t:!n,a=n?e.values.slice():e.first,o=e.values.slice(),l=r._isUserAction||(null==i?void 0:i._isUserAction)||s&&r.pickerVisible||!1,c=r._value;a&&a.data&&a.data.text&&(r._text=a.data.text),s&&r.hidePicker(),!e.count&&r.required?r.setError(errorFieldRequired):(r.clearError(errorFieldRequired),r.clearError(errorValidateFilter)),r.validateFilter&&a&&r.clearError(errorValidateFilter),r.filterSelected&&(r.remoteFilter?(r.store.storage.onFiltersChanged({action:"splice",oldCount:1}),r._picker&&r._picker.refresh()):r.store.filter()),r._value=null,r._lastValue=null;const d=r.cacheCurrentValue(r.value);r.syncInputFieldValue(),r.syncEmpty(),r.isConfiguring||(r.triggerFieldChange({value:d,oldValue:c,userAction:l,valid:r.isValid}),r.trigger("select",{record:a,records:o,userAction:l}),"select"===r.defaultAction&&r.trigger("action",{value:d,record:a,records:o,userAction:l}))}cacheCurrentValue(e){return this._value=e}onValueCollectionNoChange({toAdd:e}){!this.inlinePicker&&!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}showPicker(){var e;const t=this,{picker:r}=t;t.readOnly||t.inlinePicker||(r.multiSelect=t.multiSelect,super.showPicker(...arguments),t.overlayAnchor&&!r.align.offset&&(r.align.offset=-r.anchorSize[1],r.realign()),r.restoreActiveItem&&(t.multiSelect?r.restoreActiveItem((null==(e=r.navigator)?void 0:e.previousActiveItem)||t.selected||0,!0):r.restoreActiveItem(t.selected||0,!0)),t.input.focus())}changePicker(e,t){const r=this,n=r.pickerWidth||(null==e?void 0:e.width),i=List.mergeConfigs({owner:r,store:r.store,selected:r.valueCollection,multiSelect:r.multiSelect,cls:r.listCls,displayField:r.displayField,forElement:r[r.pickerAlignElement],align:{matchSize:null==n,anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)},[r.listItemTpl?"itemTpl":void 0]:r.listItemTpl,width:n,navigator:{keyEventTarget:r.input}},e);return r.inlinePicker&&Object.assign(i,{floating:!1,align:null,activateOnMouseover:!1,maxHeight:null,appendTo:r.element}),(e=List.reconfigure(t,e?i:null,r))&&(e.element.classList.add("b-combo-picker"),e.element.dataset.emptyText=r.emptyText?r.L(r.emptyText):r.L("L{noResults}"),e.ion({navigate:"onPickerNavigate",thisObj:r}),EventHelper.on({element:e.element,pointerdown:e=>r.onPickerNavigate({event:e}),thisObj:r})),e}onPickerNavigate({event:e}){e.target.matches("[data-add-new-value]")&&this.addNewRecord(this.primaryFilter.value)}onPickerHide(){const e=this;super.onPickerHide(),e.multiSelect&&e.clearTextOnPickerHide&&(e.input.value="")}async internalOnKeyEvent(e){const t=this,r=t.input[t.inputValueAttr],n=r.length,{key:i}=e,{store:s,_picker:a,multiSelect:o}=t;if("keydown"===e.type&&(null==a?void 0:a.isVisible)&&a.navigator){const{activeItem:n}=a.navigator;if(n&&o&&i===t.multiValueSeparator)return t.input.value="",t.primaryFilter.setConfig({value:"",disabled:!0}),s.filter(),a.onItemClick(n,e),a.hide(),void e.preventDefault();if(!n&&t.createOnUnmatched&&(o&&i===t.multiValueSeparator||"Enter"===i))return e.preventDefault(),void await t.addNewRecord(r)}super.internalOnKeyEvent(...arguments),"keydown"===e.type&&"Enter"===i&&t.filterOnEnter&&n>=t.minChars&&(e.stopPropagation(),t.filterOnInput.now(e))}async addNewRecord(e){var t,r;const n=this,{store:i,_picker:s,valueCollection:a,multiSelect:o,primaryFilter:l}=n,c=i.remoteFilter&&i.autoCommit;n.filterPromise&&await n.filterPromise,c||(l.setConfig({value:"",disabled:!0}),i.filter());const[d]=i.add(n.callback(n.createOnUnmatched,n,[e,n]));if(i.isCommitting){let e;try{await i.commitPromise}catch(n){e=null==(r=null==(t=n.response)?void 0:t.parsedJson)?void 0:r.error}d.isPhantom&&(n.clearError(),n.setError(e||errorRecordNotCommitted,!1,!0),i.remove(d),i.removed.remove(d))}c&&(l.setConfig({value:"",disabled:!0}),i.filter()),n.input.value="",i.includes(d)&&a.splice(o?a.count:0,o?0:a.count,d),null==s||s.hide()}changeCreateOnUnmatched(e){return!0===e&&(e=this.defaultRecordCreater),e}defaultRecordCreater(e){return this.store.createRecord({[this.displayField]:e})}updateLocalization(){var e;super.updateLocalization();const t=this,{displayField:r}=t;let{localizedDisplayFieldsMap:n}=t;if(!0===t.localizeDisplayFields){n||(t.localizedDisplayFieldsMap=n=new Map),!t.store&&t.buildItems&&(t.items=t.buildItems());for(const i of t.items)if(i.id){let s=n.get(i.id);!s&&(null==(e=i[r])?void 0:e.startsWith("L{"))&&(s=i[r],n.set(i.id,s)),s&&(i[r]=t.L(s))}t.syncInputFieldValue()}}};__publicField(Combo,"delayable",{filterOnInput:0});var ComboChipView=class extends ChipView{static get $name(){return"ComboChipView"}static get type(){return"combochipview"}static get defaultConfig(){return{closeHandler:"up.onChipClose",itemsFocusable:!1,multiSelect:!0,itemTpl(e){return StringHelper.encodeHtml(e[this.owner.displayField])},scrollable:{overflowY:"auto"}}}},ComboChipNavigator=class extends Navigator{static get $name(){return"ComboChipNavigator"}static get type(){return"combochipnavigator"}static get configurable(){return{allowShiftKey:!0}}onTargetClick(e){const t=this,r=e.target.closest(t.itemSelector);r&&!e.target.classList.contains("b-close-icon")&&(e.shiftKey||r.contains(e.target.closest("[data-noselect]"))||t.ownerCmp.selected.clear(),t.inClickHandler=!0,t.activeItem=r,t.inClickHandler=!1)}onKeyDown(e){"Enter"===e.key||e.target.selectionStart||e.target.selectionEnd||super.onKeyDown(e)}updateActiveItem(e,t){const r=this.ownerCmp;super.updateActiveItem(e,t),e&&!this.inClickHandler&&r.selected.add(r.getRecordFromElement(e))}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}};Combo.initClass(),ComboChipView.initClass(),ComboChipNavigator.initClass(),Combo._$name="Combo";var UndoRedoBase=class extends Container{static get $name(){return"UndoRedoBase"}static get type(){return"undoredobase"}static get configurable(){return{project:null,stm:null,text:null,color:null,showZeroActionBadge:null,cls:"b-undo-controls b-toolbar",layoutStyle:{alignItems:"stretch",flexFlow:"row nowrap",overflow:"visible"},items:{undoBtn:{type:"button",icon:"gt-icon-undo",tooltip:"L{UndoRedo.UndoLastAction}",onAction:"up.onUndo"},transactionsCombo:{type:"combo",valueField:"idx",editable:!1,store:{},emptyText:"L{UndoRedo.NoActions}",onAction:"up.onTransactionSelected",displayValueRenderer:"up.transactionsDisplayValueRenderer"},redoBtn:{type:"button",icon:"gt-icon-redo",tooltip:"L{UndoRedo.RedoLastAction}",onAction:"up.onRedo"}}}}afterConstruct(){this.updateUndoRedoControls()}updateStm(e){this.detachListeners("undoredo"),null==e||e.ion({name:"undoredo",recordingstop:"updateUndoRedoControls",restoringstop:"updateUndoRedoControls",queueReset:"updateUndoRedoControls",disabled:"updateUndoRedoControls",thisObj:this})}changeItems(e){const{undoBtn:t,redoBtn:r}=e;return this.color&&(t&&(t.color=this.color),r&&(r.color=this.color)),this.text&&(t&&(t.text="L{UndoRedo.Undo}"),r&&(r.text="L{UndoRedo.Redo}")),super.changeItems(e)}updateProject(e){this.stm=e.stm}fillUndoRedoCombo(){const{transactionsCombo:e}=this.widgetMap;e&&(e.items=this.stm.queue.map(((e,t)=>[t,e||"Transaction "+t])))}updateUndoRedoControls(){const{stm:e,showZeroActionBadge:t}=this,{undoBtn:r,redoBtn:n}=this.widgetMap;r.badge=e.position||(t?"0":""),n.badge=e.length-e.position||(t?"0":""),r.disabled=!e.canUndo,n.disabled=!e.canRedo,this.fillUndoRedoCombo()}transactionsDisplayValueRenderer(e,t){var r;const n=(null==(r=this.stm)?void 0:r.position)||0;return n+" undo actions / "+(t.store.count-n)+" redo actions"}onUndo(){this.stm.canUndo&&this.stm.undo()}onRedo(){this.stm.canRedo&&this.stm.redo()}onTransactionSelected(e){const t=this.stm,r=e.value;r>=0&&(t.canUndo&&r<t.position?t.undo(t.position-r):t.canRedo&&r>=t.position&&t.redo(r-t.position+1))}};UndoRedoBase._$name="UndoRedoBase";var BooleanCombo=class extends Combo{static get $name(){return"BooleanCombo"}static get type(){return"booleancombo"}static get configurable(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,store:{value:[],$config:"lazy"},value:!1}}changeStore(e,t){const r=this;return super.changeStore(new Store({data:[{id:r.positiveValue,text:r.positiveText||r.L("L{Object.Yes}")},{id:r.negativeValue,text:r.negativeText||r.L("L{Object.No}")}]}),t)}};BooleanCombo.initClass(),BooleanCombo._$name="BooleanCombo";var _ButtonGroup=class extends(Container.mixin(Rotatable_default)){onChildAdd(e){super.onChildAdd(e),e.ion({click:"resetValueCache",toggle:"onItemToggle",thisObj:this,prio:1e4})}onChildRemove(e){e.un({toggle:"resetValueCache",click:"resetValueCache",thisObj:this}),super.onChildRemove(e)}onItemToggle(e){const t=this;t.resetValueCache(),t.isSettingValue||t.toggleGroup&&!e.pressed||t.triggerFieldChange({value:t.value,userAction:!0,event:e})}resetValueCache(){this._value=null}createWidget(e){const t=this;return t.constructor.resolveType(e.type||"button").isButton&&(t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=_ButtonGroup.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup)),t.columns&&(e.width=100/t.columns+"%"),e=super.createWidget(e),t.relayEvents(e,["click","action","toggle"]),e}updateRotate(e){this.eachWidget((t=>{!1!==t.rotate&&(t.rotate=e)}))}get value(){if(!this._value){const e=[];this.items.forEach((t=>{t.pressed&&void 0!==t.value&&e.push(t.value)})),this._value=e.join(this.valueSeparator)}return this._value}set value(e){const t=this,r=t.value;Array.isArray(e)||(e=null==e?[]:"string"==typeof e?e.split(t.valueSeparator):[e]),t._value=e.join(t.valueSeparator),t.isSettingValue=!0,t.items.forEach((t=>{void 0!==t.value&&(t.pressed=e.includes(t.value))})),t.isSettingValue=!1,t.isConfiguring||r===t.value||t.triggerFieldChange({value:t.value,userAction:!1})}updateDisabled(e){this.items.forEach((t=>t.disabled=e||!t.ignoreParentReadOnly&&this.readOnly))}updateReadOnly(e){super.updateReadOnly(e),this.updateDisabled(this.disabled)}get widgetClassList(){const e=super.widgetClassList;return this.columns&&e.push("b-columned"),e}},ButtonGroup=_ButtonGroup;__publicField(ButtonGroup,"$name","ButtonGroup"),__publicField(ButtonGroup,"type","buttongroup"),__publicField(ButtonGroup,"configurable",{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null,valueSeparator:",",columns:null,hideWhenEmpty:!0,defaultBindProperty:"value"}),ButtonGroup.initClass(),ButtonGroup._$name="ButtonGroup";var CalendarPanel=class extends Panel{static get $name(){return"CalendarPanel"}static get type(){return"calendarpanel"}static get configurable(){return{textContent:!1,date:{$config:{equal:"date"},value:null},month:{},year:null,weekStartDay:null,sixWeeks:!0,showWeekNumber:null,showWeekColumn:null,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,hideNonWorkingDays:null,hideNonWorkingDaysCls:"b-hide-nonworking-days",nonWorkingDays:null,tip:null,dayCellCls:"b-calendar-cell",dayHeaderCls:"b-calendar-day-header",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today",nonWorkingDayCls:"b-nonworking-day",dayNameFormat:"ddd",minRowHeight:{$config:["lazy"],value:null},minColumnWidth:{$config:["lazy"],value:null},disableOtherMonthCells:null,disableOtherMonthCellsCls:"b-disable-othermonth-cells",hideOtherMonthCells:null,hideOtherMonthCellsCls:"b-hide-othermonth-cells",animateTimeShift:!0}}construct(e){super.construct(e),this.refreshCount||this.refresh()}onPaint({firstPaint:e}){var t;null==(t=super.onPaint)||t.call(this,...arguments),e&&(this.refreshCount||this.refresh(),this.getConfig("minColumnWidth"),this.getConfig("minRowHeight"))}get overflowElement(){return this.weeksElement}doDestroy(){var e;null==(e=this.tip)||e.destroy(),super.doDestroy()}changeMinRowHeight(e){const t=parseInt(DomHelper.getStyleValue(this.element,"--min-row-height"),10)||75;return isNaN(e)?e:Math.max(parseInt(e)||0,t)}updateMinRowHeight(e){this.weekElements.forEach((t=>DomHelper.setLength(t,"minHeight",e))),this.scrollable={overflowY:!!e&&"auto"}}changeMinColumnWidth(e){const t=parseInt(DomHelper.getStyleValue(this.element,"--min-column-width"),10)||75;return null==e?e:Math.max(parseInt(e)||0,t)}updateMinColumnWidth(e){const t=this;t.weekdayCells.forEach((t=>DomHelper.setLength(t,"minWidth",e))),t.cellElements.forEach((r=>r.matches("."+t.dayCellCls)&&DomHelper.setLength(r,"minWidth",e))),t.scrollable={overflowX:!!e&&"auto"},t.overflowElement.classList[e?"add":"remove"]("b-min-columnwidth")}getDateFromDomEvent(e){const t=(e.nodeType===Element.ELEMENT_NODE?e:e.target).closest("#"+this.id+" [data-date]");if(t)return DateHelper.parseKey(t.dataset.date)}changeTip(e,t){const r=this;return Tooltip.reconfigure(t,e,{owner:r,defaults:{type:"tooltip",owner:r,id:r.id+"-cell-tip",forElement:r.bodyElement,forSelector:"."+r.dayCellCls}})}updateTip(e){this.detachListeners("tip"),null==e||e.ion({pointerOver:"onTipOverCell",name:"tip",thisObj:this})}updateElement(e,t){const r=this;super.updateElement(e,t),r.updateHideNonWorkingDays(r.hideNonWorkingDays),r.weekdayCells=Array.from(e.querySelectorAll(".b-calendar-day-header")),r.weekElements=Array.from(e.querySelectorAll(".b-calendar-week")),r.weekDayElements=Array.from(e.querySelectorAll(".b-calendar-days")),r.cellElements=[];for(let e=0,{length:t}=r.weekDayElements;e<t;e++)r.cellElements.push(r.weekDayElements[e].previousSibling,...r.weekDayElements[e].children)}changeDate(e){if(e="string"==typeof e?DateHelper.parse(e):new Date(e),isNaN(e))throw new Error("CalendarPanel日期接收必须传递日期或YYYY-MM-DD日期字符串");return DateHelper.clearTime(e)}updateDate(e){this.month.date=e}updateDayNameFormat(){const e=new Date("2000-06-04T12:00:00");this.shortDayNames=[];for(let t=4;t<11;t++)e.setDate(t),this.shortDayNames.push(DateHelper.format(e,"d1"))}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:DateHelper.weekStartDay}updateWeekStartDay(e){const t=this;if(t._month){t.month.weekStartDay=e,t.dayNames=[];for(let e=0;e<7;e++)t.dayNames[e]=t.shortDayNames[t.canonicalDayNumbers[e]];t.refreshCount&&t.refresh()}}updateHideNonWorkingDays(e){var t;this.contentElement.classList.toggle(this.hideNonWorkingDaysCls,Boolean(e)),null==(t=this.scrollable)||t.syncOverflowState(),this._month&&(this.month.hideNonWorkingDays=e),this.isConfiguring||this.refresh()}updateHideOtherMonthCells(e){var t;this.element.classList.toggle(this.hideOtherMonthCellsCls,Boolean(e)),null==(t=this.scrollable)||t.syncOverflowState()}updateDisableOtherMonthCells(e){var t;this.element.classList.toggle(this.disableOtherMonthCellsCls,Boolean(e)),null==(t=this.scrollable)||t.syncOverflowState()}get nonWorkingDays(){return this._nonWorkingDays||this._localeNonWorkingDays||(this._localeNonWorkingDays=DateHelper.nonWorkingDays)}get weekends(){return this._localeWeekends||(this._localeWeekends=DateHelper.weekends)}changeNonWorkingDays(e){return ObjectHelper.assign({},e)}updateNonWorkingDays(e){var t;this._month&&(this.month.nonWorkingDays=e,this.refresh(),null==(t=this.scrollable)||t.syncOverflowState())}get visibleDayColumnIndex(){return this.month.visibleDayColumnIndex}get dayColumnIndex(){return this.month.dayColumnIndex}get canonicalDayNumbers(){return this.month.canonicalDayNumbers}get visibleColumnCount(){return this.month.visibleColumnCount}get weekLength(){return this.month.weekLength}get startDate(){return this.month.startDate}get duration(){return DateHelper.diff(this.month.startDate,this.month.endDate,"day")+1}get endDate(){const{endDate:e}=this.month;if(e)return DateHelper.add(e,1,"day")}changeMonth(e,t){const r=this;if(!(e instanceof Month)){if("number"==typeof e){if(t)return void(t.month=e);const n=r.date||DateHelper.clearTime(new Date);n.setMonth(e),e={date:n}}e=Month.new({weekStartDay:r.weekStartDay,nonWorkingDays:r.nonWorkingDays,hideNonWorkingDays:r.hideNonWorkingDays,sixWeeks:r.sixWeeks},e)}return e.ion({dateChange:"onMonthDateChange",thisObj:r}),e}onMonthDateChange({source:e,newDate:t,oldDate:r,changes:n}){const i=this;i.year=e.year,i.isConfiguring||((!i.getCell(t)||n.m||n.y)&&(i.refresh(),i.animateTimeShift&&i.isVisible&&DomHelper.slideIn(i.contentElement,t>r?1:-1)),i.trigger("dateChange",{changes:n,value:t,oldValue:r}))}updateYear(e){this.month.year=e}updateShowWeekNumber(e){this.updateShowWeekColumn(e)}updateShowWeekColumn(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-week-column"),t.floating&&(t.isAligning||t.realign())}updateSixWeeks(e){this.month&&(this.month.sixWeeks=e,this.refresh())}refresh(){this.doRefresh()}doRefresh(){var e;this.getConfig("element");const t=this,r=null!=t.timeZone?t.timeZone:null==(e=t.project)?void 0:e.timeZone,n=null!=r?TimeZoneHelper.toTimeZone(new Date,r):new Date,{weekElements:i,weekDayElements:s,date:a,month:o,dayCellCls:l,dayHeaderCls:c,disabledCls:d,otherMonthCls:u,weekendCls:h,todayCls:g,nonWorkingDayCls:p,nonWorkingDays:m,canonicalDayNumbers:f,sixWeeks:v}=t;if(n.setHours(0,0,0,0),!a)return void(t.date=n);t.trigger("beforeRefresh"),t.getConfig("dayNameFormat");for(let e=0;e<7;e++){const r=t.weekdayCells[e],n=t.canonicalDayNumbers[e],i={[c]:1,[h]:DateHelper.weekends[n],[p]:m[n]};t.headerRenderer?(r.innerHTML="",t.callback(t.headerRenderer,t,[r,e,n])):DomHelper.setInnerText(r,t.shortDayNames[n]),DomHelper.syncClassList(r,i),r.dataset.columnIndex=e,r.dataset.cellDay=n}let y=0,b=0,C=6;for(let e=6;e>=0;e--)if(!m[f[e]]){C=e;break}i[4].classList.toggle("b-hide-display",o.weekCount<5&&!v),i[5].classList.toggle("b-hide-display",o.weekCount<6&&!v),o.eachWeek(((e,r)=>{const a=s[y],c=[a.previousSibling,...a.children];i[y].dataset.week=e[0]+","+e[1],t.weekRenderer?t.callback(t.weekRenderer,t,[c[0],e]):c[0].innerText=e[1];for(let s=0;s<7;s++){const a=r[s],f=a.getDay(),v=DateHelper.makeKey(a),D=m[f],S=c[s+1],E={[l]:1,[d]:t.isDisabledDate(a),[u]:a.getMonth()!==o.month,[h]:DateHelper.weekends[f],[g]:a.getTime()===n.getTime(),[p]:D,"b-last-working-day":s===C,"b-first-visible-cell":!(a-(t.firstVisibleDate||-1)),"b-last-visible-cell":!(a-(t.lastVisibleDate||-1)),["b-day-of-week-"+f]:1};DomHelper.syncClassList(S,E),S.dataset.date=v,S.dataset.cellIndex=b,S.dataset.columnIndex=s,S.lastDomConfig&&(delete S.lastDomConfig.class,delete S.lastDomConfig.className),t.cellRenderer?t.callback(t.cellRenderer,t,[{cell:S,date:a,day:f,row:i[y],rowIndex:y,cellIndex:b,columnIndex:s,visibleColumnIndex:t.visibleDayColumnIndex[f],week:e,key:v}]):S.innerHTML=a.getDate(),b++}y++})),t.visibleWeekCount=y,t.floating&&(t.isAligning||t.realign()),t.refreshCount=(t.refreshCount||0)+1,t.trigger("refresh")}isDisabledDate(e){const t=e.getDay(),{disabledDates:r,nonWorkingDays:n}=this;return!(!this.disableWeekends||!n[t])||(r?Array.isArray(r)?(e=DateHelper.clearTime(e,!0),r.some((t=>!(DateHelper.clearTime(t,!0)-e)))):this.callback(this.disabledDates,this,[e]):void 0)}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",reference:"weekdaysHeader",children:[{class:"b-week-number-cell"},...ArrayHelper.fill(7,{class:this.dayHeaderCls}),DomHelper.scrollBarPadElement]},{className:"b-weeks-container notranslate",reference:"weeksElement",children:t}];for(let e=0;e<6;e++){const r={className:"b-calendar-row b-calendar-week",dataset:{rowIndex:e},children:[{className:"b-week-number-cell"},{className:"b-calendar-days",children:[{},{},{},{},{},{},{}],syncOptions:{ignoreRefs:!0,strict:!1}}]};t.push(r)}return e}get firstVisibleDate(){if(this.hideOtherMonthCells){const{year:e,month:t}=this.month;return new Date(e,t,1)}for(const e=this,t=e.month.startDate;;t.setDate(t.getDate()+1))if(!e.hideNonWorkingDays||!e.nonWorkingDays[t.getDay()])return t}get lastVisibleDate(){const e=DateHelper.add(this.endDate,-1,"d");if(this.hideOtherMonthCells)return e;for(const t=this,r=e;;r.setDate(r.getDate()-1))if(!t.hideNonWorkingDays||!t.nonWorkingDays[r.getDay()])return r}getCell(e,t){"string"!=typeof e&&(e=DateHelper.makeKey(e));const r=this.weeksElement.querySelector('[data-date="'+e+'"]');if(r&&(!t||!r.classList.contains(this.otherMonthCls)))return r}onTipOverCell({source:e,target:t}){e.date=DateHelper.parseKey(t.dataset.date)}updateLocalization(){this._localeNonWorkingDays=this._localeWeekends=null,this.updateDayNameFormat(),this.updateWeekStartDay(this.weekStartDay),super.updateLocalization()}};CalendarPanel.initClass(),CalendarPanel._$name="CalendarPanel";var whenNotChecked=e=>!e.value,Checkbox=class extends Field{static get $name(){return"Checkbox"}static get type(){return"checkbox"}static get alias(){return"check"}static get configurable(){return{inputType:"checkbox",autoCollapse:null,containerDefaults:{syncableConfigs:{disabled:e=>e.disabled||!e.value},syncConfigTriggers:{autoCollapse:1,value:1}},text:"",checkedValue:!0,uncheckedValue:!1,color:null,value:"",toggleGroup:null,localizableProperties:["label","text"]}}construct(e){"checked"in e&&((e=ObjectHelper.assign({},e)).value=e.checked,delete e.checked),super.construct(e),this.syncHasText()}get textLabelCls(){return"b-checkbox-label"}get innerElements(){return[this.inputElement,{tag:"label",class:this.textLabelCls,for:this.id+"-input",reference:"textLabel",html:this.text||""}]}get inputElement(){const e=super.inputElement;return this.toggleGroup&&(e.dataset={group:this.toggleGroup}),e.listeners={click:"internalOnClick",change:"internalOnChange",input:"internalOnInput"},e}get checked(){return this.value}set checked(e){this.value=e}syncHasText(){this.element.classList[this.text?"add":"remove"]("b-text")}updateText(e){this.textLabel&&(this.syncHasText(),this.textLabel.innerHTML=e)}afterSyncChildConfigs(e){super.afterSyncChildConfigs(e);let{autoCollapse:t}=this;t&&(t=!0===t?whenNotChecked:t,e.collapsed=t(this))}assignFieldValue(e,t,r){this.value=r===this.checkedValue||r!==this.uncheckedValue&&null}fetchInputValue(){this.readOnly||(this.value=this.input.checked)}gatherValue(e){var t;const r=this,n=r.value?r.checkedValue:r.uncheckedValue,i=void 0!==n,{valueName:s}=r;i&&(e[s]=n),r.gatherValues(e,i),!0===n&&(null==(t=e[s])?void 0:t.value)===n&&delete e[s].value}changeValue(e){return"false"!==e&&Boolean(e)}updateValue(e){var t;const r=this,n=r.input.checked!==e;r.input.checked=e,null==(t=r.container)||t.syncChildConfigs(),!n||r.inputting||r.isConfiguring||(r.uncheckToggleGroupMembers(),r.triggerChange(!1))}get inputValueAttr(){return"checked"}updateColor(e,t){const r=this.element.classList;t&&r.remove(t),e&&r.add(e)}getToggleGroupMembers(){const e=this,{checked:t,toggleGroup:r,input:n,type:i}=e,s=[];return t&&r&&DomHelper.forEachSelector(e.rootElement,"input[type="+i+"][data-group="+r+"]",(e=>{if(e!==n){const t=Widget.fromElement(e);t&&s.push(t)}})),s}uncheckToggleGroupMembers(){this.checked&&this.toggleGroup&&this.getToggleGroupMembers().forEach((e=>e.checked=!1))}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnClick(e){return this.readOnly?(e.preventDefault(),!1):this.trigger("click",{event:e})}internalOnChange(e){const t=this;t.readOnly&&t.value!==t.input.checked?t.input.checked=t.value:(t.value=t.input.checked,t.inputting||(t.inputting=!0,t.triggerChange(!0),t.inputting=!1))}updateInputReadOnly(e){}triggerChange(e){const t=this,{checked:r}=t.input,n={checked:r,value:r,userAction:e,valid:!0};if(!(!r&&e&&t.toggleGroup&&t.getToggleGroupMembers().filter((e=>e.isVisible&&!e.disabled)).length||!1===t.trigger("beforeChange",n)))return t.triggerFieldChange(n,!1),e&&t.uncheckToggleGroupMembers(),t.trigger("action",n),t.trigger("change",n),!0;t.input.checked=t._value=!r}};Checkbox.initClass(),Checkbox._$name="Checkbox";var YearPicker=class extends Panel{construct(e){super.construct({year:(new Date).getFullYear(),...e}),EventHelper.on({element:this.contentElement,click:"onYearClick",delegate:".b-yearpicker-year",thisObj:this})}get focusElement(){return this.getYearButton(this.year)||this.getYearButton(this.startYear)}getYearButton(e){return this.contentElement.querySelector('.b-yearpicker-year[data-year="'+e+'"]')}get value(){return this.year}set value(e){this.year=e}onYearClick({target:e}){const t=Math.min(Math.max(parseInt(e.innerText),this.minYear||1),this.maxYear||9999);this.year===t?this.trigger("select",{oldValue:t,value:t}):this.year=t}handleTitleClick(e){this.trigger("titleClick",e)}previous(){this.startYear=this.startYear-this.yearButtonCount}next(){this.startYear=this.endYear+1}ingestYear(e){if(!isNaN(e))return ObjectHelper.isDate(e)?e.getFullYear():e}changeYear(e){if(e=this.ingestYear(e))return Math.min(Math.max(e,this.minYear||1),this.maxYear||9999)}updateYear(e,t){const r=this;!r.startYear||e>r.endYear?r.startYear=e:e<r.startYear&&(r.startYear=e-(r.yearButtonCount-1)),r.isConfiguring||r.trigger("select",{oldValue:t,value:e})}get endYear(){return this.startYear+this.yearButtonCount-1}changeStartYear(e){if(e=this.ingestYear(e))return e=this.minYear?Math.max(e,this.minYear):e,this.maxYear?Math.min(e,this.maxYear-(this.yearButtonCount-1)):e}async updateStartYear(e,t){this.isVisible&&DomHelper.slideIn(this.contentElement,Math.sign(e-t))}composeBody(){this.getConfig("year");const{startYear:e}=this,t=super.composeBody(),r=t.children[this.tbar?1:0].children=[];this.widgetMap.title.text=("000"+e).slice(-4)+" - "+("000"+this.endYear).slice(-4);for(let t=0,n=e;t<this.yearButtonCount;t++,n++)r.push({tag:"button",dataset:{year:n},class:{"b-yearpicker-year":1,"b-selected":n===this.year},text:("000"+n).slice(-4)});return t}};__publicField(YearPicker,"$name","YearPicker"),__publicField(YearPicker,"type","yearpicker"),__publicField(YearPicker,"configurable",{textContent:!1,tbar:{overflow:null,items:{previous:{type:"tool",cls:"gt-icon gt-icon-first",onAction:"up.previous",weight:100},title:{type:"button",cls:"b-yearpicker-title",weight:200,onAction:"up.handleTitleClick"},next:{type:"tool",cls:"gt-icon gt-icon-last",onAction:"up.next",weight:300}}},itemCls:"b-year-container",yearButtonCount:12,year:null,minYear:null,maxYear:null,startYear:null}),YearPicker.initClass(),YearPicker._$name="YearPicker";var DisplayField=class extends TextField{static get $name(){return"DisplayField"}static get type(){return"displayfield"}static get alias(){return"display"}static get configurable(){return{readOnly:!0,editable:!1,cls:"b-display-field",template:null,ariaElement:"displayElement"}}get focusElement(){}changeReadOnly(){return!0}changeEditable(){return!1}get inputElement(){return{tag:"span",id:this.id+"-input",reference:"displayElement",html:this.template?this.template(this.value):StringHelper.encodeHtml(this.value)}}};DisplayField.initClass(),DisplayField._$name="DisplayField";var generateMonthNames=()=>DateHelper.getMonthNames().map(((e,t)=>[t,e])),dateSort=(e,t)=>e.valueOf()-t.valueOf(),emptyArray9=Object.freeze([]),ReadOnlyCombo=class extends Combo{static get $name(){return"ReadOnlyCombo"}static get type(){return"readonlycombo"}static get configurable(){return{editable:!1,inputAttributes:{tag:"div",tabIndex:-1},inputValueAttr:"innerHTML",highlightExternalChange:!1,monitorResize:!1,triggers:{expand:!1},picker:{align:{align:"t-b",axisLock:!0,matchSize:!1},cls:"b-readonly-combo-list",scrollable:{overflowX:!1}}}}};ReadOnlyCombo.initClass();var DatePicker=class extends CalendarPanel{static get $name(){return"DatePicker"}static get type(){return"datepicker"}static get delayable(){return{refresh:"raf"}}static get configurable(){return{activeDate:{value:new Date,$config:{equal:"date"}},focusable:!0,textContent:!1,tbar:{overflow:null,items:{prevYear:{cls:"gt-icon gt-icon-first",onAction:"up.gotoPrevYear",tooltip:"L{DatePicker.gotoPrevYear}"},prevMonth:{cls:"gt-icon gt-icon-previous",onAction:"up.gotoPrevMonth",tooltip:"L{DatePicker.gotoPrevMonth}"},fields:{type:"container",cls:"b-datepicker-title",items:{yearButton:{type:"button",cls:"b-datepicker-yearbutton",internalListeners:{click:"up.onYearPickerRequested"}},monthField:{type:"readonlycombo",cls:"b-datepicker-monthfield ml10",items:generateMonthNames(),internalListeners:{select:"up.onMonthPicked"}}}},nextMonth:{cls:"gt-icon gt-icon-next",onAction:"up.gotoNextMonth",tooltip:"L{DatePicker.gotoNextMonth}"},nextYear:{cls:"gt-icon gt-icon-last",onAction:"up.gotoNextYear",tooltip:"L{DatePicker.gotoNextYear}"}}},yearPicker:{value:{type:"YearPicker",yearButtonCount:16,trapFocus:!0,positioned:!0,hidden:!0,internalListeners:{titleClick:"up.onYearPickerTitleClick",select:"up.onYearPicked"}},$config:"lazy"},date:null,minDate:{value:null,$config:{equal:"date"}},maxDate:{value:null,$config:{equal:"date"}},focusDisabledDates:null,multiSelect:!1,selection:{$config:{equal:(e,t)=>e&&e.equals(t)},value:null},editMonth:!0,dayNameFormat:"dd",trapFocus:!0,role:"grid",focusDescendant:!0,alwaysRefreshOnMonthChange:null}}static get prototypeProperties(){return{outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date"}}construct(e){const t=this;super.construct(e),t.externalCellRenderer=t.cellRenderer,t.cellRenderer=t.internalCellRenderer,t.element.setAttribute("aria-activedescendant",t.id+"-active-day"),t.weeksElement.setAttribute("role","grid"),t.weekElements.forEach((e=>e.setAttribute("role","row"))),t.element.setAttribute("ariaLabelledBy",t.widgetMap.fields.id),EventHelper.on({element:t.weeksElement,click:{handler:"onCellClick",delegate:"."+t.dayCellCls+":not(."+t.disabledCls+"):not(."+t.outOfRangeCls+")"},mousedown:{handler:"onCellMousedown",delegate:"."+t.dayCellCls},thisObj:t}),t.widgetMap.monthField.readOnly=t.widgetMap.yearButton.disabled=!t.editMonth,t.refresh.flush()}afterHide(){var e;null==(e=this._yearPicker)||e.hide(),super.afterHide(...arguments)}doDestroy(){var e,t;null==(e=this.yearButton)||e.destroy(),null==(t=this.monthField)||t.destroy(),super.doDestroy()}get focusElement(){return this.weeksElement.querySelector("."+this.dayCellCls+'[tabIndex="0"]')}doRefresh(){const e=this,t=e.focusElement,r=DateHelper.betweenLesser(e.activeDate,e.month.startDate,e.month.endDate)?e.activeDate:e._activeDate=e.date;super.doRefresh(...arguments);const n=DateHelper.parseKey(null==t?void 0:t.dataset.date);r-n&&e.syncActiveDate(r,n)}internalCellRenderer({cell:e,date:t}){const r=this,{activeCls:n,selectedCls:i,externalCellRenderer:s}=r,a=r.isSelectedDate(t),o={[n]:n&&r.isActiveDate(t),[i]:a,[r.outOfRangeCls]:r.minDate&&t<r.minDate||r.maxDate&&t>r.maxDate};if(a&&r.multiSelect){const e=!r.isSelectedDate(DateHelper.add(t,-1,"d")),n=!r.isSelectedDate(DateHelper.add(t,1,"d"));o["b-range-start"]=e,o["b-range-end"]=n,o["b-in-range"]=!e&&!n}DomHelper.updateClassList(e,o),e.innerHTML='<div class="b-datepicker-cell-inner">'+t.getDate()+"</div>",e.setAttribute("role","gridcell"),e.setAttribute("aria-label",DateHelper.format(t,"MMMM D, YYYY")),r.isActiveDate(t)?e.id=r.id+"-active-day":e.removeAttribute("id"),s&&(arguments[0].cell=e.firstChild,r.callback(s,this,arguments))}onCellMousedown(e){const t=e.target.closest("[data-date]");e.preventDefault(),t.focus(),this.activeDate=DateHelper.parseKey(t.dataset.date)}onCellClick(e){const t=e.target.closest("[data-date]");this.onUIDateSelect(DateHelper.parseKey(t.dataset.date),e)}onMonthDateChange({newDate:e,changes:t}){this.getConfig("tbar"),super.onMonthDateChange(...arguments),(t.m||t.y)&&(this.widgetMap.monthField.value=e.getMonth(),this.widgetMap.yearButton.text=e.getFullYear()+"年")}onUIDateSelect(e,t){const r=this,{lastClickedDate:n,multiSelect:i}=r;r.lastClickedDate=e,r.isDisabledDate(e)||(r.activatingEvent=t,i?r.handleMultiSelect(n,e,t):(r.selection=e,r.floating&&r.hide()),r.activatingEvent=null)}handleMultiSelect(e,t,r){const n=this,{multiSelect:i}=n,s=n._selection||(n._selection=new DateSet),a=s.dates,o="range"===i,{size:l,generation:c}=s,d=l&&{[DateHelper.makeKey(DateHelper.add(a[0],-1,"d"))]:1,[DateHelper.makeKey(a[0])]:1,[DateHelper.makeKey(a[a.length-1])]:1,[DateHelper.makeKey(DateHelper.add(a[a.length-1],1,"d"))]:1},u=s.has(t)?"delete":"add",h=o&&(null==d?void 0:d[DateHelper.makeKey(t)]);if(r.ctrlKey)!0!==i&&l&&!h||(s[u](t),o&&!s.has(n.rangeStartDate)&&n.rangeStartDate.setDate(n.rangeStartDate.getDate()+(t<a[1]?1:-1)));else if(r.shiftKey&&l){const[r,i]=[new Date(o?n.rangeStartDate||(n.rangeStartDate=a[0]):e),t].sort(dateSort);o&&s.clear();for(const e=r;e<=i;e.setDate(e.getDate()+1))s.add(e)}else s.has(t)&&1===s.size||(s.clear(),s.add(t));const g=s.size;1===g?n.rangeStartDate=t:g||(n.rangeStartDate=null),s.generation!==c&&n.updateSelection(s)}changeSelection(e){const t=this;let r,n;if(e)if(e.forEach||(e=[e]),e.forEach(((r,n)=>e[n]=t.changeDate(r))),n=e[0],e.sort(dateSort),"range"===t.multiSelect&&2===e.length){r=new DateSet;for(const t=new Date(e[0]);t<=e[1];t.setDate(t.getDate()+1))r.add(t)}else n=e[0],r=new DateSet(e);else r=new DateSet;return n&&(t.activeDate=t.rangeStartDate=DateHelper.clearTime(n)),r}updateMultiSelect(e){this.element.classList.toggle("b-multiselect",Boolean(e)),e||(this.selection=[...this.selection][0])}updateSelection(e){const t=this,{dates:r}=e,n="range"===t.multiSelect?[r[0],r[r.length-1]]:r;r.length&&(t.date=r[0]),t.isConfiguring||(t.refresh.now(),t.trigger("selectionChange",{selection:n,userAction:Boolean(t.activatingEvent)}))}get selection(){const{_selection:e}=this,t=e?e.dates:emptyArray9;return"range"===this.multiSelect&&t.length?[t[0],t[t.length-1]]:t}onInternalKeyDown(e){const t=this,r=e.key.trim()||e.code,n=t.activeDate;let i=new Date(n);if("Escape"===r&&t.floating)return t.hide();if(n&&t.weeksElement.contains(e.target)){do{switch(r){case"ArrowLeft":e.preventDefault(),e.ctrlKey?i=t.gotoPrevMonth():i.setDate(i.getDate()-1);break;case"ArrowUp":e.preventDefault(),i.setDate(i.getDate()-7);break;case"ArrowRight":e.preventDefault(),e.ctrlKey?i=t.gotoNextMonth():i.setDate(i.getDate()+1);break;case"ArrowDown":e.preventDefault(),i.setDate(i.getDate()+7);break;case"Enter":return t.onUIDateSelect(n,e)}}while(t.isDisabledDate(i)&&!t.focusDisabledDates);if(t.minDate&&i<t.minDate)return;if(t.maxDate&&i>t.maxDate)return;t.activeDate=i}}changeMinDate(e){return e&&CalendarPanel.prototype.changeDate.apply(this,arguments)}updateMinDate(e){this._yearpicker&&(this._yearpicker.minYear=null==e?void 0:e.getFullYear()),this.refresh()}changeMaxDate(e){return e&&CalendarPanel.prototype.changeDate.apply(this,arguments)}updateMaxDate(e){this._yearpicker&&(this._yearpicker.maxYear=null==e?void 0:e.getFullYear()),this.refresh()}changeDate(e){return DateHelper.clamp(super.changeDate(e),this.minDate,this.maxDate)}updateDate(e){const t=this;t.isConfiguring&&!t.initializingActiveDate&&(t.selection=e),t.month.date&&e.getMonth()!==t.month.month&&t.getCell(e)&&!t.alwaysRefreshOnMonthChange&&!t.isNavigating||super.updateDate(e)}changeActiveDate(e,t){if(!1!==this.trigger("beforeActiveDateChange",{activeDate:e,oldActiveDate:t})){if(e=e?this.changeDate(e):this.date||(this.date=DateHelper.clearTime(new Date)),isNaN(e))throw new Error("DatePicker日期摄取必须传递date或YYYY-MM-DD日期字符串");return DateHelper.clamp(e,this.minDate,this.maxDate)}}updateActiveDate(e,t){const r=this,{isConfiguring:n}=r;!n&&r.getCell(e)||(r.initializingActiveDate=n,r.date=e,r.initializingActiveDate=!1),n||r.refresh.isPending||r.syncActiveDate(e,t)}syncActiveDate(e,t){const r=this,{activeCls:n}=r,i=r.getCell(e),s=t&&r.getCell(t),a=DomHelper.getActiveElement(r.element);i.setAttribute("tabIndex",0),n&&i.classList.add(n),i.id=r.id+"-active-day",r.weeksElement.contains(a)&&i.focus(),s&&s!==i&&(s.removeAttribute("tabIndex"),n&&s.classList.remove(n),s.removeAttribute("id"))}set value(e){const t=this,{selection:r,duration:n}=t;if(e){if(e=t.changeDate(e,t.value),"range"===t.multiSelect&&2===(null==r?void 0:r.length))return DateHelper.betweenLesserEqual(e,...r)||(e<r[0]?t.selection=[e,DateHelper.add(e,n-1,"d")]:t.selection=[DateHelper.add(e,-(n-1),"d"),e]),void(t.date=t.activeDate=e);void 0!==e&&(t.selection=e)}else t.date=new Date,t.selection=null}get value(){return this.selection[this.selection.length-1]}get duration(){return"range"===this.multiSelect?DateHelper.diff(...this.selection,"d")+1:1}gotoPrevYear(){return this.goto(-1,"year")}gotoPrevMonth(){return this.goto(-1,"month")}gotoNextMonth(){return this.goto(1,"month")}gotoNextYear(){return this.goto(1,"year")}goto(e,t){const r=this,{activeDate:n}=r,i=n&&r.getCell(n);let s;s="month"===t&&i&&(null==n?void 0:n.getMonth())===r.month.month+e?n:DateHelper.add(i?n:r.date,e,t);const a=new Date(s);a.setDate(1);const o=DateHelper.add(DateHelper.add(a,1,"month"),-1,"day");if(r.minDate&&e<0&&o<r.minDate||r.maxDate&&e>0&&a>r.maxDate)return;r.isNavigating=!0;const l=r.date=s;return i&&(r.activeDate=s),r.isNavigating=!1,l}isActiveDate(e){return!(e-this.activeDate)}isSelectedDate(e){var t;return null==(t=this._selection)?void 0:t.has(e)}onMonthPicked({record:e,userAction:t}){var r;t&&(this.activeDate=DateHelper.add(this.activeDate,e.value-this.activeDate.getMonth(),"month"),null==(r=this.focusElement)||r.focus())}onYearPickerRequested(){const{yearPicker:e}=this;e.isVisible?e.hide():(e.year=e.startYear=this.activeDate.getFullYear(),e.show(),e.focus())}onYearPickerTitleClick(){this.yearPicker.hide()}onYearPicked({value:e,source:t}){const r=new Date(this.activeDate);r.setFullYear(e),this.activeDate=r,this.focusElement&&DomHelper.focusWithoutScrolling(this.focusElement),t.hide()}changeYearPicker(e,t){var r,n;return YearPicker.reconfigure(t,e?YearPicker.mergeConfigs({owner:this,appendTo:this.element,minYear:null==(r=this.minDate)?void 0:r.getFullYear(),maxYear:null==(n=this.maxDate)?void 0:n.getFullYear()},e):null,this)}get childItems(){const{_yearPicker:e}=this,t=super.childItems;return e&&t.push(e),t}updateLocalization(){const{monthField:e}=this.widgetMap,t=generateMonthNames();this.isConfiguring||t.every(((t,r)=>t[1]===e.store.getAt(r).text))||(t[e.value].selected=!0,e.items=t),super.updateLocalization()}},DateSet=class extends Set{add(e){return e=DateHelper.makeKey(e),this.has(e)||(this.generation=(this.generation||0)+1),super.add(e)}delete(e){return e=DateHelper.makeKey(e),this.has(e)&&this.generation++,super.delete(e)}has(e){return super.has(DateHelper.makeKey(e))}clear(){return this.size&&this.generation++,super.clear()}equals(e){return Array.isArray(e)&&(e=new DateSet(e)),e.size===this.size&&[...this].every((t=>e.has(t)))}get dates(){return[...this].sort().map((e=>DateHelper.parseKey(e)))}};DatePicker.initClass(),DatePicker._$name="DatePicker";var DateField=class extends PickerField{static get $name(){return"DateField"}static get type(){return"datefield"}static get alias(){return"date"}static get configurable(){return{format:"L",strictParsing:!1,fallbackFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss:SSS",keepTime:!1,pickerFormat:null,validateDateOnly:null,triggers:{expand:{cls:"gt-icon-calendar",handler:"onTriggerClick",weight:200},back:{cls:"gt-icon gt-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick",align:"start",weight:100},forward:{cls:"gt-icon gt-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:!1,stepTriggers:null,weekStartDay:null,picker:{type:"datepicker",role:"dialog",floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0}},value:null}}changePicker(e,t){const r=this,n={owner:r,forElement:r[r.pickerAlignElement],minDate:r.min,maxDate:r.max,weekStartDay:r._weekStartDay,align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},onSelectionChange:({selection:e,source:t})=>{t.isVisible&&(r._isUserAction=r._isPickerInput=!0,r.value=e[0],r._isPickerInput=r._isUserAction=!1,t.hide())}};r.calendarContainerCls&&(n.cls=r.calendarContainerCls),r.value?n.value=r.value:n.activeDate=new Date;const i=DatePicker.reconfigure(t,e,{owner:r,defaults:n});return null==i||i.refresh.flush(),i}get backShiftDate(){return DateHelper.add(this.value,-1*this._step.magnitude,this._step.unit)}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=e.backShiftDate;(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get forwardShiftDate(){return DateHelper.add(this.value,this._step.magnitude,this._step.unit)}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=e.forwardShiftDate;(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}showPicker(e){if(this.readOnly)return;const t=this,{_picker:r}=t;if(r){const e={minDate:t.min,maxDate:t.max};t.value?e.value=t.value:e.activeDate=new Date,r.setConfig(e)}super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){const{min:r,max:n,validateDateOnly:i}=e;if(i&&(t=DateHelper.clearTime(t,!1)),r&&t<r)return!0;if(n&&t>n)return!0}return super.isValid}transformDateValue(e){const t=this;return null!=e&&(DateHelper.isDate(e)||(e="string"==typeof e?DateHelper.parse(e,t.format,t.strictParsing)||DateHelper.parse(e,t.fallbackFormat,t.strictParsing):new Date(e)),DateHelper.isValidDate(e))?(!t.min||e-t.min>-DateHelper.MS_PER_DAY)&&(!t.max||e<=t.max)?t.transformTimeValue(e):e:null}transformTimeValue(e){const t=this,{keepTime:r}=t;if(e=DateHelper.clone(e),r)if("entered"!==r){const n=DateHelper.parse(r,t.timeFormat);DateHelper.isValidDate(n)?DateHelper.copyTimeValues(e,n):DateHelper.isValidDate(t.value)&&DateHelper.copyTimeValues(e,t.value)}else t._isPickerInput&&DateHelper.isValidDate(t.value)&&DateHelper.copyTimeValues(e,t.value);else DateHelper.clearTime(e,!1);return e}changeMin(e){return this.transformDateValue(e)}updateMin(e){const{input:t,_picker:r}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),r&&(r.minDate=e),this.syncInvalid()}changeMax(e){return this.transformDateValue(e)}updateMax(e){const{input:t,_picker:r}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),r&&(r.maxDate=e),this.syncInvalid()}get weekStartDay(){return"number"==typeof this._weekStartDay?this._weekStartDay:DateHelper.weekStartDay}updateWeekStartDay(e){this._picker&&(this._picker.weekStartDay=e)}changeValue(e,t){const r=this,n=r.transformDateValue(e);if(!e||n){if(r.clearError("L{invalidDate}"),r.hasChanged(t,n))return super.changeValue(n,t);r.inputting||r.syncInputFieldValue()}else r.setError("L{invalidDate}")}updateValue(e,t){const r=this._picker;r&&!this.inputting&&(r.value=e),super.updateValue(e,t)}changeStep(e,t){const r=typeof e;return e?("number"===r?e={magnitude:Math.abs(e),unit:t?t.unit:"day"}:"string"===r&&(e=DateHelper.parseDuration(e)),e&&e.unit&&e.magnitude?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}hasChanged(e,t){return(null==e?void 0:e.getTime)&&(null==t?void 0:t.getTime)&&"entered"!==this.keepTime?!DateHelper.isEqual(DateHelper.clearTime(e),DateHelper.clearTime(t)):super.hasChanged(e&&e.getTime(),t&&t.getTime())}get inputValue(){const e=this.value;return e?DateHelper.format(e,this.format):""}updateFormat(){this.isConfiguring||this.syncInputFieldValue(!0)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}internalOnKeyEvent(e){super.internalOnKeyEvent(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}};DateField.initClass(),DateField._$name="DateField";var NumberField=class extends Field{static get $name(){return"NumberField"}static get type(){return"numberfield"}static get alias(){return"number"}static get configurable(){return{min:null,max:null,step:1,largeStep:0,value:null,format:"",decimalPrecision:null,leadingZeroes:null,triggers:{spin:{type:"spintrigger"}},changeOnSpin:!0,inputType:null}}construct(e){super.construct(e);const t=this;t.input.addEventListener("dblclick",(()=>{t.select()})),"number"==typeof t.changeOnSpin&&(t.bufferedSpinChange=t.buffer(t.triggerChange,t.changeOnSpin))}acceptValue(e,t){let r=!isNaN(e);if(r&&!this.hasTextSelection){r=!1;const e=this.input.value,n=parseFloat(e);e!==t&&(r=!this.acceptValue(n,e))}return r}okMax(e){return isNaN(this.max)||e<=this.max}okMin(e){return isNaN(this.min)||e>=this.min}internalOnKeyEvent(e){if("keydown"===e.type){const t=this,r=e.key;let n;if("ArrowUp"===r)t.doSpinUp(e.shiftKey),n=!0;else if("ArrowDown"===r)t.doSpinDown(e.shiftKey),n=!0;else if(!e.altKey&&!e.ctrlKey&&r&&1===r.length){const e=t.getAfterValue(r),i=t.formatter.parseStrict(e);n=!(i===t.value||"-"===e&&(isNaN(t.min)||t.min<0))&&!t.acceptValue(i,e)}"Enter"===r&&t._changedBySilentSpin&&(t.triggerChange(e,!0),t._changedBySilentSpin=!1),n&&e.preventDefault()}super.internalOnKeyEvent(e)}doSpinUp(e=!1){const t=this;if(t.readOnly)return;let r=(t.value||0)+(e?t.largeStep:t.step);t.okMin(r)||(r=t.min),t.okMax(r)&&t.applySpinChange(r)}doSpinDown(e=!1){const t=this;if(t.readOnly)return;let r=(t.value||0)-(e?t.largeStep:t.step);t.okMax(r)||(r=t.max),t.okMin(r)&&t.applySpinChange(r)}applySpinChange(e){const t=this;t._isUserAction=!0,!0!==t.changeOnSpin&&(t._changedBySilentSpin=!0,t.silenceChange=!0,t.bufferedSpinChange&&t.bufferedSpinChange(null,!0)),t.value=e,t._isUserAction=!1,t.silenceChange=!1}triggerChange(){this.silenceChange||super.triggerChange(...arguments)}onFocusOut(e){var t,r,n;super.onFocusOut(...arguments);const i=this,{input:s}=i,a=s.value,o=i.formatter.truncate(a),l=isNaN(o)?a:i.formatValue(o);null==(n=null==(r=null==(t=i.triggers)?void 0:t.spin)?void 0:r.clickRepeater)||n.cancel(),a!==l&&(s.value=l),i._changedBySilentSpin&&(i.triggerChange(e,!0),i._changedBySilentSpin=!1)}internalOnInput(e){const t=this,{formatter:r,input:n}=t,{parser:i}=r,s=n.value,a=i.decimalPlaces(s);if(r.truncator&&a){let e=s;const o=r.truncate(s);if(!isNaN(o)&&(e=t.formatValue(o),i.decimalPlaces(e)<a)){const r=s.length-t.caretPos;n.value=e,t.caretPos=e.length-r}}super.internalOnInput(e)}formatValue(e){return this.formatter.format(e)}changeFormat(e){const t=this;if(""===e){const{leadingZeroes:r,decimalPrecision:n}=t;e=r?r+">9":null,null!=n?e=(e||"")+"9."+"#".repeat(n):e&&(e+=".*")}return e}get formatter(){const e=this,t=e.format;let r=e._formatter;return r&&e._lastFormat===t||(r=NumberFormat.get(e._lastFormat=t),e._formatter=r),r}updateStep(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}changeLargeStep(e){return e||10*this.step}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}changeValue(e,t){const r=this;if(e||0===e){let t;"number"!=typeof e&&(e="string"==typeof e?r.formatter.parse(e):Number(e),t=isNaN(e),t&&(e="")),!t&&r.format&&(e=r.formatter.round(e))}else e=void 0;return super.changeValue(e,t)}get inputValue(){let e=this.value;return null!=e&&this.format&&(e=this.formatValue(e)),e}};NumberField.initClass(),NumberField._$name="NumberField";var TimePicker=class extends Container{static get $name(){return"TimePicker"}static get type(){return"timepicker"}construct(e){super.construct(e),this.refresh()}updateSeconds(e){this.widgetMap.second[e?"show":"hide"]()}onFieldChange(){this.isConfiguring||this.isRefreshing||(this.value=this.pickerToTime())}onAmPmButtonClick({source:e}){this._pm="pmButton"===e.ref,this._value&&(this.value=this.pickerToTime())}onInternalKeyDown(e){var t;const r=this;switch(e.key){case"Escape":return r.triggerTimeChange(r._initialValue),r.hide(),void e.preventDefault();case"Enter":return r.value=r.pickerToTime(),r.hide(),void e.preventDefault()}null==(t=super.onInternalKeyDown)||t.call(this,e)}pickerToTime(){const e=this,t=e._pm,{hour:r,minute:n,second:i}=e.widgetMap;r.format=e._is24Hour?"2>9":null;let s=r.value,a=new Date(e.value);return e._is24Hour||(t&&s<12&&(s+=12),t||12!==s||(s=0)),a.setHours(s),a.setMinutes(n.value),e.seconds&&a.setSeconds(i.value),e._min&&(a=DateHelper.max(e._min,a)),e._max&&(a=DateHelper.min(e._max,a)),a}triggerTimeChange(e){this.trigger("timeChange",{time:e})}updateInitialValue(e){this.value=e}changeValue(e){return e&&(e="string"==typeof e?DateHelper.parse(e,this.format):e),this.isVisible||(this._initialValue=e),null!=e?e:DateHelper.getTime(0)}updateValue(e){this.isVisible&&this.triggerTimeChange(e),this.refresh()}updateFormat(e){this._is24Hour=DateHelper.is24HourFormat(e),this.refresh()}changeMin(e){return"string"==typeof e?DateHelper.parse(e,this.format):e}changeMax(e){return"string"==typeof e?DateHelper.parse(e,this.format):e}refresh(){const e=this;if(!e.isConfiguring&&e.value){e.isRefreshing=!0;const{hour:t,minute:r,second:n,amButton:i,pmButton:s}=e.widgetMap,a=e.value,o=e._is24Hour,l=a.getHours(),c=e._pm=l>=12;e.element.classList[o?"add":"remove"]("b-24h"),t.min=o?0:1,t.max=o?23:12,t.value=o?l:l%12||12,r.value=a.getMinutes(),n.value=a.getSeconds(),i.pressed=!c,s.pressed=c,i.hidden=s.hidden=o,e.isRefreshing=!1}}};__publicField(TimePicker,"configurable",{floating:!0,items:{hour:{label:"L{TimePicker.hour}",type:"number",min:0,max:23,highlightExternalChange:!1,format:"2>9"},minute:{label:"L{TimePicker.minute}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},second:{hidden:!0,label:"L{TimePicker.second}",type:"number",min:0,max:59,highlightExternalChange:!1,format:"2>9"},amButton:{type:"button",text:"AM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"},pmButton:{type:"button",text:"PM",toggleGroup:"am-pm",cls:"b-blue",onClick:"up.onAmPmButtonClick"}},autoShow:!1,trapFocus:!0,seconds:null,value:{$config:{equal:"date"},value:null},format:null,max:null,min:null,initialValue:null}),TimePicker.initClass(),TimePicker._$name="TimePicker";var TimeField=class extends PickerField{static get $name(){return"TimeField"}static get type(){return"timefield"}static get alias(){return"time"}static get configurable(){return{picker:{type:"timepicker",align:{align:"t0-b0",axisLock:!0}},format:"LT",triggers:{expand:{align:"end",handler:"onTriggerClick",compose:()=>({children:[{class:{"gt-icon-clock-live":1}}]})},back:{align:"start",cls:"gt-icon gt-icon-angle-left b-step-trigger",key:"Shift+ArrowDown",handler:"onBackClick"},forward:{align:"end",cls:"gt-icon gt-icon-angle-right b-step-trigger",key:"Shift+ArrowUp",handler:"onForwardClick"}},min:null,max:null,step:"5m",stepTriggers:null,value:null,keepDate:!1}}changePicker(e,t){const r=this;return TimePicker.reconfigure(t,e,{owner:r,defaults:{value:r.value,forElement:r[r.pickerAlignElement],owner:r,align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},onTimeChange({time:e}){r._isUserAction=!0,r.value=e,r._isUserAction=!1}}})}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,-1*e.step.magnitude,e.step.unit);(!t||t.getTime()<=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const r=DateHelper.add(e.value,e.step.magnitude,e.step.unit);(!t||t.getTime()>=r)&&(e._isUserAction=!0,e.value=r,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("L{Field.minimumValueViolation}",!0),e.clearError("L{Field.maximumValueViolation}",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("L{Field.minimumValueViolation}",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("L{Field.maximumValueViolation}",!0),!1}return super.isValid}hasChanged(e,t){return(null==e?void 0:e.getTime)&&(null==t?void 0:t.getTime)?e.getHours()!==t.getHours()||e.getMinutes()!==t.getMinutes()||e.getSeconds()!==t.getSeconds()||e.getMilliseconds()!==t.getMilliseconds():super.hasChanged(e,t)}showPicker(){const e=this,{picker:t,value:r}=e;e.readOnly||(t.value=r,t.format=e.format,t.maxTime=e.max,t.minTime=e.min,r||(e.value=t.value),super.showPicker(!0))}onPickerShow(){var e;super.onPickerShow(),this.pickerKeyDownRemover=null==(e=this.pickerKeyDownRemover)?void 0:e.call(this)}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("string"==typeof e?(e=DateHelper.parse(e,this.format),this.keepDate&&(e=DateHelper.copyTimeValues(new Date(this.value),e))):e=new Date(e),DateHelper.isValidDate(e))?this.keepDate?e:DateHelper.getTime(e):null}changeMin(e){return this.transformTimeValue(e)}updateMin(e){const{input:t}=this;t&&(null==e?t.removeAttribute("min"):t.min=e),this.syncInvalid()}changeMax(e){return this.transformTimeValue(e)}updateMax(e){const{input:t}=this;t&&(null==e?t.removeAttribute("max"):t.max=e),this.syncInvalid()}changeValue(e,t){const r=this,n=r.transformTimeValue(e);if(e&&!n||r.isRequired&&""===e)r.setError("L{invalidTime}");else{if(r.clearError("L{invalidTime}"),r.hasChanged(t,n))return super.changeValue(n,t);r.inputting||r.syncInputFieldValue(!0)}}updateValue(e,t){const{expand:r}=this.triggers;r&&e&&(r.element.firstElementChild.style.animationDelay=-(60*e.getHours()+e.getMinutes())/10+"s"),super.updateValue(e,t)}changeStep(e,t){const r=typeof e;return e?("number"===r?e={magnitude:Math.abs(e),unit:t?t.unit:"hour"}:"string"===r&&(e=DateHelper.parseDuration(e)),(null==e?void 0:e.unit)&&(null==e?void 0:e.magnitude)?(e.magnitude<0&&(e={magnitude:-e.magnitude,unit:e.unit}),e):void 0):null}updateStep(e){this.element.classList[e?"remove":"add"]("b-no-steppers"),this.syncInvalid()}updateFormat(){this.syncInputFieldValue(!0)}get inputValue(){return DateHelper.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue(!0)}};TimeField.initClass(),TimeField._$name="TimeField";var DateTimeField=class extends Field{doDestroy(){this.dateField.destroy(),this.timeField.destroy(),super.doDestroy()}get focusElement(){return this.dateField.input}get innerElements(){return[this.dateField.element,this.timeField.element]}internalOnKeyEvent(){}updateRevertOnEscape(e){this.timeField.revertOnEscape=e,this.dateField.revertOnEscape=e}changeTimeField(e){const t=this,r=TimeField.new({revertOnEscape:t.revertOnEscape,syncInvalid(...e){const r=t.updatingInvalid;TimeField.prototype.syncInvalid.apply(this,e),t.timeField&&!r&&t.syncInvalid()}},e);return EventHelper.on({element:r.element,keydown:"onTimeFieldKeyDown",thisObj:t}),t.readOnly&&(r.readOnly=!0),r}updateTimeField(e){const t=this;e.ion({change({userAction:e,value:r}){if(e&&!t.$settingValue){const e=t.dateField.value;t._isUserAction=!0,t.value=e?DateHelper.copyTimeValues(e,r):null,t._isUserAction=!1}},thisObj:t})}changeDateField(e){const t=this,r=(null==e?void 0:e.type)||"datefield",n=Widget.resolveType(e.type||"datefield"),i=Widget.create(ObjectHelper.assign({type:r,revertOnEscape:t.revertOnEscape,syncInvalid(...e){const r=t.updatingInvalid;n.prototype.syncInvalid.apply(this,e),t.dateField&&!r&&t.syncInvalid()}},e));return EventHelper.on({element:i.element,keydown:"onDateFieldKeyDown",thisObj:t}),t.readOnly&&(i.readOnly=!0),i.ion({keydown:({event:e})=>{var t;"Tab"===e.key&&!e.shiftKey&&(null==(t=this.timeField)?void 0:t.isVisible)&&(e.stopPropagation(),e.cancelBubble=!0)}}),i}get childItems(){return[this.dateField,this.timeField]}updateDateField(e){const t=this;e.ion({change({userAction:e,value:r}){e&&!t.$isInternalChange&&(t._isUserAction=!0,t.timeField.value?r&&DateHelper.copyTimeValues(r,t.timeField.value):t.timeField.value=r,t.value=r,t._isUserAction=!1)},thisObj:t})}updateWeekStartDay(e){this.dateField&&(this.dateField.weekStartDay=e)}changeWeekStartDay(e){var t,r;return"number"==typeof e?e:null!=(r=null==(t=this.dateField)?void 0:t.weekStartDay)?r:DateHelper.weekStartDay}syncInputFieldValue(e=this.isConfiguring){super.syncInputFieldValue(!0);const t=this,{dateField:r,timeField:n}=t,i=r.highlightExternalChange,s=n.highlightExternalChange;e||t.highlightExternalChange||(e=!0),t.$isInternalChange=!0,r.highlightExternalChange=!1,r.value=null,r.highlightExternalChange=i,e&&(n.highlightExternalChange=r.highlightExternalChange=!1),n.value=r.value=t.inputValue,r.highlightExternalChange=i,n.highlightExternalChange=s,t.$isInternalChange=!1,t.syncInvalid()}onTimeFieldKeyDown(e){const t=this;if("Enter"===e.key||"Tab"===e.key){const e=t.dateField.value;t._isUserAction=!0,t.value=e?DateHelper.copyTimeValues(e,t.timeField.value):null,t._isUserAction=!1}}onDateFieldKeyDown(e){const t=this;"Tab"!==e.key||e.shiftKey?"Enter"===e.key&&(t.value=t.dateField.value):(e.stopPropagation(),e.preventDefault(),t.timeField.focus())}updateRequired(e,t){this.timeField.required=this.dateField.required=e}updateReadOnly(e,t){super.updateReadOnly(e,t),this.isConfiguring||(this.timeField.readOnly=this.dateField.readOnly=e)}onDisabled(e){this.timeField.disabled=this.dateField.disabled=e}focus(){this.dateField.focus()}hasChanged(e,t){return!DateHelper.isEqual(e,t)}get isValid(){return this.timeField.isValid&&this.dateField.isValid}setError(e,t){[this.dateField,this.timeField].forEach((r=>r.setError(e,t)))}getErrors(){const e=[...this.dateField.getErrors()||[],...this.timeField.getErrors()||[]];return e.length?e:null}clearError(e,t){[this.dateField,this.timeField].forEach((r=>r.clearError(e,t)))}updateInvalid(){this.updatingInvalid=!0,[this.dateField,this.timeField].forEach((e=>e.updateInvalid())),this.updatingInvalid=!1}};__publicField(DateTimeField,"configurable",{timeField:{},dateField:{keepTime:!0,step:"1 d"},weekStartDay:null,inputTemplate:()=>"",ariaElement:"element"}),__publicField(DateTimeField,"$name","DateTimeField"),__publicField(DateTimeField,"type","datetimefield"),__publicField(DateTimeField,"alias","datetime"),DateTimeField.initClass(),DateTimeField._$name="DateTimeField";var DurationField=class extends TextField{static get $name(){return"DurationField"}static get type(){return"durationfield"}static get alias(){return"duration"}static get defaultConfig(){return{value:null,step:1,unit:null,defaultUnit:"day",magnitude:null,useAbbreviation:!1,allowNegative:!1,decimalPrecision:null,triggers:{spin:{type:"spintrigger"}},nullValue:null}}static get configurable(){return{min:null,max:null,allowedUnits:null}}changeMin(e){return"string"==typeof e?new Duration(e):e}changeMax(e){return"string"==typeof e?new Duration(e):e}changeAllowedUnits(e){return"string"==typeof e&&(e=e.split(",")),e}updateAllowedUnits(e){this.allowedUnitsRe=new RegExp("("+e.join("|")+")","i")}get inputValue(){return null==this.value?"":this.calcValue(!0).toString(this.useAbbreviation)}set unit(e){this._unit=e,this.value=this.calcValue()}get unit(){return this._unit}get unitWithDefault(){return this._unit||DurationField.defaultConfig.defaultUnit}set magnitude(e){this.clearError("L{invalidUnit}"),this._magnitude=e,super.value=this.calcValue()}get magnitude(){return this._magnitude}roundMagnitude(e){return e&&null!=this.decimalPrecision?ObjectHelper.round(e,this.decimalPrecision):e}get allowDecimals(){return 0!==this.decimalPrecision}get isValid(){const e=this,t=null==e.value||e.value&&null==e.value.magnitude;return super.isValid&&(t&&!e.required||!t&&(e.allowNegative||e.value.magnitude>=0))}internalOnChange(e){const t=this,r=t.value,n=t._lastValue;t.hasChanged(n,r)&&(t._lastValue=r,t.triggerFieldChange({value:r,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){var t,r,n;return this.syncInputFieldValue(!0),null==(n=null==(r=null==(t=this.triggers)?void 0:t.spin)?void 0:r.clickRepeater)||n.cancel(),super.onFocusOut(e)}set value(e){const t=this;let r,n;if(this.clearError("L{invalidUnit}"),"number"==typeof e)r=e,n=t._unit;else if("string"==typeof e)if(/^\s*$/.test(e))r=null;else{const i=DateHelper.parseDuration(e,t.allowDecimals,t.unitWithDefault);i&&(!t.allowedUnitsRe||t.allowedUnitsRe.test(i.unit)?(n=i.unit,r=i.magnitude):t.setError("L{invalidUnit}"))}else e&&"unit"in e&&"magnitude"in e?(n=e.unit,r=e.magnitude):(n=null,r=null);t._magnitude===r&&t._unit==n||(t._magnitude=r,n&&(t._unit=n),super.value=t.calcValue())}okMax(e){return"number"==typeof e&&(e=new Duration({unit:this.unitWithDefault,magnitude:e})),null==this.max||e<=this.max}okMin(e){return"number"==typeof e&&(e=new Duration({unit:this.unitWithDefault,magnitude:e})),null==this.min||e>=this.min}get validity(){const e=this.value,t={};return null!=e&&(t.rangeUnderflow=!this.okMin(e),t.rangeOverflow=!this.okMax(e)),t.valid=!t.rangeUnderflow&&!t.rangeOverflow,t}get value(){return super.value}calcValue(e=!1){const t=this;return t._unit&&null!=t._magnitude||!t.clearable?new Duration(e?this.roundMagnitude(t._magnitude):this._magnitude,t.unitWithDefault):null}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&!e.isEqual(t)}get milliseconds(){return this.value?this.value.milliseconds:0}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)+e.step;e._isUserAction=!0,e.okMin(t)||(t=e.min),e.okMax(t)&&(e.value=t),e._isUserAction=!1}doSpinDown(){const e=this;if(e.readOnly)return;let t=(e.magnitude||0)-e.step;e.okMax(t)||(t=e.max),e.okMin(t)&&(e.allowNegative||(e.magnitude||0)>0)&&(e._isUserAction=!0,e.value=t,e._isUserAction=!1)}};DurationField.initClass(),DurationField._$name="DurationField";var Fit=class extends Layout{};__publicField(Fit,"$name","Fit"),__publicField(Fit,"type","fit"),__publicField(Fit,"configurable",{containerCls:"b-fit-container",itemCls:"b-fit-item"}),Fit.initClass(),Fit._$name="Fit";var Editor=class extends Container{afterConfigure(){const e=this;super.afterConfigure(),e.onTargetSizeChange=e.onTargetSizeChange.bind(e),EventHelper.on({element:e.element,keydown:"onKeyDown",contextmenu:"stopMouseEvents",mousedown:"stopMouseEvents",mouseover:"stopMouseEvents",mouseout:"stopMouseEvents",mouseup:"stopMouseEvents",click:"stopMouseEvents",dblclick:"stopMouseEvents",thisObj:e}),e.ion({beforeHide:"beforeEditorHide",hide:"afterEditorHide",thisObj:e}),LocaleManager_default.ion({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){const{inputField:e}=this;e&&!e.isDestroyed&&e.syncInputFieldValue&&e.syncInputFieldValue(!0)}render(e){const t=this.element.parentNode,[r]=this.getRenderContext(this,e);r.classList.add("b-editing"),super.render(...arguments),(null==t?void 0:t.classList)&&r!==t&&t.classList.remove("b-editing")}async startEdit(e){var t,r,n;const i=this;if(e=ObjectHelper.assignIf(e,{align:i.align,hideTarget:i.hideTarget,matchSize:i.matchSize,matchFont:i.matchFont,fitTargetContent:i.fitTargetContent,focus:!0}),!1!==i.trigger("beforeStart",e)){const{target:s,hideTarget:a,matchSize:o,matchFont:l,fitTargetContent:c,record:d,field:u=i.inputField.name,focus:h}=e,{inputField:g}=i,{input:p}=g,m=DomHelper.getStyleValue(s,"font-size"),f=DomHelper.getStyleValue(s,"font-family");let{value:v,align:y}=e;if(d&&u&&(i.record=d,i.dataField=u,void 0===v&&(v=d[u])),o&&(s instanceof HTMLElement&&i.updateSize(s,o),s instanceof HTMLElement&&ResizeMonitor.addResizeListener(s,i.onTargetSizeChange)),p&&(l?(p.style.fontSize=m,p.style.fontFamily=f):p.style.fontSize=p.style.fontFamily=""),i.assigningValues=!0,null==(t=g.clearError)||t.call(g),g.value=v?isJSON(v)?"null"==v.name?"":v.name:v:"",i.assigningValues=!1,"string"==typeof y&&(y={align:y}),await i.showBy({target:s,allowTargetOut:!0,...y}),c){const e=p.scrollWidth-p.clientWidth;e>0&&(i.width+=e+DomHelper.scrollBarWidth)}return h&&(null==(r=g.focus)||r.call(g)),s.nodeType===Element.ELEMENT_NODE&&a&&s.classList.add("b-hide-visibility"),i.editing=!0,i.trigger("start",{value:g.value}),Array.isArray(g.value)&&g.editingRecords&&(null==(n=g.value[0])?void 0:n.isModel)?i.oldValue=g.value.map((e=>e.copy(e.id))):(i.oldValue=g.value,Array.isArray(i.oldValue)&&(i.oldValue=i.oldValue.slice())),g.initialValue=i.oldValue,!0}return!1}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:r}=this;if(e&&t){const n=e[t];ObjectHelper.isEqual(r.value,n)||(r.value=n)}}}finishEdit(){const{target:e,aligningToElement:t}=this.lastAlignSpec;t&&(e.classList.remove("b-editing"),e.classList.remove("b-hide-visibility")),this.editing=!1,this.trigger("finishEdit")}onKeyDown(e){var t;const r=this;switch(e.key){case r.completeKey:r.completeEdit(null,e),e.stopImmediatePropagation();break;case r.cancelKey:r.cancelEdit(e),e.stopImmediatePropagation()}null==(t=r.trigger)||t.call(r,"keydown",{event:e})}stopMouseEvents(e){this.allowMouseEvents||e.stopPropagation()}onFocusOut(e){super.onFocusOut(e);const t=this;if(!t.isFinishing&&t.editing)switch(t.blurAction){case"cancel":t.cancelEdit(e);break;case"complete":t.completeEdit(null,e)}}async completeEdit(e,t){var r,n,i,s;const a=this,{inputField:o,oldValue:l,record:c}=a,d=o.invalidAction||(!1===o.allowInvalid?"block":a.invalidAction),{value:u}=o;if(a.isVisible){if(o.isValid||"allow"===d){if(ObjectHelper.isEqual(u,l))return a.cancelEdit(t),!0;{const t={inputField:o,record:c,value:u,oldValue:l};if(!1!==a.trigger("beforeComplete",t)){if(e||(e=t.finalize||(null==(i=t.editorContext)?void 0:i.finalize)),e){let r=await e(t);if(!0===r)a.onEditComplete();else{if(o.setError){const e=r||o.invalidValueError,t=()=>{n(),o.clearError(e)},n=o.ion({change:t,input:t});o.setError(e)}"block"===d?null==(s=o.focus)||s.call(o):"revert"===d&&(o.value=l,r=!0),r=!1}return r}return a.onEditComplete(),!0}null==(n=o.focus)||n.call(o)}}else{if("block"===d)return null==(r=o.focus)||r.call(o),!1;if("revert"===d)return a.cancelEdit(t),!0}return!1}}cancelEdit(e){var t;const r=this,{inputField:n,oldValue:i}=r,{value:s}=n;r.editing&&!r.isFinishing&&!1!==r.trigger("beforeCancel",{value:s,oldValue:i,event:e})&&(null==(t=n.clearError)||t.call(n),r.isFinishing=!0,r.hide(),r.trigger("cancel",{value:s,oldValue:i,event:e}),r.finishEdit(),r.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:r,inputField:n,oldValue:i}=e,{value:s}=n;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e="set"+StringHelper.capitalize(r);t[e]?t[e](s):r.includes(".")?t.set(r,s):t[r]=s}e.trigger("complete",{value:s,oldValue:i}),e.finishEdit(),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||Widget.fromElement(this.element.parentNode)}changeInputField(e,t){const r=this;return t&&t.destroy(),"string"==typeof e&&(e={type:e}),e instanceof Widget||(e=Widget.create(e),r.createdInputField=!0),r.completeOnChange&&e.ion({change:"onInputFieldChange",thisObj:r}),e.parent=r,e}updateInputField(e){this.removeAll(),this.add(e)}get inputField(){return this.items[0]}onInputFieldChange(){this.containsFocus&&this.completeEdit()}onTargetSizeChange(e,t,r){t&&r&&this.updateSize(e)}updateSize(e,t=this.lastMatchSize){const r=this,n=Rectangle.inner(e);r.width=!1===t.width?"auto":n.width-r.align.offset[0],r.height=!1===t.height?"auto":n.height,r.lastMatchSize=t}beforeEditorHide(){if(this.editing&&!this.isFinishing)return this.cancelEdit(),!1}afterEditorHide(){this.positioned&&this.element.remove(),ResizeMonitor.removeResizeListener(this.lastAlignSpec.target,this.onTargetSizeChange)}};__publicField(Editor,"$name","Editor"),__publicField(Editor,"type","editor"),__publicField(Editor,"configurable",{positioned:!0,hidden:!0,layout:"fit",align:{align:"t0-t0",offset:[0,0]},hideTarget:!1,matchSize:!0,matchFont:!0,fitTargetContent:!1,inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",invalidAction:"block",completeOnChange:null,isolateFields:!0}),Editor.initClass(),Editor._$name="Editor";var SUPPORTED_FIELD_DATA_TYPES=["number","boolean","string","date","duration"],isSupportedDurationField=e=>{var t;return"duration"===(null==(t=e.column)?void 0:t.type)},EMPTY_STRING="",_FieldFilterPicker=class extends Container{static get $name(){return"FieldFilterPicker"}static get type(){return"fieldfilterpicker"}static get defaultValueFieldPlaceholders(){return{string:"L{enterAValue}",number:"L{enterANumber}",date:"L{selectADate}",list:"L{selectOneOrMoreValues}",duration:"L{enterAValue}"}}afterConstruct(){const e=this;if(!e._fields)throw new Error(_FieldFilterPicker.name+" 需要配置“字段”");if(!e._filter)throw new Error(_FieldFilterPicker.name+" 需要配置“筛选器”");super.afterConstruct();const{widgetMap:{propertyPicker:t,operatorPicker:r,caseSensitive:n}}=e;t.ion({select:"onPropertySelect",thisObj:e}),r.ion({select:"onOperatorSelect",thisObj:e}),n.ion({change:"onCaseSensitiveChange",thisObj:e}),e.propertyFieldConfig&&t.setConfig(e.propertyFieldConfig),e.operatorFieldConfig&&r.setConfig(e.operatorFieldConfig),t.cls=e.allPropertyPickerClasses,r.cls=e.allOperatorPickerClasses,e.populateUIFromFilter()}changeDateFormat(e){return this.L(e)}get allChildInputs(){const{propertyPicker:e,operatorPicker:t,caseSensitive:r}=this.widgetMap;return[e,t,...this.valueFields,r]}updateDisabled(e){this.allChildInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){const{propertyPicker:t,operatorPicker:r}=this.widgetMap;this.allChildInputs.forEach((t=>t.readOnly=e)),t.readOnly=t.readOnly||e,r.readOnly=r.readOnly||e}updatePropertyLocked(e){this.widgetMap.propertyPicker.readOnly=e||this.readOnly,this.widgetMap.propertyPicker.cls=this.allPropertyPickerClasses}updateOperatorLocked(e){this.widgetMap.operatorPicker.readOnly=e||this.readOnly,this.widgetMap.operatorPicker.cls=this.allOperatorPickerClasses}changeOperators(e){const t=null!=e?e:_FieldFilterPicker.defaultOperators;return Object.keys(t).reduce(((e,r)=>({...e,[r]:t[r].map((e=>({...e,text:this.L(e.text)})))})),{})}changeFields(e){let t=e;return Array.isArray(e)&&(VersionHelper.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption> keyed by field name instead"),t=ArrayHelper.keyBy(t,"name")),t}get isMultiSelectValueField(){var e;return["isIncludedIn","isNotIncludedIn"].includes(null==(e=this._filter)?void 0:e.operator)}get allPropertyPickerClasses(){var e;return new DomClassList("b-"+_FieldFilterPicker.type+"-property",null==(e=this.propertyFieldConfig)?void 0:e.cls,{["b-"+_FieldFilterPicker.type+"-combo-locked"]:this.propertyLocked})}get allOperatorPickerClasses(){var e;return new DomClassList("b-"+_FieldFilterPicker.type+"-operator",null==(e=this.operatorFieldConfig)?void 0:e.cls,{["b-"+_FieldFilterPicker.type+"-combo-locked"]:this.operatorLocked})}getValueFieldConfigs(){const e=this,{valueFieldCls:t,fieldType:r,_filter:{operator:n},onValueChange:i,filterValues:s,isMultiSelectValueField:a,operatorArgCount:o,getValueFieldConfig:l}=e,c=ObjectHelper.merge({},_FieldFilterPicker.defaultValueFieldPlaceholders,e.valueFieldPlaceholders);if(!r||!n||0===o)return[];let d={type:"textfield",internalListeners:{change:i,input:i,thisObj:e},cls:t,dataset:{type:r},placeholder:e.L(c[a?"list":r])};return a?d={...d,type:"combo",multiSelect:!0,createOnUnmatched:!0,items:this.getUniqueDataValues(s),value:null!=s?s:[]}:["number","date","boolean"].includes(r)?d.type=r+"field":"duration"===r&&(d.type="durationfield"),l&&(d=e.callback(l,e,[e.filter,d])),a?[d]:ArrayHelper.populate(o,(t=>[{type:"widget",tag:"div",cls:"b-"+_FieldFilterPicker.type+"-value-separator",content:e.L("L{FieldFilterPicker.and}")},{...d,value:s[t]}])).flat().slice(1)}getUniqueDataValues(e=[]){var t;const r=this,{fieldType:n}=r;if(!r.store||!(null==(t=r._filter)?void 0:t.property))return[];const{relatedDisplayField:i}=r.selectedField;let s,a;if(r.fieldIsRelation){const{foreignStore:e}=r.currentPropertyRelationConfig;i?(s=e.allRecords.reduce(((e,t)=>(null!=t.id&&e.push({text:t[i],value:t.id}),e)),[]),a=s.sort(((e,t)=>r.sortStrings(e.text,t.text)))):s=e.allRecords.map((e=>e.id))}else s=r.store.allRecords.map((e=>e[r._filter.property]));if(!a){s.push(...e);const t=ArrayHelper.unique(s.reduce(((e,t)=>(null!=t&&""!==String(t).trim()&&("date"===n?e.push(t.valueOf()):"duration"===n?e.push(t.toString()):e.push(t)),e)),[]));a="string"===n?t.sort(r.sortStrings):"duration"===n?t.map((e=>new Duration(e))).filter((e=>e.isValid)).sort(r.sortDurations):t.sort(r.sortNumerics),"date"===n?a=a.map((e=>{const t=new Date(e);return{text:DateHelper.format(t,r.dateFormat),value:e}})):"duration"===n&&(a=a.map((e=>e.toString())))}return a}sortStrings(e,t){return(null!=e?e:EMPTY_STRING).localeCompare(null!=t?t:EMPTY_STRING)}sortNumerics(e,t){return e-t}sortDurations(e,t){return e.valueOf()-t.valueOf()}get fieldType(){var e;return null==(e=this.selectedField)?void 0:e.type}get selectedField(){var e,t;return null==(t=this.fields)?void 0:t[null==(e=this._filter)?void 0:e.property]}get propertyOptions(){var e;return Object.entries(null!=(e=this.fields)?e:{}).filter((([,e])=>SUPPORTED_FIELD_DATA_TYPES.includes(e.type)||isSupportedDurationField(e))).map((([e,{title:t}])=>({value:e,text:null!=t?t:e}))).sort(((e,t)=>e.text.localeCompare(t.text)))}get operatorOptions(){return this.operators[this.fieldIsRelation?"relation":this.fieldType]}get fieldIsRelation(){return Boolean(this.currentPropertyRelationConfig)}get currentPropertyRelationConfig(){var e,t;return null==(t=null==(e=this.store)?void 0:e.modelRelations)?void 0:t.find((({foreignKey:e})=>{var t;return e===(null==(t=this._filter)?void 0:t.property)}))}updateOperators(){delete this._operatorArgCountLookup}get operatorArgCountLookup(){return this._operatorArgCountLookup||(this._operatorArgCountLookup=_FieldFilterPicker.buildOperatorArgCountLookup(this.operators))}updateFilter(){this._filter&&this.onFilterChange()}updateStore(e){var t;null==(t=this._store)||t.un(this),null==e||e.ion({refresh:"onStoreRefresh",thisObj:this})}onStoreRefresh({action:e}){this.isMultiSelectValueField&&["dataset","create","update","delete"].includes(e)&&(this.valueFields[0].items=this.getUniqueDataValues(this.filterValues))}refreshValueFields(){const e=this,{valueFieldRow:t}=e.widgetMap;t.removeAll(),t.add(e.getValueFieldConfigs()),delete e._valueFields,e.refreshCaseSensitive()}refreshCaseSensitive(){var e,t;const r=this,{fieldType:n,operatorArgCount:i,isMultiSelectValueField:s}=r,a=null==(e=r._filter)?void 0:e.operator,{caseSensitive:o}=r.widgetMap;o.hidden="string"!==n||!a||s||0===i,o.checked=!1!==(null==(t=r._filter)?void 0:t.caseSensitive)}onPropertySelect(e){var t;const r=this,{_filter:n}=r;n.property=(null==(t=e.record)?void 0:t.data.value)||null,r.fieldType!==r._fieldType&&(n.operator=null,n.value=null),r._fieldType=n.type=r.fieldType,r.refreshOperatorPicker(),r.refreshValueFields(),r.triggerChange()}onCaseSensitiveChange({checked:e}){this._filter.caseSensitive=e,this.triggerChange()}onOperatorSelect(e){var t;const r=this,n=r.isMultiSelectValueField,i=this.operatorArgCount;r._filter.operator=(null==(t=e.record)?void 0:t.data.value)||null,r.operatorArgCount!==i&&(r._filter.value=null),r.isMultiSelectValueField&&!n&&(r._filter.value=[]),r.refreshValueFields(),r.triggerChange()}triggerChange(){const{filter:e,isValid:t}=this;this.trigger("change",{filter:e,isValid:t})}onValueChange(){const{isMultiSelectValueField:e,fieldType:t,_filter:r}=this,n=this.valueFields.map((e=>e.value));e&&"date"===t?r.value=n[0].map((e=>new Date(e))):e&&"duration"===t?r.value=n[0].map((e=>new Duration(e))):("date"===t&&"between"===r.operator&&DateHelper.isValidDate(n[1])&&n[1].setHours(23,59,59,999),r.value=1===n.length?n[0]:n),this.triggerChange()}refreshOperatorPicker(){const{operatorPicker:e}=this.widgetMap,{_filter:{operator:t,property:r},operatorOptions:n}=this;e.items=n,e.value=t,e.hidden=null===r}populateUIFromFilter(e=!1){const t=this,{filterValues:r,widgetMap:{propertyPicker:n,operatorPicker:i},_filter:{property:s,operator:a,disabled:o},propertyOptions:l,operatorOptions:c,isMultiSelectValueField:d}=t;n.items=l,i.items=c,i.hidden=null===s;let u=e;n.value!==s&&(n.value=s,t.refreshOperatorPicker(),u=!0),i.value!==a&&(null===a?i.clear():i.value=a,u=!0),u&&t.refreshValueFields(),t.refreshCaseSensitive(),t.valueFields.forEach(((e,n)=>{d&&(e.value.length>0||r.length>0)?"date"===t.fieldType?e.value=r.map((e=>null==e?void 0:e.valueOf())):"duration"===t.fieldType?e.value=r.map((e=>null==e?void 0:e.toString())):e.value=r:n>=r.length?e.clear():e.value=r[n]})),t.allChildInputs.forEach((e=>e.disabled=t.disabled||o))}get valueFields(){return this._valueFields||(this._valueFields=this.widgetMap.valueFieldRow.queryAll((e=>["textfield","datefield","numberfield","durationfield","combo"].includes(e.type))))}get filterValues(){var e;return null==(null==(e=this._filter)?void 0:e.value)?[]:ArrayHelper.asArray(this._filter.value)}onFilterChange(){const e=this,t=e.fieldType,r=t!==e._fieldType;e._fieldType=e._filter.type=t,e.populateUIFromFilter(r)}get operatorArgCount(){const{fieldType:e,filter:{operator:t},operatorArgCountLookup:r}=this;return e&&t?r[e][t]:1}get isValid(){const{filter:e,fieldType:t,filterValues:r,isMultiSelectValueField:n,operatorArgCount:i}=this,{operator:s}=e,a=i>0&&null==(null==e?void 0:e.value);return t&&s&&!a&&(n&&r.length>0||r.length===i)&&r.every((e=>null!=e&&("duration"!==t||e.isValid)))}},FieldFilterPicker=_FieldFilterPicker;__publicField(FieldFilterPicker,"operators",{empty:{value:"empty",text:"L{isEmpty}",argCount:0},notEmpty:{value:"notEmpty",text:"L{isNotEmpty}",argCount:0},"=":{value:"=",text:"L{equals}"},"!=":{value:"!=",text:"L{doesNotEqual}"},">":{value:">",text:"L{isGreaterThan}"},"<":{value:"<",text:"L{isLessThan}"},">=":{value:">=",text:"L{isGreaterThanOrEqualTo}"},"<=":{value:"<=",text:"L{isLessThanOrEqualTo}"},between:{value:"between",text:"L{isBetween}",argCount:2},notBetween:{value:"notBetween",text:"L{isNotBetween}",argCount:2},isIncludedIn:{value:"isIncludedIn",text:"L{isOneOf}"},isNotIncludedIn:{value:"isNotIncludedIn",text:"L{isNotOneOf}"}}),__publicField(FieldFilterPicker,"defaultOperators",{string:[_FieldFilterPicker.operators.empty,_FieldFilterPicker.operators.notEmpty,_FieldFilterPicker.operators["="],_FieldFilterPicker.operators["!="],{value:"includes",text:"L{contains}"},{value:"doesNotInclude",text:"L{doesNotContain}"},{value:"startsWith",text:"L{startsWith}"},{value:"endsWith",text:"L{endsWith}"},_FieldFilterPicker.operators.isIncludedIn,_FieldFilterPicker.operators.isNotIncludedIn],number:[_FieldFilterPicker.operators.empty,_FieldFilterPicker.operators.notEmpty,_FieldFilterPicker.operators["="],_FieldFilterPicker.operators["!="],_FieldFilterPicker.operators[">"],_FieldFilterPicker.operators["<"],_FieldFilterPicker.operators[">="],_FieldFilterPicker.operators["<="],_FieldFilterPicker.operators.between,_FieldFilterPicker.operators.notBetween,_FieldFilterPicker.operators.isIncludedIn,_FieldFilterPicker.operators.isNotIncludedIn],date:[_FieldFilterPicker.operators.empty,_FieldFilterPicker.operators.notEmpty,_FieldFilterPicker.operators["="],_FieldFilterPicker.operators["!="],{value:"<",text:"L{isBefore}"},{value:">",text:"L{isAfter}"},_FieldFilterPicker.operators.between,{value:"isToday",text:"L{isToday}",argCount:0},{value:"isTomorrow",text:"L{isTomorrow}",argCount:0},{value:"isYesterday",text:"L{isYesterday}",argCount:0},{value:"isThisWeek",text:"L{isThisWeek}",argCount:0},{value:"isNextWeek",text:"L{isNextWeek}",argCount:0},{value:"isLastWeek",text:"L{isLastWeek}",argCount:0},{value:"isThisMonth",text:"L{isThisMonth}",argCount:0},{value:"isNextMonth",text:"L{isNextMonth}",argCount:0},{value:"isLastMonth",text:"L{isLastMonth}",argCount:0},{value:"isThisYear",text:"L{isThisYear}",argCount:0},{value:"isNextYear",text:"L{isNextYear}",argCount:0},{value:"isLastYear",text:"L{isLastYear}",argCount:0},{value:"isYearToDate",text:"L{isYearToDate}",argCount:0},_FieldFilterPicker.operators.isIncludedIn,_FieldFilterPicker.operators.isNotIncludedIn],boolean:[{value:"isTrue",text:"L{isTrue}",argCount:0},{value:"isFalse",text:"L{isFalse}",argCount:0}],duration:[_FieldFilterPicker.operators.empty,_FieldFilterPicker.operators.notEmpty,_FieldFilterPicker.operators["="],_FieldFilterPicker.operators["!="],_FieldFilterPicker.operators[">"],_FieldFilterPicker.operators["<"],_FieldFilterPicker.operators[">="],_FieldFilterPicker.operators["<="],_FieldFilterPicker.operators.between,_FieldFilterPicker.operators.notBetween,_FieldFilterPicker.operators.isIncludedIn,_FieldFilterPicker.operators.isNotIncludedIn],relation:[_FieldFilterPicker.operators.isIncludedIn,_FieldFilterPicker.operators.isNotIncludedIn]}),__publicField(FieldFilterPicker,"configurable",{fields:null,disabled:!1,readOnly:!1,layout:"vbox",propertyLocked:!1,operatorLocked:!1,filter:null,propertyFieldConfig:null,operatorFieldConfig:null,valueFieldCls:null,items:{propertyAndOperator:{type:"container",layout:"box",items:{propertyPicker:{type:"combo",items:{},cls:"b-"+_FieldFilterPicker.type+"-property",placeholder:"L{FieldFilterPicker.selectAProperty}"},operatorPicker:{type:"combo",items:{},cls:"b-"+_FieldFilterPicker.type+"-operator",placeholder:"L{FieldFilterPicker.selectAnOperator}"}}},valueFieldRow:{type:"container",cls:"b-"+_FieldFilterPicker.type+"-values",items:{}},caseSensitive:{type:"checkbox",text:"L{FieldFilterPicker.caseSensitive}",cls:"b-"+_FieldFilterPicker.type+"-case-sensitive"}},operators:_FieldFilterPicker.defaultOperators,dateFormat:"L{FieldFilterPicker.dateFormat}",store:null,valueFieldPlaceholders:null,getValueFieldConfig:null}),__publicField(FieldFilterPicker,"buildOperatorArgCountLookup",(e=>ArrayHelper.keyBy(Object.entries(e),(([e])=>e),(([,e])=>ArrayHelper.keyBy(e,(({value:e})=>e),(({argCount:e})=>void 0===e?1:e)))))),FieldFilterPicker.initClass(),FieldFilterPicker._$name="FieldFilterPicker";var Label=class extends Widget{compose(){const{text:e,html:t}=this;return{tag:"label",text:e,html:t}}};__publicField(Label,"$name","Label"),__publicField(Label,"type","label"),__publicField(Label,"configurable",{text:null,localizableProperties:["text"]}),Label.initClass(),Label._$name="Label";var _FieldFilterPickerGroup=class extends Container{static get $name(){return"FieldFilterPickerGroup"}static get type(){return"fieldfilterpickergroup"}afterConstruct(){const e=this;e.validateConfig();const{addFilterButton:t}=e.widgetMap;t.ion({click:"addFilter",thisObj:e}),t.text=e.L(t.text),e.store&&e.updateStore(e.store),super.afterConstruct()}changeDateFormat(e){return this.L(e)}validateConfig(){if(!this.fields&&!this.store)throw new Error("FieldFilterPickerGroup需要“fields”或“store”配置属性")}get someFiltersNotShown(){return this.store&&this.store.filters.count>this.filters.length}updateFields(e){this.widgetMap.pickers.childItems.forEach((t=>t.fields=e))}updateFilters(e,t){const r=this;t&&t.filter((t=>!e.find((e=>e.id===t.id)))).forEach((e=>{var t;return null==(t=r.store)?void 0:t.removeFilter(e.id)})),e.forEach((e=>e.id=e.id||r.nextFilterId)),r.widgetMap.pickers.items=(null==e?void 0:e.map((e=>r.getPickerRowConfig(e))))||[]}changeFilters(e){const{canManageFilter:t}=this;return e&&t?e.filter((e=>this.callback(t,this,[e]))):e}updateStore(e){const t=this;t.detachListeners("store"),e&&(t.widgetMap.pickers.childItems.forEach((({widgetMap:{filterPicker:{filter:t,isValid:r}}})=>{e.removeFilter(t.id,!0),r&&e.addFilter(t,!0)})),e.filter(),t.appendFiltersFromStore(),e.ion({name:"store",filter:"onStoreFilter",thisObj:t})),t.widgetMap.pickers.childItems.forEach((t=>t.store=e))}updateShowAddFilterButton(e){this.widgetMap.addFilterButton.hidden=!e}updateAddFilterButtonText(e){this.widgetMap.addFilterButton.text=null!=e?e:_FieldFilterPickerGroup.addFilterButtonDefaultText}appendFiltersFromStore(){const e=this;e.store.filters.forEach((t=>{var r;const n=e.canManage(t),{property:i,operator:s,value:a,id:o,disabled:l=!1,caseSensitive:c}=t;n&&i&&s&&!(null==(r=e.filters)?void 0:r.find((e=>e.id===o)))&&e.appendFilter({id:o,property:i,operator:s,value:a,disabled:l,caseSensitive:c})}))}canManage(e){const t=this;return!t.canManageFilter||!0===t.callback(t.canManageFilter,t,[e])}getFilterPickerConfig(e){const t=this,{fields:r,store:n,disabled:i,readOnly:s,valueFieldCls:a,operators:o,limitToProperty:l,dateFormat:c,getFieldFilterPickerConfig:d}=t;return{type:t.constructor.childPickerType,fields:null!=r?r:t.getFieldsFromStore(n),filter:e,store:n,disabled:i,readOnly:s,propertyLocked:Boolean(l),valueFieldCls:a,operators:o,dateFormat:c,internalListeners:{change:"onFilterPickerChange",thisObj:t},flex:1,...d?t.callback(d,t,[e]):void 0}}getFieldsFromStore(e){var t,r;return Object.fromEntries(null!=(r=null==(t=e.fields)?void 0:t.map((({name:e,type:t})=>[e,{type:t}])))?r:[])}getPickerRowConfig(e){const t=this,{disabled:r,readOnly:n,canDeleteFilter:i}=t;return{type:"container",layout:"box",layoutStyle:{alignItems:"start"},cls:"b-"+_FieldFilterPickerGroup.type+"-row",dataset:{separatorText:t.L("L{FieldFilterPicker.and}")},items:{activeCheckbox:{type:"checkbox",disabled:r,readOnly:n,checked:!Boolean(e.disabled),internalListeners:{change:"onFilterActiveChange",thisObj:t},cls:"b-"+_FieldFilterPickerGroup.type+"-filter-active"},filterPicker:t.getFilterPickerConfig(e),removeButton:{type:"button",ref:"removeButton",disabled:r,readOnly:n,hidden:i&&!1===t.callback(i,t,[e]),cls:"b-transparent b-"+_FieldFilterPickerGroup.type+"-remove",icon:"b-fa-trash",internalListeners:{click:"removeFilter",thisObj:t}}}}}get allInputs(){const e=[this.constructor.childPickerType,"button","checkbox"];return this.queryAll((t=>e.includes(t.type)))}updateDisabled(e){this.allInputs.forEach((t=>t.disabled=e))}updateReadOnly(e){this.allInputs.forEach((t=>t.readOnly=e))}onFilterActiveChange({source:e,checked:t}){const r=this,n=r.getFilterIndex(e),i=r.filters[n],s=r.getFilterPicker(n);i.disabled=!t,s.onFilterChange(),r.store&&s.isValid&&r.store.addFilter(i,!0),r.updateStoreFilter(),r.triggerChange()}onFilterPickerChange({source:e,filter:t,isValid:r}){const n=this,{store:i}=n,s=n.getFilterIndex(e);i&&(i.removeFilter(t.id,!0),r&&i.addFilter(t,!0),n.updateStoreFilter()),Object.assign(n.filters[s],t),n.triggerChange()}getFilterIndex(e){return this.widgetMap.pickers.childItems.indexOf(e.containingWidget)}getPickerRow(e){return this.widgetMap.pickers.childItems[e]}getFilterPicker(e){return this.getPickerRow(e).widgetMap.filterPicker}get nextFilterId(){return this._nextId=(this._nextId||0)+1,this.id+"-filter-"+this._nextId}removeFilter({source:e}){const t=this,r=t.getFilterIndex(e),n=t.filters[r],i=t.getPickerRow(r),s=t.query((e=>e.isFocusable&&"container"!==e.type&&!i.contains(e)));s&&s.focus(),t.removeFilterAt(r),t.store&&(t.store.removeFilter(n.id,!0),t.updateStoreFilter()),t.trigger("remove",{filter:n}),t.triggerChange()}addFilter({property:e=null,operator:t=null,value:r=null}={}){var n;const i=this,{filters:s}=i,a={property:i.limitToProperty||e,operator:t,value:r,disabled:!1,id:i.nextFilterId,caseSensitive:!1};i.appendFilter(a),i.getFilterPicker(s.length-1).isValid&&(null==(n=i.store)||n.addFilter(a,!0),i.store&&i.updateStoreFilter()),i.trigger("add",{filter:a}),i.triggerChange()}appendFilter(e){const t=this;t.limitToProperty&&e.property!==t.limitToProperty||(t.filters.push(e),t.widgetMap.pickers.add(t.getPickerRowConfig(e,t.filters.length-1)))}onStoreFilter(e){const t=this;if(t._isUpdatingStore)return;const{filters:r}=e,n=r.values.reduce(((e,t)=>({...e,[t.id]:t})),{});for(let e=t.filters.length-1;e>=0;e--){const r=t.filters[e],i=n[r.id],s=t.getPickerRow(e);if(s){const{filterPicker:n,activeCheckbox:a}=s.widgetMap;if(!i&&n.isValid)t.removeFilterAt(e);else if(void 0!==i){const{operator:e,value:t,property:s,disabled:o,caseSensitive:l}=i;r!==i&&Object.assign(r,{operator:e,value:t,property:s,disabled:o,caseSensitive:l}),n.filter=r,n.onFilterChange(),a.checked=!o}}}t.appendFiltersFromStore(),t.triggerChange()}removeFilterAt(e){const{widgetMap:{pickers:t},filters:r}=this;t.remove(t.childItems[e]),r.splice(e,1),this.triggerChange()}updateStoreFilter(){this._isUpdatingStore=!0,this.store.filter(),this._isUpdatingStore=!1}get value(){return this.filters}triggerChange(){this.trigger("change",{filters:this.value})}activateAll(){this.setAllActiveStatus(!0)}deactivateAll(){this.setAllActiveStatus(!1)}setAllActiveStatus(e){const t=this,{_filters:r,store:n}=t;r.forEach(((r,i)=>{if(e===r.disabled){const{filterPicker:s,activeCheckbox:a}=t.getPickerRow(i).widgetMap;r.disabled=!e,s.onFilterChange(),a.checked=e,e&&n&&s.isValid&&n.addFilter(r,!0)}})),t.updateStoreFilter()}},FieldFilterPickerGroup=_FieldFilterPickerGroup;__publicField(FieldFilterPickerGroup,"addFilterButtonDefaultText","L{FieldFilterPickerGroup.addFilter}"),__publicField(FieldFilterPickerGroup,"configurable",{filters:[],fields:null,disabled:!1,readOnly:!1,layout:"vbox",store:null,limitToProperty:null,valueFieldCls:null,showAddFilterButton:!0,canDeleteFilter:null,getFieldFilterPickerConfig:null,canManageFilter:null,addFilterButtonText:null,items:{pickers:{type:"container",layout:"vbox",scrollable:!0,items:{}},addFilterButton:{type:"button",text:_FieldFilterPickerGroup.addFilterButtonDefaultText,cls:"b-"+_FieldFilterPickerGroup.type+"-add-button",hidden:!0}},operators:null,dateFormat:"L{FieldFilterPicker.dateFormat}"}),__publicField(FieldFilterPickerGroup,"childPickerType","fieldfilterpicker"),FieldFilterPickerGroup.initClass(),FieldFilterPickerGroup._$name="FieldFilterPickerGroup";var FieldSet=class extends(Panel.mixin(Labelable_default)){static get $name(){return"FieldSet"}static get type(){return"fieldset"}static get configurable(){return{bodyTag:"fieldset",focusable:!1,inline:null,inlineInternal:null,layout:{type:"box",horizontal:!1}}}static get prototypeProperties(){return{flexRowCls:"b-hbox",flexColCls:"b-vbox"}}get bodyConfig(){const e=super.bodyConfig,{className:t}=e,{inlineInternal:r,hasLabel:n,title:i}=this;return delete e.html,t["b-inline"]=r,t["b-fieldset-has-label"]=n,i&&(e.children={legendElement:{tag:"legend",text:i,class:{"b-fieldset-legend":1}}}),e}compose(){const{inlineInternal:e,label:t,labelCls:r,labelWidth:n}=this;return{class:{"b-field":t,"b-vbox":!e},children:{"labelElement > headerElement":t?{tag:"label",html:t,class:{"b-label":1,"b-align-start":1,[r]:r},style:{width:DomHelper.unitize("width",n)[1]}}:null}}}syncInlineInternal(){var e;this.inlineInternal=null!=(e=this.inline)?e:null!=this.label&&"before"===this.labelPosition}updateDisabled(e,t){super.updateDisabled(e,t),this.eachWidget((t=>{t.disabled=e}),!1)}updateInline(){this.syncInlineInternal()}updateInlineInternal(e){this.layout.horizontal=e}updateLabel(){this.syncInlineInternal()}updateLabelPosition(){this.syncInlineInternal()}};FieldSet.initClass(),FieldSet._$name="FieldSet";var FileField=class extends Field{static get $name(){return"FileField"}static get type(){return"filefield"}static get configurable(){return{multiple:null,accept:null,inputType:"file",attributes:["multiple","accept"]}}get files(){return this.input.files}pickFile(){this.input.click()}get multiple(){return this._multiple?"":null}clear(){this.input.value=null}triggerChange(e){this.triggerFieldChange({event:e,value:this.input.value,oldValue:this._lastValue,userAction:!0,valid:!0})}};FileField.initClass(),FileField._$name="FileField";var FilePicker=class extends Container{static get $name(){return"FilePicker"}static get type(){return"filepicker"}static get defaultConfig(){return{defaultBindProperty:"value",buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"L{FilePicker.file}",localeClass:this},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.ion({click:t.onButtonClick,thisObj:t}),t.fileField.ion({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new Tooltip({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",internalListeners:{beforeshow(){const t=this,r=e.files;return!(!r||!r.length)&&(t.html=""+Array.from(r).map((e=>e.name)).join("<br>"),!0)}}}))}clear(){const e=this;e.fileField.clear(),e.button.badge="",e.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange({valid:e}){const t=this;t.button.badge=t.files.length||"",t.triggerFieldChange({files:t.files,valid:e})}};FilePicker.initClass(),FilePicker._$name="FilePicker";var FilterField=class extends TextField{static get $name(){return"FilterField"}static get type(){return"filterfield"}static get configurable(){return{field:null,store:null,filterFunction:null,clearable:!0,revertOnEscape:!0,keyStrokeChangeDelay:100,onChange({value:e}){const{store:t,field:r,filterFunction:n}=this;if(t){const i=(r||this.id)+"-Filter";if(0===e.length)t.removeFilter(i);else{let s;n?s=t=>n(t,e):(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=t=>t.get(r).match(new RegExp(e,"i"))),t.filter({id:i,filterBy:s})}}}}}updateValue(e,t){super.updateValue(e,t),e&&this.isConfiguring&&this.onChange({value:e})}};FilterField.initClass(),FilterField._$name="FilterField";var items=[{ref:"cancelButton",cls:"b-messagedialog-cancelbutton b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick"},{ref:"okButton",cls:"b-messagedialog-okbutton b-raised b-blue",text:"L{Object.Ok}",onClick:"up.onOkClick"}];BrowserHelper.isWindows&&items.reverse();var MessageDialogConstructor=class extends Popup{static get $name(){return"MessageDialog"}static get type(){return"messagedialog"}static get configurable(){return{centered:!0,modal:!0,hidden:!0,autoShow:!1,closeAction:"hide",title:" ",lazyItems:{$config:["lazy"],value:[{cls:"b-messagedialog-message",ref:"message"},{type:"textfield",cls:"b-messagedialog-input",ref:"input"}]},showClass:null,bbar:{overflow:null,items:items}}}construct(){this.okButton=this.yesButton=1,this.cancelButton=3,super.construct(...arguments)}destroy(){}async confirm(){return this.showDialog("confirm",...arguments)}async alert(){return this.showDialog("alert",...arguments)}async prompt({textField:e}){const t=this.widgetMap.input;return Widget.reconfigure(t,e),t.value="",this.showDialog("prompt",...arguments)}showDialog(e,{message:t="",title:r=" ",cancelButton:n,okButton:i,rootElement:s=document.body}){const a=this;return a.rootElement=s,a.getConfig("lazyItems"),a.title=a.optionalL(r),a.widgetMap.message.html=a.optionalL(t),a.showClass="b-messagedialog-"+e,i&&(i="string"==typeof i?{text:i}:i),n&&(n="string"==typeof n?{text:n}:n),i=Object.assign({},a.widgetMap.okButton.initialConfig,i),n=Object.assign({},a.widgetMap.cancelButton.initialConfig,n),i.text=a.optionalL(i.text),n.text=a.optionalL(n.text),Widget.reconfigure(a.widgetMap.okButton,i),Widget.reconfigure(a.widgetMap.cancelButton,n),a.show(),a.promise=new Promise((e=>{a.resolve=e}))}show(){const e=DomHelper.getActiveElement(this.element);return this.owner=this.element.contains(e)?null:MessageDialogConstructor.fromElement(document.activeElement),super.show(...arguments)}updateShowClass(e,t){const{classList:r}=this.element;t&&r.remove(t),e&&r.add(e)}doResolve(e){const t=this,{resolve:r}=t;if(r){const n="b-messagedialog-prompt"===t.showClass;if(n&&e===t.okButton&&!t.widgetMap.input.isValid)return;t.resolve=t.reject=t.promise=null,r(n?{button:e,text:t.widgetMap.input.value}:e),t.hide()}}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.onCancelClick()),"Enter"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),this.onOkClick()),super.onInternalKeyDown(e)}onOkClick(){this.doResolve(MessageDialog.okButton)}onCancelClick(){this.doResolve(MessageDialog.cancelButton)}};MessageDialogConstructor.initClass();var MessageDialog=new Proxy({},{get(e,t){const r=e.instance||(e.instance=new MessageDialogConstructor({rootElement:document.body})),n=r[t];return"function"==typeof n?n.bind(r):n}}),MessageDialog_default=MessageDialog,PagingToolbar=class extends Toolbar{static get $name(){return"PagingToolbar"}static get type(){return"pagingtoolbar"}static get defaultConfig(){return{store:null,defaults:{localeClass:this},items:{firstPageButton:{onClick:"up.onFirstPageClick",icon:"gt-icon-first",weight:100,tooltip:"L{PagingToolbar.firstPage}"},previousPageButton:{onClick:"up.onPreviousPageClick",icon:"gt-icon-previous",weight:110,tooltip:"L{PagingToolbar.prevPage}"},pageNumber:{type:"numberfield",label:"L{page}",min:1,max:1,triggers:null,onChange:"up.onPageNumberChange",highlightExternalChange:!1,weight:120},pageCount:{type:"widget",cls:"b-pagecount b-toolbar-text",weight:130},nextPageButton:{onClick:"up.onNextPageClick",icon:"gt-icon-next",weight:140,tooltip:"L{PagingToolbar.nextPage}"},lastPageButton:{onClick:"up.onLastPageClick",icon:"gt-icon-last",weight:150,tooltip:"L{PagingToolbar.lastPage}"},separator:{type:"widget",cls:"b-toolbar-separator",weight:151},reloadButton:{onClick:"up.onReloadClick",icon:"gt-icon-reload",weight:160,tooltip:"L{PagingToolbar.reload}"},spacer:{type:"widget",cls:"b-toolbar-fill",weight:161},dataSummary:{type:"widget",cls:"b-toolbar-text",weight:170}}}}set parent(e){super.parent=e,this.store||(this.store=e.store)}get parent(){return super.parent}set store(e){const t=this;t.detachListeners("store"),t._store=e,e&&(e.ion({name:"store",beforerequest:"onStoreBeforeRequest",afterrequest:"onStoreChange",change:"onStoreChange",thisObj:t}),e.isLoading&&t.onStoreBeforeRequest())}get store(){return this._store}onStoreBeforeRequest(){this.eachWidget((e=>e.disable()))}updateLocalization(){this.updateSummary(),super.updateLocalization()}updateSummary(){const e=this,{pageCount:t,dataSummary:r}=e.widgetMap;let n=0,i=0,s=0,a=0,o=0;if(e.store){const{store:t}=e,{pageSize:r,currentPage:l}=t;n=t.count,i=t.lastPage,o=t.allCount,s=Math.max(0,(l-1)*r+1),a=Math.min(o,s+r-1)}t.html=e.L("L{pageCountTemplate}")({lastPage:i}),r.html=n?e.L("L{summaryTemplate}")({start:s,end:a,allCount:o}):e.L("L{noRecords}")}onStoreChange(){const e=this,{widgetMap:t,store:r}=e,{count:n,lastPage:i,currentPage:s}=r,{pageNumber:a,pageCount:o,firstPageButton:l,previousPageButton:c,nextPageButton:d,lastPageButton:u,dataSummary:h}=t;e.eachWidget((e=>e.enable())),a.value=s,a.max=i,h.disabled=a.disabled=o.disabled=!n,l.disabled=c.disabled=s<=1||!n,d.disabled=u.disabled=s>=i||!n,e.updateSummary()}onPageNumberChange({value:e}){this.store.currentPage!==e&&this.store.loadPage(e)}onFirstPageClick(){this.store.loadPage(1)}onPreviousPageClick(){this.store.previousPage()}onNextPageClick(){this.store.nextPage()}onLastPageClick(){this.store.loadPage(this.store.lastPage)}onReloadClick(){this.store.loadPage(this.store.currentPage)}};PagingToolbar.initClass(),PagingToolbar._$name="PagingToolbar";var{dockIsHorz:dockIsHorz2}=PanelCollapser.maps,collapseExposeEdge={top:0,down:0,left:1,bottom:2,up:2,right:3},emptyObject9={},translateByDir={up:{from:"translate(0,0)",to:"translate(0,-100%)"},down:{from:"translate(0,0)",to:"translate(0,100%)"},left:{from:"translate(0,0)",to:"translate(-100%,0)"},right:{from:"translate(0,0)",to:"translate(100%,0)"}},PanelCollapserOverlay=class extends(PanelCollapser.mixin(Delayable_default)){static get $name(){return"PanelCollapserOverlay"}static get type(){return"overlay"}static get configurable(){return{autoCloseDelay:1e3,autoClose:!0,revealing:{value:null,$config:null,default:!1},recollapseTool:{type:"collapsetool",cls:"b-recollapse",collapsify:"overlay",handler(){var e;null==(e=this.collapsible)||e.toggleReveal()}}}}static get delayable(){return{doAutoClose:0}}doAutoClose(){this.toggleReveal(!1)}updateAutoCloseDelay(e){const{doAutoClose:t}=this;(t.suspended=null==e||e<0)||(t.delay=e,t.immediate=!e)}changeRecollapseTool(e){const t=this,{panel:r}=t;if(t.isConfiguring||t.isDestroying||!r||r.isDestroying)return e;r.tools={recollapse:e}}beforeCollapse(e){if(!1===super.beforeCollapse(e))return!1;this.panel.revealed&&(e.animation=null)}applyHeaderDock(e,t=!0){var r;null==(r=this.panel)||r.recompose(),super.applyHeaderDock(e,t)}collapseBegin(e){const t=this,{collapseDir:r,innerElement:n}=t,{animation:i}=e,{collapseTool:s,panel:a}=t;t.configuredWidth=a._lastWidth,t.configuredHeight=a._lastHeight,t.applyHeaderDock(!0),t.lockInnerSize(),null==s||s.element.classList.add("b-collapsed"),i&&(a.element.classList.add("b-collapsing"),i.element=n,i.transform=translateByDir[r],e.animation=Animator.run(i))}onComplete(e){var t,r;super.onComplete(e);const n=this,{panel:i}=n,{element:s}=i;n.autoCloseLeaveDetacher=null==(t=n.autoCloseLeaveDetacher)?void 0:t.call(n),n.autoCloseClickDetacher=null==(r=n.autoCloseClickDetacher)?void 0:r.call(n),n.doAutoClose.cancel(),"reveal"===e&&n.autoClose&&(i.containsFocus&&(n.autoCloseLeaveDetacher=EventHelper.on({element:s,mouseenter:e=>{n.doAutoClose.cancel()},mouseleave:e=>{n.doAutoClose()}})),n.autoCloseClickDetacher=EventHelper.on({element:document.body,thisObj:i,mousedown:e=>{var t;if(e.target!==s&&!s.contains(e.target)&&null!=n.autoCloseDelay){const r=i.containsFocus&&(null==(t=i.focusInEvent)?void 0:t.relatedTarget)||DomHelper.getActiveElement(s);(null==r?void 0:r.contains(e.target))||n.doAutoClose.now()}}}))}expandBegin(e){const t=this,{animation:r}=e,{collapseDir:n,collapseTool:i,innerElement:s,panel:a}=t,{element:o}=a;o.classList.remove("b-collapsed","b-collapsing"),t.restoreConfiguredSize(),t.lockInnerSize(!1),t.lockInnerSize(),null==i||i.element.classList.remove("b-collapsed"),r&&(o.classList.add("b-collapsed","b-expanding"),r.element=s,r.transform={from:translateByDir[n].to,to:translateByDir[n].from},e.animation=Animator.run(r))}expandEnd(e){super.expandEnd(e);const{panel:t}=this;e.completed&&(t.revealed=!1),t.element.classList.remove("b-expanding")}expandRevert(e){super.expandRevert(e),this.panel.element.classList.add("b-expanding")}get innerElement(){return this.panel.overlayElement}get innerSizeElement(){return this.panel.element}get toolsConfig(){const{direction:e}=this,t=super.toolsConfig,r=this.recollapseTool;return r?{...t,recollapse:r&&ObjectHelper.assign({direction:e.toLowerCase()},r)}:t}lockInnerSize(e=!0){const t=this,{panel:r}=t,n=e&&r.rectangle(),i=e?[0,0,0,0]:"",s=super.lockInnerSize(e);return e&&(i[collapseExposeEdge[t.collapseDir]]="-"+(n[t.collapseDim]+10)+"px"),r.element.style.clipPath=e?"inset("+i.join(" ")+")":"",s}onOverlayTransitionDone(e){const t=this,{panel:r}=t;e.srcElement===r.overlayElement&&t.revealing&&(t.revealing=!1,t.onComplete(r.revealed?"reveal":"unreveal"))}onRevealerClick(){this.toggleReveal()}splitHeaderItems({as:e,dock:t}=emptyObject9){var r;return null==(r=this.panel)?void 0:r.splitHeaderItems({as:e,dock:t,overlay:!0})}toggleReveal(e){const{panel:t}=this,{element:r}=t;t.collapsed&&(null==e&&(e=!t.revealed),t.revealed!==e&&!1!==t.trigger("beforeToggleReveal",{reveal:e})&&(!e&&r.contains(DomHelper.getActiveElement(r))&&t.revertFocus(!0),this.revealing=!0,t.revealed=e))}updateRevealing(e){const t=this,{panel:r}=t,n=/left|right/i.test(t.collapseDir)?"height":"width";r&&(t.innerElement.style[n]="0px",t.innerElement.style["min-"+n]="100%",r.element.classList[e?"add":"remove"]("b-panel-overlay-revealing"))}wrapCollapser(e,t){var r;const n=this,{collapseDir:i,panel:s}=n,{expandedHeaderDock:a,header:o,uiClassList:l}=s,c=null==(r=s.tools)?void 0:r.recollapse,[d,u]=n.splitHeaderItems({dock:n.collapseDock,as:"element"}),h=dockIsHorz2[a],g=s.hasHeader?s.title||(null==o?void 0:o.title)||" ":null;return c&&(c.direction=i),["overlayElement",{class:{...l,["b-panel-overlay-header-"+a]:1,["b-panel-overlay-"+i]:1,["b-"+(h?"h":"v")+"box"]:1,"b-panel-overlay":1,"b-box-center":1},listeners:{transitionend:e=>n.onOverlayTransitionDone(e)},children:{overlayHeaderElement:g&&{tag:"header",class:new DomClassList({...l,["b-dock-"+a]:1,"b-panel-header":1,"b-panel-overlay-header":1},null==o?void 0:o.cls),children:[...d,{reference:"overlayTitleElement",html:g,class:{...l,["b-align-"+((null==o?void 0:o.titleAlign)||"start")]:1,"b-header-title":1}},...u]},[e]:t}}]}};PanelCollapserOverlay.initClass(),PanelCollapserOverlay._$name="PanelCollapserOverlay";var PasswordField=class extends Field{static get type(){return"passwordfield"}static get alias(){return"password"}static get $name(){return"PasswordField"}construct(e={}){e.inputType="password",super.construct(...arguments),this.element.classList.add("b-textfield")}};PasswordField.initClass(),PasswordField._$name="PasswordField";var Radio=class extends Checkbox{static get $name(){return"Radio"}static get type(){return"radio"}static get alias(){return"radiobutton"}static get configurable(){return{inputType:"radio",clearable:null,uncheckedValue:void 0}}get textLabelCls(){return super.textLabelCls+" b-radio-label"}internalOnClick(e){!1!==super.internalOnClick(e)&&this.checked&&this.clearable&&(this.checked=!1)}updateName(e){this.toggleGroup=e}updateClearable(){}};Radio.initClass(),Radio._$name="Radio";var RadioGroup=class extends FieldSet{static get $name(){return"RadioGroup"}static get type(){return"radiogroup"}static get configurable(){return{defaultType:"radio",clearable:null,name:null,options:{value:null,$config:{merge:"items"}},defaultBindProperty:"value"}}get existingOptions(){const{name:e}=this;return this.ensureItems().filter((t=>t.name===e))}get refPrefix(){return(this.name||this.ref||this.id)+"_"}get selected(){return this.existingOptions.filter((e=>e.input.checked))[0]||null}get value(){const{selected:e}=this;return e?e.checkedValue:null}set value(e){this.existingOptions.forEach((t=>{t.isConfiguring=this.isConfiguring,t.checked=t.checkedValue===e,t.isConfiguring=!1}))}ensureItems(){return this.getConfig("options"),super.ensureItems()}changeOptions(e,t){if(!(e&&t&&ObjectHelper.isDeeplyEqual(t,e)))return e}convertOption(e,t,r){const n=this,{name:i}=n,s={name:i,type:"radio",value:e===n.value,ref:""+n.refPrefix+e,checkedValue:e};return"string"==typeof t?s.text=t:ObjectHelper.assign(s,t),r?Widget.reconfigure(r,s):s}isOurRadio(e){return e.isRadio&&e.name===this.name}isolateFieldChange(e){return this.isOurRadio(e)}onChildAdd(e){super.onChildAdd(e),this.isOurRadio(e)&&e.ion({name:e.id,beforeChange:"onRadioItemBeforeChange",change:"onRadioItemChange",click:"onRadioClick",thisObj:this})}onChildRemove(e){this.isOurRadio(e)&&this.detachListeners(e.id),super.onChildRemove(e)}onRadioClick(e){const{source:t}=e;t.checked&&this.clearable&&null==t.clearable&&(t.checked=!1)}onRadioItemBeforeChange(e){if(e.checked){const t=this,{lastValue:r}=t;if(!t.reverting&&!1===t.trigger("beforeChange",t.wrapRadioEvent(e))&&null!=r&&r!==t.value)return t.reverting=!0,e.source.uncheckToggleGroupMembers(),t.value=r,t.lastValue=r,t.reverting=!1,!1}}onRadioItemChange(e){const t=this;e.checked&&!t.reverting&&(t.triggerFieldChange(t.wrapRadioEvent(e)),t.lastValue=t.value)}wrapRadioEvent(e){return{from:e,item:e.source,userAction:e.userAction,lastValue:this.lastValue,value:this.value}}updateOptions(){const e=this,{options:t,refPrefix:r}=e,n=e.existingOptions.reduce(((e,t)=>(e[t.ref.substring(r.length)]=t,e)),{});let i,s,a=0;if(t)for(i in t)s=e.convertOption(i,t[i],n[i]),delete n[i],e.insert(s,a++);const o=Object.values(n);(null==o?void 0:o.length)&&(e.remove(o),o.forEach((e=>e.destroy())))}};RadioGroup.initClass(),RadioGroup._$name="RadioGroup";var arrowKeys={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},Slider=class extends Widget{static get $name(){return"Slider"}static get type(){return"slider"}static get configurable(){return{text:null,showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:50,unit:null,thumbSize:20,tooltip:{$config:["lazy","nullify"],value:{type:"tooltip",align:"b-t",anchor:!1,axisLock:!0}},localizableProperties:["text"],triggerChangeOnInput:null,defaultBindProperty:"value"}}compose(){const{id:e,min:t,max:r,showValue:n,step:i,text:s,value:a,unit:o="",disabled:l}=this,c=e+"-input",d=Boolean(s||n);return{class:{"b-has-label":d,"b-text":d,"b-disabled":l},children:{input:{tag:"input",type:"range",id:c,reference:"input",disabled:l,min:t,max:r,step:i,value:a,listeners:{input:"onInternalInput",change:"onInternalChange",mouseover:"onInternalMouseOver",mouseout:"onInternalMouseOut"}},label:{tag:"label",for:c,html:n?s?s+" ("+a+o+")":a+o:s}}}}get focusElement(){return this.input}get percentProgress(){return(this.value-this.min)/(this.max-this.min)*100}onInternalKeyDown(e){!this.readOnly&&arrowKeys[e.key]&&e.stopImmediatePropagation()}onInternalChange(){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalInput(){const e=this;e.readOnly?e.input.value=e.value:(e.value=parseInt(e.input.value,10),e.trigger("input",{value:e.value}),e.triggerChangeOnInput&&e.triggerChange(e))}onInternalMouseOver(){var e;const t=this,r=t.rtl?100-t.percentProgress:t.percentProgress;null==(e=t.tooltip)||e.showBy({target:Rectangle.from(t.input).inflate(t.thumbSize/2,-t.thumbSize/2),align:"b-t"+Math.round(r)})}onInternalMouseOut(){var e;null==(e=this.tooltip)||e.hide()}triggerChange(e){this.triggerFieldChange({value:this.value,valid:!0,userAction:e})}updateMax(e){const t=this;t.input&&t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))}updateMin(e){const t=this;t.input&&t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))}changeTooltip(e,t){var r;return e&&(e.owner=this),this.showTooltip?Tooltip.reconfigure(t,e,{owner:this,defaults:{forElement:this.input,html:String(this.value)+(null!=(r=this.unit)?r:"")}}):null}changeValue(e){const{min:t,step:r}=this;return(e=Math.min(Math.max(e,t),this.max))>t?t+ObjectHelper.roundTo(e-t,r):ObjectHelper.roundTo(e,r)}updateValue(e){var t;const r=this,{input:n,_tooltip:i}=r;i&&(i.html=r.value+(null!=(t=r.unit)?t:"")),n&&n.value!==String(e)&&(n.value=e,r.triggerChange(!1)),r.updateUI()}updateUI(){var e,t;const r=this;(null==(e=r._tooltip)?void 0:e.isVisible)&&(null==(t=r._tooltip)||t.alignTo({target:Rectangle.from(r.input).inflate(r.thumbSize/2,-r.thumbSize/2),align:"b-t"+Math.round(r.percentProgress)}))}};Slider.initClass(),Slider._$name="Slider";var SlideToggle=class extends Checkbox{static get $name(){return"SlideToggle"}static get type(){return"slidetoggle"}static get properties(){return{toggledCls:"b-slidetoggle-checked"}}construct(e){(null==e?void 0:e.checked)&&(e.cls=(e.cls||"")+" "+this.constructor.properties.toggledCls),super.construct(e)}get innerElements(){const e=super.innerElements;return e.splice(1,0,this.toggleElement),this.text?e[e.length-1].class="b-slidetoggle-label":e.pop(),e}get toggleElement(){return{class:"b-slidetoggle-toggle",reference:"slideToggle",children:[{class:"b-slidetoggle-thumb",reference:"slideThumb"}]}}internalOnChange(){super.internalOnChange(),this.element.classList[this.value?"add":"remove"](this.toggledCls)}};SlideToggle.initClass(),SlideToggle._$name="SlideToggle";var classesHV=["b-horizontal","b-vertical"],hasFlex=e=>"flex"===DomHelper.getStyleValue(e.parentElement,"display")&&(parseInt(DomHelper.getStyleValue(e,"flex-basis"),10)||parseInt(DomHelper.getStyleValue(e,"flex-grow"),10)),verticality={horizontal:!1,vertical:!0},Splitter=class extends Widget{static get $name(){return"Splitter"}static get type(){return"splitter"}static get configurable(){return{orientation:"auto",vertical:null,containerElement:{$config:"nullify",value:null},nextNeighbor:{$config:"nullify",value:null},previousNeighbor:{$config:"nullify",value:null}}}static get delayable(){return{syncState:"raf"}}doDestroy(){var e;null==(e=this.mouseDetacher)||e.call(this),super.doDestroy()}compose(){return{class:{"b-splitter":1},listeners:{pointerdown:"onMouseDown",mouseenter:"syncState",...!BrowserHelper.supportsPointerEvents&&{mousedown:"onMouseDown",touchstart:"onMouseDown"}}}}get currentOrientation(){return this.vertical?"vertical":"horizontal"}get nextWidget(){return Widget.fromElement(this.element.nextElementSibling,1)}get previousWidget(){return Widget.fromElement(this.element.previousElementSibling,1)}updateContainerElement(e){var t;const r=this;r.stateDetector=null==(t=r.stateDetector)?void 0:t.disconnect(),e&&(r.stateDetector=new MutationObserver((()=>r.syncState())),r.stateDetector.observe(e,{attributes:!0,childList:!0}))}updateNextNeighbor(e){this.watchNeighbor(e,"next")}updatePreviousNeighbor(e){this.watchNeighbor(e,"previous")}watchNeighbor(e,t){this.detachListeners(t),null==e||e.ion({name:t,thisObj:this,collapse:"syncState",expand:"syncState",hide:"syncState",show:"syncState"})}updateOrientation(){this.syncState.now()}updateVertical(e){var t;const r=null==(t=this.element)?void 0:t.classList;null==r||r.add(classesHV[e?1:0]),null==r||r.remove(classesHV[e?0:1])}syncState(){var e;const t=this,{element:r,nextWidget:n,previousWidget:i}=t;let s=null!=(e=verticality[t.orientation])?e:null;if(t.nextNeighbor=n,t.previousNeighbor=i,t.disabled=n&&(n.collapsible&&n.collapsed||n.hidden)||i&&(i.collapsible&&i.collapsed||i.hidden),null!==s&&n&&i)t.containerElement=null;else if(t.containerElement=r.parentElement,t.rendered&&r.offsetParent){const e=DomHelper.getStyleValue(r.parentElement,"flex-direction");if(e)s=!e.startsWith("column");else{const e=r.previousElementSibling,t=r.nextElementSibling;if(!e||!t)return;const n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),a=n.top<i.top?n:i,o=a===i?n:i;s=a.top===o.top}}t.vertical=s}onMouseDown(e){var t;e.preventDefault(),e.touches&&(e=e.touches[0]);const r=this,{element:n}=r,i=n.previousElementSibling,s=n.nextElementSibling,a=hasFlex(i),o=hasFlex(s),l=[];null==(t=r.mouseDetacher)||t.call(r);for(const e of n.parentElement.children)hasFlex(e)&&e!==n&&l.push({element:e,width:e.offsetWidth,height:e.offsetHeight});r.context={startX:e.pageX,startY:e.pageY,prevWidth:i.offsetWidth,prevHeight:i.offsetHeight,nextWidth:s.offsetWidth,nextHeight:s.offsetHeight,prevHasFlex:a,nextHasFlex:o,flexed:l,prev:i,next:s};const c={element:document,pointermove:"onMouseMove",pointerup:"onMouseUp",thisObj:r};BrowserHelper.supportsPointerEvents||(c.mousemove=c.touchmove="onMouseMove",c.mouseup=c.touchend="onMouseUp"),n.classList.add("b-moving"),r.mouseDetacher=EventHelper.on(c)}onMouseMove(e){const t=this,{context:r,nextWidget:n,previousWidget:i}=t,s=r.prev.style,a=r.next.style,o=(e.pageX-r.startX)*(t.rtl?-1:1),l=e.pageY-r.startY;if(e.preventDefault(),Object.assign(r,{deltaX:o,deltaY:l}),r.started||(r.started=!0,t.trigger("dragStart",{context:r,event:e}),r.flexed.forEach((e=>{e.element.style.flexGrow=t.vertical?e.width:e.height,e.element.style.flexBasis="0"}))),t.vertical){const e=r.prevWidth+o,t=r.nextWidth-o;r.prevHasFlex?s.flexGrow=e:i?i.width=e:s.width=e+"px",r.nextHasFlex?a.flexGrow=t:n?n.width=t:a.width=t+"px"}else{const e=r.prevHeight+l,t=r.nextHeight-l;r.prevHasFlex?s.flexGrow=e:i?i.height=e:s.height=e+"px",r.nextHasFlex?a.flexGrow=t:n?n.height=t:a.height=t+"px"}t.trigger("drag",{context:r,event:e})}onMouseUp(e){var t;const r=this;null==(t=r.mouseDetacher)||t.call(r),r.mouseDetacher=null,r.element.classList.remove("b-moving"),r.context.started&&r.trigger("drop",{context:r.context,event:e}),r.context=null}render(){super.render(...arguments),this.syncState.now(),null===this.vertical&&this.syncState()}};Splitter.initClass(),Splitter._$name="Splitter";var Tab=class extends Button{static get $name(){return"Tab"}static get type(){return"tab"}static get configurable(){return{active:null,index:null,isFirst:null,isLast:null,item:{value:null,$config:"nullify"},itemCls:null,tabPanel:null,titleProperty:"text",titleSource:"title",role:"tab"}}compose(){const{active:e,cls:t,index:r,isFirst:n,isLast:i}=this;return{tabindex:0,"aria-selected":e,"aria-setsize":this.owner.visibleChildCount,"aria-posinset":r+1,class:{"b-tabpanel-tab":1,"b-active":e,"b-tab-first":n,"b-tab-last":i,...t},dataset:{index:r}}}updateIndex(e){this.isFirst=!e}updateItem(e,t){var r,n;const i=this;(null==t?void 0:t.tab)===i&&(t.tab=null),e&&(e.tab=i,i[i.titleProperty]=e[i.titleSource],i.itemCls=e.cls,i.ariaElement.setAttribute("aria-controls",e.id),e.role="tabpanel"),null==(r=i.itemChangeDetacher)||r.call(i),i.itemChangeDetacher=e&&FunctionHelper.after(e,"onConfigChange","onItemConfigChange",i,{return:!1}),null==(n=i.itemHideDetacher)||n.call(i),i.itemHideDetacher=null==e?void 0:e.ion({beforeChangeHidden:"onItemBeforeChangeHidden",beforeHide:"onItemBeforeHide",beforeUpdateDisabled:"onItemBeforeUpdateDisabled",thisObj:i,prio:1e3}),i.syncMinMax()}updateItemCls(e,t){const{element:r}=this,n=r&&DomClassList.from(null==r?void 0:r.classList,!0);r&&(n.remove(t).add(e),r.className=n.value)}updateRotate(e,t){!e!=!t&&this.syncMinMax()}syncMinMax(){const e=this,{rotate:t,tabPanel:r}=e;let{_minWidth:n,_minHeight:i,_maxWidth:s,_maxHeight:a}=e;if(r){const{tabMinWidth:o,tabMaxWidth:l}=r;null!=o&&(t?(n===o&&(n=null),i=o):(i===o&&(i=null),n=o)),null!=l&&(t?(s===l&&(s=null),a=l):(a===l&&(a=null),s=l)),e.minWidth=n,e.minHeight=i,e.maxWidth=s,e.maxHeight=a}}onItemBeforeChangeHidden({source:e,hidden:t}){if(!e.$isDeactivating&&!e.$isActivating){const{tabPanel:r}=this;this.hidden=t,t&&e===r.activeItem&&r.activateAvailableTab(e)}}onItemBeforeHide(){this.item.$isDeactivating||this.hide()}onItemBeforeUpdateDisabled({source:e,disabled:t}){const{tabPanel:r}=this;this.disabled=t,e===r.activeItem&&r.activateAvailableTab(e)}onItemConfigChange({name:e,value:t}){e===this.titleSource&&(this[this.titleProperty]=t)}};Tab.initClass(),Tab._$name="Tab";var isTab=e=>e.isTab,TabBar=class extends Toolbar{static get $name(){return"TabBar"}static get type(){return"tabbar"}static get configurable(){return{defaultType:"tab",overflow:"scroll",role:"tablist",ignoreParentReadOnly:!0}}get firstTab(){return this.tabAt(0)}get lastTab(){return this.tabAt(-1)}get tabCount(){return this._items.countOf(isTab)}get tabs(){return ArrayHelper.from(this._items,isTab)}compose(){return{children:{toolbarContent:{class:{"b-tabpanel-tabs":1}}}}}indexOfTab(e){return this._items.indexOf(e,isTab)}onChildAdd(e){super.onChildAdd(e),null==e.index&&this.syncTabs()}onChildRemove(e){super.onChildRemove(e),this.syncTabs()}onFocusIn(){const{activeIndex:e}=this.owner;isNaN(e)||this.tabs[e].focus()}syncTabs(){const{tabs:e}=this;for(let t=0,r=e.length;t<r;++t)e[t].index=t,e[t].isFirst=!t,e[t].isLast=t===r-1}tabAt(e){return this._items.find(isTab,e)||null}};TabBar.initClass(),TabBar._$name="TabBar";var animationClasses=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"],Card=class extends Layout{onChildAdd(e){super.onChildAdd(e);const t=this,{activeItem:r,owner:n}=t,i=null!=n.activeIndex?n.activeIndex:t.activeIndex||0,s=n.items.indexOf(e),a=null!=r?e===r:s===i;e.ion({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t}),a?(t._activeIndex=s,t._activeItem=e,e.show()):(e.$isDeactivating=!0,e.hide(),e.$isDeactivating=!1)}onChildRemove(e){super.onChildRemove(e);const t=this;t._activeItem===e&&t.activateSiblingOf(e),t._activeIndex=t.owner.items.indexOf(t._activeItem),e.un({beforeHide:"onBeforeChildHide",beforeShow:"onBeforeChildShow",thisObj:t})}onBeforeChildShow({source:e}){if(!this.owner.isConfiguring&&!e.$isActivating)return this.activeItem=e,!1}onBeforeChildHide({source:e}){if(!this.owner.isConfiguring&&!e.$isDeactivating)return this.activateSiblingOf(e),!1}activateSiblingOf(e){const{owner:t}=this,r=t.items.slice(),n=r.indexOf(e);r.splice(n,1),this.activeIndex=Math.min(n,r.length-1)}setActiveItem(e,t=this.activeIndex,r){var n;const i=this,{owner:s}=i,{items:a}=s,o=e instanceof Widget,l=a[t],c=s.items[e=o?a.indexOf(e):parseInt(e,10)],d=!1!==(null==r?void 0:r.animation),u=!(null==r?void 0:r.silent),h={prevActiveIndex:t,prevActiveItem:l};if(c&&!c.$isActivating&&c!==l){const a=l&&l.element,o=c&&c.element;if(i.animateDetacher){const e=i.animateDetacher.event;if(e.activeItem===c)return e.promise;i.animateDetacher(),e.prevActiveItem.element.classList.remove(...animationClasses),e.activeItem.element.classList.remove(...animationClasses),i.animateDetacher=null}if(h.activeIndex=e,h.activeItem=c,u&&!1===s.trigger("beforeActiveItemChange",h))return null;const g=i._activeIndex!==h.activeIndex;g&&(i._activeIndex=h.activeIndex),u&&(null==(n=s.onBeginActiveItemChange)||n.call(s,h)),g&&(i._activeIndex=h.prevActiveIndex),d&&a&&s.isVisible&&i.animateCardChange?h.promise=i.cardChangeAnimation=new Promise(((n,d)=>{const g=l.monitorResize;l.monitorResize=!1,i.contentElement.style.overflowX="hidden",l._hidden=!0,c.$isActivating=!0,c.show(),c.$isActivating=!1,a.classList.add(e>t?"b-slide-out-left":"b-slide-out-right"),o.classList.add(e<t?"b-slide-in-left":"b-slide-in-right"),s.isAnimating=!0,i.animateDetacher=EventHelper.onTransitionEnd({mode:"animation",element:o,thisObj:l,handler(){s.isAnimating=i.cardChangeAnimation=!1,i.animateDetacher?(i.animateDetacher=null,o.classList.remove(...animationClasses),a&&(a.classList.remove(...animationClasses),l.$isDeactivating=!0,l._hidden=!1,l.hide(),l.monitorResize=g,l.$isDeactivating=!1),i.contentElement.style.overflowX="",i.onActiveItemChange(h,n,!u)):i.setActiveItem(e,t,r)}}),i.animateDetacher.reject=d,i.animateDetacher.event=h})):(c.$isActivating=!0,c.show(),c.focus(),c.$isActivating=!1,l&&(l.$isDeactivating=!0,l.hide(),l.$isDeactivating=!1),i.onActiveItemChange(h,null,!u))}return h}onActiveItemChange(e,t,r){const n=this;n._activeItem=e.activeItem,n._activeIndex=e.activeIndex,!r&&n.owner.trigger("activeItemChange",e),e.activeItem.focus(),null==t||t(e)}renderChildren(){const{owner:e}=this;e.contentElement.classList.toggle(this.hideChildHeaderCls,e.suppressChildHeaders),super.renderChildren()}changeActiveIndex(e){const{owner:t}=this;return t.isConfiguring&&!t._items?e:Math.min(e,t.items.length-1)}updateActiveIndex(e,t){this.owner.isConfiguring||this.setActiveItem(e,t)}updateActiveItem(e){this.owner.isConfiguring||this.setActiveItem(e,this.activeIndex)}get isChangingCard(){return Boolean(this.animateDetacher)}};__publicField(Card,"$name","Card"),__publicField(Card,"type","card"),__publicField(Card,"configurable",{containerCls:"b-card-container",itemCls:"b-card-item",hideChildHeaderCls:"b-hide-child-headers",animateCardChange:!0,activeItem:null,activeIndex:null}),Card.initClass(),Card._$name="Card";var TabPanel=class extends Panel{static get $name(){return"TabPanel"}static get type(){return"tabpanel"}static get alias(){return"tabs"}static get configurable(){return{activeTab:0,animateTabChange:!0,autoHeight:!1,defaultType:"container",focusable:!1,itemCls:"b-tabpanel-item",layout:{type:"card"},suppressChildHeaders:!0,tabBar:{type:"tabbar",weight:-2e3},tabMinWidth:null,tabMaxWidth:null}}get activeIndex(){return this.layout.activeIndex}get activeItem(){return this.layout.activeItem}get activeTabItemIndex(){var e;const{activeTab:t,items:r,tabBar:n}=this;return r.indexOf(null==(e=n.tabs[t])?void 0:e.item)}get bodyConfig(){return ObjectHelper.merge({className:{"b-tabpanel-body":1}},super.bodyConfig)}get focusElement(){var e;const t=this.items[this.activeTab||0];return(null==t?void 0:t.focusElement)||(null==(e=null==t?void 0:t.tab)?void 0:e.focusElement)}get tabPanelBody(){return this.bodyElement}finalizeInit(){super.finalizeInit();const e=this,{activeTab:t,layout:r}=e,{activeIndex:n}=r,{tabs:i}=e.tabBar,s=t>=0&&t<i.length&&e.items.indexOf(i[t].item);if(i.length>0&&(!1===s||s<0))throw new Error("Invalid activeTab "+t+" ("+i.length+" tabs)");s!==n&&r.setActiveItem(s,n,{animation:!1,silent:!0}),r.animateCardChange=e.animateTabChange}onChildAdd(e){if(super.onChildAdd(e),!this.initialItems){const t=this,{tabBar:r}=t,n=t.makeTabConfig(e),i=n&&(null==r?void 0:r.firstTab),s=i&&r._items,a=i&&ArrayHelper.from(t._items,(t=>t.tab||t===e)),o=i?a.indexOf(e)+s.indexOf(i):0;n&&r&&(i&&null==e.weight&&o<s.count-1?r.insert(n,o):r.add(n))}}onChildRemove(e){const{tab:t}=e,{items:r}=this;t&&(this.tabBar.remove(t),t.destroy()),e===this.activeItem&&(this._activeTab=null,r.length&&(this.activeTab=r[Math.min(this.activeIndex,r.length-1)])),super.onChildRemove(e)}isDisabledOrHiddenTab(e){const{tabs:t}=this.tabBar,r=null==t?void 0:t[e];return r&&(r.disabled||r.hidden)}findAvailableTab(e,t=1){const{tabs:r}=this.tabBar,n=r.length,i=Math.max(0,r.indexOf(e.tab));let s;i&&(t=-t);for(let e=1;e<=n&&(s=(i+(t<0?n:0)+e*t)%n,this.isDisabledOrHiddenTab(s));++e);return s}activateAvailableTab(e,t=1){this.activeTab=this.findAvailableTab(e,t)}changeActiveTab(e,t){const r=this,{tabBar:n,layout:i}=r,{tabCount:s}=n;if(e.isWidget||ObjectHelper.isObject(e)?(-1===r.items.indexOf(e)&&(e=r.add(e)),e=n.indexOfTab(e.tab)):e=parseInt(e,10),!r.initialItems&&s>0&&(e<-1||e>=s))throw new Error("Invalid activeTab "+e+" ("+s+" tabs)");if(r.isDisabledOrHiddenTab(e)&&(e=r.findAvailableTab(e)),!i.animateCardChange||!i.cardChangeAnimation)return e;i.cardChangeAnimation.then((n=>{(null==n?void 0:n.activeIndex)!==e&&(r._activeTab=e,r.updateActiveTab(e,t))}))}async updateActiveTab(e,t){var r;if(!this.initialItems){const{activeTabItemIndex:e,layout:n}=this;if(e>-1){const i=this.items[t],s=this.items[e];n.activeItem!==s&&(n.animateCardChange&&await this.tabSelectionPromise,(null==i?void 0:i.containsFocus)&&i.tab.focus(),this.tabSelectionPromise=null==(r=n.setActiveItem(s))?void 0:r.promise)}}}changeTabBar(e){return this.getConfig("strips"),this.strips={tabBar:e},this.strips.tabBar}makeTabConfig(e){const{tab:t}=e,r={item:e,type:"tab",tabPanel:this,disabled:Boolean(e.disabled),hidden:e.initialConfig.hidden,weight:e.weight||0,internalListeners:{click:"onTabClick",thisObj:this},localizableProperties:{text:!1}};return!1===t?null:ObjectHelper.isObject(t)?Tab.mergeConfigs(r,t):r}updateItems(e,t){const r=this,{activeTab:n,initialItems:i}=r;let s,a=0;super.updateItems(e,t),i&&(s=Array.from(e,(e=>r.makeTabConfig(e))).filter((e=>{if(e)return e.index=a++,!0})),a&&(s[0].isFirst=!0,s[a-1].isLast=!0,s[n].active=!0,r.tabBar.add(s),r.activeTab=n))}updateTabMinWidth(e){var t;null==(t=this.tabBar)||t.items.forEach((t=>{t.isTab&&(t.minWidth=e)}))}updateTabMaxWidth(e){var t;null==(t=this.tabBar)||t.items.forEach((t=>{t.isTab&&(t.maxWidth=e)}))}updateAutoHeight(e){this.detachListeners("themeAutoHeight"),e&&GlobalEvents_default.ion({name:"themeAutoHeight",theme:"internalOnThemeChange",thisObj:this}),this.$measureHeight=e}applyAutoHeight(){const e=this,{layout:t,activeTab:r,element:n}=e,{animateCardChange:i}=t;t.animateCardChange=!1,e.height=null,e.height=Math.max(...e.items.map((t=>(e.activeTab=t,n.clientHeight))))+1,e.activeTab=r,t.animateCardChange=i,e.$measureHeight=!1}internalOnThemeChange(){this.isVisible?this.applyAutoHeight():this.$measureHeight=!0}onBeginActiveItemChange(e){const t=this.tabBar.tabs,{activeItem:r,prevActiveItem:n}=e;this.activeTab=t.indexOf(null==r?void 0:r.tab),(null==n?void 0:n.tab)&&(n.tab.active=!1),(null==r?void 0:r.tab)&&(r.tab.active=!0,r.tab.show())}onBeforeActiveItemChange(e){return this.trigger("beforeTabChange",e)}onActiveItemChange(e){this.trigger("tabChange",e)}onTabClick(e){this.activeTab=e.source.item}onPaint(){super.onPaint(...arguments),this.$measureHeight&&this.applyAutoHeight()}};TabPanel.initClass(),TabPanel._$name="TabPanel";var TextAreaField=class extends Field{static get $name(){return"TextAreaField"}static get type(){return"textareafield"}static get alias(){return"textarea"}static get configurable(){return{resize:"none",inputAttributes:{tag:"textarea"}}}updateResize(e){this.input.style.resize=e}};TextAreaField.initClass(),TextAreaField._$name="TextAreaField";var TextAreaPickerField=class extends PickerField{static get $name(){return"TextAreaPickerField"}static get type(){return"textareapickerfield"}static get configurable(){return{picker:{type:"widget",tag:"textarea",cls:"b-textareapickerfield-picker",scrollAction:"realign",align:{align:"t-b",axisLock:!0},autoShow:!1},triggers:{expand:{cls:"gt-icon-picker",handler:"onTriggerClick"}},resize:"none",inputType:null}}startConfigure(e){"boolean"==typeof e.inline&&VersionHelper.deprecate("Core","6.0.0","不再支持TextAreaPickerField.inline配置"),super.startConfigure(e)}get inputElement(){const e=super.inputElement;return e.readOnly="readonly",e.reference="displayElement",this.ariaElement="displayElement",e}get focusElement(){var e;return(null==(e=this._picker)?void 0:e.isVisible)?this.input:this.displayElement}get needsInputSync(){var e;return this.displayElement[this.inputValueAttr]!==String(null!=(e=this.inputValue)?e:"")}showPicker(){const e=this,{picker:t}=e;e.inline||(t.width=e.pickerWidth||e[e.pickerAlignElement].offsetWidth,super.showPicker(!0))}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,r=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const n=super.onPickerKeyDown(e);return t.input=r,n}syncInputFieldValue(e){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue(e)}changeValue(e){return null==e?"":e}changePicker(e,t){var r;const n=this,i=n.pickerWidth||(null==e?void 0:e.width);if(e=TextAreaPickerField.reconfigure(t,e?Objects.merge({owner:n,forElement:n[n.pickerAlignElement],align:{matchSize:null==i,anchor:n.overlayAnchor,target:n[n.pickerAlignElement]},id:n.id+"-input",style:{resize:n.resize},html:null!=(r=n.value)?r:""},e):null,n)){const t=n.input=e.element;n.inputListenerRemover=EventHelper.on({element:t,thisObj:n,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyEvent",keypress:"internalOnKeyEvent",keyup:"internalOnKeyEvent"})}return e}};TextAreaPickerField.initClass(),TextAreaPickerField._$name="TextAreaPickerField";var Minifiable_default=e=>{var t;return __publicField(t=class extends(e||Base){compose(){const{minified:e}=this;return{class:{"b-minified":e}}}get widgetClass(){}},"$name","Minifiable"),__publicField(t,"configurable",{minifiable:!0,minified:null}),t},EMPTY=[],isStateName=e=>"*"!==e[0],pop=(e,t)=>{const r=e[t]||null;return delete e[t],r},responsiveRootFn=e=>e.responsiveRoot,scoring={number:e=>({width:t})=>t<=e&&e},splitConfigs=e=>(delete e.once,{callback:pop(e,"callback"),configs:e,when:pop(e,"when")}),splitMergedConfigs=(e,...t)=>{const r=t.flatMap((e=>(null==e?void 0:e.once)||EMPTY)),n=e.mergeConfigs(...t),i=splitConfigs(n);return i.once=r.length?splitConfigs(e.mergeConfigs(...r)):null,i},wrapWidget=(e,t)=>{let r,n=Proxy.revocable(e,{get:(t,n)=>(r&&(r[n]=!0),e[n])}),i=FunctionHelper.after(e,"onConfigChange",((e,{name:n})=>{(null==r?void 0:r[n])&&t()})),s=e.ion({resize:()=>{t()}});return e.monitorResize=!0,{widget:e,get object(){return null==n?void 0:n.proxy},destroy(){n&&(n.revoke(),i(),s(),n=i=s=null)},reset(){r=Object.create(null)}}},Responsive_default=e=>{var t;return t=class extends((e||Base).mixin(Delayable_default,Fencible_default)){get isResponsivePending(){return 0===this.responsiveUpdateCount&&this.hasConfig("responsive")}get isResponsiveUpdating(){var e;return this._responsiveUpdating||(null==(e=this.responsiveWidget)?void 0:e._responsiveUpdating)}updateResponsive(e){var t;const r=this,n=r.constructor,{responsiveDefaults:i}=r,s=Array.from(new Set(ObjectHelper.keys(e).concat(ObjectHelper.keys(i)))).filter(isStateName);let a,o,l,c,d=null;if(e)for(o of(d={"*":splitMergedConfigs(n,i["*"],e["*"])},s))l=e[o],null!==l&&!1!==l&&(a=a||l&&"when"in l,d[o]=splitMergedConfigs(n,i["*"],i[o],e["*"],l),c=d[o].when,d[o].when=(null==(t=scoring[typeof c])?void 0:t.call(scoring,c))||c);r.$responsiveStates=d,r.$responsiveWhen=a,r.syncResponsiveWidget()}updateResponsiveState(e,t){var r,n,i,s,a;const o=this,{$responsiveStates:l}=o,c=1==++o.responsiveStateChanges,d=null==(r=o.element)?void 0:r.classList,u=l["*"],h=l[e]||u,g=c&&(h.once||u.once),p=c&&o.isStateful,m=o.responsiveWidget;let f=h.configs,v=null==g?void 0:g.configs;v&&(f=f?o.constructor.mergeConfigs(f,v):v),t&&(null==d||d.remove("b-responsive-"+t.toLowerCase())),e&&(null==d||d.add("b-responsive-"+e.toLowerCase())),p&&(v=o.loadStatefulData(),v&&(f=f?o.constructor.mergeConfigs(f,v):v),o.suspendStateful()),o._responsiveUpdating=!0;try{null==(n=o.trigger)||n.call(o,"beforeResponsiveStateChange",{state:e,oldState:t,target:m}),f&&o.setConfig(f),null==(i=h.callback)||i.call(h,{source:o,state:e,oldState:t,target:m,initial:c}),null==(s=null==g?void 0:g.callback)||s.call(g,{source:o,state:e,oldState:t,target:m,initial:c}),null==(a=o.trigger)||a.call(o,"responsiveStateChange",{state:e,oldState:t,target:m})}finally{o._responsiveUpdating=!1,p&&o.resumeStateful()}}get responsiveTarget(){return this.responsiveWidget||this._responsiveTarget}updateResponsiveTarget(){this.syncResponsiveWidget()}updateResponsiveWidget(e){var t;const r=this,n=e&&r.responsiveUpdate;null==(t=r.$responsiveWrapper)||t.destroy(),r.$responsiveWrapper=e&&wrapWidget(e,n),null==n||n.now()}responsiveUpdate(){const e=this,{$responsiveStates:t,$responsiveWrapper:r}=e,n=null==r?void 0:r.widget;if(t&&r){let i,s,a=null,o=0,l=t;for(s in n&&n!==e&&!e.$responsiveWhen&&(n.getConfig("responsive"),l=n.$responsiveStates||l),r.reset(),t)"*"!==s&&(i=l[s].when(r.object,BrowserHelper),null!=i&&!1!==i&&(!a||i<o)&&(a=s,o=i));++e.responsiveUpdateCount,e.responsiveState=a}}syncResponsiveWidget(){var e;const t=this;let r,n=null;if(!t.isDestroying&&t.responsive){if(r=t.responsiveTarget,n=r){if("string"==typeof r&&(n="@"===r?t:"@"===r[0]?t[r.substring(1)]:t.up(r),!n))throw new Error('No match for responsiveTarget="'+r+'"')}else n=!t.responsiveRoot&&(null==(e=t.up)?void 0:e.call(t,responsiveRootFn))||t;if(!n.isWidget)throw new Error(n.constructor.$$name+" is not a widget and cannot be a responsiveTarget")}return t.responsiveWidget=n,n}changeBreakpoints(e){return ObjectHelper.assertObject(e,"breakpoints"),(null==e?void 0:e.width)&&Object.keys(e.width).forEach((t=>{e.width[t].maxWidth=t})),(null==e?void 0:e.height)&&Object.keys(e.height).forEach((t=>{e.height[t].maxHeight=t})),e}updateBreakpoints(e){e&&(this.monitorResize=!0)}getBreakpoint(e,t){const r=Object.keys(e).map((e=>parseInt(e))).sort().find((e=>t<=e));return e[null!=r?r:e["*"]&&"*"]}activateBreakpoint(e,t){var r,n;const i=this,s=i["current"+e+"Breakpoint"];t!==s&&(i["current"+e+"Breakpoint"]=t,i.setConfig(t.configs),s&&i.element.classList.remove("b-breakpoint-"+s.name.toLowerCase()),i.element.classList.add("b-breakpoint-"+t.name.toLowerCase()),i.trigger("responsive"+e+"Change",{breakpoint:t,prevBreakpoint:s}),null==(r=t.callback)||r.call(t,{source:i,breakpoint:t,prevBreakpoint:s}),null==(n=i.recompose)||n.call(i))}applyResponsiveBreakpoints(e,t){var r;const n=this,{width:i,height:s}=null!=(r=n.breakpoints)?r:{};if(i){const t=n.getBreakpoint(i,e);n.activateBreakpoint("Width",t)}if(s){const e=n.getBreakpoint(s,t);n.activateBreakpoint("Height",e)}}onInternalResize(e,t,r,n,i){super.onInternalResize(e,t,r,n,i),this.applyResponsiveBreakpoints(t,r)}},__publicField(t,"$name","Responsive"),__publicField(t,"configurable",{responsive:{$config:{lazy:"paint"},value:null},responsiveDefaults:{small:{when:400},medium:{when:800},large:{when:()=>1/0},"*":{}},responsiveRoot:null,responsiveState:null,responsiveTarget:{value:null,$config:{lazy:"paint"}},responsiveWidget:{value:null,$config:{nullify:!0}},breakpoints:null}),__publicField(t,"delayable",{responsiveUpdate:"raf"}),__publicField(t,"fenced",{syncResponsiveWidget:!0}),__publicField(t,"prototypeProperties",{responsiveStateChanges:0,responsiveUpdateCount:0}),t},Styleable_default=e=>{var t;return __publicField(t=class extends(e||Base){changeCssVarPrefix(e){return ObjectHelper.assertString(e,"prefix"),e&&!e.endsWith("-")&&(e+="-"),e||""}changeCss(e){ObjectHelper.assertObject(e,"css");const t=this;if(!globalThis.Proxy)throw new Error("Proxy not supported");const r=new Proxy({},{get(e,r){var n;return null==(n=getComputedStyle(t.element||document.documentElement).getPropertyValue("--"+t.cssVarPrefix+StringHelper.hyphenate(r)))?void 0:n.trim()},set:(e,r,n)=>((t.element||document.documentElement).style.setProperty("--"+t.cssVarPrefix+StringHelper.hyphenate(r),n),!0)});return e&&(t._element?ObjectHelper.assign(r,e):t.$initialCSS=e),r}updateElement(e,...t){super.updateElement(e,...t),this.$initialCSS&&ObjectHelper.assign(this.css,this.$initialCSS)}get widgetClass(){}},"$name","Styleable"),__publicField(t,"configurable",{cssVarPrefix:"",css:{}}),t},ns="http://www.w3.org/2000/svg",typePrio={bar:1,outline:2,text:3},byDatasetOrder=(e,t)=>parseInt(e.dataset.order,10)-parseInt(t.dataset.order,10),getField=e=>e.field,returnFalse=()=>!1,Histogram=class extends Widget{static get type(){return"histogram"}static get $name(){return"Histogram"}static get defaultConfig(){return{data:null,values:null,series:null,topValue:null,element:{children:[{ns:ns,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:ns,tag:"g",reference:"scaledSvgGroup"},{ns:ns,tag:"g",reference:"unscaledSvgGroup"}]}]},omitZeroHeightBars:null,monitorResize:!0,getRectClass:null,getBarTip:null,getBarText:null,getBarTextRenderData:null,getBarTextTip:null}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}set tip(e){var t;const r=this;null==(t=r.tip)||t.destroy(),r._tip=e?Tooltip.new({owner:r,forElement:r.svgElement,forSelector:"rect",internalListeners:{beforeShow:"up.onBeforeTipShow"}},e):null}onElementResize(){super.onElementResize(...arguments);const e=this.svgElement.getBoundingClientRect();this.scaledSvgGroup.setAttribute("transform","scale("+e.width+" "+e.height+")")}onBeforeTipShow({source:e}){const t=parseInt(e.activeTarget.dataset.index);e.html=e.contentTemplate({histogram:this,index:t})}set series(e){const t=this._series={};for(const r in e)if(!1!==e[r]){const n=t[r]=Object.assign({},e[r]);!n.type&&e[r].type&&(n.type=e[r].type),!n.field&&e[r].field&&(n.field=e[r].field),"order"in t||(n.order=typePrio[n.type]),n.id=r}this.scheduleRefresh()}get series(){return this._series}set data(e){const t=this;if(t._data=e,!t.topValue){const r=Object.values(t.series).map(getField);for(let n=0,{length:i}=e;n<i;n++)for(let i=0,{length:s}=r;i<s;i++)t.topValue=Math.max(t.topValue||0,e[n][r[i]])}t.scheduleRefresh()}get data(){return this._data}set topValue(e){this._topValue=e,this.scheduleRefresh()}get topValue(){return this._topValue}scheduleRefresh(){}refresh(){const e=this,{series:t,_tip:r}=e,n=[];for(const r in t){const i=t[r],s=e["draw"+StringHelper.capitalize(i.type)](i);Array.isArray(s)?n.push.apply(n,s):n.push(s)}n.sort(byDatasetOrder),DomSync.syncChildren({domConfig:{children:n},configEquality:returnFalse},e.scaledSvgGroup),DomSync.syncChildren({domConfig:{children:e.drawText()}},e.unscaledSvgGroup),r&&r.isVisible&&e.onBeforeTipShow({source:r})}drawBar(e){const t=this,{topValue:r,data:n,omitZeroHeightBars:i,barStyle:s}=t,{field:a,order:o}=e,l=1/n.length,c=[];let d;for(let u=0,h=0,{length:g}=n;u<g;u++,h+=d){const g=n[u],p=g[a],m=g.height||(p>r?r:p)/r,f=1-m,v=g.rectConfig={ns:ns,tag:"rect",dataset:{}},y=t.callback("getBarTip",t,[e,v,g,u]);d=g.width||l,s?v.style=s:delete v.style,Object.assign(v.dataset,{index:u,order:o}),Object.assign(v,{x:h,y:f,width:d,height:m,class:t.callback("getRectClass",t,[e,v,g,u])}),y?v.dataset.btip=y:delete v.dataset.btip,!m&&i||c.push(v)}return c}drawOutline(e){const{topValue:t,data:r}=this,{field:n,order:i}=e,s=1/r.length,a=["M 0,1"],o=e.outlineElement||(e.outlineElement={ns:ns,tag:"path",dataset:{order:i}});let l,c="M",d="L";for(let e=0,i=0,{length:o}=r;e<o;e++){const o=1-r[e][n]/t;l=r[e].width||s,a.push(c+" "+i+","+o+" "+d+" "+(i+=l)+","+o),c=d=""}return o.d=a.join(" "),o}drawText(){const e=this,{data:t}=e,r=1/t.length,n=[];for(let i,s=0,a=0,{length:o}=t;s<o;s++,a+=i){i=t[s].width||r;const o=e.callback("getBarText",e,[t[s],s]);if(o){const r=e.callback("getBarTextRenderData",e,[{ns:ns,tag:"text",className:"b-bar-legend",html:o,x:100*(a+i/2)+"%",y:void 0!==t[s].y?t[s].y:"100%",dataset:{index:s}},t[s],s]),l=e.callback("getBarTextTip",e,[r,t[s],s]);l?r.dataset.btip=l:delete r.dataset.btip,n.push(r)}}return n}getBarText(e,t){return""}getBarTextRenderData(e,t,r){return e}getBarTip(e,t,r,n){}getBarTextTip(e,t,r){}getRectClass(e,t,r,n){return""}};Histogram.initClass(),Histogram._$name="Histogram";var ns2="http://www.w3.org/2000/svg",Scale=class extends Widget{static get type(){return"scale"}static get $name(){return"Scale"}static get configurable(){return{scalePoints:null,scaleMaxPadding:.1,horizontal:!1,align:{value:!1,$config:{merge:"replace"}},element:{children:[{ns:ns2,tag:"svg",reference:"svgElement",width:"100%",height:"100%",preserveAspectRatio:"none",children:[{ns:ns2,tag:"g",reference:"scaledSvgGroup",children:[{ns:ns2,tag:"path",reference:"pathElement"}]},{ns:ns2,tag:"g",reference:"unscaledSvgGroup"}]}]},monitorResize:!0}}construct(e){super.construct(e),this.scheduleRefresh=this.createOnFrame(this.refresh,[],this,!0),this.refresh()}changeAlign(e){return e||(e=this.horizontal?"bottom":"right"),e}updateAlign(e,t){this.element.classList.remove("b-align-"+t),this.element.classList.add("b-align-"+e)}updateHorizontal(e,t){this.element.classList.remove("b-scale-"+(t?"horizontal":"vertical")),this.element.classList.add("b-scale-"+(e?"horizontal":"vertical"))}onElementResize(){super.onElementResize(...arguments),this.scheduleRefresh()}scheduleRefresh(){}refresh(){const e=this,{horizontal:t,width:r,height:n,align:i,scalePoints:s,scaleMaxPadding:a}=e,o=s[s.length-1].value,l=[],c=[],d=1/(o+a*o);e.scaledSvgGroup.setAttribute("transform","scale("+(t?r:1)+" "+(t?1:n)+")");for(const e of s){const s=Boolean(e.text),a=d*e.value;if(s){const s={ns:ns2,tag:"text",className:"b-scale-tick-label",html:e.text,dataset:{tick:e.value}};t?(s.x=100*a+"%",s.y="top"===i?"1.6em":n-12):(s.x="left"===i?"12":""+(r-12),s.y=100*(1-a)+"%"),c.push(s)}t?"top"===i?l.push("M"+a+",0 L"+a+","+(s?10:5)):l.push("M"+a+","+n+" L"+a+","+(n-(s?10:5))):"left"===i?l.push("M0,"+(1-a)+" L"+(s?10:5)+","+(1-a)):l.push("M"+r+","+(1-a)+" L"+(r-(s?10:5))+","+(1-a))}e.pathElement.setAttribute("d",l.join("")),DomSync.syncChildren({domConfig:{children:c}},e.unscaledSvgGroup)}};Scale.initClass(),Scale._$name="Scale";var AvatarRendering=class extends Base{static get $name(){return"AvatarRendering"}static get configurable(){return{element:null,colorPrefix:"b-sch-",tooltip:null,size:null}}doDestroy(){var e;null==(e=this.tooltip)||e.destroy(),super.doDestroy()}updateElement(e){EventHelper.on({element:e,delegate:".b-resource-image",error:"onImageErrorEvent",thisObj:this,capture:!0})}changeTooltip(e){return Tooltip.new({forElement:this.element,forSelector:".b-resource-avatar",cls:"b-resource-avatar-tooltip"},e)}static get failedUrls(){return this._failedUrls||(this._failedUrls=new Set),this._failedUrls}getResourceAvatar({initials:e,color:t,iconCls:r,imageUrl:n,defaultImageUrl:i,dataset:s={},resourceRecord:a,alt:o=StringHelper.encodeHtml(null==a?void 0:a.name)}){return this.getImageConfig(e,t,n,i,s,o)||this.getIconConfig(r,s)||this.getResourceInitialsConfig(e,t,s)}getImageConfig(e,t,r,n,i,s){const{size:a}=this;if(r=AvatarRendering.failedUrls.has(r)?n:r||n)return{tag:"img",draggable:"false",loading:"lazy",class:{"b-resource-avatar":1,"b-resource-image":1},...a?{style:{height:a+"px",width:a+"px"}}:void 0,alt:s,elementData:{defaultImageUrl:n,imageUrl:r,initials:e,color:t,dataset:i},src:r,dataset:i}}getIconConfig(e,t){if(e)return e&&{tag:"i",class:{"b-resource-avatar":1,"b-resource-icon":1,[e]:1},dataset:t}}getResourceInitialsConfig(e,t,r){const{size:n}=this,i=DomHelper.isNamedColor(t)&&t,s=!i&&t;return{tag:"div",class:{"b-resource-avatar":1,"b-resource-initials":1,[""+this.colorPrefix+i]:i},style:{backgroundColor:s||null,...n?{height:n+"px",width:n+"px"}:void 0},children:[e],dataset:r}}onImageErrorEvent({target:e}){if(!e.matches(".b-resource-avatar"))return;const{defaultImageUrl:t,initials:r,color:n,imageUrl:i,dataset:s}=e.elementData;if(t&&!e.src.endsWith(t.replace(/^[./]*/gm,"")))e.src=t;else{const t=DomHelper.createElement(this.getResourceInitialsConfig(r,n,s));t.elementData=e.elementData,e.parentElement.replaceChild(t,e)}AvatarRendering.failedUrls.add(i)}};AvatarRendering._$name="AvatarRendering",window&&!window.gantt&&(window.gantt={});var Location=class{constructor(e){if(e){if(e.isLocation)return e;if(e.nodeType===Node.ELEMENT_NODE){const t=Widget.fromElement(e,"gridbase"),r=t&&e.closest(t.focusableSelector);if(r){const{dataset:n}=r.parentNode;this.init({grid:t,rowIndex:t.store.includes(n.id)?t.store.indexOf(n.id):n.index||-1,columnId:r.dataset.columnId}),this.initialTarget=e}}else this.init(e)}}init(e){var t,r;const n=this,i=n.grid=e.grid,{store:s,columns:a}=i,{visibleColumns:o}=a;if(e.target&&(n.actionTargets=[n._target=e.target]),e.record)n._id=e.record.id;else if("id"in e)n._id=e.id,null==e.id&&(n._rowIndex=-1);else{const r=isNaN(e.row)?isNaN(e.rowIndex)?NaN:e.rowIndex:e.row;n._rowIndex=Math.max(Math.min(Number(r),s.count-1),i.hideHeaders?0:-1),n._id=null==(t=s.getAt(n._rowIndex))?void 0:t.id}if("_rowIndex"in n||(n._rowIndex=s.indexOf(n.id)),n.isSpecialRow=null==(r=n.record)?void 0:r.isSpecialRow,"columnId"in e)n._column=a.getById(e.columnId);else if("field"in e)n._column=a.get(e.field);else{const t=isNaN(e.column)?isNaN(e.columnIndex)?NaN:e.columnIndex:e.column;isNaN(t)?n._column="column"in e?isNaN(e.column)?e.column:o[e.column]:o[0]:(n._columnIndex=Math.min(Number(t),o.length-1),n._column=o[n._columnIndex])}"_columnIndex"in n||(n._columnIndex=o.indexOf(n._column))}get isLocation(){return!0}equals(e,t=!1){const r=this;return(null==e?void 0:e.isLocation)&&e.grid===r.grid&&(t?r.id===e.id&&r._column===e._column:e.record===r.record&&e.column===r.column&&e.target===r.target)}get rowIndex(){const{_id:e}=this,{store:t}=this.grid;return t.includes(e)?t.indexOf(e):Math.min(this._rowIndex,t.count-1)}get visibleRowIndex(){const{rowManager:e}=this.grid,{rowIndex:t}=this;return-1===t?t:Math.max(Math.min(t,e.lastFullyVisibleTow.dataIndex),e.firstFullyVisibleTow.dataIndex)}get isSelectable(){return this.grid.store.includes(this._id)&&!this.isSpecialRow}get record(){if(this._rowIndex>-1){const{store:e}=this.grid;return e.includes(this._id)?e.getById(this._id):e.getAt(this._rowIndex)}}get id(){return this._id}get column(){const{visibleColumns:e}=this.grid.columns;return(null==e?void 0:e.includes(this._column))?this._column:null==e?void 0:e[this.columnIndex]}get columnId(){var e;return null==(e=this.column)?void 0:e.id}get columnIndex(){var e;return Math.min(this._columnIndex,(null==(e=this.grid.columns.visibleColumns)?void 0:e.length)-1)}move(e){const t=this,{record:r,column:n,grid:i}=t,{store:s}=i,a=i.columns.visibleColumns,o=new Location;let l=s.includes(r)?s.indexOf(r):t.rowIndex,c=a.includes(n)?a.indexOf(n):t.columnIndex;const d=i.hideHeaders?0:-1,u=s.count-1,h=a.length-1,g=l===d,p=l===u,m=0===c,f=c===h;switch(e){case Location.PREV_CELL:m?g||(c=h,l--):c--;break;case Location.NEXT_CELL:f?p||(c=0,l++):c++;break;case Location.UP:g||l--;break;case Location.DOWN:p||(-1===l?l=i.rowManager.firstFullyVisibleRow.dataIndex:l++);break;case Location.FIRST_COLUMN:c=0;break;case Location.LAST_COLUMN:c=h;break;case Location.FIRST_CELL:l=d,c=0;break;case Location.LAST_CELL:l=u,c=h;break;case Location.PREV_PAGE:l=Math.max(d,l-Math.floor(i.scrollable.clientHeight/i.rowHeight));break;case Location.NEXT_PAGE:l=Math.min(u,l+Math.floor(i.scrollable.clientHeight/i.rowHeight))}return o.init({grid:i,rowIndex:l,columnIndex:c}),o}get cell(){var e,t;const r=this,{grid:n,id:i,_cell:s}=r;if(s)return s;if(null==i)return null==(e=n.columns.getById(r.columnId))?void 0:e.element;{const{row:e}=r;if(e)return e.getCell(r.columnId)||e.getCell(null==(t=n.columns.getAt(r.columnIndex))?void 0:t.id)}}get row(){return this.grid.getRowById(this.id)||this.grid.getRow(this.rowIndex)}get target(){const{cell:e,_target:t}=this,{focusableFinder:r}=this.grid;if(e)return t||(r.currentNode=this.grid.focusableFinderCell=e,r.nextNode()||e)}get isActionable(){const{cell:e,_target:t}=this,r=e&&DomHelper.getActiveElement(e),n=r&&e.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_CONTAINED_BY;return Boolean(n||t&&t!==this.cell)}get isColumnHeader(){return this.cell&&-1===this.rowIndex}get isCell(){return this.cell&&this.record}};Location.UP=1,Location.NEXT_CELL=2,Location.DOWN=3,Location.PREV_CELL=4,Location.FIRST_COLUMN=5,Location.LAST_COLUMN=6,Location.FIRST_CELL=7,Location.LAST_CELL=8,Location.PREV_PAGE=9,Location.NEXT_PAGE=10,Location._$name="Location";var validWidth=e=>"number"==typeof e||(null==e?void 0:e.endsWith("px")),Column=class extends(Model.mixin(Events_default,Localizable_default)){static get $name(){return"Column"}static get type(){return"column"}static get fields(){return["type","text","field","renderer","width","flex","autoWidth","autoHeight",{name:"fitMode",defaultValue:"exact"},"readOnly",{name:"editor",defaultValue:{}},"cellEditor","finalizeCellEdit",{name:"revertOnEscape",defaultValue:!0},{name:"invalidAction",defaultValue:"block"},{name:"sortable",defaultValue:!0,convert(e,t,r){if(!e)return!1;if(!0===e)return!0;const n={};return"function"==typeof e?(n.originalSortFn=e,n.sortFn=e.bind(r)):"object"==typeof e&&(Object.assign(n,e),n.fn&&(n.sortFn=n.fn,delete n.fn)),n}},{name:"searchable",defaultValue:!0},{name:"collapsible",defaultValue:!1},{name:"collapsed",defaultValue:!1},{name:"collapseMode"},{name:"filterable",defaultValue:!0,convert(e){if(!e)return!1;if(!0===e)return!0;const t={columnOwned:!0};return"function"==typeof e?t.filterFn=e:"object"==typeof e&&Object.assign(t,e),t}},{name:"sealed"},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltip","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},"maxWidth",{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"mergeCells",type:"boolean"},{name:"mergeable",type:"boolean",defaultValue:!0},"mergedRenderer",{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"htmlEncodeHeaderText",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},{name:"alwaysClearCell",defaultValue:!1},{name:"headerWidgets"},{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector",{name:"exportable",defaultValue:!0},{name:"exportedType"},{name:"ariaLabel",defaultValue:"L{Column.columnLabel}"},{name:"cellAriaLabel",defaultValue:"L{cellLabel}"}]}static get autoExposeFields(){return!1}construct(e,t){var r;const n=this;n.masterStore=t,t&&(n._grid=Array.isArray(t)?t[0].grid:t.grid),n.localizableProperties=Config.mergeMethods.distinct(e.localizableProperties,["text","ariaLabel","cellAriaLabel"]),e.localeClass&&(n.localeClass=e.localeClass),super.construct(...arguments),n.isLeaf&&!("field"in n.data)&&(n.field="_"+(n.type||"")+ ++Column.emptyCount,n.noFieldSpecified=!0),n.hasComplexMapping=null==(r=n.field)?void 0:r.includes("."),n.width||n.flex||n.children||n.set({width:Column.defaultWidth,flex:null},null,!0),n.headerWidgets&&n.initHeaderWidgets(n.headerWidgets),n.isParent&&(n.meta.visibleChildren=new Set,n.collapsible&&(n.collapsible=!0))}get isCollapsible(){var e;return(null==(e=this.children)?void 0:e.length)>1&&this.collapsible}get collapsed(){return this.get("collapsed")}set collapsed(e){this.set("collapsed",e,!0),this.onCollapseChange(!e),this.trigger("toggleCollapse",{collapsed:e})}onCellFocus(e){this.location=e,this.updateHeaderAriaLabel(this.localizeProperty("ariaLabel")),-1!==e.rowIndex&&this.updateCellAriaLabel(this.localizeProperty("cellAriaLabel"))}updateHeaderAriaLabel(e){DomHelper.setAttributes(this.element,{"aria-label":e})}updateCellAriaLabel(e){var t,r;!(null==(t=this.location)?void 0:t.isSpecialRow)&&(null==(r=this.location)?void 0:r.cell)&&((null==e?void 0:e.length)||(e=this.location.column.text),DomHelper.setAttributes(this.location.cell,{"aria-label":e}))}doDestroy(){var e,t,r;null==(r=null==(t=null==(e=this.data)?void 0:e.editor)?void 0:t.destroy)||r.call(t),this.destroyHeaderWidgets(),super.doDestroy()}set headerWidgets(e){this.initHeaderWidgets(e),this.set("headerWidgets",e)}get headerWidgets(){return this.get("headerWidgets")}initHeaderWidgets(e){this.destroyHeaderWidgets();const t=this.headerWidgetMap={};for(const r of e){const e=Widget.create({owner:this,...r});t[e.ref||e.id]=e}}destroyHeaderWidgets(){var e;for(const t of Object.values(this.headerWidgetMap||{}))null==(e=t.destroy)||e.call(t)}static generateAutoCls(){let e="";for(let t=this;t!==Column;t=t.superclass)t.type&&t.type!==t.superclass.type&&(e+="b-"+t.type.toLowerCase()+"-cell ");return(Column.autoClsMap||(Column.autoClsMap=new Map)).set(this,e),e}getCellClass(e){var t,r;const{record:n,column:i}=e,{cellCls:s,internalCellCls:a,grid:o,constructor:l,align:c}=i,d=(null==(t=Column.autoClsMap)?void 0:t.get(l))||l.generateAutoCls(),u=e.cell.classList.contains("b-editing"),h={[o.cellCls]:o.cellCls,[d]:d,[s]:s,[a]:a,"b-cell-dirty":n.isFieldModified(i.field)&&(i.compositeField||!1!==(null==(r=n.fieldMap[i.field])?void 0:r.persist)),["b-grid-cell-align-"+c]:c,"b-selected":o.selectionMode.cell&&o.isCellSelected(e),"b-focused":o.isFocused(e),"b-auto-height":i.autoHeight,"b-editing":u};return n.isSpecialRow&&h["b-checkbox-selection"]&&(h["b-checkbox-selection"]=!1),h}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get region(){return this.parent.isRoot?this.get("region"):this.parent.region}set region(e){this.set("region",e)}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}get editor(){const e=this;let{editor:t}=e.data;if(t&&!t.isWidget){const r=e.grid.processCellEditor({editor:t,field:e.field});r?t=e.data.editor=r.editor:("string"==typeof t&&(t={type:t}),t=e.data.editor=Widget.create(ObjectHelper.merge(e.defaultEditor,{owner:e.grid,label:StringHelper.encodeHtml(e.text)},t)))}return t}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}getFilterableValue(e){return this.getRawValue(e)}get owner(){return this._owner||this.subGrid}set owner(e){this._owner=e}get grid(){var e;return this._grid||(null==(e=this.parent)?void 0:e.grid)}set subGrid(e){this._subGrid=e}get subGrid(){var e;return this._subGrid||(null==(e=this.grid)?void 0:e.getSubGridFromColumn(this))}get subGridElement(){return this.subGrid.element}get element(){return this.grid.getHeaderElement(this)}get nextVisibleSibling(){const e=this.region;let t=this.nextSibling;for(;t&&(t.hidden||t.region!==e);)t=t.nextSibling;return t}get isLastInSubGrid(){return!this.nextVisibleSibling&&(this.parent.isRoot||this.parent.isLastInSubGrid)}get textWrapper(){return DomHelper.getChild(this.element,".b-grid-header-text")}get textElement(){return DomHelper.down(this.element,".b-grid-header-text-content")}get contentElement(){return DomHelper.down(this.element,".b-grid-header-children")}get isSorted(){return this.grid.store.sorters.some((e=>e.field===this.field))}get isFocusable(){return this.isLeaf}static get text(){return this.$meta.fields.defaults.text}get headerText(){return this.htmlEncodeHeaderText?StringHelper.encodeHtml(this.text):this.text}get isVisible(){return!this.hidden&&(!this.parent||this.parent.isVisible)}hide(e=!1,t=!1){const r=this,{parent:n}=r;if(!r.hidden){if(r.hidden=!0,n&&!n.isRoot&&!n.isTogglingAll){n.children.some((e=>!0!==e.hidden))||n.hidden||(e=!0,n.hide())}r.isParent?r.children.forEach((e=>e.hide(!0,!0))):n.isRoot||n.meta.visibleChildren[t?"add":"delete"](r),e||r.stores.forEach((e=>e.trigger("columnHide",{column:r})))}}show(e=!1){var t;const r=this,{parent:n}=r;r.hidden&&(r.hidden=!1,(null==n?void 0:n.hidden)&&n.show(),r.isParent&&(null==(t=r.meta.visibleChildren)||t.forEach((e=>e.show(!0)))),e||r.stores.forEach((e=>e.trigger("columnShow",{column:r}))))}toggle(e){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}toggleChildren(e=this.children,t=void 0){var r,n;const i=this;null==(r=i.grid.columns)||r.beginBatch(),i.isTogglingAll=!0,e.forEach((e=>e.toggle(t))),i.isTogglingAll=!1,null==(n=i.grid.columns)||n.endBatch()}onCollapseChange(e=void 0){var t,r;const n=this;if("toggleAll"===n.collapseMode)n.toggleChildren();else{const{firstChild:i}=n;null!=i.flex&&n.collapsed?(i.oldFlex=i.flex,i.width=i.element.offsetWidth):!n.collapsed&&i.oldFlex&&(i.flex=i.oldFlex,i.oldFlex=null),null==(t=n.grid.columns)||t.beginBatch(),n.isTogglingAll=!0,n.children.slice(1).forEach((t=>t.toggle(e))),n.isTogglingAll=!1,null==(r=n.grid.columns)||r.endBatch()}}set collapsible(e){const t=this;if(t.set("collapsible",e),t.isParent){const{headerWidgets:r=[]}=t;if(e)r.push({type:"button",ref:"collapseExpand",toggleable:!0,pressed:t.collapsed,icon:"gt-icon-collapse-"+(t.grid.rtl?"right":"left"),pressedIcon:"gt-icon-collapse-"+(t.grid.rtl?"left":"right"),cls:"b-grid-header-collapse-button b-transparent",onToggle:({pressed:e})=>t.collapsed=e});else{const e=r.findIndex((e=>"collapseExpand"===e.ref));e>-1&&r.splice(e,1)}t.headerWidgets=r,t.collapsed&&t.onCollapseChange(!1)}}get collapsible(){return this.get("collapsible")}generateId(){return Column.generatedIdIndex||(Column.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++Column.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}measureSize(e){var t;return DomHelper.measureSize(e,null==(t=this.subGrid)?void 0:t.element)}get calcMinWidth(){const{width:e,minWidth:t}=this.data;return validWidth(e)&&validWidth(t)?Math.max(parseInt(e)||0,parseInt(t)||0):e}get width(){return this.data.width}set width(e){const t={width:e};e&&"flex"in this.data&&(t.flex=null),this.set(t)}set flex(e){const t={flex:e};e&&"width"in this.data&&(t.width=null),this.set(t)}get flex(){return this.data.flex}calculateMinWidth(){const e=this,t=e.measureSize(e.width),r=e.measureSize(e.minWidth);let n=0;return e.children&&(n=e.children.reduce(((e,t)=>e+t.calculateMinWidth()),0)),Math.max(t,r,n)}resizeToFitContent(e,t,r=!1){const n=this,{grid:i,element:s,fitMode:a}=n,{rowManager:o,store:l}=i,{count:c}=l;if(c<=0||"none"===n.fitMode||!n.fitMode)return;const[d]=o.rows,{rowElement:u,cellElement:h}=i.beginGridMeasuring(),g=new Location({grid:i,column:n,id:null});let p,m,f,v,y,b,C=0,D={length:0,record:null};if(h._domData={columnId:n.id,row:d,rowElement:u},g._cell=h,g.updatingSingleRow=!0,g.isMeasuring=!0,h.innerHTML="",i.resizeToFitIncludesHeader){if(!i.$headerPadding){const e=globalThis.getComputedStyle(s);i.$headerPadding=parseInt(e.paddingLeft)}const e=s.querySelector(".b-grid-header-text-content");e.style.cssText="flex: none; width: auto",C=e.offsetWidth+2*i.$headerPadding+2,e.style.cssText=""}for(c>1e3?(p=Math.max(Math.min(o.topIndex+Math.round(o.rowCount/2)-500,c-1e3),0),m=p+1e3):(p=0,m=c),f=p;f<m;f++){if(v=l.getAt(f),y=n.getRawValue(v),"value"===a)b=String(y).length;else if(g._record=D.record,g._id=v.id,g._rowIndex=f,d.renderCell(g),"textContent"===a)b=h.textContent.length;else{const e=h.offsetWidth;e>C&&(C=e)}b>D.length&&(D={record:v,length:b,rowIndex:f})}return D.length>0&&("value"===a||"textContent"===a)&&(g._record=D.record,g._id=D.record.id,g._rowIndex=D.rowIndex,d.renderCell(g),C=Math.max(C,h.offsetWidth)),Array.isArray(e)&&([e,t]=e),C=Math.max(C,e||0),C=Math.min(C,t||1e6),r||i.endGridMeasuring(),n.width=n.maxWidth?C=Math.min(C,n.maxWidth):C,C}getState(){const e=this,t={id:e.id,hidden:e.hidden,region:e.region,locked:e.locked};return e.children||(t[e.flex?"flex":"width"]=e.flex||e.width),e.isCollapsible&&(t.collapsed=e.collapsed),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"region"in e&&(t.region=e.region),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden),"collapsed"in e&&(t.collapsed=e.collapsed)}remove(){const{subGrid:e,grid:t}=this,r=e&&(null==t?void 0:t.focusedCell);(null==r?void 0:r.columnId)===this.id&&(t.owns(DomHelper.getActiveElement(t))?t.navigateRight():t._focusedCell=new Location({grid:t,rowIndex:r.rowIndex,column:e.columns.getAdjacentVisibleLeafColumn(this.id,!0,!0)})),super.remove()}getRawValue(e){return this.hasComplexMapping?ObjectHelper.getPath(e,this.field):e[this.field]}refreshCell(e){this.grid.rowManager.refreshCell(e,this.id)}clearCell(e){e.innerHTML="",delete e._content}canEdit(e){if(e.isEditable){const t=e.isEditable(this.field);if(void 0!==t)return t}return!0}insertChild(e,t=null,r=!1){return(e=Array.isArray(e)?e:[e]).forEach((e=>{const{parent:t}=e;(null==t?void 0:t.collapsed)&&e===t.firstChild&&t.children.length>1&&1===t.children.filter((e=>!e.hidden)).length&&(e.nextSibling.hidden=!1)})),this.sealed&&!this.inProcessChildren?null:super.insertChild(...arguments)}canFillValue(){return!0}getCurrentConfig(e){var t;const r=super.getCurrentConfig(e);return(null==(t=this.sortable)?void 0:t.originalSortFn)&&(r.sortable=this.sortable.originalSortFn),r.renderer===this.internalRenderer&&delete r.renderer,r.headerRenderer===this.internalHeaderRenderer&&delete r.headerRenderer,delete r.ariaLabel,delete r.cellAriaLabel,r}};Column.emptyCount=0,Column.defaultWidth=100,Column.exposeProperties(),Column._$name="Column";var columnDefinitions={boolean:{type:"check"},date:{type:"date"},integer:{type:"number",format:{maximumFractionDigits:0}},number:{type:"number"}},lockedColumnSorters=[{field:"region"}],ColumnStore=class extends(Localizable_default(Store)){static get defaultConfig(){return{modelClass:Column,tree:!0,autoAddField:!1,syncDataOnLoad:{threshold:1},sorters:lockedColumnSorters}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=e.grid.id+"-columns",e.grid.ion({subGridCollapse:"clearSubGridCaches",subGridExpand:"clearSubGridCaches",thisObj:t})),super.construct(e),t.ion({change:t.onStoreChange,sort:()=>t.updateChainedStores(),thisObj:t,prio:1})}doDestroy(){const e=[];this.isChained||this.traverse((t=>e.push(t))),super.doDestroy(),this.isChained||e.forEach((e=>e.destroy()))}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.traverseWhile(((r,n)=>e.call(t,r,n)),!0)}get totalFixedWidth(){let e=0;for(const t of this)t.hidden||(t.children?t.children.forEach((t=>e+=this.calculateFixedWidth(t))):e+=this.calculateFixedWidth(t));return e}get hasFlex(){return this.visibleColumns.some((e=>e.flex))}calculateFixedWidth(e){return e.flex?e.measureSize(Column.defaultWidth):Math.max(e.measureSize(e.width),e.measureSize(e.minWidth))}get topColumns(){return this.isChained?this.masterStore.rootNode.children.filter(this.chainedFilterFn):this.rootNode.children}get visibleColumns(){const e=this;return e._visibleColumns||(e._visibleColumns=e.leaves.filter((e=>e.isVisible&&(!e.subGrid||!e.subGrid.collapsed)))),e._visibleColumns}onStoreChange({action:e,changes:t}){("update"!==e||"hidden"in t)&&this.clearCaches()}clearSubGridCaches({subGrid:e}){e.columns.clearCaches(),this.clearCaches()}clearCaches(){var e;this._visibleColumns=null,null==(e=this.masterStore)||e.clearCaches()}onMasterDataChanged(e){super.onMasterDataChanged(e),("update"!==e.action||"hidden"in e.changes)&&this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,r=!1){const n=this.visibleColumns,i=e instanceof Column?e:this.getById(e);let s=n.indexOf(i)+(t?1:-1);if(!n[s]){if(!r)return null;s=t?0:n.length-1}return n[s]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(e){var t,r;const{grid:n={}}=this,{store:i}=n,s=null==(r=null==(t=null==i?void 0:i.modelClass)?void 0:t.fieldMap)?void 0:r[e.field];let a=this.modelClass;if((null==s?void 0:s.column)&&(e=Objects.merge({},s.column,e)),e.type&&(a=ColumnStore.getColumnClass(e.type),!a))throw new Error("Column type '"+e.type+"' not registered");e.locked&&(e.region="locked",delete e.locked);const o=new a(e,this);if(o.data.region||(o.data.region=n.defaultRegion||"normal"),this.autoAddField&&!o.noFieldSpecified&&i&&!s){let e=o.field;o.constructor.fieldType&&(e={name:o.field,type:o.constructor.fieldType}),i.modelClass.addField(e)}return o}indexOf(e){if(null==e)return-1;const t=super.indexOf(e);return t>-1?t:this.records.findIndex((t=>t.field===e))}get usesAutoHeight(){return this.find((e=>e.autoHeight))}get usesFlexAutoHeight(){return this.find((e=>e.autoHeight&&null!=e.flex))}resolveSyncNode(e){return e.id?super.resolveSyncNode(e):e.field?{id:e.field,node:this.allRecords.find((t=>t.field===e.field))}:e.type?{id:e.type,node:this.allRecords.find((t=>t.type===e.type))}:{id:null,node:null}}static registerColumnType(e,t=!1){e.simpleRenderer=t,(ColumnStore.columnTypes||(ColumnStore.columnTypes={}))[e.type]=e}static getColumnClass(e){return ColumnStore.columnTypes&&ColumnStore.columnTypes[e]}generateColumnForField(e,t){var r;"string"==typeof e&&this.grid&&(e=null==(r=this.grid.store)?void 0:r.modelClass.fieldMap[e]);let n=e.column||columnDefinitions[e.type]||{};return"string"==typeof n&&(n={type:n}),n=Object.assign({text:e.text||StringHelper.separate(e.name),field:e.name},t,n),null!=e.precision&&(n.format.maximumFractionDigits=e.precision),e.columnType&&(n.type=e.columnType),this.createRecord(n)}},columnResizeEvent=(e,t)=>({update:({store:r,record:n,changes:i})=>{let s=!0;return("width"in i||"minWidth"in i||"maxWidth"in i||"flex"in i)&&(s=e.call(t,{store:r,record:n,changes:i})),s}});ColumnStore.registerColumnType(Column,!0),ColumnStore._$name="ColumnStore";var ActionColumn=class extends Column{get groupHeaderReserved(){return!0}construct(e,t){const r=this;super.construct(...arguments),e.width||e.flex||r.grid.ion({paint:"updateAutoWidth",thisObj:r}),r.disableIfGridReadOnly&&r.grid.element.classList.add("b-actioncolumn-readonly"),r.externalRenderer=r.renderer,r.renderer=r.internalRenderer}internalRenderer({grid:e,column:t,record:r,callExternalRenderer:n=!0}){var i,s;const a=r&&"groupRowFor"in r.meta,{subGrid:o}=t;return n&&(null==(i=this.externalRenderer)||i.call(this,...arguments)),{className:{"b-action-ct":1},children:null==(s=t.actions)?void 0:s.map(((e,n)=>{var i;if("visible"in e){if("function"==typeof e.visible&&!1===e.visible({record:r}))return"";if(!1===e.visible)return""}if(a&&!e.showForGroup||!a&&e.showForGroup)return"";const{tooltip:s,renderer:l}=e,c="function"==typeof s||(null==(i=null==s?void 0:s.startsWith)?void 0:i.call(s,"up."))?o.callback(s,o,[{record:r}]):s||"";if(l){const i=o.callback(l,o,[{index:n,record:r,column:t,tooltip:c,action:e}]);return"string"==typeof i?{tag:"span",dataset:{...Tooltip.encodeConfig(c),index:n},html:i}:(i.dataset=i.dataset||{},i.dataset.index=n,i)}return{tag:"button",dataset:{...Tooltip.encodeConfig(c),index:n},"aria-label":c,className:{"b-tool":1,"b-action-item":1,[e.cls]:e.cls}}}))}}onCellClick({grid:e,column:t,record:r,target:n}){var i;if(t!==this||!n.classList.contains("b-action-item"))return;let s=n.dataset.index;s||(s=n.parentElement.dataset&&n.parentElement.dataset.index);const a=null==(i=t.actions)?void 0:i[s],o=a&&a.onClick;o&&this.callback(o,t,[{record:r,action:a,target:n}])}updateAutoWidth(){const e=this,t=[],{actions:r}=e;if(!e.element)return;const n=e.actions=[];null==r||r.forEach((e=>{const r={...e};delete r.visible,r.showForGroup?(delete r.showForGroup,t.push(r)):n.push(r)})),t.length>n.length&&(e._actions=t);const i=DomHelper.createElement(e.internalRenderer({column:e,callExternalRenderer:!1})).outerHTML;e.width=DomHelper.measureText(i,e.element,!0,e.element.parentElement),e.actions=r}};__publicField(ActionColumn,"type","action"),__publicField(ActionColumn,"fields",[{name:"actions",type:"array"},{name:"disableIfGridReadOnly",defaultValue:!1}]),__publicField(ActionColumn,"defaults",{filterable:!1,groupable:!1,sortable:!1,editor:!1,searchable:!1,htmlEncode:!1,resizable:!1,minWidth:30}),ColumnStore.registerColumnType(ActionColumn),ActionColumn.exposeProperties(),ActionColumn._$name="ActionColumn";var NumberColumn=class extends Column{static get defaults(){return{filterType:"number",format:""}}get defaultEditor(){const{format:e,name:t,max:r,min:n,step:i,largeStep:s,align:a}=this;return ObjectHelper.cleanupProperties({type:"numberfield",format:e,name:t,max:r,min:n,step:i,largeStep:s,textAlign:a})}get formatter(){const e=this,{format:t}=e;let r=e._formatter;return r&&e._lastFormat===t||(e._formatter=r=NumberFormat.get(e._lastFormat=t)),r}formatValue(e){return null!=e&&(e=this.formatter.format(e),this.unit&&(e=""+e+this.unit)),null!=e?e:""}defaultRenderer({value:e}){return this.formatValue(e)}};__publicField(NumberColumn,"type","number"),__publicField(NumberColumn,"fieldType","number"),__publicField(NumberColumn,"fields",["format","min","max","step","largeStep","unit"]),ColumnStore.registerColumnType(NumberColumn,!0),NumberColumn.exposeProperties(),NumberColumn._$name="NumberColumn";var AggregateColumn=class extends NumberColumn{static get defaults(){return{function:"sum",includeParentInChangeSet:!1}}construct(e,t){this.configuredAlign="align"in e,this.configuredEditor="editor"in e,super.construct(...arguments);const{grid:r}=t;"sum"===this.function&&(this.function="sumChildren"),r&&(this.store=r.store)}set store(e){const t=this,r={update:"onRecordUpdate",thisObj:t,prio:1e3},n=t._store;if(e!==n){n&&n.un(r),t._store=e;const{modelClass:i}=e,s=i.fieldMap[t.field];s&&"number"===s.type&&(t.configuredAlign||(t.align="end"),t.configuredEditor||(t.editor="number")),e.ion(r)}}canEdit(e){return e.isLeaf}get store(){return this._store}sumChildren(...e){let t=0;for(let r=0,{length:n}=e;r<n;r++)t+=parseFloat(e[r]||0,10);return t}avg(...e){let t=0;const{length:r}=e;for(let n=0;n<r;n++)t+=parseFloat(e[n]||0,10);return t/r}onRecordUpdate({record:e,changes:t}){const r=this,{rowManager:n}=r.grid;r.field in t&&e.isLeaf&&e.bubble((e=>{const t=n.getRowFor(e);if(t){const e=t.getCell(r.field);e&&t.renderCell(e)}}),!0)}getRawValue(e){var t;let r=0;if(null==(t=e.children)?void 0:t.length){const t=this,n=t.function,i="string"==typeof n&&"function"==typeof Math[n],{handler:s,thisObj:a}=i?{handler:Math[n],thisObj:Math}:t.resolveCallback(n);r=s.apply(a,e.children.map((e=>t.getRawValue(e)))),t.includeParentInChangeSet?e.set(t.field,r,!0):e.setData(t.field,r)}else r=e[this.field];return r}canFillValue(){return!1}};__publicField(AggregateColumn,"type","aggregate"),__publicField(AggregateColumn,"fields",["function","includeParentInChangeSet"]),ColumnStore.registerColumnType(AggregateColumn,!0),AggregateColumn.exposeProperties(),AggregateColumn._$name="AggregateColumn";var WidgetColumn=class extends Column{static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1,fitMode:!1,alwaysClearCell:!1}}construct(e,t){const r=this;r.widgetMap={},super.construct(...arguments),r.externalRenderer=r.renderer,r.renderer=r.internalRenderer}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}updateReadOnly(e){for(const t of Object.values(this.widgetMap))t.cellInfo.record.readOnly||(t.readOnly=e)}internalRenderer(e){var t;const r=this,{cellElement:n,column:i,record:s,isExport:a}=e,{widgets:o}=i;return!a&&o&&(n.widgets||r.clearCell(n),n.widgets=e.widgets=o.map(((t,a)=>{var o,l;let c,d;if(n.widgets&&(c=n.widgets[a],d=c.element.nextElementSibling,t.recreate&&c&&(delete r.widgetMap[c.id],c.destroy(),n.widgets[a]=null)),c||(r.onBeforeWidgetCreate(t,e),t.recomposeAsync=!1,t.owner=r,c=WidgetHelper.append(t,d?{insertBefore:d}:n)[0],r.widgetMap[c.id]=c,r.onAfterWidgetCreate(c,e),c.name&&c.ion({change:({value:e,userAction:t})=>{t&&(c.cellInfo.record[c.name]=e)}})),c.cellInfo={record:s,column:i},r.grid&&!r.meta.isSelectionColumn&&(c.readOnly=r.grid.readOnly||s.readOnly),!1!==(null==(o=r.onBeforeWidgetSetValue)?void 0:o.call(r,c,e))){const r=t.valueProperty||"value"in c&&"value"||c.defaultBindProperty;if(r){const t=c.name?s[c.name]:e.value;c[r]=t}}return null==(l=r.onAfterWidgetSetValue)||l.call(r,c,e),c}))),a?null:null==(t=this.externalRenderer)?void 0:t.call(this,e)}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach((e=>{delete this.widgetMap[e.id],e.destroy()})),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}};__publicField(WidgetColumn,"$name","WidgetColumn"),__publicField(WidgetColumn,"type","widget"),__publicField(WidgetColumn,"fields",["widgets"]),ColumnStore.registerColumnType(WidgetColumn),WidgetColumn.exposeProperties(),WidgetColumn._$name="WidgetColumn";var CheckColumn=class extends WidgetColumn{construct(e,t){var r;super.construct(...arguments);const n=this;if(Object.assign(n,{externalHeaderRenderer:n.headerRenderer,externalOnBeforeWidgetSetValue:n.onBeforeWidgetSetValue,externalOnAfterWidgetSetValue:n.onAfterWidgetSetValue,onBeforeWidgetSetValue:n.internalOnBeforeWidgetSetValue,onAfterWidgetSetValue:n.internalOnAfterWidgetSetValue,headerRenderer:n.internalHeaderRenderer}),!n.meta.isSelectionColumn){const e=null==(r=n.grid)?void 0:r.store.modelClass;n.field?!e||e.fieldMap[n.field]||n.constructor.suppressNoModelFieldWarning||(console.warn(n.$$name+" is configured with a field, but this is not part of your Model `fields` collection."),e.addField({name:n.field,type:"boolean"})):console.warn("CheckColumn MUST be configured with a field, otherwise the checked state will not be persistent. Widgets are recycled and reused")}}doDestroy(){var e;null==(e=this.headerCheckbox)||e.destroy(),super.doDestroy()}internalHeaderRenderer({headerElement:e,column:t}){let r;return e.classList.add("b-check-header"),t.showCheckAll?(e.classList.add("b-check-header-with-checkbox"),t.headerCheckbox?e.appendChild(t.headerCheckbox.element):t.headerCheckbox=new Checkbox({appendTo:e,owner:this.grid,ariaLabel:"L{Checkbox.toggleSelection}",internalListeners:{change:"onCheckAllChange",thisObj:t}})):r=t.headerText,r=t.externalHeaderRenderer?t.externalHeaderRenderer.call(this,...arguments):r,t.showCheckAll?void 0:r}updateCheckAllState(e){this.headerCheckbox&&(this.suspendEvents(),this.headerCheckbox.checked=e,this.resumeEvents())}onCheckAllChange({checked:e}){const t=this;if(t.field){const{store:r}=t.grid;r.beginBatch(),r.forEach((r=>t.updateRecord(r,t.field,e))),r.endBatch()}t.trigger("toggleAll",{checked:e})}internalRenderer({value:e,isExport:t,record:r,cellElement:n}){if(t)return null==e?"":e;const i=super.internalRenderer(...arguments);return r.readOnly&&!this.meta.isSelectionColumn&&(n.widgets[0].readOnly=!0),e?n.widgets[0].input.setAttribute("checked",!0):n.widgets[0].input.removeAttribute("checked"),i}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.ion({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}internalOnBeforeWidgetSetValue(e){var t;e.record=e.cellInfo.record,this.isInitialSet=!0,null==(t=this.externalOnBeforeWidgetSetValue)||t.call(this,...arguments)}internalOnAfterWidgetSetValue(e){var t;this.isInitialSet=!1,null==(t=this.externalOnAfterWidgetSetValue)||t.call(this,...arguments)}onBeforeCheckboxChange({source:e,checked:t,userAction:r}){const n=this,{grid:i}=n,{record:s}=e.cellInfo;return!(r&&n.field&&(!i.features.cellEdit||i.features.cellEdit.disabled)||n.meta.isSelectionColumn&&!i.isSelectable(s)&&t)&&(n.isInitialSet?void 0:n.trigger("beforeToggle",{record:s,checked:t}))}onCheckboxChange({source:e,checked:t}){if(!this.isInitialSet){const r=this,{record:n}=e.cellInfo,{field:i}=r;i&&(r.updateRecord(n,i,t),t?r.updateCheckAllState(r.grid.store.every((e=>e[i]),null,!0)):r.updateCheckAllState(!1)),r.trigger("toggle",{record:n,checked:t})}}updateRecord(e,t,r){const n="set"+StringHelper.capitalize(t);e[n]?e[n](r):e.set(t,r)}onCellKeyDown({event:e,cellElement:t}){if(" "===e.key){const r=t.widget;null==r||r.toggle(),e.preventDefault(),e.handled=!0}}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.onBeforeWidgetSetValue,delete t.onAfterWidgetSetValue,this.externalOnBeforeWidgetSetValue&&(t.onBeforeWidgetSetValue=this.externalOnBeforeWidgetSetValue),this.externalOnAfterWidgetSetValue&&(t.onAfterWidgetSetValue=this.externalOnAfterWidgetSetValue),t}};__publicField(CheckColumn,"$name","CheckColumn"),__publicField(CheckColumn,"type","check"),__publicField(CheckColumn,"fields",["checkCls","showCheckAll","onAfterWidgetSetValue","onBeforeWidgetSetValue","callOnFunctions","onBeforeToggle","onToggle","onToggleAll"]),__publicField(CheckColumn,"defaults",{align:"center",checkCls:null,showCheckAll:!1,sortable:!0,filterable:!0,widgets:[{type:"checkbox",valueProperty:"checked"}]}),ColumnStore.registerColumnType(CheckColumn,!0),CheckColumn._$name="CheckColumn";var DateColumn=class extends Column{static get defaults(){return{format:"L",step:1,minWidth:85,filterType:"date"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=DateHelper.parse(e,this.format||void 0)),DateHelper.format(e,this.format||void 0)}set format(e){const{editor:t}=this.data;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){const e=this,{min:t,max:r,step:n,format:i}=e;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",weekStartDay:e.grid.weekStartDay,format:i,max:r,min:t,step:n}}};__publicField(DateColumn,"$name","DateColumn"),__publicField(DateColumn,"type","date"),__publicField(DateColumn,"fieldType","date"),__publicField(DateColumn,"fields",["format","pickerFormat","step","min","max"]),ColumnStore.registerColumnType(DateColumn,!0),DateColumn.exposeProperties(),DateColumn._$name="DateColumn";var PercentColumn=class extends NumberColumn{static get defaults(){return{min:0,max:100,showValue:!1,lowThreshold:20,htmlEncode:!1,searchable:!1,summaryRenderer:e=>e+"%",fitMode:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}defaultRenderer({value:e}){return{className:"b-percent-bar-outer",role:"progressbar","aria-Valuemin":0,"aria-Valuemax":100,"aria-Valuenow":e=e||0,tabIndex:0,children:[{tag:"div",className:{"b-percent-bar":1,"b-zero":0===e,"b-low":e<this.lowThreshold},style:{width:e+"%"},children:[this.showValue?{tag:"span",text:e+"%"}:void 0]}]}}resizeToFitContent(){}};__publicField(PercentColumn,"type","percent"),__publicField(PercentColumn,"fieldType","number"),__publicField(PercentColumn,"fields",["showValue","lowThreshold"]),PercentColumn.sum="average",ColumnStore.registerColumnType(PercentColumn,!0),PercentColumn._$name="PercentColumn";var RatingColumn=class extends NumberColumn{static get defaults(){return{min:0,max:5,emptyIcon:"gt-icon gt-icon-star",filledIcon:"gt-icon gt-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,minWidth:"11.2em",editor:!1,fitMode:"value"}}renderer({value:e}){return{className:{"b-rating-cell-inner":1,"b-not-editable":!this.editable},children:ArrayHelper.populate(this.max,(t=>{const r=t<e;return{tag:"i",className:{"b-rating-icon":!0,"b-filled":r,"b-empty":!r,[r?this.filledIcon:this.emptyIcon]:!0}}}))}}onCellClick({grid:e,column:t,record:r,target:n,event:i}){if(n.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(n.parentNode.childNodes,n);n.classList.contains("b-filled")&&(i.metaKey||i.shiftKey)&&(e-=1),1===r.get(t.field)&&0===e&&(e=-1),r.set(t.field,e+1)}}};__publicField(RatingColumn,"$name","RatingColumn"),__publicField(RatingColumn,"type","rating"),__publicField(RatingColumn,"fieldType","number"),__publicField(RatingColumn,"fields",["emptyIcon","filledIcon","editable"]),ColumnStore.registerColumnType(RatingColumn,!0),RatingColumn.exposeProperties(),RatingColumn._$name="RatingColumn";var RowNumberColumn=class extends Column{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,draggable:!1,minWidth:40,width:40,align:"center",text:"序号",editor:!1,readOnly:!0}}construct(e){super.construct(...arguments);const t=this,{grid:r}=t;t.internalCellCls="b-row-number-cell",t.externalHeaderRenderer=t.headerRenderer,t.headerRenderer=t.internalHeaderRenderer,r&&(r.ion({bindStore:"bindStore",thisObj:t}),t.bindStore({store:r.store,initial:!0}),r.store.count&&!r.rendered&&r.ion({paint:"resizeToFitContent",thisObj:t,once:!0}))}get groupHeaderReserved(){return!0}bindStore({store:e,initial:t}){const r=this;r.detachListeners("grid"),e.ion({name:"grid",["change"+r.grid.asyncEventSuffix]:"onStoreChange",thisObj:r}),t||r.resizeToFitContent()}onStoreChange({action:e}){"dataset"!==e&&"add"!==e&&"remove"!==e&&"removeall"!==e||this.resizeToFitContent()}renderer({record:e,grid:t}){return e.isSpecialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const{grid:e}=this,{store:t}=e,{count:r}=t;if(r&&!this.hidden){const t=e.element.querySelector('.b-grid-cell[data-column-id="'+this.id+'"]');if(t){const e=parseInt(DomHelper.getStyleValue(t,"padding-left")),n=DomHelper.measureText(r,t);this.width=Math.max(this.minWidth,n+2*e)}}}set flex(e){}internalHeaderRenderer({headerElement:e,column:t}){var r;return e.classList.add("b-rownumber-header"),(null==(r=t.externalHeaderRenderer)?void 0:r.call(this,...arguments))||t.headerText}};__publicField(RowNumberColumn,"$name","RowNumberColumn"),__publicField(RowNumberColumn,"type","rownumber"),ColumnStore.registerColumnType(RowNumberColumn,!0),RowNumberColumn._$name="RowNumberColumn";var TemplateColumn=class extends Column{static get defaults(){return{htmlEncode:!1}}constructor(e,t){super(...arguments);if(!this.template)throw new Error("TemplateColumn needs a template");if("function"!=typeof this.template)throw new Error("TemplateColumn.template must be a function")}renderer(e){if(!e.record.isSpecialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}};__publicField(TemplateColumn,"type","template"),__publicField(TemplateColumn,"fields",["template"]),ColumnStore.registerColumnType(TemplateColumn,!0),TemplateColumn.exposeProperties(),TemplateColumn._$name="TemplateColumn";var TimeColumn=class extends Column{static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=DateHelper.parse(e,this.format)),DateHelper.format(e,this.format)}set format(e){const{editor:t}=this;this.set("format",e),t&&(t.format=e)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}};__publicField(TimeColumn,"type","time"),__publicField(TimeColumn,"fieldType","date"),__publicField(TimeColumn,"fields",["format"]),ColumnStore.registerColumnType(TimeColumn,!0),TimeColumn.exposeProperties(),TimeColumn._$name="TimeColumn";var currentParentHasIcon=!1,TreeColumn=class extends Column{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"gt-icon gt-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"gt-icon gt-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"indentSize",defaultValue:1.1},{name:"leafIconCls",defaultValue:"gt-icon gt-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"},"renderer"]}constructor(e,t){super(...arguments);const r=this;r.shouldHtmlEncode=r.htmlEncode,r.setData("htmlEncode",!1),r.renderer&&(r.originalRenderer=r.renderer),r.renderer=r.treeRenderer.bind(r)}treeRenderer(e){var t,r,n,i;const s=this,{grid:a,column:o,cellElement:l,row:c,record:d,isExport:u}=e,h=d.instanceMeta(a.store),g=!d.isLeaf&&h.collapsed,p={className:"b-tree-cell-value"},m=[p],f={className:"b-tree-cell-inner",tag:d.href?"a":"div",href:d.href,target:d.target,children:m},v={"b-tree-parent-row":0,"b-tree-collapsed":0,"b-tree-expanded":0,"b-loading-children":0};let y,b,{value:C}=e;if(s.originalRenderer){const r=s.originalRenderer(e),n=null==(t=a.hasFrameworkRenderer)?void 0:t.call(a,{cellContent:r,column:o});y="object"==typeof r&&!n,C=n?"":!1===r?l.innerHTML:r,e.rendererHtml=r}if(y||(C=String(null!=C?C:"")),u)return C;if(d.isLeaf)l.classList.add("b-tree-leaf-cell"),b=e.iconCls||d.iconCls||s.leafIconCls;else{const t=!d.isExpanded(a.store),n=t?s.expandIconCls:s.collapseIconCls,i=t?s.collapsedFolderIconCls:s.expandedFolderIconCls;v["b-tree-parent-row"]=1,v["b-tree-collapsed"]=t,v["b-tree-expanded"]=!t,v["b-loading-children"]=h.isLoadingChildren,l.classList.add("b-tree-parent-cell"),m.unshift({tag:"i",className:{"b-tree-expander":1,[n]:1,"b-empty-parent":!h.isLoadingChildren&&!0!==d.children&&!(null==(r=d.children)?void 0:r.length)}}),currentParentHasIcon=b=e.iconCls||d.iconCls||i}if(b&&m.splice(m.length-1,0,{tag:"i",className:{"b-tree-icon":1,[b]:1}}),c.isRow&&(c.assignCls(v),!d.isLeaf))if(c.setAttribute("aria-expanded",!g),g)c.removeAttribute("aria-owns");else for(const e in a.subGrids){const t=c.elements[e];DomHelper.setAttributes(t,{"aria-owns":(null==(n=d.children)?void 0:n.length)?null==(i=d.children)?void 0:i.map((t=>a.id+"-"+e+"-"+t.id)).join(" "):null})}y||s.shouldHtmlEncode||!C.includes("<")?(y&&Object.assign(p,C),p.children=p.children||[],p.children.unshift(y?null:C)):p.html=C;const D=d.childLevel*s.indentSize+(d.isLeaf?currentParentHasIcon?2:b?.5:.4:0);return f.style="padding-inline-start:"+D+"em",f}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.renderer=this.originalRenderer,t}};__publicField(TreeColumn,"$name","TreeColumn"),__publicField(TreeColumn,"type","tree"),ColumnStore.registerColumnType(TreeColumn,!0),TreeColumn.exposeProperties(),TreeColumn._$name="TreeColumn";var GridRowModel=class extends Model{static get fields(){return[{name:"iconCls",internal:!0},{name:"cls",internal:!0},{name:"rowHeight",internal:!0},{name:"href",internal:!0},{name:"target",internal:!0}]}};GridRowModel.exposeProperties(),GridRowModel._$name="GridRowModel";var consumerToFeatureMap=new Map,consumerToDefaultFeatureMap=new Map,DEFAULT_FOR_TYPE="Grid",remapToBase={Grid:"GridBase",Scheduler:"SchedulerBase",SchedulerPro:"SchedulerProBase",Gantt:"GanttBase"},classNameFix=/\$\d+$/,GridFeatureManager=class{static registerFeature(e,t=!1,r=null,n=null){n=(n=StringHelper.uncapitalize(n||Object.prototype.hasOwnProperty.call(e,"$name")&&e.$$name||e.name)).replace(classNameFix,""),Array.isArray(r)||(r=[r||DEFAULT_FOR_TYPE]),r.forEach((r=>{const i=remapToBase[r]||r,s=consumerToFeatureMap.get(i)||new Map,a=consumerToDefaultFeatureMap.get(i)||new Map;s.set(n,e),a.set(e,t),consumerToFeatureMap.set(i,s),consumerToDefaultFeatureMap.set(i,a)}))}static getTypeNameFeatures(e=DEFAULT_FOR_TYPE){const t=remapToBase[e]||e,r=consumerToFeatureMap.get(t),n={};return r&&r.forEach(((e,t)=>n[t]=e)),n}static getTypeNameDefaultFeatures(e=DEFAULT_FOR_TYPE){const t=remapToBase[e]||e,r=consumerToFeatureMap.get(t),n=consumerToDefaultFeatureMap.get(t),i={};return r&&n&&r.forEach(((e,t)=>{n.get(e)&&(i[t]=e)})),i}static getInstanceFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.assign(e,this.getTypeNameFeatures(t))),{})}static getInstanceDefaultFeatures(e){return e.$meta.names.reduce(((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce(((e,[r,n])=>(this.isDefaultFeatureForTypeName(n,t)?e[r]=n:delete e[r],e)),e)),{})}static isDefaultFeatureForTypeName(e,t=DEFAULT_FOR_TYPE){const r=remapToBase[t]||t,n=consumerToDefaultFeatureMap.get(r);return n&&n.get(e)||!1}static isDefaultFeatureForInstance(e,t){const r=t.$meta.names.slice().reverse();let n=null;for(let t=0,i=r.length;t<i&&null===n;++t){const i=consumerToDefaultFeatureMap.get(r[t]);i&&i.has(e)&&(n=i.get(e))}return n||!1}static reset(){consumerToFeatureMap.clear(),consumerToDefaultFeatureMap.clear()}},CellCopyPaste=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"entityName","cell")}afterConstruct(){super.afterConstruct(),this.afterSelectionModeChange()}afterSelectionModeChange(){const e=this;e.client.selectionMode.cell?e._disabledBySelectionMode&&(e.disabled=!1,delete e._disabledBySelectionMode):e.disabled=!0}get copyOnly(){var e;return this._copyOnly||!(null==(e=this.client.features.cellEdit)?void 0:e.enabled)}get canCopy(){var e;const{client:t}=this;return Boolean(!this.disabled&&t.selectedCells.length&&(!t._selectedRows.length||(null==(e=t.features.rowCopyPaste)?void 0:e.disabled)||t.focusedCell&&t.isCellSelected(t.focusedCell)))}get canCutPaste(){var e;return this.canCopy&&!this.copyOnly&&!(null==(e=this.client.features.cellEdit)?void 0:e.isEditing)&&!this.client.readOnly}isActionAvailable(e,t){return this.canCopy&&("copy"===t||this.canCutPaste)}async sendToClipboard(e){var t,r;const n=this;let i=0,s=0,a="";e.sort(((e,t)=>e.rowIndex===t.rowIndex?e.columnIndex-t.columnIndex:e.rowIndex-t.rowIndex));for(const o of e){const{record:e,column:l,rowIndex:c,columnIndex:d}=o;c>i?(a.length>0&&(a+="\n".repeat(c-i)),i=c,s=d):d>s&&(a.length>0&&(a+="\t".repeat(d-s)),s=d);let u=null==(t=l.toClipboardString)?void 0:t.call(l,o);void 0===u&&(u=null==(r=e.get(l.field))?void 0:r.toString()),n.toCopyString&&(u=n.toCopyString({currentValue:u,column:l,record:e})),u=null==u?void 0:u.replace(/[\n\t]/," "),a+=u||n.emptyValueChar}return await BrowserHelper.writeToClipboard(a,this.useNativeClipboard),a}async cut(){await this.copy(!0)}async copy(e){const t=this,{client:r,entityName:n}=t,i="boolean"==typeof e&&e,s=i?r.selectedCells.filter((e=>{var t;return!(null==(t=e.record)?void 0:t.readOnly)})):r.selectedCells;if(s){if((i?!t.canCutPaste:!t.canCopy)||!1===r.trigger("beforeCopy",{cells:s,isCut:i,entityName:n}))return;const e=await t.sendToClipboard(s);if(!0===i)for(const e of s)e.column.readOnly||e.record.set(e.column.field,null);r.trigger("copy",{cells:s,copiedDataString:e,isCut:i,entityName:n})}}async paste(){const e=this,{client:t,entityName:r}=e,n=await BrowserHelper.readFromClipboard(e.useNativeClipboard),i=t.selectedCells[0];if(!e.canCutPaste||!(null==n?void 0:n.length)||!i||!1===t.trigger("beforePaste",{clipboardData:n,targetCell:i,entityName:r}))return;const s=new Set,a=e.stringAs2dArray(n),o=[],{_shiftSelectRange:l}=t;if(null==a?void 0:a.length){if(null==l?void 0:l.some((e=>e.equals(i)))){const t=e.cellSelectorsAs2dArray(l);if((null==t?void 0:t.length)%a.length==0&&t.columnCount%a.columnCount==0)for(let e=0;e<t.length;e+=a.length)for(let r=0;r<t.columnCount;r+=a.columnCount)o.push(t[e][r])}o.length||o.push(i);for(const r of o)for(let n=0;n<a.length;n++){const i=a[n],o=t.store.getAt(r.rowIndex+n);if(o&&!o.readOnly)for(let n=0;n<i.length;n++){const a=t.columns.getAt(r.columnIndex+n),l=null==a?void 0:a.field;let c=i[n];l&&c&&!a.readOnly&&(c===e.emptyValueChar&&(c=null),a.fromClipboardString&&(c=a.fromClipboardString({string:c,record:o})),e.toPasteValue&&(c=e.toPasteValue({currentValue:c,record:o,column:a,field:l})),o.set(l,c,!1,!1,!1,!0),s.add(o))}}t.trigger("paste",{clipboardData:n,targetCell:i,modifiedRecords:[...s],entityName:r})}}cellSelectorsAs2dArray(e){const t=[];let r,n=null;for(const i of e)i.id!==n&&(n=i.id,r=[],t.push(r)),r.push(i);return t.columnCount=t[0].length,!t.some((e=>e.length!==t.columnCount))&&t}stringAs2dArray(e){const t=[],r=e.split(/\r\n|(?!\r\n)[\n-\r\x85\u2028\u2029]/);for(const e of r){const r=e.split("\t");if(t.columnCount&&r.length!==t.columnCount)return!1;t.columnCount=r.length,t.push(r)}return t}populateCellMenu({record:e,items:t}){}};__publicField(CellCopyPaste,"$name","CellCopyPaste"),__publicField(CellCopyPaste,"pluginConfig",{chain:["populateCellMenu","afterSelectionModeChange"]}),__publicField(CellCopyPaste,"configurable",{copyOnly:null,emptyValueChar:" ",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},useNativeClipboard:!VersionHelper.isTestEnv,toCopyString:null,toPasteValue:null,copyText:"L{copy}",cutText:"L{cut}",pasteText:"L{paste}"}),CellCopyPaste._$name="CellCopyPaste",GridFeatureManager.registerFeature(CellCopyPaste);var editingActions={finishAndEditNextRow:1,finishAndEditPrevRow:1,finishEditing:1,cancelEditing:1,finishAndEditNextCell:1,finishAndEditPrevCell:1},CellEdit=class extends(Delayable_default(InstancePlugin)){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",continueEditingOnCellClick:!0,addNewAtEnd:null,autoEdit:null,editNextOnEnterPress:!0,editorClass:Editor,triggerEvent:"celldblclick",touchEditDelay:300,focusCellAnimationDuration:!1,multiEdit:!0,keyMap:{Enter:["startEditing","finishAndEditNextRow"],"Ctrl+Enter":["finishAllSelected","finishEditing"],"Shift+Enter":"finishAndEditPrevRow","Alt+Enter":"finishEditing",F2:["startEditing","finishEditing"],Escape:"cancelEditing",Tab:"finishAndEditNextCell","Shift+Tab":"finishAndEditPrevCell"}}}static get pluginConfig(){return{assign:["startEditing","finishEditing","cancelEditing"],before:["onElementKeyDown","onElementPointerUp"],chain:["onElementClick","bindStore"]}}construct(e,t){super.construct(e,t);const r=this,n={renderRows:"onGridRefreshed",cellClick:"onCellClick",thisObj:r};r.grid=e,"cellclick"!==r.triggerEvent&&(n[r.triggerEvent]="onTriggerEditEvent"),r.autoEdit&&!("editNextOnEnterPress"in t)&&(r.editNextOnEnterPress=!1),e.ion(n),e.rowManager.ion({changeTotalHeight:"onGridRefreshed",thisObj:r}),r.bindStore(e.store)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",beforeSort:"onStoreBeforeSort",thisObj:this})}async confirm(e){let t=!0;return this.editorContext&&(MessageDialog_default.owner=this.editorContext.editor.inputField,e.rootElement=this.grid.rootElement,t=await MessageDialog_default.confirm(e),MessageDialog_default.owner=null),t===MessageDialog_default.yesButton}doDestroy(){this.grid.columns.allRecords.forEach((e=>{var t;null==(t=e._cellEditor)||t.destroy()})),super.doDestroy()}doDisable(e){e&&!this.isConfiguring&&this.cancelEditing(!0),super.doDisable(e)}set disabled(e){super.disabled=e}get disabled(){const{grid:e}=this;return Boolean(super.disabled||e.disabled||e.readOnly)}get isEditing(){return Boolean(this.editorContext)}get activeRecord(){var e;return(null==(e=this.editorContext)?void 0:e.record)||null}getEditorForCell({id:e,cell:t,column:r,columnId:n,editor:i}){const s=this,{grid:a,editorClass:o}=s;let l=r.cellEditor,c=0;if(r.editTargetSelector){c=t.querySelector(r.editTargetSelector).offsetLeft}return i.autoSelect=s.autoSelect,(null==l?void 0:l.isEditor)||(l=r.data.cellEditor=o.create(o.mergeConfigs({type:o.type,constrainTo:null,cls:"b-cell-editor",inputField:i,blurAction:"none",invalidAction:r.invalidAction,completeKey:!1,cancelKey:!1,owner:a,align:{align:"t0-t0",offset:[c,0]},internalListeners:s.getEditorListeners(),onInternalKeyDown:s.onEditorKeydown.bind(s),allowMouseEvents:i.allowMouseEvents},l))),l.minHeight=a.rowHeight,l.inputField!==i&&(l.remove(l.items[0]),l.add(i)),l.align.offset[0]=c,r.instantUpdate&&!i.cellEditValueSetter&&(ObjectHelper.wrapProperty(i,"value",null,(e=>{const{editorContext:t}=s,r=null==t?void 0:t.editor.inputField;!(null==t?void 0:t.editor.isValid)||ObjectHelper.isEqual(t.record[t.column.field],e)||(null==r?void 0:r.isDateField)&&!r._isPickerInput||(t.record[t.column.field]=e)})),i.cellEditValueSetter=!0),Object.assign(l.element.dataset,{rowId:e,columnId:n,field:r.field}),l.inputField.revertOnEscape=r.revertOnEscape,s.editor=l}getEditorListeners(){return{focusOut:"onEditorFocusOut",focusIn:"onEditorFocusIn",start:"onEditorStart",beforeComplete:"onEditorBeforeComplete",complete:"onEditorComplete",beforeCancel:"onEditorBeforeCancel",cancel:"onEditorCancel",beforeHide:"onBeforeEditorHide",finishEdit:"onEditorFinishEdit",thisObj:this}}onEditorStart({source:e}){var t;const r=this,n=r.editorContext=e.cellEditorContext;if(n){const{grid:e}=r;"cellclick"!==r.triggerEvent&&(r.detachListeners("cellClickWhileEditing"),e.ion({name:"cellClickWhileEditing",cellclick:"onCellClickWhileEditing",thisObj:r})),null==(t=r.removeEditingListeners)||t.call(r),r.removeEditingListeners=GlobalEvents_default.addListener({globaltap:"onTapOut",thisObj:r}),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onEditorBeforeComplete(e){const{grid:t}=this,r=e.source.cellEditorContext;return e.grid=t,e.editorContext=r,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,r=e.cellEditorContext;r.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:r})}onEditorBeforeCancel(){const{editorContext:e}=this;return this.grid.trigger("beforeCancelCellEdit",{editorContext:e})}onEditorCancel({event:e}){const{editorContext:t,muteEvents:r,grid:n}=this;r||n.trigger("cancelCellEdit",{grid:n,editorContext:t,event:e})}onBeforeEditorHide({source:e}){const{row:t,cell:r}=e.cellEditorContext;null==r||r.classList.remove("b-editing"),null==t||t.removeCls("b-editing"),this.detachListeners("cellClickWhileEditing"),this.removeEditingListeners()}onEditorFinishEdit({source:e}){e.cellEditorContext=this.editorContext=null}getAdjacentEditableCell(e,t){const{grid:r}=this,{store:n,columns:i}=r,{visibleColumns:s}=i;let a=e.id,o=i.getAdjacentVisibleLeafColumn(e.columnId,t);for(;a;)if(o){if(o.editor&&o.canEdit(n.getById(a)))return{id:a,columnId:o.id};o=i.getAdjacentVisibleLeafColumn(o,t)}else{const r=n.getAdjacent(e.id,t,!1,!0);a=null==r?void 0:r.id,r&&(o=t?s[0]:s[s.length-1])}return null}doAddNewAtEnd(){const e="object"==typeof this.addNewAtEnd?ObjectHelper.clone(this.addNewAtEnd):{},{grid:t}=this,r=t.store.add(e)[0];return t.rowManager.getRowFor(r)||t.rowManager.displayRecordAtBottom(),r}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{column:t,record:r}=e;if((null==t?void 0:t.isVisible)&&t.editor&&!t.readOnly&&r&&!r.isSpecialRow&&!r.readOnly&&t.canEdit(r)){const n=r?t.getRawValue(r):r;return Object.assign(e,{value:void 0===n?null:n,editor:t.editor}),e}return!1}async startEditing(e={}){var t,r,n;const i=this;if(!i.disabled){const{grid:a}=i;if((null==e?void 0:e.fromKeyMap)&&(e=i.grid.focusedCell),ObjectHelper.isEmpty(e)&&(e.id=a.firstVisibleRow.id),a.store.isTree&&a.features.tree){const r=e.id?a.store.getById(e.id):null!=(t=e.record)?t:a.store.getAt(e.row);if(!r)return!1;await a.expandTo(r)}const o=i.getEditingContext(e);if(!o){if(e.id){var s=e.id;s.indexOf("_generatede_")>-1&&(s=s.replace("_generatede_","")),openTaskDialog(null,s)}return!1}if(i.editorContext&&i.cancelEditing(),(null==(r=a.focusedCell)?void 0:r.equals(o))||a.focusCell(o),!1===a.trigger("beforeCellEditStart",{grid:a,editorContext:o}))return!1;const l=o.editor=i.getEditorForCell(o),{row:c,cell:d,record:u}=o;return l.inputField.highlightExternalChange=!1,l.cellEditorContext=o,l.render(d),d.classList.add("b-editing"),c.addCls("b-editing"),await l.startEdit({target:d,field:l.inputField.name||o.column.field,value:o.value,record:u})||(d.classList.remove("b-editing"),c.removeCls("b-editing")),null==(n=i.onCellEditStart)||n.call(i),!0}return!1}cancelEditing(e=!1,t){var r;const n=this,{editor:i}=n;n.isEditing&&(e.fromKeyMap&&(t=e,e=!1),n.muteEvents=e,i.cancelEdit(t),n.muteEvents=!1,n.finishEditingPromise=!1,null==(r=n.afterCellEdit)||r.call(n))}async finishEditing(){var e;const t=this,{editorContext:r,grid:n}=t;let i=!1;if(t.finishEditingPromise)return t.finishEditingPromise;if(r){const{column:s}=r;t.finishEditingPromise=r.editor.completeEdit(s.bindCallback(s.finalizeCellEdit)),i=await t.finishEditingPromise,await n.waitForAnimations(),t.finishEditingPromise=null,null==(e=t.afterCellEdit)||e.call(t)}return i}async onCellClickWhileEditing({event:e,cellSelector:t}){const r=this;DomHelper.isTouchEvent?await r.finishEditing():r.finishEditingPromise||r.editorContext&&!r.editorContext.editor.owns(e.target)&&(r.getEditingContext(t)?await r.finishEditing()?r.continueEditingOnCellClick&&await r.startEditing(t):(r.grid.focusCell(r.editorContext),r.editor.inputField.focus()):await r.finishEditing())}async onCellClick({source:e,cellSelector:t,target:r,event:n,column:i}){if(i.onCellClick)return;const s=this,{focusedCell:a}=s.client;if(r.closest(".b-tree-expander"))return!1;DomHelper.isTouchEvent&&s._lastCellClicked===(null==a?void 0:a.cell)&&n.timeStamp-s.touchEditDelay>s._lastCellClickedTime?await s.startEditing(t):"cellclick"===this.triggerEvent&&await s.onTriggerEditEvent({cellSelector:t,target:r}),s._lastCellClicked=null==a?void 0:a.cell,s._lastCellClickedTime=n.timeStamp}onElementPointerUp(e){e.target.closest(".b-tree-expander")&&this.cancelEditing(void 0,e)}async onTriggerEditEvent({cellSelector:e,target:t,event:r}){var n;const{editorContext:i,client:s}=this;t.closest(".b-tree-expander")||DomHelper.isTouchEvent&&"dblclick"===r.type||r&&(null==(n=s.features.cellMenu)?void 0:n.triggerEvent)===r.type||(!i||!i.equals(this.grid.normalizeCellContext(e))&&await this.finishEditing())&&await this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:r}=this;(null==r?void 0:r.editor.isVisible)&&t===r.record&&r.editor.dataField in e&&r.editor.refreshEdit()}onStoreBeforeSort(){var e;const t=null==(e=this.editorContext)?void 0:e.editor;!this.isEditing||(null==t?void 0:t.isFinishing)||t.isValid||this.cancelEditing()}onGridRefreshed(){const e=this,{grid:t,editorContext:r}=e;if(r&&t.isVisible&&t.focusedCell){const n=t.getCell(t.focusedCell),{editor:i}=r;n&&DomHelper.isInView(n)&&!i.isFinishing?(r._cell=n,GlobalEvents_default.suspendFocusEvents(),i.render(n),i.showBy(n),i.focus(),GlobalEvents_default.resumeFocusEvents()):e.cancelEditing()}}get gridSelection(){return[...this.grid.selectedRows,...this.grid.selectedCells]}isActionAvailable(e,t,r){const n=this;if(t=t.replace("cellEdit.",""),!n.disabled&&!r.target.closest(".b-grid-header"))if(n.isEditing){if("finishAllSelected"===t)return n.multiEdit&&n.gridSelection.length>1;if(editingActions[t])return!0}else if("startEditing"===t)return n.grid.focusedCell.cell===r.target;return!1}async finishAllSelected(){const e=this,{dataField:t,record:r}=e.editor;if(await e.finishEditing()&&!e.isDestroyed)for(const n of e.gridSelection)n.isModel?n!==r&&(n[t]=r[t]):n.record.set(n.column.field,r[t])}async finishAndEditNextRow(e,t=!1){const r=this,{grid:n}=r,{record:i}=r.editorContext;let s;if(await r.finishEditing()){if(r.isDestroyed)return;r.isEditing||(t?s=n.internalNextPrevRow(!1,!0,e,!1):(r.addNewAtEnd&&i===n.store.last&&await r.doAddNewAtEnd(),r.isDestroyed||(s=n.internalNextPrevRow(!0,!0,e))),s&&r.editNextOnEnterPress&&!n.touch&&r.startEditing(s))}}finishAndEditPrevRow(e){this.finishAndEditNextRow(e,!0)}async finishAndEditNextCell(e,t=!1){const r=this,{focusedCell:n}=r.grid;if(n){let i=r.getAdjacentEditableCell(n,!t);if(!i&&!t&&r.addNewAtEnd){!0===await r.finishEditing()&&(await this.doAddNewAtEnd(),i=!r.isDestroyed&&r.getAdjacentEditableCell(n,!t))}if(i){let n=!0;r.isEditing&&(n=await r.finishEditing()),!r.isDestroyed&&n&&(r.grid.focusCell(i,{animate:r.focusCellAnimationDuration}),await r.startEditing(i)||await r.finishAndEditNextCell(e,t))}}}finishAndEditPrevCell(e){this.finishAndEditNextCell(e,!0)}async onElementKeyDown(e){const t=this,{grid:r}=t,{focusedCell:n}=r;if(e.handled||!t.autoEdit||t.isEditing||!n||n.isActionable||e.ctrlKey)return;const{key:i}=e,s="Delete"===e.key||"Backspace"===e.key,{gridSelection:a}=s?t:{},o=t.multiEdit&&(null==a?void 0:a.length)>1;if((i.length<=1||s&&!o)&&await t.startEditing(n)){const{inputField:r}=t.editor,{input:n}=r;n&&(r.internalOnKeyEvent(e),e.defaultPrevented||(n.value=s?"":i,r.internalOnInput(e))),e.preventDefault()}else if(o&&!1!==r.trigger("beforeCellRangeDelete",{grid:r,gridSelection:a}))for(const e of a)e.isModel?r.columns.visibleColumns.forEach((t=>{!t.readOnly&&e.set(t.field,null)})):e.column.readOnly||e.record.set(e.column.field,null)}onEditorKeydown(e){if(1!==e.key.length&&this.grid.matchKeyMapEntry(e)&&!this.grid.matchKeyMapEntry(e,this.keyMap))return e.key.startsWith("Arrow")||"Backspace"!==!e.key||e.preventDefault(),e.handled=!0,e.stopPropagation(),!1}async onEditorFocusOut(e){const t=this,{grid:r,editor:n,editorContext:i}=t,s=new Location(e.relatedTarget),a=s.grid===r&&t.getEditingContext(s);i&&!n.isFinishing&&n.owns(e._target)&&("cancel"===t.blurAction?t.cancelEditing(void 0,e):t.finishEditingPromise||"cellclick"!==t.triggerEvent&&("cellclick"===t.triggerEvent||a)||await t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}async onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)&&!e.button||t.editor.owns(e.target)||(t.editingStoppedByTapOutside=!0,"cancel"===t.blurAction?t.cancelEditing(void 0,e):await t.finishEditing(),delete t.editingStoppedByTapOutside)}async onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&await this.finishEditing()}};__publicField(CellEdit,"$name","CellEdit"),CellEdit._$name="CellEdit",GridFeatureManager.registerFeature(CellEdit,!0);var CellMenu=class extends ContextMenuBase{static get $name(){return"CellMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"cell"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateCellMenu"),e}showContextMenu(e){const{cellSelector:t,event:r}=e;this.client.focusCell(t,{doSelect:!this.client.isSelected(t),event:r}),super.showContextMenu(e)}shouldShowMenu({column:e}){return e&&!1!==e.enableCellContextMenu}getDataFromEvent(e){const t=this.client.getCellDataFromEvent(e);if(t)return ObjectHelper.assign(super.getDataFromEvent(e),t)}beforeContextMenuShow({record:e,items:t,column:r}){if(!1===r.cellMenuItems)return!1;e&&!e.isSpecialRow||(t.removeRow=!1)}populateCellMenu({items:e,column:t,record:r}){const{client:n}=this;(null==t?void 0:t.cellMenuItems)&&ObjectHelper.merge(e,t.cellMenuItems),n.readOnly||(e.removeRow={text:"L{removeRow}",localeClass:this,icon:"b-fw-icon gt-icon-trash",cls:"b-separator",weight:100,disabled:r.readOnly,onItem:()=>n.store.remove(n.selectedRecords.filter((e=>!e.readOnly)))})}get showMenu(){return!0}};CellMenu.featureClass="",CellMenu._$name="CellMenu",GridFeatureManager.registerFeature(CellMenu,!0,["Grid","Scheduler"]),GridFeatureManager.registerFeature(CellMenu,!1,["Gantt"]);var CellTooltip=class extends InstancePlugin{construct(e,t){super.construct(e,this.processConfig(t))}initTip(){const e=this;e.tip=Tooltip.new({forElement:e.client.element,forSelector:".b-grid-row:not(.b-group-row) .b-grid-cell, .b-grid-merged-cells",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:e.getTooltipContent.bind(e),internalListeners:{pointerOver:"onPointerOver",thisObj:e},listeners:e.configuredListeners},e.initialConfig),e.relayEvents(e.tip,["beforeShow","show"])}onPointerOver({target:e}){const t=this.client.getColumnFromElement(e);return!1!==t.tooltipRenderer&&Boolean(t.tooltipRenderer||this.tooltipRenderer)}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip&&this.tip.destroy(),super.doDestroy()}doDisable(e){e?this.tip&&(this.tip.destroy(),this.tip=null):this.initTip(),super.doDisable(e)}getTooltipContent({tip:e,activeTarget:t,event:r}){const n=this,i=n.client.getRecordFromElement(t),s=n.client.getColumnFromElement(t),a={cellElement:t,record:i,column:s,event:r,tip:e,cellTooltip:n};let o;return n.forSelector||i!==n.lastRecord||i.generation!==n.lastRecordGeneration||s!==n.lastColumn?(n.lastRecord=i,n.lastRecordGeneration=i.generation,n.lastColumn=s,s.tooltipRenderer?o=s.tooltipRenderer(a):n.tooltipRenderer&&!1!==s.tooltipRenderer&&(o=n.tooltipRenderer(a)),Objects.isPromise(o)&&(n.lastRecord=n.lastRecordGeneration=n.lastColumn=null),o||e.hide(),o):n.tip._html}};__publicField(CellTooltip,"$name","CellTooltip"),__publicField(CellTooltip,"configurable",{tooltipRenderer:null}),CellTooltip._$name="CellTooltip",GridFeatureManager.registerFeature(CellTooltip);var storeListenerName="store",ColumnAutoWidth=class extends(Delayable_default(InstancePlugin)){static get $name(){return"ColumnAutoWidth"}static get configurable(){return{default:null,delay:0}}static get pluginConfig(){return{after:{bindStore:"bindStore",unbindStore:"unbindStore",renderRows:"syncAutoWidthColumns",onInternalResize:"onInternalResize"},assign:["columnAutoWidthPending","syncAutoWidthColumns"]}}construct(e){super.construct(e);const{store:t}=this.client;t&&this.bindStore(t)}doDestroy(){this.unbindStore(),super.doDestroy()}bindStore(e){this.lastSync=null,e.ion({name:storeListenerName,["change"+this.client.asyncEventSuffix]:"onStoreChange",thisObj:this})}unbindStore(){this.detachListeners(storeListenerName)}get columnAutoWidthPending(){return null===this.lastSync||this.hasTimeout("syncAutoWidthColumns")}onStoreChange({action:e}){if("move"!==e){const e=this,{cellEdit:t}=e.client.features;++e.storeGeneration,(null==t?void 0:t.isEditing)&&!t.editingStoppedByTapOutside?e.syncAutoWidthColumns():e.hasTimeout("syncAutoWidthColumns")||e.setTimeout("syncAutoWidthColumns",e.delay)}}onInternalResize(e,t,r,n){0===n&&(this.lastSync=null,this.syncAutoWidthColumns())}syncAutoWidthColumns(){const e=this,t=e.client,r=e.storeGeneration;if(e.lastSync!==r){let n,i;e.lastSync=r;for(const r of t.columns.visibleColumns)n=r.autoWidth,n&&(!0===n&&(n=e.default),t.resizingColumns=i=!0,r.resizeToFitContent(n));i&&(t.resizingColumns=!1,t.afterColumnsResized())}e.hasTimeout("syncAutoWidthColumns")&&e.clearTimeout("syncAutoWidthColumns")}};ColumnAutoWidth.prototype.storeGeneration=0,ColumnAutoWidth._$name="ColumnAutoWidth",GridFeatureManager.registerFeature(ColumnAutoWidth,!0);var ColumnDragToolbar=class extends(Delayable_default(InstancePlugin)){static get $name(){return"ColumnDragToolbar"}static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.ion({beforeDestroy:"onColumnReorderBeforeDestroy",thisObj:this}),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}doDisable(e){this.initialized&&(e?this.detachFromColumnReorder():this.init()),super.doDisable(e)}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.ion({gridheaderdragstart({context:r}){const n=t.columns.getById(r.element.dataset.columnId);e.showToolbar(n)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)},thisObj:e}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,r=t.grid.getColumnDragToolbarItems(e,[]),n=[];t.clearTimeout(t.buttonHideTimer),r.forEach((e=>{e.text=e.localeClass.L(e.text);let t=n.find((t=>t.text===e.group));t||(t={text:e.localeClass.L(e.group),buttons:[]},n.push(t)),t.buttons.push(e)})),t.element=DomHelper.append(t.grid.element,t.template(n)),t.groups=n,t.buttons=r,t.column=e}async hideToolbar(){const e=this,t=e.element;t&&(t.classList.add("b-remove"),await EventHelper.waitForTransitionEnd({element:t,mode:"animation",thisObj:e.client}),t.remove(),e.element=null)}onDrag(e){var t;const r=this;if(e.dragProxy.getBoundingClientRect().top-r.grid.element.getBoundingClientRect().top>100?r.element.classList.add("b-closer"):r.element.classList.remove("b-closer"),r.hoveringButton&&(r.hoveringButton.classList.remove("b-hover"),r.hoveringButton=null),null==(t=e.targetElement)?void 0:t.closest(".b-columndragtoolbar")){r.element.classList.add("b-hover");const t=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");t&&(t.classList.add("b-hover"),r.hoveringButton=t)}else r.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const r=e.targetElement,n=t.buttons.find((e=>e.ref===r.dataset.ref));n&&(r.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout((()=>{t.hideToolbar(),n.onDrop({column:t.column})}),100))}else t.hideToolbar()}template(e){return TemplateHelper.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            
    ${e.map((e=>TemplateHelper.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    
    ${e.buttons.map((e=>TemplateHelper.tpl`
                        <div class="b-target-button" data-ref="
    ${e.ref}" data-disabled="${e.disabled}">
                            <i class="
    ${e.icon}"></i>
                            
    ${e.text}
                        </div>
                    
    `))}
                    </div>
                    <div class="b-title">
    ${e.text}</div>
                </div>
            
    `))}
            </div>
    `}};ColumnDragToolbar.featureClass="b-hascolumndragtoolbar",ColumnDragToolbar._$name="ColumnDragToolbar",GridFeatureManager.registerFeature(ColumnDragToolbar,BrowserHelper.isTouchDevice);var ColumnPicker=class extends InstancePlugin{static get pluginConfig(){return{chain:["populateHeaderMenu","getColumnDragToolbarItems"]}}get grid(){return this.client}getColumnPickerItems(e){const t=this,{createColumnsFromModel:r}=t;let n;if(t.groupByRegion)n=t.grid.regions.map((e=>{const r=t.grid.getSubGrid(e).columns.topColumns;return{text:StringHelper.capitalize(e),menu:t.buildColumnMenu(r),disabled:0===r.length,region:e}})),r&&n.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()});else if(t.groupByTag){const i={};e.topColumns.forEach((e=>{e.tags&&Array.isArray(e.tags)&&!1!==e.hideable&&e.tags.forEach((e=>{i[e]||(i[e]=1)}))})),n=Object.keys(i).sort().map((e=>({text:StringHelper.capitalize(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:r})=>{t.refreshTagMenu(e,r)}}))),r&&n.push({text:t.L("L{newColumns}"),menu:t.createAutoColumnItems()})}else n=t.buildColumnMenu(e.topColumns),r&&n.items.push(...ObjectHelper.transformNamedObjectToArray(t.createAutoColumnItems()));return n}createAutoColumnItems(){const e=this,{grid:t}=e,{columns:r,store:n}=t,{modelClass:i}=n,{allFields:s}=i,a={};for(let t=0,{length:n}=s;t<n;t++){const n=s[t],i=n.name;r.get(i)||n.internal||(a[i]={text:n.text||StringHelper.separate(n.name),checked:!1,onToggle:t=>{const s=r.get(i);s?s[t.checked?"show":"hide"]():r.add(r.generateColumnForField(n,{region:e.forColumn.region})),t.bubbles=!1}})}return a}getColumnsForTag(e){return this.grid.columns.records.filter((t=>t.tags&&Array.isArray(t.tags)&&t.tags.includes(e)&&!1!==t.hideable))}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach((t=>{const r=e.items.find((e=>e.column===t));r&&(r.checked=!0!==t.hidden)}))}buildColumnMenu(e){let t=e.length>0&&e[0].region;const{grid:r}=this,n=e.reduce(((e,n)=>{const i=r.columns.visibleColumns.filter((e=>e.region===n.region));if(!1!==n.hideable){const s={grid:r,column:n,text:n.headerText,checked:!0!==n.hidden,disabled:!0!==n.hidden&&1===i.length,cls:n.region!==t?"b-separator":""};t=n.region,n.children&&!n.isCollapsible&&(s.menu=this.buildColumnMenu(n.children)),e.push(s)}return e}),[]);return{cls:this.menuCls,items:n}}populateHeaderMenu({column:e,items:t}){const r=this,{columns:n}=r.grid;if(r.forColumn=e,!1!==e.showColumnPicker&&n.some((e=>e.hideable))&&(t.columnPicker={text:"L{columnsMenu}",localeClass:r,icon:"b-fw-icon gt-icon-columns",cls:"b-separator",weight:200,menu:r.getColumnPickerItems(n),onToggle:r.onColumnToggle,disabled:r.disabled}),!1!==e.hideable&&!e.parent.isCollapsible){const i=n.visibleColumns.filter((t=>t.region===e.region));t.hideColumn={text:"L{hideColumn}",localeClass:r,icon:"b-fw-icon gt-icon-hide-column",weight:210,disabled:1===i.length||r.disabled,onItem:()=>e.hide()}}}onColumnToggle({menu:e,item:t,checked:r}){var n,i;if(Boolean(t.column.hidden)!==!r){t.column[r?"show":"hide"]();const{grid:s,column:a}=t,{columns:o,features:l}=s,c=e.items,d=o.visibleColumns.filter((e=>e.region===t.column.region)),u=(null==(n=l.headerMenu)?void 0:n.enabled)&&l.headerMenu.menu.widgetMap.hideColumn;if(1===d.length){const e=c.find((e=>e.column===d[0]));e&&(e.disabled=!0),u&&a.region===t.column.region&&(u.disabled=!0)}else d.forEach((e=>{const t=c.find((t=>t.column===e));t&&(t.disabled=!1)})),u&&a.region===t.column.region&&(u.disabled=!1);null==(i=t.menu)||i.eachWidget((e=>{e.checked=r}));const h=e.owner;h&&h.column===a.parent&&(h.checked=c.some((e=>!0===e.checked)))}}getColumnDragToolbarItems(e,t){const r=this.grid.columns.visibleColumns.filter((t=>t.region===e.region));return!1!==e.hideable&&r.length>1&&t.push({text:"L{hideColumnShort}",ref:"hideColumn",group:"L{column}",localeClass:this,icon:"b-fw-icon gt-icon-hide-column",weight:101,onDrop:({column:e})=>e.hide()}),t}};__publicField(ColumnPicker,"$name","ColumnPicker"),__publicField(ColumnPicker,"configurable",{groupByRegion:!1,groupByTag:!1,createColumnsFromModel:!1,menuCls:"b-column-picker-menu b-sub-menu"}),ColumnPicker._$name="ColumnPicker",GridFeatureManager.registerFeature(ColumnPicker,!0);var ColumnRename=class extends InstancePlugin{doDestroy(){var e;null==(e=this.editor)||e.destroy(),super.doDestroy()}static get pluginConfig(){return{after:["populateHeaderMenu"]}}populateHeaderMenu({items:e,column:t}){e.rename={weight:215,icon:"b-fw-icon gt-icon-edit",text:this.L("L{rename}"),disabled:t.readOnly,onItem:()=>this.startEdit(t)}}startEdit(e){var t;if(e instanceof Event&&(e=null==(t=this.client.getHeaderDataFromEvent(e))?void 0:t.column),e){if(e.readOnly)return!1;const{textWrapper:t}=e;let{editor:r}=this;r||(this.editor=r=new Editor({owner:this.client,align:{align:"t0-t0"}})),r.render(t),r.startEdit({target:t,record:e,field:"text"})}}};__publicField(ColumnRename,"$name","ColumnRename"),__publicField(ColumnRename,"configurable",{keyMap:{F2:"startEdit"}}),ColumnRename._$name="ColumnRename",GridFeatureManager.registerFeature(ColumnRename,!1);var ColumnReorder=class extends(Delayable_default(InstancePlugin)){constructor(){super(...arguments),__publicField(this,"ignoreSelectors",[".b-grid-header-resize-handle",".b-field"])}doDestroy(){var e,t;null==(e=this.dragHelper)||e.scrollManager.destroy(),null==(t=this.dragHelper)||t.destroy(),super.doDestroy()}get grid(){return this.client}init(){const e=this,{grid:t}=e,r=t.element,n=DomHelper.children(r,".b-grid-headers");n.push(...DomHelper.children(r,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=n:(e.dragHelper=new DragHelper({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",floatRootOwner:t,rtlSource:t,outerElement:t.headerContainer,monitoringConfig:{scrollables:[{element:".b-grid-headers"}]},scrollManager:ScrollManager.new({direction:"horizontal",element:t.headerContainer}),containers:n,isElementDraggable(r){if(Boolean(r.closest(e.ignoreSelectors.join(",")))||e.disabled)return!1;const n=r.closest(this.targetSelector),i=n&&t.columns.getById(n.dataset.columnId),s=0===(null==i?void 0:i.childLevel)&&1===t.subGrids[i.region].columns.count;return Boolean(i)&&!1!==i.draggable&&!s},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",internalListeners:{beforeDragStart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragStart","drag","drop","abort"],"gridHeader"))}static get pluginConfig(){return{after:["onPaint","renderContents"]}}onDrag({context:e,event:t}){const r=Widget.fromElement(t.target,"gridheader");(null==r?void 0:r.subGrid.sealedColumns)?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onBeforeDragStart({context:e,event:t}){const{element:r}=e,n=e.column=this.client.columns.getById(r.dataset.columnId);return this.client.trigger("beforeColumnDragStart",{column:n,event:t})}onDragStart({context:e,event:t}){const r=this,{grid:n}=r,{column:i}=e;if(!n.features.columnDragToolbar){const e=n.element.querySelector(".b-grid-header-container").getBoundingClientRect();r.dragHelper.minY=e.top,r.dragHelper.maxY=e.bottom}n.headerContainer.classList.add("b-dragging-header"),e.dragProxy.style.fontSize=DomHelper.getStyleValue(e.element,"fontSize"),n.trigger("columnDragStart",{column:i,event:t})}onDrop({context:e,event:t}){if(!e.valid)return this.onInvalidDrop({context:e});const{grid:r}=this,n=e.dragging,i=e.target.closest(".b-grid-header"),s=e.draggedTo.dataset.region,a=i?r.columns.get(i.dataset.column):r.subGrids[s].columns.last,o=s||a.region,l=e.insertBefore,c=r.columns.getById(n.dataset.columnId),d=c.parent,u=l?r.columns.getById(l.dataset.columnId):r.subGrids[o].columns.last.nextSibling;let h;if(u)h=u.parent;else{const e=null==i?void 0:i.parentElement.closest(".b-grid-header");h=e?r.columns.getById(e.dataset.columnId):r.columns.rootNode}r.headerContainer.classList.remove("b-dragging-header"),n.remove();let g=o===c.region&&d===h&&(a===c.previousSibling||u===c.nextSibling);g=g||!1===r.trigger("beforeColumnDropFinalize",{column:c,newParent:h,insertBefore:u,event:t}),g||(g=!h.insertChild(c,u)),e.valid=!g,g||(c.region=o,0===d.children.length&&d.parent.removeChild(d)),r.trigger("columnDrop",{column:c,newParent:h,insertBefore:u,valid:e.valid,event:t})}onInvalidDrop(){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}onPaint(){this.init()}get isReordering(){var e;return Boolean(null==(e=this.dragHelper)?void 0:e.isDragging)}};__publicField(ColumnReorder,"$name","ColumnReorder"),ColumnReorder.featureClass="b-column-reorder",ColumnReorder._$name="ColumnReorder",GridFeatureManager.registerFeature(ColumnReorder,!0);var ColumnResize=class extends InstancePlugin{static get $name(){return"ColumnResize"}static get configurable(){return{liveResize:"auto"}}construct(e,t){const r=this;r.grid=e,super.construct(e,t),r.resizer=new ResizeHelper({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,rtlSource:e,internalListeners:{beforeresizestart:r.onBeforeResizeStart,resizestart:r.onResizeStart,resizing:r.onResizing,resize:r.onResize,cancel:r.onCancel,thisObj:r}})}doDestroy(){var e;null==(e=this.resizer)||e.destroy(),super.doDestroy()}changeLiveResize(e){return"auto"===e?!BrowserHelper.isMobileSafari:e}onBeforeResizeStart(){return!this.disabled}onResizeStart({context:e}){const{grid:t,resizer:r}=this,n=e.column=t.columns.getById(e.element.dataset.columnId);r.minWidth=n.minWidth,t.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.resizingColumns=!0,e.column.width=e.newWidth)}onResize({context:e}){const{grid:t}=this,{column:r}=e;t.element.classList.remove("b-column-resizing"),e.valid&&(this.liveResize?(t.resizingColumns=!1,t.afterColumnsResized(r)):r.width=e.newWidth);var n=[],i=null;globalThis.ganttInit.columns.records.forEach((e=>{let t=e.type;t||(t=e.field);const r=e.width,s=e.readOnly,a=e.format;i={},t&&"rownumber"!=t&&"timeAxis"!=t&&e.isVisible&&(i.type=t,r&&(i.width=r),s&&(i.readOnly=s),a&&(i.format=a),n.push(i))})),fetch("/plan/saveHeaderColumn",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{})).catch((e=>{}))}onCancel({context:e}){const{grid:t}=this;t.element.classList.remove("b-column-resizing"),e.column.width=e.elementWidth,t.resizingColumns=!1}};ColumnResize._$name="ColumnResize",GridFeatureManager.registerFeature(ColumnResize,!0);var FillHandle=class extends(InstancePlugin.mixin(Delayable_default)){constructor(){super(...arguments),__publicField(this,"delayable",{handleSelection:"raf"})}afterConstruct(){super.afterConstruct(),this.client.selectionMode.cell||(this.disabled=!0),this._fillListeners={}}onContentChange(){this.handleSelection()}afterColumnsChange(){this.handleSelection()}fixElementHeights(){this.handleSelection()}getCellDataFromEvent(e,t){return t&&(t=!e.target.classList.contains("b-fill-handle")),this.overridden.getCellDataFromEvent(e,t)}findPatternsIn2dRange(e,t,r){const n={};for(const r of e){const e=t?r.id:r.columnId;let i=r.record[r.column.field];i&&"string"==typeof i&&!isNaN(i)&&(i=parseFloat(i)),n[e]||(n[e]=[]),n[e].push(i)}for(const e in n)n[e].pattern=this.findPatternsIn1dRange(n[e],r);return n}findPatternsIn1dRange(e,t){const r=e[t?0:e.length-1],n={next:()=>r,lastValue:r};if(e.every((e=>"number"==typeof e))||e.every((e=>e instanceof Date))){const r=e.map(((t,r)=>t-e[r-1]));r.shift(),1===new Set(r).size&&(n.increaseBy=r[0]*(t?-1:1),n.next=()=>(n.lastValue instanceof Date?n.lastValue=new Date(n.lastValue.getTime()+n.increaseBy):n.lastValue+=n.increaseBy,n.lastValue))}else e.length>1&&(n.stringPattern=[...e],n.next=()=>(void 0===n.currentIndex?n.currentIndex=0:(n.currentIndex+=1,n.currentIndex>=n.stringPattern.length&&(n.currentIndex=0)),n.stringPattern[n.currentIndex]));return n}afterSelectionChange(){const e=this;e.client.readOnly?e.removeElements():GlobalEvents_default.isMouseDown()?(e.client.delayUntilMouseUp((()=>e.handleSelection(!0))),e.removeElements()):e.handleSelection(!0)}handleSelection(){if(!this._isExtending){const e=this.rangeSelection;e?this.drawFillHandleAndBorder(e[0],e[e.length-1]):this.removeElements()}}onMouseDown(e){const{client:t}=this;t.readOnly||(this._fillListeners.mouseMoveOrUp=EventHelper.on({element:globalThis,mouseover:{handler:"onMouseOver",element:t.selectionDragMouseEventListenerElement},mouseup:"onMouseUp",thisObj:this}),e.preventDefault(),e.stopImmediatePropagation(),e.handled=!0)}onMouseUp(){var e,t;const r=this,{client:n,currentRange:i,_isCropping:s}=r,a=r.rangeSelection,o=a&&i&&n.internalSelectRange(i.from,i.to),l=(null==o?void 0:o.selectedCells)||[],c=s?r.croppingCells:l.filter((e=>!a.some((t=>t.equals(e,!0)))));if(delete r._isCropping,r._isExtending&&(n.disableScrollingCloseToEdges(n.items),delete r._isExtending),null==c?void 0:c.length){if(n.suspendRefresh(),s)c.forEach((e=>e.record.set(e.column.field,null,!1,!1,!1,!0)));else{const[n]=c,i=a.some((e=>e.record===n.record)),s=i?n.columnIndex<a[0].columnIndex:n.rowIndex<a[0].rowIndex,o=r.findPatternsIn2dRange(a,i,s),l=new Map;s&&c.reverse();for(const n of c){const{column:s,record:c}=n;if(!s.readOnly&&s.canFillValue({range:a,record:c,cell:n})){let d=null==(e=r.calculateFillValue)?void 0:e.call(r,{range:a,column:s,record:c,cell:n}),u=l.get(c);if(u||(u={},l.set(c,u)),void 0===d){d=o[i?n.id:n.columnId].pattern.next()}u[s.field]=(null==(t=s.calculateFillValue)?void 0:t.call(s,{value:d,record:c,range:a}))||d}}for(const[e,t]of l)e.set(t,null,null,null,null,!0)}n.resumeRefresh(!0),n.performSelection(o),delete r.currentRange,r.handleSelection()}else r.handleSelection()}onMouseOver(e){var t;const r=this,{client:n,rangeSelection:i}=r,s=i[0],a=i[i.length-1],o=n.getCellDataFromEvent(e,!0);let l=o&&n.normalizeCellContext(o.cellSelector);if((null==(t=null==l?void 0:l._column)?void 0:t.region)===s._column.region){const e=i.some((e=>e.equals(l,!0)));let t;r._isExtending||n.enableScrollingCloseToEdges(n.items),e?r._isCropping=r.allowCropping&&(l.rowIndex<a.rowIndex||l.columnIndex<a.columnIndex):l.rowIndex>=s.rowIndex&&l.rowIndex<=a.rowIndex?(t=s.columnIndex>l.columnIndex,l=new Location({grid:n,record:t?s.record:a.record,column:l.column})):(t=s.rowIndex>l.rowIndex,l=new Location({grid:n,record:l.record,column:t?s.column:a.column}));const o=t?l:s,c=t||e&&!r._isCropping?a:l;r.currentRange={from:o,to:c},r._isExtending=!0,r.drawFillHandleAndBorder(o,c,!0)}}drawFillHandleAndBorder(e,t,r=!1){var n;const i=this,{client:s,currentRange:a,_fillListeners:o}=i,l=s.subGrids[e.column.region].element,{x:c}=Rectangle.from(e.cell||e.column.element,l),{right:d}=Rectangle.from(t.cell||t.column.element,l),{y:u}=s.getRecordCoords(e.record,!0),h=s.getRecordCoords(t.record,!0).bottom-1;let{borderElement:g,handleElement:p}=i;if(i.removeElements(r),g||(i.borderElement=g=DomHelper.createElement({className:"b-fill-selection-border"}),i.handleElement=p=DomHelper.createElement({className:"b-fill-handle"})),DomHelper.setRect(g,{y:u,x:c,width:d-c,height:h-u}),l.appendChild(g),DomHelper.setTopLeft(p,h,d>=l.scrollWidth?c:d),l.appendChild(p),i.toggleCroppingCls(!1),delete i.croppingCells,i._isCropping&&(null==(n=i.rangeSelection)?void 0:n.length)){const e=s.getRange(a.from,a.to);i.croppingCells=i.rangeSelection.filter((t=>!e.some((e=>e.equals(t,!0))))),i.toggleCroppingCls()}o.handleClick||(o.handleClick=EventHelper.on({element:s.rootElement,delegate:".b-fill-handle",mousedown:"onMouseDown",thisObj:i})),i.hasFillElements=!0}toggleCroppingCls(e=!0){var t;null==(t=this.croppingCells)||t.forEach((t=>{var r;return null==(r=this.client.getCell(t))?void 0:r.classList.toggle("b-indicate-crop",e)}))}removeElements(e=!1){var t,r;const n=this;null==(t=n.handleElement)||t.remove(),null==(r=n.borderElement)||r.remove(),e||n.removeListeners(),n.hasFillElements=!1}removeListeners(){const e=this;for(const t in e._fillListeners)e._fillListeners[t]();e._fillListeners={}}get rangeSelection(){var e;const{client:t}=this,{selectedCells:r}=t,n=null!=(e=t._shiftSelectRange)?e:1===r.length&&r;return!t._selectedRows.length&&(null==n?void 0:n.length)&&n.length===r.length&&n.every((e=>r.some((t=>e.equals(t,!0)))&&e._column.parent&&e._column.region===n[0]._column.region&&t.store.isAvailable(e.id)))?n:null}};__publicField(FillHandle,"$name","FillHandle"),__publicField(FillHandle,"configurable",{calculateFillValue:null,allowCropping:!1}),__publicField(FillHandle,"pluginConfig",{chain:["afterSelectionChange","onContentChange","afterColumnsChange","fixElementHeights"],override:["getCellDataFromEvent"]}),FillHandle._$name="FillHandle",GridFeatureManager.registerFeature(FillHandle);var _GridFieldFilterPicker=class extends FieldFilterPicker{static get $name(){return"GridFieldFilterPicker"}static get type(){return"gridfieldfilterpicker"}afterConstruct(){var e;const t=this;if(!t.grid)throw new Error(t.constructor.$name+" 需要配置“网格”");t.fields=null!=(e=t.fields)?e:{},super.afterConstruct()}updateGrid(e){var t;if(!(null==(t=e.store)?void 0:t.modelClass))throw new Error("Grid does not have a store with a modelClass defined.");if(!e.columns)throw new Error("Grid does not have a column store.")}static getModelClassFields(e){const t=new Set(e.fields.map((({name:e})=>e)));return(null==e?void 0:e.allFields.filter((e=>!e.internal&&(SUPPORTED_FIELD_DATA_TYPES.includes(e.type)||isSupportedDurationField(e))&&(e.definedBy!==Model||t.has(e.name)))))||[]}static getColumnFields(e,t,r){var n;const i=ArrayHelper.keyBy(_GridFieldFilterPicker.getModelClassFields(t),"name"),s=r&&new Set(r);return Object.fromEntries(null!=(n=null==e?void 0:e.records.filter((({field:e})=>e&&i[e]&&(!s||s.has(e)))).map((({field:e,text:t})=>[e,{title:t||e,type:isSupportedDurationField(i[e])?"duration":i[e].type}])))?n:[])}changeFields(e){var t;let r=e;return Array.isArray(e)&&(VersionHelper.deprecate("Core","6.0.0","FieldOption[] deprecated, use Object<String, FieldOption[]> keyed by field name instead"),r=ArrayHelper.keyBy(r,"name")),ObjectHelper.merge({},_GridFieldFilterPicker.getColumnFields(this.grid.columns,null==(t=this.grid.store)?void 0:t.modelClass,this.allowedFieldNames),r)}},GridFieldFilterPicker=_GridFieldFilterPicker;__publicField(GridFieldFilterPicker,"configurable",{grid:null,allowedFieldNames:null}),GridFieldFilterPicker.initClass(),GridFieldFilterPicker._$name="GridFieldFilterPicker";var GridFieldFilterPickerGroup=class extends FieldFilterPickerGroup{static get $name(){return"GridFieldFilterPickerGroup"}static get type(){return"gridfieldfilterpickergroup"}validateConfig(){if(!this.grid)throw new Error(this.constructor.$name+" 需要“grid”配置属性")}getFilterPickerConfig(e){const{grid:t,allowedFieldNames:r}=this;return{...super.getFilterPickerConfig(e),grid:t,allowedFieldNames:r}}updateGrid(e){this.store=this.grid.store}canManage(e){return super.canManage(e)&&(!this.allowedFieldNames||this.allowedFieldNames.includes(e.property))}};__publicField(GridFieldFilterPickerGroup,"configurable",{grid:null,allowedFieldNames:null}),__publicField(GridFieldFilterPickerGroup,"childPickerType","gridfieldfilterpicker"),GridFieldFilterPickerGroup.initClass(),GridFieldFilterPickerGroup._$name="GridFieldFilterPickerGroup";var fieldTypeMap={date:"date",int:"number",integer:"number",number:"number",string:"text",duration:"duration"},Filter=class extends InstancePlugin{static get $name(){return"Filter"}static get configurable(){return{prioritizeColumns:!1,keyMap:{f:"showFilterEditorByKey"},isMulti:!1}}construct(e,t){if(e.features.filterBar)throw new Error("Grid.feature.Filter feature may not be used together with Grid.feature.FilterBar. These features are mutually exclusive.");const r=this;if(r.grid=e,r.closeFilterEditor=r.closeFilterEditor.bind(r),super.construct(e,t),r.bindStore(e.store),t&&"object"==typeof t){const r=ObjectHelper.clone(t);delete r.prioritizeColumns,delete r.isMulti,delete r.dateFormat,ObjectHelper.isEmpty(r)||e.store.filter(r,null,e.isConfiguring)}}doDestroy(){var e,t;null==(e=this.filterTip)||e.destroy(),null==(t=this.filterEditorPopup)||t.destroy(),super.doDestroy()}get store(){return this.grid.store}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}static get pluginConfig(){return{chain:["renderHeader","populateCellMenu","populateHeaderMenu","onElementClick","bindStore"]}}refreshHeaders(e){const t=this,r=t.grid,n=r.headerContainer;n&&(DomHelper.children(n,".b-filter-icon.b-latest").forEach((e=>e.classList.remove("b-latest"))),t.filterTip||(t.filterTip=new Tooltip({forElement:n,forSelector:".b-filter-icon",getHtml:({activeTarget:e})=>e.dataset.filterText})),r.store.isFiltered||t.filterTip.hide(),r.columns.visibleColumns.forEach((e=>{if(!1!==e.filterable){const r=t.store.filters.allValues.filter((({property:t,disabled:r,internal:n})=>t===e.field&&!r&&!n)),n=r.length>0,i=e.element;if(i){const s=e.textWrapper;let a,o=null==s?void 0:s.querySelector(".b-filter-icon");if(n){const n="&#x2022 ";a=t.L("L{filter}")+": "+(r.length>1?"<br/><br/>":"")+r.map((i=>{var s,a,o,l;let c=null!=(s=i.value)?s:"";const d=Array.isArray(c),u=null==(o=null==(a=t.store)?void 0:a.modelRelations)?void 0:o.find((({foreignKey:e})=>e===i.property));if(i.displayValue)c=i.displayValue;else{if(t.isMulti&&u){const{relatedDisplayField:e}=null==(l=t.isMulti.fields)?void 0:l[i.property];if(e){const t=t=>{var r;return null==(r=u.foreignStore.getById(t))?void 0:r[e]};c=d?c.map(t).sort(((e,t)=>(null!=e?e:"").localeCompare(null!=t?t:""))):t(c)}}else e.formatValue&&c&&(c=d?c.map((t=>e.formatValue(t))):e.formatValue(c));d&&(c="[ "+c.join(", ")+" ]")}return(r.length>1?n:"")+("string"==typeof i?i:i.operator+" "+c)})).join("<br/><br/>")}else a=t.L("L{applyFilter}");o?o.dataset.filterText=a:o=DomHelper.createElement({parent:s,tag:"div",className:"b-filter-icon",dataset:{filterText:a}}),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),i.classList.add("b-filterable"),i.classList.toggle("b-filter",n)}e.meta.isFiltered=n}})),e&&r.refreshRows())}applyFilter(e,t){const{store:r}=this,{filterFn:n}=e.filterable;e.$filter=r.addFilter({...e.filterable,...t,property:e.field,[n?"filterBy":"_"]:function(t){return n({value:this.value,record:t,operator:this.operator,property:this.property,column:e})}},!0),r.filter()}removeFilter(e){if(this.isMulti)for(const t of this.getCurrentMultiFilters(e))this.store.removeFilter(t);else this.store.removeFilter(e.field)}disableFilter(e){for(const t of this.getCurrentMultiFilters(e))t.disabled=!0,this.store.filter(t);this.store.filter()}getCurrentMultiFilters(e){return this.store.filters.values.filter((t=>t.property===e.field))}getPopupDateItems(e,t,r,n,i,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:r}){null==r?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:r,displayValue:t._value,type:"date"}))}return[ObjectHelper.assign({type:"date",ref:"on",placeholder:"L{on}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-equal"></i>',value:"sameDay"===(null==r?void 0:r.operator)?r.value:n,operator:"sameDay",onKeydown:u,onChange:h,onClose:c,onClear:d},o),ObjectHelper.assign({type:"date",ref:"before",placeholder:"L{before}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-before"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onKeydown:u,onChange:h,onClose:c,onClear:d},o),ObjectHelper.assign({type:"date",ref:"after",cls:"b-last-row",placeholder:"L{after}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-after"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onKeydown:u,onChange:h,onClose:c,onClear:d},o)]}getPopupNumberItems(e,t,r,n,i,s,a,o){const l=this,c=s;function d(){l.removeFilter(e)}function u({event:e}){"Enter"===e.key&&s()}function h({source:t,value:r}){null==r?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:r}))}return[ObjectHelper.assign({type:"number",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-equal"></i>',value:"="===(null==r?void 0:r.operator)?r.value:n,operator:"=",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),ObjectHelper.assign({type:"number",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-less"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onKeydown:u,onChange:h,onEsc:c,onClear:d},o),ObjectHelper.assign({type:"number",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-more"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onKeydown:u,onChange:h,onEsc:c,onClear:d},o)]}clearSiblingsFields(e){var t;null==(t=this.filterEditorPopup)||t.items.forEach((t=>{t!==e&&(null==t||t.clear())}))}getPopupDurationItems(e,t,r,n,i,s,a,o){const l=this,c=s,d=()=>l.removeFilter(e);function u({source:t,value:r}){null==r?d():(l.clearSiblingsFields(t),l.applyFilter(e,{operator:t.operator,value:r}))}return[ObjectHelper.assign({type:"duration",placeholder:"L{Filter.equals}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-equal"></i>',value:"="===(null==r?void 0:r.operator)?r.value:n,operator:"=",onChange:u,onEsc:c,onClear:d},o),ObjectHelper.assign({type:"duration",placeholder:"L{lessThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-less"></i>',value:"<"===(null==r?void 0:r.operator)?r.value:null,operator:"<",onChange:u,onEsc:c,onClear:d},o),ObjectHelper.assign({type:"duration",cls:"b-last-row",placeholder:"L{moreThan}",localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-more"></i>',value:">"===(null==r?void 0:r.operator)?r.value:null,operator:">",onChange:u,onEsc:c,onClear:d},o)]}getPopupStringItems(e,t,r,n,i,s,a,o){const l=this;var c=e.type;return[ObjectHelper.assign({type:t,cls:"b-last-row",placeholder:"筛选",fieldName:c,localeClass:l,clearable:!0,label:'<i class="b-fw-icon gt-icon-filter-equal"></i>',value:r?r.value||r:n,operator:"*",onChange({source:t,value:r}){""===r?a():(l.applyFilter(e,{operator:t.operator,value:r,displayValue:t.displayField&&t.records?t.records.map((e=>e[t.displayField])).join(", "):void 0}),t.multiSelect||s())},onClose:s,onClear:a},o)]}getPopupItems(e,t,r,n,i,s,a,o){const l=this;if(l.isMulti)return l.getMultiFilterPopupItems(...arguments);switch(t){case"date":return l.getPopupDateItems(...arguments);case"number":return l.getPopupNumberItems(...arguments);case"duration":return l.getPopupDurationItems(...arguments);default:return l.getPopupStringItems(...arguments)}}getMultiFilterPopupItems(e){var t;const{grid:r,isMulti:n}=this,i=null==(t=r.store)?void 0:t.filters.find((t=>t.property===e.field));return[{..."object"==typeof n?n:void 0,type:"gridfieldfilterpickergroup",ref:"pickerGroup",limitToProperty:e.field,grid:r,filters:i?[]:[{property:e.field}],propertyFieldCls:"b-transparent property-field",operatorFieldCls:"b-transparent operator-field",valueFieldCls:"b-transparent value-field",width:"400px"}]}showFilterEditor(e,t){e=this.grid.columns.getById(e);const r=this,{store:n,isMulti:i}=r,s=e.element,a=n.filters.getBy("property",e.field),o=r.getFilterType(e);if(!1===e.filterable)return;r.closeFilterEditor();const l=r.getPopupItems(e,o,(null==a?void 0:a.internal)?null:a,t,n,r.closeFilterEditor,(()=>{r.removeFilter(e),r.closeFilterEditor()}),e.filterable.filterField,i);l.forEach((e=>e.placeholder=e.placeholder?this.L(e.placeholder):e.placeholder)),r.filterEditorPopup=WidgetHelper.openPopup(s,{owner:r.grid,cls:"b-filter-popup",scrollAction:"realign",layout:{type:"vbox",align:"stretch"},items:l})}closeFilterEditor(){var e;null==(e=this.filterEditorPopup)||e.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getFilterType(e){const t=e.field,r=this.client.store.modelClass.getFieldDefinition(t),n=e.filterType;return n?fieldTypeMap[n]:fieldTypeMap[e.type]||r&&fieldTypeMap[r.type]||"text"}populateCellMenuWithDateItems({column:e,record:t,items:r}){const n=e.field;if("date"===this.getFilterType(e)){t[n]}}populateCellMenuWithNumberItems({column:e,record:t,items:r}){const n=e.field;if("number"===this.getFilterType(e)){t[n]}}populateCellMenuWithDurationItems({column:e,record:t,items:r}){if("duration"===this.getFilterType(e)){e.getFilterableValue(t)}}populateCellMenuWithStringItems({column:e,record:t,items:r}){this.getFilterType(e)}populateCellMenu({column:e,record:t,items:r}){const n=this;!1===e.filterable||t.isSpecialRow||(n.populateCellMenuWithDateItems(...arguments),n.populateCellMenuWithNumberItems(...arguments),n.populateCellMenuWithDurationItems(...arguments),n.populateCellMenuWithStringItems(...arguments),e.meta.isFiltered&&(r.filterRemove={text:"L{removeFilter}",localeClass:n,icon:"b-fw-icon gt-icon-remove",cls:"b-separator",weight:400,disabled:n.disabled||n.isMulti&&!n.columnHasRemovableFilters(e),onItem:()=>n.removeFilter(e)}),n.isMulti&&(r.filterDisable={text:"L{disableFilter}",localeClass:n,icon:"b-fw-icon gt-icon-filter-disable",cls:"b-separator",weight:400,disabled:n.disabled||!n.columnHasEnabledFilters(e),onItem:()=>n.disableFilter(e)}))}columnHasRemovableFilters(e){const t=this;return Boolean(t.getCurrentMultiFilters(e).find((e=>!t.canDeleteFilter||!1!==t.callback(t.canDeleteFilter,t,[e]))))}columnHasEnabledFilters(e){return Boolean(this.getCurrentMultiFilters(e).find((e=>!e.disabled)))}populateHeaderMenu({column:e,items:t}){const r=this;e.meta.isFiltered?(t.editFilter={text:"L{editFilter}",localeClass:r,weight:100,icon:"b-fw-icon gt-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)},t.removeFilter={text:"L{removeFilter}",localeClass:r,weight:110,icon:"b-fw-icon gt-icon-remove",disabled:r.disabled||r.isMulti&&!r.columnHasRemovableFilters(e),onItem:()=>r.removeFilter(e)},r.isMulti&&(t.disableFilter={text:"L{disableFilter}",localeClass:r,icon:"b-fw-icon gt-icon-filter-disable",weight:115,disabled:r.disabled||!r.columnHasEnabledFilters(e),onItem:()=>r.disableFilter(e)})):!1!==e.filterable&&(t.filter={text:"L{filter}",localeClass:r,weight:100,icon:"b-fw-icon gt-icon-filter",cls:"b-separator",disabled:r.disabled,onItem:()=>r.showFilterEditor(e)})}onStoreBeforeFilter({filters:e}){var t;const{columns:r}=this.client;for(let n=0;n<e.count;n++){const i=e.getAt(n);if(!i.internal){const s=(i.columnOwned||this.prioritizeColumns)&&r.find((e=>!1!==e.filterable&&e.field===i.property));(null==(t=null==s?void 0:s.filterable)?void 0:t.filterFn)&&(s.$filter||(s.$filter=new CollectionFilter({columnOwned:!0,property:i.property,operator:i.operator,value:i.value,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,operator:this.operator,property:this.property,column:s})}})),s.$filter.value=i.value,s.$filter.displayValue=i.displayValue,s.$filter.operator=i.operator,e.splice(n,1,s.$filter))}}}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick({target:e}){if(this.filterEditorPopup&&this.closeFilterEditor(),e.classList.contains("b-filter-icon")){const t=e.closest(".b-grid-header");return this.showFilterEditor(t.dataset.columnId),!1}}showFilterEditorByKey({target:e}){const t=e.matches(".b-grid-header")&&e;return t&&this.showFilterEditor(t.dataset.columnId),Boolean(t)}isActionAvailable(e,t,r){const n=r.target.closest(".b-grid-header"),i=n&&this.client.columns.find((e=>e.id===n.dataset.columnId));return Boolean(null==i?void 0:i.filterable)}};Filter._$name="Filter",GridFeatureManager.registerFeature(Filter);var complexOperators={"*":null,isIncludedIn:null,startsWith:null,endsWidth:null},FilterBar=class extends InstancePlugin{static get $name(){return"FilterBar"}static get configurable(){return{prioritizeColumns:!1,keyStrokeFilterDelay:300,compactMode:!1,clearStoreFiltersOnHide:!0,keyMap:{ArrowUp:{handler:"disableGridNavigation",preventDefault:!1},ArrowRight:{handler:"disableGridNavigation",preventDefault:!1},ArrowDown:{handler:"disableGridNavigation",preventDefault:!1},ArrowLeft:{handler:"disableGridNavigation",preventDefault:!1},Enter:{handler:"disableGridNavigation",preventDefault:!1}}}}static get pluginConfig(){return{before:["renderContents"],chain:["afterColumnsChange","renderHeader","populateHeaderMenu","bindStore"]}}static get properties(){return{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSuspended:0}}construct(e,t){if(e.features.filter)throw new Error("Grid.feature.FilterBar feature may not be used together with Grid.feature.Filter, These features are mutually exclusive.");const r=this;r.grid=e,r.onColumnFilterFieldChange=r.onColumnFilterFieldChange.bind(r),super.construct(e,Array.isArray(t)?{filter:t}:t),r.bindStore(e.store),r.filter&&e.store.filter(r.filter),r.gridDetacher=e.ion({beforeElementClick:"onBeforeElementClick",thisObj:r})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeFilter:"onStoreBeforeFilter",filter:"onStoreFilter",thisObj:this})}doDestroy(){var e;this.destroyFilterBar(),null==(e=this.gridDetacher)||e.call(this),super.doDestroy()}doDisable(e){const{columns:t}=this.grid;null==t||t.forEach((t=>{const r=this.getColumnFilterField(t);r&&(r.disabled=e)})),super.doDisable(e)}updateCompactMode(e){this.client.headerContainer.classList[e?"add":"remove"]("b-filter-bar-compact");for(const t in this._columnFilters){const r=this._columnFilters[t];r.placeholder=e?r.column.headerText:null}}destroyFilterBar(){var e;null==(e=this.grid.columns)||e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){var e;const t=this;t.clearStoreFiltersOnHide&&t.suspendStoreTracking(),null==(e=t.grid.columns)||e.forEach((e=>t.hideColumnFilterField(e,!0))),t.grid.store.filter(),t.clearStoreFiltersOnHide&&t.resumeStoreTracking(),t.hidden=!0}showFilterBar(){this.suspendStoreTracking(),this.renderFilterBar(),this.resumeStoreTracking(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){this.grid.hideHeaders||(this.grid.columns.visibleColumns.forEach((e=>this.renderColumnFilterField(e))),this.rendered=!0)}renderColumnFilterField(e){const t=this,{grid:r}=t,n=t.getColumnFilterable(e);if(n&&e.isVisible){const i=e.element,s=r.store.filters.get(e.id)||r.store.filters.getBy("property",e.field);let a=t.getColumnFilterField(e);if(a)t.onColumnFilterFieldChange({source:a,value:a.value}),a.render(i),a.show();else{const o=(e.filterType||"text")+"field",{filterField:l}=n,c=null==l?void 0:l.cls;c&&delete n.filterField.cls,a=WidgetHelper.append(ObjectHelper.assign({type:o,cls:{[t.filterFieldCls]:1,[c]:c},dataset:{column:e.field},column:e,owner:r,clearable:!0,name:e.field,value:!s||s._filterBy||s.internal?"":t.buildFilterValue(s),inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange,disabled:t.disabled,placeholder:t.compactMode?e.headerText:null,format:e.format},l),i)[0],(null==l?void 0:l.hasOwnProperty("min"))||Object.defineProperty(a,"min",{get:()=>{var t;return null==(t=e.editor)?void 0:t.min},set:()=>null}),(null==l?void 0:l.hasOwnProperty("max"))||Object.defineProperty(a,"max",{get:()=>{var t;return null==(t=e.editor)?void 0:t.max},set:()=>null}),(null==l?void 0:l.hasOwnProperty("strictParsing"))||Object.defineProperty(a,"strictParsing",{get:()=>{var t;return null==(t=e.editor)?void 0:t.strictParsing},set:()=>null}),a.element.retainElement=!0,t.setColumnFilterField(e,a);const d=(null==l?void 0:l.store)&&(l.store.readUrl||l.store.data||l.store.isChained);if(a.isCombo&&!d&&0===a.store.count){const t=a.value,n=()=>{a.store.readUrl||a.store.isChained||(a.store.data=r.store.getDistinctValues(e.field,!0).map((t=>r.store.modelClass.new({id:t,[e.field]:t}))))};a.value=null,a.store.isSorted||a.store.sort({field:e.field,ascending:!0}),a.picker.ion({beforeShow:n}),n(),a.value=t}!t.filter&&a.value&&!1!==r.store.autoLoad&&t.onColumnFilterFieldChange({source:a,value:a.value})}i.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,{columns:t,store:r}=e.grid;let n,i;e._updatingFields=!0;for(const s of t.visibleColumns)n=e.getColumnFilterField(s),n&&(i=r.filters.get(s.id)||r.filters.getBy("property",s.field),i&&!i.internal?i._filterBy?n.value=i.value:n.value=e.buildFilterValue(i):n.value="");e._updatingFields=!1}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field&&e.isLeaf)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e,!0),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const r=this,{store:n}=r.grid,i=e.element,s=r.getColumnFilterField(e);if(s){r.isDestroying||s.hide();const{$filter:a}=e;!n.isDestroyed&&r.clearStoreFiltersOnHide&&a&&n.removeFilter(a,t),null==i||i.classList.remove(r.filterableColumnCls)}}getColumnFilterField(e){var t;return null==(t=this._columnFilters)?void 0:t[e.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e,t,r){var n;if(Array.isArray(t))return{value:t};if(ObjectHelper.isDate(t))return{operator:r.isDateField?"sameDay":r.isTimeField?"sameTime":"=",value:t};const i=String(t).match(this.filterParseRegExp);return{operator:i[1]||(null==(n=e.filterable)?void 0:n.operator)||"*",value:i[2]}}buildFilterValue({operator:e,value:t}){return t instanceof Date||Array.isArray(t)?t:(e in complexOperators?"":e)+t}onStoreBeforeFilter({filters:e}){var t;const{columns:r}=this.client;for(let n=0;n<e.count;n++){const i=e.getAt(n),s=(i.columnOwned||this.prioritizeColumns)&&r.find((e=>!1!==e.filterable&&e.field===i.property));(null==(t=null==s?void 0:s.filterable)?void 0:t.filterFn)&&(s.$filter||(s.$filter=new CollectionFilter({columnOwned:!0,property:i.property,id:s.id,filterBy(e){return s.filterable.filterFn({value:this.value,record:e,property:this.property,column:s})}})),s.$filter.value=i.value,e.splice(n,1,s.$filter))}}onStoreFilter(){!this.storeTrackingSuspended&&this.rendered&&this.updateColumnFilterFields()}afterColumnsChange({changes:e,column:t}){if(!this.hidden&&(null==e?void 0:e.hidden)){e.hidden.value?this.destroyColumnFilterField(t):this.renderColumnFilterField(t)}}suspendStoreTracking(){this.storeTrackingSuspended++}resumeStoreTracking(){this.storeTrackingSuspended--}renderHeader(){this.hidden||this.renderFilterBar()}renderContents(){if(this._columnFilters)for(const e of Object.values(this._columnFilters))null==e||e.element.remove()}disableGridNavigation(e){return e.target.matches(this.filterFieldInputSelector)}onBeforeElementClick({event:e}){if(e.target.closest("."+this.filterFieldCls))return!1}onColumnFilterFieldChange({source:e,value:t}){var r,n;const i=this,{column:s}=e,{filterFn:a}=s.filterable,{store:o}=i.grid,l=s.$filter||o.filters.find((e=>(e.id===s.id||e.property===s.field)&&!e.internal));if(i._updatingFields)return;const c=null==t||""===t||Array.isArray(t)&&0===t.length;if(o.removeFilter(l,!0),s.$filter=null,c){if(!l)return}else s.$filter=o.addFilter({property:e.name,...i.parseFilterValue(s,t,e),["boolean"==typeof(null==(r=s.filterable)?void 0:r.caseSensitive)?"caseSensitive":void 0]:null==(n=s.filterable)?void 0:n.caseSensitive,[a?"filterBy":"_"]:function(e){return a({value:this.value,record:e,operator:this.operator,property:this.property,column:s})}},!0);o.filter()}populateHeaderMenu({items:e}){e.toggleFilterBar={text:this.hidden?"L{enableFilterBar}":"L{disableFilterBar}",localeClass:this,weight:120,icon:"b-fw-icon gt-icon-filter",cls:"b-separator",onItem:()=>this.toggleFilterBar()}}};FilterBar.featureClass="b-filter-bar",FilterBar._$name="FilterBar",GridFeatureManager.registerFeature(FilterBar);var Group=class extends InstancePlugin{static get $name(){return"Group"}static get configurable(){return{field:null,groupSortFn:null,renderer:null,keyMap:{" ":"toggleGroup"}}}construct(e,t){const r=this;e.features.tree||(r._thisIsAUsedExpression(e.features.groupSummary),t=r.processConfig(t),r.grid=e,super.construct(e,t),r.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1100,thisObj:r}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",group:"onStoreGroup",change:"onStoreChange",thisObj:this}),this.onStoreGroup({groupers:e.groupers})}updateRenderer(e){this.groupRenderer=e}updateField(e){this.store.group({field:e,ascending:this.ascending,fn:this.groupSortFn})}updateGroupSortFn(e){this.isConfiguring||this.store.group({field:this.field,ascending:this.ascending,fn:e})}doDestroy(){super.doDestroy()}doDisable(e){const{store:t}=this;if(e&&t.isGrouped){const{sorters:e}=t;e.unshift(...t.groupers),t.clearGroupers(),t.sort(e)}super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","populateHeaderMenu","getColumnDragToolbarItems","onElementTouchStart","onElementClick","bindStore"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,r=!1){const{store:n,grid:i}=this,s=n.getById(e);s.isGroupHeader&&(t=void 0===t?!s.meta.collapsed:t,!1!==i.trigger("beforeToggleGroup",{groupRecord:s,collapse:t})&&(t?n.collapse(s):n.expand(s),r||(i.rowManager.rowCount>i.store.count?i.rowManager.renderFromRow():i.rowManager.renderFromRecord(s)),i.trigger("toggleGroup",{groupRecord:s,collapse:t}),i.afterToggleGroup()))}collapseAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!0,!0))),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&!e.disabled&&(e.store.groupRecords.forEach((t=>e.internalToggleCollapse(t,!1,!0))),e.grid.refreshRows())}onBeforeRenderRow({row:e}){const t=e.grid.store.getById(e.id);e.forceInnerHTML=e.forceInnerHTML||(null==t?void 0:t.isGroupHeader)}renderCell(e){const t=this,{cellElement:r,row:n,column:i}=e,{meta:s}=e.record,a={"b-group-row":0,"b-grid-group-collapsed":0};if(!t.disabled&&t.store.isGrouped&&"groupRowFor"in s){if("action"===i.type)return;i.clearCell(r),a["b-grid-group-collapsed"]=s.collapsed,a["b-group-row"]=1,i===t.groupHeaderColumn&&(r.classList.add("b-group-title"),r.$groupHeader=!0),t.buildGroupHeader(e)}else r.$groupHeader&&(r.classList.remove("b-group-title"),r.$groupHeader=!1);n.assignCls(a)}buildGroupHeader(e){const t=this,{record:r,cellElement:n,column:i,persist:s}=e,{grid:a}=t,o=r.meta,{groupRowFor:l}=o,{groupSummary:c}=a.features,d=o.childCount-(c&&"header"!==c.target?1:0);let u=null,h=!0;if(s||i){const s=a.columns.get(o.groupField),c=e.isFirstColumn=i===t.groupHeaderColumn;(null==s?void 0:s.groupRenderer)?c&&(u=s.groupRenderer({...e,groupRowFor:l,groupRecords:r.groupChildren,groupColumn:s,count:d}),h=!1):t.groupRenderer&&(u=t.groupRenderer({...e,groupRowFor:l,groupRecords:r.groupChildren,groupColumn:s,count:d,isFirstColumn:c})),c&&null==u&&h&&0===DomHelper.getChildElementCount(n)&&(u=StringHelper.encodeHtml(("__novalue__"===l?"":l)+" ("+d+")"))}else t.groupRenderer&&(u=t.groupRenderer(e));return"string"==typeof u?n.innerHTML=u:"object"==typeof u&&DomSync.sync({targetElement:n,domConfig:{onlyChildren:!0,children:ArrayHelper.asArray(u)}}),DomHelper.getChildElementCount(n)>0&&(n._hasHtml=!0),n.innerHTML}get groupHeaderColumn(){return this.grid.columns.visibleColumns.find((e=>!e.groupHeaderReserved))}renderHeader(e){const{store:t,grid:r}=this;if(t.isGrouped)for(const e of t.groupers){const t=r.columns.get(e.field),n=t&&r.getHeaderElement(t.id);null==n||n.classList.add("b-group",e.ascending?"b-asc":"b-desc")}}populateHeaderMenu({column:e,items:t}){const r=this;!1!==e.groupable&&(t.groupAsc={text:"L{groupAscending}",localeClass:r,icon:"b-fw-icon gt-icon-group-asc",cls:"b-separator",weight:400,disabled:r.disabled,onItem:()=>r.store.group(e.field,!0)},t.groupDesc={text:"L{groupDescending}",localeClass:r,icon:"b-fw-icon gt-icon-group-desc",weight:410,disabled:r.disabled,onItem:()=>r.store.group(e.field,!1)}),r.store.isGrouped&&(t.groupRemove={text:"L{stopGrouping}",localeClass:r,icon:"b-fw-icon gt-icon-clear",cls:e.groupable?"":"b-separator",weight:420,disabled:r.disabled,onItem:()=>r.store.clearGroupers()})}getColumnDragToolbarItems(e,t){var r;const n=this,{store:i,disabled:s}=n;t.push({text:"L{groupAscendingShort}",group:"L{group}",localeClass:n,icon:"gt-icon gt-icon-group-asc",ref:"groupAsc",cls:"b-separator",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!0)}),t.push({text:"L{groupDescendingShort}",group:"L{group}",localeClass:n,icon:"gt-icon gt-icon-group-desc",ref:"groupDesc",weight:110,disabled:s,onDrop:({column:e})=>i.group(e.field,!1)});const a=(null==(r=i.groupers)?void 0:r.some((t=>t.field===e.field)))&&!s;return t.push({text:"L{stopGroupingShort}",group:"L{group}",localeClass:n,icon:"gt-icon gt-icon-clear",ref:"groupRemove",disabled:!a,weight:110,onDrop:({column:e})=>i.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const{grid:t}=this,{element:r}=t,n=r&&DomHelper.children(r,".b-grid-header.b-group");if(r){for(const e of n)e.classList.remove("b-group","b-asc","b-desc");if(e)for(const r of e){const e=t.getHeaderElementByField(r.field);e&&e.classList.add("b-group",r.ascending?"b-asc":"b-desc")}}}onStoreChange({action:e,records:t}){const{client:r}=this,{rowManager:n,store:i}=r;if(i.isGrouped&&"move"===e){const{field:e}=i.groupers[0],r=Math.min(...t.reduce(((t,r)=>{if(t.push(i.indexOf(r.instanceMeta(i).groupParent)),e in r.meta.modified){const n=i.groupRecords.find((t=>t.meta.groupRowFor===r.meta.modified[e]));n&&t.push(i.indexOf(n))}return t}),[]));n.renderFromRow(n.getRow(r))}}onElementTouchStart(e){const t=this,{target:r}=e,n=r.closest(".b-grid-header"),i=n&&t.grid.getColumnFromElement(n);e.touches.length>1&&i&&!1!==i.groupable&&!t.disabled&&t.store.group(i.field)}onElementClick(e){var t;const r=this,{store:n}=r,{target:i}=e,s=i.closest(".b-group-row"),a=i.closest(".b-grid-header"),o=null==a?void 0:a.dataset.column;if(!(i.classList.contains("b-resizer")||r.disabled||i.classList.contains("b-action-item")||e.handled)){if(a&&o){const i=null==(t=n.groupers)?void 0:t.find((e=>e.field===o));if(i&&!e.shiftKey)return i.ascending=!i.ascending,n.group(),!1;if(e.shiftKey){!1!==r.grid.columns.get(o).groupable&&(e.altKey?n.removeGrouper(o):n.group(o))}}return s?(r.internalToggleCollapse(DomDataStore.get(s).id),!1):void 0}}toggleGroup(e){var t;const{grid:r}=this,{focusedCell:n}=r;return!(this.disabled||n.isActionable||!(null==(t=n.record)?void 0:t.isGroupHeader))&&(this.internalToggleCollapse(n.id),!0)}};Group._$name="Group",GridFeatureManager.registerFeature(Group,!0,["Grid","Scheduler"]),GridFeatureManager.registerFeature(Group,!1,["TreeGrid"]);var SummaryFormatter_default=e=>class extends(e||Base){static get $name(){return"SummaryFormatter"}generateHtml(e,t,r,n,i,s){const a=this.store,o=e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[]);let l='<table class="'+r+'">';return o.forEach((r=>{let n=r.sum,i=null;switch(!0===n&&(n="sum"),n){case"sum":case"add":i=a.sum(e.field,t);break;case"max":i=a.max(e.field,t);break;case"min":i=a.min(e.field,t);break;case"average":case"avg":i=a.average(e.field,t);break;case"count":i=t.length;break;case"countNotEmpty":i=t.reduce(((t,r)=>t+(null!=r[e.field]?1:0)),0)}if("function"==typeof n&&(i=t.reduce(n,"seed"in r?r.seed:0)),null!==i){const e="b-grid-summary-value",t=r.label?'<td class="b-grid-summary-label">'+r.label+"</td>":"";let n,s=r.renderer?r.renderer({config:r,sum:i}):i;null==s&&(s=""),n=String(s).includes("<td>")?s:t?t+'<td class="'+e+'">'+s+"</td>":'<td colspan="2" class="'+e+'">'+s+"</td>",l+="<tr>"+n+"</tr>"}})),l+"</table>"}},GroupSummary=class extends(SummaryFormatter_default(InstancePlugin)){static get $name(){return"GroupSummary"}static get configurable(){return{collapseToHeader:null,target:"footer"}}construct(e,t){if(this.grid=e,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");this.bindStore(e.store),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",renderCell:"renderCell",prio:1e3,thisObj:this})}bindStore(e){this.detachListeners("store"),e.ion({name:"store",update:"onStoreUpdate",prio:1,thisObj:this})}get store(){return this.grid.store}doDisable(e){this.updateTarget(this.target),super.doDisable(e)}changeTarget(e){return ObjectHelper.assertString(e,"target"),e}updateTarget(e){this.store.useGroupFooters=!this.disabled&&"footer"===e,this.isConfiguring||this.store.group()}changeCollapseToHeader(e){return ObjectHelper.assertBoolean(e,"collapseToHeader"),e}updateCollapseToHeader(){this.isConfiguring||this.store.group()}static get pluginConfig(){return{chain:["bindStore"]}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!("groupFooterFor"in t.meta)?(e.isGroupFooter=!1,e.forceInnerHTML=!0):e.isGroupHeader&&!t.meta.collapsed&&e.eachElement(this.removeSummaryElements)}removeSummaryElements(e){}renderCell({column:e,cellElement:t,row:r,record:n,size:i,isFirstColumn:s}){const a=this,{meta:o}=n,{rowHeight:l}=a.grid,c="groupRowFor"in o,d="groupFooterFor"in o,u="header"===a.target,h={"b-group-footer":0,"b-header-summary":0},g=c&&(u||a.collapseToHeader&&o.collapsed)&&!s||d&&!u;if((c||d)&&(i.height=l),a.store.isGrouped&&g&&!a.disabled){e.clearCell(t);const s=c?n:o.groupRecord;r.isGroupFooter=d,r.isGroupHeader=c,d?h["b-group-footer"]=1:h["b-header-summary"]=1;const g=a.updateSummaryHtml(t,e,s),p="number"==typeof g?g:g.count;p>1&&(i.height+=o.collapsed&&!u?0:p*l*.1),g.height&&(i.height+=g.height)}r.assignCls(h)}updateSummaryHtml(e,t,r){const n=r.groupChildren.slice();n[n.length-1].isGroupFooter&&n.pop();const i=this.generateHtml(t,n,"b-grid-group-summary",r,r.meta.groupField,r.meta.groupRowFor);return e.children.length?DomHelper.sync(i,e.firstElementChild):e.innerHTML=i,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){if(!this.disabled&&e.isGrouped){if(t&&e.groupers.find((e=>e.field in t)))return;Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))&&(this.grid.forceFullRefresh=!0)}}refresh(){this.grid.columns.visibleColumns.forEach((e=>{this.hasSummary(e)&&this.grid.refreshColumn(e)}))}hasSummary(e){return e.sum||e.summaries}};GroupSummary.featureClass="b-group-summary",GroupSummary._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary);var HeaderMenu=class extends ContextMenuBase{static get $name(){return"HeaderMenu"}static get configurable(){return{type:"header",items:null,moveColumns:null}}static get defaultConfig(){return{processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateHeaderMenu"),e}shouldShowMenu(e){const{column:t}=e;return t&&!1!==t.enableHeaderContextMenu&&t!==this.client.timeAxisColumn}getDataFromEvent(e){return ObjectHelper.assign(super.getDataFromEvent(e),this.client.getHeaderDataFromEvent(e))}populateHeaderMenu({items:e,column:t}){const r=this;if(t){if(t.headerMenuItems&&ObjectHelper.merge(e,t.headerMenuItems),t.isCollapsible){const{collapsed:n}=t,i=n?r.client.rtl?"left":"right":r.client.rtl?"right":"left";e.toggleCollapse={weight:215,icon:"b-fw-icon gt-icon-collapse-"+i,text:r.L(n?"L{expandColumn}":"L{collapseColumn}"),onItem:()=>t.collapsed=!n}}if(r.moveColumns){const n=r.getColumnToMoveBefore(t),i=r.getColumnToMoveAfter(t);n&&(e.movePrev={weight:220,icon:"b-fw-icon gt-icon-column-move-left",text:r.L("L{moveBefore}",StringHelper.encodeHtml(n.text)),onItem:()=>{var e;const{parent:r}=t;n.parent.insertChild(t,n)&&(t.region=n.region,(null==(e=r.children)?void 0:e.length)||r.remove())}}),i&&(e.moveNext={weight:230,icon:"b-fw-icon gt-icon-column-move-right",text:r.L("L{moveAfter}",StringHelper.encodeHtml(i.text)),onItem:()=>{var e;const{parent:r}=t;i.parent.insertChild(t,i.nextSibling)&&(t.region=i.region,(null==(e=r.children)?void 0:e.length)||r.remove())}})}}return e}getColumnToMoveBefore(e){const{previousSibling:t,parent:r}=e;return t?t.children&&!e.children?t.children[t.children.length-1]:t:r.isRoot?void 0:r}getColumnToMoveAfter(e){const{nextSibling:t,parent:r}=e;return t||(r.isRoot?void 0:r)}};HeaderMenu.featureClass="",HeaderMenu._$name="HeaderMenu",GridFeatureManager.registerFeature(HeaderMenu,!0);var camelCase={mousedown:"mouseDown",mousemove:"mouseMove",mouseup:"mouseUp",touchdown:"touchDown",touchmove:"touchMove",touchup:"touchUp",pointerover:"mouseOver",mouseout:"mouseOut",dblclick:"dblClick",keydown:"keyDown",keypress:"keyPress",keyup:"keyUp",contextmenu:"contextMenu"},MergeCells=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"mergedRanges",[]),__publicField(this,"mergedMap",{})}static get pluginConfig(){return{chain:["beforeRenderCell","afterRenderRow","bindStore","afterColumnsChange","afterRemove","afterToggleGroup","afterToggleSubGrid","handleEvent","populateHeaderMenu","afterSelectionChange"],before:["onInternalResize"],override:["getColumnFromElement","getRecordFromElement"]}}afterConstruct(){const e=this,{client:t}=e;t.eachSubGrid((t=>e.setupSubGrid(t))),t.rowManager.ion({renderDone:"onRenderDone",thisObj:e}),e.bindStore(t.store)}setupSubGrid(e){e.$mergedCellsElement=DomHelper.createElement({parent:e.element,className:{"b-grid-merged-cells-container":1}})}doDisable(e){this.isConfiguring||(this.isDisabling=!0,this.reset(),this.isDisabling=!1),super.doDisable(e)}updatePassthrough(e){this.client.element.classList.toggle("b-mergecells-passthrough",e)}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",refresh:{prio:1,fn:"onStoreRefresh"},thisObj:this})}onInternalResize(){this.refreshBounds()}beforeRenderCell(e){const{column:t,record:r,cellElement:n}=e,i=this.client.subGrids[t.region];if(!this.disabled&&t.mergeCells&&t.isSorted&&!r.isSpecialRow&&!i.collapsed){const i=this.getMergeRange(r,t);(null==i?void 0:i.use)&&(n.classList.add("b-merged-cell"),n.innerHTML="",e.cellElement=i.cellElement)}}afterRenderRow({row:e,oldId:t,oldHeight:r}){t===e.id&&r!==e.height&&(this.heightChanged=!0)}afterColumnsChange({action:e,changes:t,column:r}){if(!this.disabled)if("update"!==e||!t.mergeCells||r.mergeCells)this.refreshBounds();else{for(const e of this.mergedRanges.slice())e.column===r&&this.removeRange(e);this.syncDom()}}afterRemove(){!this.disabled&&this.reset()}afterToggleGroup(){!this.disabled&&this.reset()}afterToggleSubGrid(){!this.disabled&&this.reset()}afterSelectionChange(){if(!this.passthrough){const{client:e}=this,t=e.selectedRecords.map((t=>e.store.indexOf(t)));let r=!1;for(const e of this.mergedRanges){let n=!0;for(let r=e.fromIndex;r<=e.toIndex&&n;r++)n=t.includes(r);e.isSelected!==n&&(e.isSelected=n,r=!0)}r&&this.syncDom()}}getRecordFromElement(e){var t;return(null==(t=e.elementData)?void 0:t.range)?this.client.store.getAt(e.elementData.range.fromIndex):this.overridden.getRecordFromElement(e)}getColumnFromElement(e){var t;return(null==(t=e.elementData)?void 0:t.range)?e.elementData.range.column:this.overridden.getColumnFromElement(e)}populateHeaderMenu({column:e,items:t}){!1!==e.mergeable&&(t.mergeCells={text:"L{MergeCells.mergeCells}",icon:"b-fw-icon "+(e.mergeCells?"gt-icon-checked":"gt-icon-unchecked"),tooltip:"L{MergeCells.menuTooltip}",cls:"b-separator",weight:500,disabled:this.disabled,onItem:()=>e.mergeCells=!e.mergeCells})}async handleEvent(e){var t;if(!this.passthrough){const r=e.target.closest(".b-grid-merged-cells");if(r){const{client:n}=this,{range:i}=r.elementData,{cellEdit:s}=n.features,{column:a}=i,o=StringHelper.capitalize(null!=(t=camelCase[e.type])?t:e.type),l={grid:n,records:[],column:a,cellElement:r.firstElementChild,target:e.target,event:e};for(let e=i.fromIndex;e<=i.toIndex;e++)l.records.push(n.store.getAt(e));if(n.trigger("mergedCell"+o,l),(null==s?void 0:s.triggerEvent.toLowerCase())===("cell"+o).toLowerCase()){const t=n.rowManager.getRowAt(e.clientY);await s.startEditing({id:t.id,columnId:a.id})}else"click"===e.type&&this.onRangeClick({range:i})}}}onRangeClick({range:e}){const t=[];for(let r=e.fromIndex;r<=e.toIndex;r++)t.push(this.client.store.getAt(r));this.client.selectedRecords=t}onStoreChange(){!this.disabled&&this.reset()}onStoreRefresh({action:e}){"filter"!==e&&"dataset"!==e&&!this.disabled&&this.reset(!1)}createRangeElement(e){var t,r,n;const i=this.client.getSubGridFromColumn(e.column).$mergedCellsElement,s=e.fromIndex+"-@-"+e.column.id;let a=null!=(n=null==(t=i.syncIdMap)?void 0:t[s])?n:null==(r=i.releasedIdMap)?void 0:r[s];return i.releasedIdMap&&delete i.releasedIdMap[s],a||(a=DomHelper.createElement(this.createRangeDomConfig(e))),DomSync.addChild(i,a,s),e.element=a,e.cellElement=a.firstElementChild,a}createRangeDomConfig(e){var t;const{column:r,fromIndex:n,toIndex:i,top:s,left:a,width:o,height:l}=e,{type:c}=r,d=this.client.store.getAt(n),u={className:{"b-grid-merged-cells":1,"b-selected":e.isSelected},elementData:{range:e},style:{top:s,left:a,height:l,width:o},dataset:{syncId:n+"-@-"+r.id,fromIndex:n,toIndex:i,column:r.field,columnId:r.id},children:[{className:new DomClassList(this.client.cellCls).assign({["b-"+(null==c?void 0:c.toLowerCase())+"-cell"]:c,[r.cellCls]:r.cellCls,[r.internalCellCls]:r.internalCellCls}).assign(r.autoCls),keepChildren:!0,elementData:{range:e},dataset:{column:r.field,columnId:r.id},style:{height:this.client.rowManager.rowHeight}}]};return null==(t=r.mergedRenderer)||t.call(r,{domConfig:u,value:r.getRawValue(d),record:d,column:r,fromIndex:n,toIndex:i}),u}buildMergedCellsConfig(e,t,r){var n,i;const s=this,{client:a}=s,{rowManager:o}=a;e=null!=e?e:null==(n=o.topRow)?void 0:n.dataIndex,t=null!=t?t:null==(i=o.bottomRow)?void 0:i.dataIndex;const l=a.regions.reduce(((e,t)=>(e[t]={className:{"b-grid-merged-cells-container":1},children:[]},e)),{});for(const n of s.mergedRanges)n.use&&n.fromIndex<=t&&n.toIndex>=e&&(s.updateRange(n,s.heightChanged,r),l[n.column.region].children.push(s.createRangeDomConfig(n)));return l}syncDom(e=!1){const t=this,{client:r}=t,{rowManager:n}=r;if(!e&&!n.topRow||t.disabled&&!t.isDisabling)return;const i=this.buildMergedCellsConfig();r.eachSubGrid((e=>{DomSync.sync({targetElement:e.$mergedCellsElement,syncIdField:"syncId",domConfig:i[e.region]})})),t.heightChanged=!1}onRenderDone(){this.syncDom()}removeRange(e){ArrayHelper.remove(this.mergedRanges,e);for(let t=e.fromIndex;t<=e.toIndex;t++)delete this.mergedMap[t+"-@-"+e.column.id]}reset(e=!0){const t=this,r=t.client.columns.visibleColumns.filter((e=>e.mergeCells&&e.isSorted),!0),n=t.mergedRanges.length;if(t.mergedRanges=[],t.mergedMap={},e&&!t.client.refreshSuspended){for(const e of t.client.rowManager.rows)for(const t of r)e.renderCell(e.getCell(t.id));t.syncDom(n&&!t.client.rowManager.rowCount)}}refreshBounds(){const{mergedRanges:e}=this,t=new Map;for(const r of e.slice()){const{column:e}=r,{element:n}=e;if(n){let i=t.get(e);i||t.set(e,i=Rectangle.from(n,n.parentElement)),r.left=i.left,r.width=i.width}else this.removeRange(r)}this.syncDom()}updateRange(e,t,r=null){const{store:n,rowManager:i}=this.client,{topRendered:s,bottomRendered:a}=e,{rowOffsetHeight:o}=i;let l,c,{fromIndex:d,toIndex:u}=e;if((t=r?r.length>0:t)||!s||!a){if(!s||t){if(r){const e=r.findIndex((e=>e.dataIndex>=d));l=r[e],d=l.dataIndex}else do{l=i.getRowById(n.getAt(d))}while(!l&&d++<u);e.topRendered=d===e.fromIndex;const t=d-e.fromIndex;e.top=l.top-t*(r?l.offsetHeight:o)}if(!a||t){if(r){const e=r.findIndex((e=>e.dataIndex===u));c=r[-1===e?r.length-1:e],d=c.dataIndex}else do{c=i.getRowById(n.getAt(u))}while(!c&&u-- >d);e.bottomRendered=u===e.toIndex;const t=e.toIndex-u;e.bottom=c.bottom+t*(r?c.offsetHeight:o)}e.height=e.bottom-e.top}}getMergeRange(e,t){if(e.isSpecialRow)return;const r=this,{mergedMap:n}=r,{store:i}=r.client,s=t.id,a=i.indexOf(e),o=a+"-@-"+s;let l=n[o];if(!l){const c=t.getRawValue(e);l=n[o]={column:t},r.mergedRanges.push(l);let d,u,h=a;do{d=i.getAt(--h),u=d&&t.getRawValue(d),u===c&&(n[h+"-@-"+s]=l)}while(d&&u===c);let g,p,m=a;do{g=i.getAt(++m),p=g&&t.getRawValue(g),p===c&&(n[m+"-@-"+s]=l)}while(g&&p===c);if(l.fromIndex=h+1,l.toIndex=m-1,l.toIndex-l.fromIndex>0){const e=Rectangle.from(t.element,t.element.parentElement);l.left=e.left,l.width=e.width,l.use=!0}}return!l.element&&l.use&&r.createRangeElement(l),l}};__publicField(MergeCells,"$name","MergeCells"),__publicField(MergeCells,"configurable",{passthrough:!0}),MergeCells._$name="MergeCells",GridFeatureManager.registerFeature(MergeCells);var QuickFind=class extends InstancePlugin{static get $name(){return"QuickFind"}static get pluginConfig(){return{chain:["onElementKeyPress","onCellNavigate"]}}static get properties(){return{hitCls:"b-quick-hit",hitCellCls:"b-quick-hit-cell",hitCellBadgeCls:"b-quick-hit-cell-badge",hitTextCls:"b-quick-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,treeWalker:e.setupTreeWalker(e.element,DomHelper.NodeFilter.SHOW_TEXT,(()=>DomHelper.NodeFilter.FILTER_ACCEPT))})}isActionAvailable(){const{focusedCell:e}=this.grid;return!this.disabled&&(null==e?void 0:e.record)&&!e.isActionable&&this.find.length>0}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[r,n,i]=DomHelper.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},{returnAll:!0});"header"===e.mode?t.appendChild(r):(r.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(r)),e.headerField={header:r,field:n,badge:i,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.ion({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this,{grid:t,headerField:r}=e;for(const r of e.prevFound||e.found){const n=t.getRowById(r.id);if(n){n.forceInnerHTML=!0;const t=n.getCell(e.columnId);t._content=null,n.renderCell(t),n.forceInnerHTML=!1}}r&&(r.header.parentNode.removeChild(r.header),r.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(t.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),t.trigger("hideQuickFind")}search(e,t=this.columnId){const r=this,{grid:n}=r,i=n.columns.getById(t)||n.columns.get(t),s=r.store.findByField(i.field,e,i.mergeCells&&i.isSorted);let a=1;Object.assign(r,{foundMap:{},prevFound:r.found,found:s,find:e,columnId:i.id,findRe:new RegExp("(\\s+)?("+StringHelper.escapeRegExp(String(e))+")(s+)?","ig")}),e?r.showQuickFind():r.hideQuickFind();for(const e of DomHelper.children(n.element,"."+r.hitCls))e.classList.remove(r.hitCls,r.hitCellCls),e._originalContent&&(e.innerHTML=e._originalContent,e._originalContent=null);if(s){s.length>0&&r.gotoClosestHit(n.focusedCell,s);for(const e of s){r.foundMap[e.id]=a++;const t=n.getRowById(e.data.id);if(null==t||t.renderCell(t.getCell(i.id)),a>1e3)break}n.trigger("quickFind",{find:e,found:s})}}clear(){var e;(this.find||(null==(e=this.found)?void 0:e.length))&&this.search("")}get foundCount(){var e,t;return null!=(t=null==(e=this.found)?void 0:e.length)?t:0}gotoHit(e){const t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id},{doSelect:!0}),!!t}gotoClosestHit(e,t){const r=e?this.grid.store.indexOf(e.id):0,n=t.slice().sort(((e,t)=>Math.abs(e.index-r)-Math.abs(t.index-r)));this.gotoHit(t.indexOf(n[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){var e,t,r;const n=this,{grid:i}=n,s=null!=(r=null==(e=i._focusedCell)?void 0:e.id)?r:null==(t=i.lastFocusedCell)?void 0:t.id,a=i.store.indexOf(s)||0,o=n.found.find((e=>e.index>a));o?i.focusCell({columnId:n.columnId,id:o.id},{doSelect:!0}):n.gotoFirstHit()}gotoPrevHit(){var e,t,r;const n=this,{grid:i,found:s}=n,a=null!=(r=null==(e=i._focusedCell)?void 0:e.id)?r:null==(t=i.lastFocusedCell)?void 0:t.id,o=i.store.indexOf(a)||0;let l;if(s.length){for(let e=s.length-1;e--;e>=0)if(s[e].index<o){l=s[e];break}l?i.focusCell({columnId:n.columnId,id:l.id},{doSelect:!0}):n.gotoLastHit()}}renderCell({cellElement:e,column:t,record:r}){var n;const i=this,{classList:s}=e,{treeWalker:a,findRe:o,hitTextCls:l}=i,c=i.columnId===t.id&&(null==(n=i.foundMap)?void 0:n[r.id]);if(c){s.add(i.hitCls),e.isQuickHit=!0,e._originalContent=e.innerHTML;const t=a.currentNode=DomHelper.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;for(let e=a.nextNode();e&&t.contains(e);){const t=e,r=e.nodeValue,n=["<span>"];e=a.nextNode();let i=o.lastIndex;for(let e=o.exec(r);e;e=o.exec(r)){const t=r.substring(i,e.index),s=e[1]?" ":"",a=e[2],c=e[3]?" ":"";n.push(""+StringHelper.encodeHtml(t)+s+'<span class="'+l+'">'+a+"</span>"+c),i=o.lastIndex}n.push(StringHelper.encodeHtml(r.substring(i)),"</span>"),t.parentNode.insertBefore(DomHelper.createElementFromTemplate(n.join(""),{fragment:!0}),t),t.remove()}DomHelper.createElement({parent:e,className:i.hitCellBadgeCls,text:c})}}onBackspace(e){const t=this;return!!t.find&&(t.find=t.find.substr(0,t.find.length-1),t.search(t.find),!0)}clearSearch(){return!!this.find&&(this.find="",this.search(this.find),!0)}showFilterEditor(){const e=this,{filter:t}=e.client.features;t&&e.columnId&&e.foundCount&&(e.clear(),t.showFilterEditor(e.client.columns.getById(e.columnId),e.find))}onElementKeyPress(e){var t;const r=this,{grid:n}=r,{focusedCell:i}=n;if(!e.handled&&!r.disabled&&(null==i?void 0:i.record)&&!i.isActionable&&1===(null==(t=e.key)?void 0:t.length)){const t=n.columns.getById(n._focusedCell.columnId);t&&!1!==t.searchable&&(r.columnId=n._focusedCell.columnId,r.find+=e.key,r.search(r.find))}}onCellNavigate(e,t,r){const n=this;!n.find||r&&r.columnId===n.columnId||n.clear()}};__publicField(QuickFind,"configurable",{mode:"header",find:"",keyMap:{F3:"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+g":"gotoNextHit","Ctrl+Shift+g":"gotoPrevHit","Ctrl+Shift+f":"showFilterEditor",Escape:"clearSearch",Backspace:"onBackspace"}}),QuickFind._$name="QuickFind",GridFeatureManager.registerFeature(QuickFind);var RegionResize=class extends InstancePlugin{static get pluginConfig(){return{chain:["onElementPointerDown","onElementDblClick","onElementTouchMove","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,{client:r}=t,n=e.target.closest(".b-grid-splitter-collapsed");if(n&&!t.expanding){t.expanding=!0;let e=n.dataset.region,i=r.getSubGrid(e);i.collapsed||(e=r.getLastRegions()[1],i=r.getSubGrid(e)),i.expand().then((()=>t.expanding=!1))}}startMove(e,t){const r=this,{client:n}=r,i=e.dataset.region,s=n.element,a=n.regions[n.regions.indexOf(i)+1],o=n.getSubGrid(a),l=n.getSubGrid(i);let c=l,d=1;if(null!=c.flex&&null==o.flex&&(c=o,d=-1),n.rtl&&(d*=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const u=c.element.offsetWidth+o.element.offsetWidth;r.dragContext={element:e,headerEl:c.header.element,subGridEl:c.element,subGrid:c,splitterSubGrid:l,originalWidth:c.element.offsetWidth,originalX:t,minWidth:c.minWidth||0,maxWidth:Math.min(u,c.maxWidth||u),flip:d},s.classList.add("b-moving-splitter"),l.toggleSplitterCls("b-moving"),r.pointerDetacher=EventHelper.on({element:document,pointermove:"onPointerMove",pointerup:"onPointerUp",thisObj:r})}endMove(){const e=this,{dragContext:t}=e;t&&(e.pointerDetacher(),e.client.element.classList.remove("b-moving-splitter"),t.splitterSubGrid.toggleSplitterCls("b-moving",!1),e.dragContext=null)}onCollapseClick(e,t){const{client:r}=this,n=t.dataset.region,i=r.getLastRegions();if(i[0]===n){const e=r.getSubGrid(i[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const{client:r}=this,n=t.dataset.region,i=r.getLastRegions();if(i[0]!==n||e.collapsed)e.expand();else{r.getSubGrid(i[1]).collapse()}}updateMove(e){const{dragContext:t}=this;if(t){const r=e-t.originalX,n=Math.max(Math.min(t.maxWidth,t.originalWidth+r*t.flip),0);t.subGrid.width=Math.max(n,t.minWidth)}}onElementPointerDown(e){const t=this,{target:r}=e,n=0===e.button&&r.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),i=n&&t.client.getSubGrid(n.dataset.region);let s;n&&(r.closest(".b-grid-splitter-button-collapse")?t.onCollapseClick(i,n):r.closest(".b-grid-splitter-button-expand")?t.onExpandClick(i,n):(t.startMove(n,e.clientX),s=n)),"touch"===e.pointerType&&t.toggleTouchSplitter(s)}onPointerMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&e.preventDefault()}onPointerUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse({subGrid:e}){const t=this.client.resolveSplitter(e);this.client.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand({subGrid:e}){this.client.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}toggleTouchSplitter(e){const t=this,{touchedSplitter:r}=t;e&&r&&e.dataset.region!==r.dataset.region&&t.toggleTouchSplitter();const n=t.client.getSubGrid(e?e.dataset.region:null==r?void 0:r.dataset.region);n&&(n.toggleSplitterCls("b-touching",Boolean(e)),e?n.startSplitterButtonSyncing():n.stopSplitterButtonSyncing()),t.touchedSplitter=e}render(){const{regions:e,subGrids:t}=this.client;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}};__publicField(RegionResize,"$name","RegionResize"),RegionResize.featureClass="b-split",RegionResize._$name="RegionResize",GridFeatureManager.registerFeature(RegionResize);var RowCopyPaste=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"clipboardRecords",[]),__publicField(this,"entityName","row")}construct(e,t){super.construct(e,t),e.rowManager.ion({beforeRenderRow:"onBeforeRenderRow",thisObj:this}),this.grid=e}onBeforeRenderRow({row:e,record:t}){e.cls["b-cut-row"]=this._isCut&&this.clipboardRecords.includes(t)}isActionAvailable(e,t,r){var n;const{grid:i}=this,{cellEdit:s}=i.features,{target:a}=r;return!this.disabled&&0===globalThis.getSelection().toString().length&&(!s||!s.isEditing)&&(null==(n=i.selectedRecords)?void 0:n.length)>0&&(!a||Boolean(a.closest(".b-gridbase:not(.b-schedulerbase) .b-grid-subgrid,.b-grid-subgrid:not(.b-timeaxissubgrid)")))}copy(){this.copyRows()}cut(){this.copyRows(!0)}paste(e){this.pasteRows((null==e?void 0:e.isModel)?e:null)}copyRows(e=!1){const t=this,{client:r,entityName:n}=t,i=t.selectedRecords.filter((t=>!t.readOnly||!e));i.length&&!r.readOnly&&!1!==r.trigger("beforeCopy",{records:i,isCut:e,entityName:n})&&(t._isCut=e,t.clipboardRecords.forEach((e=>{var t;return null==(t=r.rowManager.getRowById(e))?void 0:t.removeCls("b-cut-row")})),t.clipboardRecords=i.slice(),r.store.forEach((e=>{e.meta.isCut=t._isCut&&t.clipboardRecords.includes(e)})),i.forEach((t=>this.onRowCutOrCopy(t,e))),r.trigger("copy",{records:i,isCut:e,entityName:n}))}onRowCutOrCopy(e,t){var r;null==(r=this.client.rowManager.getRowById(e))||r.toggleCls("b-cut-row",t)}pasteRows(e){var t,r;const n=this,i=n.clipboardRecords,{client:s,entityName:a}=n,{store:o}=s,l=e||s.selectedRecord;if(s.readOnly||s.isTreeGrouped||!i.length||o.tree&&n._isCut&&i.some((e=>e.contains(l,!0)))||!1===s.trigger("beforePaste",{records:i,referenceRecord:l,isCut:n._isCut,entityName:a}))return[];n.sortByIndex(i);const c=n.extractParents(i,{});return n.insertCopiedRecords(c,l),n._isCut?n.clearClipboard():s.selectedRecords=c,s.trigger("paste",{records:c,originalRecords:i,isCut:n._isCut,referenceRecord:l,entityName:a}),null==(r=null==(t=s.getRowFor(c[c.length-1]))?void 0:t.cells)||r[0].focus(),c}clearClipboard(){this._isCut&&this.clipboardRecords.forEach((e=>{var t;return null==(t=this.client.rowManager.getRowById(e))?void 0:t.removeCls("b-cut-row")})),this._isCut=!1,this.clipboardRecords=[]}generateNewName(e){const t=e[this.nameField];let r=2;for(;this.client.store.findRecord(this.nameField,t+" - "+r);)r++;return t+" - "+r}insertCopiedRecords(e,t){const{store:r}=this.client,n=r.indexOf(t)+1;return r.tree?t.parent.insertChild(e,t.nextSibling,!1,{orderedBeforeNode:t.nextOrderedSibling}):this._isCut?void r.move(e,r.getAt(n)):r.insert(n,e)}get selectedRecords(){const e=[...this.client.selectedRecords];return this.client.selectedCells.forEach((t=>{e.includes(t.record)||e.push(t.record)})),e}getMenuItemText(e,t=!1){const r=this;let n=r[e+"RecordText"];return t&&(n+=" ("+(r.selectedRecords.length>1?r.rowSpecifierTextPlural:r.rowSpecifierText)+")"),n}populateCellMenu({record:e,items:t,cellSelector:r}){var n;const{client:i,rowOptionsOnCellContextMenu:s}=this,a=!0===(null==(n=i.features.cellCopyPaste)?void 0:n.enabled),o=a&&i.isCellSelected(r);!i.readOnly&&!i.isTreeGrouped&&!1===(null==e?void 0:e.isSpecialRow)&&(a?i.selectedRows.length:i.selectedRecords.length)&&(!o||this.rowOptionsOnCellContextMenu)}sortByIndex(e){const{store:t}=this.client;return e.sort(((r,n)=>{const i=r.indexPath,s=n.indexPath;if(!e.includes(r.parent)&&!e.includes(n.parent))return t.indexOf(r)-t.indexOf(n);if(i.length===s.length){for(let e=0;e<i.length;e++){if(i[e]<s[e])return-1;if(i[e]>s[e])return 1}return 0}return i.length-s.length}))}extractParents(e,t){const r=this,{client:n,_isCut:i}=r;n.store.tree&&e.forEach((t=>{t.traverse((t=>{const r=t.getTopParent(!0);e.includes(t)||i&&e.some((e=>r.includes(e)))||e.push(t)}))}));const s=e.reduce(((e,s)=>{let a;const o=s.parentId||s.meta.modified;return i?(a=s,a.meta.isCut=!1):(a=s.copy(),a[r.nameField]=r.generateNewName(a),a.data.expanded=s.isExpanded(n.store)),t[s.id]=a,s.parent===n.store.rootNode?e.push(a):o in t?t[o].appendChild(a,!0):e.push(a),e}),[]);return s.forEach((e=>{e.sortOrderedChildren(!0,!0)})),s}};__publicField(RowCopyPaste,"$name","RowCopyPaste"),__publicField(RowCopyPaste,"type","rowCopyPaste"),__publicField(RowCopyPaste,"pluginConfig",{assign:["copyRows","pasteRows"],chain:["populateCellMenu"]}),__publicField(RowCopyPaste,"configurable",{nameField:"name",keyMap:{"Ctrl+C":{weight:10,handler:"copy"},"Ctrl+X":{weight:10,handler:"cut"},"Ctrl+V":{weight:10,handler:"paste"}},copyRecordText:"L{copyRecord}",cutRecordText:"L{cutRecord}",pasteRecordText:"L{pasteRecord}",rowSpecifierText:"L{row}",rowSpecifierTextPlural:"L{rows}",localizableProperties:["copyRecordText","cutRecordText","pasteRecordText","rowSpecifierText","rowSpecifierTextPlural"],rowOptionsOnCellContextMenu:!1}),RowCopyPaste.featureClass="b-row-copypaste",RowCopyPaste._$name="RowCopyPaste",GridFeatureManager.registerFeature(RowCopyPaste,!0,"Grid"),GridFeatureManager.registerFeature(RowCopyPaste,!1,"Gantt"),GridFeatureManager.registerFeature(RowCopyPaste,!1,"SchedulerPro"),GridFeatureManager.registerFeature(RowCopyPaste,!1,"ResourceHistogram");var storeRemoveActions={remove:1,filter:1,dataset:1,replace:1},RowExpander=class extends InstancePlugin{static get properties(){return{expanderBodyClass:"b-rowexpander-body",expandedRowClass:"b-rowexpander-row-expanded",recordStateMap:new Map,collapsingRecords:new Set}}static get pluginConfig(){return{chain:["afterColumnsChange","beforeRenderRow","processRowHeight","bindStore"],override:["onGridBodyFocusIn"]}}afterConstruct(){const e=this,{client:t}=e;e.renderer?(t.isGanttBase&&!1!==t.fixedRowHeight&&console.warn("When using RowExpander on a Gantt, the Gantt`s fixedRowHeight config must be set to false."),e.bindStore(t.store),e.triggerEvent&&t.ion({[e.triggerEvent]:"onTriggerEvent",thisObj:e}),e.addColumn()):console.warn("RowExpander requires implementing the renderer function.")}bindStore(e){const t=this;t.recordStateMap.clear(),t.collapsingRecords.clear(),t.detachListeners("clientStoreChange"),e.ion({name:"clientStoreChange",change:t.onStoreChange,thisObj:t})}doDisable(e){const{client:t}=this;e&&(this.recordStateMap.clear(),this.collapsingRecords.clear()),t.isConfiguring||t.rowManager.renderFromRow(),super.doDisable(e)}changeLoadingIndicatorText(e){return e?this.L(e):e}onGridBodyFocusIn(e){var t,r;(null==(r=null==(t=this.client.lastMousedownEvent)?void 0:t.target)?void 0:r.closest(".b-rowexpander-body"))||this.overridden.onGridBodyFocusIn(e)}get isAnimating(){return this.client.isAnimating}set isAnimating(e){const{client:t}=this,r=t.isAnimating;t.isAnimating=e,t.isAnimating!==r&&t.element.classList.toggle("b-rowexpander-animating")}afterColumnsChange(){this.addColumn()}changeColumn(e){return null==e?e:{type:"action",actions:[{cls:"gt-icon gt-icon-collapse-down",tooltip:({record:e})=>this.L(this.recordStateMap.has(e)?"L{RowExpander.collapse}":"L{RowExpander.expand}"),onClick:({record:e})=>this.toggleExpand(e)}],width:40,hideable:!1,align:"center",region:this.client.regions[0],...e,field:"expanderActionColumn"}}addColumn(){const e=this,{column:t}=e,{columns:r}=e.client;e._isAddingExpanderColumn||!t||e._expander&&r.includes(e._expander)||(e._isAddingExpanderColumn=!0,"last"===e.columnPosition?[e._expander]=r.add(t):[e._expander]=r.insert(0,t),e._isAddingExpanderColumn=!1)}onTriggerEvent({target:e}){this.disabled||(null==e?void 0:e.closest(".b-action-cell"))||!e.closest(".b-grid-cell")||this.toggleExpand(this.client.getRecordFromElement(e))}toggleExpand(e){e&&(this.recordStateMap.has(e)?this.collapse(e):this.expand(e))}onStoreChange({action:e,source:t,records:r}){const n=this,{recordStateMap:i,collapsingRecords:s}=n;if(!n.disabled)if("removeAll"===e)i.clear(),s.clear();else if(storeRemoveActions[e])for(const[e]of i)t.includes(e)||(i.delete(e),s.delete(e));else if(n.refreshOnRecordChange&&(null==r?void 0:r.length))if("update"===e){const e=i.get(r[0]);(null==e?void 0:e.isCreated)&&(e.isCreated=!1,n.client.rowManager.renderFromRecord(r[0]))}else if("updatemultiple"===e){let e,s;for(const n of r){const r=i.get(n);if(null==r?void 0:r.isCreated){r.isCreated=!1;const i=t.records.indexOf(n);(!s||e>i)&&(e=i,s=n)}}s&&n.client.rowManager.renderFromRecord(s)}}processRowHeight(e,t){var r;const n=this.recordStateMap.get(e);if(n){if(!n.isCreated&&n.isRenderingAsync)return this.loadingIndicatorHeight+t;if(!n.expanderBodyHeight)for(const e of this.client.regions){const t=n.expandElements[e].offsetHeight;t>n.expanderBodyHeight&&(n.expanderBodyHeight=t)}}return(null!=(r=null==n?void 0:n.expanderBodyHeight)?r:0)+t}beforeRenderRow({row:e,record:t}){const r=this,{regions:n}=r.client,{expandedRowClass:i}=r;e.cls.toggle("b-rowexpander-disabled",r.disabled),e.cls[i]?r.enableAnimations&&r.isAnimating&&r.collapsingRecords.has(t)?r.waitForTransition(e,(()=>{r.collapsingRecords.has(t)&&r.removeExpander(e)})):r.removeExpander(e):r.collapsingRecords.delete(t);const s=r.recordStateMap.get(t);if(!r.disabled&&s){s.isCreated||r.renderExpander(t,e,s),e.cls.add(i);for(const t of n){const n=e.getElement(t);s.isCreated?n.appendChild(s.expandElements[t]):r.renderLoadingIndicator(n,s),r.lockCellHeight(n,s.cellHeight,!1)}r._shouldScrollIntoView&&(r._shouldScrollIntoView=!1,DomHelper.isInView(s.expandElements[n[0]],!0)||r.client.rowManager.ion({once:!0,thisObj:r,renderDone:()=>r.scrollRowIntoView(e,t)}))}}scrollRowIntoView(e,t){this.isAnimating?this.waitForTransition(e,(()=>this.client.scrollRowIntoView(t))):this.client.scrollRowIntoView(t)}waitForTransition(e,t){EventHelper.onTransitionEnd({element:e.element,property:"height",handler:t,thisObj:this})}removeExpander(e){e.cls.remove(this.expandedRowClass);for(const t of this.client.regions){const r=e.getElement(t);r.classList.remove(this.expandedRowClass),DomHelper.removeEachSelector(r,"."+this.expanderBodyClass),this.lockCellHeight(r,null,!1)}}renderLoadingIndicator(e,t){DomHelper.createElement({parent:e,className:this.expanderBodyClass+" b-rowexpander-loading",style:{top:t.cellHeight,height:this.loadingIndicatorHeight},children:[{tag:"i",className:"gt-icon gt-icon-spinner"},this.loadingIndicatorText]})}renderExpander(e,t,r){var n;const i=this,s=null==(n=t.cells[0])?void 0:n.offsetHeight,a={},o=[],l=(e,t,r)=>{null!=e&&("string"==typeof e?t.innerHTML=e:(e=DomHelper.createElement(e),t.appendChild(e))),a[r]=t};if(!r.isRenderingAsync){Object.assign(r,{cellHeight:s,expandElements:a,expanderBodyHeight:0});for(const r of i.client.regions){const n=t.getElement(r);t.addCls(i.expandedRowClass);const a=DomHelper.createElement({parent:n,className:i.expanderBodyClass,style:{top:s+"px"}}),c=i.renderer({record:e,expanderElement:a,rowElement:n,region:r});Objects.isPromise(c)?o.push(c.then((e=>l(e,a,r)))):l(c,a,r)}o.length?(r.isRenderingAsync=!0,Promise.all(o).then((()=>{var t;r.isCreated=!0,null==(t=i.renderRowsWithAnimation)||t.call(i,e),r.isRenderingAsync=!1}))):r.isCreated=!0}}renderRowsWithAnimation(e){const t=this;if(t.enableAnimations){const r=t.client.rowManager.getRowById(e);r&&(t.isAnimating=!0,t.collapsingRecords.has(e)&&r.addCls("b-row-is-collapsing"),t.waitForTransition(r,(()=>{var e;t.isAnimating=!1,r.isDestroyed||null==(e=r.removeCls)||e.call(r,"b-row-is-collapsing")})))}t.client.rowManager.renderFromRecord(e)}lockCellHeight(e,t,r){for(let n=0;n<e.children.length;n++){const i=e.children[n];i.classList.contains(this.expanderBodyClass)||(i.style.height=r?"":t+"px")}}async expand(e){const t=this;t.disabled||!1!==await t.trigger("beforeExpand",{record:e})&&(t.recordStateMap.set(e,{isCreated:!1}),t.collapsingRecords.delete(e),t._shouldScrollIntoView=!0,t.renderRowsWithAnimation(e))}async collapse(e){const t=this;t.disabled||!1!==await t.trigger("beforeCollapse",{record:e})&&(t.recordStateMap.delete(e),t.collapsingRecords.add(e),t.renderRowsWithAnimation(e))}};__publicField(RowExpander,"$name","RowExpander"),__publicField(RowExpander,"configurable",{renderer:null,triggerEvent:null,column:{},columnPosition:"first",refreshOnRecordChange:!1,loadingIndicatorHeight:100,loadingIndicatorText:"L{loading}",enableAnimations:!0}),RowExpander._$name="RowExpander",GridFeatureManager.registerFeature(RowExpander);var RowReorder=class extends(Delayable_default(InstancePlugin)){construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){var e;null==(e=this.dragHelper)||e.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=DragHelper.new({name:"rowReorder",cloneTarget:!0,dragThreshold:10,proxyTopOffset:10,targetSelector:".b-grid-row",lockX:!0,dragWithin:t.bodyContainer,allowDropOutside:!0,scrollManager:t.scrollManager,outerElement:e.targetSubGridElement,touchStartDelay:e.touchStartDelay,isElementDraggable:e.isElementDraggable.bind(e),monitoringConfig:{scrollables:[{element:t.scrollable.element,direction:"vertical"}]},setXY(e,t,r){const{context:n}=this;if(!n.started){const e=Rectangle.from(n.element,this.dragWithin),t=n.startPageY-globalThis.pageYOffset-n.element.getBoundingClientRect().top;r=e.top+t+this.proxyTopOffset}DomHelper.setTranslateXY(e,t,r)},ignoreSamePositionDrop:!1,createProxy(e){const r=e.cloneNode(!0),n=document.createElement("div");if(n.classList.add("b-row-reorder-proxy"),r.removeAttribute("id"),r.style.transform="",n.appendChild(r),t.selectedRecords.length>1){const e=r.cloneNode(!0);e.classList.add("b-row-dragging-multiple"),n.appendChild(e)}return DomHelper.removeClsGlobally(n,"b-selected","b-hover","b-focused"),n},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onReset",prio:1e4,thisObj:e}},e.dragHelperConfig),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),t.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","abort"],"gridRow"),e.dropIndicator=DomHelper.createElement({className:"b-row-drop-indicator"}),e.dropOverTargetCls=["b-row-reordering-target","b-hover"]}get targetSubGridElement(){const e=this.grid.regions[0];return this.grid.subGrids[e].element}isElementDraggable(e,t){if(!e.closest(".b-grid-cell .b-widget")){if(!this.gripOnly)return!0;{const r=e.closest(".b-grid-cell:first-child");if(r){const e=getComputedStyle(r,":before"),n=this.grid.rtl?r.getBoundingClientRect().width-t.borderOffsetX:t.borderOffsetX,i=DomHelper.roundPx(n)<=DomHelper.roundPx(parseFloat(e.width));return i&&(this.client.preventDragSelect=!0),i}}}}onBeforeDragStart({event:e,source:t,context:r}){globalThis.isRowSorting=!0;const n=this,{grid:i}=n,s=n.targetSubGridElement;if(n.disabled||i.readOnly||i.isTreeGrouped||!s.contains(r.element))return!1;const a=r.startRecord=i.getRecordFromElement(r.element);if(a.readOnly||a.isSpecialRow)return!1;r.originalRowTop=i.rowManager.getRowFor(a).top,i.selectionMode.checkboxOnly||("touch"===t.startEvent.pointerType?i.isSelected(a)||i.selectRow({record:a,addToSelection:!1}):i.isSelected(a)||e.shiftKey||e.ctrlKey||i.selectRow({record:a}));const o=i.selectedRecords.filter((e=>!e.readOnly));return r.records=[a],o.includes(a)&&(r.records.push(...o.filter((e=>e!==a))),r.records.sort(((e,t)=>i.store.indexOf(e)-i.store.indexOf(t)))),!0}onDragStart({context:e}){var t,r;const n=this,{grid:i}=n,{cellEdit:s,cellMenu:a,headerMenu:o}=i.features;s&&(n.cellEditDisabledState=s.disabled,s.disabled=!0),null==(t=null==a?void 0:a.hideContextMenu)||t.call(a,!1),null==(r=null==o?void 0:o.hideContextMenu)||r.call(o,!1),i.element.classList.add("b-row-reordering");const l=e.element.querySelector(".b-focused");null==l||l.classList.remove("b-focused"),e.element.firstElementChild.classList.remove("b-selected","b-hover"),i.bodyContainer.appendChild(n.dropIndicator)}onDrag({context:e,event:t}){var r;const n=this,{grid:i}=n,{store:s,rowManager:a}=i,{clientY:o}=t;let l,c,d,u,h,g=!0,p=a.getRowAt(o);if(p){const e=p.top+i.scrollable.element.getBoundingClientRect().top-i.scrollable.y,r=p.height/4,a=e+r,h=e+p.height/2,g=e+3*r;c=p.dataIndex,l=s.getAt(c),s.tree?u=(l.isParent||n.dropOnLeaf)&&o>a&&o<g:s.isGrouped&&(u=l.isGroupHeader&&l.meta.collapsed),d=!u&&t.clientY>=h}else t.pageY<i._bodyRectangle.y?(c=0,l=s.first,d=!1):(c=s.count-1,l=s.last,d=!0),p=i.rowManager.getRow(c);l!==n.overRecord||n.after!==d||n.over!==u?(n.overRecord!==l&&(null==(r=a.getRowById(n.overRecord))||r.removeCls(n.dropOverTargetCls)),n.overRecord=l,n.after=d,n.over=u,(l===e.startRecord||!d&&!u&&0===c&&s.isGrouped||d&&l.isGroupHeader&&l.meta.collapsed&&s.indexOf(l)===s.count-1)&&(g=!1),s.tree?(h=d?l.nextSibling:l,e.records.some((e=>e.contains(l)))&&(g=!1),e.parent=g&&u?l:l.parent,n.clearTimeout(n.hoverTimer),l&&l.isParent&&!l.isExpanded(s)&&(n.hoverTimer=n.setTimeout((()=>i.expand(l)),n.hoverExpandTimeout))):h=d?s.getAt(c+1):l,p.toggleCls(n.dropOverTargetCls,g&&u),!u&&c===s.indexOf(e.startRecord)+(d?-1:1)&&e.parent&&e.startRecord.parent===e.parent&&(g=!1),p&&DomHelper.setTranslateY(n.dropIndicator,Math.max(p.top+(d?p.element.getBoundingClientRect().height:0),1)),n.dropIndicator.style.visibility=u?"hidden":"visible",n.dropIndicator.classList.toggle("b-drag-invalid",!g),e.insertBefore=h,e.valid=n.reorderValid=g):e.valid=n.reorderValid}async onDrop(e){const t=this,{client:r}=t,{context:n}=e;if(n.valid=n.valid&&t.reorderValid,n.valid){n.async=!0,r.store.tree&&(n.oldPositionContext=n.records.map((e=>{var t;return{record:e,parentId:null==(t=e.parent)?void 0:t.id,parentIndex:e.parentIndex}})));let i=await t.trigger("gridRowBeforeDropFinalize",e);!1===i&&(n.valid=!1),i=await r.trigger("gridRowBeforeDropFinalize",e),!1===i&&(n.valid=!1),await t.dragHelper.animateProxyTo(t.dropIndicator,{align:"l0-l0"}),await t.finalizeReorder(n)}t.clearTimeout(t.hoverTimer),t.overRecord=t.after=t.over=null,t.trigger("gridRowDrop",e),r.trigger("gridRowDrop",e)}async finalizeReorder(e){var t,r;const n=this,{grid:i}=n,{store:s,focusedCell:a}=i;let{records:o}=e;if(e.valid=e.valid&&!o.some((e=>!s.includes(e))),e.valid){let l;s.tree?(o=o.filter((e=>!e.parent||e.bubbleWhile((e=>!o.includes(e)),!0))),l=await e.parent.tryInsertChild(o,n.over?null==(t=e.parent.children)?void 0:t[0]:e.insertBefore),i.rowManager.forEach((e=>e.removeCls(n.dropOverTargetCls))),!e.parent.isExpanded()&&(null==(r=e.parent.children)?void 0:r.length)&&i.expand(e.parent),e.valid=!1!==l):s.isGrouped&&n.over?s.move(o,s.getAt(s.indexOf(e.insertBefore)+1)):s.move(o,e.insertBefore),(null==a?void 0:a._rowIndex)>=0&&(i._focusedCell=null,i.focusCell({grid:i,record:a.record,columnId:a.columnId})),s.clearSorters()}e.finalize(e.valid),i.element.classList.remove("b-row-reordering")}onReset(){globalThis.isRowSorting=!1;const e=this,{grid:t}=e,r=t.features.cellEdit;t.element.classList.remove("b-row-reordering"),r&&(r.disabled=e.cellEditDisabledState),e.dropIndicator.remove(),DomHelper.removeClsGlobally(t.element,...e.dropOverTargetCls)}onPaint({firstPaint:e}){e&&this.init()}updateShowGrip(e){this.grid.element.classList.toggle("b-row-reorder-with-grip",e)}};__publicField(RowReorder,"$name","RowReorder"),__publicField(RowReorder,"configurable",{showGrip:null,gripOnly:null,hoverExpandTimeout:1e3,touchStartDelay:300,dropOnLeaf:!1,dragHelperConfig:null}),__publicField(RowReorder,"pluginConfig",{after:["onPaint"]}),RowReorder.featureClass="",RowReorder._$name="RowReorder",GridFeatureManager.registerFeature(RowReorder,!1),GridFeatureManager.registerFeature(RowReorder,!0,"Gantt");var Search=class extends(Delayable_default(InstancePlugin)){static get $name(){return"Search"}static get configurable(){return{limit:1e3,showHitIndex:!0,keyMap:{F3:"gotoNextHit","Ctrl+g":"gotoNextHit","Shift+F3":"gotoPrevHit","Ctrl+Shift+g":"gotoPrevHit"}}}static get properties(){return{hitCls:"b-search-hit",hitCellCls:"b-search-hit-cell",hitCellBadgeCls:"b-search-hit-cell-badge",hitTextCls:"b-search-hit-text"}}construct(e,t){super.construct(e,t),Object.assign(this,{grid:e,text:"",hitEls:[],treeWalker:e.setupTreeWalker(e.element,DomHelper.NodeFilter.SHOW_TEXT,(()=>DomHelper.NodeFilter.FILTER_ACCEPT))}),e.ion({expandNode:"onTreeNodeExpand",thisObj:this})}isActionAvailable(){return Boolean(this.text)}onTreeNodeExpand(){this.text&&this.requestAnimationFrame(this.search,[this.text,!1,!0])}doDestroy(){this.clear(!0),super.doDestroy()}doDisable(e){e&&this.clear(),super.doDisable(e)}get store(){return this.grid.store}static get pluginConfig(){return{chain:["populateCellMenu"]}}async search(e,t=!0,r=!1,n){const i=this;if(!e)return i.clear();if(!r&&e===i.text||i.disabled)return;const{grid:s,store:a}=i,o=s.columns.visibleColumns.filter((e=>!1!==e.searchable)),l=[];n=n||o.map((e=>{var t;return l.push(null==(t=e.formatValue)?void 0:t.bind(e)),e.field}));const c=a.search(e,n,l);a.isTree&&c.length&&await s.expandTo(c.map((e=>e.id)));for(const e of o)if(e.mergeCells&&e.isSorted){let t=null,r=null;for(const n of c)if(n.field===e.field){const e=n.data[n.field];e===t&&(n.belongsTo=r),t=e,r=n.field+"-"+n.id}}let d=1;if(Object.assign(i,{foundMap:{},prevFound:i.found,found:c,text:e,findRe:new RegExp("(s+)?("+StringHelper.escapeRegExp(String(e))+")(s+)?","ig")}),i.clearHits(),c){for(const e of c)if(i.foundMap[e.field+"-"+e.id]=e.belongsTo?i.foundMap[e.belongsTo]:d++,d>i.limit)break;return i.listenersInitialized||(s.rowManager.ion({name:"renderCell",renderCell:"renderCell",thisObj:i}),a.ion({name:"storeRefresh",["refresh"+s.asyncEventSuffix]:"onStoreRefresh",thisObj:i}),i.listenersInitialized=!0),s.refreshRows(),s.trigger("search",{grid:s,find:e,found:c}),t&&!i.isHitFocused&&i.gotoNextHit(!0),c}}clearHits(){for(const e of DomHelper.children(this.grid.element,"."+this.hitCls)){e.classList.remove(this.hitCls,this.hitCellCls);const t=DomDataStore.get(e).row;t&&(t.forceInnerHTML=!0,t.renderCell(e),t.forceInnerHTML=!1)}}clear(e=!1){const t=this,{grid:r}=t;t.foundMap&&delete t.foundMap,t.text=null,t.clearHits(),t.listenersInitialized&&(this.detachListeners("renderCell"),this.detachListeners("storeRefresh"),t.listenersInitialized=!1),e||r.trigger("clearSearch",{grid:r})}get foundCount(){var e,t;return null!=(t=null==(e=this.found)?void 0:e.length)?t:0}get isHitFocused(){var e;const t=this,{grid:r}=t,{focusedCell:n}=r;if(null==(e=null==n?void 0:n.cell)?void 0:e.contains(DomHelper.getActiveElement(r.element))){const{rowIndex:e,column:r}=n;return-1!==e&&t.found.some((t=>t.index===e&&r&&t.field===r.field))}}gotoNextHit(e=!1){var t;const r=this;if(!(null==(t=r.found)?void 0:t.length))return;const{grid:n,store:i}=r,s=n.focusedCell||n.lastFocusedCell,a=s&&!0!==e?i.indexOf(s.record,void 0,!0):-1,o=r.found.findIndex((e=>e.index>a));-1!==o&&r.gotoHit(o)}gotoPrevHit(){var e;const t=this,{store:r}=t;if(!(null==(e=t.found)?void 0:e.length))return;const{grid:n,found:i}=t,s=n.focusedCell||n.lastFocusedCell,a=s?r.indexOf(s.record,void 0,!0):0;for(let e=i.length-1;e--;e>=0){if(i[e].index<a){t.gotoHit(e);break}}}gotoHit(e){const{grid:t}=this,r=this.found[e];return r&&t.focusCell({field:r.field,id:r.id}),Boolean(r)}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:r,value:n}){var i,s;const a=this,{treeWalker:o,findRe:l,hitTextCls:c,showHitIndex:d}=a,u=null==(i=a.foundMap)?void 0:i[t.field+"-"+r.id];if(u){e.classList.add(a.hitCls),d&&(null==(s=e.querySelector("."+a.hitCellBadgeCls))||s.remove());const t=DomHelper.down(e,".b-grid-cell-value,.b-tree-cell-value")||e;if(String(n).toLowerCase()===String(a.text).toLowerCase())t.innerHTML='<span class="'+a.hitTextCls+'">'+t.innerHTML+"</span>"+(d?'<div class="'+a.hitCellBadgeCls+'">'+u+"</div>":"");else{o.currentNode=t;for(let e=o.nextNode();e&&t.contains(e);){const t=e,r=e.nodeValue,n=["<span>"];e=o.nextNode();let i=l.lastIndex;for(let e=l.exec(r);e;e=l.exec(r)){const t=r.substring(i,e.index),s=e[1]?" ":"",a=e[2],o=e[3]?" ":"";n.push(""+StringHelper.encodeHtml(t)+s+'<span class="'+c+'">'+a+"</span>"+o),i=l.lastIndex}n.push(StringHelper.encodeHtml(r.substring(i)),"<span>"),t.parentNode.insertBefore(DomHelper.createElementFromTemplate(n.join(""),{fragment:!0}),t),t.remove()}d&&DomHelper.createElement({parent:e,className:a.hitCellBadgeCls,text:u})}a.hitEls.push(e)}}populateCellMenu({column:e,record:t,items:r,cellElement:n}){const i=this;e.searchable&&(r.search={text:"L{searchForValue}",localeClass:i,icon:"b-fw-icon gt-icon-search",cls:"b-separator",weight:200,disabled:i.disabled,onItem:()=>{let e=globalThis.getSelection().toString();e||(e=n.innerText),i.search(e)}})}onStoreRefresh(){this.search(this.text,!1,!0)}};Search.featureClass="b-search",Search._$name="Search",GridFeatureManager.registerFeature(Search);var Sort=class extends InstancePlugin{static get $name(){return"Sort"}static get configurable(){return{multiSort:!0,prioritizeColumns:!1}}static get properties(){return{ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){t=this.processConfig(t),this.grid=e,this.bindStore(this.store),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeSort:"onStoreBeforeSort",sort:"syncHeaderSortState",thisObj:this})}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}get store(){return this.grid[this.grid.sortFeatureStore]}static get pluginConfig(){return{chain:["onElementClick","populateHeaderMenu","getColumnDragToolbarItems","renderHeader","onPaint","bindStore"]}}syncHeaderSortState(){var e;const t=this,{grid:r}=t;if(!r.hideHeaders&&r.isPainted){const n=t.store.sorters,i=n.length,s=new DomClassList;let a;for(const o of r.columns.visibleColumns){if(!o.sortable)continue;const r=o.element,l=null==(e=o.textWrapper)?void 0:e.dataset;let c="none";(null==l?void 0:l.sortIndex)&&delete l.sortIndex,s.value=r.classList,!1!==o.sortable?(s.add(t.sortableCls),a=n.find((e=>e.field===o.field||e.sortFn&&e.sortFn===o.sortable.sortFn)),a?(i>1&&l&&(l.sortIndex=n.indexOf(a)+1),s.add(t.sortedCls),a.ascending?(s.add(t.sortedAscCls),s.remove(t.sortedDescCls),c="ascending"):(s.add(t.sortedDescCls),s.remove(t.sortedAscCls),c="descending")):(s.remove(t.sortedCls),s["b-group"]||(s.remove(t.sortedAscCls),s.remove(t.sortedDescCls)))):s.remove(t.sortableCls),DomHelper.syncClassList(r,s),DomHelper.setAttributes(r,{"aria-sort":c})}}}populateHeaderMenu({column:e,items:t}){const r=this,{store:n}=r,i={...e.sortable,field:e.field,columnOwned:!0};if(!1!==e.sortable&&(t.sortAsc={text:"L{sortAscending}",localeClass:r,icon:"b-fw-icon gt-icon-sort-asc",cls:"b-separator",weight:300,disabled:r.disabled,onItem:()=>n.sort(i,!0)},t.sortDesc={text:"L{sortDescending}",localeClass:r,icon:"b-fw-icon gt-icon-sort-desc",weight:310,disabled:r.disabled,onItem:()=>n.sort(i,!1)},r.multiSort&&r.grid.columns.records.some((e=>e.sortable)))){n.sorters.find((t=>t.field===e.field||e.sortable.sortFn&&e.sortable.sortFn===t.sortFn))}}getColumnDragToolbarItems(e,t){const r=this,{store:n,disabled:i}=r;if(!1!==e.sortable){const s=n.sorters.find((t=>t.field===e.field));t.push({text:"L{sortAscendingShort}",group:"L{sort}",localeClass:r,icon:"gt-icon gt-icon-sort-asc",ref:"sortAsc",cls:"b-separator",weight:105,disabled:i,onDrop:({column:e})=>n.sort(e.field,!0)},{text:"L{sortDescendingShort}",group:"L{sort}",localeClass:r,icon:"gt-icon gt-icon-sort-desc",ref:"sortDesc",weight:105,disabled:i,onDrop:({column:e})=>n.sort(e.field,!1)},{text:"L{addSortAscendingShort}",group:"L{multiSort}",localeClass:r,icon:"gt-icon gt-icon-sort-asc",ref:"multisortAddAsc",disabled:i||s&&s.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!0)},{text:"L{addSortDescendingShort}",group:"L{multiSort}",localeClass:r,icon:"gt-icon gt-icon-sort-desc",ref:"multisortAddDesc",disabled:i||s&&!s.ascending,weight:105,onDrop:({column:e})=>n.addSorter(e.field,!1)},{text:"L{removeSorterShort}",group:"L{multiSort}",localeClass:r,icon:"gt-icon gt-icon-remove",ref:"multisortRemove",weight:105,disabled:i||!s,onDrop:({column:e})=>n.removeSorter(e.field)})}return t}onStoreBeforeSort({sorters:e}){var t;const{columns:r}=this.client;for(let n=0;n<e.length;n++){const i=e[n],s=(i.columnOwned||this.prioritizeColumns)&&r.get(i.field);(null==(t=null==s?void 0:s.sortable)?void 0:t.sortFn)&&(e[n]={...i,...s.sortable,columnOwned:!0})}}onElementClick(e){const t=this,{store:r}=t,{target:n}=e,i=n.closest(".b-grid-header.b-sortable"),s=null==i?void 0:i.dataset.column;if(!(t.ignoreRe.test(n.className)||t.disabled||e.handled)&&i&&s){const n=t.grid.columns.getById(i.dataset.columnId);if(r.isGrouped&&r.groupers.find((e=>e.field===s))&&!e.shiftKey)return;if(n.sortable&&!e.shiftKey)if(e.ctrlKey&&e.altKey)r.removeSorter(n.field);else{const t={columnOwned:!0,field:n.field};"object"==typeof n.sortable&&ObjectHelper.assign(t,n.sortable),r.sort(t,null,e.ctrlKey)}}}renderHeader(){this.syncHeaderSortState()}onPaint(){this.syncHeaderSortState()}};Sort.featureClass="b-sort",Sort._$name="Sort",GridFeatureManager.registerFeature(Sort,!0);var StickyCells=class extends InstancePlugin{static get $name(){return"StickyCells"}static get defaultConfig(){return{contentSelector:null,currentTopRowCls:"b-sticky-cells-current-top-row"}}static get pluginConfig(){return{before:["renderRows"]}}construct(e,t){super.construct(e,t),e.ion({scroll:"onGridScroll",thisObj:this}),Object.assign(this,DomHelper.createElement({reference:"element",parent:e.element,className:"b-grid-sticky-row",children:[{reference:"contentElement",className:"b-grid-cell"}]})),this.removeClasses={"b-focused":!1,"b-hover":!1,"b-selected":!1,[this.currentTopRowCls]:!1}}renderRows(){this.element.classList.add("b-hide-visibility")}onGridScroll(){const e=this,{client:t,element:r,contentElement:n}=e,i=Rectangle.client(t.bodyContainer).roundPx(),s=t.rowManager.getRowAt(i.y),a=s!==e.currentTopRow;if(s){a&&(e.currentTopRow&&(e.currentTopRow.removeCls(e.currentTopRowCls),e.currentTopRow.removeCls("b-not-enough-height")),e.currentTopRow=s,s.addCls(e.currentTopRowCls),n.innerHTML="",n.appendChild(e.updateStickyContent()));const t=e.currentTopRow.bottom-e.client.scrollable.y<=e.stickyContentHeight;e.element.classList[t?"add":"remove"]("b-hide-visibility"),e.currentTopRow[t?"addCls":"removeCls"]("b-not-enough-height"),i.y+=e.stickyContentTop,DomHelper.alignTo(r,e.stickyEls[0],{align:"t0-t0",constrainTo:i},!0)}e.lastProcessedTopRow=s}updateStickyContent(){const e=this,{currentTopRow:t,removeClasses:r}=e,n={"b-grid-sticky-row":1},i={},s=e.stickyContent||(e.stickyContent=document.createDocumentFragment()),a=e.stickyEls||(e.stickyEls=[]);for(a.forEach((e=>{e.classList.remove("b-sticky-content-el")})),a.length=0,t.eachElement((t=>{a.push(...t.querySelectorAll(e.contentSelector))}));s.firstChild;)s.remove(s.firstChild);return e.stickyContentHeight=0,e.stickyContentTop=0,a.map((t=>{t.closest(".b-grid-cell").classList.forEach((e=>i[e]=1)),t.closest(".b-grid-row").classList.forEach((e=>n[e]=1)),Object.assign(i,r),Object.assign(n,r);const a=t.offsetTop;e.stickyContentTop=Math.max(e.stickyContentTop,a),t.style.alignSelf="flex-end",e.stickyContentHeight=Math.max(e.stickyContentHeight,e.currentTopRow.height-t.offsetTop+a),t.style.alignSelf="";const o=t.cloneNode(!0);return t.classList.add("b-sticky-content-el"),s.appendChild(o),o})),i["b-focused"]=!1,DomHelper.syncClassList(e.contentElement,i),DomHelper.syncClassList(e.element,n),s}};StickyCells._$name="StickyCells",GridFeatureManager.registerFeature(StickyCells,!1);var Stripe=class extends InstancePlugin{static get $name(){return"Stripe"}construct(e,t){super.construct(e,t),e.ion({renderrow:"onRenderRow",thisObj:this})}doDisable(e){this.isConfiguring||this.client.refreshRows(),super.doDisable(e)}onRenderRow({row:e}){const{disabled:t}=this,r=e.dataIndex%2==0;e.assignCls({"b-even":!t&&r,"b-odd":!t&&!r})}};Stripe._$name="Stripe",GridFeatureManager.registerFeature(Stripe);var Summary=class extends(SummaryFormatter_default(InstancePlugin)){static get configurable(){return{selectedOnly:null,hideFooters:!1}}static get pluginConfig(){return{chain:["renderRows","bindStore"]}}static get $name(){return"Summary"}construct(e,t){this.grid=e,super.construct(e,t),this.bindStore(e.store),e.hideFooters=this.hideFooters}bindStore(e){this.detachListeners("store"),e.ion({name:"store",change:"onStoreChange",thisObj:this})}get store(){return this.grid.store}doDestroy(){super.doDestroy()}doDisable(e){super.doDisable(e);const{client:t}=this;e?t.element.classList.add("b-summary-disabled"):(this.updateSummaries(),t.element.classList.remove("b-summary-disabled"),t.eachSubGrid((e=>e.scrollable.syncPartners())))}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,{grid:t,store:r}=e,n=DomHelper.children(t.element,".b-grid-footer"),i=e.selectedOnly&&t.selectedRecords.length>0,s=(r.isFiltered?r.storage.values:r.allRecords).filter((e=>!e.isSpecialRow&&(!i||t.isSelected(e))));t.columns.forEach((e=>{var t;null==(t=e.summaries)||t.forEach((e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),["number","string","date"].includes(typeof e.initialSeed)?e.seed=e.initialSeed:e.seed=Object.assign({},e.initialSeed))}))})),n.forEach((r=>{if(!r.dataset.column)return;const n=t.columns.get(r.dataset.column),i=e.generateHtml(n,s,"b-grid-footer-summary");(n.summaries?n.summaries.length:!!n.sum)&&(r.children.length?DomHelper.sync(i,r.firstElementChild):r.innerHTML=i)}))}onStoreChange({action:e,changes:t}){let r=!0;this.disabled||("update"===e&&(r=Object.keys(t).some((e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))}))),r&&this.updateSummaries())}updateSelectedOnly(e){const t=this;t.detachListeners("selectionChange"),e&&t.grid.ion({name:"selectionChange",selectionChange:t.refresh,thisObj:t}),t.refresh()}refresh(){this.updateSummaries()}};Summary.featureClass="b-summary",Summary._$name="Summary",GridFeatureManager.registerFeature(Summary);var immediatePromise5=Promise.resolve(),Tree=class extends(InstancePlugin.mixin(Delayable_default)){static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],chain:["onElementPointerUp","onElementClick","bindStore"]}}construct(e,t){super.construct(e,t),this.treeColumn||console.info('要使用树功能，应使用"type:"tree配置一列'),e.store&&this.bindStore(e.store)}doDisable(e){if(e)throw new Error("Tree feature cannot be disabled")}get store(){return this.client.store}get treeColumn(){const e=this,{columns:t}=e.client;return e._treeColumn&&t.includes(e._treeColumn)||(e._treeColumn=t.find((e=>e.isTreeColumn))),e._treeColumn}bindStore(e){this.detachListeners("store"),e.ion({name:"store",beforeLoadChildren:"onBeforeLoadChildren",loadChildren:"onLoadChildren",loadChildrenException:"onLoadChildrenException",beforeToggleNode:"onBeforeToggleNode",thisObj:this})}async toggleCollapse(e,t){if(null==e)throw new Error("树展开和收缩，必须选择一条记录");globalThis.isExpandOrCollapse=!0;const r=this,{store:n,client:i}=r,{rowManager:s}=i,a=n.getById(e),o=a.instanceMeta(n);if(await n.toggleCollapse(a,t)){const e=s.getRowFor(a);if(e&&a.ancestorsExpanded()){const t=r.treeColumn&&!r.treeColumn.subGrid.collapsed&&e.getCell(r.treeColumn.id);t&&e.renderCell(t)}r.isTogglingNode||(i.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame((()=>{i.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1}))),i.trigger(o.collapsed?"collapseNode":"expandNode",{record:a}),i.trigger("toggleNode",{record:a,collapse:o.collapsed})}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}onBeforeToggleNode({record:e,collapse:t}){this.client.trigger("beforeToggleNode",{record:e,collapse:t})}onBeforeLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.client.rowManager.getRowFor(r);null==n||n.addCls("b-loading-children")}onLoadChildren({source:e,params:t}){const r=e.getById(t[e.modelClass.idField]),n=this.client.rowManager.getRowFor(r);null==n||n.removeCls("b-loading-children")}onLoadChildrenException({record:e}){const t=this.client.rowManager.getRowFor(e);null==t||t.removeCls("b-loading-children")}async expandOrCollapseAll(e=!0,t=this.store.rootNode){const{client:r,store:n}=this,i=[],s=[];return r.trigger("beforeToggleAllNodes",{collapse:e}),n.suspendEvents(),n.traverse((t=>{const r=t.instanceMeta(n);t.isLeaf||(e&&!r.collapsed?(this.toggleCollapse(t,!0),s.push(...t.children)):!e&&r.collapsed&&(Array.isArray(t.children)&&s.push(...t.children),i.push(this.toggleCollapse(t,!1))))}),t,t===n.rootNode),n.resumeEvents(),(e?immediatePromise5:Promise.all(i)).then((()=>{r.refreshRows(e),s.length&&(e?n.trigger("remove",{records:s,isCollapse:!0,isCollapseAll:!0}):n.trigger("add",{records:s,isExpand:!0,isExpandAll:!0})),r.trigger("toggleAllNodes",{collapse:e})}))}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e,t=!0){var r,n,i,s;const a=this,{store:o,client:l}=a;if(Array.isArray(e)){if(e.length>0){l.suspendRefresh();for(let t=e.length-1;t>=0;t--){const i=o.getById(e[t]);0===t&&(null==(r=l.resumeRefresh)||r.call(l),l.rowManager.refresh()),await(null==(n=a.expandTo)?void 0:n.call(a,i,0===t))}}return}const c=o.getById(e);if(!1!==c.instanceMeta(a.store).hiddenByCollapse){if(!c.ancestorsExpanded()){const e=[];for(let t=c.parent;t&&!t.isRoot;t=t.parent)t.isExpanded(o)||e.unshift(t);l.suspendRefresh();for(const t of e)a.isDestroyed||await a.toggleCollapse(t,!1);null==(i=l.resumeRefresh)||i.call(l),null==(s=l.refreshRows)||s.call(l)}!a.isDestroyed&&t&&await l.scrollRowIntoView(c)}}onElementPointerUp(e){const t=this,r=e.target,n=t.client.getCellDataFromEvent(e);(r.closest(".b-tree-expander")||t.expandOnCellClick&&(null==n?void 0:n.record.isParent))&&t.toggleCollapse(n.record)}onElementClick(e){e.target.closest(".b-tree-expander")&&e.preventDefault()}toggleCollapseByKey(){const{focusedCell:e}=this.client;return(null==e?void 0:e.rowIndex)>-1&&!e.isActionable&&(this.toggleCollapse(e.id),!0)}expandIfSingleColumn(){return 1===this.client.columns.count&&this.expandByKey()}expandByKey(){const e=this,{client:t}=e,{focusedCell:r}=t,n=null==r?void 0:r.record;return!!((null==r?void 0:r.column.tree)&&n.isParent&&n.instanceMeta(t.store).collapsed)&&(e.expand(n),!0)}collapseIfSingleColumn(){return 1===this.client.columns.count&&this.collapseByKey()}collapseByKey(){const e=this,{client:t}=e,{focusedCell:r}=t,n=null==r?void 0:r.record;if(null==r?void 0:r.column.tree){if(n.isParent&&!n.instanceMeta(t.store).collapsed)return e.collapse(n),!0;if(n.parent&&!n.parent.isRoot)return t.deselectAll(),t.focusCell({record:n.parent,column:r.column}),!0}return!1}};__publicField(Tree,"$name","Tree"),__publicField(Tree,"configurable",{expandOnCellClick:!1,keyMap:{" ":"toggleCollapseByKey",ArrowRight:"expandIfSingleColumn","Shift+ArrowRight":"expandByKey",ArrowLeft:"collapseIfSingleColumn","Shift+ArrowLeft":"collapseByKey"}}),Tree.featureClass="b-tree",Tree._$name="Tree",GridFeatureManager.registerFeature(Tree,!1,"Grid"),GridFeatureManager.registerFeature(Tree,!0,"TreeGrid");var TreeGroup=class extends InstancePlugin{construct(e,t){if(super.construct(e,t),!e.hasFeature("tree"))throw new Error("The TreeGroup feature requires the Tree feature to be enabled")}processParentData(e){this.parentCls&&(e.cls=this.parentCls)}processTransformedData(e){}async waitForReadiness(){if(this.originalStore.isLoading&&(await this.originalStore.await("load",!1),this.isDestroyed))return;const{crudManager:e}=this.client;if(e){if((e.isLoadingOrSyncing||e._autoLoadPromise)&&(await e.await("requestDone"),this.isDestroyed))return;await this.client.project.commitAsync()}}async applyLevels(e){var t;const r=this,{client:n}=r,i=n.columns.find((e=>e instanceof TreeColumn));let{store:s}=n,a=null;if(r._levels=e,r.isApplying++,n.suspendRefresh(),e&&!r.originalStore&&(r.originalStore=s,s=new s.constructor({tree:!0,modelClass:s.modelClass,load:null==(t=s.load)?void 0:t.bind(s),commit:s.commit.bind(s)}),n.store=s,r.originalStore.ion({name:"originalStore",refresh:r.onOriginalStoreRefresh,add:r.onOriginalStoreChanged,remove:r.onOriginalStoreChanged,removeAll:r.onOriginalStoreChanged,thisObj:r})),await r.waitForReadiness(),!r.isDestroyed)return e?(s.data=r.originalStore.allRecords.flatMap((e=>e.isLeaf?[e.link()]:[])),a=s.treeify(e,(e=>{ObjectHelper.setPath(e,s.modelClass.getFieldDataSource(i.field),e.key),r.processParentData(e)})),r.processTransformedData(a),s.data=a.children):(n.store=r.originalStore,r.detachListeners("originalStore"),r.originalStore=null),r.isApplying--,n.resumeRefresh(),n.rowManager.reinitialize(),a}onOriginalStoreChanged(){this.applyLevels(this._levels)}onOriginalStoreRefresh({action:e}){"dataset"===e&&this.applyLevels(this.levels)}updateLevels(e){!e&&this.isConfiguring||this.applyLevels(e)}async group(e){ObjectHelper.assertArray(e,"group()"),await this.applyLevels(e)}async clearGroups(){this.isGrouped&&await this.applyLevels(null)}get isGrouped(){return Boolean(this._levels)}};__publicField(TreeGroup,"$name","TreeGroup"),__publicField(TreeGroup,"configurable",{levels:null,parentCls:"b-generated-parent"}),__publicField(TreeGroup,"pluginConfig",{assign:["group","clearGroups"]}),__publicField(TreeGroup,"properties",{isApplying:0,originalStore:null}),TreeGroup._$name="TreeGroup",GridFeatureManager.registerFeature(TreeGroup);var RowsRange={all:"all",visible:"visible"},PaperFormat={A6:{width:4.11,height:5.81},A5:{width:5.81,height:8.25},A4:{width:8.25,height:11.69},A3:{width:11.69,height:16.49},Legal:{width:8.5,height:14},Letter:{width:8.5,height:11}},Orientation={portrait:"portrait",landscape:"landscape"},FileFormat={pdf:"pdf",png:"png"},FileMIMEType={pdf:"application/pdf",png:"image/png"},ExportRowsCombo=class extends Combo{static get $name(){return"ExportRowsCombo"}static get type(){return"exportrowscombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:RowsRange.all,text:this.L("L{all}")},{id:RowsRange.visible,text:this.L("L{visible}")}]}};ExportRowsCombo.initClass(),ExportRowsCombo._$name="ExportRowsCombo";var ExportOrientationCombo=class extends Combo{static get $name(){return"ExportOrientationCombo"}static get type(){return"exportorientationcombo"}static get defaultConfig(){return{editable:!1}}buildItems(){return[{id:Orientation.portrait,text:this.L("L{portrait}")},{id:Orientation.landscape,text:this.L("L{landscape}")}]}};function buildComboItems(e,t=(e=>e)){return Object.keys(e).map((e=>({id:e,text:t(e)})))}ExportOrientationCombo.initClass(),ExportOrientationCombo._$name="ExportOrientationCombo";var ExportDialog=class extends Popup{static get $name(){return"ExportDialog"}static get type(){return"exportdialog"}static get configurable(){return{autoShow:!1,autoClose:!1,closable:!0,centered:!0,client:null,autoSelectVisibleColumns:!0,hidePNGMultipageOption:!0,title:"L{exportSettings}",maxHeight:"80%",scrollable:{overflowY:!0},defaults:{localeClass:this},items:{columnsField:{type:"combo",label:"L{ExportDialog.columns}",store:{},valueField:"id",displayField:"text",multiSelect:!0,weight:100,maxHeight:100},rowsRangeField:{type:"exportrowscombo",label:"L{ExportDialog.rows}",value:"all",weight:200},exporterTypeField:{type:"combo",label:"L{ExportDialog.exporterType}",editable:!1,value:"singlepage",displayField:"text",buildItems(){const e=this.parent;return e.exporters.map((t=>({id:t.type,text:e.optionalL(t.title,this)})))},onChange({value:e}){this.owner.widgetMap.alignRowsField.hidden="singlepage"===e,this.owner.widgetMap.repeatHeaderField.hidden="multipagevertical"!==e},weight:300},alignRowsField:{type:"checkbox",label:"L{ExportDialog.alignRows}",checked:!1,hidden:!0,weight:400},repeatHeaderField:{type:"checkbox",label:"L{ExportDialog.repeatHeader}",localeClass:this,hidden:!0,weight:500},fileFormatField:{type:"combo",label:"L{ExportDialog.fileFormat}",localeClass:this,editable:!1,value:"pdf",items:[],onChange({value:e,oldValue:t}){const r=this.parent;if(r.hidePNGMultipageOption){const n=r.widgetMap.exporterTypeField,i=n.store.find((e=>"singlepage"===e.id));e===FileFormat.png&&i?(this._previousDisabled=n.disabled,n.disabled=!0,this._previousValue=n.value,n.value="singlepage"):t===FileFormat.png&&this._previousValue&&(n.disabled=this._previousDisabled,n.value=this._previousValue)}},weight:600},paperFormatField:{type:"combo",label:"L{ExportDialog.paperFormat}",editable:!1,value:"A4",items:[],weight:700},orientationField:{type:"exportorientationcombo",label:"L{ExportDialog.orientation}",value:"portrait",weight:800}},bbar:{defaults:{localeClass:this},items:{exportButton:{color:"b-green",text:"L{ExportDialog.export}",weight:100,onClick:"up.onExportClick"},cancelButton:{color:"b-gray",text:"L{ExportDialog.cancel}",weight:200,onClick:"up.onCancelClick"}}}}}construct(e={}){const t=this,{client:r}=e;if(!r)throw new Error("`client` config is required");t.columnsStore=r.columns.chain((e=>e.isLeaf&&e.exportable),null,{excludeCollapsedRecords:!1}),t.applyInitialValues(e),super.construct(e),LocaleManager_default.ion({locale:"onLocaleChange",prio:-1,thisObj:t})}applyInitialValues(e){const t=this,r=e.items=e.items||{};e.width=e.width||t.L("L{width}"),e.defaults=e.defaults||{},e.defaults.labelWidth=e.defaults.labelWidth||t.L("L{ExportDialog.labelWidth}"),r.columnsField=r.columnsField||{},r.fileFormatField=r.fileFormatField||{},r.paperFormatField=r.paperFormatField||{},r.fileFormatField.items=buildComboItems(FileFormat,(e=>e.toUpperCase())),r.paperFormatField.items=buildComboItems(PaperFormat),r.columnsField.store=t.columnsStore}onBeforeShow(){var e;const{columnsField:t,alignRowsField:r,exporterTypeField:n,repeatHeaderField:i}=this.widgetMap;this.autoSelectVisibleColumns&&(t.value=this.columnsStore.query((e=>!e.hidden))),r.hidden="singlepage"===n.value,i.hidden="multipagevertical"!==n.value,null==(e=super.onBeforeShow)||e.call(this,...arguments)}onLocaleChange(){const e=this.L("L{labelWidth}");this.width=this.L("L{width}"),this.eachWidget((t=>{t instanceof Field&&(t.labelWidth=e)}))}onExportClick(){const e=this.values;this.trigger("export",{values:e})}onCancelClick(){this.trigger("cancel"),this.hide()}get values(){const e=/field/i,t={};return this.eachWidget((r=>{e.test(r.ref)&&(t[r.ref.replace(e,"")]=r instanceof Checkbox?r.checked:r.value)})),t}};ExportDialog.initClass(),ExportDialog._$name="ExportDialog";var cellContentRange=document.createRange(),Row=class extends Base{static get configurable(){return{cls:{$config:{equal:(e,t)=>(null==e?void 0:e.isDomClassList)&&(null==t?void 0:t.isDomClassList)&&e.isEqual(t)}}}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1,cellContext:new Location({grid:e.grid,id:null,columnIndex:0})}),super.construct(e),"position"===this.grid.positionMode&&(this.translateElements=this.positionElements)}doDestroy(){const e=this;e.rowManager.isDestroying||(e.removeElements(),e.rowManager.idMap[e.id]===e&&delete e.rowManager.idMap[e.id]),super.doDestroy()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){this._dataIndex!==e&&(this._dataIndex=e,this.eachElement((t=>{t.dataset.index=e,t.ariaRowIndex=this.grid.hideHeaders?e+1:e+2})))}get id(){return this._id}set id(e){const t=this,r={id:e},n=t.rowManager.idMap;t._id===e&&n[e]===t||(n[t._id]===t&&delete n[t._id],n[e]=t,t._id=e,t.eachElement((t=>{DomDataStore.assign(t,r),t.dataset.id=e})),t.eachCell((e=>DomDataStore.assign(e,r))))}addElement(e,t){const r=this;let n=t.firstElementChild;for(r._elements[e]=t,r._elementsArray.push(t),r._regions.push(e),DomDataStore.assign(t,{index:r.index}),r._cells[e]=[];n;)r._cells[e].push(n),r._allCells.push(n),DomDataStore.set(n,{column:n.dataset.column,columnId:n.dataset.columnId,rowElement:n.parentNode,row:r}),n=n.nextElementSibling;t.dataset.index=r.index,t.ariaRowIndex=r.grid.hideHeaders?r.index+1:r.index+2}getElement(e){return this._elements[e]}getRectangle(e){return Rectangle.from(this.getElement(e))}eachElement(e){this._elementsArray.forEach(e)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get element(){const e=Object.keys(this._elements)[0];return this._elements[e]}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e,t=!1){return this._allCells.find((r=>{const n=DomDataStore.get(r);return n.columnId==e||!t&&n.column==e}))}removeElements(e=!1){const t=this;t.rowManager.trigger("removeRow",{row:t}),e||t.eachElement((e=>e.remove())),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}updateElementsHeight(e){const t=this;e||t.rowManager.storeKnownHeight(t.id,t.height),t.lastHeight!==t.height&&(this.eachElement((e=>e.style.height=t.offsetHeight+"px")),t.lastHeight=t.height)}addCls(e){this.updateCls(this.cls.add(e))}removeCls(e){this.updateCls(this.cls.remove(e))}toggleCls(e,t){this.updateCls(this.cls[t?"add":"remove"](e))}assignCls(e){this.updateCls(this.cls.assign(e))}changeCls(e){return(null==e?void 0:e.isDomClassList)?e:new DomClassList(e)}updateCls(e){this.eachElement((t=>DomHelper.syncClassList(t,e)))}setAttribute(e,t){this.eachElement((r=>r.setAttribute(e,t)))}removeAttribute(e){this.eachElement((t=>t.removeAttribute(e)))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e,t){this._top!==e&&(this._top=e,this.translateElements(t))}setBottom(e,t){this.setTop(e-this.offsetHeight,t)}translate(e,t=!1){return this.setTop(e,t),e+this.offsetHeight}translateElements(e){const t=this,{top:r,_elementsArray:n}=t;if(t.lastTop!==r){for(let e=0,{length:t}=n;e<t;e++)n[e].style.transform="translate(0,"+r+"px)";!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=r}}positionElements(e){const t=this,{top:r,_elementsArray:n}=t;if(t.lastTop!==r){for(let e=0,{length:t}=n;e<t;e++)n[e].style.top=r+"px";!e&&t.rowManager.trigger("translateRow",{row:t}),t.lastTop=r}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,r=!0,n=!1,i=!1){var s,a,o;const l=this,{cellContext:c,cls:d,elements:u,grid:h,rowManager:g,height:p,_id:m}=l,f=DomDataStore.get(l._elementsArray[0]),v=g._rowHeight,{store:y}=h,{isTree:b}=y;let C,D=0;if(t||!1===t||(t=h.store.getById(f.id),e=h.store.indexOf(t)),!t)return;const S=null==t?void 0:t.cls,E=S?S.isDomClassList?S:new DomClassList(S):null;d.assign({"b-grid-row-updating":r&&h.transitionDuration&&!i,"b-selected":h.isSelected(null==t?void 0:t.id),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks}),l.lastRecordCls&&d.remove(l.lastRecordCls),E?(d.add(E),l.lastRecordCls=Object.assign({},E)):l.lastRecordCls=null,g.trigger("beforeRenderRow",{row:l,record:t,recordIndex:e,oldId:m}),h.beforeRenderRow({row:l,record:t,recordIndex:e,oldId:m}),l.updateCls(d),r&&h.transitionDuration&&!i&&h.setTimeout((()=>{l.isDestroyed||(d.remove("b-grid-row-updating"),l.updateCls(d))}),h.transitionDuration),l.id=t.id,l.dataIndex=e;const w=!h.fixedRowHeight&&h.getRowHeight(t)||v;let R=l.maxRequestedHeight=null;if(b)for(const e in u){const r=u[e];r.id=h.id+"-"+e+"-"+l.id,DomHelper.setAttributes(r,{"aria-level":t.childLevel+1,"aria-setsize":t.parent.children.length,"aria-posinset":t.parentIndex+1}),t.isExpanded(y)?DomHelper.setAttributes(r,{"aria-expanded":!0,"aria-owns":(null==(s=t.children)?void 0:s.length)?null==(a=t.children)?void 0:a.map((t=>h.id+"-"+e+"-"+t.id)).join(" "):null}):(t.isLeaf?r.removeAttribute("aria-expanded"):r.setAttribute("aria-expanded",!1),r.removeAttribute("aria-owns"))}for(c._record=t,c._id=t.id,c._rowIndex=e,D=0;D<h.columns.visibleColumns.length;D++){const e=h.columns.visibleColumns[D];c._columnId=e.id,c._column=e,c._columnIndex=D,c._cell=l.getCell(e.id,!0),c.height=w,c.maxRequestedHeight=R,c.updatingSingleRow=r,C=l.renderCell(c),g.fixedRowHeight||null!=C.height&&(R=Math.max(R,C.height),C.transient||(l.maxRequestedHeight=R))}const x=null!=R?R:w;l.height=null!=(o=h.processRowHeight(t,x))?o:x,l.updateElementsHeight(i),r&&!i&&(p!==l.height&&g.translateFromRow(l,n),g.trigger("updateRow",{row:l,record:t,recordIndex:e,oldId:m}),g.trigger("renderDone")),h.afterRenderRow({row:l,record:t,recordIndex:e,oldId:m,oldHeight:p,isExport:i}),g.trigger("renderRow",{row:l,record:t,recordIndex:e,oldId:m,isExport:i}),p&&l.height!==p&&g.trigger("rowRowHeight",{row:l,record:t,height:l.height,oldHeight:p}),l.forceInnerHTML=!1}renderCell(e){var t,r,n,i;e.isLocation||(e=new Location(e));let{cell:s,record:a}=e;const o=this,{grid:l,column:c,height:d,maxRequestedHeight:u,updatingSingleRow:h=!0,isMeasuring:g=!1}=e,p=null==(t=l.features)?void 0:t.cellEdit,m=DomDataStore.get(s),f=m.rowElement,v=DomDataStore.get(f);if(!a&&(a=e._record=l.store.getById(v.id),!a))return;let y=c.getRawValue(a);const b=a.fieldMap[c.field],C={configuredHeight:d,height:null,maxRequestedHeight:u},D=c.getCellClass(e),S={cellElement:s,dataField:b,rowElement:f,value:y,text:"",record:a,column:c,size:C,grid:l,row:m.row,updatingSingleRow:h,isMeasuring:g},E=c.renderer||c.defaultRenderer;l.beforeRenderCell(S),S.cellElement!==s&&(s=S.cellElement),DomHelper.syncClassList(s,D);let w=!0;E?(y=E.call(c,S),void 0===y&&!1===c.alwaysClearCell&&(w=!1)):b&&(y=b.print(y));const R=null==(r=l.hasFrameworkRenderer)?void 0:r.call(l,{cellContent:y,column:c});R&&a.isSpecialRow&&(y="");const x=R&&!c.data.tree&&!a.isSpecialRow;if(w&&!x){let t=s;(null==(n=null==p?void 0:p.editorContext)?void 0:n.equals(e))&&!p.editor.isFinishing&&(t=o.moveContentFromCell(s,p.editor.element));const r=null!=y&&"object"==typeof y,i="string"==typeof y,a=r||null==y?"":String(y);if(o.forceInnerHTML&&(t.innerHTML="",delete t._content,s.lastDomConfig=null),r||!c.htmlEncode||c.disableHtmlEncode?!c.autoSyncHtml||i&&!DomHelper.getChildElementCount(t)?r?DomSync.sync({targetElement:t,domConfig:{onlyChildren:!0,children:ArrayHelper.asArray(y)}}):t._content!==a&&(t.innerHTML=t._content=a):i?DomHelper.sync(a,t.firstElementChild):r&&DomSync.sync({domConfig:y,targetElement:t}):s._hasHtml?(t.innerText=a,s._hasHtml=!1):DomHelper.setInnerText(t,a),t!==s){const{firstChild:e}=s;for(const r of t.childNodes)s.insertBefore(r,e)}}return a.isSpecialRow||null==(i=l.processCellContent)||i.call(l,{cellElementData:m,rendererData:S,rendererHtml:S.rendererHtml||y}),c.autoHeight&&null==C.height&&(s.classList.add("b-measuring-auto-height"),C.height=Math.max(s.offsetHeight,l.rowHeight),s.classList.remove("b-measuring-auto-height")),g||o.rowManager.trigger("renderCell",S),C}moveContentFromCell(e,t){cellContentRange.setStart(e,0),cellContentRange.setEndBefore(t);const r=document.createElement("div");return r.appendChild(cellContentRange.extractContents()),r}};__publicField(Row,"$name","Row"),Row.initClass(),Row._$name="Row";var Exporter=class extends(Delayable_default(Events_default(Localizable_default(Base)))){static get defaultConfig(){return{translateURLsToAbsolute:!0,keepPathName:!0,filterStyles:e=>e}}pageTpl(e){const{title:t,header:r,footer:n,styles:i,htmlClasses:s,bodyStyle:a,bodyClasses:o=[],paperHeight:l,paperWidth:c,html:d}=e;return o.push("b-"+this.constructor.type),DomHelper.scrollBarWidth?o.push("b-visible-scrollbar"):o.push("b-overlay-scrollbar"),BrowserHelper.isChrome?o.push("b-chrome"):BrowserHelper.isSafari?o.push("b-safari"):BrowserHelper.isFirefox&&o.push("b-firefox"),TemplateHelper.tpl`
            <!DOCTYPE html>
            <html class="
    ${s}" style="width: ${c}in; height: ${l}in;">
                <head>
                    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
                    <title>
    ${t}</title>
                    
    ${i.join("")}
                </head>
                <body class="b-export 
    ${o.join(" ")}" style="width: ${c}in; height: ${l}in; ${a}">
                    <div class="b-export-content">
                        
    ${r&&'<div class="b-export-header" style="width: 100%">'+r+"</div>"}
                        <div class="b-export-body"><div class="b-export-viewport">
    ${d}</div></div>
                        
    ${n&&'<div class="b-export-footer" style="width: 100%">'+n+"</div>"}
                    </div>
                </body>
            </html>
    `}get stylesheets(){const e=this;if(e._stylesheets)return e._stylesheets;const t=e.translateURLsToAbsolute,r=globalThis.origin,n=Array.from(document.querySelectorAll('link[rel="stylesheet"], style')),i=[];return n.forEach((n=>{if(n=n.cloneNode(!0),t&&n.href){let e;e=!0===t?n.href:this.keepPathName?n.href.replace(r,t):new URL(n.getAttribute("href"),t),n.setAttribute("href",e)}let s=n.outerHTML;if(t&&/style/i.test(n.tagName)){const r=e.getStyleTagURLConverter(t);s=s.replace(/url\(['"]?(.+?)['"]?\)/g,r)}i.push(s)})),i.push("<style>body, html {overflow: auto;}body {position: relative;margin: 0;}</style>"),e._stylesheets=e.filterStyles(i)}set stylesheets(e){this._stylesheets=e?this.filterStyles(e):e}getStyleTagURLConverter(e){return function(t,r){let n;try{let i;/^#/.test(r)?n=t:(i=!0===e?globalThis.location.href:this.keepPathName?globalThis.location.href.replace(globalThis.location.origin,e):e,n="url("+new URL(r,i).href+")")}catch(e){n=t}return n}.bind(this)}saveState({client:e}){this.state=e.state}async restoreState({client:e}){const t=[],r=new Set;r.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}})),e.eachSubGrid((({header:e,scrollable:n})=>{r.add(n.ion({scroll(){t.push(n.await("scrollEnd"))}})),r.add(e.scrollable.ion({scroll(){t.push(e.scrollable.await("scrollEnd"))}}))})),e.state=this.state,await Promise.all(t),r.forEach((e=>e()))}beforeExport(){this.element=document.createElement("div")}cloneElement(e,t=this.element,r=!0){r&&(t.innerHTML=""),t.appendChild(e.cloneNode(!0)),DomHelper.removeEachSelector(t,".b-grid-row,.b-grid-merged-cells-container");const n=t.querySelector(".b-gridbase > .b-mask");n&&n.remove()}createPlaceholder(e,t=!0,r={}){return t&&(e.innerHTML=""),DomHelper.createElement(Object.assign({parent:e,id:IdHelper.generateId("export")},r))}prepareElement({client:e}){const{tbar:t,bbar:r}=e;t&&this.element.querySelector("#"+t.id).remove(),r&&this.element.querySelector("#"+r.id).remove()}measureElement(e=""){e instanceof HTMLElement&&(e=e.outerHTML);const t=DomHelper.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:'<div style="height: 1px"></div>'+e+'<div style="height: 1px"></div>'}),r=t.offsetHeight-2;return t.remove(),r}prepareHTML(e){e instanceof HTMLElement&&(e=e.outerHTML);const t=DomHelper.createElement({parent:document.body,style:{visibility:"hidden",position:"absolute"},html:e}),r=t.querySelectorAll("img");for(let e=0,t=r.length;e<t;e++)r[e].setAttribute("src",r[e].src);const n=t.innerHTML;return t.remove(),n}getVirtualScrollerHeight(e){let t=0;return e.eachSubGrid((e=>{e.overflowingHorizontally&&(t=DomHelper.scrollBarWidth)})),0===t?t:t+1}inchToPx(e){return 96*e}getScaleValue(e,t){return Math.floor(1e4*e/t)/1e4}getVisibleRowsCount(e){const t=e.rowManager,r=t.rows.indexOf(t.firstVisibleRow),n=t.rows.indexOf(t.lastVisibleRow);let i;return i=-1!==r?-1===n?e.store.count-r:n-r+1:e.store.count,i}async export(e){const t=this;let r;t.beforeExport(),t.saveState(e),await t.prepareComponent(e);try{r=await t.getPages(e)}finally{await t.restoreComponent(e),t.stylesheets=null,await new Promise((e=>t.requestAnimationFrame(e))),await t.restoreState(e)}return r}async getPages(e){const t=this.pagesExtractor(e),r=[];let n;for(;(n=await t.next())&&!n.done;)r.push(n.value);return r}adjustRowBuffer(e){const{contentHeight:t}=this.exportMeta,{rowManager:r}=e;this.oldRowManagerConfig={prependRowBuffer:r.prependRowBuffer,appendRowBuffer:r.appendRowBuffer};const n=Math.ceil(t/r.rowOffsetHeight);r.prependRowBuffer=n,r.appendRowBuffer=n,e.renderRows(),e.rowManager.jumpToPosition(e.scrollable.y)}restoreRowBuffer(e){e.rowManager.prependRowBuffer=this.oldRowManagerConfig.prependRowBuffer,e.rowManager.appendRowBuffer=this.oldRowManagerConfig.appendRowBuffer}async prepareComponent(e){const t=this,{client:r,columns:n,rowsRange:i,keepRegionSizes:s,enableDirectRendering:a}=e,{rowManager:o}=r,l=t.exportMeta={enableDirectRendering:a,totalWidth:0,totalHeight:0-(a?0:t.getVirtualScrollerHeight(r)),subGrids:{}};r.columns.forEach((e=>{n.includes(e.id)?e.show():e.hide()})),await new Promise((e=>r.requestAnimationFrame(e))),r.rowManager.rowCount>0&&(i===RowsRange.all?l.firstVisibleDataIndex=o.rows[0].dataIndex:(l.firstVisibleDataIndex=o.firstVisibleRow.dataIndex,e.alignRows=!0),a||await r.scrollRowIntoView(r.store.getAt(l.firstVisibleDataIndex),{block:"start"}));const{element:c}=t;let d;t.cloneElement(r.element),t.prepareElement(e),a&&(l.fakeRow=d=new Row({cls:r.rowCls,rowManager:r.rowManager,grid:r,index:-10,dataIndex:-10})),r.eachSubGrid((e=>{var n,i,a;d&&(e.onAddRow({rows:[d],isExport:!0}),d.element.dataset.ownerCmp=r.id);const o=t.createPlaceholder(c.querySelector('[id="'+e.id+'"]'),!1);let u;u=(null==s?void 0:s[e.region])?e.element.offsetWidth:e.columns.visibleColumns.reduce(((e,t)=>("number"==typeof t.width?e+=t.width:e+=(r.hideHeaders?r.rowManager.rows[0].getCell(t.id):t.element).offsetWidth,e)),0),l.totalWidth+=u;const h=(null==(n=e.splitterElement)?void 0:n.offsetWidth)||0;l.totalWidth+=h,l.subGrids[e.region]={id:e.id,headerId:(null==(i=e.header)?void 0:i.id)||null,footerId:(null==(a=e.footer)?void 0:a.id)||null,rows:[],splitterWidth:h,placeHolder:o,width:u}}))}prepareExportElement(){const{element:e,exportMeta:t}=this;return Object.values(t.subGrids).forEach((({width:t,id:r,headerId:n,footerId:i})=>{[r,n,i].forEach((r=>{if(r){const n=e.querySelector('[id="'+r+'"]');n&&(n.style.width=t+"px",n.style.flex="")}}))})),e.innerHTML}async restoreComponent(e){this.exportMeta.fakeRow&&(this.exportMeta.fakeRow.destroy(),delete this.exportMeta.fakeRow)}async scrollRowIntoView(e,t){await e.scrollRowIntoView(e.store.getAt(t),{block:"start"}),await new Promise((e=>this.requestAnimationFrame(e)))}collectRow(e){const t=this.exportMeta.subGrids,r=/data-owner-cmp=".+?"/;Object.entries(e.elements).forEach((([n,i])=>{t[n].rows.push([i.outerHTML.replace(r,""),e.top,e.offsetHeight,new Map])}))}renderMergedCells(e,t,r,n){const{client:i}=e,{subGrids:s}=this.exportMeta,a=i.features.mergeCells.buildMergedCellsConfig(t,r,n);for(const e in s){const t=s[e],r=document.createElement("div");DomSync.sync({targetElement:r,domConfig:{children:a[e].children}}),r.childNodes.length&&(r.childNodes.forEach((e=>{const{syncId:t}=e.dataset,r=i.features.mergeCells.mergedRanges.find((e=>{var r;return(null==(r=e.cellElement)?void 0:r.parentNode.dataset.syncId)===t}));r&&(e.innerHTML=r.cellElement.outerHTML)})),t.mergedCellsHtml=[r.innerHTML])}}};Exporter.prototype.pagesExtractor=async function*(){throw new Error("Implement this method in a subclass")},Exporter._$name="Exporter";var MultiPageExporter=class extends Exporter{static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}static get title(){return this.L("L{multipage}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e,rowsRange:t,enableDirectRendering:r}){const{exportMeta:n}=this;++n.currentPage,++n.verticalPosition,delete n.lastExportedRowBottom,n.verticalPosition>=n.verticalPages&&(Object.assign(n,{verticalPosition:0,horizontalPosition:n.horizontalPosition+1,currentPageTopMargin:0,lastTop:0,lastRowIndex:t===RowsRange.visible?e.rowManager.firstVisibleRow.dataIndex:0}),delete n.lastRowDataIndex,r||await this.scrollRowIntoView(e,n.firstVisibleDataIndex,{block:"start"}))}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:a,rowsRange:o,enableDirectRendering:l}=e,c=PaperFormat[e.paperFormat],d=e.orientation===Orientation.portrait,u=d?c.width:c.height,h=d?c.height:c.width,g=t.inchToPx(u),p=t.inchToPx(h),m=o===RowsRange.visible,f=Math.ceil(r.totalWidth/g);let v=p;i&&(v-=t.measureElement(i({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1}))),s&&(v-=t.measureElement(s({totalWidth:r.totalWidth,totalPages:-1,currentPage:-1})));let y,b,C=n.store.count;if(m?(C=t.getVisibleRowsCount(n),y=r.totalHeight+n.headerHeight+n.footerHeight+n.bodyHeight):y=r.totalHeight+n.headerHeight+n.footerHeight+n.scrollable.scrollHeight,a&&!m){const e=n.rowManager.rowOffsetHeight,t=Math.floor((v-n.headerHeight)/e),r=Math.floor(v/e),i=C-t;b=1+Math.ceil(i/r)}else b=Math.ceil(y/v);Object.assign(r,{paperWidth:u,paperHeight:h,pageWidth:g,pageHeight:p,horizontalPages:f,verticalPages:b,totalHeight:y,contentHeight:v,totalRows:C,totalPages:f*b,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:m?n.rowManager.firstVisibleRow.dataIndex:0}),l||this.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:r}=t,{client:n,alignRows:i,rowsRange:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,contentHeight:c,totalRows:d,lastRowDataIndex:u}=r,{rowManager:h}=n,{rows:g}=h,p=s===RowsRange.visible,m=n.hasActiveFeature("mergeCells");let f,v;v=p&&null!=u?u===g[g.length-1].dataIndex?g.length-1:g.findIndex((e=>e.dataIndex===u)):p?g.findIndex((e=>e.bottom>Math.ceil(n.scrollable.y))):g.findIndex((e=>e.bottom+o+n.headerHeight>0));const y=v;f=c-(p||0===l?0:g[v].top+o+n.headerHeight),0===l&&(f-=n.headerHeight);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0,t.exportMeta.lastExportedRowBottom=g[v-1].bottom):(t.collectRow(e),f-=e.offsetHeight,b=e.dataIndex,(++v===g.length&&f>0||p&&v-y===d)&&(f=0))}if(m)for(const e in a){const t=a[e],r=n.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of r)t.mergedCellsHtml.push(e.outerHTML)}const D=g[v-1];if(D&&(r.exactGridHeight=D.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight,r.lastRowDataIndex=D.dataIndex+1),await t.onRowsCollected(g.slice(y,v),e),p)r.exactGridHeight-=r.scrollableTopMargin=n.scrollable.y;else{const e=h.ion({offsetRows:({offset:e})=>C+=e});await t.scrollRowIntoView(n,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:r}=t,{client:n,alignRows:i,rowsRange:s}=e,{currentPageTopMargin:a,verticalPosition:o,contentHeight:l,totalRows:c,lastRowIndex:d,fakeRow:u}=r,{store:h}=n,g=n.hasActiveFeature("mergeCells"),p=s===RowsRange.visible;let m,f=d,{lastTop:v}=r;const y=f,b=[];m=l-(p||0===o?0:v+a+n.headerHeight),0===o&&(m-=n.headerHeight);let C,D,S=0;for(;m>0;)u.render(f,h.getAt(f),!0,!1,!0),i&&m<u.offsetHeight?(S=-m,m=0,t.exportMeta.lastExportedRowBottom=v):(D=v,C=f,v=u.translate(v),m-=u.offsetHeight,t.collectRow(u),b.push({top:u.top,bottom:u.bottom,offsetHeight:u.offsetHeight,dataIndex:u.dataIndex}),(++f===h.count&&m>0||p&&f-y===c)&&(m=0));return g&&t.renderMergedCells(e,y,f,b),r.lastRowIndex=i?f:C,r.lastTop=i?v:D,u&&(r.exactGridHeight=u.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(b,e),S}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=r;let u,h,g;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===RowsRange.all&&(r.totalHeight=n.height-n.bodyHeight+n.scrollable.scrollHeight-t.getVirtualScrollerHeight(n)),i&&(u=t.prepareHTML(i({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c}))),g=a?await t.renderRows(e):await t.collectRows(e);return{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:r,mergedCellsHtml:n})=>{const i=e.outerHTML;let s=r.reduce(((e,t)=>e+=t[0]),"");(null==n?void 0:n.length)&&(s+='<div class="b-grid-merged-cells-container">'+n.join("")+"</div>"),t=t.replace(i,s)})),t}prepareExportElement(){const{element:e,exportMeta:t}=this;return t.scrollableTopMargin&&(e.querySelector(".b-grid-vertical-scroller").style.marginTop="-"+t.scrollableTopMargin+"px"),super.prepareExportElement()}};MultiPageExporter.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:i,totalPages:s,paperWidth:a,paperHeight:o,contentHeight:l}=r;let c;for(;(c=r.currentPage)<s;){t.trigger("exportStep",{text:t.L(MultiPageExporter.exportingPageText,{currentPage:c,totalPages:s}),progress:Math.round((c+1)/s*90)});const{html:d,header:u,footer:h,offset:g}=await t.buildPage(e),p=[...n,"<style>#"+e.client.id+" {height: "+r.exactGridHeight+"px !important;width: "+i+"px !important;\n                    }\n                    .b-export-body .b-export-viewport {\n                        margin-inline-start : "+-a*r.horizontalPosition+"in;margin-top  : "+r.currentPageTopMargin+"px;\n                    }\n                </style>\n            "];r.currentPageTopMargin-=l+g,await t.stateNextPage(e),yield{html:t.pageTpl({html:d,header:u,footer:h,styles:p,paperWidth:a,paperHeight:o})}}},MultiPageExporter._$name="MultiPageExporter";var MultiPageVerticalExporter=class extends Exporter{static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}static get title(){return this.L("L{multipagevertical}")}static get exportingPageText(){return"L{exportingPage}"}async stateNextPage({client:e}){const{exportMeta:t}=this,{totalRows:r,processedRows:n,totalPages:i}=t;++t.currentPage,++t.verticalPosition,t.currentPage===i&&n.size!==r&&(++t.totalPages,++t.verticalPages)}estimateTotalPages(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,alignRows:a,rowsRange:o,repeatHeader:l,enableDirectRendering:c}=e,{pageWidth:d,pageHeight:u,totalWidth:h}=r,g=t.getScaleValue(d,h);let p,m=0-t.getVirtualScrollerHeight(n)+n.height-n.bodyElement.offsetHeight+n.scrollable.scrollHeight,f=u/g,v=n.store.count,y=0,b=m;if(i&&(f-=t.measureElement(i({totalWidth:h,totalPages:-1,currentPage:-1}))),s&&(f-=t.measureElement(s({totalWidth:h,totalPages:-1,currentPage:-1}))),l&&(f-=n.headerHeight+n.footerHeight,m-=n.headerHeight+n.footerHeight),o===RowsRange.visible){const e=n.rowManager,i=e.firstVisibleRow,s=e.lastVisibleRow;c||(y=i.top),v=t.getVisibleRowsCount(n),c?(m=n.headerHeight+n.footerHeight+s.bottom-i.top,b=s.bottom-i.top):b=m=m-n.scrollable.scrollHeight+s.bottom-i.top,r.lastRowIndex=i.dataIndex,r.finishRowIndex=s.dataIndex}else r.finishRowIndex=n.store.count-1;if(a&&!l&&o!==RowsRange.visible){const e=n.rowManager.rowOffsetHeight,t=Math.floor((f-n.headerHeight)/e),r=Math.floor(f/e),i=v-t;p=1+Math.ceil(i/r)}else p=Math.ceil(b/f);Object.assign(r,{scale:g,contentHeight:f,totalRows:v,totalHeight:m,verticalPages:p,initialScroll:y,horizontalPages:1,totalPages:p})}async prepareComponent(e){await super.prepareComponent(e);const t=this,{exportMeta:r}=t,{client:n}=e,i=PaperFormat[e.paperFormat],s=e.orientation===Orientation.portrait,a=s?i.width:i.height,o=s?i.height:i.width,l=t.inchToPx(a),c=t.inchToPx(o);Object.assign(r,{paperWidth:a,paperHeight:o,pageWidth:l,pageHeight:c,horizontalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0,currentPageTopMargin:0,lastTop:0,lastRowIndex:0,processedRows:new Set}),t.estimateTotalPages(e),e.enableDirectRendering||t.adjustRowBuffer(n)}async restoreComponent(e){await super.restoreComponent(e),e.enableDirectRendering||this.restoreRowBuffer(e.client)}async collectRows(e){const t=this,{exportMeta:r}=t,{client:n,alignRows:i,repeatHeader:s}=e,{subGrids:a,currentPageTopMargin:o,verticalPosition:l,totalRows:c,contentHeight:d}=r,u=s?0:n.headerHeight,{rowManager:h}=n,{rows:g}=h,p=e.rowsRange===RowsRange.visible,m=n.hasActiveFeature("mergeCells");let f,v=p?g.findIndex((e=>e.bottom>n.scrollable.y)):g.findIndex((e=>e.bottom+o+u>0));const y=v;f=d-(0===l?0:g[v].top+o+u),0===l&&(f-=u);let b,C=0;for(;f>0;){const e=g[v];i&&f<e.offsetHeight?(C=-f,f=0):(t.collectRow(e),f-=e.offsetHeight,f>0&&r.processedRows.add(e.dataIndex),b=e.dataIndex,(++v===g.length&&f>0||p&&v-y===c)&&(f=0))}if(m)for(const e in a){const t=a[e],r=n.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");t.mergedCellsHtml=[];for(const e of r)t.mergedCellsHtml.push(e.outerHTML)}const D=g[v-1];if(D&&(r.exactGridHeight=D.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(g.slice(y,v),e),p)r.scrollableTopMargin=n.scrollable.y;else{const e=h.ion({offsetRows:({offset:e})=>C+=e});await t.scrollRowIntoView(n,b+1),e()}return C}async renderRows(e){const t=this,{exportMeta:r}=t,{client:n,alignRows:i,repeatHeader:s}=e,{currentPageTopMargin:a,verticalPosition:o,totalRows:l,contentHeight:c,lastRowIndex:d,finishRowIndex:u,fakeRow:h}=r,g=s?0:n.headerHeight,{store:p}=n,m=n.hasActiveFeature("mergeCells"),f=e.rowsRange===RowsRange.visible;let v,y=d,{lastTop:b}=r;const C=y,D=[];v=c-(0===o?0:b+a+g),0===o&&(v-=g);let S,E,w=0;for(;v>0;)h.render(y,p.getAt(y),!0,!1,!0),i&&v<h.offsetHeight?(w=-v,v=0):(E=b,S=y,b=h.translate(b),v-=h.offsetHeight,t.collectRow(h),D.push({top:h.top,bottom:h.bottom,offsetHeight:h.offsetHeight,dataIndex:h.dataIndex}),v>0&&r.processedRows.add(y),(y===u||++y-C===l&&f)&&(v=0));return m&&t.renderMergedCells(e,C,y,D),r.lastRowIndex=S,r.lastTop=E,h&&(r.exactGridHeight=h.bottom+n.footerContainer.offsetHeight+n.headerContainer.offsetHeight),await t.onRowsCollected(D,e),w}async buildPage(e){const t=this,{exportMeta:r}=t,{client:n,headerTpl:i,footerTpl:s,enableDirectRendering:a}=e,{totalWidth:o,totalPages:l,currentPage:c,subGrids:d}=r;let u,h,g;Object.values(d).forEach((e=>e.rows=[])),e.rowsRange===RowsRange.all&&(r.totalHeight=n.headerHeight+n.footerHeight+n.scrollable.scrollHeight,a||(r.totalHeight-=t.getVirtualScrollerHeight(n))),i&&(u=t.prepareHTML(i({totalWidth:o,totalPages:l,currentPage:c}))),s&&(h=t.prepareHTML(s({totalWidth:o,totalPages:l,currentPage:c}))),g=a?await t.renderRows(e):await t.collectRows(e);return{html:t.buildPageHtml(e),header:u,footer:h,offset:g}}async onRowsCollected(){}buildPageHtml(){const{subGrids:e}=this.exportMeta;let t=this.prepareExportElement();return Object.values(e).forEach((({placeHolder:e,rows:r,mergedCellsHtml:n})=>{const i=e.outerHTML;let s=r.reduce(((e,t)=>e+=t[0]),"");(null==n?void 0:n.length)&&(s+='<div class="b-grid-merged-cells-container">'+n.join("")+"</div>"),t=t.replace(i,s)})),t}};MultiPageVerticalExporter.prototype.pagesExtractor=async function*(e){const t=this,{exportMeta:r,stylesheets:n}=t,{totalWidth:i,paperWidth:s,paperHeight:a,contentHeight:o,scale:l,initialScroll:c}=r;let d,{totalPages:u}=r;for(;(d=r.currentPage)<u;){t.trigger("exportStep",{text:t.L(MultiPageVerticalExporter.exportingPageText,{currentPage:d,totalPages:u}),progress:Math.round((d+1)/u*90)});const{html:h,header:g,footer:p,offset:m}=await t.buildPage(e),f=[...n,"<style>#"+e.client.id+" {width: "+i+"px !important;\n                    }\n                    .b-export .b-export-content {\n                        transform: scale("+l+");transform-origin: top left;height: auto;}</style>"];if(e.repeatHeader){const t=r.exactGridHeight?r.exactGridHeight+r.currentPageTopMargin+"px":"100%";f.push("<style>#"+e.client.id+" {\n                        height: "+t+" !important;}.b-export .b-export-content {height: "+100/l+"%;}.b-export-body {height: 100%;display: flex;}.b-export-viewport {height: 100%;}.b-grid-vertical-scroller {margin-top: "+(r.currentPageTopMargin-c)+"px;}</style>")}else{const t=r.exactGridHeight||o-r.currentPageTopMargin;f.push("<style>#"+e.client.id+" {height: "+t+"px !important;}.b-export-body {overflow: hidden;}.b-export .b-export-content {height: "+100/l+"%;}.b-export-body .b-export-viewport {margin-top: "+r.currentPageTopMargin+"px;\n                    }\n                    .b-grid-vertical-scroller {\n                        margin-top: -"+c+"px;}</style>")}r.currentPageTopMargin-=o+m,await t.stateNextPage(e),({totalPages:u}=r),yield{html:t.pageTpl({html:h,header:g,footer:p,styles:f,paperWidth:s,paperHeight:a})}}},MultiPageVerticalExporter._$name="MultiPageVerticalExporter";var SinglePageExporter=class extends Exporter{static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}static get title(){return this.localize("L{singlepage}")}static get defaultConfig(){return{centerContentHorizontally:!1}}async prepareComponent(e){await super.prepareComponent(e),Object.assign(this.exportMeta,{verticalPages:1,horizontalPages:1,totalPages:1,currentPage:0,verticalPosition:0,horizontalPosition:0})}async onRowsCollected(){}positionRows(e,t){if(t.enableDirectRendering)return e.map((e=>e[0]));{let t=0;return e.map((([e,,r])=>{const n=e.replace(/translate\(\d+px, \d+px\)/,"translate(0px, "+t+"px)");return t+=r,n}))}}async collectRows(e){const t=this,{client:r}=e,{rowManager:n,store:i}=r,s=r.hasActiveFeature("mergeCells"),{subGrids:a}=t.exportMeta,o=e.rowsRange===RowsRange.visible&&i.count?t.getVisibleRowsCount(r):i.count;let{totalHeight:l}=t.exportMeta,c=0,d=-1;if(n.rows.length>0){if(e.rowsRange===RowsRange.visible&&(d=n.firstVisibleRow.dataIndex-1),s)for(const e of Object.values(a))e.mergedCellsHtml=[];for(;c<o;){const i=n.rows,u=i[i.length-1],h=c;if(i.forEach((e=>{e.dataIndex>d&&c<o&&(++c,l+=e.offsetHeight,t.collectRow(e))})),s)for(const e in a){const t=a[e],n=r.subGrids[e].element.querySelectorAll(".b-grid-merged-cells");for(const e of n)t.mergedCellsHtml.push(e.outerHTML)}const g=i.findIndex((e=>e.dataIndex===d+1)),p=g+(c-h);await t.onRowsCollected(i.slice(g,p),e),c<o&&(d=u.dataIndex,await t.scrollRowIntoView(r,d+1))}}return l}async renderRows(e){const t=this,{client:r,rowsRange:n}=e,{rowManager:i,store:s}=r,a=r.hasActiveFeature("mergeCells"),o=n===RowsRange.visible;let{totalHeight:l}=t.exportMeta;if(s.count){const{fakeRow:r}=t.exportMeta,{firstVisibleRow:n}=i,c=o?n.dataIndex:0,d=o?i.lastVisibleRow.dataIndex:s.count-1,u=[];let h=0;if(r.cells.length){for(let e=c;e<=d;e++)r.render(e,s.getAt(e),!0,!1,!0),h=r.translate(h),t.collectRow(r),u.push({top:r.top,bottom:r.bottom,offsetHeight:r.offsetHeight,dataIndex:r.dataIndex});await t.onRowsCollected(u,e)}l+=h,a&&t.renderMergedCells(e,c,d,u)}return l}buildPageHtml(e){const t=this,{subGrids:r}=t.exportMeta;let n=t.prepareExportElement();return Object.values(r).forEach((({placeHolder:r,rows:i,mergedCellsHtml:s})=>{const a=r.outerHTML;let o=t.positionRows(i,e).join("");(null==s?void 0:s.length)&&(o+='<div class="b-grid-merged-cells-container">'+s.join("")+"</div>"),n=n.replace(a,o)})),n}};SinglePageExporter.prototype.pagesExtractor=async function*(e){const t=this,{client:r}=e,{totalWidth:n}=t.exportMeta,i=t.stylesheets,s=e.orientation===Orientation.portrait,a=PaperFormat[e.paperFormat],o=s?a.width:a.height,l=s?a.height:a.width;let c,d,u;e.enableDirectRendering?(c=await t.renderRows(e),c+=r.headerHeight+r.footerHeight):(c=await t.collectRows(e),c+=r.height-r.bodyHeight);const h=t.buildPageHtml(e),g=c;if(e.headerTpl){d=t.prepareHTML(e.headerTpl({totalWidth:n}));c+=t.measureElement(d)}if(e.footerTpl){u=t.prepareHTML(e.footerTpl({totalWidth:n}));c+=t.measureElement(u)}const p=Math.min(1,t.getScaleValue(t.inchToPx(o),n)),m=Math.min(1,t.getScaleValue(t.inchToPx(l),c)),f=Math.min(p,m);i.push("<style>#"+r.id+" {height: "+g+"px !important;width: "+n+"px !important;}.b-export-content {"+(t.centerContentHorizontally?"left: 50%;":"")+"\n                    transform: scale("+f+") "+(t.centerContentHorizontally?"translateX(-50%)":"")+" transform-origin: top left;height: "+(1===f?"inherit":"auto !important")+"}</style>"),BrowserHelper.isIE11&&i.push("<style>.b-export-body {min-height: "+g+"px !important;}</style>"),yield{html:t.pageTpl({html:h,header:d,footer:u,styles:i,paperWidth:o,paperHeight:l})}},SinglePageExporter._$name="SinglePageExporter";var PdfExport=class extends InstancePlugin{static get $name(){return"PdfExport"}static get configurable(){return{dialogClass:ExportDialog,exportServer:void 0,exportDialog:{value:!0,$config:["lazy"]},fileName:null,fileFormat:"pdf",clientURL:null,paperFormat:"A4",orientation:"portrait",rowsRange:"all",alignRows:!1,repeatHeader:!1,keepRegionSizes:null,pagesPerRequest:0,exporterConfig:null,exporterType:"singlepage",exporters:[SinglePageExporter,MultiPageExporter,MultiPageVerticalExporter],translateURLsToAbsolute:!0,keepPathName:!0,openAfterExport:!0,sendAsBinary:!1,openInNewTab:!1,headerTpl:null,footerTpl:null,fetchOptions:null,exportMask:"L{Generating pages}",exportProgressMask:"L{Waiting for response from server}",showErrorToast:!0,localizableProperties:["exportMask","exportProgressMask"],filterStyles:e=>e,enableDirectRendering:!0}}updateEnableDirectRendering(e){e||VersionHelper.deprecate("Grid","6.0.0","Indirect rendering is deprecated")}doDestroy(){var e;null==(e=this.exportDialog)||e.destroy(),this.exportersMap.forEach((e=>e.destroy())),super.doDestroy()}get currentExportPromise(){return this._currentExportPromise}set currentExportPromise(e){this._currentExportPromise=e}get exportersMap(){return this._exportersMap||(this._exportersMap=new Map)}getExporter(e={}){const t=this,{exportersMap:r}=t,{type:n}=e;let i;if(r.has(n))i=r.get(n),Object.assign(i,e);else{const s=this.exporters.find((e=>e.type===n));if(!s)throw new Error("Exporter type "+n+" is not found. Make sure you've configured it");delete(e=ObjectHelper.clone(e)).type,i=new s(e),i.relayAll(t),r.set(n,i)}return i}buildRequest(e,t){return{html:JSON.stringify(e),fileFormat:t.fileFormat,format:t.paperFormat,orientation:t.orientation}}buildExportConfig(e={}){const{client:t,exportServer:r,clientURL:n,fileFormat:i,fileName:s,paperFormat:a,rowsRange:o,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:p,headerTpl:m,footerTpl:f,filterStyles:v,enableDirectRendering:y}=this;e.columns||(e.columns=t.columns.visibleColumns.filter((e=>e.exportable)).map((e=>e.id)));const b=ObjectHelper.assign({client:t,exportServer:r,clientURL:n,fileFormat:i,paperFormat:a,rowsRange:o,alignRows:l,repeatHeader:c,keepRegionSizes:d,orientation:u,translateURLsToAbsolute:h,keepPathName:g,sendAsBinary:p,headerTpl:m,footerTpl:f,enableDirectRendering:y,exporterType:this.exporterType,fileName:s||t.$$name},e);if(b.columns=e.columns.slice(),"multipagevertical"!==b.exporterType&&(b.repeatHeader=!1),!("alignRows"in e)&&e.repeatHeader&&(b.alignRows=!0),!("keepRegionSizes"in e)&&!b.keepRegionSizes){const e=[],r={};t.eachSubGrid((t=>t.collapsed&&e.push(t.region))),e.length&&(t.eachSubGrid((t=>{e.includes(t.region)||(r[t.region]=!0)})),b.keepRegionSizes=r)}return b.exporterConfig=ObjectHelper.assign({type:b.exporterType,translateURLsToAbsolute:b.translateURLsToAbsolute,keepPathName:b.keepPathName,filterStyles:v},b.exporterConfig||{}),delete b.exporterType,delete b.translateURLsToAbsolute,delete b.keepPathName,b}async export(e={}){var t,r;const n=this,{client:i,pagesPerRequest:s}=n;let a;if(e=n.buildExportConfig(e),!1!==i.trigger("beforePdfExport",{config:e})){i.isExporting=!0,i.mask(n.exportMask);try{const r=n.getExporter(e.exporterConfig);if(0===s){const s=await r.export(e);if(n.isDestroying)return;null==(t=n.exportDialog)||t.close(),i.unmask(),n.trigger("exportStep",{progress:90,text:n.exportProgressMask,contentGenerated:!0});const o=n.receiveExportContent(s,e);n.toast=n.showLoadingToast(o);const l=await o;a={response:l},await n.processExportContent(l,e)}}catch(e){throw a=e instanceof Response?{response:e}:{error:e},e}finally{n.toast&&!n.toast.isDestroying&&n.toast.hide(),n.isDestroying||(null==(r=n.exportDialog)||r.close(),i.unmask(),n.showErrorToast&&(a.error?"AbortError"!==a.error.name&&Toast.show({html:n.L("L{Export failed}"),rootElement:n.rootElement}):a.response.ok||Toast.show({html:n.L("L{Server error}"),rootElement:n.rootElement})),i.trigger("pdfExport",a),i.isExporting=!1)}}return a}receiveExportContent(e,t){return AjaxHelper.fetch(t.exportServer,Object.assign({method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:e,orientation:t.orientation,format:t.paperFormat,fileFormat:t.fileFormat,fileName:t.fileName,clientURL:t.clientURL,sendAsBinary:t.sendAsBinary})},this.fetchOptions))}async processExportContent(e,t){const r=this;if(e.ok&&r.openAfterExport){const n=(e=e.clone()).headers.get("content-type");if(n.match(/application\/octet-stream/)){const n=FileMIMEType[t.fileFormat],i=await r.responseBlobToObjectURL(e,n);r.getDownloadLink(t.fileName,i).click()}else if(n.match(/application\/json/)){const n=await e.json();if(n.success){r.getDownloadLink(t.fileName,n.url).click()}else Toast.show({html:n.msg,rootElement:this.rootElement})}}}async responseBlobToObjectURL(e,t){const r=await e.blob();return URL.createObjectURL(r.slice(0,r.size,t))}getDownloadLink(e,t){const r=document.createElement("a");return r.download=e,r.href=t,this.openInNewTab&&(r.target="_blank"),r}get defaultExportDialogConfig(){return ObjectHelper.copyProperties({},this,["client","exporters","exporterType","orientation","fileFormat","paperFormat","alignRows","rowsRange","repeatHeader"])}changeExportDialog(e,t){const r=this;if(null==t||t.destroy(),e){const t=r.dialogClass.mergeConfigs({rootElement:r.rootElement,client:r.client,items:{rowsRangeField:{value:r.rowsRange},exporterTypeField:{value:r.exporterType},orientationField:{value:r.orientation},paperFormatField:{value:r.paperFormat},repeatHeaderField:{value:r.repeatHeader},fileFormatField:{value:r.fileFormat},alignRowsField:{checked:r.alignRows}}},r.defaultExportDialogConfig,e);(e=r.dialogClass.new(t)).ion({export:r.onExportButtonClick,thisObj:r})}return e}async showExportDialog(){return this.exportDialog.show()}onExportButtonClick({values:e}){const t=this,r=t.exportDialog.mask({progress:0,maxProgress:100,text:t.exportMask}),n=t.ion({exportstep({progress:e,text:i,contentGenerated:s}){s?(t.exportDialog.unmask(),n()):(r.progress=e,null!=i&&(r.text=i))}});t.currentExportPromise=t.export(e),t.currentExportPromise.catch((()=>{})).finally((()=>{var e;n(),null==(e=t.exportDialog)||e.unmask(),t.currentExportPromise=null}))}showLoadingToast(e){const t=Toast.show({timeout:0,showProgress:!1,rootElement:this.rootElement,html:'<span class="b-mask-icon gt-icon gt-icon-spinner"></span><span>'+this.L("L{Waiting for response from server}")+'</span><button class="b-button">'+this.L("L{Click to abort}")+"</button>"});return EventHelper.on({element:t.element,click(){var t;null==(t=e.abort)||t.call(e)}}),t}};PdfExport._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport,!1,"Grid");var TableExporter=class extends Base{static get defaultConfig(){return{target:null,defaultColumnWidth:100,exportDateAsInstance:!0,showGroupHeader:!0,columns:null,indent:!0,indentationSymbol:"    "}}export(e={}){const t=this;return e=ObjectHelper.assign({},t.config,e),t.normalizeColumns(e),t.generateExportData(e)}generateExportData(e){const t=this.generateColumns(e);return{rows:this.generateRows(e),columns:t}}normalizeColumns(e){const t=e.columns||this.target.columns.visibleColumns.filter((e=>!1!==e.exportable));e.columns=t.map((e=>"string"==typeof e?this.target.columns.find((t=>t.field===e))||{field:e}:e))}generateColumns(e){return e.columns.map((t=>this.processColumn(t,e)))}generateRows(e){const{columns:t,rows:r}=e;if(0===t.length||0===(null==r?void 0:r.length))return[];const n=this,{target:i}=n;return(r||i.store).map((r=>n.processRecord(r,t,e))).filter((e=>null==e?void 0:e.length))}getColumnType(e,t=this.target.store){let r=e.exportedType||"object";if(void 0===e.exportedType&&e.field){const n=t.modelClass.getFieldDefinition(e.field);n&&"auto"!==n.type&&(r=n.type)}return r}processColumn(e,t){const{target:r}=this,{defaultColumnWidth:n}=t;let{field:i,text:s,width:a,minWidth:o}=e;if(i in r.store.modelClass.fieldMap||(i=""),!s||!a){const e=r.columns.find((e=>e.field===i));s||(s=e&&e.text||i),null==a&&(a=e&&e.width||n)}return a=Math.max(a||n,o||n),{field:i,value:s,width:a,type:this.getColumnType(e)}}processRecord(e,t,r){const{target:n}=this,{showGroupHeader:i,indent:s,indentationSymbol:a}=r;let o;return e?e.isSpecialRow?i&&e.meta.groupRowFor&&(o=t.map((t=>n.features.group.buildGroupHeader({cellElement:DomHelper.createElement(),grid:n,record:e,column:t})))):o=t.map((t=>{var i;let o=(null==(i=t.field)?void 0:i.includes("."))?e.get(t.field):e[t.field];const l=t.renderer||t.defaultRenderer;return!l||o&&t.isDateColumn&&r.exportDateAsInstance||(o=l.call(t,{value:o,record:e,column:t,grid:n,isExport:!0})),s&&t.tree&&(o=""+a.repeat(e.childLevel)+o),o})):o=t.map((()=>"")),o}};TableExporter._$name="TableExporter";var BooleanUnicodeSymbol=class{constructor(e){this._value=e}get value(){return this._value}toString(){return Boolean(this.value)?"✓":""}};BooleanUnicodeSymbol._$name="BooleanUnicodeSymbol";var ExcelExporter=class extends InstancePlugin{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{filename:null,dateFormat:"YYYY-MM-DD",exporterClass:TableExporter,exporterConfig:null,zipcelx:null,convertEmptyValueToEmptyString:!0}}processValue(e){return null==e||Number.isNaN(e)||"function"==typeof e||"object"==typeof e&&"[object Object]"===String(e)?"":e}generateExportData(e){const t=this,{rows:r,columns:n}=t.exporter.export(e.exporterConfig);return{rows:r.map((r=>r.map(((r,i)=>{var s;r instanceof Date?r=DateHelper.format(r,e.dateFormat):"boolean"==typeof r&&(r=new BooleanUnicodeSymbol(r)),t.convertEmptyValueToEmptyString&&(r=t.processValue(r));return{value:r,type:"number"===(null==(s=n[i])?void 0:s.type)?"number":"string"}})))),columns:n.map((e=>{let{field:t,value:r,width:n,type:i}=e;return i="string",{field:t,value:r,width:n,type:i}}))}}export(e={}){const t=this,r=t.zipcelx||globalThis.zipcelx;if(!r)throw new Error('ExcelExporter: "zipcelx" library is required');if(t.disabled)return;(e=ObjectHelper.assign({},t.config,e)).filename||(e.filename=t.client.$$name);const{filename:n}=e,{rows:i,columns:s}=t.generateExportData(e);return r({filename:n,sheet:{data:[s].concat(i),cols:s}})}construct(e,t){super.construct(e,t),this.zipcelx||"undefined"!=typeof zipcelx&&(this.zipcelx=globalThis.zipcelx)}get exporter(){const e=this;return e._exporter||(e._exporter=e.exporterClass.new({target:e.client},e.exporterConfig))}};ExcelExporter._$name="ExcelExporter",GridFeatureManager.registerFeature(ExcelExporter,!1,"Grid");var Bar=class extends Widget{static get $name(){return"Bar"}static get type(){return"gridbar"}static get defaultConfig(){return{htmlCls:"",scrollable:{overflowX:"hidden-scroll"}}}get columns(){return this._columns||this.subGrid.columns}set columns(e){this._columns=e}fixCellWidths(){const e=this,{hasFlex:t}=e.columns;let r;e.columns.traverse((t=>{const n=e.getBarCellElement(t.id),i=DomHelper.setLength(t.width),s=DomHelper.setLength(t.minWidth),a=DomHelper.setLength(t.maxWidth);if(n){if(r=i,n.style.maxWidth=a,t.isParent&&null==t.width&&null==t.flex){const e=t.children.reduce(((e,t)=>e+(!t.hidden&&t.flex||0)),0);n.style.flex=e>0?e+" 0 auto":"",n.style.minWidth=null,e>0&&t.traverse((e=>e.data.minWidth=null))}else if(parseInt(t.minWidth)>=0&&(n.style.minWidth=s),n.style.flex=n.style.flexBasis=n.style.width="",t.flex)!isNaN(parseInt(t.flex))&&t.children?n.style.flex=t.flex+" 0 auto":n.style.flex=t.flex;else if(parseInt(t.width)>=0){const s=t.parent;!e.isHeader||s.isRoot||s.width?n.style.flexBasis=r:n.style.width=i}t.height>=0&&(n.style.height=DomHelper.setLength(t.height))}})),e.scrollable.element.classList.toggle("b-has-flex",t)}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector('[data-column-id="'+e+'"]')}};Bar.initClass(),Bar._$name="Bar";var Footer=class extends Bar{static get $name(){return"Footer"}static get type(){return"gridfooter"}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}onPaint({firstPaint:e}){e&&this.refreshContent()}template(){const e=this.subGrid.region;return TemplateHelper.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-
    ${e}" role="presentation">
                <div data-reference="footersElement" class="b-grid-footers b-grid-footers-
    ${e}" data-region="${e}" role="presentation"></div>
            </div>
        
    `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map((e=>TemplateHelper.tpl`
                <div
                    class="b-grid-footer 
      ${e.align?"b-grid-footer-align-"+e.align:""} ${e.cls||""}"
                    data-column="
      ${e.field||""}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    role="presentation">
                    
      ${e.footerText||""}
                </div>
      `)).join("")}fixFooterWidths(){this.fixCellWidths()}};Footer.initClass(),Footer._$name="Footer";var RowManager=class extends InstancePlugin{static get pluginConfig(){return{chain:["destroy"],assign:["rowHeight","topRow","bottomRow","firstVisibleRow","lastVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","getRowById","getRecordCoords","getRow","getRowFor","getRowFromElement"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,fixedRowHeight:null,autoHeight:!1}}static get properties(){return{idMap:{},topIndex:0,lastScrollTop:0,_rows:[],heightMap:new Map,totalKnownHeight:0,_totalHeight:0,averageRowHeight:0,scrollTargetRecordId:null,refreshDetails:{topRowIndex:0,topRowTop:0}}}construct(e){e.grid._rowManager=this,super.construct(e.grid,e)}doDestroy(){this._rows.forEach((e=>e.destroy())),super.doDestroy()}initWithHeight(e,t=!1){const r=this;return r.autoHeight&&(e=r.store.allCount*r.preciseRowOffsetHeight),r.viewHeight=e,r.calculateRowCount(t),e}reinitialize(e=!1){const t=this;t.calculateRowCount(!1,!0,!0),t.topIndex+t.rowCount-1>t.store.count&&(e=!0);const r=t.topRow&&!e?t.topRow.top:0;t.scrollTargetRecordId=null,e&&(t.topIndex=t.lastScrollTop=0);const{topRow:n}=t;n&&(n.dataIndex=t.topIndex,n.setTop(r,!0)),t.estimateTotalHeight(),t.renderFromRow(n)}matchRowCount(e=!1){var t,r;const n=this,{rows:i,grid:s}=n,a=i.length,o=a-n.rowCount;if(o)if(o<0){const t=[];for(let e=a,r=a?i[a-1].dataIndex+1:0;e<n.rowCount;e++,r++)t.push(new Row({cls:s.rowCls,rowManager:n,grid:s,index:e,dataIndex:r}));i.push.apply(i,t),n.trigger("addRows",{rows:t}),e||n.renderFromRow(i[Math.max(0,a-1)])}else{const{focusedCell:e}=s,l=null!=(null==e?void 0:e.id)&&(null==(t=null==e?void 0:e.cell)?void 0:t.contains(DomHelper.getActiveElement(s))),c=i.splice(a-o,o);l&&(o===a?s.onFocusedRowDerender():(null==(r=n.getRowFor(e._record))?void 0:r.index)>=i.length&&i[i.length-1].cells[e.columnIndex].focus()),n.trigger("removeRows",{rows:c}),c.forEach((e=>e.destroy()))}}calculateRowCount(e=!1,t=!0,r=!1){var n,i;const s=this,{store:a}=s,o=Math.ceil(s.viewHeight/s.minRowOffsetHeight),l=o+s.prependRowBuffer+s.appendRowBuffer;if(!(null==(n=s.grid.columns)?void 0:n.count)||isNaN(o))return s.rowCount=0,0;if(l<s.rowCount&&!t)return s.rowCount;if(s.visibleRowCount=o,s.rowCount=Math.min(a.count,l),!e){if(s.rows&&s.rowCount!==s.rows.length){if(s.matchRowCount(r),(null==(i=s.bottomRow)?void 0:i.dataIndex)>=a.count&&0!==s.topRow.dataIndex){const e=s.bottomRow.dataIndex-a.count+1;for(const t of s.rows)t.dataIndex-=e;s.topIndex-=e}}else s.rowCount||s.trigger("changeTotalHeight",{totalHeight:s.totalHeight});s.grid.toggleEmptyText()}return s.rowCount}removeAllRows(){const e=this,{topRow:t}=e,r=t?e.refreshDetails={topRowIndex:t.dataIndex,topRowTop:t.top}:e.refreshDetails,n=e.rows.slice();return e.trigger("removeRows",{rows:n}),e.rows.forEach((e=>e.destroy())),e.rows.length=0,e.idMap={},r}setPosition(e){const{topRow:t}=this,{topRowIndex:r,topRowTop:n}=e;t.setTop(n),t.dataIndex=r}get store(){return this.client.store}get rows(){return this._rows}getRow(e){if(this.rowCount)return this.rows[e-this.topIndex]}getRowById(e){return e&&e.isModel&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=Rectangle.from(this.grid.bodyContainer,null,!0).roundPx(1).top,e+=this.grid.scrollable.y),e=DomHelper.roundPx(e),this.rows.find((t=>e>=t.top&&e<t.bottom))}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){const t="number"==typeof e?e:e.index;return this.getRow((t+1)%this.rowCount)}get topRow(){return this.rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}get firstVisibleRow(){return this.rows.find((e=>e.bottom>Math.ceil(this.grid.scrollable.y)))}get firstFullyVisibleRow(){return this.rows.find((e=>e.top>=Math.ceil(this.grid.scrollable.y)))}get lastVisibleRow(){const{grid:e}=this;return ArrayHelper.findLast(this.rows,(t=>t.top<e.scrollable.y+e.bodyHeight))}get lastFullyVisibleRow(){const{grid:e}=this;return ArrayHelper.findLast(this.rows,(t=>t.bottom<e.scrollable.y+e.bodyHeight))}offsetRows(e){if(0!==e){const{rows:t}=this,{length:r}=t;for(let n=0;n<r;n++)t[n].offset(e)}this.trigger("offsetRows",{offset:e})}get prependBufferHeight(){return this.prependRowBuffer*this.rowOffsetHeight}get appendBufferHeight(){return this.appendRowBuffer*this.rowOffsetHeight}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:r,fixedRowHeight:n}=t,i=t.rowHeight;if(i!==e){if(ObjectHelper.assertNumber(e,"rowHeight"),e<10&&(e=10),t.trigger("beforeRowHeight",{height:e}),t.minRowHeight=t._rowHeight=e,n&&(t.averageRowHeight=e),t.rows.length){const s=r.scrollable.y,a=t.getRowAt(s,!0),o=a?a.top-s:0;let l,c;n?(l=e,c=i):(c=l=t.averageRowHeight,t.clearKnownHeights(),l*=e/i),t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*(l+r._rowBorderHeight),!0),t.refresh();s*(l/c)!==s&&r.scrollRowIntoView(a.id,{block:"start",edgeOffset:o})}t.trigger("rowHeight",{height:e,oldHeight:i})}}get rowOffsetHeight(){return Math.floor(this.preciseRowOffsetHeight)}get preciseRowOffsetHeight(){return(this.averageRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get minRowOffsetHeight(){return(this.minRowHeight||this._rowHeight)+this.grid._rowBorderHeight}get allHeightsKnown(){return this.fixedRowHeight||this.heightMap.size>=this.store.count}storeKnownHeight(e,t){const r=this,{heightMap:n}=r;r.fixedRowHeight||(n.has(e)&&(r.totalKnownHeight-=n.get(e)),n.set(e,t),r.totalKnownHeight+=t,t<r.minRowHeight&&(r.minRowHeight=t),r.averageRowHeight=r.totalKnownHeight/n.size)}getOffsetHeight(e){const t=this;return(e&&t.heightMap.get(e.id)||e&&t.grid.getRowHeight(e)||t.averageRowHeight||t.rowHeight)+t.grid._rowBorderHeight}invalidateKnownHeight(e){const t=this;if(!t.fixedRowHeight){const{heightMap:r}=t;(e=ArrayHelper.asArray(e)).forEach((e=>{e&&r.has(e.id)&&(t.totalKnownHeight-=r.get(e.id),r.delete(e.id))})),t.averageRowHeight=t.totalKnownHeight/r.size}}clearKnownHeights(){this.heightMap.clear(),this.averageRowHeight=this.totalKnownHeight=0}calculateTop(e){if(this.fixedRowHeight)return e*this.rowOffsetHeight;const{store:t}=this;let r=0;for(let n=0;n<e;n++){const e=t.getAt(n);r+=this.getOffsetHeight(e)}return Math.floor(r)}getRecordCoords(e,t=!1,r=!1){const n=this,i=n.getRowById(e);let s=n.client._bodyRectangle;return t||(s=n.client.refreshBodyRectangle()),i?new Rectangle(s.x,t?Math.round(i.top):Math.round(i.top+s.y-n.client.scrollable.y),s.width,i.offsetHeight):n.getRecordCoordsByIndex(n.store.indexOf(e),t,r)}getRecordCoordsByIndex(e,t=!1,r=!1){const n=this,{topRow:i,bottomRow:s}=n,a=n.client._bodyRectangle,{id:o}=n.store.getAt(e),l=n.preciseRowOffsetHeight,c=i.dataIndex,d=s.dataIndex,u=e>d?{index:e-d-1,y:s.bottom,from:"bottomRow"}:e>c/2?{index:e-c,y:i.top,from:"topRow"}:{index:e,y:0,from:"top"},h=n.allHeightsKnown&&!r?n.calculateTop(e):Math.floor(u.y+u.index*l),g=new Rectangle(a.x,t?h:h+a.y-n.client.scrollable.y,a.width,Math.floor(n.heightMap.get(o)||l));return g.virtual=!0,g.block=g.bottom<a.y?"start":g.y>a.bottom?"end":"nearest",g}get totalHeight(){return this._totalHeight}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}refreshCell(e,t){const r=new Location({grid:this.grid,record:e,columnId:t});return Boolean(r.cell&&r.row.renderCell(r))}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow&&(e.topRow.dataIndex=0,e.topRow.setTop(0,!0)),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{rows:r,store:n}=t,i=n.count;if(0===t.calculateRowCount(!1,i<r.length,!0))return void t.estimateTotalHeight(!0);const s=e?r.indexOf(e):0;let a=e?e.dataIndex:r[0].dataIndex;const o=i-a-1,l=Math.min(r.length-1,s+o);let c,d=r.length-l-1,u=s>0?r[s-1].bottom:r[s].top;for(let e=s;e<=l;e++)c=r[e],c.dataIndex=a,c.setTop(u,!0),c.render(a,n.getAt(a++),!1),u+=c.offsetHeight;for(;d-- >0;)t.displayRecordAtTop();t.bottomRow.bottom<t.viewHeight&&t.calculateRowCount(),t.estimateTotalHeight(!0),t.trigger("renderDone")}renderRows(e){let t,r=!1;(e=Array.from(e)).sort(((e,t)=>e.dataIndex-t.dataIndex));for(const n of e)t=n.height,n.render(null,null,!1),r|=n.height!==t;r&&this.translateFromRow(e[0]),this.trigger("renderDone")}translateFromRow(e,t=!1){const r=this;let n,i,s=e.bottom;for(i=e.dataIndex+1,n=r.getRow(i);n;n=r.getRow(++i))s=n.translate(s);t||r.estimateTotalHeight(!0)}refresh(){const e=this,{topRow:t}=e;t&&!e.grid.refreshSuspended&&(e.idMap={},e.renderFromRow(t),e.trigger("refresh"))}jumpToPosition(e,t){const r=this,{store:n,heightMap:i}=r,s=n.count;if(r.allHeightsKnown&&!r.fixedRowHeight){const t=e-r.prependBufferHeight,a=r.grid._rowBorderHeight;let o=0,l=0;for(;o<t;){const e=n.getAt(l);o+=i.get(e.id)+a,l++}const c=Math.max(Math.min(l,s-r.rowCount),0);r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=c,r.topRow.setTop(r.calculateTop(c),!1),r.refresh()}else{const n=r.preciseRowOffsetHeight,i=null==t?Math.floor(e/n)-r.prependRowBuffer:t-Math.floor(r.rowCount/2),a=Math.max(Math.min(i,s-r.rowCount),0),o=r.client.scrollable.y,l=Math.min(r.client._bodyRectangle.height+o+r.appendBufferHeight,r.totalHeight);if(r.lastScrollTop=e,r.topRow.dataIndex=r.topIndex=a,r.topRow.setTop(Math.floor(a*n),!1),r.refresh(),r.bottomRow.bottom<l)for(r.calculateRowCount(!1,!1,!1);r.bottomRow.bottom<l&&r._rows[r.prependRowBuffer].top<o&&r.bottomRow.dataIndex<s-1;)r.displayRecordAtBottom();r.estimateTotalHeight()}if(null!=t){const{scrollable:n}=r.grid,i=r.getRow(t),s=i&&Rectangle.from(i._elementsArray[0]).center.y,a=n.viewport.center.y;i&&(n.y=e=Math.floor(n.y+(s-a)))}return e}warpIfNeeded(e){const t=this,r={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(r.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let n;t.scrollTargetRecordId&&(n=t.store.indexOf(t.scrollTargetRecordId)),t.grid.onFocusedRowDerender(),r.newScrollTop=t.jumpToPosition(e,n),r.deltaTop=0}return r}updateRenderedRows(e,t,r=!1){const n=this,i=n.client._bodyRectangle;if(0===n.rowCount)return 0;let s=n.totalHeight;if(t||Math.abs(e-n.lastScrollTop)>=n.rowOffsetHeight||n.topRow.top>e||n.bottomRow.bottom<e+i.height){const t=n.warpIfNeeded(e);n.scrollTargetRecordId=null,n.lastScrollTop=t.newScrollTop,t.deltaTop>0?n.fillBelow(t.newScrollTop):t.deltaTop<0&&n.fillAbove(t.newScrollTop),n.fixedRowHeight||r||n.correctError(t,i,e),s=n.estimateTotalHeight()}return s}correctError(e,t,r){const n=this;let i=0;(n.allHeightsKnown||e.deltaTop<0&&r<2*t.height||e.deltaTop>0&&r>n.totalHeight-2*t.height-3)&&(i=n.topRow.top-n.calculateTop(n.topRow.dataIndex)),i&&(n.offsetRows(-i),n.grid.scrollable.y=n.lastScrollTop=n.grid.scrollable.y-i)}fillAbove(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight;let n=0;for(;n>r&&t.topIndex>0;)n-=t.displayRecordAtTop();t.trigger("renderDone")}fillBelow(e){const t=this,r=e-t.topRow.top-t.prependBufferHeight,n=t.store.count,i=t.rowCount;let s=0;for(;s<r&&t.topIndex+i<n&&t.topRow.top+t.topRow.offsetHeight<e;)s+=t.displayRecordAtBottom();t.trigger("renderDone")}estimateTotalHeight(e=!1){const t=this;if(t.grid.renderingRows)return;const r=t.store.count,n=r-t.heightMap.size,{bottomRow:i}=t;let s;if(t.fixedRowHeight)s=r*t.rowOffsetHeight;else{if(s=t.totalKnownHeight+t.heightMap.size*t.grid._rowBorderHeight+n*t.preciseRowOffsetHeight,i&&n){const e=i.bottom;(e>s||t.topIndex+t.rowCount>=r&&s>e&&e>0)&&(s=e,i.dataIndex<r-1&&(s+=(r-1-i.dataIndex)*t.preciseRowOffsetHeight))}s=Math.floor(s)}return s!==t.totalHeight&&!1!==t.trigger("changeTotalHeight",{totalHeight:s,immediate:e})&&(t._totalHeight=s),s}displayRecordAtTop(){var e;const t=this,{grid:r}=t,n=t.topIndex-1,i=t.store.getAt(n),s=t.bottomRow,a=s.top;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null==(e=r.focusedCell)?void 0:e.rowIndex)&&r.onFocusedRowDerender(),s._top=t.topRow.top-t.getOffsetHeight(i),s.estimatedTop=!t.fixedRowHeight,s.render(n,i,!1),s._top=a,s.setBottom(t.topRow.top),s.estimatedTop=!1,t.topIndex--,t._rows.unshift(t._rows.pop()),s.offsetHeight}displayRecordAtBottom(){var e;const t=this,{grid:r}=t,n=t.topIndex+t.rowCount,i=t.store.getAt(n),s=t.topRow;return t.trigger("beforeTranslateRow",{row:s,newRecord:i}),s.dataIndex===(null==(e=r.focusedCell)?void 0:e.rowIndex)&&r.onFocusedRowDerender(),s.dataIndex=n,s.setTop(t.bottomRow.bottom),s.render(n,i,!1),t.topIndex++,t._rows.push(t._rows.shift()),s.offsetHeight}};RowManager.featureClass="",RowManager._$name="RowManager";var xAxis2={x:1},GridScroller=class extends Scroller{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=xAxis2){"string"==typeof t&&(t={[t]:1}),t.x&&(e.owner.initScroll(),this.xScrollers.forEach(((t,r)=>t.addPartner(e.xScrollers[r],"x")))),t.y&&super.addPartner(e,"y")}removePartner(e){this.xScrollers.forEach(((t,r)=>{t.isDestroyed||t.removePartner(e.xScrollers[r])})),super.removePartner(e)}updateOverflowX(e){var t;const r=!1===e;null==(t=this.xScrollers)||t.forEach((e=>e.overflowX=r?"hidden":"hidden-scroll")),this.widget.virtualScrollers.classList.toggle("b-hide-display",r)}scrollIntoView(e,t){if(e.nodeType!==Element.ELEMENT_NODE||!this.element.contains(e))return super.scrollIntoView(e,t);for(const r of this.xScrollers)if(r.element.contains(e))return r.scrollIntoView(e,t)}hasOverflow(e="y"){return"y"===e&&this.scrollHeight>this.clientHeight}set x(e){this.xScrollers&&(this.xScrollers[0].x=e)}get x(){return this.xScrollers?this.xScrollers[0].x:0}};GridScroller._$name="GridScroller";var Header=class extends Bar{get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}get region(){var e;return null==(e=this.subGrid)?void 0:e.region}changeElement(e,t){const{region:r}=this;return this.getConfig("columns"),super.changeElement({className:{"b-grid-header-scroller":1,["b-grid-header-scroller-"+r]:r},children:[{reference:"headersElement",className:{"b-grid-headers":1,["b-grid-headers-"+r]:r},dataset:{region:r,reference:"headersElement",maxDepth:this.maxDepth}}]},t)}get overflowElement(){return this.headersElement}getColumnConfig(e){const{id:t,align:r,resizable:n,isLeaf:i,isParent:s,isLastInSubGrid:a,cls:o,childLevel:l,field:c,tooltip:d,children:u,isFocusable:h,grid:g}=e,p=null==g?void 0:g.focusedCell,m=-1===(null==p?void 0:p.rowIndex)&&(null==p?void 0:p.column)===e;if(e.isVisible)return{className:{"b-grid-header":1,"b-grid-header-parent":s,["b-level-"+l]:1,["b-depth-"+e.meta.depth]:1,["b-grid-header-align-"+r]:r,"b-grid-header-resizable":n&&i,[o]:o,"b-collapsible":e.collapsible,"b-last-parent":s&&a,"b-last-leaf":i&&a},role:h?"columnheader":"presentation","aria-sort":"none","aria-label":e.ariaLabel,[h?"tabIndex":""]:m?0:-1,dataset:{...Tooltip.encodeConfig(d),columnId:t,[c?"column":""]:c},children:[{className:"b-grid-header-text",children:[{[g&&h?"id":""]:(null==g?void 0:g.id)+"-column-"+e.id,className:"b-grid-header-text-content"}]},u?{className:"b-grid-header-children",children:u.map((e=>this.getColumnConfig(e))),syncOptions:{syncIdField:"columnId"}}:null,{className:"b-grid-header-resize-handle"}]}}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach((t=>{e+=t.calculateMinWidth()})),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse((t=>{const r=e.getBarCellElement(t.id);if(r){let n=t.headerText;t.headerRenderer&&(n=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:r})),t.headerWidgetMap&&Object.values(t.headerWidgetMap).forEach((e=>{e.render(t.textWrapper)})),t.icon&&(n='<i class="'+StringHelper.encodeHtml(t.icon)+'"></i>'+(n||""));const i=r.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=n||"")}})),e.fixHeaderWidths()}get columns(){const e=this,t=super.columns;return e.columnsDetacher||(e.columnsDetacher=t.ion({change(){e.initDepths()},thisObj:e}),e.initDepths()),t}set columns(e){super.columns=e}initDepths(e=this.columns.topColumns,t=null){const r=this;let n=0;(null==t?void 0:t.meta)&&t.meta.depth++;for(const i of e){const{meta:e}=i;e.depth=0,i.children&&(r.initDepths(i.children.filter(r.columns.chainedFilterFn),i),e.depth&&t&&(t.meta.depth+=e.depth)),e.depth>n&&(n=e.depth)}return t||(r.maxDepth=n),n}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;DomSync.sync({domConfig:{children:e.columns.topColumns.map((t=>e.getColumnConfig(t))),onlyChildren:!0},targetElement:e.contentElement,strict:!0,syncIdField:"columnId",releaseThreshold:0}),e.refreshHeaders()}onPaint({firstPaint:e}){e&&this.refreshContent()}};__publicField(Header,"$name","Header"),__publicField(Header,"type","gridheader"),Header.initClass(),Header._$name="Header";var gridBodyElementEventHandlers={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",pointerover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",pointerdown:"onElementPointerDown",pointerup:"onElementPointerUp"},eventProps=["pageX","pageY","clientX","clientY","screenX","screenY"];function toggleHover(e,t=!0){null==e||e.classList.toggle("b-hover",t)}function setCellHover(e,t,r=!0){t&&e&&toggleHover(t.getCell(e),r)}var GridElementEvents_default=e=>class extends(e||Base){static get $name(){return"GridElementEvents"}static get configurable(){return{hoveredCell:null,longPressTime:400,enableUndoRedoKeys:!0,keyMap:{"Ctrl+z":"undoRedoKeyPress","Ctrl+Shift+z":"undoRedoKeyPress"," ":{handler:"clickCellByKey",weight:1e3}}}}initInternalEvents(){const e=Object.keys(gridBodyElementEventHandlers),t=e.length,r={element:this.bodyElement,thisObj:this};for(let n=0;n<t;n++){const t=e[n];r[t]={handler:"handleEvent"},t.startsWith("touch")&&(r[t].passive=!1)}EventHelper.on(r),EventHelper.on({focusin:"onGridBodyFocusIn",element:this.bodyElement,thisObj:this,capture:!0})}getCellDataFromEvent(e,t=!1){var r;const n=this,{columns:i}=n,{target:s}=e;let a=s.closest(".b-grid-cell");if(!a&&t&&!s.classList.contains("b-grid-row")&&!s.classList.contains("b-grid-subgrid")){const{top:t,left:s,right:o,bottom:l}=n.bodyContainer.getBoundingClientRect();let c,{x:d,y:u}=e;d>=s&&d<=o?u=c=Math.ceil(n[(u<t?"first":"last")+"FullyVisibleRow"].element.getBoundingClientRect().y):u>=t&&u<=l&&(d=c=Math.ceil(i.visibleColumns[d<s?0:i.visibleColumns.length-1].element.getBoundingClientRect().x)),void 0!==c&&(a=null==(r=DomHelper.childFromPoint(e.target,e.offsetX,e.offsetY))?void 0:r.closest(".b-grid-cell"))}if(a){const e=DomDataStore.get(a),{id:t,columnId:r}=e,s=n.store.getById(t),o=i.getById(r);return s?{cellElement:a,cellData:e,columnId:r,id:t,record:s,column:o,cellSelector:{id:t,columnId:r}}:null}}getHeaderDataFromEvent(e){const t=e.target.closest(".b-grid-header");if(t){const e=ObjectHelper.assign({},t.dataset),{columnId:r}=e,n=this.columns.getById(r);return n?{headerElement:t,headerData:e,columnId:r,column:n}:null}}handleEvent(e){!this.disabled&&gridBodyElementEventHandlers[e.type]&&this[gridBodyElementEventHandlers[e.type]](e)}onElementTouchStart(e){const t=this,r=t.getCellDataFromEvent(e);DomHelper.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=t.setTimeout((()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0}),t.longPressTime)),r&&!e.defaultPrevented&&t.onFocusGesture(e)}onElementTouchMove(e){const t=this,{lastTouchTarget:r}=t,n=e.changedTouches[0],{pageX:i,pageY:s}=n,a=document.elementFromPoint(i,s);if(t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null),a!==r){if(r){const t=new MouseEvent("mouseout",ObjectHelper.copyProperties({relatedTarget:a,pointerType:"touch",bubbles:!0},n,eventProps));t.preventDefault=()=>e.preventDefault(),null==r||r.dispatchEvent(t)}if(a){const t=new MouseEvent("mouseover",ObjectHelper.copyProperties({relatedTarget:r,pointerType:"touch",bubbles:!0},n,eventProps));t.preventDefault=()=>e.preventDefault(),null==a||a.dispatchEvent(t)}}t.lastTouchTarget=a}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(t.clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t,r=this.getCellDataFromEvent(t)){var n;const i=this;if(r){const s=i.columns.getById(r.columnId),a={grid:i,record:r.record,column:s,cellSelector:r.cellSelector,cellElement:r.cellElement,target:t.target,event:t};i.trigger("cell"+StringHelper.capitalize(e),a),"click"===e&&(null==(n=s.onCellClick)||n.call(s,a))}}onElementMouseDown(e){const t=this,r=t.getCellDataFromEvent(e);t.skipFocusSelection=!0,t.isScrollbarOrRowBorderOrSplitterClick(e)?e.preventDefault():(t.triggerCellMouseEvent("mousedown",e,r),r&&!e.defaultPrevented&&t.onFocusGesture(e))}isScrollbarOrRowBorderOrSplitterClick({target:e,x:t,y:r}){if(e.closest(".b-grid-splitter")||e.matches(".b-grid-row, .b-virtual-width"))return!0;if(e.matches(".b-vertical-overflow")){return t>e.getBoundingClientRect().right-DomHelper.scrollBarWidth}if(e.matches(".b-horizontal-overflow")){return r>e.getBoundingClientRect().bottom-DomHelper.scrollBarWidth-1}}onElementMouseMove(e){this.mouseMoveEvent=e}onElementMouseUp(e){}onElementPointerDown(e){}onElementPointerUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this,r=t.getCellDataFromEvent(e);r&&t.triggerCellMouseEvent("click",e,r)}onFocusGesture(e){var t;const r=this,{navigationEvent:n}=r,{target:i}=e,s=2===e.button,a=!s&&i.matches(".gt-icon-tree-expand, .gt-icon-tree-collapse"),o=!document.hasFocus()&&BrowserHelper.isMac&&s;if(a||o)e.preventDefault();else{r.navigationEvent=e;const a=new Location(i);if(s||(null==(t=r.focusedCell)?void 0:t.equals(a))){let t;globalThis.TouchEvent&&e instanceof MouseEvent&&n instanceof TouchEvent&&i===n.target&&(t={doSelect:!1}),r.focusCell(a,t)}}}onElementDblClick(e){const{target:t}=e;if(this.triggerCellMouseEvent("dblClick",e),t.classList.contains("b-grid-header-resize-handle")){const e=t.closest(".b-grid-header");this.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){var t;if(!this.scrolling){const r=("number"!=typeof e.buttons||0===e.buttons)&&"touch"!==e.pointerType;let n=e.target.closest(".b-grid-cell");!n&&e.target.classList.contains("b-grid-row")&&(n=null==(t=DomHelper.childFromPoint(e.target,e.offsetX,e.offsetY-2))?void 0:t.closest(".b-grid-cell")),n&&(r&&(this.hoveredCell=n),this.triggerCellMouseEvent("mouseOver",e)),this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){const{target:t,relatedTarget:r}=e;if((null==r?void 0:r.closest(".b-grid-cell"))&&t.matches(".b-grid-row")||(r&&t.matches(".b-grid-cell")&&!t.contains(r)?(null==r?void 0:r.matches(".b-grid-row"))||(this.hoveredCell=r.closest(".b-grid-cell")):(null==r?void 0:r.matches(".b-grid-row,.b-grid-cell"))||(this.hoveredCell=null)),!this.scrolling){t.closest(".b-grid-cell")&&this.triggerCellMouseEvent("mouseOut",e),this.trigger("mouseOut",{event:e})}}updateHoveredCell(e,t){var r,n,i,s;const a=this,{selectionMode:o}=a,l=o.rowNumber&&(null==(r=a.columns.find((e=>"rownumber"==e.type)))?void 0:r.id),c=o.checkbox&&(null==(n=a.checkboxSelectionColumn)?void 0:n.id);if(t){toggleHover(t,!1);const e=DomDataStore.get(t),{row:r}=e;r&&!r.isDestroyed&&(setCellHover(l,r,!1),setCellHover(c,r,!1)),(null==e?void 0:e.columnId)&&toggleHover(null==(i=a.columns.getById(e.columnId))?void 0:i.element,!1)}if(a._hoveredRow&&!a._hoveredRow.isDestroyed&&a._hoveredRow.removeCls("b-hover"),a._hoveredRow=null,e&&!a.scrolling){const t=DomDataStore.get(e),{row:r}=t;r?o.cell&&t.columnId!==l&&t.columnId!==c?(toggleHover(e),setCellHover(c,r),setCellHover(l,r),toggleHover(null==(s=a.columns.getById(t.columnId))?void 0:s.element)):(a._hoveredRow=r,r.addCls("b-hover")):a.hoveredCell=null}}keyMapOnKeyDown(e){this.onElementKeyDown(e),super.keyMapOnKeyDown(e)}onElementKeyDown(e){var t,r;if(e.handled)return;const n=this,i=n.focusedCell;if((null==i?void 0:i.isCell)&&!i.isActionable){const s=i.cell;null==(r=(t=n.columns.getById(s.dataset.columnId)).onCellKeyDown)||r.call(t,{event:e,cellElement:s})}}undoRedoKeyPress(e){var t;const{stm:r}=this.store;return!(!r||!this.enableUndoRedoKeys||(null==(t=this.features.cellEdit)?void 0:t.isEditing))&&(r.onUndoKeyPress(e),!0)}clickCellByKey(e){const t=this,r=t.focusedCell,n=null==r?void 0:r.cell,i=t.columns.getById(n.dataset.columnId);return!(!(null==r?void 0:r.isCell)||r.isActionable||!i.onCellClick)&&(i.onCellClick({grid:t,column:i,record:t.store.getById(r.id),cellElement:n,target:e.target,event:e}),!0)}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this,r=t.getCellDataFromEvent(e);r&&(t.triggerCellMouseEvent("contextMenu",e,r),DomHelper.isTouchEvent&&t.onFocusGesture(e))}onInternalResize(e,t,r,n,i){const s=this;s._devicePixelRatio&&s._devicePixelRatio!==globalThis.devicePixelRatio&&DomHelper.resetScrollBarWidth(),s._devicePixelRatio=globalThis.devicePixelRatio,s._bodyRectangle=Rectangle.client(s.bodyContainer),super.onInternalResize(...arguments),r!==i&&(s._bodyHeight=s.bodyContainer.offsetHeight,s.isPainted&&s.rowManager.initWithHeight(s._bodyHeight)),s.refreshVirtualScrollbars(),t!==n&&s.setTimeout((()=>{s.isDestroyed||s.updateResponsive(t,n)}),0)}get widgetClass(){}},validConfigTypes={string:1,object:1,function:1},GridFeatures_default=e=>class extends(e||Base){static get $name(){return"GridFeatures"}set features(e){const t=this,r=GridFeatureManager.getInstanceDefaultFeatures(this);e=t._features=ObjectHelper.assign({},e),r&&Object.keys(r).forEach((t=>{t in e||(e[t]=!0)}));const n=GridFeatureManager.getInstanceFeatures(this);for(const r of Object.keys(e)){const i=e[r];if(i){const s=!globalThis.__gantt_code_editor_changed;if(StringHelper.uncapitalize(r)!==r){const e='无效的功能名称"'+r+'"，必须以小写字母开头';if(s)throw new Error(e);console.error(e),t._errorDuringConfiguration=e}const a=n[r];if(!a){const e='功能"'+r+'"不可用，请确保已导入';if(s)throw new Error(e);return console.error(e),void(t._errorDuringConfiguration=e)}Reflect.defineProperty(e,r,t.createFeatureInitializer(e,r,a,i))}}}get features(){return this._features}createFeatureInitializer(e,t,r,n){const i=[this],s=r.prototype.construct;return!0===n&&(n={}),validConfigTypes[typeof n]&&(i[1]=n),{configurable:!0,get:()=>(delete e[t],r.prototype.construct=function(...n){e[t]=this,s.apply(this,n),r.prototype.construct=s},new r(...i))}}hasFeature(e){const{features:t}=this;if(t){const t=Object.getOwnPropertyDescriptor(this.features,e);if(t)return Boolean(t.value||t.get)}return!1}hasActiveFeature(e){var t,r;return Boolean((null==(t=this.features)?void 0:t[e])&&!(null==(r=this.features)?void 0:r[e].disabled))}getConfigValue(e,t){var r,n;if("features"===e){const e={};for(const i in this.features){const s=null==(n=null==(r=this.features[i])?void 0:r.getCurrentConfig)?void 0:n.call(r,t);s?ObjectHelper.isEmpty(s)?GridFeatureManager.isDefaultFeatureForInstance(this.features[i].constructor,this)||(e[i]=!0):e[i]=s:e[i]=!1}return e}return super.getConfigValue(e,t)}get widgetClass(){}},defaultFocusOptions=Object.freeze({}),disableScrolling=Object.freeze({x:!1,y:!1}),containedFocusable=function(e){return this.focusableFinderCell.contains(e)?DomHelper.isFocusable(e)&&!e.disabled?DomHelper.NodeFilter.FILTER_ACCEPT:DomHelper.NodeFilter.FILTER_SKIP:DomHelper.NodeFilter.FILTER_REJECT},GridNavigation_default=e=>{var t;return __publicField(t=class extends(e||Base){static get $name(){return"GridNavigation"}onStoreRecordIdChange(e){var t;null==(t=super.onStoreRecordIdChange)||t.call(this,e);const{focusedCell:r}=this,{oldValue:n,value:i}=e;r&&r.id===n&&(r._id=i)}onFocusedRowDerender(){const e=this,{focusedCell:t}=e;if(null!=(null==t?void 0:t.id)&&t.cell){const r=t.cell.contains(DomHelper.getActiveElement(e));if(e.hideHeaders)r&&e.revertFocus();else{const n=e.normalizeCellContext({rowIndex:-1,columnIndex:r?t.columnIndex:0});r?e.focusCell(n):n.cell.tabIndex=0}t.cell.tabIndex=-1}}navigateFirstCell(){this.focusCell(Location.FIRST_CELL)}navigateFirstColumn(){this.focusCell(Location.FIRST_COLUMN)}navigateLastCell(){this.focusCell(Location.LAST_CELL)}navigateLastColumn(){this.focusCell(Location.LAST_COLUMN)}navigatePrevPage(){this.focusCell(Location.PREV_PAGE)}navigateNextPage(){this.focusCell(Location.NEXT_PAGE)}activateHeader(e){var t;if(e.target.classList.contains("b-grid-header")&&this.focusedCell.isColumnHeader){const{column:r}=this.focusedCell;null==(t=r.onKeyDown)||t.call(r,e),this.getHeaderElement(r.id).click()}return!1}onEscape(e){const{focusedCell:t}=this;!e.target.closest(".b-dragging")&&(null==t?void 0:t.isActionable)&&(e.stopImmediatePropagation(),this._focusedCell=null,this.focusCell({rowIndex:t.rowIndex,column:t.column},{disableActionable:!0}))}onTab(e){const{target:t}=e,{focusedCell:r,bodyElement:n}=this,{isActionable:i,actionTargets:s}=r;if(i&&DomHelper.isEditable(t)&&!t.readOnly&&t===s[s.length-1])e.preventDefault(),this.navigateRight(e);else if(!i||t===s[s.length-1])return n.style.display="none",this.requestAnimationFrame((()=>n.style.display="")),!1}onShiftTab(e){const t=this,{target:r}=e,{focusedCell:n,bodyElement:i}=t,{cell:s,isActionable:a,actionTargets:o}=n,l=a&&DomHelper.isEditable(r)&&!r.readOnly,c=0===n.columnIndex&&n.rowIndex===(t.hideHeaders?0:-1);if(!c&&l&&r===o[0])e.preventDefault(),t.navigateLeft(e);else if(!a||r===o[0]){const e=!c&&!t.hideHeaders&&t.focusCell({rowIndex:-1,column:0},{disableActionable:!0});return e?(e.cell.tabIndex=-1,s.tabIndex=0,t._focusedCell=n):(i.style.display="none",t.requestAnimationFrame((()=>i.style.display=""))),!1}}onSpace(e){return this.focusedCell.isActionable||e.preventDefault(),!1}get focusedCell(){return this._focusedCell}get isActionableLocation(){var e;return null==(e=this._focusedCell)?void 0:e.isActionable}set focusedCell(e){this.focusCell(e)}get focusedRecord(){var e;return null==(e=this._focusedCell)?void 0:e.record}get cellCSSSelector(){const e=this._focusedCell;return e?"[data-index="+e.rowIndex+"] [data-column-id="+e.columnId+"]":""}afterHide(){super.afterHide(...arguments),this.lastFocusedCell=null}isFocused(e){var t;return Boolean(null==(t=this._focusedCell)?void 0:t.equals(this.normalizeCellContext(e)))}get focusElement(){var e;if(!this.isDestroying){let t;t=this.store.count&&this._focusedCell?this._focusedCell.target:this.normalizeCellContext({rowIndex:-1,columnIndex:(null==(e=this._focusedCell)?void 0:e.columnIndex)||0}).target;const r=super.focusElement;return!r||t&&t.compareDocumentPosition(r)!==Node.DOCUMENT_POSITION_PRECEDING?t:r}}onPaint({firstPaint:e}){var t;const r=this;null==(t=super.onPaint)||t.call(this,...arguments);const n=this.normalizeCellContext({rowIndex:r.hideHeaders?0:-1,column:r.hideHeaders?0:r.columns.find((e=>!e.hidden&&e.isFocusable))});if(n.cell){r._focusedCell=n;const{target:e}=n;e===n.cell&&(n.cell.tabIndex=0)}}onGridBodyFocusIn(e){var t,r,n;const i=this,{bodyElement:s}=i,a=i.focusedCell,o=(null==a?void 0:a.initialTarget)||(null==a?void 0:a.target),{target:l,relatedTarget:c}=e,d=l.closest(i.focusableSelector);if(d&&(!GlobalEvents_default.currentMouseDown||GlobalEvents_default.isMouseDown(0)||GlobalEvents_default.isMouseDown(2))){const u=new Location(l),{cell:h}=u,g=null==a?void 0:a.cell,p=u.actionTargets=i.findFocusables(d),m=(!i._fromFocusCell||i.selectOnFocus)&&(l===h||i._selectActionCell)&&!(null==l?void 0:l._isRevertingFocus);if(!i.store.getById(d.parentNode.dataset.id)&&h!==d)return void h.focus({preventScroll:!0});if(l.matches(i.focusableSelector)){if(i.disableActionable)u._target=h;else if(p.length)return i._selectActionCell=(null==(t=GlobalEvents_default.currentMouseDown)?void 0:t.target)===l,p[0].focus(),void delete i._selectActionCell}else{if((null==a?void 0:a.target)&&c&&(!GlobalEvents_default.isMouseDown()||!s.contains(null==(r=GlobalEvents_default.currentMouseDown)?void 0:r.target))&&!s.contains(c)&&!u.equals(a))return void o.focus();u._target=l}if(g&&(g.classList.remove("b-focused"),g.tabIndex=-1),h&&(h.classList.add("b-focused"),u.column.onCellFocus(u),h===l&&(h.tabIndex=0),h.contains(e.relatedTarget)&&o===l))return;i._focusedCell=u,null==(n=i.onCellNavigate)||n.call(i,i,a,u,m),i.trigger("navigate",{lastFocusedCell:a,focusedCell:u,event:e})}else null==o||o.focus()}findFocusables(e){const{focusableFinder:t}=this,r=[];t.currentNode=this.focusableFinderCell=e;for(let e=t.nextNode();e;e=t.nextNode())r.push(e);return r}get focusableFinder(){const e=this;return e._focusableFinder||(e._focusableFinder=e.setupTreeWalker(e.bodyElement,DomHelper.NodeFilter.SHOW_ELEMENT,{acceptNode:containedFocusable.bind(e)})),e._focusableFinder}restoreActiveItem(e=this._focusedCell){if(this.rowManager.count)return isNaN(e)?e.isModel||(e=this.store.getById(e)):e=this.store.getAt(e),this.focusCell(e)}focusCell(e,t=defaultFocusOptions){var r,n;const i=this,{_focusedCell:s}=i,{scroll:a,disableActionable:o}=t;if(-1===(null==e?void 0:e.rowIndex)&&i.hideHeaders)return void i.revertFocus();e="number"==typeof e&&(null==s?void 0:s.isLocation)?s.move(e):i.normalizeCellContext(e);const l="doSelect"in t?t.doSelect:!e.isActionable||e.initialTarget===e.cell;if(e.equals(s))return null==(r=i.onCellNavigate)||r.call(i,i,s,e,l),s;const c=i.getSubGridFromColumn(e.columnId),{cell:d}=e,u=d||i.getCell({rowIndex:i.rowManager.topIndex,columnId:e.columnId}),h=Rectangle.from(c.element),g=Rectangle.from(i.bodyElement),p=Rectangle.from(u).moveTo(null,h.y);return!1===a||-1===e.rowIndex?t=Object.assign({},t,disableScrolling):(t=Object.assign({},t,a),p.width>h.width||p.height>g.height?t.x=t.y=!1:t.column=e.columnId,i.scrollRowIntoView(e.id,t)),(i._hoveredRow||i.hoveredCell)&&(i.hoveredCell=null),i.disableActionable=o,i.selectOnFocus=l,i._fromFocusCell=!0,null==(n=e[o?"cell":"target"])||n.focus({preventScroll:!0}),i.disableActionable=i.selectOnFocus=!1,delete i._fromFocusCell,e}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(e){const t=this;t._focusedCell&&(t.lastFocusedCell=e?null:t._focusedCell,t.blurCell(t._focusedCell),t._focusedCell=null)}internalNextPrevCell(e=!0){const t=this,r=t._focusedCell;return r?t.focusCell({id:r.id,columnId:t.columns.getAdjacentVisibleLeafColumn(r.columnId,e,!0).id}):null}navigateRight(){var e;return(null==(e=arguments[0])?void 0:e.fromKeyMap)?this.focusCell(this.rtl?Location.PREV_CELL:Location.NEXT_CELL):(arguments[0]&&VersionHelper.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(!this.rtl))}navigateLeft(){var e;return(null==(e=arguments[0])?void 0:e.fromKeyMap)?this.focusCell(this.rtl?Location.NEXT_CELL:Location.PREV_CELL):(arguments[0]&&VersionHelper.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevCell(Boolean(this.rtl)))}internalNextPrevRow(e,t=!0,r=!0){const n=this,i=n._focusedCell;if(!i)return!1;const s=n.store["get"+(e?"Next":"Prev")](i.id,!1,t);return s?n.focusCell({id:s.id,columnId:i.columnId,scroll:{x:!1}}):e||!r||i.isColumnHeader?void 0:(this.clearFocus(),this.getHeaderElement(i.columnId).focus())}navigateDown(){var e;return(null==(e=arguments[0])?void 0:e.fromKeyMap)?this.focusCell(Location.DOWN):(arguments[0]&&VersionHelper.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!0,!1))}navigateUp(){var e;return(null==(e=arguments[0])?void 0:e.fromKeyMap)?this.focusCell(Location.UP):(arguments[0]&&VersionHelper.deprecate("Grid","6.0.0","Event argument removed, unused param"),this.internalNextPrevRow(!1,!1))}get widgetClass(){}},"configurable",{focusable:!1,focusableSelector:".b-grid-cell,.b-grid-header.b-depth-0",keyMap:{ArrowUp:{handler:"navigateUp",weight:10},ArrowRight:{handler:"navigateRight",weight:10},ArrowDown:{handler:"navigateDown",weight:10},ArrowLeft:{handler:"navigateLeft",weight:10},"Ctrl+Home":"navigateFirstCell",Home:"navigateFirstColumn","Ctrl+End":"navigateLastCell",End:"navigateLastColumn",PageUp:"navigatePrevPage",PageDown:"navigateNextPage",Enter:"activateHeader",Escape:{handler:"onEscape",weight:10},"Shift+Tab":{handler:"onShiftTab",preventDefault:!1},Tab:{handler:"onTab",preventDefault:!1}," ":{handler:"onSpace",preventDefault:!1}}}),t},GridResponsive_default=e=>class extends(e||Base){static get $name(){return"GridResponsive"}static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){const t=this,r=Object.keys(ObjectHelper.assign({},t.responsiveLevels));let n=null,i=99995,s=null;return r.forEach((r=>{let a=t.responsiveLevels[r];if(["number","string"].includes(typeof a)||(a=a.levelWidth),"*"===a)s=r;else if(e<a){const t=a-e;t<i&&(i=t,n=r)}})),n||s}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const r=this,n=r.getClosestBiggerLevel(t),i=r.getClosestBiggerLevel(e);if(0===t||n!==i){const s=r.responsiveLevels[i];["number","string"].includes(typeof s)||r.applyState(s),r.columns.forEach((e=>{const t=e.responsiveLevels;t&&(t[i]?e.applyState(t[i]):t["*"]&&e.applyState(t["*"]))})),r.element.classList.remove("b-responsive-"+n),r.element.classList.add("b-responsive-"+i),r.trigger("responsive",{level:i,width:e,oldLevel:n,oldWidth:t})}}get widgetClass(){}},validIdTypes={string:1,number:1},isDataLoadAction={dataset:1,batch:1},GridSelection_default=e=>{var t;return __publicField(t=class extends(e||Base){static get $name(){return"GridSelection"}construct(e){this._selectedCells=[],this._selectedRows=[],super.construct(e),(null==e?void 0:e.selectedRecords)&&(this.selectedRecords=e.selectedRecords)}getDefaultGridSelection(e){return"GridSelection"===e.$name?e.configurable.selectionMode:e.superclass?this.getDefaultGridSelection(e.superclass):void 0}changeSelectionMode(e){const t=this;return t.selectionMode?(ObjectHelper.assign(t.selectionMode,e),t.selectionMode):(t.$defaultGridSelection=t.getDefaultGridSelection(t.constructor),new Proxy(e,{set(e,r,n){const i=ObjectHelper.assign({},e);return e[r]=n,t.updateSelectionMode(e,i),!0}}))}updateSelectionMode(e,t=this.$defaultGridSelection){var r,n;const i=this,{columns:s,checkboxSelectionColumn:a}=i,o={},{rowReorder:l}=i.features;for(const r in e)e[r]!=t[r]&&(o[r]=e[r]);e.rowCheckboxSelection&&!e.checkboxOnly&&(e.checkboxOnly=!0,delete e.rowCheckboxSelection),o.column&&(e.cell=!0,e.multiSelect=!0),o.cell&&(e.checkboxOnly=!1),!1===o.cell&&(e.column=!1),o.checkboxOnly&&(e.checkbox||(e.checkbox=!0),e.cell=!1),!1===o.checkbox&&(o.checkboxOnly=!1,o.showCheckAll=!1),o.showCheckAll&&(e.checkbox=e.checkbox||!0,e.multiSelect=!0),(o.includeChildren||o.includeParents)&&(e.multiSelect=!0),!1===o.multiSelect&&(e.column=e.showCheckAll=e.dragSelect=e.includeChildren=e.includeParents=!1),o.dragSelect&&((null==l?void 0:l.enabled)&&!0!==l.gripOnly&&(l.showGrip=l.gripOnly=!0),e.multiSelect=!0,i._selectionListenersDetachers={}),!1===o.dragSelect&&i._selectionListenersDetachers&&(null==(n=(r=i._selectionListenersDetachers).selectiondrag)||n.call(r),delete i._selectionListenersDetachers.selectiondrag),!t||void 0===o.cell&&void 0===o.deselectFilteredOutRecords&&void 0===o.multiSelect||i.deselectAll(),o.rowNumber?s.findRecord("type","rownumber")||(s.insert(0,{..."object"==typeof e.rowNumber?e.rowNumber:{},type:"rownumber"}),i._selectionAddedRowNumberColumn=!0):!1===o.rowNumber&&i._selectionAddedRowNumberColumn&&(s.remove(s.findRecord("type","rownumber")),delete i._selectionAddedRowNumberColumn),(e.checkbox!==(null==t?void 0:t.checkbox)||e.checkbox&&e.showCheckAll!==(null==t?void 0:t.showCheckAll))&&(t&&i.deselectAll(),i.isConfiguring?i.shouldInitCheckboxSelection=!0:i.initCheckboxSelection()),t&&e.checkbox&&t.checkbox&&e.checkboxIndex!==t.checkboxIndex&&a&&a.parent.insertChild(a,s.getAt(i.checkboxSelectionColumnInsertIndex)),i.trigger("selectionModeChange",ObjectHelper.clone(e)),i.afterSelectionModeChange(e)}afterConfigure(){this.shouldInitCheckboxSelection&&(this.shouldInitCheckboxSelection=!1,this.initCheckboxSelection()),super.afterConfigure()}initCheckboxSelection(){var e,t;const r=this,{selectionMode:n,columns:i,checkboxSelectionColumn:s}=r,{checkbox:a}=n;if(s&&(r.checkboxSelectionColumn=null,i.remove(s)),a){const s=ColumnStore.getColumnClass("check"),o=!0===a?null:a;if(!s)throw new Error("CheckColumn must be imported for checkbox selection mode to work");const l=r.checkboxSelectionColumn=new s(ObjectHelper.assign({id:r.id+"-selection-column",width:"4em",minWidth:"4em",field:null,sortable:!1,filterable:!1,hideable:!1,cellCls:"b-checkbox-selection",region:null==(t=null==(e=r.items)?void 0:e[0])?void 0:t.region,showCheckAll:n.showCheckAll,draggable:!1,resizable:!1,widgets:[{type:"checkbox",valueProperty:"checked",ariaLabel:"L{Checkbox.toggleRowSelect}"}]},o),i,{isSelectionColumn:!0});l.meta.depth=0,l._grid=r;const c=l.renderer;l.renderer=e=>{e.value=r.isSelected(e.record),c.call(l,e)},l.ion({toggle:"onCheckChange",toggleAll:"onCheckAllChange",thisObj:r}),i.insert(r.checkboxSelectionColumnInsertIndex,l)}}get checkboxSelectionColumnInsertIndex(){const{columns:e}=this;let{checkboxIndex:t}=this.selectionMode;return t?"string"==typeof t&&(t=e.indexOf(e.getById(t))):t=e.indexOf(e.findRecord("type","rownumber"))+1,t}afterSelectionChange(){}afterSelectionModeChange(){}changeSelectedRecordCollection(e){return e instanceof Collection?e:new Collection(e)}updateSelectedRecordCollection(e){e.ion({change:"onSelectedRecordCollectionChange",thisObj:this})}onSelectedRecordCollectionChange({added:e=[],removed:t}){this.selectedRecordCollection._fromSelection||(e=e.filter((e=>this.isSelectable(e))),this.performSelection({selectedCells:[],deselectedCells:[],selectedRecords:e,deselectedRecords:t}))}changeSelectedRecordCollectionSilent(e){this.selectedRecordCollection._fromSelection=!0;const t=e(this.selectedRecordCollection);return delete this.selectedRecordCollection._fromSelection,t}bindStore(e){var t;this.detachListeners("selectionStoreFilter"),e.ion({name:"selectionStoreFilter",filter:"onStoreFilter",thisObj:this}),null==(t=super.bindStore)||t.call(this,e)}unbindStore(e){this.detachListeners("selectionStoreFilter"),super.unbindStore(e)}onStoreFilter({source:e}){const t=this,r=[];for(const n of t.selectedRows)e.includes(n)||r.push(n);const n=t.prepareSelection(t.selectionMode.deselectFilteredOutRecords?r:[]);if(t.isCellSelectionMode){const{deselectedCells:e}=t.prepareSelection(t.getSelectedCellsForRecords(r));(null==e?void 0:e.length)&&(n.deselectedCells=(n.deselectedCells||[]).concat(e))}(n.deselectedCells.length||n.deselectedRecords.length)&&(t.performSelection(n,!1),t.updateCheckboxHeader())}onStoreRecordIdChange({record:e,oldValue:t}){var r;null==(r=super.onStoreRecordIdChange)||r.call(this,...arguments);this.selectedRecordCollection.get(t)===e&&this.selectedRecordCollection.rebuildIndices()}onStoreRemove(e){var t;if(null==(t=super.onStoreRemove)||t.call(this,e),!e.isCollapse){const t=this,r=e.records.filter((e=>this.isSelected(e)));if(r.length){const e=t.prepareSelection(r);if(t.isCellSelectionMode){const{deselectedCells:n}=t.prepareSelection(t.getSelectedCellsForRecords(r));(null==n?void 0:n.length)&&(e.deselectedCells=(e.deselectedCells||[]).concat(n))}t.performSelection(e)}}}onStoreDataChange({action:e,source:t}){var r;const n=this,{selectionMode:i}=n;let s;if(null==(r=super.onStoreDataChange)||r.call(this,...arguments),"pageLoad"===e)i.preserveSelectionOnPageChange||(s=n.prepareSelection(null,null,!0)),n.updateCheckboxHeader();else if(isDataLoadAction[e]){const e=[];if(!1===i.preserveSelectionOnDatasetChange)s=n.prepareSelection(null,null,!0);else{e.push(...n.changeSelectedRecordCollectionSilent((e=>e.match(t.storage))));for(const r of n._selectedCells)t.getById(r.id)||e.push(r);s=n.prepareSelection(e)}}s&&(n.performSelection(s,!1),n.updateCheckboxHeader())}onStoreRemoveAll(){var e;null==(e=super.onStoreRemoveAll)||e.call(this),this.performSelection(this.prepareSelection(null,null,!0),!1)}onCheckChange({checked:e,record:t}){const r=this,n=!r.selectionMode.multiSelect&&e,i=n||e?null:[t],s=e?[t]:null;e&&!GlobalEvents_default.shiftKeyDown&&(r._lastSelectionChecked=t),e&&r._lastSelectionChecked&&GlobalEvents_default.shiftKeyDown?r.performSelection(r.internalSelectRange(r._lastSelectionChecked,t,!0)):r.performSelection(r.prepareSelection(i,s,n,!0))}updateCheckboxHeader(){const{selectionMode:e,checkboxSelectionColumn:t,store:r}=this;if(e.checkbox&&e.showCheckAll&&(null==t?void 0:t.headerCheckbox)){const e=r.count&&!r.some((e=>!this.isSelected(e)));t.headerCheckbox.checked!==e&&(t.suspendEvents(),t.headerCheckbox.checked=e,t.resumeEvents())}}onCheckAllChange({checked:e}){this[e?"selectAll":"deselectAll"](this.store.isPaged&&this.selectionMode.preserveSelectionOnPageChange)}get selectionDragMouseEventListenerElement(){return globalThis}onSelectionDrag(e){var t,r;const n=this,{_selectionStartCell:i}=n;if(GlobalEvents_default.isMouseDown()||n.onSelectionEnd(),!i)return;const{items:s,_lastSelectionDragRegion:a}=n,o=n.getCellDataFromEvent(e,!0),l=null==o?void 0:o.column.region,c=(null==o?void 0:o.cellSelector)&&n.normalizeCellContext(o.cellSelector);if(c&&!c.equals(n._lastSelectionDragCell,!0)){if(n._isSelectionDragging||n.enableScrollingCloseToEdges(s),n._clearSelectionOnSelectionDrag&&!i.equals(c,!0)&&(n.deselectAll(),delete n._clearSelectionOnSelectionDrag),a&&l!==a){const e=n.subGrids[a],i=n.subGrids[l],o=e.scrollable,c=i.scrollable,d=s.indexOf(e)-s.indexOf(i)<0;if(c.x=d?0:c.maxX,d?o.x<o.maxX-1:o.x>1)return;null==(r=null==(t=n.scrollManager._activeScroll)?void 0:t.horizontal)||r.stopScroll()}n._lastSelectionDragRegion=l,n._lastSelectionDragCell=c,n._isSelectionDragging=!0;const e=n._lastSelectionDragChange=n.internalSelectRange(i,c,n.isRowNumberSelecting(c)||n.isRowNumberSelecting(i));e.deselectedCells=e.deselectedCells.filter((e=>!n.isCellSelected(e))),e.deselectedRecords=e.deselectedRecords.filter((e=>!n.isSelected(e))),n.refreshGridSelectionUI(e),n.trigger("dragSelecting",e)}}onSelectionEnd(){var e,t;const r=this,n=r._lastSelectionDragChange;r._isSelectionDragging&&!r._selectionStartCell.equals(r._lastSelectionDragCell,!0)&&n&&r.performSelection(n,!1),r.disableScrollingCloseToEdges(r.items),r._isSelectionDragging=!1,r._lastSelectionDragChange=r._lastSelectionDragCell=r._lastSelectionDragRegion=null,null==(t=(e=r._selectionListenersDetachers).selectiondrag)||t.call(e),delete r._selectionListenersDetachers.selectiondrag}onHandleElementClick(e){const t=this;t.selectionMode.rowNumber&&e.target.closest(".b-rownumber-header")?(e.handled=!0,t.store.count&&t.store.some((e=>!t.isSelected(e)))?t.selectAll():t.deselectAll()):t.selectionMode.column&&e.target.closest(".b-grid-header")&&(e.handled=!0,t.selectColumn(e,e.ctrlKey)),super.onHandleElementClick(e)}selectColumn(e,t=!1){const r=this,{store:n}=r,{columnId:i}=r.getHeaderDataFromEvent(e);r._shiftSelectRange=null,e.shiftKey||(r._shiftSelectColumn=i);const s=e.shiftKey&&r._shiftSelectColumn||i,a=r.internalSelectRange(r.normalizeCellContext({id:n.first.id,columnId:s}),r.normalizeCellContext({id:n.last.id,columnId:i}));t&&!a.selectedCells.some((e=>!r.isCellSelected(e)))&&(a.deselectedCells=a.selectedCells,a.selectedCells=[]),t||(a.deselectedCells=r._selectedCells),r.cleanSelectionChange(a),r.performSelection(a)}isSelected(e){return(null==e?void 0:e.id)&&(e=e.id),!!validIdTypes[typeof e]&&this.selectedRows.some((t=>t.id===e))}isCellSelected(e,t){return e=this.normalizeCellContext(e),this.isCellSelectionMode&&this._selectedCells.some((t=>e.equals(t,!0)))||t&&this.isSelected(e)}isSelectable(e){return this.normalizeCellContext({id:e.id||e}).isSelectable}get selectedRecord(){return this.selectedRecords[this.selectedRecords.length-1]||null}set selectedRecord(e){this.selectRow({record:e})}get selectedRecords(){return this.selectedRecordCollection.values}set selectedRecords(e){this.selectRows(e)}get selectedRows(){return[...this._selectedRows]}set selectedRows(e){this.selectRows(e)}spliceSelectedRecords(e,t,r){const n=this;if("number"==typeof t){const i=[...n.selectedRecords];i.splice(e,t,...ArrayHelper.asArray(r)),n.performSelection(n.prepareSelection(null,i,!0,!0))}else n.performSelection(n.prepareSelection(t,r,!1,!0))}selectRow(e){"number"!=typeof e&&!e.isModel&&"record"in e||(e={records:[e]}),ObjectHelper.assignIf(e,{scrollIntoView:!0}),this.selectRows(e)}selectRows(e){(!e||Array.isArray(e)||e.isModel||"number"==typeof e||!("records"in e)&&!("record"in e))&&(e={records:ArrayHelper.asArray(e)||[]});const t=this,{store:r}=t,n=[],{records:i=(e.record?[e.record]:[]),column:s=t.columns.visibleColumns[0],scrollIntoView:a,addToSelection:o=arguments[1]}=e;for(let e of i)e=r.getById(e),e&&n.push(e);o||(t._shiftSelectRange=null),t.performSelection(t.prepareSelection(null,n,!o,!0)),n.length&&a&&t.scrollRowIntoView(n[0].id,{column:s})}selectAll(e=!1){const{store:t}=this,r=(t.isGrouped?t.allRecords:t.records).filter((e=>!e.isSpecialRow));this.performSelection(this.prepareSelection(null,r,!1,!0),!0,e)}deselectAll(e=!1,t=!1){const{store:r}=this,n=e?(r.isGrouped?r.allRecords:r.records).filter((e=>!e.isSpecialRow)):null;this.performSelection(this.prepareSelection(n,null,!e),!0,t)}deselectRow(e){this.deselectRows(e)}deselectRows(e){const{store:t}=this,r=ArrayHelper.asArray(e).map((e=>t.getById(e))).filter((e=>e));this.performSelection(this.prepareSelection(r))}selectRange(e,t,r=!1){const n=this,{store:i}=n,s=n.internalSelectRange(i.getById(e),i.getById(t),!0);n._shiftSelectRange=null,n.performSelection(s)}get selectedCell(){return this._selectedCells[this._selectedCells.length-1]}set selectedCell(e){this.selectCells([e])}get selectedCells(){return[...this._selectedCells]}set selectedCells(e){this.selectCells(e)}get selectedCellCSSSelector(){const e=this.selectedCell,t=e&&this.getRowById(e.id);return e&&t?"[data-index="+t.dataIndex+"] [data-column-id="+e.columnId+"]":""}selectCell(e){var t;return"id"in e&&(e={cell:e},e=Object.assign({scrollIntoView:arguments[1],addToSelection:arguments[2],silent:arguments[3]},e)),null==(t=this.selectCells(e))?void 0:t[0]}selectCells(e){Array.isArray(e)&&(e={cells:e});const t=this,{cells:r=(e.cell?[e.cell]:[]),scrollIntoView:n=!0,addToSelection:i=!1,silent:s=!1}=e,a=t.prepareSelection(null,r,!i);return i||(t._shiftSelectRange=null),t.performSelection(a,!0,s),n&&t.scrollRowIntoView(r[0].id,{column:r[0].columnId}),t.isCellSelectionMode?a.selectedCells:a.selectedRecords}deselectCell(e){var t;return null==(t=this.deselectCells([e]))?void 0:t[0]}deselectCells(e){const t=this.prepareSelection(e);return this.performSelection(t),this.isCellSelectionMode?t.deselectedCells:t.deselectedRecords}toggleSelection(e){const t=this,{_focusedCell:r,selectionMode:n}=t,i=t.isRowNumberSelecting(r),s=t.isCellSelected(r,!0);if(!0===n.selectOnKeyboardNavigation||r.isActionable)return!1;t.performSelection(t.prepareSelection(s?r:null,s?null:r,!n.multiSelect,i)),e.preventDefault()}selectCellRange(e,t){this.performSelection(this.internalSelectRange(e,t))}getSelection(){return this.isRowSelectionMode?this.selectedRecords:this.selectedCells}cleanSelectionChange(e){const{deselectedRecords:t,selectedRecords:r,deselectedCells:n,selectedCells:i,deselectedCellRecords:s,selectedCellRecords:a}=e;return(null==t?void 0:t.length)&&(null==r?void 0:r.length)&&(e.deselectedRecords=t.filter((e=>!r.some((t=>e===t))))),(null==n?void 0:n.length)&&(null==i?void 0:i.length)&&(e.deselectedCells=n.filter((e=>!i.some((t=>e.equals(t,!0)))))),s.length&&((null==a?void 0:a.length)||(null==r?void 0:r.length))&&(e.deselectedCellRecords=s.filter((e=>!a.some((t=>e.id===t.id))&&!r.some((t=>e.id===t.id))))),e}getSelectedCellsForRecords(e){return this._selectedCells.filter((t=>t.id&&e.some((e=>e.id===t.id))))}delayUntilMouseUp(e){const t=EventHelper.on({element:globalThis,blur:r=>e(r,t),mouseup:r=>e(r,t),thisObj:this,once:!0})}get isRowSelectionMode(){return!this.isCellSelectionMode}get isCellSelectionMode(){return!0===this.selectionMode.cell}isRowNumberSelecting(...e){return this.selectionMode.rowNumber&&!e.some((e=>"rownumber"!==e.column.type))}extendSelectionLeft(){this.extendSelection("Left")}extendSelectionRight(){this.extendSelection("Right")}extendSelectionUp(){this.extendSelection("Up")}extendSelectionDown(){this.extendSelection("Down")}extendSelection(e){this._isKeyboardRangeSelecting=!0,this["navigate"+e](),this._isKeyboardRangeSelecting=!1}onCellNavigate(e,t,r,n){var i;const{selectionMode:s,_selectionListenersDetachers:a}=e,{multiSelect:o,deselectOnClick:l,dragSelect:c}=s,{ctrlKeyDown:d,shiftKeyDown:u}=GlobalEvents_default,h=GlobalEvents_default.isMouseDown(),g=GlobalEvents_default.isMouseDown(2),p=GlobalEvents_default.currentMouseDown||GlobalEvents_default.currentKeyDown;if(r=e.normalizeCellContext(r),!n||-1===r.rowIndex||(null==(i=r.record)?void 0:i.isGroupHeader)||(null==p?void 0:p.fromKeyMap)&&!s.selectOnKeyboardNavigation||e.columns.getById(r.columnId)===e.checkboxSelectionColumn||s.checkboxOnly||!0===(null==p?void 0:p.handled))return;u||(e._isAddingToSelection=d&&o,e._selectionStartCell=r),o&&c&&h&&!a.selectiondrag&&!e.preventDragSelect&&(a.selectiondrag=EventHelper.on({name:"selectiondrag",element:e.selectionDragMouseEventListenerElement,blur:"onSelectionEnd",mouseup:{handler:"onSelectionEnd",element:globalThis},mousemove:"onSelectionDrag",thisObj:e})),e.preventDragSelect=!1;const m=e._selectionStartCell,f=e._isAddingToSelection;if((u&&h||e._isKeyboardRangeSelecting)&&m&&o)e.performSelection(e.internalSelectRange(m,r,e.isRowNumberSelecting(m,r)));else{let t,n=!1,i=!0;if(e.isCellSelected(r,!0)){if(g)return;if(f||l)t=l?null:[r],i=!1;else if(e.selectedRecords.length+(e.isCellSelectionMode?e._selectedCells.length:0)<=1)return;n=l||o}t||f||(t=null,c&&n&&a.selectiondrag&&(e._clearSelectionOnSelectionDrag=!0));const s=(n,s)=>{var a;if(null==s||s(),(null==(a=null==n?void 0:n.target)?void 0:a.nodeType)===Node.ELEMENT_NODE){const e=new Location(n.target);if((null==e?void 0:e.grid)&&!e.equals(r,!0))return}u||(e._shiftSelectRange=null),e.performSelection(e.prepareSelection(t,i&&[r],null===t,i&&e.isRowNumberSelecting(r)))};n?e.delayUntilMouseUp(s):s()}}prepareSelection(e,t,r=!1,n=!1){var i,s;const a=this,o=a._isSelectionDragging,{includeParents:l,selectRecordOnCell:c}=a.selectionMode,d=[],u=[];let h=[],g=[],p=[],m=[];if(r)h=a._selectedCells,g=a._selectedRows,m=a.selectedRecords.filter((e=>!g.some((t=>t.id===e.id))));else if(e)for(const t of ArrayHelper.asArray(e)){const e=a.normalizeCellContext(t),r=(null==e?void 0:e.record)||(t.isModel?t:a.store.getById(e.id));if(!e.isSpecialRow&&(h.push(e),r&&!g.some((e=>e.id===r.id))&&(o||a.isSelected(r)?g.push(r):c&&a.selectedRecordCollection.get(r.id)&&!m.some((e=>e.id===r.id))&&m.push(r),a.selectionMode.includeChildren&&a.selectionMode.multiSelect&&!r.isLeaf&&(null==(i=r.allChildren)?void 0:i.length))))for(const e of r.allChildren)g.some((t=>t.id===e.id))||!o&&!a.isSelected(e)||g.push(e)}if(t){for(const e of ArrayHelper.asArray(t)){const t=a.normalizeCellContext(e),r=(null==t?void 0:t.record)||(e.isModel?e:a.store.getById(t.id));if(r&&!t.isSpecialRow&&(a.isCellSelectionMode&&!n&&u.push(t),(a.isRowSelectionMode||n)&&!d.some((e=>e.id===r.id))&&(d.push(r),a.selectionMode.includeChildren&&a.selectionMode.multiSelect&&!r.isLeaf&&(null==(s=r.allChildren)?void 0:s.length))))for(const e of r.allChildren)d.some((t=>t.id===e.id))||d.push(e)}c&&u.length&&(p=ArrayHelper.unique(u.map((e=>e.record))).filter((e=>!d.some((t=>t.id===e.id)))))}if(l&&(g.length||d.length)){const e=[...g,...d];ArrayHelper.unique(e.filter((t=>t.parent&&!t.allChildren.some((t=>e.includes(t))))).map((e=>e.parent))).forEach((e=>a.toggleParentSelection(e,d,g)))}return a.cleanSelectionChange({selectedCells:u,selectedRecords:d,deselectedCells:h,deselectedRecords:g,deselectAll:r,action:(null==d?void 0:d.length)||(null==u?void 0:u.length)?"select":"deselect",selectedCellRecords:p,deselectedCellRecords:m})}toggleParentSelection(e,t,r){if(!e||e.isRoot)return;const n=this.isSelected(e),i=t.includes(e),s=r.includes(e),a=e=>this.isSelected(e)&&!r.includes(e)||t.includes(e);"some"===this.selectionMode.includeParents?e.allChildren.some(a)?n&&!s||i||t.push(e):n&&!s&&r.push(e):n?s||i||!e.allChildren.some((e=>r.includes(e)))||r.push(e):i||e.allChildren.every(a)&&t.push(e),e.parent&&this.toggleParentSelection(e.parent,t,r)}internalSelectRange(e,t,r=!1){const n=this,i=n.isRowSelectionMode||r,s=n.prepareSelection(n._shiftSelectRange,n.getRange(e,t,i),!1,r);return n._shiftSelectRange=s["selected"+(i?"Records":"Cells")],s}getRange(e,t,r=!1){const n=this,{store:i}=n,s=n.normalizeCellContext(e),a=n.normalizeCellContext(t),o=Math.min(s.rowIndex,a.rowIndex),l=Math.max(s.rowIndex,a.rowIndex),c=[],d=Math.min(s.columnIndex,a.columnIndex),u=Math.max(s.columnIndex,a.columnIndex);if(-1===o||-1===l)throw new Error("Record not found in selectRange");if(r){const e=i.getRange(o,l+1,!1);a.rowIndex<s.rowIndex&&e.reverse(),c.push(...e)}else for(let e=o;e<=l;e++)for(let t=d;t<=u;t++)c.push({rowIndex:e,columnIndex:t});return c.map((e=>n.normalizeCellContext(e)))}performSelection(e,t=!0,r=!1){const n=this,{selectedRecords:i=[],selectedCells:s=[],selectedCellRecords:a=[],deselectedRecords:o=[],deselectedCells:l=[],deselectedCellRecords:c=[],action:d}=e,u=[...i,...a],h=[...o,...c],g=n.isRowSelectionMode;if(!1!==n.trigger("beforeSelectionChange",{mode:g?"row":"cell",action:d,selected:u,deselected:h,selection:n.selectedRecords,selectedCells:s,deselectedCells:l,cellSelection:n.selectedCells})){if(n._selectedCells===l)n._selectedCells=[];else{const e=[];for(const t of n._selectedCells)l.some((e=>t.equals(e,!0)))||e.push(t);n._selectedCells=e}if(e.deselectedRecords=[...e.deselectedRecords],o===n._selectedRows)n.changeSelectedRecordCollectionSilent((e=>e.clear())),n._selectedRows.length=0;else{const e=[],t=[];for(const r of n.selectedRecords)h.some((e=>r.id===e.id))||(n.isSelected(r)?e.push(r):t.push(r));n.changeSelectedRecordCollectionSilent((r=>r.values=[...e,...t])),n._selectedRows=e}if(s.length)for(const e of s)n._selectedCells.some((t=>t.equals(e,!0)))||n._selectedCells.push(e);i.length&&(n.changeSelectedRecordCollectionSilent((e=>e.add(...i))),n._selectedRows.push(...i.filter((e=>!n._selectedRows.some((t=>t.id===e.id)))))),a.length&&n.changeSelectedRecordCollectionSilent((e=>e.add(...a))),t&&n.refreshGridSelectionUI(e),n.afterSelectionChange(e),r||n.triggerSelectionChangeEvent(e)}}refreshGridSelectionUI({selectedRecords:e,selectedCells:t,deselectedRecords:r,deselectedCells:n}){const i=this,{checkboxSelectionColumn:s}=i;null==s||s.suspendEvents(),i.updateGridSelectionRecords(e,!0),i.updateGridSelectionRecords(r,!1),i.updateCheckboxHeader(),null==s||s.resumeEvents(),i.isCellSelectionMode&&(i.updateGridSelectionCells(t,!0),i.selectionMode.column&&i.updateGridSelectionColumns(t)),i.updateGridSelectionCells(n,!1)}updateGridSelectionRecords(e,t){const{checkboxSelectionColumn:r}=this;if(null==e?void 0:e.length)for(let n=0;n<e.length;n++){const i=this.getRowFor(e[n]);i&&(i.toggleCls("b-selected",t),i.setAttribute("aria-selected",t),!r||r.hidden||e[n].isSpecialRow||(i.getCell(r.id).widget.checked=t))}}updateGridSelectionCells(e,t){if(null==e?void 0:e.length)for(let r=0;r<e.length;r++){const n=this.getCell(e[r]);n&&(n.setAttribute("aria-selected",t),n.classList.toggle("b-selected",t))}}updateGridSelectionColumns(e){var t;const{count:r}=this.store;for(const n of this.columns.visibleColumns)null==(t=n.element)||t.classList.toggle("b-selected",(null==e?void 0:e.filter((e=>e.columnId===n.id)).length)===r)}triggerSelectionChangeEvent(e){const{selectedRecords:t=[],selectedCells:r=[],selectedCellRecords:n=[],deselectedRecords:i=[],deselectedCells:s=[],deselectedCellRecords:a=[]}=e,o=[...t,...n],l=[...i,...a],c=this.isRowSelectionMode;this.trigger("selectionChange",{mode:c?"row":"cell",action:e.action,selected:o,deselected:l,selection:this.selectedRecords,selectedCells:r,deselectedCells:s,cellSelection:this.selectedCells})}doDestroy(){var e;null==(e=this.selectedRecordCollection)||e.destroy(),this._selectedCells.length=0,this._selectedRows.length=0;for(const e in this._selectionListenersDetachers)this._selectionListenersDetachers[e]();super.doDestroy()}get widgetClass(){}},"configurable",{selectionMode:{cell:!1,multiSelect:!0,checkboxOnly:!1,checkbox:!1,checkboxPosition:null,showCheckAll:!1,deselectFilteredOutRecords:!1,includeChildren:!1,includeParents:!1,preserveSelectionOnPageChange:!1,preserveSelectionOnDatasetChange:!0,deselectOnClick:!1,dragSelect:!1,selectOnKeyboardNavigation:!0,column:!1,rowNumber:!1,selectRecordOnCell:!0},keyMap:{"Shift+ArrowUp":"extendSelectionUp","Shift+ArrowDown":"extendSelectionDown","Shift+ArrowLeft":"extendSelectionLeft","Shift+ArrowRight":"extendSelectionRight"," ":{handler:"toggleSelection",weight:10}},selectedRecordCollection:{}}),t},suspendStoreEvents=e=>e.columns.suspendEvents(),resumeStoreEvents=e=>e.columns.resumeEvents(),fillSubGridColumns=e=>{e.columns.clearCaches(),e.columns.fillFromMaster()},compareStateSortIndex=(e,t)=>e.stateSortIndex-t.stateSortIndex,GridState_default=e=>class extends(e||Base){static get $name(){return"GridState"}static get configurable(){return{statefulEvents:["subGridCollapse","subGridExpand","horizontalScroll","stateChange"]}}updateStore(e,t){var r;null==(r=super.updateStore)||r.call(this,e,t),this.detachListeners("stateStoreListeners"),null==e||e.ion({name:"stateStoreListeners",filter:"triggerUpdate",group:"triggerUpdate",sort:"triggerUpdate",thisObj:this})}updateColumns(e,t){var r;null==(r=super.updateColumns)||r.call(this,e,t),this.detachListeners("stateColumnListeners"),e.ion({name:"stateColumnListeners",change:"triggerUpdate",thisObj:this})}updateRowManager(e,t){var r;null==(r=super.updateRowManager)||r.call(this,e,t),this.detachListeners("stateRowManagerListeners"),e.ion({name:"stateRowManagerListeners",rowHeight:"triggerUpdate",thisObj:this})}triggerUpdate(){this.trigger("stateChange")}finalizeInit(){super.finalizeInit(),this.ion({selectionChange:"triggerUpdate",thisObj:this})}getState(){const e=this,t=e.element.style.cssText,r={rowHeight:e.rowHeight};if(t&&(r.style=t),e.selectedCell){const{id:t,columnId:n}=e.selectedCell;r.selectedCell={id:t,columnId:n}}return r.selectedRecords=e.selectedRecords.map((e=>e.id)),r.columns=e.columns.allRecords.map((e=>e.getState())),r.store=e.store.state,r.scroll=e.storeScroll(),r.subGrids={},e.eachSubGrid((e=>{var t;const n=r.subGrids[e.region]=r.subGrids[e.region]||{};e.isPainted?null==e.flex&&(n.width=e.width):null!=e.config.width?n.width=e.config.width:n.flex=e.config.flex,n.collapsed=null!=(t=e.collapsed)&&t,n.collapsed&&(n._beforeCollapseState=e._beforeCollapseState)})),r}applyState(e){const t=this;if(t.suspendRefresh(),"columns"in e){let r=!1,n=!1;t.columns.suspendEvents(),t.eachSubGrid(suspendStoreEvents),e.columns.forEach(((e,i)=>{const s=t.columns.getById(e.id);if(s){const t=s.generation;s.applyState(e),r=r||s.generation!==t,s.stateSortIndex=i,s.allIndex!==i&&(n=r=!0)}})),r&&t.eachSubGrid(fillSubGridColumns),n&&(t.eachSubGrid((e=>{e.columns.records.sort(compareStateSortIndex),e.columns.allRecords.sort(compareStateSortIndex)})),t.columns.sort({fn:compareStateSortIndex,ascending:!0})),t.isPainted&&r&&t.renderContents(),t.columns.resumeEvents(),t.eachSubGrid(resumeStoreEvents)}"subGrids"in e&&t.eachSubGrid((t=>{if(t.region in e.subGrids){const r=e.subGrids[t.region];"width"in r?t.width=r.width:"flex"in r&&(t.flex=r.flex),"collapsed"in r&&(t.collapsed=r.collapsed,t._beforeCollapseState=r._beforeCollapseState)}t.clearWidthCache()})),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),t.resumeRefresh(!0),t.eachSubGrid((e=>e.refreshFakeScroll())),"scroll"in e&&(t.restoreScroll(e.scroll),e.scroll.scrollTop&&t.element.querySelectorAll(".b-resize-monitored").forEach((e=>{const t=WidgetHelper.fromElement(e);t&&t.onElementResize(e)})))}get widgetClass(){}},immediatePromise6=Promise.resolve(),defaultScrollOptions2={block:"nearest"},SubGridScroller=class extends Scroller{updateYScroller(e){null==e||e.addScroller(this)}scrollIntoView(e,t=defaultScrollOptions2){const{xDelta:r,yDelta:n}=this.getDeltaTo(e,t),i=r||n?this.scrollBy(r,n,t):immediatePromise6;return(t.highlight||t.focus)&&i.then((()=>{t.highlight&&(e instanceof Rectangle?e.translate(-r,-n).highlight():DomHelper.highlight(e)),t.focus&&e.focus&&e.focus()})),i}scrollBy(e,t,r){const n=t&&this.yScroller.scrollBy(0,t,r),i=e&&super.scrollBy(e,0,r);if(i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=()=>{e(),t()},Promise.all([i,n])}return i||n||immediatePromise6}scrollTo(e,t,r){const n=null!=t&&this.yScroller.scrollTo(null,t,r),i=null!=e&&super.scrollTo(e,null,r);if(r&&r.animate||this.syncPartners(),i&&i.cancel&&n&&n.cancel){const e=i.cancel,t=n.cancel;return i.cancel=n.cancel=()=>{e(),t()},Promise.all([i,n])}return i||n||immediatePromise6}get viewport(){const e=Rectangle.from(this.element);return e.intersect(Rectangle.from(this.yScroller.element))||new Rectangle(e.x,e.y,e.width,0)}set y(e){this.yScroller&&(this.yScroller.y=e)}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}};__publicField(SubGridScroller,"configurable",{propagate:!1,overflowX:"hidden-scroll",yScroller:null}),SubGridScroller._$name="SubGridScroller";var sumWidths=(e,t)=>e+t.getBoundingClientRect().width,SubGrid=class extends Widget{static get $name(){return"SubGrid"}static get type(){return"subgrid"}static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,monitorResize:!0,headerClass:null,footerClass:null,weight:null,collapsed:null,scrollable:{overflowX:"hidden-scroll"},scrollerClass:SubGridScroller,hasCalculatedWidth:null,sealedColumns:null}}static get configurable(){return{element:!0,header:{},footer:{},virtualScrollerElement:!0,splitterElement:!0,headerSplitter:!0,scrollerSplitter:!0,footerSplitter:!0,resizable:null,role:"presentation"}}construct(e){const t=this;if(super.construct(e),this.rowManager.ion({addRows:"onAddRow",thisObj:this}),BrowserHelper.isFirefox){const{element:e}=t,r=t.grid.scrollable;let n=0;e.addEventListener("wheel",(({ctrlKey:i,deltaY:s,deltaX:a})=>{const o=Math.abs(s)>Math.abs(a);i||!o||t.scrollEndDetacher||r.y===n||(e.style.pointerEvents="none",n=r.y,t.scrollEndDetacher=r.ion({scrollEnd:async()=>{n=r.y,e.style.pointerEvents="",t.scrollEndDetacher=null},once:!0}))}))}VersionHelper.isTestEnv&&(t.hideOverlayScroller.delay=50)}doDestroy(){var e;const t=this;t.header.destroy(),t.footer.destroy(),null==(e=t.fakeScroller)||e.destroy(),t.virtualScrollerElement.remove(),t.splitterElements.forEach((e=>e.remove())),super.doDestroy()}get barConfig(){const e=this,{width:t,flex:r}=e.element.style,n={subGrid:e,parent:e,maxWidth:e.maxWidth||void 0,minWidth:e.minWidth||void 0};return r?n.flex=r:t&&(n.width=t),n}changeHeader(e){return new this.headerClass(ObjectHelper.assign({id:this.id+"-header"},this.barConfig,e))}changeFooter(e){return new this.footerClass(ObjectHelper.assign({id:this.id+"-footer"},this.barConfig,e))}get splitterElements(){return[this.splitterElement,this.headerSplitter,this.scrollerSplitter,this.footerSplitter]}toggleSplitterCls(e,t=!0){this.splitterElements.forEach((r=>null==r?void 0:r.classList[t?"add":"remove"](e)))}hideSplitter(){this.splitterElements.forEach((e=>e.classList.add("b-hide-display"))),this.$showingSplitter=!1}showSplitter(){this.splitterElements.forEach((e=>e.classList.remove("b-hide-display"))),this.$showingSplitter=!0}changeElement(e,t){const{region:r}=this;return super.changeElement({"aria-label":r,className:{"b-grid-subgrid":1,["b-grid-subgrid-"+r]:r,"b-grid-subgrid-collapsed":this.collapsed},dataset:{region:r}},t)}get rowElementConfig(){const{grid:e}=this;return{role:"row",className:e.rowCls,children:this.columns.visibleColumns.map(((t,r)=>({role:"gridcell","aria-colindex":r+1,tabIndex:e.cellTabIndex,className:"b-grid-cell",dataset:{column:t.field||"",columnId:t.id}})))}}changeVirtualScrollerElement(){const e=DomHelper.createElement({role:"presentation",reference:"virtualScrollerElement",className:"b-virtual-scroller",tabIndex:-1,dataset:{region:this.region},children:[{reference:"virtualScrollerWidth",className:"b-virtual-width"}]});return this.virtualScrollerWidth=e.virtualScrollerWidth,e.virtualScrollerElement}changeSplitterElement(){const e=DomHelper.createElement({reference:"splitterElement",className:{"b-grid-splitter":1,"b-grid-splitter-collapsed":this.collapsed,"b-hide-display":1},dataset:{region:this.region},children:[BrowserHelper.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner b-grid-splitter-main",children:[{className:"b-grid-splitter-buttons",reference:"splitterButtons",children:[{className:"b-grid-splitter-button-collapse",children:[BrowserHelper.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-collapse-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M192 448c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l137.4 137.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448z"}]}]},{className:"b-grid-splitter-button-expand",children:[BrowserHelper.isTouchDevice?{className:"b-splitter-button-touch-area"}:null,{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",className:"b-grid-splitter-button-icon b-gridregion-expand-arrow",viewBox:"0 0 256 512",children:[{tag:"path",d:"M64 448c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L178.8 256L41.38 118.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25l-160 160C80.38 444.9 72.19 448 64 448z"}]}]}]}]}]});return this.splitterButtons=e.splitterButtons,e.splitterElement}get splitterConfig(){return{className:this.splitterElement.className.trim(),children:[BrowserHelper.isTouchDevice?{className:"b-splitter-touch-area"}:null,{className:"b-grid-splitter-inner"}],dataset:{region:this.region}}}changeHeaderSplitter(){return DomHelper.createElement(this.splitterConfig)}changeScrollerSplitter(){return DomHelper.createElement(this.splitterConfig)}changeFooterSplitter(){return DomHelper.createElement(this.splitterConfig)}render(...e){const t=this;super.render(...e),t.grid&&(t.updateHasFlex(),t.element.parentNode.insertBefore(t.splitterElement,t.element.nextElementSibling),t.splitterElements.forEach((e=>EventHelper.on({element:e,mouseenter:"onSplitterMouseEnter",mouseleave:"onSplitterMouseLeave",thisObj:t}))),t._collapsed&&t.collapse())}refreshHeader(){this.header.refreshContent()}refreshFooter(){var e;null==(e=this.footer)||e.refreshContent()}eachWidget(e,t=!0){const r=[this.header,this.footer];for(let n=0;n<r.length;n++){const i=r[n];if(!1===e(i))return;t&&i.eachWidget&&i.eachWidget(e,t)}}fixCellWidths(e){const{visibleColumns:t}=this.columns;let r=e.firstElementChild,n=0;for(;r;){const e=t[n],{element:i}=e;e.minWidth&&(r.style.minWidth=DomHelper.setLength(e.minWidth)),e.maxWidth&&(r.style.maxWidth=DomHelper.setLength(e.maxWidth)),e.flex?e.childLevel&&i?(r.style.flex="0 0 "+i.getBoundingClientRect().width+"px",r.style.width=""):(r.style.flex=e.flex,r.style.width=""):e.width?r.style.width=DomHelper.setLength(e.width):r.style.flex=r.style.width=r.style.minWidth="",r=r.nextElementSibling,n++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:r,footer:n}=e;if(!e.collapsed){if(e.flex)r.flex=e.flex,n&&(n.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some((e=>!e.hidden&&e.flex))&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let i=e.width;if(!i&&e.hasCalculatedWidth){i=0;for(const t of e.columns)t.flex||t.hidden||(i+=t.width)}t.style.width=i+"px",r.width=i,n&&(n.width=i)}e.syncScrollingPartners(!1)}}fixRowWidthsInSafariEdge(){if(BrowserHelper.isSafari){const e=this,{region:t,header:r}=e,n=r.calculateMinWidthForSafari();e.rowManager.forEach((e=>{const r=e.getElement(t);r&&(r.style.width=n+"px")})),r.headersElement.style.width=n+"px"}}set width(e){const t=this;t.hasCalculatedWidth=!1,super.width=e,t.header.width=e,t.footer.width=e,t.isPainted&&t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header.flex=e,t.footer.flex=e,super.flex=e,t.isPainted&&t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,r,n,i){const s=this,{grid:a}=s;super.onInternalResize(...arguments),(null==a?void 0:a.isPainted)&&(s.syncSplitterButtonPosition(),t!==n&&(a.trigger("horizontalScroll",{grid:a,subGrid:s,scrollLeft:s.scrollable.element.scrollLeft,scrollX:s.scrollable.x}),s.fakeScroller&&s.refreshFakeScroll(),a.syncFlexedSubCols(),s.fixRowWidthsInSafariEdge()),r!==i&&a.onHeightChange(),s.trigger("afterInternalResize",s))}syncParallelSplitters(e){const t=this,{grid:r}=t;if(t.splitterElement&&t.$showingSplitter)t.toggleSplitterCls("b-grid-splitter-collapsed",e);else{const n=r.getSubGrid(r.getPreviousRegion(t.region));n&&n.splitterElement&&n.syncParallelSplitters(e)}}onSplitterMouseEnter(){const e=this,{nextSibling:t}=e;e.collapsed||t&&t.collapsed||e.toggleSplitterCls("b-hover"),e.startSplitterButtonSyncing()}onSplitterMouseLeave(){const e=this,{nextSibling:t}=e;e.toggleSplitterCls("b-hover",!1),e.collapsed||t&&t.collapsed||e.stopSplitterButtonSyncing()}startSplitterButtonSyncing(){const e=this;e.splitterElement&&(e.syncSplitterButtonPosition(),e.splitterSyncScrollListener||(e.splitterSyncScrollListener=e.grid.scrollable.ion({scroll:"syncSplitterButtonPosition",thisObj:e})))}stopSplitterButtonSyncing(){this.splitterSyncScrollListener&&(this.splitterSyncScrollListener(),this.splitterSyncScrollListener=null)}syncSplitterButtonPosition(){const{grid:e}=this;this.splitterButtons.style.top=e.scrollable.y+(e.bodyHeight-(this.headerSplitter?e.headerHeight:0))/2+"px"}get viewRectangle(){const{scrollable:e}=this;return new Rectangle(e.x,e.y,this.width||0,this.rowManager.viewHeight)}updateHasFlex(){this.scrollable.element.classList.toggle("b-has-flex",this.columns.hasFlex)}updateResizable(e){this.splitterElements.forEach((t=>DomHelper.toggleClasses(t,["b-disabled"],!e)))}resizeColumnsToFitContent(){this.grid.beginGridMeasuring(),this.columns.visibleColumns.forEach((e=>{e.resizeToFitContent(null,null,!0)})),this.grid.endGridMeasuring()}get overflowingHorizontally(){return!this.collapsed&&this.scrollable.hasOverflow("x")}get overflowingVertically(){return!1}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:r,virtualScrollerWidth:n,header:i,footer:s,scrollable:a}=e,o=[...i.contentElement.children].reduce(sumWidths,0);a.scrollWidth=o,r.style.width=t.style.width,r.style.flex=t.style.flex,r.style.minWidth=t.style.minWidth,r.style.maxWidth=t.style.maxWidth,i.scrollable.syncOverflowState(),s.scrollable.syncOverflowState(),e.collapsed||(e.overflowingHorizontally?(n.style.width=(a.scrollWidth||0)+"px",e.grid.virtualScrollers.classList.remove("b-hide-display")):n.style.width=0)}initScroll(){const e=this,{scrollable:t,virtualScrollerElement:r}=e;e.syncPartnersOnFrame=e.createOnFrame(e.syncScrollingPartners),BrowserHelper.isFirefox&&t.element.addEventListener("wheel",(e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())})),e.fakeScroller=new Scroller({element:r,overflowX:!0,widget:e}),t.ion({scroll:"onSubGridScroll",scrollend:"onSubGridScrollEnd",thisObj:e}),t.addPartner(e.fakeScroller,"x"),t.addPartner(e.header.scrollable,"x"),t.addPartner(e.footer.scrollable,"x"),e.refreshFakeScroll()}onSubGridScrollEnd(){const e=this;e.forceScrollUpdate||e.syncScrollingPartners(),e.scrolling=!1,DomHelper.scrollBarWidth||(e.grid.virtualScrollers.classList.remove("b-scrolling"),e.hideOverlayScroller())}onSubGridScroll(){this.forceScrollUpdate?(this.syncScrollingPartners(),this.forceScrollUpdate=!1):this.syncPartnersOnFrame()}showOverlayScroller(){this.hideOverlayScroller.cancel(),this.virtualScrollerElement.classList.add("b-show-virtual-scroller")}hideOverlayScroller(){this.virtualScrollerElement.classList.remove("b-show-virtual-scroller")}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const t=this,{grid:r}=t;!t.scrolling&&e&&(t.scrolling=!0,DomHelper.scrollBarWidth||(r.virtualScrollers.classList.add("b-scrolling"),t.showOverlayScroller())),r.trigger("horizontalScroll",{subGrid:t,grid:r,scrollLeft:t.scrollable.element.scrollLeft,scrollX:t.scrollable.x})}scrollColumnIntoView(e,t){const{columns:r,header:n}=this,i=n.scrollable;if(e=e instanceof Column?e:r.get(e)||r.getById(e)||r.getAt(e)){const r=n.getHeader(e.id);if(r)return i.scrollIntoView(Rectangle.from(r,null,!0),t)}}onAddRow({rows:e,isExport:t}){const r=this,n=r.rowElementConfig,i=document.createDocumentFragment();e.forEach((e=>{const t=DomHelper.createElement(n);i.appendChild(t),e.addElement(r.region,t),r.fixCellWidths(t)})),t||(r.fixRowWidthsInSafariEdge(),r.element.insertBefore(i,r.insertRowsBefore))}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=DomHelper.append(this.element,this.rowElementConfig);return this.fixCellWidths(e),e}get store(){return this.grid.store}get rowManager(){var e;return null==(e=this.grid)?void 0:e.rowManager}toggleTransitionClasses(e=!1){const t=this,r=t.grid,n=r.getSubGrid(r.getNextRegion(t.region)),i=r.resolveSplitter(n);n.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),t.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),i.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,{grid:t,element:r}=e,n=t.getSubGrid(t.getNextRegion(e.region)),i=e.splitterElement?e:e.previousSibling;let{_beforeCollapseState:s}=e,a=0;if(!t.rendered||!0!==e._collapsed)return t.eachSubGrid((t=>{t!==e&&!t._collapsed&&++a})),0===a&&await n.expand(),new Promise((i=>{if(s)i();else{s=e._beforeCollapseState={};let t=!1;e.width&&(t=!0,e.ion({afterinternalresize:()=>{i(e)},thisObj:e,once:!0})),s.width=e.width,s.elementWidth=r.style.width,""===n.element.style.flex&&(s.nextRegionWidth=n.width,n.width="",n.flex="1"),""!==r.style.flex&&(s.flex=r.style.flex,e.header.element.style.flex=r.style.flex=""),r.classList.add("b-grid-subgrid-collapsed"),e.virtualScrollerElement.classList.add("b-collapsed"),e.header.element.classList.add("b-collapsed"),e.footer.element.classList.add("b-collapsed"),e._collapsed=!0,e.width="",t||(e.syncParallelSplitters(!0),i(!1))}t.trigger("subGridCollapse",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!0})})).then((r=>{var n;e.isDestroyed||!1!==r&&(t.refreshVirtualScrollbars(),e.syncParallelSplitters(!0),null==(n=i.startSplitterButtonSyncing)||n.call(i))}))}async expand(){const e=this,{grid:t,_beforeCollapseState:r}=e,n=t.getSubGrid(t.getNextRegion(e.region)),i=e.splitterElement?e:e.previousSibling;if(!t.rendered||!0===e._collapsed)return new Promise((s=>{if(null!=r){let t=!1;e.width!==r.elementWidth&&(t=!0,e.ion({afterinternalresize(){e.setTimeout((()=>s(e)),10)},thisObj:e,once:!0})),r.nextRegionWidth&&(n.width=r.nextRegionWidth,n.flex=null),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.virtualScrollerElement.classList.remove("b-collapsed"),e.header.element.classList.remove("b-collapsed"),e.footer.element.classList.remove("b-collapsed"),r.flex?(e.width=r.width,e.header.flex=e.flex=r.flex,e.footer.flex=r.flex,e._width=null):e.width=r.elementWidth,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,t?(i.stopSplitterButtonSyncing(),e.syncParallelSplitters(!1)):s(!1),delete e._beforeCollapseState}else s();t.trigger("subGridExpand",{subGrid:e}),t.afterToggleSubGrid({subGrid:e,collapsed:!1})}))}hide(){var e,t;return null==(e=this.header)||e.hide(),null==(t=this.footer)||t.hide(),this.hideSplitter(),super.hide()}show(){var e,t;return null==(e=this.header)||e.show(),null==(t=this.footer)||t.show(),this.showSplitter(),super.show()}};__publicField(SubGrid,"delayable",{hideOverlayScroller:1e3}),SubGrid.initClass(),SubGrid._$name="SubGrid";var GridSubGrids_default=e=>class extends(e||Base){static get $name(){return"GridSubGrids"}static get properties(){return{subGrids:{}}}changeSubGridConfigs(e){const t=this,r=new Set;for(const n of t.columns){const{region:t}=n;t&&(e[t]||(e[t]={}),r.add(t))}e.normal&&ObjectHelper.isEmpty(e.normal)&&(e.normal=GridBase.defaultConfig.subGridConfigs.normal);for(const n of r)t.createSubGrid(n,e[n]);return t.items=t.subGrids,e}createSubGrid(e,t=null){const r=this,n=r.columns.makeChained((t=>t.region===e),["region"]),i=ObjectHelper.assign({type:"subgrid",id:r.id+"-"+e+"Subgrid",parent:r,grid:r,region:e,headerClass:r.headerClass,footerClass:r.footerClass,columns:n,weight:e,scrollable:{yScroller:r.scrollable}},t||r.subGridConfigs[e]);let s=!1;i.flex||i.width||(i.width=n.totalFixedWidth,s=!0);const a=r.subGrids[e]=SubGrid.create(i);return a.hasCalculatedWidth=s,e===r.regions[0]&&(a.isFirstRegion=!0),a}onChildAdd(e){if(e.isSubGrid){const t=this,{items:r,headerContainer:n,virtualScrollers:i,footerContainer:s}=t,a=2*r.indexOf(e);t.hideHeaders||(DomHelper.insertAt(n,e.headerSplitter,a),DomHelper.insertAt(n,e.header.element,a)),DomHelper.insertAt(i,e.scrollerSplitter,a),DomHelper.insertAt(i,e.virtualScrollerElement,a),DomHelper.insertAt(s,e.footerSplitter,a),DomHelper.insertAt(s,e.footer.element,a),r.forEach(((e,t)=>{t<r.length-1&&e.showSplitter()})),0===a&&t.emptyTextEl&&e.element.appendChild(t.emptyTextEl)}return super.onChildAdd(e)}onChildRemove(e){if(super.onChildRemove(e),e.isSubGrid){const{items:t}=this;delete this.subGrids[e.region],ArrayHelper.remove(this.regions,e.region),e.destroy(),t.length&&t[t.length-1].hideSplitter()}}doDestroy(){this.eachSubGrid((e=>e.destroy())),super.doDestroy()}eachSubGrid(e,t=null){this.items.forEach(((r,n)=>{r.isSubGrid&&e.call(t||r,r,n++)}))}callEachSubGrid(e,...t){let r=null;return this.items.forEach(((n,i)=>{if(n.isSubGrid&&n[e]){const s=n[e](...t);0===i&&(r=s)}})),r}get regions(){return this.items.map((e=>e.region))}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof Column?e:this.columns.getById(e)||this.columns.get(e),this.getSubGrid(e.region)}resolveSplitter(e){const t=this.getLastRegions();let r=e instanceof SubGrid?e.region:e;return t[1]===r&&(r=t[0]),this.subGrids[r].splitterElement}get widgetClass(){}},emptyString=new String,locale3={localeName:"Ch",localeDesc:"中文",localeCode:"ch",ColumnPicker:{column:"列",columnsMenu:"列栏",hideColumn:"隐藏列",hideColumnShort:"隐藏",newColumns:"添加列"},Filter:{applyFilter:"应用筛选",filter:"筛选",editFilter:"编辑筛选",on:"在",before:"之前",after:"之后",equals:"等于",lessThan:"小于",moreThan:"大于",removeFilter:"移除筛选",disableFilter:"禁用筛选"},FilterBar:{enableFilterBar:"显示筛选",disableFilterBar:"隐藏筛选"},Group:{group:"组",groupAscending:"分组升序",groupDescending:"分组降序",groupAscendingShort:"升序",groupDescendingShort:"降序",stopGrouping:"停止分组",stopGroupingShort:"停止"},HeaderMenu:{moveBefore:e=>'移动到"'+e+'"之前',moveAfter:e=>'移动到"'+e+'"之后',collapseColumn:"收缩列",expandColumn:"展开列"},ColumnRename:{rename:"重命名"},MergeCells:{mergeCells:"合并单元格",menuTooltip:"按此列排序时合并具有相同值的单元格"},Search:{searchForValue:"搜索"},Sort:{sort:"排序",sortAscending:"升序排序",sortDescending:"降序排序",multiSort:"多级排序",removeSorter:"删除排序",addSortAscending:"添加升级排序",addSortDescending:"添加降级排序",toggleSortAscending:"修改为升级",toggleSortDescending:"修改为降级",sortAscendingShort:"升级",sortDescendingShort:"降级",removeSorterShort:"删除",addSortAscendingShort:"+ 升级",addSortDescendingShort:"+ 降级"},Column:{columnLabel:e=>e.text,cellLabel:emptyString},Checkbox:{toggleRowSelect:"切换行",toggleSelection:"切换整个数据集"},RatingColumn:{cellLabel:e=>{var t;return(e.text?e.text:"")+" "+((null==(t=e.location)?void 0:t.record)?"rating : "+(e.location.record[e.field]||0):"")}},GridBase:{loadFailedMessage:"数据加载失败！",syncFailedMessage:"数据同步失败!",unspecifiedFailure:"未知错误！",networkFailure:"网络错误！",parseFailure:"服务器响应错误！",serverResponse:"服务器响应:",noRows:"没有数据",moveColumnLeft:"移动到左侧部分",moveColumnRight:"移动到右侧部分",moveColumnTo:e=>"将列移动到 "+e},CellMenu:{removeRow:"Delete"},RowCopyPaste:{copyRecord:"Copy",cutRecord:"Cut",pasteRecord:"Paste",rows:"rows",row:"row"},CellCopyPaste:{copy:"Copy",cut:"Cut",paste:"Paste"},PdfExport:{"Waiting for response from server":"Waiting for response from server...","Export failed":"Export failed","Server error":"Server error","Generating pages":"Generating pages...","Click to abort":"Cancel"},ExportDialog:{width:"40em",labelWidth:"12em",exportSettings:"导出设置",export:"导出",exporterType:"控制分页",cancel:"取消",fileFormat:"文件格式",rows:"行",alignRows:"对齐行",columns:"列",paperFormat:"格式",orientation:"水平方向",repeatHeader:"重复列名"},ExportRowsCombo:{all:"所有行",visible:"可见行"},ExportOrientationCombo:{portrait:"Portrait",landscape:"Landscape"},SinglePageExporter:{singlepage:"Single page"},MultiPageExporter:{multipage:"Multiple pages",exportingPage:({currentPage:e,totalPages:t})=>"Exporting page "+e+"/"+t},MultiPageVerticalExporter:{multipagevertical:"Multiple pages (vertical)",exportingPage:({currentPage:e,totalPages:t})=>"Exporting page "+e+"/"+t},RowExpander:{loading:"Loading",expand:"Expand",collapse:"Collapse"}},En_default2=LocaleHelper.publishLocale(locale3),resolvedPromise=new Promise((e=>e())),storeListenerName2="GridBase:store",defaultScrollOptions3={block:"nearest",inline:"nearest"},datasetReplaceActions={dataset:1,pageLoad:1,filter:1},GridBase=class extends(Panel.mixin(Pluggable_default,State_default,GridElementEvents_default,GridFeatures_default,GridNavigation_default,GridResponsive_default,GridSelection_default,GridState_default,GridSubGrids_default,LoadMaskable_default)){static get $name(){return"GridBase"}static get type(){return"gridbase"}static get delayable(){return{onGridVerticalScroll:{type:"raf"},bufferedAfterColumnsResized:250,bufferedElementResize:250}}static get configurable(){return{autoHeight:null,enableSticky:null,enableTextSelection:null,fillLastColumn:!0,positionMode:"translate",showDirty:null,subGridConfigs:{normal:{flex:1}},store:{value:{},$config:"nullify"},rowManager:{value:{},$config:["nullify","lazy"]},scrollManager:{value:{},$config:["nullify","lazy"]},columns:{value:[],$config:"nullify"},minHeight:"10em",hideFooters:!0,contentElMutationObserver:!1,trapFocus:!1,ariaElement:"bodyElement",cellTabIndex:-1,rowCls:{value:"b-grid-row",$config:{merge:this.mergeCls}},cellCls:{value:"b-grid-cell",$config:{merge:this.mergeCls}},emptyText:"L{noRows}",sortFeatureStore:"store"}}static get defaultConfig(){return{rowHeight:null,fixedRowHeight:null,defaultRowHeight:45,fullRowRefresh:!0,hideHeaders:null,preserveScrollOnDatasetChange:null,preserveFocusOnDatasetChange:!0,data:null,defaultRegion:"normal",destroyStore:null,maskDefaults:{cover:"body",target:"element"},columnLines:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!0,disableGridRowModelWarning:null,headerClass:Header,footerClass:Footer,testPerformance:!1,rowScrollMode:"move",monitorResize:!0,features:!0,scrollable:{overflowY:!0},scrollerClass:GridScroller,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu",localizableProperties:["emptyText"],asyncEventSuffix:"",fixElementHeightsBuffer:350,testConfig:{transitionDuration:50,fixElementHeightsBuffer:50}}}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this,{initScroll:r}=t;t.initScroll=()=>!t.scrollInitialized&&r.call(t),VersionHelper.isTestEnv&&(t.bufferedAfterColumnsResized.delay=50,t.bufferedElementResize.delay=50),super.finishConfigure(e),LocaleManager_default.ion({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),LocaleManager_default.ion({locale:"onLocaleChange",prio:-1,thisObj:t}),GlobalEvents_default.ion({theme:"onThemeChange",thisObj:t}),t.ion({subGridExpand:"onSubGridExpand",prio:-1,thisObj:t}),t.bufferedFixElementHeights=t.buffer("fixElementHeights",t.fixElementHeightsBuffer,t),t.setGridClassList(t.element.classList)}onSubGridExpand(){this.renderContents()}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.isPainted&&this.renderContents()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreBeforeRequest()}changeScrollManager(e,t){return null==t||t.destroy(),e?ScrollManager.new({element:this.element,owner:this},e):null}doDestroy(){var e,t;const r=this;r.detachListeners(storeListenerName2),null==(e=r.scrollManager)||e.destroy();for(const e of Object.values(r.features))null==(t=e.destroy)||t.call(e);r._focusedCell=null,r.columns.destroy(),super.doDestroy()}setGridClassList(e){Object.values(this.features).forEach((t=>{if(t.disabled)return;let r;r=Object.prototype.hasOwnProperty.call(t.constructor,"featureClass")?t.constructor.featureClass:"b-"+(t instanceof Base?t.$$name:t.constructor.name),r&&e.add(r.toLowerCase())}))}compose(){const{autoHeight:e,enableSticky:t,enableTextSelection:r,fillLastColumn:n,positionMode:i,showDirty:s}=this;return{class:{["b-grid-"+i]:1,"b-enable-sticky":t,"b-grid-notextselection":!r,"b-autoheight":e,"b-fill-last-column":n,"b-show-dirty":s}}}get cellCls(){const{_cellCls:e}=this;return e.value||e}get bodyConfig(){const{autoHeight:e,hideFooters:t,hideHeaders:r}=this;return{reference:"bodyElement",className:{"b-autoheight":e,"b-grid-panel-body":1},[this.hasHeader?"ariaLabelledBy":""]:this.id+"-panel-title",children:{headerContainer:{tag:"header",role:"row","aria-rowindex":1,className:{"b-grid-header-container":1,"b-hidden":r}},bodyContainer:{className:"b-grid-body-container",tabIndex:-1,role:"presentation",children:{verticalScroller:{className:"b-grid-vertical-scroller"}}},virtualScrollers:{className:"b-virtual-scrollers b-hide-display",style:BrowserHelper.isFirefox&&DomHelper.scrollBarWidth?{height:"8px"}:void 0},footerContainer:{tag:"footer",className:{"b-grid-footer-container":1,"b-hidden":t}}}}}get contentElement(){return this.verticalScroller}get overflowElement(){return this.bodyContainer}updateHideFooters(e){var t;null==(t=this.footerContainer)||t.classList[e?"add":"remove"]("b-hidden")}changeColumns(e,t){const r=this;if(!e&&t)return r.isDestroying?t.owner===r&&t.destroy():t.removeAll(),t;if(e.isStore)return(null==t?void 0:t.owner)===r&&t.destroy(),e.grid=r,e;if(Array.isArray(e)){if(t){const r=t.allRecords.slice();t.data=e;for(const e of r)t.includes(e)||e.destroy();return t}e={data:e}}if(t)throw new Error("Replacing ColumnStore is not supported");return ColumnStore.new({grid:r,owner:r},e)}updateColumns(e,t){var r,n;const i=this;null==(r=super.updateColumns)||r.call(this,e,t),e.ion({refresh:i.onColumnsChanged,change:i.onColumnsChanged,sort:i.onColumnsChanged,thisObj:i}),e.ion(columnResizeEvent(i.onColumnsResized,i)),BrowserHelper.isTouchDevice&&(i.touch=!0,e.forEach((e=>{const{touchConfig:t}=e;t&&e.applyState(t)}))),null==(n=i.bodyElement)||n.setAttribute("aria-colcount",e.visibleColumns.length)}onColumnsChanged({type:e,action:t,changes:r,record:n,records:i,isMove:s}){var a;const o=this,{columns:l,checkboxSelectionColumn:c}=o,d=r&&1===Object.keys(r).length;if("refresh"===e&&"batch"!==t||"update"===t&&d&&"parentIndex"in r||"sort"===t&&l.isSyncingDataOnLoad)return;const u="add"===t&&i.some((e=>e.region&&!o.subGrids[e.region]));if(!o.isConfiguring&&(u||o.isPainted&&(!s||"remove"!==t))){if("add"===t)for(const e of i){const{region:t}=e;o.subGrids[t]||o.add(o.createSubGrid(t,null==(a=o.subGridConfigs)?void 0:a[t]))}if("update"===t){if(("width"in r||"minWidth"in r||"maxWidth"in r||"flex"in r)&&!("region"in r)){const{region:e}=n;return l.visibleColumns.forEach((t=>{t.region===e&&t.repaintOnResize&&o.refreshColumn(t)})),void o.afterColumnsChange({action:t,changes:r,column:n})}if("text"in r&&d)return void n.subGrid.refreshHeader();if("hidden"in r){const e=o.getSubGridFromColumn(n.id);e.header.fixHeaderWidths(),e.footer.fixFooterWidths(),e.updateHasFlex()}}if("dataset"===t||"batch"===t||"update"===t&&"region"in r){const e=l.getDistinctValues("region",!0),{toRemove:t,toAdd:r}=ArrayHelper.delta(e,o.regions,!0);o.remove(t.map((e=>o.getSubGrid(e)))),o.add(r.map((e=>o.createSubGrid(e,o.subGridConfigs[e]))))}if(c&&!l.includes(c)){const e=l.indexOf(l.findRecord("type","rownumber"))+1;l.insert(e,c,!0)}o._suspendRenderContentsOnColumnsChanged||o.renderContents(),o.syncFlexedSubCols(),o.bodyElement.setAttribute("aria-colcount",l.visibleColumns.length),o.afterColumnsChange({action:t,changes:r,column:n})}}onColumnsResized({changes:e,record:t}){var r;const n=this;if(n.isConfiguring)return;const i=DomHelper.setLength(t.width),s=DomHelper.setLength(t.minWidth),a=DomHelper.setLength(t.maxWidth),o=n.getSubGridFromColumn(t.id);if(o.header.fixHeaderWidths(),o.footer.fixFooterWidths(),o.updateHasFlex(),!t.flex||!t.childLevel){n.cellEls&&t===n.lastColumnResized||(n.cellEls=DomHelper.children(n.element,'.b-grid-cell[data-column-id="'+t.id+'"]'),n.lastColumnResized=t);for(const o of n.cellEls)"width"in e&&(o.style.width=i),"minWidth"in e&&(o.style.minWidth=s),"maxWidth"in e&&(o.style.maxWidth=a),"flex"in e&&(o.style.flex=null!=(r=t.flex)?r:null)}n.resizingColumns||n.afterColumnsResized(t),n.syncFlexedSubCols()}afterColumnsResized(e){const t=this;t.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||(t.fixWidths(),t.fixRowWidthsInSafariEdge())})),t.lastColumnResized=t.cellEls=null,t.bufferedAfterColumnsResized(e),t.onHeightChange()}syncFlexedSubCols(){const e=this.columns.query((e=>e.flex&&e.childLevel&&e.element));if(e)for(const t of e){const e=t.element.getBoundingClientRect().width,r=DomHelper.children(this.element,'.b-grid-cell[data-column-id="'+t.id+'"]');for(const t of r)t.style.flex="0 0 "+e+"px"}}bufferedAfterColumnsResized(e){this.columns.usesAutoHeight&&this.refreshRows(),this.refreshVirtualScrollbars(),this.eachSubGrid((t=>{t.collapsed||e&&e.region!==t.region||t.refreshFakeScroll()}))}bufferedElementResize(){this.refreshRows()}onInternalResize(e,t,r,n,i){DomHelper.scrollBarWidth&&t<n&&this.eachSubGrid((e=>{e.flex&&e.onElementResize(e.element)})),super.onInternalResize(...arguments),this.isPainted&&t!==n&&this.columns.usesFlexAutoHeight&&this.bufferedElementResize()}changeRowManager(e,t){const r=this;if(r._isRowMeasured||r.measureRowHeight(),null==t||t.destroy(),e){const t=RowManager.new({grid:r,rowHeight:r.rowHeight,rowScrollMode:r.rowScrollMode||"move",autoHeight:r.autoHeight,fixedRowHeight:r.fixedRowHeight,internalListeners:{changeTotalHeight:"onRowManagerChangeTotalHeight",requestScrollChange:"onRowManagerRequestScrollChange",thisObj:r}},e);return r.relayEvents(t,["beforeRenderRow","renderRow"]),r._rowManager=null,t}}getRowHeight(e){return e.rowHeight}processRowHeight(e,t){}bindStore(e){const t=this.asyncEventSuffix;e.ion({name:storeListenerName2,["refresh"+t]:"onStoreDataChange",["add"+t]:"onStoreAdd",["remove"+t]:"onStoreRemove",["replace"+t]:"onStoreReplace",["removeAll"+t]:"onStoreRemoveAll",["move"+t]:e.tree?null:"onFlatStoreMove",change:"relayStoreDataChange",idChange:"onStoreRecordIdChange",update:"onStoreUpdateRecord",beforeRequest:"onStoreBeforeRequest",afterRequest:"onStoreAfterRequest",exception:"onStoreException",commit:"onStoreCommit",loadSync:"onStoreLoadSync",thisObj:this}),super.bindStore(e)}unbindStore(e){this.detachListeners(storeListenerName2),this.destroyStore&&e.destroy()}changeStore(e){var t;return null==e?null:("string"==typeof e&&(e=Store.getStore(e)),e.isStore||((e=ObjectHelper.assign({data:this.data,tree:Boolean(null==(t=this.initialConfig.features)?void 0:t.tree)},e)).data||delete e.data,e.modelClass||(e.modelClass=GridRowModel),e=new(e.readUrl?AjaxStore:Store)(e)),e)}updateStore(e,t){var r,n;const i=this;null==(r=super.updateStore)||r.call(this,e,t),t&&i.unbindStore(t),e&&(t&&i.deselectAll(),i.bindStore(e)),i.trigger("bindStore",{store:e,oldStore:t}),i.isDestroying||!i.isPainted||i.refreshSuspended||null==(n=i._rowManager)||n.reinitialize()}onStoreLoadSync(){this.rowManager.renderFromRow(this.topRow)}onStoreUpdateRecord({source:e,record:t,changes:r}){const n=this;if(!n.refreshSuspended&&!e.isSyncingDataOnLoad)if(n.forceFullRefresh)n.rowManager.refresh(),n.forceFullRefresh=!1;else{let i;if(t.isFieldModified("id")&&(i=n.getRowFor(t.meta.modified.id)),i=i||n.getRowFor(t),!i)return;if(n.fullRowRefresh||t.isSpecialRow){const r=e.indexOf(t);-1!==r&&i.render(r,t)}else n.columns.visibleColumns.forEach((e=>{const t=e.field;if(!(e.constructor.simpleRenderer&&!Object.prototype.hasOwnProperty.call(e.data,"renderer"))||r[t]){const e=i.getCell(t);e&&i.renderCell(e)}}))}}refreshFromRowOnStoreAdd(e,t){const r=this,{rowManager:n}=r;n.renderFromRow(e),n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),1===r.store.count&&r.callEachSubGrid("refreshFakeScroll")}onMaskAutoClose(e){super.onMaskAutoClose(e),this.toggleEmptyText()}onStoreAdd({source:e,records:t,index:r,oldIndex:n,isChild:i,oldParent:s,parent:a,isMove:o,isExpandAll:l}){var c;const d=this,{rowManager:u}=d;if(!d.isPainted||l||d.refreshSuspended||e.isSyncingDataOnLoad||(null==(c=e.project)?void 0:c.applyingChangeset))return;const h=o&&t.some((t=>{if(o[t.id]){const r=e.getById(t.meta.modified.parentId);return(null==r?void 0:r.isExpanded(e))&&(null==r?void 0:r.ancestorsExpanded(e))}}));if(i&&!t[0].ancestorsExpanded(e)&&!h){if(!a.isLeaf){const e=u.getRowById(a);e&&u.renderRows([e])}return}u.calculateRowCount(!1,!0,!0),e.isFiltered&&(r=e.indexOf(t[0]));const{topIndex:g,rows:p,rowCount:m}=u,f=u.topIndex+u.rowCount-1,v=r,y=r+t.length-1,b=f>=e.count-t.length-1;s||n>-1||i&&o&&Object.values(o).some((e=>e))?u.refresh():v>=g&&v<g+m?d.refreshFromRowOnStoreAdd(p[v-g],...arguments):y>=g&&y<g+m?u.refresh():(b&&r>f&&u.fillBelow(d._scrollTop||0),u.estimateTotalHeight(!0))}onStoreException({action:e,type:t,response:r,exceptionType:n,error:i}){var s;const a=this;let o;switch(t){case"server":o=r.message||a.L("L{unspecifiedFailure}");break;case"exception":o="network"===n?a.L("L{networkFailure}"):(null==i?void 0:i.message)||(null==(s=null==r?void 0:r.parsedJson)?void 0:s.message)||a.L("L{parseFailure}")}a.applyMaskError('<div class="b-grid-load-failure"><div class="b-grid-load-fail">'+a.L("read"===e?"L{loadFailedMessage}":"L{syncFailedMessage}")+"</div>"+((null==r?void 0:r.url)?'<div class="b-grid-load-fail">'+r.url+"</div>":"")+'<div class="b-grid-load-fail">'+a.L("L{serverResponse}")+'</div><div class="b-grid-load-fail">'+o+"</div></div>")}onStoreDataChange({action:e,changes:t,source:r,syncInfo:n}){var i;const s=this;if(this.refreshSuspended||!this.rowManager||r.isSyncingDataOnLoad)return;if(null==(i=super.onStoreDataChange)||i.call(this,...arguments),"dataset"===e&&(s.rowManager.clearKnownHeights(),r.isTree&&r.isFiltered))return;const a=r.isGrouped&&t&&r.groupers.some((e=>e.field in t));s.isPainted&&!a&&s.renderRows(Boolean(!(e in datasetReplaceActions)||s.preserveScrollOnDatasetChange)),s.toggleEmptyText()}onStoreRecordIdChange(){var e;null==(e=super.onStoreRecordIdChange)||e.call(this,...arguments)}onStoreBeforeRequest(){this.applyLoadMask()}onStoreAfterRequest(e){this.loadMask&&!e.exception&&(this.masked=null,this.toggleEmptyText())}needsFullRefreshOnStoreRemove({isCollapse:e}){const t=this._features;return(null==t?void 0:t.group)&&!t.group.disabled||(null==t?void 0:t.groupSummary)&&!t.groupSummary.disabled||this.store.tree&&!e&&this.store.modelClass.convertEmptyParentToLeaf}onStoreRemove({source:e,records:t,isCollapse:r,isChild:n,isMove:i,isCollapseAll:s}){var a;if(!this.isPainted||i||s||e.isSyncingDataOnLoad)return;null==(a=super.onStoreRemove)||a.call(this,...arguments);const o=this,{rowManager:l}=o;if(l.invalidateKnownHeight(t),o.animateRemovingRows&&!r&&!n){const e=t.reduce(((e,t)=>{const r=l.getRowById(t.id);return r&&e.push(r),e}),[]);if(e.length){const t=e[0];return o.isAnimating=!0,EventHelper.onTransitionEnd({element:t._elementsArray[0],property:"left",duration:o.transitionDuration,thisObj:o,handler:()=>{o.isAnimating=!1,e.forEach((e=>!e.isDestroyed&&e.removeCls("b-removing"))),l.refresh(),o.trigger("rowRemove"),o.afterRemove(arguments[0])}}),void e.forEach((e=>e.addCls("b-removing")))}}if(o.needsFullRefreshOnStoreRemove(...arguments))l.refresh(),o.afterRemove(arguments[0]);else{const e=l.topIndex;if(l.calculateRowCount(!1,!0,!0),l.topIndex!==e)l.renderFromRow(l.topRow);else{const{rows:e}=l,r=t.reduce(((t,r)=>{const n=l.getRowById(r.id);return n&&(t=Math.min(t,e.indexOf(n))),t}),e.length);e[r]?!o.refreshSuspended&&l.renderFromRow(e[r]):l.trigger("changeTotalHeight",{totalHeight:l.totalHeight})}o.trigger("rowRemove",{isCollapse:r}),o.afterRemove(arguments[0])}}onFlatStoreMove({from:e,to:t}){const{rowManager:r,store:n}=this,{topIndex:i,rowCount:s}=r,[a,o]=[e,t].sort(((e,t)=>e-t)),l=n.indexOf(n.getAt(a,!0)),c=n.indexOf(n.getAt(o,!0));l>=i&&l<i+s?r.renderFromRow(r.rows[l-i]):c>=i&&c<i+s&&r.refresh()}onStoreReplace({records:e,all:t}){const{rowManager:r}=this;if(t)r.clearKnownHeights(),r.refresh();else{const t=e.reduce(((e,[,t])=>{const r=this.getRowFor(t);return r&&e.push(r),e}),[]);r.invalidateKnownHeight(e),r.renderRows(t)}}relayStoreDataChange(e){if(this.ariaElement.setAttribute("aria-rowcount",this.store.count+1),!this.project)return this.trigger("dataChange",{...e,store:e.source,source:this})}onStoreRemoveAll(){var e;null==(e=super.onStoreRemoveAll)||e.call(this,...arguments),this.isPainted&&(this.rowManager.clearKnownHeights(),this.renderRows(!1),this.toggleEmptyText())}onStoreCommit({changes:e}){if(this.showDirty&&e.modified.length){const t=[];e.modified.forEach((e=>{const r=this.rowManager.getRowFor(e);r&&t.push(r)})),this.rowManager.renderRows(t)}}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}populateHeaderMenu({column:e,items:t}){const r=this,{subGrids:n,regions:i}=r,{parent:s}=e;let a=!0;Object.entries(n).forEach((([o,l])=>{if(!l.sealedColumns&&e.draggable&&o!==e.region&&(!s&&n[e.region].columns.count>1||s&&s.children.length>1)){const s=l.element.compareDocumentPosition(n[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=r.rtl?!s:s,d=i.length>2?r.L("L{moveColumnTo}",r.optionalL(o)):r.L(c?"L{moveColumnRight}":"L{moveColumnLeft}");t[o+"Region"]={targetSubGrid:o,text:d,icon:"b-fw-icon gt-icon-column-move-"+(c?"right":"left"),separator:a,onItem:({item:t})=>{e.traverse((e=>e.region=o)),r.columns.insert(r.columns.indexOf(n[t.targetSubGrid].columns.last)+1,e),r.scrollColumnIntoView(e)}},a=!1}}))}populateCellMenu({record:e,items:t}){}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const t=this,{columns:r}=t;return e.isLocation?e:e.isModel?new Location({grid:t,id:e.id,columnId:r.visibleColumns[0].id}):new Location(ObjectHelper.assign({grid:t},e))}getCell(e){const{store:t,columns:r}=this,{visibleColumns:n}=this.columns,i=isNaN(e.row)?isNaN(e.rowIndex)?t.indexOf(e.record||e.id):e.rowIndex:e.row,s=isNaN(e.column)?isNaN(e.columnIndex)?n.indexOf(e.column||r.getById(e.columnId)||r.get(e.field)||n[0]):e.columnIndex:e.column;return i>-1&&i<t.count&&s>-1&&s<n.length&&this.normalizeCellContext(e).cell||null}getHeaderElement(e){return e.isModel&&(e=e.id),this.fromCache('.b-grid-header[data-column-id="'+e+'"]')}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.isPainted&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}get footerHeight(){const e=this;return e.isPainted&&!e._footerHeight&&(e._footerHeight=e.footerContainer.offsetHeight),e._footerHeight}get isTreeGrouped(){var e;return Boolean(null==(e=this.features.treeGroup)?void 0:e.isGrouped)}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=e.closest(".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const r=DomDataStore.get(t);return this.columns.getById(r.columnId)}updateAutoHeight(e){ObjectHelper.assertBoolean(e,"autoHeight")}get columnLines(){return this._columnLines}set columnLines(e){ObjectHelper.assertBoolean(e,"columnLines"),DomHelper.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}get keyMapElement(){return this.bodyElement}fixSizes(){this.callEachSubGrid("fixWidths");const e=this.headerContainer.querySelectorAll(".b-grid-header.b-depth-0");for(let t=0,{length:r}=e;t<r;t++)e[t].setAttribute("aria-colindex",t+1)}onRowManagerChangeTotalHeight({totalHeight:e,immediate:t}){return this.refreshTotalHeight(e,t)}refreshTotalHeight(e=this.rowManager.totalHeight,t=!1){const r=this;if(r.renderingRows||!r.isVisible)return!1;const n=r.scrollable,i=Math.abs(r.virtualScrollHeight-e),s=r._bodyRectangle.height;if(i){const a=e-s-r._scrollTop<2*s||r._verticalScrollHeight&&r._verticalScrollHeight-s<r._scrollTop;n.scrollHeight=r.virtualScrollHeight=e,r.isPainted&&(r.scrolling&&!a||i<100)&&!t?r.bufferedFixElementHeights():(r.virtualScrollHeightDirty&&r.virtualScrollHeightDirty(),r.bufferedFixElementHeights.cancel(),r.fixElementHeights())}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,r=t+"px";e._verticalScrollHeight=t,e.verticalScroller.style.height=r,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=r,e._bodyHeight=t,e.refreshBodyRectangle()),e.refreshVirtualScrollbars()}refreshBodyRectangle(){return this._bodyRectangle=Rectangle.client(this.bodyContainer)}set scrolling(e){this._scrolling=e}get scrolling(){return this._scrolling}enableScrollingCloseToEdges(e){this.scrollManager.startMonitoring({scrollables:[{element:this.scrollable.element,direction:"vertical"},...ArrayHelper.asArray(e||[]).map((e=>({element:("string"==typeof e?this.subGrids[e]:e).scrollable.element})))],direction:"horizontal"})}disableScrollingCloseToEdges(e){this.scrollManager.stopMonitoring([this.scrollable.element,...ArrayHelper.asArray(e||[]).map((e=>("string"==typeof e?this.subGrids[e]:e).element))])}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this,{scrollable:t}=e;e.scrollInitialized||(e.scrollInitialized=!0,t.contentElement=e.contentElement,t.ion({scroll:"onGridVerticalScroll",scrollend:"onGridVerticalScrollEnd",thisObj:e}),e.callEachSubGrid("initScroll"),BrowserHelper.isMobileSafari&&(t.element.style.transform="translate3d(0, 0, 0)"))}onGridVerticalScroll({source:e}){const t=this,{y:r}=e;r!==t._scrollTop&&(t._scrollTop=r,t.scrolling||(t.scrolling=!0,t.eachSubGrid((e=>e.suspendResizeMonitor=!0))),t.rowManager.updateRenderedRows(r),t.afterScroll({scrollTop:r}),t.trigger("scroll",{scrollTop:r}))}onGridVerticalScrollEnd(){this.scrolling=!1,this.eachSubGrid((e=>e.suspendResizeMonitor=!1))}async scrollRowIntoView(e,t=defaultScrollOptions3){var r;const n=this,i=t.block||"nearest",{rowManager:s}=n,a=n.store.getById(e);if(a){let e;if(-1===n.store.indexOf(a))return resolvedPromise;let o=n.scrollable,l=n.getRecordCoords(a);const c=Rectangle.from(o.element);if(!l.virtual){let{column:e}=t;if(e){if(e.isModel||(e=n.columns.getById(e)||n.columns.get(e)),e){o=n.getSubGridFromColumn(e).scrollable;const t=Rectangle.from(s.getRowFor(a).getCell(e.id));l.x=t.x,l.width=t.width}}else t.x=!1;return o.scrollIntoView(l,t)}{const d=l.block,u="nearest"!==i?t:{block:d};if(e=o.scrollIntoView(l,{block:"center"}),s.scrollTargetRecordId=a,s.updateRenderedRows(o.y,!0),l=n.getRecordCoords(a),s.lastScrollTop=o.y,l.virtual)return resolvedPromise;t.animate?(o.suspendEvents(),"end"===i||"nearest"===i&&"end"===d?o.y-=c.bottom-l.bottom:("start"===i||"nearest"===i&&"start"===d)&&(o.y+=l.y-c.y),s.updateRenderedRows(o.y,!1,!0),"end"===d?o.y-=s.appendRowBuffer*s.rowHeight-1:o.y+=s.prependRowBuffer*s.rowHeight-1,o.scrollIntoView(n.getRecordCoords(a),Object.assign({},t,u)),o.resumeEvents()):(t.recursive||await e,await(null==(r=n.scrollRowIntoView)?void 0:r.call(n,a,Object.assign({recursive:!0},t,u))))}}}scrollColumnIntoView(e,t){return e=e instanceof Column?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},"boolean"==typeof t?{animate:t}:t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this,t=e.storedScrollState={scrollTop:e.scrollable.y,scrollLeft:{}};return e.eachSubGrid((e=>{t.scrollLeft[e.region]=e.scrollable.x})),t}restoreScroll(e=this.storedScrollState){this.eachSubGrid((t=>{var r;const n=e.scrollLeft[t.region];null!=n&&(t.scrollable.updateX(n),t.header.scrollable.updateX(n),t.footer.scrollable.updateX(n),null==(r=t.fakeScroller)||r.updateX(n))})),this.scrollable.updateY(e.scrollTop)}beginGridMeasuring(){const e=this;if(e.$measureCellElements||(e.$measureCellElements=DomHelper.createElement({className:"b-grid-subgrid "+(!e._isRowMeasured&&e.hasFeature("stripe")?"b-stripe":""),reference:"subGridElement",style:{position:"absolute",top:"-10000px",left:"-100000px",visibility:"hidden",contain:"strict"},children:[{className:"b-grid-row",reference:"rowElement",children:[{className:"b-grid-cell",reference:"cellElement",style:{width:"auto",contain:BrowserHelper.isFirefox?"layout paint":"layout style paint"}}]}]})),e.getConfig("element"),e.verticalScroller.appendChild(e.$measureCellElements.subGridElement),!e.rendered){const t=e.appendTo||e.insertBefore||document.body,r=DomHelper.getRootElement("string"==typeof t?document.getElementById(t):t)||document.body;e.adopt&&r.contains(e.element)||(r.appendChild(e.element),e.$removeAfterMeasuring=!0)}return e.$measureCellElements}endGridMeasuring(){this.$removeAfterMeasuring&&(this.element.remove(),this.$removeAfterMeasuring=!1),this.$measureCellElements.subGridElement.remove()}measureRowHeight(){const e=this,{rowElement:t}=e.beginGridMeasuring(),r=DomHelper.getStyleValue(t,["height","border-top-width","border-bottom-width"]),n=parseInt(r.height),i=BrowserHelper.isFirefox?globalThis.devicePixelRatio/Math.max(Math.trunc(globalThis.devicePixelRatio),1):1,s=r["border-top-width"]?Math.round(i*parseFloat(r["border-top-width"])):0,a=r["border-bottom-width"]?Math.round(i*parseFloat(r["border-bottom-width"])):0;null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(n)&&n?n:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+a,e._isRowMeasured=!0,e.endGridMeasuring()}onThemeChange({theme:e}){this.whenVisible("measureRowHeight"),this.trigger("theme",{theme:e})}refreshRows(e=!1){const{element:t,rowManager:r}=this;t.classList.add("b-notransition"),e?r.returnToTop():r.refresh(),t.classList.remove("b-notransition")}refreshColumn(e){e.isVisible&&(e.isLeaf?this.rowManager.forEach((t=>t.renderCell(t.getCell(e.id)))):e.children.forEach((e=>this.refreshColumn(e))))}refreshVirtualScrollbars(){const e=this,{headerContainer:t,footerContainer:r,virtualScrollers:n,scrollable:i,hasVerticalOverflow:s}=e,{classList:a}=n,o=!a.contains("b-hide-display"),l=Object.values(e.subGrids).some((e=>e.overflowingHorizontally)),c=l!==o;if(c&&n.classList.toggle("b-hide-display",!l),DomHelper.scrollBarWidth){const a=s||"scroll"===i.overflowY;t.classList.toggle("b-show-yscroll-padding",a),r.classList.toggle("b-show-yscroll-padding",a),n.classList.toggle("b-show-yscroll-padding",a),c&&(l&&e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange())}}get hasVerticalOverflow(){return this.scrollable.hasOverflow("y")}get contentHeight(){const e=this.rowManager;return Math.max(e.totalHeight,e.bottomRow?e.bottomRow.bottom:0)}onContentChange(){const e=this,t=e.rowManager;e.isVisible?(t.estimateTotalHeight(),e.paintListener=null,e.refreshTotalHeight(e.contentHeight),e.callEachSubGrid("refreshFakeScroll"),e.onHeightChange()):e.paintListener||(e.paintListener=e.ion({paint:"onContentChange",once:!0,thisObj:e}))}triggerPaint(){this.isPainted||this.refreshBodyRectangle(),super.triggerPaint()}onHeightChange(){const e=this;e.refreshBodyRectangle(),e._bodyHeight=e.autoHeight?e.contentHeight:e.bodyContainer.offsetHeight}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&! --this.refreshSuspended&&(e&&this.refreshRows(),this.trigger("resumeRefresh",{trigger:e}))}renderRows(e=!0){const t=this,r=e&&t.storeScroll();t.refreshSuspended||(t.trigger("beforeRenderRows"),t.renderingRows=!0,t.element.classList.add("b-grid-refreshing"),e||(t.scrollable.y=t._scrollTop=0),t.rowManager.reinitialize(!e),t.trigger("renderRows"),t.renderingRows=!1,t.onContentChange(),e&&t.restoreScroll(r),t.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,{element:t,headerContainer:r,footerContainer:n,rowManager:i}=e;if(e.emptyCache(),e.isPainted){e._headerHeight=null,e.callEachSubGrid("refreshHeader",r),e.callEachSubGrid("refreshFooter",n),e.renderHeader(r,t),e.renderFooter(n,t),e.fixSizes();const s=i.removeAllRows();i.calculateRowCount(!1,!0,!0),i.rowCount&&(i.setPosition(s),e.renderRows())}}onPaintOverride(){}onPaint({firstPaint:e}){var t;const r=this;if(r.ariaElement.setAttribute("aria-rowcount",r.store.count+1),null==(t=super.onPaint)||t.call(this,...arguments),r.onPaintOverride()||!e)return;const{rowManager:n,store:i,element:s,headerContainer:a,bodyContainer:o,footerContainer:l}=r,c=DomHelper.scrollBarPadElement;let d,u=0;r.role=(null==i?void 0:i.isTree)?"treegrid":"grid",r.columns.ion({change:()=>d=!0,once:!0}),r.updateResponsive(r.width,0),d&&(r.callEachSubGrid("refreshHeader",a),r.callEachSubGrid("refreshFooter",l)),r.renderHeader(a,s),r.renderFooter(l,s),DomHelper.append(a,c),DomHelper.append(l,c),DomHelper.append(r.virtualScrollers,c),r.refreshBodyRectangle();const h=r.bodyContainer.offsetHeight;if(r.autoHeight?(r._bodyHeight=n.initWithHeight(s.offsetHeight-a.offsetHeight-l.offsetHeight,!0),o.style.height=r.bodyHeight+"px"):(r._bodyHeight=h,n.initWithHeight(r._bodyHeight,!0)),r.eachSubGrid((e=>{e.header.maxDepth>u&&(u=e.header.maxDepth)})),a.dataset.maxDepth=u,r.fixSizes(),!i.count&&i.isLoading||r.renderRows(),r.columns.usesAutoHeight){const{fonts:e}=document;"loaded"!==(null==e?void 0:e.status)&&e.ready.then((()=>!r.isDestroyed&&r.refreshRows()))}r.initScroll(),r.initInternalEvents()}render(){const e=this;e.requireSize=Boolean(e.owner),super.render(...arguments),e.autoHeight||(e.headerContainer.offsetHeight&&!e.bodyContainer.offsetHeight&&console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget"),"minHeight"in e.initialConfig||"height"in e.initialConfig||parseInt(globalThis.getComputedStyle(e.element).minHeight)!==e.height||console.warn("The "+e.$$name+' is sized by its predefined minHeight, likely this is not intended. Please check your CSS and review how you size the widget, or assign a fixed height in the config. For more information, see the "Basics/Sizing the component" guide in docs.'))}renderHeader(e,t){}renderFooter(e,t){}beforeRenderCell(){}beforeRenderRow(){}afterRenderRow(){}afterScroll(){}processCellEditor(e){}afterColumnsChange(){}afterRemove(e){}afterToggleGroup(){}afterToggleSubGrid(){}syncMaskCover(e=this.masked){if(e){const t="body"===e.cover&&this.rectangleOf("bodyContainer"),r=t&&this.rectangleOf("virtualScrollers"),{style:n}=e.element;n.marginTop=t?t.y+"px":"",n.height=t?t.height+((null==r?void 0:r.height)||0)+"px":""}}maskBody(e){let t;return this.bodyContainer&&(this.masked=Mask.mergeConfigs(this.loadMaskDefaults,e),t=this.masked),t}unmaskBody(){this.masked=null}updateEmptyText(e){var t,r;null==(t=this.emptyTextEl)||t.remove(),this.emptyTextEl=DomHelper.createElement({parent:null==(r=this.firstItem)?void 0:r.element,className:"b-empty-text",[(null==e?void 0:e.includes("<"))?"html":"text"]:e})}toggleEmptyText(){const{bodyContainer:e,store:t}=this;null==e||e.classList.toggle("b-grid-empty",!(t.count>0||t.isLoading||t.isCommitting))}updateReadOnly(e,t){var r;if(super.updateReadOnly(e,t),!this.isConfiguring)for(const t of this.columns.bottomColumns)null==(r=t.updateReadOnly)||r.call(t,e)}getCurrentConfig(e){const t=super.getCurrentConfig(e),{store:r}=this,n=r.getInlineData(e),i=r.getCurrentConfig(e)||t.store;return n.length&&(t.data=n),i&&r.originalModelClass===GridRowModel&&delete i.modelClass,ObjectHelper.isEmpty(i)||(t.store=i),t.store&&delete t.store.data,t}};GridBase.initClass(),VersionHelper.setVersion("grid","5.3.4"),GridBase._$name="GridBase";var Grid=class extends GridBase{static get $name(){return"Grid"}static get type(){return"grid"}};Grid.initClass(),Grid._$name="Grid";var TreeGrid=class extends Grid{static get $name(){return"TreeGrid"}static get type(){return"treegrid"}static get configurable(){return{store:{tree:!0}}}updateStore(e,t){if(e&&!e.tree)throw new Error("TreeGrid requires a Store configured with tree : true");super.updateStore(e,t)}};TreeGrid.initClass(),TreeGrid._$name="TreeGrid";var TreeCombo=class extends Combo{configure(e){super.configure(e);const t=this;t.ion({change(){t.picker.selectedRecords=t.value}})}changePicker(e,t){const r=this;return super.changePicker(ObjectHelper.assign({},e,{type:"treegrid",minWidth:"35em",readOnly:r.readOnly,disableGridRowModelWarning:!0,selectedRecords:r.value.map((e=>r.store.getById(e))),selectionMode:{row:!0,multiSelect:r.multiSelect,rowCheckboxSelection:!0},internalListeners:{selectionChange({selection:e}){r.value=e}}}),t)}};__publicField(TreeCombo,"$name","TreeCombo"),__publicField(TreeCombo,"type","treecombo"),__publicField(TreeCombo,"configurable",{multiSelect:!0,chipView:{itemTpl:e=>StringHelper.xss`${e.name}`,scrollable:{overflowX:"hidden-scroll"}}}),TreeCombo.initClass(),TreeCombo._$name="TreeCombo";var diffSecond=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()+t,e.getMilliseconds()),later=function(){"use strict";var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var i=n>=0?n:Math.max(r-Math.abs(n),0);i<r;i++)if(i in t&&t[i]===e)return i;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort((function(e,t){return+e-+t})),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,r){for(var n,i=0!==r[0],s=0,a=t.length-1;a>-1;--a){if((n=t[a])===e)return n;if(!(n>e||0===n&&i&&r[1]>e))break;s=a}return t[s]},e.array.nextInvalid=function(e,t,r){for(var n=r[0],i=r[1],s=t.length,a=0===t[s-1]&&0!==n?i:0,o=e,l=t.indexOf(e),c=o;o===(t[l]||a);)if(++o>i&&(o=n),++l===s&&(l=0),o===c)return;return o},e.array.prev=function(e,t,r){for(var n,i=t.length,s=0!==r[0],a=i-1,o=0;o<i;o++){if((n=t[o])===e)return n;if(!(n<e||0===n&&s&&r[1]<e))break;a=o}return t[a]},e.array.prevInvalid=function(e,t,r){for(var n=r[0],i=r[1],s=t.length,a=0===t[s-1]&&0!==n?i:0,o=e,l=t.indexOf(e),c=o;o===(t[l]||a);)if(--o<n&&(o=i),-1===--l&&(l=s-1),o===c)return;return o},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,r){return e.D.val(t)===(r||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var r=e.M.val(t),n=e.DAYS_IN_MONTH[r-1];return 2===r&&366===e.dy.extent(t)[1]&&(n+=1),t.DExtent=[1,n]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,r){r=r>e.D.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.D,e.M),i=e.D.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.D,e.M),i=e.D.extent(n)[1];return e.date.prev(e.Y.val(n),e.M.val(n),r>i?i:r||i)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,r){return e.dc.val(t)===r||0===r&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,r){r=r>e.dc.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dc,e.M);r=r>e.dc.extent(n)[1]?1:r;var i=e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1));return i.getTime()<=t.getTime()?(n=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(n),e.M.val(n),0===r?e.D.extent(n)[1]-6:1+7*(r-1))):i},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dc,e.M),i=e.dc.extent(n)[1];return r=r>i?i:r||i,e.dc.end(e.date.prev(e.Y.val(n),e.M.val(n),1+7*(r-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,r){return e.dw.val(t)===(r||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){return r=r>7?1:r||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r<=e.dw.val(t)?7:0))},prev:function(t,r){return r=r>7?7:r||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r-e.dw.val(t))+(r>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,r){return e.dy.val(t)===(r||e.dy.extent(t)[1])},extent:function(t){var r=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,r%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,r){r=r>e.dy.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.dy,e.Y),i=e.dy.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),r)},prev:function(t,r){var n=e.date.prevRollover(t,r,e.dy,e.Y),i=e.dy.extent(n)[1];return r=r>i?i:r||i,e.date.prev(e.Y.val(n),e.M.val(n),r)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,r){return e.h.val(t)===r},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,r){r=r>23?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.h.val(t)?1:0),r);return!e.date.isUTC&&n.getTime()<=t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),r+1)),n},prev:function(t,r){return r=r>23?23:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.h.val(t)?-1:0),r)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,r){return e.m.val(t)===r},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,r){var n=e.m.val(t),i=e.s.val(t),s=r>59?60-n:r<=n?60-n+r:r-n,a=new Date(t.getTime()+s*e.MIN-i*e.SEC);return!e.date.isUTC&&a.getTime()<=t.getTime()&&(a=new Date(t.getTime()+(s+120)*e.MIN-i*e.SEC)),a},prev:function(t,r){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(r>=e.m.val(t)?-1:0),r)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,r){return e.M.val(t)===(r||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,r){return r=r>12?1:r||12,e.date.next(e.Y.val(t)+(r>e.M.val(t)?0:1),r)},prev:function(t,r){return r=r>12?12:r||12,e.date.prev(e.Y.val(t)-(r>=e.M.val(t)?1:0),r)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,r){return e.s.val(t)===r},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,r){var n=e.s.val(t),i=r>59?60-n:r<=n?60-n+r:r-n,s=new Date(t.getTime()+i*e.SEC);return!e.date.isUTC&&s.getTime()<=t.getTime()&&(s=new Date(t.getTime()+(i+7200)*e.SEC)),s},prev:function(t,r,n){return r=r>59?59:r,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(r>=e.s.val(t)?-1:0),r)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,r){return e.t.val(t)===r},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,r){r=r>86399?0:r;var n=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r<=e.t.val(t)?1:0),0,0,r);return!e.date.isUTC&&n.getTime()<t.getTime()&&(n=e.date.next(e.Y.val(n),e.M.val(n),e.D.val(n),e.h.val(n),e.m.val(n),r+7200)),n},prev:function(t,r){return r=r>86399?86399:r,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(r>=e.t.val(t)?-1:0),0,0,r)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,r){return e.wm.val(t)===(r||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,r){r=r>e.wm.extent(t)[1]?1:r;var n=e.date.nextRollover(t,r,e.wm,e.M),i=e.wm.extent(n)[1];return r=r>i?1:r||i,e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2)))},prev:function(t,r){var n=e.date.prevRollover(t,r,e.wm,e.M),i=e.wm.extent(n)[1];return r=r>i?i:r||i,e.wm.end(e.date.next(e.Y.val(n),e.M.val(n),Math.max(1,7*(r-1)-(e.dw.val(n)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var r=e.dw.next(e.wy.start(t),5),n=e.dw.next(e.Y.prev(r,e.Y.val(r)-1),5);return t.wy=1+Math.ceil((r.getTime()-n.getTime())/e.WEEK)},isValid:function(t,r){return e.wy.val(t)===(r||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var r=e.dw.next(e.wy.start(t),5),n=e.dw.val(e.Y.start(r)),i=e.dw.val(e.Y.end(r));return t.wyExtent=[1,5===n||5===i?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,r){r=r>e.wy.extent(t)[1]?1:r;var n=e.dw.next(e.wy.start(t),5),i=e.date.nextRollover(n,r,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],a=e.wy.start(i);return r=r>s?1:r||s,e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(r-1))},prev:function(t,r){var n=e.dw.next(e.wy.start(t),5),i=e.date.prevRollover(n,r,e.wy,e.Y);1!==e.wy.val(i)&&(i=e.dw.next(i,2));var s=e.wy.extent(i)[1],a=e.wy.end(i);return r=r>s?s:r||s,e.wy.end(e.date.next(e.Y.val(a),e.M.val(a),e.D.val(a)+7*(r-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,r){return e.Y.val(t)===r},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,r){return r>e.Y.val(t)&&r<=e.Y.extent()[1]?e.date.next(r):e.NEVER},prev:function(t,r){return r<e.Y.val(t)&&r>=e.Y.extent()[0]?e.date.prev(r):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,r){return e.fd.val(t)===r},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,r){return e.fd.val(t)<r?new Date(r):e.NEVER},prev:function(t,r){return e.fd.val(t)>r?new Date(r):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var r=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-r)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n!=r&&(n=e.extent(t)[0]),e.next(t,n)},prev:function(t,n){return n=n===r?e.extent(t)[1]:r-1,e.prev(t,n)}}},e.modifier.before=e.modifier.b=function(e,t){var r=t[t.length-1];return{name:"before "+e.name,range:e.range*(r-1),val:e.val,isValid:function(e,t){return this.val(e)<r},extent:e.extent,start:e.start,end:e.end,next:function(t,n){return n=n===r?e.extent(t)[0]:r,e.next(t,n)},prev:function(t,n){return n=n===r?r-1:e.extent(t)[1],e.prev(t,n)}}},e.compile=function(t){var r,n=[],i=0;for(var s in t){var a=s.split("_"),o=a[0],l=a[1],c=t[s],d=l?e.modifier[l](e[o],c):e[o];n.push({constraint:d,vals:c}),i++}return n.sort((function(e,t){var r=e.constraint.range,n=t.constraint.range;return n<r?-1:n>r?1:0})),r=n[i-1].constraint,{start:function(t,s){for(var a,o=s,l=e.array[t],c=1e3;c--&&!a&&o;){a=!0;for(var d=0;d<i;d++){var u=n[d].constraint,h=u.val(o),g=u.extent(o),p=l(h,n[d].vals,g);if(!u.isValid(o,p)){o=u[t](o,p),a=!1;break}}}return o!==e.NEVER&&(o="next"===t?r.start(o):r.end(o)),o},end:function(t,r){for(var s,a=e.array[t+"Invalid"],o=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=i-1;l>=0;l--){var c,d=n[l].constraint,u=d.val(r),h=d.extent(r),g=a(u,n[l].vals,h);void 0!==g&&(!(c=d[t](r,g))||s&&!o(s,c)||(s=c))}return s},tick:function(t,n){return new Date("next"===t?r.end(n).getTime()+e.SEC:r.start(n).getTime()-e.SEC)},tickSafe:function(e,t){return"next"===e?diffSecond(r.end(t),1):diffSecond(r.start(t),-1)},tickStart:function(e){return r.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var r=[],n=t.schedules.length,i=[],s=t.exceptions?t.exceptions.length:0,a=0;a<n;a++)r.push(e.compile(t.schedules[a]));for(var o=0;o<s;o++)i.push(e.compile(t.exceptions[o]));function l(t,n,a,o,l){var b,C,D,S=v(t),E=n,w=1e6,R=[],x=[],T=[],M="next"===t,P=M?0:1,F=M?1:0;if(!(a=a?new Date(a):new Date)||!a.getTime())throw new Error("Invalid start date.");for(!function(e,t,r,n){for(var i=0,s=t.length;i<s;i++)r[i]=t[i].start(e,n)}(t,r,R,a),function(t,r,n,i){v(t);for(var s=0,a=r.length;s<a;s++){var o=r[s].start(t,i);n[s]=o?[o,r[s].end(t,o)]:e.NEVER}}(t,i,x,a);w--&&E&&(b=y(R,S))&&(!o||!S(b,o));)if(s&&(u(t,i,x,b),C=p(t,x,b)))d(t,r,R,C);else{if(l){var I=m(x,S);C=f(t,r,R,b,I);var A=M?[new Date(Math.max(a,b)),C?new Date(o?Math.min(C,o):C):void 0]:[C?new Date(o?Math.max(o,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(a,b.getTime()+e.SEC))];if(D&&A[P].getTime()===D[F].getTime()?(D[F]=A[F],E++):(D=A,T.push(D)),!C)break;d(t,r,R,C)}else T.push(M?new Date(Math.max(a,b)):g(r,R,b,o)),h(t,r,R,b);E--}for(var O=0,k=T.length;O<k;O++){var _=T[O];T[O]="[object Array]"===Object.prototype.toString.call(_)?[c(_[0]),c(_[1])]:c(_)}return 0===T.length?e.NEVER:1===n?T[0]:T}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,r,n){for(var i=v(e),s=0,a=t.length;s<a;s++)r[s]&&!i(r[s],n)&&(r[s]=t[s].start(e,n))}function u(t,r,n,i){for(var s=v(t),a=0,o=r.length;a<o;a++)if(n[a]&&!s(n[a][0],i)){var l=r[a].start(t,i);n[a]=l?[l,r[a].end(t,l)]:e.NEVER}}function h(t,r,n,i){for(var s=0,a=r.length;s<a;s++)if(n[s]&&n[s].getTime()===i.getTime()){const a=r[s].start(t,r[s].tick(t,i));a!==e.NEVER&&a.getTime()===n[s].getTime()?n[s]=r[s].start(t,r[s].tickSafe(t,i)):n[s]=a}}function g(e,t,r,n){for(var i,s=0,a=t.length;s<a;s++)if(t[s]&&t[s].getTime()===r.getTime()){var o=e[s].tickStart(r);if(n&&o<n)return n;(!i||o>i)&&(i=o)}return i}function p(e,t,r){for(var n,i=v(e),s=0,a=t.length;s<a;s++){var o=t[s];!o||i(o[0],r)||o[1]&&!i(o[1],r)||n&&!i(o[1],n)||(n=o[1])}return n}function m(e,t){for(var r,n=0,i=e.length;n<i;n++)!e[n]||r&&!t(r,e[n][0])||(r=e[n][0]);return r}function f(e,t,r,n,i){for(var s,a=v(e),o=0,l=t.length;o<l;o++){var c=r[o];if(c&&c.getTime()===n.getTime()){var d=t[o].end(e,c);if(i&&(!d||a(d,i)))return i;s&&!a(d,s)||(s=d)}}return s}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var r=e[0],n=1,i=e.length;n<i;n++)e[n]&&t(r,e[n])&&(r=e[n]);return r}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,r){return l("next",e||1,t,r)},prev:function(e,t,r){return l("prev",e||1,t,r)},nextRange:function(e,t,r){return l("next",e||1,t,r,!0)},prevRange:function(e,t,r){return l("prev",e||1,t,r,!0)}}},e.setTimeout=function(t,r){var n,i=e.schedule(r);return t&&function e(){var r=Date.now(),s=i.next(2,r);if(!s[0])return void(n=void 0);var a=s[0].getTime()-r;a<1e3&&(a=s[1]?s[1].getTime()-r:1e3);n=a<2147483647?setTimeout(t,a):setTimeout(e,2147483647)}(),{isDone:function(){return!n},clear:function(){clearTimeout(n)}}},e.setInterval=function(t,r){if(t){var n=e.setTimeout((function s(){i||(t(),n=e.setTimeout(s,r))}),r),i=n.isDone();return{isDone:function(){return n.isDone()},clear:function(){i=!0,n.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,r,n,i,s){return new Date(e,t,r,n,i,s)}:function(e,t,r,n,i,s){return new Date(Date.UTC(e,t,r,n,i,s))};var r=t?"get":"getUTC",n=Date.prototype;e.date.getYear=n[r+"FullYear"],e.date.getMonth=n[r+"Month"],e.date.getDate=n[r+"Date"],e.date.getDay=n[r+"Day"],e.date.getHour=n[r+"Hours"],e.date.getMin=n[r+"Minutes"],e.date.getSec=n[r+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,r,n,i,s,a){return e.date.build(t,void 0!==r?r-1:0,void 0!==n?n:1,i||0,s||0,a||0)},e.date.nextRollover=function(t,r,n,i){var s=n.val(t),a=n.extent(t)[1];return(r||a)<=s||r>a?new Date(i.end(t).getTime()+e.SEC):i.start(t)},e.date.prev=function(t,r,n,i,s,a){var o=arguments.length;return r=o<2?11:r-1,n=o<3?e.D.extent(e.date.next(t,r+1))[1]:n,i=o<4?23:i,s=o<5?59:s,a=o<6?59:a,e.date.build(t,r,n,i,s,a)},e.date.prevRollover=function(e,t,r,n){return t>=r.val(e)||!t?n.start(n.prev(e,n.val(e)-1)):n.start(e)},e.parse={},e.parse.cron=function(e,t){var r={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},n={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},i={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function s(e,t,n){return isNaN(e)?r[e]||null:Math.min(+e+(t||0),n||9999)}function a(e,t,r,n,i){var s=r;for(e[t]||(e[t]=[]);s<=n;)e[t].indexOf(s)<0&&e[t].push(s),s+=i||1;e[t].sort((function(e,t){return e-t}))}function o(e,t,r,n){(t.d&&!t.dc||t.dc&&t.dc.indexOf(n)<0)&&(e.push(function(e){var t,r={};for(t in e)"dc"!==t&&"d"!==t&&(r[t]=e[t].slice(0));return r}(t)),t=e[e.length-1]),a(t,"d",r,r),a(t,"dc",n,n)}function l(e,t,n,i,l,c){var d,u,h=t.schedules,g=h[h.length-1];"L"===e&&(e=i-1),null!==(d=s(e,c,l))?a(g,n,d,d):null!==(d=s(e.replace("W",""),c,l))?function(e,t,n){var i={},s={};1===n?(a(t,"D",1,3),a(t,"d",r.MON,r.FRI),a(i,"D",2,2),a(i,"d",r.TUE,r.FRI),a(s,"D",3,3),a(s,"d",r.TUE,r.FRI)):(a(t,"D",n-1,n+1),a(t,"d",r.MON,r.FRI),a(i,"D",n-1,n-1),a(i,"d",r.MON,r.THU),a(s,"D",n+1,n+1),a(s,"d",r.TUE,r.FRI)),e.exceptions.push(i),e.exceptions.push(s)}(t,g,d):null!==(d=s(e.replace("L",""),c,l))?o(h,g,d,i-1):2===(u=e.split("#")).length?o(h,g,d=s(u[0],c,l),s(u[1])):function(e,t,r,n,i,o){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");n=s(u[0],o,i),i=s(u[1],o,i)||i}a(t,r,n,i,c)}(e,g,n,i,l,c)}function c(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function d(e,t){return c(e)&&!c(t)?1:e-t}var u,h=(u=e.toUpperCase(),n[u]||u);return function(e){var t,r,n,s,a={schedules:[{}],exceptions:[]},o=e.replace(/(\s)+/g," ").split(" ");for(t in i)if((n=o[(r=i[t])[0]])&&"*"!==n&&"?"!==n){var c,u=(s=n.split(",").sort(d)).length;for(c=0;c<u;c++)l(s[c],a,t,r[1],r[2],r[3])}return a}(t?h:"0 "+h)},e.parse.recur=function(){var t,r,n,i,s,a,o,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=s?e+"_"+s:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),r=t[e],i){for(n=[],l=d;l<=u;l+=i)n.push(l);c={n:e,x:i,c:r.length,m:u}}var g=(n=a?[d]:o?[u]:n).length;for(l=0;l<g;l+=1){var p=n[l];r.indexOf(p)<0&&r.push(p)}n=i=s=a=o=0}return{schedules:d,exceptions:u,on:function(){return n=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return i=e||1,this},after:function(e){return s="a",n=[e],this},before:function(e){return s="b",n=[e],this},first:function(){return a=1,this},last:function(){return o=1,this},time:function(){for(var e=0,t=n.length;e<t;e++){var r=n[e].split(":");r.length<3&&r.push(0),n[e]=3600*+r[0]+60*+r[1]+ +r[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,o?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return n=[1,7],this.dayOfWeek()},onWeekday:function(){return n=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,o?0:5),this},dayOfYear:function(){return g("dy",1,o?0:366),this},weekOfMonth:function(){return g("wm",1,o?0:5),this},weekOfYear:function(){return g("wy",1,o?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=n.length;e<t;e++)n[e]=n[e].getTime();return g("fd"),this},customModifier:function(t,r){if(!e.modifier[t])throw new Error("Custom modifier "+t+" not recognized!");return s=t,n=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var r=e[t];if(!r)throw new Error("Custom time period "+t+" not recognized!");return g(t,r.extent(new Date)[0],r.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,r){return t[c.n]=t[c.n].splice(0,c.c),i=c.x,g(c.n,e,r),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var r,n=e.parse.recur,i=0,s="",a={eof:/^$/,fullDate:/^(\d\d\d\d-\d\d-\d\dt\d\d:\d\d:\d\d)\b/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},o={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,r,n){return{startPos:e,endPos:t,text:r,type:n}}function c(e){var t,r,n,a,o,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),o=i;!t||t.type===u;){c=-1,r=s.substring(o),t=l(o,o,s.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(n=(a=d[h]).exec(r))&&0===n.index&&n[0].length>c&&(t=l(o,o+(c=n[0].length),r.substring(0,c),a));t.type===u&&(o=t.endPos)}return t}function d(e){var t=c(e);return i=t.endPos,t}function u(e){for(var t=+y(e),r=f(a.through)?+y(e):t,n=[],i=t;i<=r;i++)n.push(i);return n}function h(e){for(var t=u(e);f(a.and);)t=t.concat(u(e));return t}function g(e){var t,r,n,i;f(a.weekend)?e.on(o.sun,o.sat).dayOfWeek():f(a.weekday)?e.on(o.mon,o.tue,o.wed,o.thu,o.fri).dayOfWeek():(t=y(a.rank),e.every(t),r=m(e),f(a.start)?(t=y(a.rank),e.startingOn(t),v(r.type)):f(a.between)&&(n=y(a.rank),f(a.and)&&(i=y(a.rank),e.between(n,i))))}function p(e){f(a.first)?e.first():f(a.last)?e.last():e.on(h(a.rank)),m(e)}function m(e){var t=v([a.second,a.minute,a.hour,a.dayOfYear,a.dayOfWeek,a.dayInstance,a.day,a.month,a.year,a.weekOfMonth,a.weekOfYear]);switch(t.type){case a.second:e.second();break;case a.minute:e.minute();break;case a.hour:e.hour();break;case a.dayOfYear:e.dayOfYear();break;case a.dayOfWeek:e.dayOfWeek();break;case a.dayInstance:e.dayOfWeekCount();break;case a.day:e.dayOfMonth();break;case a.weekOfMonth:e.weekOfMonth();break;case a.weekOfYear:e.weekOfYear();break;case a.month:e.month();break;case a.year:e.year();break;default:r=i}return t}function f(e){var t=c(e).type===e;return t&&d(e),t}function v(e){var t=d(e);return t.type?t.text=function(e,t){var r=e;switch(t){case a.time:var n=e.split(/(:|am|pm)/),i="pm"===n[3]&&n[0]<12?parseInt(n[0],10)+12:n[0],s=n[2].trim();r=(1===i.length?"0":"")+i+":"+s;break;case a.rank:r=parseInt(/^\d+/.exec(e)[0],10);break;case a.monthName:case a.dayName:r=o[e.substring(0,3)];break;case a.fullDate:r=new Date(e.toUpperCase())}return r}(t.text,e):r=i,t}function y(e){return v(e).text}return function(e){i=0,s=e,r=-1;for(var t=n();i<s.length&&r<0;){switch(v([a.every,a.after,a.before,a.onthe,a.on,a.of,a.in,a.at,a.and,a.except,a.also]).type){case a.every:g(t);break;case a.after:void 0!==c(a.time).type?(t.after(y(a.time)),t.time()):void 0!==c(a.fullDate).type?(t.after(y(a.fullDate)),t.fullDate()):(t.after(y(a.rank)),m(t));break;case a.before:void 0!==c(a.time).type?(t.before(y(a.time)),t.time()):void 0!==c(a.fullDate).type?(t.before(y(a.fullDate)),t.fullDate()):(t.before(y(a.rank)),m(t));break;case a.onthe:p(t);break;case a.on:t.on(h(a.dayName)).dayOfWeek();break;case a.of:t.on(h(a.monthName)).month();break;case a.in:t.on(h(a.yearIndex)).year();break;case a.at:for(t.on(y(a.time)).time();f(a.and);)t.on(y(a.time)).time();break;case a.and:break;case a.also:t.and();break;case a.except:t.except();break;default:r=i}}return{schedules:t.schedules,exceptions:t.exceptions,error:r}}(t.toLowerCase())},e}();later.date.localTime();var later_default=later;function split(e){const t=[],r=[];let n;return[function*(){for(n||(n=e[Symbol.iterator]());t.length&&(yield*t,t.length=0),n;){const{value:t,done:i}=n.next();if(i){n=null,e=null;break}r.push(t),yield t}}(),function*(){for(n||(n=e[Symbol.iterator]());r.length&&(yield*r,r.length=0),n;){const{value:r,done:i}=n.next();if(i){n=null,e=null;break}t.push(r),yield r}}()]}function*inBatchesBySize(e,t){if(t<0)throw new Error("Batch size needs to a natural number");t|=0;const r=[];for(const n of e)r.length===t&&(yield r,r.length=0),r.push(n);r.length>0&&(yield r)}function*filter(e,t){let r=0;for(const n of e)t(n,r++)&&(yield n)}function*drop(e,t){let r=0;for(const n of e)++r>t&&(yield n)}function every(e,t){let r=0;for(const n of e)if(!t(n,r++))return!1;return!0}function some(e,t){let r=0;for(const n of e)if(t(n,r++))return!0;return!1}function*map(e,t){let r=0;for(const n of e)yield t(n,r++)}function reduce(e,t,r){let n=0,i=r;for(const r of e)i=t(i,r,n++);return i}function*uniqueOnly(e){const t=new Set;for(const r of e)t.has(r)||(t.add(r),yield r)}function*uniqueOnlyBy(e,t){const r=new Set;for(const n of e){const e=t(n);r.has(e)||(r.add(e),yield n)}}function*takeWhile(e,t){let r=0;for(const n of e){if(!t(n,r++))return;yield n}}function*concat(...e){for(let t=0;t<e.length;t++)yield*e[t]}function*concatIterable(e){for(const t of e)yield*t}var ChainedIteratorClass=class{constructor(e){if(this.iterable=void 0,!e)throw new Error("Require an iterable instance for chaining");this.iterable=e}derive(e){return this.iterable=void 0,new ChainedIteratorClass(e)}copy(){const[e,t]=split(this.iterable);return this.iterable=t,new ChainedIteratorClass(e)}split(){const[e,t]=split(this.iterable);return[new ChainedIteratorClass(e),this.derive(t)]}inBatchesBySize(e){return this.derive(inBatchesBySize(this.iterable,e))}filter(e){return this.derive(filter(this.iterable,e))}drop(e){return this.derive(drop(this.iterable,e))}map(e){return this.derive(map(this.iterable,e))}reduce(e,t){return reduce(this,e,t)}concat(){return this.derive(concatIterable(this.iterable))}uniqueOnly(){return this.derive(uniqueOnly(this.iterable))}uniqueOnlyBy(e){return this.derive(uniqueOnlyBy(this.iterable,e))}every(e){return every(this,e)}some(e){return some(this,e)}takeWhile(e){return this.derive(takeWhile(this.iterable,e))}*[Symbol.iterator](){let e=this.iterable;if(!e)throw new Error("Chained iterator already exhausted or used to derive the new one");this.iterable=void 0,yield*e,e=void 0}toArray(){return Array.from(this)}sort(e){return Array.from(this).sort(e)}toSet(){return new Set(this)}toMap(){return new Map(this)}flush(){for(const e of this);}memoize(){return new MemoizedIteratorClass(this)}},ChainedIterator=e=>new ChainedIteratorClass(e),CI=ChainedIterator,MemoizedIteratorClass=class extends ChainedIteratorClass{constructor(){super(...arguments),this.elements=[],this.$iterator=void 0}set iterable(e){this.$iterable=e}get iterable(){return this}derive(e){return new ChainedIteratorClass(e)}*[Symbol.iterator](){const e=this.elements;if(this.$iterable){this.$iterator||(this.$iterator=this.$iterable[Symbol.iterator]());let t=this.$iterator,r=e.length;for(r>0&&(yield*e);;){if(e.length>r){for(let t=r;t<e.length;t++)yield e[t];r=e.length}if(!t)break;const{value:n,done:i}=t.next();i?(t=this.$iterator=null,this.$iterable=null):(e.push(n),r++,yield n)}}else yield*e}},MemoizedIterator=e=>new MemoizedIteratorClass(e),MI=MemoizedIterator,MixinInstanceOfProperty=Symbol("MixinIdentity"),MixinStateProperty=Symbol("MixinStateProperty"),MixinWalkDepthState=class{constructor(){this.baseEl=void 0,this.sourceEl=void 0,this.$elementsByTopoLevel=void 0,this.$topoLevels=void 0,this.linearizedByTopoLevelsSource=MI(this.linearizedByTopoLevels())}static new(e){const t=new this;return e&&Object.assign(t,e),t}get topoLevels(){return void 0!==this.$topoLevels?this.$topoLevels:this.$topoLevels=this.buildTopoLevels()}buildTopoLevels(){return Array.from(this.elementsByTopoLevel.keys()).sort(((e,t)=>e-t))}get elementsByTopoLevel(){return void 0!==this.$elementsByTopoLevel?this.$elementsByTopoLevel:this.$elementsByTopoLevel=this.buildElementsByTopoLevel()}getOrCreateLevel(e,t){let r=e.get(t);return r||(r=[],e.set(t,r)),r}buildElementsByTopoLevel(){let e=0;const t=this.baseEl?CI(this.baseEl.walkDepthState.elementsByTopoLevel.values()).concat().toSet():new Set,r=CI(this.sourceEl.requirements).map((e=>e.walkDepthState.elementsByTopoLevel)).concat().reduce(((t,[r,n])=>(r>e&&(e=r),this.getOrCreateLevel(t,r).push(n),t)),new Map);return this.getOrCreateLevel(r,e+1).push([this.sourceEl]),CI(r).map((([e,r])=>[e,CI(r).concat().uniqueOnly().filter((e=>!t.has(e))).sort(((e,t)=>e.id-t.id))])).toMap()}*linearizedByTopoLevels(){yield*CI(this.topoLevels).map((e=>this.elementsByTopoLevel.get(e))).concat()}},MIXIN_ID=1,identity=e=>class extends e{},ZeroBaseClass=class{},MixinState=class{constructor(){this.id=MIXIN_ID++,this.requirements=[],this.baseClass=ZeroBaseClass,this.identitySymbol=void 0,this.mixinLambda=identity,this.walkDepthState=void 0,this.$minimalClass=void 0,this.name=""}static new(e){const t=new this;e&&Object.assign(t,e),t.walkDepthState=MixinWalkDepthState.new({sourceEl:t,baseEl:getMixinState(t.baseClass)});const r=t.mixinLambda,n=t.identitySymbol=Symbol(r.name),i=Object.assign((function(e){const t=r(e);return t.prototype[n]=!0,t}),{[MixinInstanceOfProperty]:n,[MixinStateProperty]:t});return Object.defineProperty(i,Symbol.hasInstance,{value:isInstanceOfStatic}),t.mixinLambda=i,t}get minimalClass(){return void 0!==this.$minimalClass?this.$minimalClass:this.$minimalClass=this.buildMinimalClass()}getBaseClassMixinId(e){const t=this.constructor,r=t.baseClassesIds.get(e);if(void 0!==r)return r;const n=MIXIN_ID++;return t.baseClassesIds.set(e,n),n}buildMinimalClass(){const e=this.constructor;let t=this.baseClass;const r=this.walkDepthState.linearizedByTopoLevelsSource.reduce(((t,r)=>{const{cls:n,hash:i}=t,s=i+String.fromCharCode(r.id);let a=e.minimalClassesByLinearHash.get(s);return a||(a=r.mixinLambda(n),r.name=a.name,e.minimalClassesByLinearHash.set(s,a)),t.cls=a,t.hash=s,t}),{cls:t,hash:String.fromCharCode(this.getBaseClassMixinId(t))}).cls,n=Object.assign(r,{[MixinInstanceOfProperty]:this.identitySymbol,[MixinStateProperty]:this,mix:this.mixinLambda,derive:e=>Mixin([n,e],(e=>class extends e{})),$:this,toString:this.toString.bind(this)});return Object.defineProperty(n,Symbol.hasInstance,{value:isInstanceOfStatic}),n}toString(){return this.walkDepthState.linearizedByTopoLevelsSource.reduce(((e,t)=>t.name+"("+e+")"),this.baseClass.name)}};MixinState.minimalClassesByLinearHash=new Map,MixinState.baseClassesIds=new Map;var TimeUnit,ConstraintType,SchedulingMode,DependencyValidationResult,DependencyType,DependenciesCalendar,ProjectType,Direction,ConstraintIntervalSide,isMixinClass=e=>Object.getPrototypeOf(e.prototype).constructor.hasOwnProperty(MixinStateProperty),getMixinState=e=>Object.getPrototypeOf(e.prototype).constructor[MixinStateProperty],mixin=(e,t)=>{let r;if(e.length>0){const t=e[e.length-1];isMixinClass(t)||t===ZeroBaseClass||(r=t)}const n=[];e.forEach(((t,i)=>{const s=t[MixinStateProperty];if(void 0!==s){const e=s.baseClass;if(e!==ZeroBaseClass)if(r){if(r!==e){const t=e.prototype.isPrototypeOf(r.prototype),n=r.prototype.isPrototypeOf(e.prototype);if(!t&&!n)throw new Error("Base class mismatch");r=n?e:r}}else r=e;n.push(s)}else if(i!==e.length-1)throw new Error("Base class should be provided as the last element of the requirements array")}));return MixinState.new({requirements:n,mixinLambda:t,baseClass:r||ZeroBaseClass}).minimalClass},isInstanceOfStatic=function(e){return Boolean(e&&e[this[MixinInstanceOfProperty]])},isInstanceOf=(e,t)=>Boolean(e&&e[t[MixinInstanceOfProperty]]),Mixin=mixin,MixinAny=mixin,Base2=class{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}};!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(TimeUnit||(TimeUnit={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(ConstraintType||(ConstraintType={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(SchedulingMode||(SchedulingMode={})),function(e){e[e.NoError=0]="NoError",e[e.CyclicDependency=1]="CyclicDependency",e[e.DuplicatingDependency=2]="DuplicatingDependency"}(DependencyValidationResult||(DependencyValidationResult={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(DependencyType||(DependencyType={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(DependenciesCalendar||(DependenciesCalendar={})),function(e){e[e.SchedulerBasic=1]="SchedulerBasic",e[e.SchedulerPro=2]="SchedulerPro",e[e.Gantt=3]="Gantt"}(ProjectType||(ProjectType={})),function(e){e.Forward="Forward",e.Backward="Backward",e.None="None"}(Direction||(Direction={})),function(e){e.Start="Start",e.End="End"}(ConstraintIntervalSide||(ConstraintIntervalSide={}));var EdgeInclusion,CalendarIteratorResult,MIN_DATE=new Date(-864e13),MAX_DATE=new Date(864e13),isDateFinite=e=>{if(!e)return!1;const t=e.getTime();return t!==MIN_DATE.getTime()&&t!==MAX_DATE.getTime()};!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(EdgeInclusion||(EdgeInclusion={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached",e[e.MaxRangeReached=3]="MaxRangeReached"}(CalendarIteratorResult||(CalendarIteratorResult={}));var IndexPosition,CalendarCache=class{constructor(e){this.cacheFilledStartDate=MAX_DATE,this.cacheFilledEndDate=MIN_DATE,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=TimeUnit.Day,this.maxCacheExtendCycles=1e3,this.maxRange=15768e7,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,r){e.ensureCacheFilledForInterval(t,r),this.intervalCache.includeWrappingRange(e.intervalCache,t,r)}ensureCacheFilledForInterval(e,t){const r=this.cacheFilledStartDate.getTime(),n=this.cacheFilledEndDate.getTime();if(r!==MAX_DATE.getTime()){const i=e.getTime(),s=t.getTime();if(r<=i&&s<=n)return;if(s<=r)t=new Date(r-1);else if(i>=n)e=new Date(n);else if(r<=i&&i<=n)e=new Date(n+1);else{if(!(r<=s&&s<=n))return this.ensureCacheFilledForInterval(e,new Date(r-1)),void this.ensureCacheFilledForInterval(new Date(n+1),t);t=new Date(r-1)}}(r===MAX_DATE.getTime()||e.getTime()<n)&&(this.cacheFilledStartDate=e),(n===MIN_DATE.getTime()||n<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=MAX_DATE,this.cacheFilledEndDate=MIN_DATE,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,r){var n;r=r||this;const i=e.startDate,s=e.endDate,a=i&&i.getTime(),o=s&&s.getTime(),l=null!=(n=e.maxRange)?n:this.maxRange,c=!1!==e.isForward;if(c?!i:!s)throw new Error("根据“isForward”选项的不同，至少需要“startDate”或“endDate”");const d=this.intervalCache;let u=c?i:s,h=c?i:s;const g=h.getTime();for(let e=1;e<this.maxCacheExtendCycles;e++){c?this.ensureCacheFilledForInterval(u,s||DateHelper.add(u,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(i||DateHelper.add(u,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),u);let e=d.getIntervalOf(h,c?EdgeInclusion.Left:EdgeInclusion.Right);for(;e;){const n=e.startDate,u=e.endDate;if(c&&o&&n.getTime()>=o||!c&&a&&u.getTime()<=a)return CalendarIteratorResult.FullRangeIterated;if(c&&n.getTime()-g>=l||!c&&g-u.getTime()>=l)return CalendarIteratorResult.MaxRangeReached;if(c&&n.getTime()>=this.cacheFilledEndDate.getTime()||!c&&u.getTime()<=this.cacheFilledStartDate.getTime())break;h=c?u:n;const p=a&&n.getTime()<a?i:n,m=o&&u.getTime()>o?s:u;if(!1===t.call(r,p,m,e.cacheInterval))return CalendarIteratorResult.StoppedByIterator;e=c?d.getNextInterval(e):d.getPrevInterval(e)}if(c&&h.getTime()===MAX_DATE.getTime()||!c&&h.getTime()===MIN_DATE.getTime())return CalendarIteratorResult.FullRangeIterated;u=c?this.cacheFilledEndDate:this.cacheFilledStartDate}return CalendarIteratorResult.MaxCacheExtendCyclesReached}},stripDuplicates=e=>Array.from(new Set(e)),CalendarCacheInterval=class{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new CalendarCacheInterval({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new CalendarCacheInterval({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=stripDuplicates(e);return t.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t}},CalendarCacheIntervalMultiple=class{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new CalendarCacheIntervalMultiple({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,r]of this.getGroups())e.set(t,r[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,r]of this.getGroups())r[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach((([r,n])=>{let i=t.get(r);i||(e.push(r),i=[],t.set(r,i)),i.push.apply(i,n.intervals)})),t.forEach(((e,r)=>{const n=stripDuplicates(e);n.sort(((e,t)=>t.getPriorityField()-e.getPriorityField())),t.set(r,n)})),this.intervalsByCalendar=t}},binarySearch=(e,t,r=((e,t)=>e-t))=>{let n=0,i=t.length;for(;n<i;){const s=(n+i)/2|0,a=r(e,t[s]);if(0===a)return{found:!0,index:s};a<0?i=s:n=s+1}return{found:!1,index:i}};!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(IndexPosition||(IndexPosition={}));var SortedMap=class{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const r=binarySearch(e,this.keys,this.comparator);return r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t)),r.index}insertAt(e,t,r){this.keys.splice(e,0,t),this.values.splice(e,0,r)}setValueAt(e,t){this.values[e]=t}get(e){const t=binarySearch(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=binarySearch(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=binarySearch(e,this.keys,this.comparator);return{found:t.found?IndexPosition.Exact:IndexPosition.Next,index:t.index}}map(e){const t=this.keys,r=this.values,n=[];for(let i=0;i<t.length;i++)n.push(e(r[i],t[i],i));return n}getAllEntries(){return this.map(((e,t)=>({value:e,key:t})))}clear(){this.keys.length=0,this.values.length=0}},IntervalCache=class{constructor(e){if(this.points=new SortedMap(((e,t)=>e.getTime()-t.getTime())),this.leftInfinityKey=MIN_DATE,this.rightInfinityKey=MAX_DATE,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=EdgeInclusion.Left){let r,{found:n,index:i}=this.indexOf(e);return r=t===EdgeInclusion.Left&&n===IndexPosition.Exact?i:i-1,this.getIntervalWithStartDateIndex(r)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,r){const n=this.points,{found:i,index:s}=n.indexOfKey(e);let a,o;if(i==IndexPosition.Exact){const e=r(o=n.getValueAt(s));n.setValueAt(s,e),a=s+1}else{const t=r(o=n.getValueAt(s-1));n.insertAt(s,e,t),a=s+1}for(;a<n.size();){if(n.getKeyAt(a).getTime()>=t.getTime())break;const e=r(o=n.getValueAt(a));n.setValueAt(a,e),a++}if(a===n.size())n.insertAt(n.size(),t,this.emptyInterval);else{n.getKeyAt(a).getTime()===t.getTime()||n.insertAt(a,t,o)}}includeWrappingRange(e,t,r){let n=e.getIntervalOf(t);for(;n&&(this.addInterval(n.startDate,n.endDate,(e=>this.combineIntervalsFn(e,n.cacheInterval))),!(n.endDate.getTime()>r.getTime()));)n=e.getNextInterval(n)}getSummary(){return this.points.map(((e,t)=>({label:e,date:t})))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}},CalendarCacheMultiple=class extends CalendarCache{constructor(e){super(e),this.calendarCaches=stripDuplicates(this.calendarCaches),this.intervalCache=new IntervalCache({emptyInterval:new CalendarCacheIntervalMultiple,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach((r=>{r.fillCache(e,t),this.includeWrappingRangeFrom(r,e,t)}))}},COMBINED_CALENDARS_CACHE=new Map,combineCalendars=e=>{const t=stripDuplicates(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const r=t.map((e=>e.internalId+"/")).join(""),n=t.map((e=>e.version+"/")).join("");let i,s=COMBINED_CALENDARS_CACHE.get(r);return i=s&&s.versionsHash===n?s.cache:new CalendarCacheMultiple({calendarCaches:t.map((e=>e.calendarCache))}),i},CalendarCacheSingle=class extends CalendarCache{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new IntervalCache({emptyInterval:new CalendarCacheInterval({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){var r;this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const n=e.getTime(),i=t.getTime(),s=null==(r=this.calendar.project)?void 0:r.timeZone;if(n>i)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval((r=>{const a=r.getStartDateSchedule(),o=r.getEndDateSchedule();let l,c=a.prev(1,e);if("EOD"===o){const e=a.next(1,t);l=e!==later_default.NEVER?DateHelper.getStartOfNextDay(e,!0):later_default.NEVER}else l=o.next(1,t);if(c!==later_default.NEVER&&c.getTime()===n){const t=a.prev(2,e);t!==later_default.NEVER&&2===t.length&&(c=t[1])}if(l!==later_default.NEVER&&l.getTime()===i){const e=o.next(2,t);e!==later_default.NEVER&&2===e.length&&(l=e[1])}const d=a.next(1/0,c!==later_default.NEVER?c:e,l!==later_default.NEVER?new Date(l.getTime()-1):t);if(d===later_default.NEVER)return;const u="EOD"===o?d.map((e=>DateHelper.getStartOfNextDay(e,!0))):o.next(1/0,new Date(d[0].getTime()+1),l!==later_default.NEVER?l:t);u!==later_default.NEVER&&(u.length>d.length?u.length=d.length:u.length<d.length&&(d.length=u.length),d.forEach(((e,t)=>{let n=e,i=u[t];null!=s&&(n=TimeZoneHelper.toTimeZone(n,s),i=TimeZoneHelper.toTimeZone(i,s)),this.intervalCache.addInterval(n,i,(e=>e.includeInterval(r)))})))}))}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval((e=>{var t;const r=null==(t=this.calendar.project)?void 0:t.timeZone;let{startDate:n,endDate:i}=e;null!=r&&(n=TimeZoneHelper.toTimeZone(n,r),i=TimeZoneHelper.toTimeZone(i,r)),this.intervalCache.addInterval(n,i,(t=>t.includeInterval(e)))}))}forEachStaticInterval(e){this.intervalStore.forEach((t=>{t.isStatic()&&e(t)}))}forEachRecurrentInterval(e){this.intervalStore.forEach((t=>{t.isRecurrent()&&e(t)}))}},AbstractPartOfProjectGenericMixin=class extends(Mixin([],(e=>{e.prototype;return class extends e{async commitAsync(){return this.project.commitAsync()}set project(e){this.$project=e}get project(){return this.$project}calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getAssignmentStore(){const e=this.getProject();return null==e?void 0:e.assignmentStore}getDependencyStore(){const e=this.getProject();return null==e?void 0:e.dependencyStore}getEventStore(){const e=this.getProject();return null==e?void 0:e.eventStore}getResourceStore(){const e=this.getProject();return null==e?void 0:e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return null==e?void 0:e.calendarManagerStore}}}))){},AbstractPartOfProjectStoreMixin=class extends(Mixin([AbstractPartOfProjectGenericMixin,Store],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isLoadingData=!1,this.disableHasLoadedDataToCommitFlag=!1}construct(e={}){return e.asyncEvents={add:!0,remove:!0,removeAll:!0,change:!0,refresh:!0,replace:!0,move:!0,update:!0},t.construct.call(this,e)}trigger(e,r){const n=this,{asyncEvents:i,project:s}=n,a=null==i?void 0:i[e];return a&&(!0===a||a[r.action])?(t.trigger.call(n,e+"PreCommit",{...r}),!s||s.isEngineReady()&&!s.isWritingData?t.trigger.call(n,e,r):!n.eventsSuspended&&s&&(s.dataReadyDetacher||(s.queuedDataReadyEvents=[],s.dataReadyDetacher=s.ion({dataReady(){this.queuedDataReadyEvents.forEach((([e,t,r,n])=>{e.trigger.call(t,r,n)})),s.queuedDataReadyEvents=null,s.dataReadyDetacher(),s.dataReadyDetacher=null},once:!0})),s.queuedDataReadyEvents.push([t,n,e,r])),!0):t.trigger.call(n,e,r)}calculateProject(){return this.project}setStoreData(e){var r;!this.project||this.syncDataOnLoad||this.disableHasLoadedDataToCommitFlag||(this.project.hasLoadedDataToCommit=!0),this.isLoadingData=!0,t.setStoreData.call(this,e),this.isLoadingData=!1,null==(r=this.project)||r.trigger("storeRefresh",{store:this})}async doAutoCommit(){this.suspendCount<=0&&this.project&&!this.project.isEngineReady()&&await this.project.commitAsync(),t.doAutoCommit.call(this)}async addAsync(e,t){const r=this.add(e,t);return await this.project.commitAsync(),r}async insertAsync(e,t,r){const n=this.insert(e,t,r);return await this.project.commitAsync(),n}async loadDataAsync(e){this.data=e,await this.project.commitAsync()}performFilter(){var e;return this.project&&(this.isLoadingData||(null==(e=this.rootNode)?void 0:e.isLoading))&&this.project.commitAsync().then((()=>this.filter())),super.performFilter(...arguments)}}}))){},AbstractPartOfProjectModelMixin=class extends(Mixin([AbstractPartOfProjectGenericMixin,Model],(e=>{const t=e.prototype;return class extends e{joinStore(e){let r=null;if(isInstanceOf(e,AbstractPartOfProjectStoreMixin)){const t=e.getProject();t&&!this.getProject()&&(this.setProject(t),r=t)}t.joinStore.call(this,e),r&&!r.isRepopulatingStores&&this.joinProject()}unjoinStore(e,r=!1){t.unjoinStore.call(this,e,r);const{project:n}=this,i=isInstanceOf(e,AbstractPartOfProjectStoreMixin)&&!e.isFillingFromMaster&&n===(e.isChained&&e.project?e.masterStore.project:e.project);n&&!n.isDestroying&&!n.isRepopulatingStores&&i&&(this.leaveProject(r),this.setProject(null)),i&&(this.graph=null)}joinProject(){}leaveProject(e=!1){}calculateProject(){const e=this.stores.find((e=>isInstanceOf(e,AbstractPartOfProjectStoreMixin)&&!!e.getProject()));return null==e?void 0:e.getProject()}async setAsync(e,t,r){var n;const i=this.set(e,t,r);return await(null==(n=this.project)?void 0:n.commitAsync()),i}async getAsync(e){var t;return await(null==(t=this.project)?void 0:t.commitAsync()),this.get(e)}get isStmRestoring(){const e=this.getProject();return(null==e?void 0:e.isRestoringData)||(null==e?void 0:e.stm.isRestoring)||!1}}}))){},CalendarIntervalMixin=class extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{e.prototype;return class extends e{static get fields(){return["name",{name:"startDate",type:"date"},{name:"endDate",type:"date"},"recurrentStartDate","recurrentEndDate","cls","iconCls",{name:"isWorking",type:"boolean",defaultValue:!1},{name:"priority",type:"number"}]}getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null,this.getCalendar().getDepth()}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){let t=e;if(e&&e!==Object(e)&&(t=later_default.parse.text(e),t!==Object(t)||t.error>=0))try{t=JSON.parse(e)}catch(e){return null}return t}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=later_default.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;if("EOD"===this.recurrentEndDate)return"EOD";const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=later_default.schedule(e)}}}))){},CalendarIntervalStore=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.disableHasLoadedDataToCommitFlag=!0}static get defaultConfig(){return{modelClass:CalendarIntervalMixin}}}}))){},UnspecifiedTimeIntervalModel=class extends(Mixin([CalendarIntervalMixin],(e=>{e.prototype;return class extends e{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}}))){},CorePartOfProjectGenericMixin=class extends(Mixin([AbstractPartOfProjectGenericMixin],(e=>{e.prototype;return class extends e{get eventStore(){var e;return null==(e=this.project)?void 0:e.eventStore}get resourceStore(){var e;return null==(e=this.project)?void 0:e.resourceStore}get assignmentStore(){var e;return null==(e=this.project)?void 0:e.assignmentStore}get dependencyStore(){var e;return null==(e=this.project)?void 0:e.dependencyStore}get calendarManagerStore(){var e;return null==(e=this.project)?void 0:e.calendarManagerStore}getEventById(e){var t;return null==(t=this.eventStore)?void 0:t.getById(e)}getDependencyById(e){var t;return null==(t=this.dependencyStore)?void 0:t.getById(e)}getResourceById(e){var t;return null==(t=this.resourceStore)?void 0:t.getById(e)}getAssignmentById(e){var t;return null==(t=this.assignmentStore)?void 0:t.getById(e)}getCalendarById(e){var t;return null==(t=this.calendarManagerStore)?void 0:t.getById(e)}}}))){},AbstractCalendarMixin=class extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.version=1}static get fields(){return[{name:"version",type:"number"},"name",{name:"unspecifiedTimeIsWorking",type:"boolean",defaultValue:!0},{name:"intervals",type:"store",subStore:!0},"cls","iconCls"]}get intervalStoreClass(){return CalendarIntervalStore}get intervalStore(){return this.meta.intervalsStore}initIntervalsStore(e){e.storeClass=this.intervalStoreClass,e.modelClass=this.getDefaultConfiguration().calendarIntervalModelClass||this.intervalStoreClass.defaultConfig.modelClass,e.calendar=this}processIntervalsStoreData(e){this.bumpVersion()}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,r){var n;const i=null==(n=this.getProject())?void 0:n.maxCalendarRange;return i&&(e=Object.assign({maxRange:i},e)),this.calendarCache.forEachAvailabilityInterval(e,t,r)}accumulateWorkingTime(e,t,r){var n,i;if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let s=e;const a=null!=(i=null==(n=this.getProject())?void 0:n.adjustDurationToDST)&&i;return this.forEachAvailabilityInterval(r?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,n,i)=>{let o=!0;if(i.getIsWorking()){let i=n.getTime()-e.getTime();if(t<=i){if(a){const i=r?e.getTimezoneOffset()-new Date(e.getTime()+t).getTimezoneOffset():new Date(n.getTime()-t).getTimezoneOffset()-n.getTimezoneOffset();t-=60*i*1e3}s=r?new Date(e.getTime()+t):new Date(n.getTime()-t),t=0,o=!1}else{if(a){i+=60*(e.getTimezoneOffset()-n.getTimezoneOffset())*1e3}s=r?n:e,t-=i}}return o})),{finalDate:new Date(s),remainingDurationInMs:t}}calculateDurationMs(e,t,r=!1){let n=0;const i=e.getTime()<=t.getTime()||!r?1:-1;i<0&&([e,t]=[t,e]);const s=this.getProject().adjustDurationToDST;return this.forEachAvailabilityInterval({startDate:e,endDate:t},((e,t,r)=>{if(r.getIsWorking()&&(n+=t.getTime()-e.getTime(),s)){const r=e.getTimezoneOffset()-t.getTimezoneOffset();n+=60*r*1e3}})),n*i}calculateEndDate(e,t){const r=t>=0,n=this.accumulateWorkingTime(e,Math.abs(t),r);return 0===n.remainingDurationInMs?n.finalDate:null}calculateStartDate(e,t){const r=t<=0,n=this.accumulateWorkingTime(e,Math.abs(t),r);return 0===n.remainingDurationInMs?n.finalDate:null}skipNonWorkingTime(e,t=!0){let r;const n=this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},((e,n,i)=>{if(i.getIsWorking())return r=t?e:n,!1}));return n===CalendarIteratorResult.MaxRangeReached||n===CalendarIteratorResult.FullRangeIterated?"empty_calendar":r?new Date(r):new Date(e)}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}removeInterval(e){return this.removeIntervals([e])}removeIntervals(e){return this.bumpVersion(),this.intervalStore.remove(e)}clearIntervals(e){return e||this.bumpVersion(),this.intervalStore.removeAll(e)}bumpVersion(){this.clearCache(),this.version++}get calendarCache(){if(void 0!==this.$calendarCache)return this.$calendarCache;const e=new UnspecifiedTimeIntervalModel({isWorking:this.unspecifiedTimeIsWorking});return e.calendar=this,this.$calendarCache=new CalendarCacheSingle({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}clearCache(){this.$calendarCache&&this.$calendarCache.clear(),this.$calendarCache=void 0}resetPriorityOfAllIntervals(){this.traverse((e=>{e.intervalStore.forEach((e=>e.resetPriority()))}))}insertChild(e,r,n){let i=t.insertChild.call(this,...arguments);return Array.isArray(i)||(i=[i]),i.forEach((e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()})),i}joinProject(){t.joinProject.call(this),this.intervalStore.setProject(this.getProject())}leaveProject(){t.leaveProject.call(this),this.intervalStore.setProject(null),this.clearCache()}doDestroy(){this.leaveProject(),this.intervalStore.destroy(),super.doDestroy()}isDayHoliday(e){const t=DateHelper.clearTime(e),r=DateHelper.getNext(e,TimeUnit.Day);let n=!1;return this.forEachAvailabilityInterval({startDate:t,endDate:r,isForward:!0},((e,t,r)=>(n=r.getIsWorking(),!n))),!n}getDailyHolidaysRanges(e,t){const r=[];for(e=DateHelper.clearTime(e);e<t;)this.isDayHoliday(e)&&r.push({startDate:e,endDate:DateHelper.getStartOfNextDay(e,!0,!0)}),e=DateHelper.getNext(e,TimeUnit.Day);return r}getWorkingTimeRanges(e,t){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,n)=>{if(n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,startDate:e,endDate:t})}})),r}getNonWorkingTimeRanges(e,t){const r=[];return this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((e,t,n)=>{if(!n.getIsWorking()){const i=n.intervals[0];r.push({name:i.name,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})}})),r}isWorkingTime(e,t,r){if(r){let r;const n=this.forEachAvailabilityInterval({startDate:e,endDate:t,isForward:!0},((n,i,s)=>{if(s.getIsWorking()&&n<=e&&i>=t)return r=!0,!1}));return n!==CalendarIteratorResult.MaxRangeReached&&n!==CalendarIteratorResult.FullRangeIterated&&r}{const r=this.skipNonWorkingTime(e);return!(!r||"empty_calendar"===r)&&(t?r<t:r.getTime()===e.getTime())}}}}))){},AbstractHasAssignmentsMixin=class extends(Mixin([AbstractPartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{getAssignmentFor(e){var t;for(const r of null!=(t=this.assigned)?t:[])if(r.resource===e)return r;return null}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}async assign(e){const t=this.project.assignmentStore.modelClass;return this.addAssignment(new t({event:this,resource:e})),this.commitAsync()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.commitAsync()}leaveProject(){if(this.isInActiveTransaction&&this.assigned){const e=this.getEventStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this,...arguments)}remove(){if(!this.parent)return t.remove.call(this);{const e=this.getEventStore();t.remove.call(this),e&&e.afterEventRemoval()}}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}}}))){},CorePartOfProjectModelMixin=class extends(Mixin([AbstractPartOfProjectModelMixin,CorePartOfProjectGenericMixin,Model],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.$isCalculating=!1,this.$changed={},this.$beforeChange={}}get isInActiveTransaction(){return!0}joinProject(){this.invalidate()}leaveProject(e=!1){var r;t.leaveProject.call(this,e),null==(r=this.project)||r.bufferedCommitAsync()}invalidate(){var e;null==(e=this.project)||e.invalidate(this)}getCurrentOrProposed(e){var t;return e in this.$changed&&!0!==this.$changed[e]?this.$changed[e]:null!=(t=this.get(e))?t:null}hasCurrentOrProposed(e){return e in this.$changed&&1!=this.$changed[e]||null!=this.get(e)}propose(e){var t;if(this.project||(null==(t=this.recurringTimeSpan)?void 0:t.project)){const t=Object.keys(e);for(let r=0;r<t.length;r++){const n=t[r];this.$changed[n]=e[n]}this.invalidate()}else this.set(e)}setChanged(e,t,r=!0,n=!1){const i=this;i.$changed[e]=t,n&&(e in i.$beforeChange||(i.$beforeChange[e]=i.get(e)),i.setData(e,t)),r&&i.invalidate()}calculateInvalidated(){}finalizeInvalidated(e=!1){const t=this;t.$isCalculating=!0,e?t.setData(t.$changed):(t.setData(t.$beforeChange),t.set(t.$changed)),t.$changed={},t.$beforeChange={},t.$isCalculating=!1}}}))){},isNotNumber=e=>Number(e)!==e,CIFromSetOrArrayOrValue=e=>e instanceof Set||e instanceof Array?CI(e):CI([e]),delay=e=>new Promise((t=>setTimeout(t,e))),format=(e,...t)=>e.replace(/{(\d+)}/g,((e,r)=>void 0!==t[r]?t[r]:e)),AbstractAssignmentStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.allAssignmentsForRemoval=!1}remove(e,r){this.assignmentsForRemoval=CIFromSetOrArrayOrValue(e).toSet();const n=t.remove.call(this,e,r);return this.assignmentsForRemoval.clear(),n}removeAll(e){this.allAssignmentsForRemoval=!0;const r=t.removeAll.call(this,e);return this.allAssignmentsForRemoval=!1,r}}}))){},AbstractCalendarManagerStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{doDestroy(){var e;const t=[];(null==(e=this.rootNode)?void 0:e.isDestroyed)||this.traverse((e=>t.push(e))),super.doDestroy(),t.forEach((e=>e.destroy()))}}}))){},AbstractDependencyStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}remove(e,r){this.dependenciesForRemoval=CIFromSetOrArrayOrValue(e).toSet();const n=t.remove.call(this,e,r);return this.dependenciesForRemoval.clear(),n}removeAll(e){this.allDependenciesForRemoval=!0;const r=t.removeAll.call(this,e);return this.allDependenciesForRemoval=!1,r}}}))){},dataAddRemoveActions2={splice:1,clear:1},AbstractEventStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set,this.dependenciesForRemoval=new Set}onDataChange(e){var t;const r=dataAddRemoveActions2[e.action];super.onDataChange(e),r&&(null==(t=e.removed)?void 0:t.length)&&this.afterEventRemoval()}remove(e,r){const n=t.remove.call(this,e,r);return this.afterEventRemoval(),n}removeAll(e){const r=t.removeAll.call(this,e);return this.afterEventRemoval(),r}onNodeRemoveChild(e,r,n,i){const s=t.onNodeRemoveChild.call(this,...arguments);return this.afterEventRemoval(),s}afterEventRemoval(){const{assignmentsForRemoval:e,dependenciesForRemoval:t}=this;if(!e)return;const r=this.getAssignmentStore();if(r&&!r.allAssignmentsForRemoval&&e.size){const t=[...e].filter((e=>!r.assignmentsForRemoval.has(e)));t.length>0&&r.remove(t)}e.clear();const n=this.getDependencyStore();if(n&&!n.allDependenciesForRemoval&&t.size){const e=[...t].filter((e=>!n.dependenciesForRemoval.has(e)));e.length>0&&n.remove(e)}t.clear()}processRecord(e,t=!1){var r;if(!(null==(r=this.project)?void 0:r.isRepopulatingStores)){const t=this.getById(e.id);if(t&&t!==e&&t.assigned)for(const r of t.assigned)r.event=e}return e}}}))){},dataAddRemoveActions3={splice:1,clear:1},AbstractResourceStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.assignmentsForRemoval=new Set}onDataChange(e){var t;const r=dataAddRemoveActions3[e.action];super.onDataChange(e),r&&(null==(t=e.removed)?void 0:t.length)&&this.afterResourceRemoval()}remove(e,r){const n=t.remove.call(this,e,r);return this.afterResourceRemoval(),n}removeAll(e){const r=t.removeAll.call(this,e);return this.afterResourceRemoval(),r}afterResourceRemoval(){const e=this.getAssignmentStore();if(e&&!e.allAssignmentsForRemoval){const t=[...this.assignmentsForRemoval].filter((t=>!e.assignmentsForRemoval.has(t)));t.length>0&&e.remove(t)}this.assignmentsForRemoval.clear()}processRecord(e,t=!1){const r=this.getById(e.id);if(r&&r!==e)for(const t of r.assigned||[])t.resource=e;return e}}}))){},CoreEventMixin=class extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this._startDate=null,this._endDate=null,this._duration=null}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number"},{name:"durationUnit",type:"durationunit",defaultValue:"day"}]}get startDate(){var e,t;return null!=(t=null!=(e=this._startDate)?e:this.get("startDate"))?t:null}get endDate(){var e,t;return null!=(t=null!=(e=this._endDate)?e:this.get("endDate"))?t:null}get duration(){var e,t;return null!=(t=null!=(e=this._duration)?e:this.get("duration"))?t:null}set startDate(e){this.proposeStartDate(e)}set endDate(e){this.proposeEndDate(e)}set duration(e){this.proposeDuration(e)}inSet(e,r,n,i,s){const a=this;return!a.project||a.project.isWritingData||"string"==typeof e||s||("startDate"in e&&!("startDate"in a.$changed)&&(a.$changed.startDate=!0,a.invalidate()),"endDate"in e&&!("endDate"in a.$changed)&&(a.$changed.endDate=!0,a.invalidate())),t.inSet.call(a,e,r,n,i,s)}getStartDate(){return this.startDate}proposeStartDate(e,t=!("endDate"in this.$changed)){var r;(this.inSetting||(null==e?void 0:e.getTime())!==(null==(r=this.startDate)?void 0:r.getTime()))&&(this._startDate=e,this.propose({startDate:e,keepDuration:t}))}async setStartDate(e,t=!0){var r;return this.proposeStartDate(e,t),null==(r=this.project)?void 0:r.commitAsync()}getEndDate(){return this.endDate}proposeEndDate(e,t=!1){var r;(this.inSetting||(null==e?void 0:e.getTime())!==(null==(r=this.endDate)?void 0:r.getTime()))&&(this._endDate=e,this.propose({endDate:e,keepDuration:t}))}async setEndDate(e,t=!1){var r;return this.proposeEndDate(e,t),null==(r=this.project)?void 0:r.commitAsync()}getDuration(){return this.duration}proposeDuration(e,t,r=!0){this._duration=e,this.propose({duration:e,keepStart:r}),t&&this.propose({durationUnit:t})}async setDuration(e,t,r=!0){var n;return this.proposeDuration(e,t,r),null==(n=this.project)?void 0:n.commitAsync()}getDurationUnit(){return this.durationUnit}joinProject(){var e,r;const n=this,i=n.$changed,s=n.getCurrentOrProposed("startDate"),a=n.getCurrentOrProposed("endDate"),o=n.getCurrentOrProposed("duration");if(null!=s&&(i.startDate=n._startDate=s),null!=a&&(i.endDate=n._endDate=a),null!=o&&(i.duration=n._duration=o),n.eventStore&&!n.eventStore.isLoadingData){const t=null==(e=n.assignmentStore)?void 0:e.storage.findItem("event",null);if(t){const e=null==(r=n.assignmentStore)?void 0:r.storage.findItem("eventId",n.id);if(e)for(const t of e)t.setChanged("event",n);else for(const e of t)e.getCurrentOrProposed("event")===n.id&&e.setChanged("event",n)}}t.joinProject.call(n)}applyValue(e,r,n,i,s){var a;if((this.project||(null==(a=this.recurringTimeSpan)?void 0:a.project))&&s){const{name:t}=s;"startDate"!==t&&"duration"!=t&&"endDate"!==t||(e=!0,this["_"+t]=n),i&&(e=!1)}t.applyValue.call(this,e,r,n,i,s)}afterChange(e,r,n,i,s){this.$isCalculating||s||this.setData({startDate:this.getCurrentOrProposed("startDate"),endDate:this.getCurrentOrProposed("endDate"),duration:this.getCurrentOrProposed("duration"),durationUnit:this.getCurrentOrProposed("durationUnit")}),t.afterChange.call(this,e,r,n,i,s)}calculateInvalidated(){const e=this,t=e.$changed,r="startDate"in t,n="endDate"in t,i="duration"in t,{startDate:s,endDate:a,duration:o,keepDuration:l,keepStart:c}=t;let d=null;!r||n||i?r||!n||i?r||n||!i?r&&n&&!i?null===s&&null===a?t.duration=null:d="duration":r&&!n&&i?d="endDate":!r&&n&&i?d="startDate":r&&n&&i&&(d=null==o?"duration":null==s?"startDate":"endDate"):null===o?t.endDate=null:!e.hasCurrentOrProposed("startDate")||!c&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(d="startDate"):(c&&t.duration<0&&(t.duration=0),d="endDate"):null===a?t.startDate=null:e.hasCurrentOrProposed("startDate")&&!l&&!0!==a&&a<e.getCurrentOrProposed("startDate")?(t.startDate=a,t.duration=0):!e.hasCurrentOrProposed("duration")||!l&&e.hasCurrentOrProposed("startDate")?e.hasCurrentOrProposed("startDate")&&(d="duration"):d="startDate":null===s?t.endDate=null:e.hasCurrentOrProposed("endDate")&&s>e.getCurrentOrProposed("endDate")&&!l?(t.endDate=s,t.duration=0):!e.hasCurrentOrProposed("duration")||!l&&e.hasCurrentOrProposed("endDate")?e.hasCurrentOrProposed("endDate")&&(d="duration"):d="endDate";const u=e.getCurrentOrProposed("startDate"),h=e.getCurrentOrProposed("endDate"),g=e.getCurrentOrProposed("duration"),p=e.getCurrentOrProposed("durationUnit");let m,f;switch(d){case"startDate":t.startDate=DateHelper.add(h,-g,p);break;case"endDate":m=DateHelper.as("hour",g,p),f=DateHelper.as(p,m,"h"),t.endDate=DateHelper.add(u,f,p);break;case"duration":m=DateHelper.diff(u,h,"h"),t.duration=DateHelper.as(p,m,"h")}"startDate"in t&&!0!==t.startDate&&(this._startDate=t.startDate),"endDate"in t&&!0!==t.endDate&&(this._endDate=t.endDate),"duration"in t&&!0!==t.duration&&(this._duration=t.duration),!0===t.startDate&&delete t.startDate,!0===t.endDate&&delete t.endDate,delete t.keepDuration,delete t.keepStart}}}))){},CoreResourceMixin=class extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{get assigned(){var e;return null==(e=this.project)?void 0:e.assignmentStore.getResourcesAssignments(this)}joinProject(){var e;this.resourceStore&&!this.resourceStore.isLoadingData&&(null==(e=this.assignmentStore)||e.query((e=>e.get("resource")===this.id)).forEach((e=>e.setChanged("resource",this)))),t.joinProject.call(this)}leaveProject(e=!1){var r;if(this.assigned&&!e&&!(null==(r=this.resourceStore)?void 0:r.isLoadingData)){const e=this.resourceStore;this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}applyValue(e,r,n,i,s){"id"===(null==s?void 0:s.name)&&this.assigned.forEach((e=>{e.set("resourceId",n)})),t.applyValue.call(this,e,r,n,i,s)}}}))){},CoreAssignmentMixin=class extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"resource",isEqual:(e,t)=>e===t,persist:!1},{name:"event",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,r,n){const{assignmentStore:i,eventStore:s,resourceStore:a,project:o}=this;let l=!1;if("event"===e){const e=isInstanceOf(r,CoreEventMixin)?r:null==s?void 0:s.$master.getById(r);e&&(l=!0),r=e||r}if("resource"===e){const e=isInstanceOf(r,CoreResourceMixin)?r:null==a?void 0:a.$master.getById(r);e&&(l=!0),r=e||r}t.setChanged.call(this,e,r,n,!0),!i||!l||o.isPerformingCommit||i.isLoadingData||a.isLoadingData||i.skipInvalidateIndices||i.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("event",this.get("event")),this.setChanged("resource",this.get("resource"))}calculateInvalidated(){var e,t;let{event:r=this.event,resource:n=this.resource}=this.$changed;if(null!==r&&!isInstanceOf(r,CoreEventMixin)){const t=null==(e=this.eventStore)?void 0:e.getById(r);t&&this.setChanged("event",t,!1)}if(null!==n&&!isInstanceOf(n,CoreResourceMixin)){const e=null==(t=this.resourceStore)?void 0:t.getById(n);e&&this.setChanged("resource",e,!1)}}finalizeInvalidated(e){var r,n;const i=this.$changed;"resource"in i&&(i.resourceId=(null==(r=i.resource)?void 0:r.isModel)?i.resource.id:i.resource),"event"in i&&(i.eventId=(null==(n=i.event)?void 0:n.isModel)?i.event.id:i.event),t.finalizeInvalidated.call(this,e)}set event(e){this.setChanged("event",e)}get event(){const e=this.get("event");return null!=(null==e?void 0:e.id)?e:null}set resource(e){this.setChanged("resource",e)}get resource(){const e=this.get("resource");return null!=(null==e?void 0:e.id)?e:null}}}))){},CorePartOfProjectStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin,CorePartOfProjectGenericMixin,Store],(e=>{const t=e.prototype;return class extends e{setProject(e){const r=t.setProject.call(this,e);return e&&this.joinProject(e),r}joinProject(e){}onCommitAsync(){}}}))){},emptySet=new Set,CoreAssignmentStoreMixin=class extends(Mixin([AbstractAssignmentStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.skipInvalidateIndices=!1}static get defaultConfig(){return{modelClass:CoreAssignmentMixin,storage:{extraKeys:[{property:"event",unique:!1},{property:"resource",unique:!1},{property:"eventId",unique:!1}]}}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}getEventsAssignments(e){return this.storage.findItem("event",e,!0)||emptySet}getResourcesAssignments(e){return this.storage.findItem("resource",e.$original,!0)||emptySet}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}afterLoadData(){this.eventStore&&this.linkAssignments(this.eventStore,"event"),this.resourceStore&&this.linkAssignments(this.resourceStore,"resource")}linkAssignments(e,t){e=e.masterStore||e;const r=this.count&&this.storage.findItem(t,null,!0);if(r){for(const n of r){const r=e.getById(n.getCurrentOrProposed(t));r&&n.setChanged(t,r)}this.invalidateIndices()}}unlinkAssignments(e){this.forEach((t=>{var r,n,i;return t.setChanged(e,null!=(i=null!=(n=null==(r=t[e])?void 0:r.id)?n:null==t?void 0:t.getData(e))?i:t[e+"Id"])})),this.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){},CoreCalendarMixin=class extends(Mixin([AbstractCalendarMixin,CorePartOfProjectModelMixin],(e=>{e.prototype;return class extends e{}}))){},CoreCalendarManagerStoreMixin=class extends(Mixin([AbstractCalendarManagerStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{tree:!0,modelClass:CoreCalendarMixin}}}}))){},CoreDependencyMixin=class extends(Mixin([CorePartOfProjectModelMixin],(e=>{const t=e.prototype;return class extends e{static get fields(){return[{name:"fromEvent",isEqual:(e,t)=>e===t,persist:!1},{name:"toEvent",isEqual:(e,t)=>e===t,persist:!1}]}setChanged(e,r,n){var i,s,a;let o=!1;if("fromEvent"===e||"toEvent"===e){const e=isInstanceOf(r,CoreEventMixin)?r:null==(i=this.eventStore)?void 0:i.getById(r);e&&(o=!0),r=e||r}t.setChanged.call(this,e,r,n,!0),!o||this.project.isPerformingCommit||(null==(s=this.dependencyStore)?void 0:s.isLoadingData)||null==(a=this.dependencyStore)||a.invalidateIndices()}joinProject(){t.joinProject.call(this),this.setChanged("fromEvent",this.get("fromEvent")),this.setChanged("toEvent",this.get("toEvent"))}calculateInvalidated(){var e,t;let{fromEvent:r,toEvent:n}=this.$changed;if(null!==r&&!isInstanceOf(r,CoreEventMixin)){const t=null==(e=this.eventStore)?void 0:e.getById(r);t&&(this.$changed.fromEvent=t)}if(null!==n&&!isInstanceOf(n,CoreEventMixin)){const e=null==(t=this.eventStore)?void 0:t.getById(n);e&&(this.$changed.toEvent=e)}}set fromEvent(e){this.setChanged("fromEvent",e)}get fromEvent(){const e=this.get("fromEvent");return null!=(null==e?void 0:e.id)?e:null}set toEvent(e){this.setChanged("toEvent",e)}get toEvent(){const e=this.get("toEvent");return null!=(null==e?void 0:e.id)?e:null}}}))){},emptySet2=new Set,CoreDependencyStoreMixin=class extends(Mixin([AbstractDependencyStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.dependenciesForRemoval=new Set,this.allDependenciesForRemoval=!1}static get defaultConfig(){return{modelClass:CoreDependencyMixin,storage:{extraKeys:[{property:"fromEvent",unique:!1},{property:"toEvent",unique:!1}]}}}getIncomingDepsForEvent(e){return this.storage.findItem("toEvent",e)||emptySet2}getOutgoingDepsForEvent(e){return this.storage.findItem("fromEvent",e)||emptySet2}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}updateIndices(){this.storage.rebuildIndices()}invalidateIndices(){this.storage.invalidateIndices()}onCommitAsync(){this.updateIndices()}}}))){},CoreHasAssignmentsMixin=class extends(Mixin([CoreEventMixin,AbstractHasAssignmentsMixin],(e=>{const t=e.prototype;return class extends e{get assigned(){var e,t;return null!=(t=null==(e=this.project)?void 0:e.assignmentStore.getEventsAssignments(this))?t:this.$cachedAssignments}leaveProject(e=!1){this.$cachedAssignments=this.assigned,super.leaveProject(e)}applyValue(e,r,n,i,s){var a;"id"===r&&(null==(a=this.assigned)||a.forEach((e=>e.set("eventId",n)))),t.applyValue.call(this,e,r,n,i,s)}copy(e=null,r=null){const n=t.copy.call(this,e,r);return(ObjectHelper.isObject(r)&&!r.skipFieldIdentifiers||!ObjectHelper.isObject(r))&&(n.$cachedAssignments=this.assigned),n}}}))){},CoreHasDependenciesMixin=class extends(Mixin([CoreEventMixin],(e=>{const t=e.prototype;return class extends e{get outgoingDeps(){return this.project.dependencyStore.getOutgoingDepsForEvent(this)}get incomingDeps(){return this.project.dependencyStore.getIncomingDepsForEvent(this)}leaveProject(){const e=this.eventStore;this.outgoingDeps&&this.outgoingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),this.incomingDeps&&this.incomingDeps.forEach((t=>e.dependenciesForRemoval.add(t))),t.leaveProject.call(this)}}}))){},SchedulerCoreEvent=class extends(Mixin([CoreEventMixin,CoreHasAssignmentsMixin,CoreHasDependenciesMixin],(e=>{e.prototype;return class extends e{}}))){},CoreEventStoreMixin=class extends(Mixin([AbstractEventStoreMixin,CorePartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{static get defaultConfig(){return{modelClass:SchedulerCoreEvent}}joinProject(){var e;null==(e=this.assignmentStore)||e.linkAssignments(this,"event")}afterLoadData(){var e;this.afterEventRemoval(),null==(e=this.assignmentStore)||e.linkAssignments(this,"event")}}}))){},CoreResourceStoreMixin=class extends(Mixin([AbstractResourceStoreMixin,CorePartOfProjectStoreMixin],(e=>{const t=e.prototype;return class extends e{static get defaultConfig(){return{modelClass:CoreResourceMixin}}joinProject(){var e;null==(e=this.assignmentStore)||e.linkAssignments(this,"resource")}afterLoadData(){var e;null==(e=this.assignmentStore)||e.linkAssignments(this,"resource")}clear(e){var r;t.clear.call(this,e),null==(r=this.assignmentStore)||r.unlinkAssignments("resource")}}}))){},EventsWrapper=class extends(Mixin([],Events_default)){},DelayableWrapper=class extends(Mixin([],Delayable_default)){},AbstractProjectMixin=class extends(Mixin([EventsWrapper,DelayableWrapper,Model],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.isRestoringData=!1}get isRepopulatingStores(){return!1}get isInitialCommit(){return!this.isInitialCommitPerformed||this.hasLoadedDataToCommit}construct(e={}){this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!1,this.isWritingData=!1,this.hasLoadedDataToCommit=!1;const r=!("silenceInitialCommit"in e)||e.silenceInitialCommit,n="adjustDurationToDST"in e&&e.adjustDurationToDST;this.maxCalendarRange="maxCalendarRange"in e?e.maxCalendarRange:15768e7,delete e.maxCalendarRange,delete e.silenceInitialCommit,delete e.adjustDurationToDST,t.construct.call(this,e),this.silenceInitialCommit=r,this.adjustDurationToDST=n}repopulateStore(e){}repopulateReplica(){}deferUntilRepopulationIfNeeded(e,t,r){t(...r)}attachStore(e){}detachStore(e){}async commitAsync(){throw new Error("Abstract method called")}isEngineReady(){throw new Error("Abstract method called")}getStm(){throw new Error("Abstract method called")}}}))){},DelayableWrapper2=class extends(Mixin([],Delayable_default)){},SchedulerCoreProjectMixin=class extends(Mixin([AbstractProjectMixin,CorePartOfProjectGenericMixin,DelayableWrapper2,Model],(e=>{const t=e.prototype;class r extends e{static get configurable(){return{stm:{},eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},eventModelClass:SchedulerCoreEvent,assignmentModelClass:CoreAssignmentMixin,resourceModelClass:CoreResourceMixin,dependencyModelClass:CoreDependencyMixin,calendarModelClass:CoreCalendarMixin,eventStoreClass:CoreEventStoreMixin,assignmentStoreClass:CoreAssignmentStoreMixin,resourceStoreClass:CoreResourceStoreMixin,dependencyStoreClass:CoreDependencyStoreMixin,calendarManagerStoreClass:CoreCalendarManagerStoreMixin,assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null}}construct(e={}){var r;const n=this;if(n.$invalidated=new Set,n.isPerformingCommit=!1,n.silenceInitialCommit=!0,n.ongoing=Promise.resolve(),e.eventStore&&!e.assignmentStore){const t=e.eventStore.masterStore||e.eventStore,i=t.assignmentStore||(null==(r=t.crudManager)?void 0:r.assignmentStore);(null==i?void 0:i.isAssignmentStore)&&(e.assignmentStore=i,n.isSharingAssignmentStore=!0)}t.construct.call(n,e),n.defaultCalendar=new n.calendarManagerStore.modelClass({unspecifiedTimeIsWorking:n.unspecifiedTimeIsWorking}),n.defaultCalendar.project=n;const{calendarsData:i,eventsData:s,dependenciesData:a,resourcesData:o,assignmentsData:l}=n;Boolean(i||s||a||o||l)?(n.loadInlineData({calendarsData:i,eventsData:s,dependenciesData:a,resourcesData:o,assignmentsData:l}),delete n.calendarsData,delete n.eventsData,delete n.dependenciesData,delete n.resourcesData,delete n.assignmentsData):n.bufferedCommitAsync()}doDestroy(){var e,r,n,i,s,a;const o=this;null==(e=o.eventStore)||e.destroy(),null==(r=o.dependencyStore)||r.destroy(),null==(n=o.assignmentStore)||n.destroy(),null==(i=o.resourceStore)||i.destroy(),null==(s=o.calendarManagerStore)||s.destroy(),o.defaultCalendar.destroy(),null==(a=o.stm)||a.destroy(),t.doDestroy.call(this)}async loadInlineData(e){const t=this;t.isLoadingInlineData=!0,e.calendarsData&&(t.calendarManagerStore.data=e.calendarsData),e.resourcesData&&(t.resourceStore.data=e.resourcesData),e.assignmentsData&&(t.assignmentStore.data=e.assignmentsData),e.eventsData&&(t.eventStore.data=e.eventsData),e.tasksData&&(t.eventStore.data=e.tasksData),e.dependenciesData&&(t.dependencyStore.data=e.dependenciesData),await t.commitLoad(),t.isLoadingInlineData=!1}async commitLoad(){await this.commitAsync(),this.isDestroyed||this.trigger("load")}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}unJoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((r=>{r!==e.rootNode&&t(r)})):e.forEach(t)}resolveStoreAndModelClass(e,t){const r=(null==t?void 0:t.storeClass)||this[e+"StoreClass"];let n=null==t?void 0:t.modelClass;return n||(n=this.getDefaultConfiguration()[e+"ModelClass"]!==r.getDefaultConfiguration().modelClass?r.getDefaultConfiguration().modelClass:this[e+"ModelClass"]),{storeClass:r,modelClass:n}}setEventStore(e){this.eventStore=e}changeEventStore(e,t){const r=this,{stm:n}=r;if(r.detachStore(t),e instanceof Store)e.project=r,n.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=r.resolveStoreAndModelClass("event",e);e=new t(ObjectHelper.assign({modelClass:i,project:r,stm:n},e))}if(t&&n.hasStore(t)){n.removeStore(t),r.unJoinStoreRecords(t);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const r=t.event;if(r){const n=e.getById(r.id);n&&(t.event=n,i.delete(t))}})),t.afterEventRemoval()}return e.setProject(r),e}updateEventStore(e,t){this.attachStore(e),this.trigger("eventStoreChange",{store:e})}setAssignmentStore(e){this.assignmentStore=e}changeAssignmentStore(e,t){const r=this,{stm:n}=r;if(r.detachStore(t),t&&n.hasStore(t)&&(n.removeStore(t),r.unJoinStoreRecords(t)),e instanceof Store)e.project=r,n.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=r.resolveStoreAndModelClass("assignment",e);e=new t(ObjectHelper.assign({modelClass:i,project:r,stm:n},e))}return e.setProject(r),e}updateAssignmentStore(e,t){this.attachStore(e),this.trigger("assignmentStoreChange",{store:e})}setResourceStore(e){this.resourceStore=e}changeResourceStore(e,t){const r=this,{stm:n}=r;if(r.detachStore(t),e instanceof Store)e.project=r,n.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:i}=r.resolveStoreAndModelClass("resource",e);e=new t(ObjectHelper.assign({modelClass:i,project:r,stm:n},e))}if(t&&n.hasStore(t)){n.removeStore(t),r.unJoinStoreRecords(t);const{assignmentsForRemoval:i}=t;i.forEach((t=>{const r=t.resource;if(r){const n=e.getById(r.id);n&&(t.resource=n,i.delete(t))}})),t.afterResourceRemoval()}return e.setProject(r),e}updateResourceStore(e,t){this.attachStore(e),this.trigger("resourceStoreChange",{store:e})}setDependencyStore(e){this.dependencyStore=e}changeDependencyStore(e,t){const r=this;if(r.detachStore(t),e instanceof Store)e.project=r,r.stm.addStore(e),r.joinStoreRecords(e);else{const{storeClass:t,modelClass:n}=r.resolveStoreAndModelClass("dependency",e);e=new t(ObjectHelper.assign({modelClass:n,project:r,stm:r.stm},e))}return e}updateDependencyStore(e,t){this.attachStore(e),this.trigger("dependencyStoreChange",{store:e})}setCalendarManagerStore(e){this.calendarManagerStore=e}changeCalendarManagerStore(e,t){const r=this;if(r.detachStore(t),e instanceof Store)r.stm.addStore(e);else{const t=(null==e?void 0:e.storeClass)||r.calendarManagerStoreClass,n=(null==e?void 0:e.modelClass)||t.getDefaultConfiguration().modelClass||r.calendarModelClass;e=new t(ObjectHelper.assign({modelClass:n,project:r,stm:r.stm},e))}return e.setProject(r),e}updateCalendarManagerStore(e,t){this.attachStore(e),this.trigger("calendarManagerStoreChange",{store:e})}get calendar(){return this.$calendar||this.defaultCalendar}set calendar(e){this.$calendar=e}get effectiveCalendar(){return this.calendar}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}async addAssignment(e){return this.assignmentStore.add(e),this.commitAsync()}async addResource(e){return this.resourceStore.add(e),this.commitAsync()}async addDependency(e){return this.dependencyStore.add(e),this.commitAsync()}bufferedCommitAsync(){this.hasPendingAutoCommit||this.setTimeout({fn:"commitAsync",delay:10})}get hasPendingAutoCommit(){return this.hasTimeout("commitAsync")}unScheduleAutoCommit(){this.clearTimeout("commitAsync")}async commitAsync(){return this.isPerformingCommit?this.ongoing:this.ongoing=this.doCommitAsync()}async doCommitAsync(){const e=this;if(e.isPerformingCommit=!0,e.unScheduleAutoCommit(),await delay(0),!e.isDestroyed){for(const t of e.$invalidated)t.calculateInvalidated();const{isInitialCommit:t,silenceInitialCommit:r}=e,n=t&&r;e.assignmentStore.onCommitAsync(),e.dependencyStore.onCommitAsync(),e.isInitialCommitPerformed=!0,e.hasLoadedDataToCommit=!1,e.isPerformingCommit=!1;const i=[e.assignmentStore,e.dependencyStore,e.eventStore,e.resourceStore,e.calendarManagerStore];if(i.forEach((e=>{var t;return null==(t=e.suspendAutoCommit)?void 0:t.call(e)})),e.isWritingData=!0,e.trigger("refresh",{isInitialCommit:t,isCalculated:!0}),n)for(const t of e.$invalidated)t.finalizeInvalidated(!0);else{for(const t of e.$invalidated)t.beginBatch(!0),t.finalizeInvalidated();for(const t of e.$invalidated)t.endBatch(!1,!0)}return e.isWritingData=!1,e.$invalidated.clear(),e.trigger("dataReady"),i.forEach((e=>{var t;return null==(t=e.resumeAutoCommit)?void 0:t.call(e)})),e.trigger("commitFinalized"),!0}}async propagateAsync(){return this.commitAsync()}invalidate(e){this.$invalidated.add(e),this.bufferedCommitAsync()}async isValidDependency(){return!0}getStm(){return this.stm}set stm(e){(e=this.$stm=new StateTrackingManager(ObjectHelper.assign({disabled:!0},e))).ion({restoringStop:async()=>{e.disable(),await this.commitAsync(),this.isDestroyed||(e.enable(),this.trigger("stateRestoringDone"))}})}get stm(){return this.$stm}isEngineReady(){return!this.hasPendingAutoCommit&&!this.isPerformingCommit&&this.isInitialCommitPerformed}}return r.applyConfigs=!0,r}))){},DurationColumn=class extends NumberColumn{constructor(){super(...arguments),__publicField(this,"compositeField",!0)}static get $name(){return"DurationColumn"}static get type(){return"duration"}static get isGanttColumn(){return!0}static get fields(){return[{name:"decimalPrecision",defaultValue:1}]}static get defaults(){return{min:null,max:null,step:1,largeStep:0,field:"fullDuration",text:"L{Duration}",readOnly:!0,instantUpdate:!0,filterType:"duration",sortable(e,t){return e[this.field]-t[this.field]}}}construct(){super.construct(...arguments);const e=this.sortable;this.sortable=(...t)=>e.call(this,...t)}get defaultEditor(){const{max:e,min:t,step:r,largeStep:n}=this;return ObjectHelper.cleanupProperties({type:"duration",name:this.field,max:e,min:t,step:r,largeStep:n})}get durationUnitField(){return this.field+"Unit"}formatValue(e,t){e instanceof Duration&&(t=e.unit,e=e.magnitude);const r="number"==typeof this.grid.durationDisplayPrecision?this.grid.durationDisplayPrecision:this.decimalPrecision,n=Math.pow(10,r);return Math.round(e*n)/n+" "+DateHelper.getLocalizedNameOfUnit(t,1!==e)}defaultRenderer({record:e,isExport:t}){const r=e[this.field],n=typeof r,i="number"===n?r:null==r?void 0:r.magnitude,s="number"===n?e[this.durationUnitField]:null==r?void 0:r.unit;return"number"!=typeof i?t?"":null:this.formatValue(i,s)}toClipboardString({record:e}){return e[this.field].toString()}fromClipboardString({string:e,record:t}){const r=DateHelper.parseDuration(e,!0,this.durationUnit);return r&&"magnitude"in r?r:t.fullDuration}calculateFillValue({value:e,record:t}){return this.fromClipboardString({string:e,record:t})}};ColumnStore.registerColumnType(DurationColumn),DurationColumn._$name="DurationColumn";var ResourceCollapseColumn=class extends Column{static get $name(){return"ResourceCollapseColumn"}static get type(){return"resourceCollapse"}static get defaults(){return{width:"3em",align:"center",sortable:!1,groupable:!1,editor:!1,minWidth:0,cellCls:"b-resourcecollapse-cell",renderer:({record:e})=>({tag:"i",class:{"gt-icon":1,"gt-icon-expand-resource":1,"b-flip":"none"!==e.eventLayout}})}}onCellClick({record:e,event:t}){t.preventDefault(),e.eventLayout="none"!==e.eventLayout?"none":"stack"}};ColumnStore.registerColumnType(ResourceCollapseColumn),ResourceCollapseColumn._$name="ResourceCollapseColumn";var ResourceInfoColumn=class extends Column{static get $name(){return"ResourceInfoColumn"}static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showMeta","showImage","validNames","autoScaleThreshold","useNameAsImageName"]}static get defaults(){return{showImage:!0,showEventCount:!0,showMeta:null,showRole:!1,validNames:null,autoScaleThreshold:40,useNameAsImageName:!0,field:"name",htmlEncode:!1,width:140,cellCls:"b-resourceinfo-cell",editor:!VersionHelper.isTestEnv&&"text"}}construct(...e){super.construct(...e),this.avatarRendering=new AvatarRendering({element:this.grid.element})}doDestroy(){super.doDestroy(),this.avatarRendering.destroy()}getImageURL(e){const t=this.grid.resourceImagePath||"",r=t.split("//"),n=r.length>1?r[1]:t,i=StringHelper.joinPaths([n||"",e||""]);return r.length>1?r[0]+"//"+i:i}template(e,t){const r=this,{showImage:n,showRole:i,showMeta:s,showEventCount:a,grid:o}=r,{timeAxis:l,resourceImageExtension:c="",defaultResourceImageName:d}=o,u="string"==typeof i?i:"role",h=a&&e.eventStore.getEvents({includeOccurrences:o.enableRecurringEvents,resourceRecord:e,startDate:l.startDate,endDate:l.endDate}).length;let g;if(n&&!1!==e.image)if(e.imageUrl)g=e.imageUrl;else{const i="string"==typeof n?n:e.image||t&&r.useNameAsImageName&&t.toLowerCase()+c||d||"";g=i&&r.getImageURL(i),g&&!i.includes(".")&&(r.validNames&&!r.validNames.includes(i)||(g+=c))}return{class:"b-resource-info",children:[n&&r.avatarRendering.getResourceAvatar({resourceRecord:e,initials:e.initials,color:e.eventColor,iconCls:e.iconCls,imageUrl:g,defaultImageUrl:d&&this.getImageURL(d)}),i||a||s?{tag:"dl",children:[{tag:"dt",text:t},i?{tag:"dd",class:"b-resource-role",text:e[u]}:null,a?{tag:"dd",class:"b-resource-events",html:r.L("L{eventCountText}",h)}:null,s?{tag:"dd",class:"b-resource-meta",html:r.showMeta(e)}:null]}:t]}}defaultRenderer({grid:e,record:t,cellElement:r,value:n,isExport:i}){let s;return t.isSpecialRow?s="":i?s=n:(this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?r.style.fontSize=e.rowHeight/40+"em":r.style.fontSize="",s=this.template(t,n)),s}};function isLastLevel(e,t){return e===t.length-1}function isLastCell(e,t){return t===e.cells[e.cells.length-1]}ColumnStore.registerColumnType(ResourceInfoColumn),ResourceInfoColumn._$name="ResourceInfoColumn";var TimeAxisBase=class extends Widget{constructor(){super(...arguments),__publicField(this,"startDate",null),__publicField(this,"endDate",null),__publicField(this,"levels",[]),__publicField(this,"size",null)}set range({startDate:e,endDate:t}){const r=this;(r.startDate-e||r.endDate-t)&&(r.startDate=e,r.endDate=t,r.refresh())}buildCells(e=this.startDate,t=this.endDate){var r;const n=this,{sizeProperty:i}=n,{stickyHeaders:s,isVertical:a}=n.client||{},o=[],{length:l}=n.levels,c=n.levels.map(((r,o)=>{var c;const d=s&&(a||o<l-1);return{className:{"b-sch-header-row":1,["b-sch-header-row-"+r.position]:1,"b-sch-header-row-main":o===n.model.viewPreset.mainHeaderLevel,"b-lowest":isLastLevel(o,n.levels),"b-sticky-header":d},syncOptions:{releaseThreshold:5,syncIdField:"tickIndex"},dataset:{headerFeature:"headerRow"+o,headerPosition:r.position},children:null==(c=r.cells)?void 0:c.filter((r=>r.start<t&&r.end>e)).map(((e,t)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,["b-align-"+e.align]:e.align,"b-last":isLastCell(r,e)},dataset:{tickIndex:e.index,...globalThis.DEBUG&&{date:e.start.getTime()}},style:{[n.positionProperty]:e.coord,[i]:e.width,["min-"+i]:e.width},children:[{tag:"span",role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":d},html:e.value}]})))}}));return null==(r=n.client)||r.getHeaderDomConfigs(o),c.push(...o),{className:n.widgetClassList,syncOptions:{releaseThreshold:0},children:c}}render(e){super.render(e),this.refresh(!0)}refresh(e=!this.levels.length){const t=this,{columnConfig:r}=t.model,{levels:n}=t,i=n.length;if(e){n.length=0,r.forEach(((e,t)=>n[t]={position:t,cells:e})),t.size=n[0].cells.reduce(((e,t)=>e+t.width),0);const{parentElement:s}=t.element;s&&(n.length!==i||e)&&(s.classList.remove("b-sch-timeaxiscolumn-levels-"+i),s.classList.add("b-sch-timeaxiscolumn-levels-"+n.length))}t.startDate&&t.endDate&&(DomSync.sync({domConfig:t.buildCells(),targetElement:t.element,syncIdField:"headerFeature"}),t.trigger("refresh"))}get widgetClass(){return"b-timeaxis"}};__publicField(TimeAxisBase,"$name","TimeAxisBase"),__publicField(TimeAxisBase,"configurable",{compactCellWidthThreshold:15,model:null,cls:null,sizeProperty:null,positionProperty:null}),TimeAxisBase._$name="TimeAxisBase";var HorizontalTimeAxis=class extends TimeAxisBase{get positionProperty(){var e;return(null==(e=this.owner)?void 0:e.rtl)?"right":"left"}get width(){return this.size}onModelUpdate(){this.model.availableSpace>0&&this.model.availableSpace!==this.width&&this.refresh(!0)}updateModel(e){this.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onModelUpdate",thisObj:this})}};__publicField(HorizontalTimeAxis,"$name","HorizontalTimeAxis"),__publicField(HorizontalTimeAxis,"type","horizontaltimeaxis"),__publicField(HorizontalTimeAxis,"configurable",{model:null,sizeProperty:"width"}),HorizontalTimeAxis._$name="HorizontalTimeAxis";var ResourceHeader=class extends Widget{constructor(){super(...arguments),__publicField(this,"firstResource",-1),__publicField(this,"lastResource",-1)}construct(e){const t=this;e.scheduler._resourceColumns=t,super.construct(e),null!=t.imagePath&&t.element.classList.add("b-has-images"),EventHelper.on({element:t.element,delegate:".b-resourceheader-cell",capture:!0,click:"onResourceMouseEvent",dblclick:"onResourceMouseEvent",contextmenu:"onResourceMouseEvent",thisObj:t})}changeShowAvatars(e){var t;return null==(t=this.avatarRendering)||t.destroy(),e&&(this.avatarRendering=new AvatarRendering({element:this.element})),e}updateShowAvatars(){this.isConfiguring||this.refresh()}updateResourceStore(e){const t=this;t.detachListeners("resourceStore"),e&&(e.ion({name:"resourceStore",changePreCommit:"onResourceStoreDataChange",thisObj:t}),e.count&&t.onResourceStoreDataChange({}))}onResourceStoreDataChange({action:e}){const t=this;t.getConfig("fillWidth"),t.getConfig("fitWidth"),t.updateWidthCache();const{element:r}=t,n=t.totalWidth;t.scheduler.variableColumnWidths?t._fillWidth=t._fitWidth=!1:(t._fillWidth=t.configuredFillWidth,t._fitWidth=t.configuredFitWidth),n!==t.width&&(DomHelper.setLength(r,"width",n),t.column.set("width",n,t.column.grid.isConfiguring)),"removeall"===e&&(r.innerHTML=""),("remove"===e||"add"===e||"filter"===e||t.fitWidth||t.fillWidth)&&t.refreshWidths(),t.column.grid.toggleEmptyText()}get totalWidth(){return this.updateWidthCache()}updateWidthCache(){let e=0;const{scheduler:t}=this;return t.variableColumnWidths=!1,t.resourceStore.forEach((r=>{r.instanceMeta(t).insetStart=e,r.instanceMeta(t).insetEnd=e+(r.columnWidth||t.resourceColumnWidth),null==r.columnWidth?e+=t.resourceColumnWidth:(e+=r.columnWidth,t.variableColumnWidths=!0)})),e}changeColumnWidth(e){return this.refreshingWidths||(this.configuredColumnWidth=e),e}updateColumnWidth(e,t){const r=this;r.refreshingWidths||r.refreshWidths(),r.isConfiguring||(r.refresh(),r.trigger("columnWidthChange",{width:e,oldWidth:t}))}changeFillWidth(e){return this.configuredFillWidth=e}updateFillWidth(){this.isConfiguring||this.refreshWidths()}changeFitWidth(e){return this.configuredFitWidth=e}updateFitWidth(){this.isConfiguring||this.refreshWidths()}getImageURL(e){return StringHelper.joinPaths([this.imagePath||"",e||""])}updateImagePath(){this.isConfiguring||this.refresh()}updateAvailableWidth(e){this.refreshWidths()}refreshWidths(){var e;const t=this,{availableWidth:r,configuredColumnWidth:n}=t,i=null==(e=t.resourceStore)?void 0:e.count;if(!r||!i||t.scheduler.variableColumnWidths)return;t.refreshingWidths=!0;const s=t.fitWidth||t.fillWidth&&n*i<r?Math.floor(r/i):n,a=t.column.grid.enableEventAnimations&&Math.abs(t._columnWidth-s)>30;DomHelper.addTemporaryClass(t.element,"b-animating",a?300:0,t),t.columnWidth=s,t.refreshingWidths=!1}set visibleResources({firstResource:e,lastResource:t}){this.firstResource=e,this.lastResource=t,this.updateWidthCache(),this.refresh()}refresh(){var e;const t=this,{firstResource:r,scheduler:n,resourceStore:i,lastResource:s}=t,{variableColumnWidths:a}=n,o=i.isGrouped&&i.groupers[0].field,l=[];if(t.element.classList.toggle("b-grouped",Boolean(o)),!t.column.grid.isConfiguring&&r>-1&&s>-1&&s<i.count){let c;for(let d=r;d<=s;d++){const r=i.allResourceRecords[d],s=r.instanceMeta(i).groupParent,u=null==s?void 0:s.groupChildren;if(o&&s.id!==(null==c?void 0:c.dataset.resourceId)){const e=u[0].instanceMeta(n).insetStart,t=u[u.length-1].instanceMeta(n).insetEnd-e;c={className:"b-resourceheader-group-cell",dataset:{resourceId:s.id},style:{left:e,width:t},children:[{tag:"span",html:StringHelper.encodeHtml(u[0][o])},{className:"b-resourceheader-group-children",children:[]}]},l.push(c)}const h=r.instanceMeta(n),g=r.columnWidth||t.columnWidth,p=o?h.insetStart-c.style.left:a?h.insetStart:d*t.columnWidth,m={className:new DomClassList({"b-resourceheader-cell":1}),dataset:{resourceId:r.id},style:{[n.rtl?"right":"left"]:p,width:g},children:[]};if(t.headerRenderer){const e=t.headerRenderer({elementConfig:m,resourceRecord:r});null!=e&&(m.html=e)}else{let n;if(r.imageUrl)n=r.imageUrl;else if(null!=t.imagePath&&!1!==r.image){const i=r.image||(null==(e=r.name)?void 0:e.toLowerCase())+t.imageExtension;n=t.getImageURL(i)}m.children.push(t.showAvatars&&t.avatarRendering.getResourceAvatar({resourceRecord:r,initials:r.initials,color:r.eventColor,iconCls:r.iconCls,defaultImageUrl:t.defaultImageName&&t.getImageURL(t.defaultImageName),imageUrl:n}),{tag:"span",className:"b-resource-name",html:StringHelper.encodeHtml(r.name)})}o?c.children[1].children.push(m):l.push(m)}}DomSync.sync({domConfig:{onlyChildren:!0,children:l},targetElement:t.element,syncIdField:"resourceId"})}onResourceMouseEvent(e){const t=e.target.closest(".b-resourceheader-cell"),r=this.resourceStore.getById(t.dataset.resourceId);this.trigger("resourceHeader"+StringHelper.capitalize(e.type),{resourceRecord:r,event:e})}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.resourceStore,delete t.column,delete t.type,t}};__publicField(ResourceHeader,"$name","ResourceHeader"),__publicField(ResourceHeader,"type","resourceheader"),__publicField(ResourceHeader,"configurable",{resourceStore:null,headerRenderer:null,showAvatars:{value:!0,$config:"nullify"},fillWidth:!0,fitWidth:!1,columnWidth:150,imagePath:null,imageExtension:null,defaultImageName:null,availableWidth:null}),ResourceHeader._$name="ResourceHeader";var TimeAxisColumn=class extends(Events_default(WidgetColumn)){static get fields(){return[{name:"locked",persist:!1},{name:"flex",persist:!1},{name:"width",persist:!1},{name:"cellCls",persist:!1},{name:"field",persist:!1},"mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal",exportable:!1,htmlEncode:!1}}static get type(){return"timeAxis"}construct(e){const t=this;super.construct(...arguments),t.thisObj=t,t.timeAxisViewModel=t.grid.timeAxisViewModel,t.mode=t.mode,t.grid.ion({paint:"onTimelinePaint",thisObj:t,once:!0})}static get autoExposeFields(){return!0}doDestroy(){var e,t;null==(e=this.resourceColumns)||e.destroy(),null==(t=this.timeAxisView)||t.destroy(),super.doDestroy()}set mode(e){const t=this,{grid:r}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new HorizontalTimeAxis({model:t.timeAxisViewModel,compactCellWidthThreshold:t.compactCellWidthThreshold,owner:r,client:r}):"vertical"===e&&(t.resourceColumns=ResourceHeader.new({column:t,scheduler:r,resourceStore:r.resourceStore,imagePath:r.resourceImagePath,imageExtension:r.resourceImageExtension,defaultImageName:r.defaultResourceImageName},r.resourceColumns||{}),t.relayEvents(t.resourceColumns,["resourceheaderclick","resourceheaderdblclick","resourceheadercontextmenu"]))}get mode(){return this.get("mode")}onViewModelUpdate({source:e}){const t=this;t.grid.timeAxisSubGrid.collapsed||("horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.grid.refresh(),t.subGrid.refreshFakeScroll()):"vertical"===t.mode&&t.grid.refreshRows())}onTimelinePaint({firstPaint:e}){var t;const r=this;r.subGrid.insertRowsBefore&&e&&(r.subGridElement.classList.add("b-timeline-subgrid"),"vertical"===r.mode&&(r.refreshHeader(),null==(t=r.grid)||t.onHeightChange()))}refreshHeader(e){const t=this,{element:r}=t;r&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(void 0,void 0,!0),t.timeAxisView.rendered?t.timeAxisView.refresh(!0):(r.innerHTML="",t.timeAxisView.render(r))):"vertical"===t.mode&&(t.resourceColumns.currentElement||(r.innerHTML="",t.resourceColumns.render(r))))}internalRenderer(e){const{grid:t}=this;if(t.project.isInitialCommitPerformed||t.project.isDelayingCalculation)return t.currentOrientation.renderer(e),super.internalRenderer(e)}get timeAxisViewModel(){return this._timeAxisViewModel}set timeAxisViewModel(e){const t=this;t.detachListeners("tavm"),null==e||e.ion({name:"tavm",update:"onViewModelUpdate",prio:-1e4,thisObj:t}),t._timeAxisViewModel=e,t.timeAxisView&&(t.timeAxisView.model=e)}getState(){const e=super.getState();return delete e.width,delete e.flex,e}};__publicField(TimeAxisColumn,"$name","TimeAxisColumn"),ColumnStore.registerColumnType(TimeAxisColumn),TimeAxisColumn._$name="TimeAxisColumn";var VerticalTimeAxis=class extends TimeAxisBase{static get $name(){return"VerticalTimeAxis"}static get configurable(){return{cls:"b-verticaltimeaxis",sizeProperty:"height",positionProperty:"top",wrapText:!0}}buildHorizontalCells(){const e=this,{client:t}=e,r=null==t?void 0:t.stickyHeaders,n=[],i=e.levels.reduce(((t,n,i)=>{var s;return n.cells&&t.push(...null==(s=n.cells)?void 0:s.filter((t=>t.start<e.endDate&&t.end>e.startDate)).map(((t,n,s)=>({role:"presentation",className:{"b-sch-header-timeaxis-cell":1,[t.headerCellCls]:t.headerCellCls,["b-align-"+t.align]:t.align,"b-last":n===s.length-1,"b-lowest":i===e.levels.length-1},dataset:{tickIndex:t.index,cellId:i+"-"+t.index,headerPosition:i,...globalThis.DEBUG&&{date:t.start.getTime()}},style:{top:t.coord,height:t.width,minHeight:t.width},children:[{role:"presentation",className:{"b-sch-header-text":1,"b-sticky-header":r},html:t.value}]})))),t}),[]);return null==t||t.getHeaderDomConfigs(n),i.push(...n),{className:e.widgetClassList,dataset:{headerFeature:"headerRow0",headerPosition:0},syncOptions:{releaseThreshold:5,syncIdField:"cellId"},children:i}}get height(){return this.size}};VerticalTimeAxis._$name="VerticalTimeAxis";var VerticalTimeAxisColumn=class extends Column{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,minWidth:0,resizable:!1,cellCls:"b-verticaltimeaxiscolumn",locked:!0,flex:1,alwaysClearCell:!1}}get isFocusable(){return!1}construct(e){super.construct(...arguments),this.view=new VerticalTimeAxis({model:this.grid.timeAxisViewModel,client:this.grid})}renderer({cellElement:e,size:t}){this.view.render(e),t.height=this.view.height}getCurrentConfig(e){const t=super.getCurrentConfig(e);return delete t.id,delete t.region,delete t.type,delete t.field,delete t.ariaLabel,delete t.cellAriaLabel,t}};__publicField(VerticalTimeAxisColumn,"$name","VerticalTimeAxisColumn"),ColumnStore.registerColumnType(VerticalTimeAxisColumn),VerticalTimeAxisColumn._$name="VerticalTimeAxisColumn";var AbstractCrudManagerValidation_default=e=>class extends e{static get $name(){return"AbstractCrudManagerValidation"}static get configurable(){return{validateResponse:!0,skipSuccessProperty:!0,crudLoadValidationWarningPrefix:"CrudManager load response error(s):",crudSyncValidationWarningPrefix:"CrudManager sync response error(s):",supportShortSyncResponseNote:"Note:",disableValidationNote:"提示: 要禁用此验证，请将“validateResponse”配置设置为false"}}get crudLoadValidationMandatoryStores(){return[]}getStoreLoadResponseWarnings(e,t,r){const n=[],{storeId:i}=e,s=this.crudLoadValidationMandatoryStores,a={[i]:{}};return t?t.rows||(n.push('- "'+i+'" 存储部分应该有一个带有存储记录数组的“rows”属性'),a[i].rows=["..."]):(null==s?void 0:s.includes(i))&&(n.push("- 找不到“"+i+"”存储节。它应该包含存储数据"),a[i].rows=["..."]),n.length&&Object.assign(r,a),n}getLoadResponseWarnings(e){const t=[],r={};return this.skipSuccessProperty||(r.success=!0),this.forEachCrudStore(((n,i,s)=>{t.push(...this.getStoreLoadResponseWarnings(s,null==e?void 0:e[i],r))})),t.length&&(t.push("请将您的响应调整为如下所示：\n"+JSON.stringify(r,null,4).replace(/"\.\.\."/g,"...")),t.push(this.disableValidationNote)),t}validateLoadResponse(e){const t=this.getLoadResponseWarnings(e);t.length&&console.warn(this.crudLoadValidationWarningPrefix+"\n"+t.join("\n"))}getStoreSyncResponseWarnings(e,t,r,n){const i=[],s=[],a=[],{storeId:o}=e,l={[o]:{}},c=e.phantomIdField||this.phantomIdField,{modelClass:d}=e.store,{idField:u}=d,h=(null==r?void 0:r.rows)||[],g=(null==r?void 0:r.removed)||[];let p=!1;if((null==t?void 0:t.added)&&(s.push(...t.added.filter((e=>!h.find((t=>t[c]==e[c]))&&!g.find((t=>t[c]==e[c]||t[u]==e[c])))).map((e=>({[c]:e[c],[u]:"..."})))),s.length)){const e=s.map((e=>"#"+e[c])).join(", ");i.push('- "'+o+'" store "rows" section should mention added record(s) '+e+' sent in the request. It should contain the added records identifiers (both phantom and "real" ones assigned by the backend).')}if(this.supportShortSyncResponse)!s.length&&r&&(("object"!=typeof r||Array.isArray(r))&&(i.push('- "'+o+'" store section should be an Object.'),l[o]["..."]="..."),r.rows&&!Array.isArray(r.rows)&&(i.push('- "'+o+'" store "rows" section should be an array'),s.push("...")),r.removed&&!Array.isArray(r.removed)&&(i.push('- "'+o+'" store "removed" section should be an array:'),a.push("...")));else{if(null==t?void 0:t.updated){const e=t.updated.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})));if(s.push(...e),e.length){const t=e.map((e=>"#"+e[u])).join(", ");i.push('- "'+o+'" store "rows" section should mention updated record(s) '+t+" sent in the request. It should contain the updated record identifiers."),p=!0}}if(s.length&&s.push("..."),(null==t?void 0:t.removed)&&(a.push(...t.removed.filter((e=>!h.find((t=>t[u]==e[u])))).map((e=>({[u]:e[u]})))),a.length)){const e=a.map((e=>"#"+e[u])).join(", ");i.push('- "'+o+'" store "removed" section should mention removed record(s) '+e+" sent in the request. It should contain the removed record identifiers."),l[o].removed=a,a.push("..."),p=!0}}return s.length&&(l[o].rows=s),i.length||delete l[o],Object.assign(n,l),{messages:i,showSupportShortSyncResponseNote:p}}getSyncResponseWarnings(e,t){const r=[],n={},i=t.pack;this.skipSuccessProperty||(n.success=!0);let s=!1;return this.forEachCrudStore(((t,a,o)=>{const l=this.getStoreSyncResponseWarnings(o,null==i?void 0:i[a],e[a],n);s=s||l.showSupportShortSyncResponseNote,r.push(...l.messages)})),r.length&&(r.push("Please adjust your response to look like this:\n"+JSON.stringify(n,null,4).replace(/"\.\.\.":\s*"\.\.\."/g,",,,").replace(/"\.\.\."/g,"...")),s&&r.push(this.supportShortSyncResponseNote),r.push(this.disableValidationNote)),r}validateSyncResponse(e,t){const r=this.getSyncResponseWarnings(e,t);r.length&&console.warn(this.crudSyncValidationWarningPrefix+"\n"+r.join("\n"))}},AbstractCrudManagerError=class extends Error{},CrudManagerRequestError=class extends AbstractCrudManagerError{constructor(e={}){var t,r;super(e.message||e.request&&StringHelper.capitalize(null==(t=e.request)?void 0:t.type)+" failed"||"Crud Manager request failed"),Object.assign(this,e),this.action=null==(r=this.request)?void 0:r.type}},storeSortFn=function(e,t,r){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[r]||0)<(t=t[r]||0)?-1:e>t?1:0},storeLoadSortFn=function(e,t){return storeSortFn(e,t,"loadPriority")},storeSyncSortFn=function(e,t){return storeSortFn(e,t,"syncPriority")},AbstractCrudManagerMixin_default=e=>{var t;e.$$meta=e.$meta;const r=[];return e.isEvents||r.push(Events_default),e.isDelayable||r.push(Delayable_default),r.push(AbstractCrudManagerValidation_default),t=class extends((e||Base).mixin(...r)){static get $name(){return"AbstractCrudManagerMixin"}static get defaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,supportShortSyncResponse:!0,phantomIdField:"$PhantomId",phantomParentIdField:"$PhantomParentId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],orderedCrudStores:[],writeAllFields:!1,crudIgnoreUpdates:0,autoSyncSuspendCounter:0,crudLoaded:!1,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}get isCrudManager(){return!0}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},super.construct(e)}afterConstruct(){super.afterConstruct(),this.autoLoad&&(this._autoLoadPromise=this.doAutoLoad())}get loadUrl(){var e,t;return null==(t=null==(e=this.transport)?void 0:e.load)?void 0:t.url}updateLoadUrl(e){ObjectHelper.setPath(this,"transport.load.url",e)}get syncUrl(){var e,t;return null==(t=null==(e=this.transport)?void 0:e.sync)?void 0:t.url}updateSyncUrl(e){ObjectHelper.setPath(this,"transport.sync.url",e)}getStoreDescriptor(e){return e?e instanceof Store?this.crudStores.find((t=>t.store===e)):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(Store.getStore(e)):null}fillStoreDescriptor(e){const{store:t}=e,{storeIdProperty:r=this.storeIdProperty,modelClass:n}=t;return e.storeId||(e.storeId=t[r]||t.id),e.idField||(e.idField=n.idField),e.phantomIdField||(e.phantomIdField=n.phantomIdField),e.phantomParentIdField||(e.phantomParentIdField=n.phantomParentIdField),"writeAllFields"in e||(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach((t=>t.storeId&&(e[t.storeId]=t)))}getCrudStore(e){const t=this.getStoreDescriptor(e);return null==t?void 0:t.store}forEachCrudStore(e,t=this){if(!e)throw new Error("必须提供迭代器功能");this.crudStores.every((r=>!1!==e.call(t,r.store,r.storeId,r)))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(const e of this._crudStores)e.loadPriority=e.syncPriority=0}get crudStores(){return this._crudStores}get orderedCrudStores(){return this._orderedCrudStores}set orderedCrudStores(e){return this._orderedCrudStores=e}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}internalAddCrudStore(e){const t=this;let r;return e instanceof Store?r={store:e}:"object"==typeof e?(e.store||(e={storeId:e.id,store:new Store(e)}),r=e):r={store:Store.getStore(e)},t.fillStoreDescriptor(r),(e=r.store).setCrudManager?e.setCrudManager(t):e.crudManager=t,e.pageSize=null,(t.loadUrl||t.syncUrl)&&(e.autoCommit=!1,e.autoLoad=!1,(e.createUrl||e.updateUrl||e.deleteUrl||e.readUrl)&&console.warn("您已经在一个由CrudManager处理的Store上配置了一个URL，该CrudManageer也配置了URL。应删除存储URL")),t.bindCrudStoreListeners(e),r}addCrudStore(e,t,r){if(!(null==(e=ArrayHelper.asArray(e))?void 0:e.length))return;const n=this,i=e.map(n.internalAddCrudStore,n);void 0===t?n.crudStores.push(...i):(r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),t+=n.crudStores.indexOf(r)),n.crudStores.splice(t,0,...i)),n.orderedCrudStores.push(...i),n.updateCrudStoreIndex()}addPrioritizedStore(e){const t=this;t.hasCrudStore(e)||t.addCrudStore(e,ArrayHelper.findInsertionIndex(e,t.crudStores,storeLoadSortFn)),t.hasApplySequenceStore(e)||t.addStoreToApplySequence(e,ArrayHelper.findInsertionIndex(e,t.syncApplySequence,storeSyncSortFn))}hasCrudStore(e){var t;return null==(t=this.crudStores)?void 0:t.some((t=>t===e||t.store===e||t.storeId===e))}removeCrudStore(e){const t=this,r=t.crudStores,n=r.find((t=>t===e||t.store===e||t.storeId===e));if(!n)throw new Error("Store not found in stores collection");t.unbindCrudStoreListeners(n.store),delete t.crudStoresIndex[n.storeId],ArrayHelper.remove(r,n),t.syncApplySequence&&t.removeStoreFromApplySequence(e)}bindCrudStoreListeners(e){e.ion({name:e.id,addConfirmed:"onCrudStoreChange",change:"onCrudStoreChange",destroy:"onCrudStoreDestroy",thisObj:this})}unbindCrudStoreListeners(e){this.detachListeners(e.id)}addStoreToApplySequence(e,t,r){if(!e)return;e=ArrayHelper.asArray(e);const n=this,i=e.reduce(((e,t)=>{const r=n.getStoreDescriptor(t);return r&&e.push(r),e}),[]);if(void 0===t)n.syncApplySequence.push(...i);else{let e=t;r&&((r instanceof Store||"object"!=typeof r)&&(r=n.getStoreDescriptor(r)),e+=n.syncApplySequence.indexOf(r)),n.syncApplySequence.splice(e,0,...i)}const s=n.syncApplySequence.map((({storeId:e})=>e));n.orderedCrudStores=[...n.syncApplySequence],n.crudStores.forEach((e=>{s.includes(e.storeId)||n.orderedCrudStores.push(e)}))}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex((t=>t===e||t.store===e||t.storeId===e));t>-1&&(this.syncApplySequence.splice(t,1),this.orderedCrudStores.splice(t,1))}hasApplySequenceStore(e){return this.syncApplySequence.some((t=>t===e||t.store===e||t.storeId===e))}onCrudStoreDestroy({source:e}){this.removeCrudStore(e)}onCrudStoreChange(e){const t=this;t.crudIgnoreUpdates||(t.crudStoreHasChanges(null==e?void 0:e.source)?(t.trigger("hasChanges"),t.autoSync&&t.scheduleAutoSync()):t.trigger("noChanges"))}suspendAutoSync(){this.autoSyncSuspendCounter++}resumeAutoSync(e=!0){const t=this;t.autoSyncSuspendCounter--,t.autoSyncSuspendCounter<=0&&(t.autoSyncSuspendCounter=0,e&&t.autoSync&&t.crudStoreHasChanges()&&t.sync())}get isAutoSyncSuspended(){return this.autoSyncSuspendCounter>0}scheduleAutoSync(){const e=this;e.hasTimeout("autoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"autoSync",fn:()=>{e.sync().catch((e=>{}))},delay:e.autoSyncTimeout})}async triggerFailedRequestEvents(e,t,r,n){const{options:i,type:s}=e;this.trigger("requestFail",{requestType:s,response:t,responseText:r,responseOptions:n}),this.trigger(s+"Fail",{response:t,responseOptions:n,responseText:r,options:i})}async internalOnResponse(e,t,r){const n=this,i=t?n.decode(t):null,{options:s,type:a}=e;if(t&&!i&&console.error("Failed to parse response: "+t),i&&(n.skipSuccessProperty?!1!==i.success:i.success)){if(!1!==n.trigger("beforeResponseApply",{requestType:a,response:i})&&!1!==n.trigger("before"+StringHelper.capitalize(a)+"Apply",{response:i,options:s})){if(n.crudRevision=i.revision,await n.applyResponse(e,i,s),n.isDestroyed)return;n.trigger("requestDone",{requestType:a,response:i,responseOptions:r}),n.trigger(a,{response:i,responseOptions:r,options:s}),"load"!==a&&n.crudStoreHasChanges()||(n.trigger("noChanges"),"load"===a&&n.emitCrudStoreEvents(e.pack.stores,"afterRequest"))}}else n.triggerFailedRequestEvents(e,i,t,r);return i}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){!this.crudIgnoreUpdates||--this.crudIgnoreUpdates||e||this.onCrudStoreChange()}get isBatchingChanges(){return this.crudIgnoreUpdates>0}crudStoreHasChanges(e){return e?this.isCrudStoreDirty(this.getCrudStore(e)):this.crudStores.some((e=>this.isCrudStoreDirty(e.store)))}isCrudStoreDirty(e){return Boolean(e.changes)}doAutoLoad(){return this.load().catch((e=>{}))}emitCrudStoreEvents(e,t,r){const n={action:"read"+t,...r};for(const r of this.crudStores)e.includes(r.storeId)&&r.store.trigger(t,n)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},r=this.crudStores,n=Object.assign({},e);return delete n.request,t.stores=r.map((e=>{var t;const r=null==n?void 0:n[e.storeId],i=e.pageSize||(null==(t=e.store)?void 0:t.pageSize);if(r||i){const t=Object.assign({storeId:e.storeId,page:1},r);return i&&(t.pageSize=i),e.currentPage=t.page,r&&delete n[e.storeId],t}return e.storeId})),Object.assign(t,n),t}loadCrudStore(e,t,r){const n=null==t?void 0:t.rows;(null==r?void 0:r.append)||(null==t?void 0:t.append)?e.add(n):e.data=n,e.trigger("load",{data:n})}loadDataToCrudStore(e,t,r){const n=e.store,i=null==t?void 0:t.rows;n.__loading=!0,i&&this.loadCrudStore(n,t,r,e),n.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach((r=>{const n=r.storeId,i=e[n];i&&this.loadDataToCrudStore(r,i,t[n])})),this.resumeChangesTracking(!0)}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}get isCrudManagerSyncing(){return Boolean(this.activeRequests.sync||this.applyingSyncResponse)}get isLoadingOrSyncing(){return Boolean(this.isCrudManagerLoading||this.isCrudManagerSyncing)}load(e){"string"==typeof e&&(e={request:{url:e}});const t=this,r=t.getLoadPackage(e);return t._autoLoadPromise=null,new Promise(((n,i)=>{if(!1!==t.trigger("beforeLoad",{pack:r})){const{load:s}=t.activeRequests;s&&(t.cancelRequest(s.desc,s.reject),t.trigger("loadCanceled",{pack:r}));const a=Objects.assign({id:r.requestId,data:t.encode(r),type:"load",success:t.onCrudRequestSuccess,failure:t.onCrudRequestFailure,thisObj:t},null==e?void 0:e.request);t.activeRequests.load={type:"load",options:e,pack:r,resolve:n,reject(...e){a.success=a.failure=null,i(...e)},id:r.requestId,desc:t.sendRequest(a)},t.emitCrudStoreEvents(r.stores,"loadStart"),t.trigger("loadStart",{pack:r})}else t.trigger("loadCanceled",{pack:r}),i({cancelled:!0})}))}getActiveCrudManagerRequest(e){let t=this.activeRequests[e];return!t&&this.trackResponseType&&(t=Object.values(this.activeRequests)[0]),t}prepareAddedRecordData(e,t){const r=this,{store:n}=t,{isTree:i}=n,s=t.phantomIdField||r.phantomIdField,a=t.phantomParentIdField||r.phantomParentIdField,o=n.modelClass.allFields.filter((e=>e.subStore)),l=e.constructor,c=Object.assign(e.persistableData,{[s]:e.id});if(i){const{parent:t}=e;t&&!t.isRoot&&t.isPhantom&&(c[a]=t.id)}return r.resetIdsBeforeSync&&ObjectHelper.deletePath(c,l.idField),o.forEach((t=>{const n=e.get(t.name);n.allCount&&(c[t.dataSource]={added:n.getRange().map((e=>r.prepareAddedRecordData(e,{store:n})))})})),c}prepareAdded(e,t){return e.filter((e=>e.isValid)).map((e=>this.prepareAddedRecordData(e,t)))}prepareUpdated(e,t){const{store:r}=t,{isTree:n}=r,i=t.writeAllFields||!1!==t.writeAllFields&&this.writeAllFields,s=t.phantomParentIdField||this.phantomParentIdField,a=r.modelClass.allFields.filter((e=>e.subStore));if(t.store.tree){const r=t.store.rootNode;e=e.filter((e=>e!==r))}return e.filter((e=>e.isValid)).reduce(((e,t)=>{let r;if(r=i?t.persistableData:t.modificationDataToWrite,n){const{parent:e}=t;e&&!e.isRoot&&e.isPhantom&&(r[s]=e.id)}return a.forEach((e=>{const n=t.get(e.name);r[e.dataSource]=this.getCrudStoreChanges({store:n})})),ObjectHelper.isEmpty(r)||e.push(r),e}),[])}prepareRemoved(e){return e.map((e=>{const t=e.constructor;return ObjectHelper.setPath({},t.idField,e.id)}))}getCrudStoreChanges(e){const{store:t}=e;let r,{added:n=[],modified:i=[],removed:s=[]}=t.changes||{};return n.length&&(n=this.prepareAdded(n,e)),i.length&&(i=this.prepareUpdated(i,e)),s.length&&(s=this.prepareRemoved(s)),(n.length||i.length||s.length)&&(r={},n.length&&(r.added=n),i.length&&(r.updated=i),s.length&&(r.removed=s)),r}getChangesetPackage(){const{changes:e}=this;return e||this.forceSync?{type:"sync",requestId:this.requestId,revision:this.crudRevision,...e}:null}get changes(){const e={};return this.crudStores.forEach((t=>{const r=this.getCrudStoreChanges(t);r&&(e[t.storeId]=r)})),Object.keys(e).length>0?e:null}getRowsToApplyChangesTo({store:e,storeId:t},r,n){var i,s;const a=this,{modelClass:o}=e,l=o.idField,{updated:c,removed:d}=n||{};let u,h,g;if(r){g=!0;const e={};u=(null==(i=r.rows)?void 0:i.slice())||[],h=(null==(s=r.removed)?void 0:s.slice())||[],[...u,...h].forEach((t=>{const r=ObjectHelper.getPath(t,l);e[r]=!0})),a.supportShortSyncResponse&&(null==c||c.forEach((t=>{const r=ObjectHelper.getPath(t,l);e[r]||u.push({[l]:r})})),null==d||d.forEach((t=>{const r=ObjectHelper.getPath(t,l);e[r]||h.push({[l]:r})})))}else(c||d)&&(g=!1,u=c,h=d);return u=(null==u?void 0:u.length)?u:null,h=(null==h?void 0:h.length)?h:null,{rows:u,removed:h,remote:g}}applyChangesToStore(e,t,r){var n;const i=this,s=e.phantomIdField||i.phantomIdField,{store:a}=e,o=a.modelClass.getFieldDataSource("id"),l=a.modelClass.allFields.filter((e=>e.subStore)),{rows:c,removed:d,remote:u}=i.getRowsToApplyChangesTo(e,t,r),h=[],g=[];if(c)for(const e of c)a.getById(null!=(n=e[s])?n:e[o])?g.push(e):h.push(e);const p=[];g.length&&l.length&&g.forEach((e=>{var t,n,c;const d=a.getById(null!=(t=e[s])?t:e[o]),u=(null==(n=r.added)?void 0:n.find((t=>t[s]==e[s])))||(null==(c=r.updated)?void 0:c.find((t=>t[o]==e[o]))),h={};l.forEach((t=>{const r=d.get(t.name);i.applyChangesToStore({store:r},e[t.dataSource],null==u?void 0:u[t.dataSource]),h[t.dataSource]="foo",delete e[t.dataSource]})),p.push([d,h])}));const m=a.applyChangeset({removed:d,added:h,updated:g},null,s,u,!0);return p.forEach((([e,t])=>Object.assign(m.get(e.id),t))),m}applySyncResponse(e,t){var r;const n=this,i=n.orderedCrudStores;n.applyingChangeset=n.applyingSyncResponse=!0,n.suspendChangesTracking();for(const s of i)n.applyChangesToStore(s,e[s.storeId],null==(r=null==t?void 0:t.pack)?void 0:r[s.storeId]);n.resumeChangesTracking(!0),n.applyingChangeset=n.applyingSyncResponse=!1}applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,r){const n=this;switch(n.trackResponseType&&t.type||e.type){case"load":n.validateResponse&&n.validateLoadResponse(t),n.applyLoadResponse(t,r);break;case"sync":n.validateResponse&&n.validateSyncResponse(t,e),n.applySyncResponse(t,e)}}applyChangeset(e,t=null,r,n=!1){const i=this,s=n?new Map:void 0;i.suspendAutoSync(),i.suspendChangesTracking();for(const{store:r,phantomIdField:a}of i.orderedCrudStores)if(e[r.id]){const o=r.applyChangeset(e[r.id],t,a||i.phantomIdField,!0,n);o&&s.set(r.id,o)}return i.resumeChangesTracking(!0),i.resumeAutoSync(!1),s}get requestId(){return Number.parseInt(""+Date.now()+this._requestId++)}sync(){const e=this;return e.clearTimeout("autoSync"),e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.finally((()=>e.sync()))):e.activeSyncPromise=new Promise(((t,r)=>{const n=e.getChangesetPackage();n?!1!==e.trigger("beforeSync",{pack:n})?(e.trigger("syncStart",{pack:n}),e.activeRequests.sync={type:"sync",pack:n,resolve:t,reject:r,id:n.requestId,desc:e.sendRequest({id:n.requestId,data:e.encode(n),type:"sync",success:e.onCrudRequestSuccess,failure:e.onCrudRequestFailure,thisObj:e})}):(e.trigger("syncCanceled",{pack:n}),r({cancelled:!0})):t(null)})).catch((e=>{if(e&&!e.cancelled)throw e;return e}))}async onCrudRequestSuccess(e,t,r){const n=this,{type:i,id:s}=r;if(n.isDestroyed)return;let a="";r=n.activeRequests[i];try{a=await e.text()}catch(e){}if(n.isDestroyed)return;if((null==r?void 0:r.id)!==s)throw new Error("Interleaved "+i+" operation detected");n.activeRequests[i]=null;const o=await n.internalOnResponse(r,a,t);if(!n.isDestroyed){if(!o||(n.skipSuccessProperty?!1===(null==o?void 0:o.success):!(null==o?void 0:o.success))){const t={rawResponse:e,response:o,request:r};(null==o?void 0:o.message)&&(t.message=o.message),r.reject(new CrudManagerRequestError(t))}n["crud"+StringHelper.capitalize(r.type)+"ed"]=!0,r.resolve({response:o,rawResponse:e,responseText:a,request:r})}}async onCrudRequestFailure(e,t,r){var n;const i=this;if(i.isDestroyed)return;r=i.activeRequests[r.type];const s=null==(n=null==t?void 0:t.abortController)?void 0:n.signal;if(!Boolean(null==s?void 0:s.aborted)){let n,s="";try{s=await e.text(),n=i.decode(s)}catch(e){}if(i.isDestroyed)return;if(i.triggerFailedRequestEvents(r,n,s,t),i.isDestroyed)return;r.reject(new CrudManagerRequestError({rawResponse:e,request:r}))}i.activeRequests[r.type]=null}acceptChanges(){this.crudStores.forEach((e=>e.store.acceptChanges()))}revertChanges(){this.revertCrudStoreChanges()}revertCrudStoreChanges(){const{usesSingleAssignment:e}=this.eventStore;this.orderedCrudStores.forEach((({store:t})=>(!t.isAssignmentStore||!e)&&t.revertChanges()))}doDestroy(){const e=this,{load:t,sync:r}=e.activeRequests;for(t&&e.cancelRequest(t.desc,t.reject),r&&e.cancelRequest(r.desc,r.reject);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);super.doDestroy&&super.doDestroy()}},__publicField(t,"configurable",{loadUrl:null,syncUrl:null,forceSync:null}),__publicField(t,"delayable",{doAutoLoad:"raf"}),t},AbstractCrudManager=class extends(Base.mixin(AbstractCrudManagerMixin_default)){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}get json(){return StringHelper.safeJsonStringify(this)}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.forEachCrudStore((t=>{const r=t.storeId+"Data";e[r]&&(t.data=e[r])}))}static get defaultConfig(){return{stores:null}}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}toJSON(){const e={};return this.forEachCrudStore(((t,r)=>e[r+"Data"]=t.toJSON())),e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}};AbstractCrudManager._$name="AbstractCrudManager";var AjaxTransport_default=e=>class t extends(e||Base){static get $name(){return"AjaxTransport"}static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e,t){var r;null==(r=e.abort)||r.call(e),this.isDestroying||t({cancelled:!0})}shouldUseBodyForRequestData(e,t,r){return!("HEAD"===t||"GET"===t||r)}sendRequest(e){const r=this,{data:n}=e,i=r.transport[e.type]||{},s=Objects.assign({},i,i.requestConfig);e.url&&(s.url=e.url),s.method=s.method||t.defaultMethod[e.type],s.params=Objects.assign(s.params||{},e.params);let a,o,{paramName:l}=s;if(r.shouldUseBodyForRequestData(i,s.method,l)?(s.body=n,s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json"):(l=l||"data",s.params[l]=n),!s.url)throw new Error("Trying to request without URL specified");function c(){s.queryParams=s.params,delete s.params;let t=!1;const n=Objects.assign({},s,s.fetchOptions);return a=AjaxHelper.fetch(s.url,n),a.catch((e=>{var i,s;a.done=!0,null==(i=r.trigger)||i.call(r,"responseReceived",{success:!1});const o=null==(s=n.abortController)?void 0:s.signal;return o&&(t=o.aborted,t||console.warn(e)),{error:e,cancelled:t}})).then((t=>{var i;a.done=!0,null==(i=r.trigger)||i.call(r,"responseReceived",{success:Boolean(null==t?void 0:t.ok)});const s=(null==t?void 0:t.ok)?e.success:e.failure;return null==s?void 0:s.call(e.thisObj||r,t,n,e)}))}delete s.requestConfig,delete s.paramName;const d=r.trigger("beforeSend",{params:s.params,requestType:e.type,requestConfig:s,config:e});return o=Objects.isPromise(d)?d.then(c):c(),o.abort=()=>{var e;a.done||null==(e=a.abort)||e.call(a)},o}},JsonEncoder_default=e=>class extends(e||Base){static get $name(){return"JsonEncoder"}static get defaultConfig(){return{encoder:{}}}encode(e){var t;return e=Object.assign({},null==(t=this.encoder)?void 0:t.requestData,e),StringHelper.safeJsonStringify(e)}decode(e){return StringHelper.safeJsonParse(e)}},CrudManagerView_default=e=>{var t;return t=class extends(e.mixin(LoadMaskable_default)){static get $name(){return"CrudManagerView"}afterConstruct(){super.afterConstruct();const{crudManager:e,project:t}=this;this.loadMask&&(e||t).isCrudManagerLoading&&this.onCrudManagerLoadStart()}applySyncMask(){const{syncMask:e}=this;e&&(this.masked=Mask.mergeConfigs(this.loadMaskDefaults,e))}bindCrudManager(e){this.detachListeners("crudManager"),null==e||e.ion({name:"crudManager",loadStart:"onCrudManagerLoadStart",beforeSend:"onCrudManagerBeforeSend",load:"onCrudManagerLoad",loadCanceled:"onCrudManagerLoadCanceled",syncStart:"onCrudManagerSyncStart",beforeSyncApply:"onCrudManagerBeforeSyncApply",sync:"onCrudManagerSync",syncCanceled:"onCrudManagerSyncCanceled",requestFail:"onCrudManagerRequestFail",responseReceived:"onAjaxTransportResponseReceived",thisObj:this})}onCrudManagerBeforeSend({params:e}){var t;null==(t=this.applyStartEndParameters)||t.call(this,e)}onCrudManagerLoadStart(){var e;this.applyLoadMask(),null==(e=this.toggleEmptyText)||e.call(this)}onCrudManagerSyncStart(){this.applySyncMask()}onCrudManagerBeforeSyncApply(){var e;null==(e=this.suspendRefresh)||e.call(this)}onCrudManagerRequestFinalize(e=!0,t,r){var n;const i=this;e?null==(n=i.toggleEmptyText)||n.call(i):(i.masked||i.applyLoadMask(),i.applyMaskError('<div class="b-grid-load-failure"><div class="b-grid-load-fail">'+i.L("L{GridBase."+t+"FailedMessage}")+"</div>\n</div>"))}onCrudManagerLoadCanceled(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSyncCanceled(){this.onCrudManagerRequestFinalize(!0,"sync")}onCrudManagerLoad(){this.onCrudManagerRequestFinalize(!0,"load")}onCrudManagerSync(){var e;this.onCrudManagerRequestFinalize(!0,"sync"),null==(e=this.resumeRefresh)||e.call(this,!0)}onCrudManagerRequestFail({requestType:e,response:t}){this.onCrudManagerRequestFinalize(!1,e,t)}onAjaxTransportResponseReceived(){const e=this;null!=e.clearMaskDelay?e.setTimeout((()=>e.masked=null),e.clearMaskDelay):e.masked=null}get widgetClass(){}},__publicField(t,"config",{clearMaskDelay:null,testConfig:{clearMaskDelay:0}}),t},PartOfProject_default=e=>class extends(e||Base){static get $name(){return"PartOfProject"}},AssignmentModelMixin_default=e=>class extends e{static get $name(){return"AssignmentModelMixin"}static get fields(){return["resourceId","eventId",{name:"drawDependencies",type:"boolean"},"event","resource"]}construct(e,...t){e=e||{};const{fieldMap:r}=this,n=r.eventId.dataSource,i=r.resourceId.dataSource,s=r.event.dataSource,a=r.resource.dataSource,o=e[n],l=e[i],c=e[s],d=e[a];null!=o?e[s]=o:null!=c&&(e[n]=c.isModel?c.id:c),null!=l?e[a]=l:null!=d&&(e[i]=d.isModel?d.id:d),super.construct(e,...t)}get eventResourceKey(){return this.buildEventResourceKey(this.event,this.resource)}buildEventResourceKey(e,t){let r,n;return r=e?e.isModel?e.id:e:this.internalId,n=t?t.isModel?t.id:t:this.internalId,r+"-"+n}buildIndexKey({event:e,resource:t}){return this.buildEventResourceKey(e,t)}set(e,t,...r){var n,i;const s=this.fieldToKeys(e,t);return"resource"in s?void 0!==(null==(n=s.resource)?void 0:n.id)&&(s.resourceId=s.resource.id):"resourceId"in s&&this.constructor.isProAssignmentModel&&(s.resource=s.resourceId),"event"in s?void 0!==(null==(i=s.event)?void 0:i.id)&&(s.eventId=s.event.id):"eventId"in s&&this.constructor.isProAssignmentModel&&(s.event=s.eventId),super.set(s,null,...r)}afterChange(e,t,r,n,i){var s,a;const o=this;return!o.constructor.isProAssignmentModel&&(null==t?void 0:t.resourceId)&&(null==(s=o.resource)?void 0:s.id)!==t.resourceId.value?o.resource=t.resourceId.value:o.constructor.isProAssignmentModel&&(null==(a=o.project)?void 0:a.propagatingSyncChanges)&&(null==t?void 0:t.eventId)&&!(null==t?void 0:t.event)&&(e.event.value===t.eventId.value||e.event.value.id===t.eventId.value)&&(delete t.eventId,delete o.meta.modified.eventId),super.afterChange(...arguments)}set resourceId(e){const{resource:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("resourceId",e):this.resource=e}get resourceId(){var e;return this.get("resourceId")||(null==(e=this.resource)?void 0:e.id)}set eventId(e){const{event:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("eventId",e):this.event=e}get eventId(){var e;return this.get("eventId")||(null==(e=this.event)?void 0:e.id)}get eventName(){var e;return null==(e=this.event)?void 0:e.name}get resourceName(){var e;return null==(e=this.resource)?void 0:e.name}getResource(){return this.resource}get isAssignment(){return!0}get isPersistable(){var e;const{event:t,resource:r,unjoinedStores:n,assignmentStore:i}=this,s=null==i?void 0:i.crudManager;let a;return a=i?this.isValid&&t.isPersistable&&(s||!t.hasGeneratedId&&!r.hasGeneratedId):!this.isPhantom&&Boolean(n[0]),a&&super.isPersistable&&!(null==(e=this.event)?void 0:e.isCreating)}get isValid(){return null!=this.resource&&null!=this.event}toString(){return this.resourceName?this.resourceName+" "+Math.round(this.units)+"%":""}shouldRecordFieldChange(e,t,r){var n,i;if(!super.shouldRecordFieldChange(e,t,r))return!1;if("event"===e||"eventId"===e){const e=null==(n=this.project)?void 0:n.eventStore;if(e&&e.oldIdMap[t]===e.getById(r))return!1}if("resource"===e||"resourceId"===e){const e=null==(i=this.project)?void 0:i.resourceStore;if(e&&e.oldIdMap[t]===e.getById(r))return!1}return!0}},EngineMixin=CoreAssignmentMixin,AssignmentModel=class extends(AssignmentModelMixin_default(PartOfProject_default(EngineMixin.derive(Model)))){static get $name(){return"AssignmentModel"}get resource(){return super.resource}set resource(e){super.resource=e,this.setChanged("resourceId",this.constructor.asId(e))}};AssignmentModel.exposeProperties(),AssignmentModel._$name="AssignmentModel";var PartOfBaseProject_default=e=>class extends e{static get $name(){return"PartOfBaseProject"}get assignmentStore(){return this.project.assignmentStore}get calendarManagerStore(){return this.project.calendarManagerStore}get dependencyStore(){return this.project.dependencyStore}get eventStore(){return this.project.eventStore}get resourceStore(){return this.project.resourceStore}},AssignmentStoreMixin_default=e=>class extends e{static get $name(){return"AssignmentStoreMixin"}static get defaultConfig(){return{loadPriority:300,syncPriority:300,storeId:"assignments"}}add(e,...t){var r;e=ArrayHelper.asArray(e);for(let t=0;t<e.length;t++){let n=e[t];if(n instanceof Model||(e[t]=n=this.createRecord(n)),!this.isSyncingDataOnLoad&&-1!==this.storage.findIndex("eventResourceKey",n.eventResourceKey,!0))throw new Error("Duplicate assignment Event: "+n.eventId+" to resource: "+n.resourceId);(null==(r=n.event)?void 0:r.isCreating)&&(n.isCreating=!0)}return super.add(e,...t)}includesAssignment(e,t){return-1!==this.storage.findIndex("eventResourceKey",e+"-"+t,!0)}setStoreData(e){if(this.usesSingleAssignment)throw new Error("Data loading into AssignmentStore (multi-assignment mode) cannot be combined EventStore data containing resourceId (single-assignment mode)");super.setStoreData(e)}set storage(e){super.storage=e,this.storage.addIndex({property:"eventResourceKey",dependentOn:{event:!0,resource:!0}})}get storage(){return this._storage||super.storage}get isAssignmentStore(){return!0}getOccurrence(e,t){if(!e||!(null==t?void 0:t.isOccurrence))return e;const r=this;return{id:t.id+":a"+e.id,event:t,resource:e.resource,eventId:t.id,resourceId:e.resource.id,isAssignment:!0,isOccurrenceAssignment:!0,instanceMeta(e){return r.occurrenceInstanceMeta(this,e)}}}occurrenceInstanceMeta(e,t){const r=this,n=t.id||t,{id:i}=e;let{occurrenceMeta:s}=r;return s||(s=r.occurrenceMeta={}),s[i]||(s[i]={}),s[i][n]||(s[i][n]={})}mapAssignmentsForEvent(e,t,r){e=this.eventStore.getById(e);const n=Boolean(t),i=Boolean(r);return n||i?e.assignments.reduce(((e,s)=>{const a=n?t(s):s;return i&&!r(a)||e.push(a),e}),[]):e.assignments}mapAssignmentsForResource(e,t,r){e=this.resourceStore.getById(e);const n=Boolean(t),i=Boolean(r);return n||i?e.assignments.reduce(((e,s)=>{const a=n?t(s):s;return i&&!r(a)||e.push(a),e}),[]):e.assignments}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return(e=this.resourceStore.getById(e)).assignments}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return e.resources}getEventsForResource(e){return null==(e=this.resourceStore.getById(e))?void 0:e.events}assignEventToResource(e,t,r=null,n=!1){var i,s;const a=this,o=n?new Set(e.assignments):null;if(t=ArrayHelper.asArray(t).map((e=>{var t;return null!=(t=e.$original)?t:e})),null==(i=a.eventStore)?void 0:i.usesSingleAssignment){if(null==(s=e.assignments)?void 0:s.length)return a.isEventAssignedToResource(e,t[0])||(e.resource=t[0]),[];e.resourceId=t[0].id}let l=[];return a.suspendAutoCommit(),t.forEach((t=>{var i;const s=a.getAssignmentForEventAndResource(e,t);if(s)n&&o.delete(s);else{const n={event:e,resource:t};l.push(null!=(i=null==r?void 0:r(n))?i:n)}})),l=a.add(l),n&&a.remove(Array.from(o)),a.resumeAutoCommit(),l}unassignEventFromResource(e,t){const r=this,n=[];if(!t)return r.removeAssignmentsForEvent(e);t=ArrayHelper.asArray(t);for(let i=0;i<t.length;i++)r.isEventAssignedToResource(e,t[i])&&n.push(r.getAssignmentForEventAndResource(e,t[i]));return r.remove(n)}isEventAssignedToResource(e,t){return Boolean(this.getAssignmentForEventAndResource(e,t))}getAssignmentForEventAndResource(e,t){let r;return(e=this.eventStore.getById(e))&&(r=e.assignments)&&(t=this.resourceStore.$master.getById(t))?this.getOccurrence(r.find((e=>{var r;return(null==(r=e.resource)?void 0:r.$original)===t.$original})),e):null}},EngineMixin2=PartOfProject_default(CoreAssignmentStoreMixin.derive(AjaxStore)),AssignmentStore=class extends(AssignmentStoreMixin_default(EngineMixin2)){static get defaultConfig(){return{modelClass:AssignmentModel}}};__publicField(AssignmentStore,"$name","AssignmentStore"),AssignmentStore._$name="AssignmentStore";var ResourceStoreMixin_default=e=>class extends(e||Base){static get $name(){return"ResourceStoreMixin"}get isResourceStore(){return!0}static get defaultConfig(){return{loadPriority:200,syncPriority:100,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),!this.modelClass.isResourceModel)throw new Error("Model for ResourceStore must subclass ResourceModel")}removeAll(){const e=super.removeAll(...arguments);return e&&this.assignmentStore.removeAll(),e}onRecordIdChange({record:e,oldValue:t,value:r}){super.onRecordIdChange({record:e,oldValue:t,value:r}),e.isFieldModified("id")&&(this.isChangingId=!0,e.updateAssignmentResourceIds(),this.isChangingId=!1)}get allResourceRecords(){return this._allResourceRecords||(this._allResourceRecords=this.getAllDataRecords())}getAvailableResources({startDate:e,endDate:t}){return this.query((r=>this.eventStore.isDateRangeAvailable(e,t,null,r)))}},ResourceModelMixin_default=e=>class extends e{static get $name(){return"ResourceModelMixin"}static get isResourceModel(){return!0}static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl","image",{name:"resourceMargin",type:"number"},{name:"barMargin",type:"number"},"eventLayout"]}updateAssignmentResourceIds(){this.assigned.forEach((e=>{e.resourceId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentResourceIds()}get events(){return this.assignments.reduce(((e,t)=>(t.event&&e.push(t.event),e)),[])}get assignments(){return this.assigned?[...this.assigned]:[]}set assignments(e){e.forEach((e=>{e.resource=this}))}getEvents(){return this.events}get isPersistable(){return super.isPersistable&&(!this.parent||this.parent.isPersistable)}unassignAll(){this.assignments&&this.assignmentStore.remove(this.assignments)}get initials(){const{name:e=""}=this;if(!e)return"";const t=e.split(" ");return t[0][0]+(t.length>1?t[t.length-1][0]:"")}isWorkingTime(e){var t,r;const n=this.effectiveCalendar||(null==(t=this.project)?void 0:t.calendar);return!n||(null==(r=n.isWorkingTime)?void 0:r.call(n,e))}},EngineMixin3=CoreResourceMixin,ResourceModel=class extends(ResourceModelMixin_default(PartOfProject_default(EngineMixin3.derive(GridRowModel)))){static get $name(){return"ResourceModel"}};ResourceModel.exposeProperties(),ResourceModel._$name="ResourceModel";var EngineMixin4=PartOfProject_default(CoreResourceStoreMixin.derive(AjaxStore)),ResourceStore=class extends(ResourceStoreMixin_default(EngineMixin4)){static get defaultConfig(){return{modelClass:ResourceModel}}};ResourceStore._$name="ResourceStore";var EventStoreMixin_default=e=>class extends(e||Base){static get $name(){return"EventStoreMixin"}construct(e){super.construct(e),this.autoTree=!0}set filtersFunction(e){super.filtersFunction=e}get filtersFunction(){const e=super.filtersFunction;return e&&e!==FunctionHelper.returnTrue?t=>t.isCreating||e(t):e}getEventCounts(e){const t=this,{filtersFunction:r,added:n}=t,i=t.getEvents({...e,storeFilterFn:t.isFiltered?t.reapplyFilterOnAdd?r:e=>n.includes(e)?t.indexOf(e)>-1:r(e):null,dateMap:e.dateMap||!0});return i.forEach(((e,t)=>i.set(t,e.length))),i}forEachScheduledEvent(e,t=this){this.forEach((r=>{const{startDate:n,endDate:i}=r;if(n&&i)return e.call(t,r,n,i)}))}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach((r=>{r.startDate&&(e=DateHelper.min(r.startDate,e)),r.endDate&&(t=DateHelper.max(r.endDate,t))})),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return e.isPersistable}isDateRangeAvailable(e,t,r,n){if(n.data.generatedParent)return!1;const i=new Set(this.getEventsForResource(n));if(null==r?void 0:r.isAssignment){r.event.resources.forEach((e=>{e.id!==r.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(r){const e=r.isAssignment?r.event:r;i.delete(e)}return!Array.from(i).some((r=>r.isScheduled&&DateHelper.intersectSpans(e,t,r.startDate,r.endDate)))}filterEventsForResource(e,t,r=this){return e.getEvents(this).filter(t.bind(r))}getResourcesForEvent(e){return e.isOccurrence&&(e=e.recurringTimeSpan),this.assignmentStore.getResourcesForEvent(e)}getEventsForResource(e){return this.assignmentStore.getEventsForResource(e)}getAssignmentsForEvent(e){return this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,r=!1){return this.assignmentStore.assignEventToResource(e,t,void 0,r)}unassignEventFromResource(e,t){this.assignmentStore.unassignEventFromResource(e,t)}reassignEventFromResourceToResource(e,t,r){const n=this,i=Model.asId(r),s=n.assignmentStore.getAssignmentForEventAndResource(e,t);s?s.resourceId=i:n.assignmentStore.assignEventToResource(e,r)}isEventAssignedToResource(e,t){return this.assignmentStore.isEventAssignedToResource(e,t)}removeAssignmentsForEvent(e){this.assignmentStore.removeAssignmentsForEvent(e)}removeAssignmentsForResource(e){this.assignmentStore.removeAssignmentsForResource(e)}},returnTrue2=()=>!0,notRecurring=e=>!e.isRecurring,GetEventsMixin_default=e=>{var t;return __publicField(t=class extends e{getEvents({filter:e,date:t,startDate:r,endDate:n,startOnly:i,includeOccurrences:s,allowPartial:a,onlyAssigned:o=!1,dateMap:l=!1,dayTime:c=null,getDateIndex:d}){const u=this,h=arguments[0],{lastDateRange:g,added:p,filtersFunction:m}=u,f=e;if(o&&(h.filter=f?e=>f(e)&&e.resources.length:e=>e.resources.length),"startDate"in h||(r=h.startDate=t),"includeOccurrences"in h||(s=h.includeOccurrences=!0),"allowPartial"in h||(a=h.allowPartial=!i),h.storeFilterFn=u.isFiltered&&!h.ignoreFilters?u.reapplyFilterOnAdd?m:e=>p.includes(e)?u.indexOf(e)>-1:m(e):null,!n)if(r)(n=h.endDate=DateHelper.clearTime(r)).setDate(n.getDate()+1);else{if(s)throw new Error("如果请求重复出现，则必须将getEvents传递给startDate和endDate");h.dateFilter=returnTrue2}h.dateFilter||(h.dateFilter=i?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate;return t&&!(DateHelper.clearTime(t)-r)}:a?e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&(!(t-i)?DateHelper.betweenLesserEqual(t,r,n):DateHelper.intersectSpans(t,i,r,n))}:e=>{const t=e.hasBatchedChange("startDate")?e.get("startDate"):e.startDate,i=e.hasBatchedChange("endDate")?e.get("endDate"):e.endDate||t;return t&&t>=r&&i<=n});const v={startDate:r,endDate:n};return u.processConfiguredListeners(),u.trigger("loadDateRange",{old:g||{},new:Objects.clone(v),changed:Boolean(!g||g.startDate-v.startDate||g.endDate-v.endDate)}),u.lastDateRange=Objects.clone(v),l?u.getEventsAsMap(h):u.getEventsAsArray(h)}getEventsAsArray({filter:e,date:t,resourceRecord:r,startDate:n=t,endDate:i,startOnly:s,includeOccurrences:a=!0,dayTime:o=null,dateFilter:l,storeFilterFn:c,getDateIndex:d}){const u=this,h=[];if(c?u.count:u.allCount){let e=r?u.getEventsForResource(r):null;if(!r){const t=u.useDayIndex(o),r=new Set,a=s?"startDate":"date";u.recurringEvents.forEach((e=>{t.dayTime.startOfDay(e.startDate)<=n&&r.add(e)}));for(const e=new Date(n);e<i;e.setDate(e.getDate()+1)){const n=t.get(d?d(e):a,e);null==n||n.forEach((e=>r.add(e)))}e=[...r]}c&&(e=e.filter(c));for(let t=0,{length:r}=e;t<r;t++){const r=e[t];a&&r.isRecurring?h.push.apply(h,r.getOccurrencesForDateRange(n,i).filter(l)):l(r)&&h.push(r)}}return e?h.filter(e):h}getEventsAsMap({filter:e,date:t,resourceRecord:r,startDate:n=t,endDate:i,startOnly:s,includeOccurrences:a=!0,dateMap:o,dayTime:l=null,storeFilterFn:c,getDateIndex:d}){var u;const h=this;if((null==o?void 0:o.clear)?o.clear():o=new Map,h.count){const t=h.useDayIndex(l),g=s?"startDate":"date",p=[],m=t=>(!e||e(t))&&(!c||c(t)),f=e=>notRecurring(e)&&m(e);if(l=t.dayTime,r)throw new Error("Querying for events for a resource and returning a date-keyed Map is not supported");null==(u=h.recurringEvents)||u.forEach((e=>{l.startOfDay(e.startDate)<i&&p.push(e)}));for(const e=new Date(n);e<i;e.setDate(e.getDate()+1)){let[r,n]=t.get(d?d(e):g,e,!0);(null==r?void 0:r.size)&&(r=[...r].filter(f),r.length&&(o.get(n)||o.set(n,[]).get(n)).push(...r))}for(let e=0,{length:t}=p;e<t;e++){const t=p[e],r=(a?t.getOccurrencesForDateRange(n,i):[t]).filter(m),c=DateHelper.add(i,1,"day");for(let e,t=0,{length:n}=r;t<n;t++){const n=r[t],i=l.startOfDay(n.startDate),a="startDate"!==(d?d(i):s?"startDate":"date")&&n.durationMS?DateHelper.min(n.endDate||DateHelper.add(n.startDate,n.duration,n.durationUnit),c):DateHelper.add(i,1,"day");for(;i<a;i.setDate(i.getDate()+1)){const t=l.dateKey(i);(e=o.get(t))||o.set(t,e=[]),e.push(n)}}}}return o}},"$name","GetEventsMixin"),t},indexNameMap={date:"_dateIndex",startDate:"_startDateIndex"},indexProps=Object.values(indexNameMap),emptyArray10=Object.freeze([]),{MILLIS_PER_DAY:MILLIS_PER_DAY2}=DayTime,EventDayIndex=class{constructor(e,t){this.dayTime=t||DayTime.MIDNIGHT,this.store=e,this.users=[this.dayTime]}add(e,t,r){const n=this[indexNameMap[e]],i=this.dayTime.dateKey(t);(n[i]||(n[i]=new Set)).add(r)}addEvent(e){var t,r,n;let i,s=null==(t=this.dayTime.startOfDay(e.startDate))?void 0:t.getTime();if(s){i=null!=(n=null==(r=e.endDate)?void 0:r.getTime())?n:s,this.add("startDate",s,e);do{this.add("date",s,e),s+=MILLIS_PER_DAY2}while(s<i)}}clear(){indexProps.forEach((e=>this[e]=Object.create(null)))}get(e,t,r){!this.initialized&&this.initialize();let n,i=this[indexNameMap[e]];return t&&(n=this.dayTime.dateKey(t),i=r?[i[n],n]:i[n]),i}initialize(){this.initialized=!0,this.clear(),this.sync("splice",this.store.storage.allValues)}invalidate(){this.initialized=!1,indexProps.forEach((e=>this[e]=null))}matches(e){return this.dayTime.startShift===e.startShift}remove(e,t,r){const n=this[indexNameMap[e]][this.dayTime.dateKey(t)];n&&n.delete(r)}removeEvent(e,t,r){var n,i;let s,a=null==(n=this.dayTime.startOfDay(t))?void 0:n.getTime();if(a){s=null!=(i=null==r?void 0:r.getTime())?i:a,this.remove("startDate",a,e);do{this.remove("date",a,e),a+=MILLIS_PER_DAY2}while(a<s)}}sync(e,t,r,n,i){var s,a;r=r||emptyArray10;const o=this,l=(t=t||emptyArray10).length,c=r.length,d=null==n?void 0:n.length;let u,h,g;if(o.initialized)switch(e){case"clear":o.clear();break;case"splice":if(d)for(t=t.slice(),r=r.slice(),u=0;u<d;u++)r.push(n[u][0]),t.push(n[u][1]);if(c)for(u=0;u<c;u++)g=r[u],o.removeEvent(g,g.startDate,g.endDate);if(l)for(u=0;u<l;u++)h=t[u],h.isScheduled&&!h.isParent&&o.addEvent(h);break;case"reschedule":g=t[0],o.removeEvent(g,(null==(s=i.startDate)?void 0:s.oldValue)||g.startDate,(null==(a=i.endDate)?void 0:a.oldValue)||g.endDate),o.sync("splice",t)}}register(e){this.users.push(e)}unregister(e){const{users:t}=this,r=t.indexOf(e);return r>-1&&t.splice(r,1),!t.length}},proto3=EventDayIndex.prototype;indexProps.forEach((e=>proto3[e]=null)),proto3.initialized=!1,EventDayIndex._$name="EventDayIndex";var{MIDNIGHT:MIDNIGHT}=DayTime,DayIndexMixin_default=e=>{var t;return __publicField(t=class extends e{construct(e){super.construct(e),this.dayIndices=null}afterLoadData(){var e;this.syncIndices("splice",this.storage.allValues),null==(e=super.afterLoadData)||e.call(this)}onDataChange({action:e,added:t,removed:r,replaced:n}){this.syncIndices(e,t,r,n),super.onDataChange(...arguments)}onDataReplaced(e,t){this.syncIndices("clear"),this.syncIndices("splice",this.storage.values),super.onDataReplaced(e,t)}onModelChange(e,t,r,n,i){("startDate"in r||"endDate"in r)&&this.syncIndices("reschedule",[e],null,null,r),super.onModelChange(...arguments)}invalidateDayIndices(){var e;null==(e=this.dayIndices)||e.forEach((e=>e.invalidate()))}registerDayIndex(e){const t=this,r=t.dayIndices||(t.dayIndices=[]);let n,i;for(i=0;!n&&i<r.length;++i)r[i].matches(e)&&(n=r[i]).register(e);return!n&&r.push(n=new EventDayIndex(t,e)),n}syncIndices(...e){var t;null==(t=this.dayIndices)||t.forEach((t=>t.sync(...e)))}unregisterDayIndex(e){const{dayIndices:t}=this;for(let r=null==t?void 0:t.length;r-- >0;)if(t[r].matches(e)){t[r].unregister(e)&&t.splice(r,1);break}}useDayIndex(e){const t=this,{dayIndices:r}=t;e=e||MIDNIGHT;for(let t=0;r&&t<r.length;++t)if(r[t].matches(e))return r[t];if(e.startShift)throw new Error("No day index registered for "+e+" on "+t.id);return t.registerDayIndex(MIDNIGHT)}},"$name","DayIndexMixin"),t},SharedEventStoreMixin_default=e=>class extends e{static get $name(){return"SharedEventStoreMixin"}static get defaultConfig(){return{loadPriority:100,syncPriority:200,storeId:"events",removeUnassignedEvent:!0,singleAssignment:null}}construct(e){if(super.construct(e,!0),this.singleAssignment&&(this.usesSingleAssignment=!0),!this.modelClass.isEventModel)throw new Error("The model for the EventStore must subclass EventModel")}append(e){return this.add(e)}get project(){return super.project}set project(e){var t;super.project=e,this.detachListeners("project"),e&&((null==(t=e.assignmentStore)?void 0:t.isAssignmentStore)&&this.attachToAssignmentStore(e.assignmentStore),e.ion({name:"project",assignmentStoreChange:"onProjectAssignmentStoreChange",thisObj:this,prio:200}))}get usesSingleAssignment(){return this.isChained?this.masterStore.usesSingleAssignment:this._usesSingleAssignment}set usesSingleAssignment(e){this._usesSingleAssignment=e}processRecords(e){var t;const{assignmentStore:r}=this,n=[];return r&&(r.skipInvalidateIndices=!0),e=super.processRecords(e,r&&!(null==(t=this.stm)?void 0:t.isRestoring)&&(e=>{const t=e.get("resourceId");e.reassignedFromReplace||null==t||r.includesAssignment(e.id,t)||n.push({id:r.modelClass.generateId(""),resourceId:t,eventId:e.id}),e.reassignedFromReplace=!1})||void 0),r&&(r.storage.invalidateIndices(),r.skipInvalidateIndices=!1,r.add(n)),e}joinRecordsToStore(e){const{assignmentStore:t}=this;t?(t.skipInvalidateIndices=!0,super.joinRecordsToStore(e),t.storage.invalidateIndices(),t.skipInvalidateIndices=!1):super.joinRecordsToStore(e)}processRecord(e,t=!1){const r=(e=super.processRecord(e,t)).get("resourceId");if(null!=r&&!e.meta.skipEnforcingSingleAssignment){const n=this,{assignmentStore:i}=n,s=n.getById(e.id);if(s&&s!==e&&!t){const t=i.find((t=>t.eventId===e.id));t&&(t.resource=r,e.reassignedFromReplace=!0)}else n.$processResourceIds=!0;n.usesSingleAssignment=!0}return e}processResourceIds(){var e,t,r;const n=this,i=null!=(t=n.assignmentStore)?t:null==(e=n.crudManager)?void 0:e.assignmentStore;if(n.$processResourceIds&&(null==i?void 0:i.isAssignmentStore)&&(!(null==(r=n.project)?void 0:r.isSharingAssignmentStore)||!n.isChained)){const e=[];n.forEach((t=>{const{resourceId:r,id:n}=t;null!=r&&e.push({id:i.modelClass.generateId(""),resourceId:r,eventId:n})})),i.useRawData={disableDefaultValue:!0,disableDuplicateIdCheck:!0,disableTypeConversion:!0},i.usesSingleAssignment=!1,i.verifyNoGeneratedIds=!1,i.data=e,i.usesSingleAssignment=!0,n.$processResourceIds=!1}}loadData(){super.loadData(...arguments),this.processResourceIds()}onBeforeRemoveAssignment({records:e}){var t;const r=this;if(r.removeUnassignedEvent&&!r.isRemoving&&!r.isSettingData&&!(null==(t=r.stm)?void 0:t.isRestoring)&&!r.usesSingleAssignment&&!r.assignmentStore.isSyncingDataOnLoad&&!r.resourceStore.isSyncingDataOnLoad){const t=new Set;e.forEach((r=>{const{event:n}=r;n&&!n.isRemoved&&n.assignments.every((t=>e.includes(t)))&&t.add(n)})),t.size&&r.remove([...t])}}onProjectAssignmentStoreChange({store:e}){this.attachToAssignmentStore(e)}attachToAssignmentStore(e){const t=this;t.detachListeners("assignmentStore"),e&&(t.processResourceIds(),e.ion({name:"assignmentStore",addPreCommit({records:e}){!t.usesSingleAssignment||t.isSettingData||t.isAssigning||e.forEach((e=>{const{event:t}=e;(null==t?void 0:t.isEvent)&&t.resourceId!==e.resourceId&&(t.meta.isAssigning=!0,t.set("resourceId",e.resourceId),t.meta.isAssigning=!1)}))},beforeRemove:"onBeforeRemoveAssignment",removePreCommit({records:e}){t.usesSingleAssignment&&e.forEach((e=>{var r;null==(r=t.getById(e.eventId))||r.set("resourceId",null)}))},removeAllPreCommit(){t.usesSingleAssignment&&!t.isSettingData&&t.allRecords.forEach((e=>e.set("resourceId",null)))},update({record:e,changes:r}){if(t.usesSingleAssignment&&"resourceId"in r){const{event:t}=e;t.meta.isAssigning=!0,t.set("resourceId",r.resourceId.value),t.meta.isAssigning=!1}},thisObj:t}))}set data(e){this.isSettingData=!0,!this.usesSingleAssignment||this.syncDataOnLoad||this.isChained||this.assignmentStore.removeAll(!0),super.data=e,this.isSettingData=!1}trigger(e,t){const{changes:r}=t||{};return r&&"resourceId"in r&&1===Object.keys(r).length&&(t.isAssign=!0),super.trigger(...arguments)}remove(e,...t){var r,n;const i=super.remove(e,...t);if(i.length&&this.usesSingleAssignment)for(const e of i)e.isOccurrence||null==(n=this.assignmentStore||(null==(r=this.crudManager)?void 0:r.assignmentStore))||n.remove(e.assignments,!0);return i}},emptyArray11=Object.freeze([]),RecurringTimeSpansMixin_default=e=>class extends(e||Base){static get $name(){return"RecurringTimeSpansMixin"}construct(...e){this.globalOccurrences=new Map,this.recurringEvents=new Set,super.construct(...e)}afterLoadData(){this.globalOccurrences.clear(),this.refreshRecurringEventsCache("clear"),this.refreshRecurringEventsCache("splice",this.storage.allValues),super.afterLoadData&&super.afterLoadData()}onDataChange({action:e,added:t,removed:r,replaced:n}){this.refreshRecurringEventsCache(e,t,r,n),super.onDataChange(...arguments)}refreshRecurringEventsCache(e,t=emptyArray11,r=emptyArray11,n){const{recurringEvents:i}=this,s=null==n?void 0:n.length;switch(e){case"clear":i.clear();break;case"splice":{if(s){t=t.slice(),r=r.slice();for(let e=0;e<s;e++)r.push(n[e][0]),t.push(n[e][1])}const e=t.length,a=r.length;if(a&&i.size)for(let e=0;e<a;e++)i.delete(r[e]);if(e)for(let r=0;r<e;r++){const e=t[r];e.isRecurring&&i.add(e)}break}}}getById(e){let t=super.getById(e);return t||(t=this.globalOccurrences.get(this.modelClass.asId(e))),t}onModelChange(e,t,r,n,i){const s=!n&&this.isRecurrenceRelatedFieldChange(e,r);if(s&&e.removeOccurrences(),super.onModelChange(...arguments),s){const e={action:"batch",records:this.storage.values};this.trigger("refresh",e),this.trigger("change",e)}}isRecurrenceRelatedFieldChange(e,t){return e.isRecurring||"recurrenceRule"in t}getOccurrencesForTimeSpan(e,t,r){const n=[];return e.isRecurring&&e.recurrence.forEachOccurrence(t,r,(e=>n.push(e))),n}set data(e){this.globalOccurrences.clear(),super.data=e}getRecurringTimeSpans(){return[...this.recurringEvents]}},RecurringEventsMixin_default=e=>class extends(RecurringTimeSpansMixin_default(e||Base)){static get $name(){return"RecurringEventsMixin"}getRecurringEvents(){return this.getRecurringTimeSpans()}isEventPersistable(e){return super.isEventPersistable(e)&&(!e.supportsRecurring||!e.isOccurrence)}},dateFieldsToConvert={startDate:1,endDate:1,constraintDate:1,deadlineDate:1},TimeZonedDatesMixin_default=e=>{var t;return __publicField(t=class extends(e||TimeSpan){get timeZone(){return this.getData("timeZone")}set timeZone(e){this.setData("timeZone",e)}setLocalDate(e,t){this.set(e,this.timeZone?TimeZoneHelper.toTimeZone(t,this.timeZone):t,!0),this.data[e]=this[e]}getLocalDate(e){return this.timeZone&&this[e]?TimeZoneHelper.fromTimeZone(this[e],this.timeZone):this[e]}applyChangeset(e){const{timeZone:t}=this;if(null!=t)for(const t in dateFieldsToConvert)e[t]&&(this.setLocalDate(t,new Date(e[t])),delete e[t]);return super.applyChangeset(...arguments)}getFieldPersistentValue(e){var t,r;if(this.timeZone){const n=null!=(r=null!=(t=null==e?void 0:e.field)?t:null==e?void 0:e.name)?r:e;if(dateFieldsToConvert[n])return this.getLocalDate(n)}return super.getFieldPersistentValue(e)}convertToTimeZone(e){const t=this,r={...t.meta.modified},n={...dateFieldsToConvert};t.isTask&&!t.manuallyScheduled&&(delete n.startDate,delete n.endDate);for(const e in n)null!=t[e]?(n[e]=t[e],t.timeZone&&(n[e]=t.getLocalDate(e),r[e]&&(r[e]=TimeZoneHelper.fromTimeZone(r[e],t.timeZone)))):delete n[e];t.timeZone=e;for(const e in n)t.setLocalDate(e,n[e],!1),n[e]=1,t.timeZone&&r[e]&&(r[e]=TimeZoneHelper.toTimeZone(r[e],t.timeZone));t.clearChanges(!0,!0,n),ObjectHelper.isEmpty(r)||(t.meta.modified=r,t.stores.forEach((e=>e.modified.add(t))))}},"$name","TimeZonedDatesMixin"),__publicField(t,"fields",[{name:"timeZone",persist:!1}]),t},TimeSpan=class extends(Model.mixin(TimeZonedDatesMixin_default)){static get $name(){return"TimeSpan"}static get fields(){return[{name:"startDate",type:"date"},{name:"endDate",type:"date"},{name:"duration",type:"number",allowNull:!0,internal:!0},{type:"durationunit",name:"durationUnit",defaultValue:"d",internal:!0},{name:"fullDuration",persist:!1,column:{type:"duration"}},{name:"cls",defaultValue:"",internal:!0},{name:"iconCls",internal:!0},{name:"style",type:"object",internal:!0},{name:"name",type:"string",defaultValue:""}]}construct(e,...t){if(null==e?void 0:e.fullDuration){const{magnitude:t,unit:r}=e.fullDuration;e.duration=t,e.unit=r,delete e.fullDuration}super.construct(e,...t),this.normalize()}get eventStore(){var e;const t=this;return t.isOccurrence?t.recurringTimeSpan.eventStore:(t._eventStore||(t._eventStore=null==(e=t.stores)?void 0:e.find((e=>e.isEventStore))),t._eventStore)}normalize(){const e=this,{startDate:t,endDate:r,duration:n,durationUnit:i}=e,s=null!=n;t&&r&&!s?e.setData("duration",DateHelper.diff(t,r,i,!0)):t&&!r&&s?e.setData("endDate",DateHelper.add(t,n,i)):!t&&r&&s&&e.setData("startDate",DateHelper.add(r,-n,i))}updateInternalCls(e){this._cls?this._cls.value=e:this._cls=new DomClassList(e)}set internalCls(e){this.updateInternalCls(e),this.set("cls",this._cls.value)}get internalCls(){const{cls:e}=this;return(null==e?void 0:e.isDomClassList)?e:(this.internalCls=e,this._cls)}get cls(){return this._cls||(this._cls=new DomClassList(super.get("cls"))),this._cls}set cls(e){this.internalCls=e}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get endingDate(){const e=this,{endDate:t,startDate:r}=e;return t||DateHelper.add(r,e.duration,e.durationUnit)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){e=parseFloat(e),this.set({duration:e,durationUnit:t,...this.updateDatesFromDuration(e,t)})}updateDatesFromDuration(e,t,r=this.startDate,n=this.endDate){const i={};return r?i.endDate=DateHelper.add(r,e,t):n&&(i.startDate=DateHelper.add(n,-e,t)),i}getDurationInUnit(e,t){const r=this;return r.startDate&&r.endDate?DateHelper.getDurationInUnit(r.startDate,r.endDate,e,t):DateHelper.as(e,r.duration,r.durationUnit)}get fullDuration(){return new Duration({unit:this.durationUnit,magnitude:this.duration})}set fullDuration(e){"string"==typeof e&&(e=DateHelper.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const r=this,n={startDate:e};if(e){let i;if(t)i=null!=r.duration;else if(r.endDate){if(n.duration=DateHelper.diff(e,r.endDate,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.endDate=DateHelper.add(e,r.getDurationInUnit("h"),"h"))}else n.duration=null;r.set(n)}setEndDate(e,t=!1){const r=this,n={endDate:e};if(e){let i;if(!0===t)i=null!=r.duration;else if(r.startDate){if(n.duration=DateHelper.diff(r.startDate,e,r.durationUnit,!0),n.duration<0)throw new Error("Negative duration")}else i=null!=this.duration;i&&(n.startDate=DateHelper.add(e,-r.duration,r.durationUnit))}r.set(n)}setStartEndDate(e,t,r){this.set({startDate:e,endDate:t},null,r)}get dates(){const e=[],t=DateHelper.startOf(this.startDate,"day"),r=this.endDate;for(let n=t;n<r;n=DateHelper.add(n,1,"day"))e.push(n);return e}get startDateMS(){var e;return null==(e=this.batching&&this.hasBatchedChange("startDate")?this.get("startDate"):this.startDate)?void 0:e.getTime()}get endDateMS(){var e;return null==(e=this.batching&&this.hasBatchedChange("endDate")?this.get("endDate"):this.endDate)?void 0:e.getTime()}get durationMS(){const{endDateMS:e,startDateMS:t}=this;return e&&t?e-t:DateHelper.asMilliseconds(this.duration||0,this.durationUnit)}get isMilestone(){return this.isMst}inSetNormalize(e){if("string"!=typeof e){let{startDate:t,endDate:r,duration:n,durationUnit:i=this.durationUnit}=e;"string"==typeof t&&(t=this.getFieldDefinition("startDate").convert(t)),"string"==typeof r&&(r=this.getFieldDefinition("endDate").convert(r)),"duration"in e?(t&&!r&&(r=DateHelper.add(t,n,i,!0,!0)),!t&&r&&(t=DateHelper.add(r,-n,i,!0,!0))):t&&r&&(n=DateHelper.as(i,DateHelper.diff(t,r,"h",!0),"h"));const s=Object.isFrozen(e)?ObjectHelper.clone(e):e;return t&&(s.startDate=t),r&&(s.endDate=r),null!=n&&(s.duration=n),s}}fieldToKeys(e,t){var r,n;const i=super.fieldToKeys(e,t);if(i.fullDuration){const{magnitude:e,unit:t}=i.fullDuration;i.duration=e,i.durationUnit=t}return this.isEventModel||this.isTaskModel||!("duration"in i)&&!i.durationUnit||i.startDate&&i.endDate||Object.assign(i,this.updateDatesFromDuration(null!=(r=i.duration)?r:this.duration,null!=(n=i.durationUnit)?n:this.durationUnit,i.startDate,i.endDate)),i}inSet(e,t,r,n,i,s){return i||(e=this.inSetNormalize(e)||e),super.inSet(e,t,r,n,i,s)}applyValue(e,t,r,n,i){"cls"===t&&this.updateInternalCls(r),"fullDuration"===t&&(this[t]=r),super.applyValue(e,t,r,n,i)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){const{startDateMS:e,endDateMS:t}=this;return t-e>=0}get isValid(){const{startDate:e,endDate:t}=this;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const r=e;e=t,t=r}return this.setStartDate(DateHelper.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this._wbsCode||this.indexPath.join(".")}set wbsCode(e){this._wbsCode=e}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){const r=this.startDate,n=this.endDate;return r&&n&&DateHelper.intersectSpans(r,n,e,t)}split(e=.5){const t=this,r=t.copy(),{fullDuration:n,eventStore:i,assignmentStore:s}=t,a=new Duration(n),o=new Duration(n);let l,c;return"string"==typeof e?(l=new Duration(e),l.unit===a.unit?o.magnitude-=l.magnitude:(o.magnitude=DateHelper.as(l.unit,a)-l.magnitude,o.unit=l.unit,c=!0)):(l=new Duration(e>1?e:t.duration*e,t.durationUnit),o.magnitude-=l.magnitude),r.startDate=DateHelper.add(t.startDate,l.magnitude,l.unit),c?(r.fullDuration=o,t.fullDuration=l):(r.duration=o.magnitude,t.duration=l.magnitude),i&&(i.add(r),s&&!i.usesSingleAssignment&&s.add(t.assignments.map((e=>{const t=Object.assign({},e.data,{eventId:r.id,event:null,resource:null});return delete t.id,t})))),r}toICSString(e={}){if(!this.isScheduled)return"";const{startDate:t,endDate:r}=this,n=e.DTSTAMP||DateHelper.format(new Date,"uu");delete e.DTSTAMP;let i={};i=this.allDay?{"DTSTART;VALUE=DATE":DateHelper.format(t,"u"),"DTEND;VALUE=DATE":DateHelper.format(r,"u")}:{DTSTART:DateHelper.format(t,"uu"),DTEND:DateHelper.format(r,"uu")};const s={BEGIN:"VCALENDAR",VERSION:"2.0",CALSCALE:"GREGORIAN",PRODID:"-//Gantt AB//Gantt Scheduler "+(VersionHelper.scheduler&&VersionHelper.getVersion("scheduler")||VersionHelper.calendar&&VersionHelper.getVersion("calendar")||"")+" //EN",END:"VCALENDAR"},a={BEGIN:"VEVENT",UID:this.id+"",CLASS:"PUBLIC",SUMMARY:this.name,DTSTAMP:n,...i,...this.recurrenceRule?{RRULE:this.recurrenceRule}:{},...e,END:"VEVENT"},o=Object.keys(s).map((e=>e+":"+s[e])),l=Object.keys(a).map((e=>e+":"+a[e]));return o.splice(o.length-1,0,...l),o.join("\n")}exportToICS(e){if(this.isScheduled){const t=new Blob([this.toICSString(e)],{type:"text/calendar"});BrowserHelper.downloadBlob(t,(this.name||"Event")+".ics")}}isEditable(e){return!!this.getFieldDefinition(e)||void 0}isFieldModified(e){return"fullDuration"===e?super.isFieldModified("duration")||super.isFieldModified("durationUnit"):super.isFieldModified(e)}};TimeSpan._$name="TimeSpan";var dayParseRegExp=/^([+-]?[0-9])?(SU|MO|TU|WE|TH|FR|SA)$/,days=["SU","MO","TU","WE","TH","FR","SA"],RecurrenceDayRuleEncoder=class extends Base{static decodeDay(e){let t,r;return(t=dayParseRegExp.exec(e))&&(r=[days.indexOf(t[2])],t[1]&&(t[1]=parseInt(t[1],10),r.push(t[1]))),r}static encodeDay(e){let t;return Array.isArray(e)&&([e,t]=e),(t?t.toString():"")+days[e]}static decode(e){const t=[];let r;if(e)for(let n=0;n<e.length;n++)(r=this.decodeDay(e[n]))&&t.push(r);return t}static encode(e){const t=[];let r;if(e)for(let n=0;n<e.length;n++)(r=this.encodeDay(e[n]))&&t.push(r);return t}};RecurrenceDayRuleEncoder._$name="RecurrenceDayRuleEncoder";var lastOccurrenceDate,frequencyToUnitRe=/ly$/i,frequencyToUnit=e=>{const t=e.replace(frequencyToUnitRe,"");return"DAI"===t?"DAY":t},fn=(e,t,r,n)=>n.buildOccurrence(e,r),captureLastOccurrence=e=>lastOccurrenceDate=e,AbstractRecurrenceIterator=class extends Base{static processIterationConfig(e){const{recurrence:t}=e,{frequency:r,interval:n,timeSpan:i,endDate:s,count:a}=t;if(!e.syncingStartDate&&!i.meta.isSyncedWithRule){const s=DateHelper.add(i.startDate,n,frequencyToUnit(r)),a=DateHelper.min(s,e.endDate||s);this.forEachDate({syncingStartDate:!0,startDate:i.startDate,endDate:a,recurrence:t,fn:fn})}const o=i.startDate;let{startDate:l=o,endDate:c=s}=e;l<o&&(l=o),s?(!c||c>s)&&(c=s):a&&l>o&&(this.forEachDate({recurrence:t,fn:captureLastOccurrence}),(!c||c>lastOccurrenceDate)&&(c=new Date(lastOccurrenceDate.getTime()+1)));const d=l;return e.startOnly||(l=new Date(DateHelper.max(DateHelper.add(l,-n,frequencyToUnit(r)),o))),Object.assign({extraArgs:[],startOnly:!Boolean(i.durationMS)},e,{startDate:l,endDate:c,timeSpan:i,timeSpanStart:o,earliestVisibleDate:d,endDateMS:null==c?void 0:c.getTime(),timeSpanStartMS:o.getTime(),earliestVisibleDateMS:d.getTime(),durationMS:i.durationMS,spansStart:l<=o&&c>o})}static getOccurrenceIndex(e){if(e.isOccurrence)return DateHelper.diff(e.recurringTimeSpan.startDate,e.startDate,frequencyToUnit(e.recurringTimeSpan.recurrence.frequency))}static getNthDayInPeriod(e,t,r,n){let i,s,a;if(n){n>0?(s=1,a=e):(s=-1,a=t);const o=r-a.getDay();s*o<0&&(n+=s),i=new Date(a),i.setDate(a.getDate()+7*(n-s)+o),(i<e||i>t)&&(i=null)}return i}static buildDate(e,t,r){const n=new Date(e,t,r);if(n.getFullYear()===e&&n.getMonth()===t&&n.getDate()===r)return n}static isValidPosition(e){return Boolean(e)}static forEachDateAtPositions(e,t,r,n){const i=e.length,s={};for(let a=0;a<t.length;a++){const o=t[a];if(this.isValidPosition(o)){const t=o>0?e[o-1]:e[i+o];if(t&&!s[t.getTime()]&&(s[t.getTime()]=!0,!1===r.call(n,t)))return!1}}}static isInView(e,t,r,n,i){return(e?t>=r:t.valueOf()+n>r)&&!i.hasException(t)}static isInViewMS(e,t,r,n,i,s){return(e?r>=n:r+i>n)&&!s.hasException(t)}};__publicField(AbstractRecurrenceIterator,"frequency","NONE"),__publicField(AbstractRecurrenceIterator,"MAX_OCCURRENCES_COUNT",1e6),AbstractRecurrenceIterator._$name="AbstractRecurrenceIterator";var DailyRecurrenceIterator=class extends AbstractRecurrenceIterator{static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,endDateMS:i,timeSpan:s,timeSpanStart:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:p}=d,m=r-a,f=864e5*p,v=Math.floor(m/f);let{count:y}=d,b=0,C=DateHelper.add(a,v*p,"day"),D=C.getTime();for(n||y||(y=this.MAX_OCCURRENCES_COUNT);!i||D<i;){if(b++,this.isInViewMS(t,C,D,o,l,s)&&(i&&D>i||!1===u.apply(g,[C,b,1===b&&c,s,...h])||y&&b>=y))break;C=DateHelper.add(C,p,"day"),D=C.getTime()}}};__publicField(DailyRecurrenceIterator,"frequency","DAILY"),DailyRecurrenceIterator._$name="DailyRecurrenceIterator";var WeeklyRecurrenceIterator=class extends AbstractRecurrenceIterator{static forEachDate(e){const{startOnly:t,startDate:r,endDateMS:n,timeSpan:i,timeSpanStart:s,timeSpanStartMS:a,earliestVisibleDateMS:o,durationMS:l,spansStart:c,recurrence:d,fn:u,extraArgs:h,scope:g=this}=this.processIterationConfig(e),{interval:p,days:m}=d,{weekStartDay:f}=DateHelper,v=s.getHours(),y=s.getMinutes(),b=s.getSeconds(),C=s.getMilliseconds();let D,S,E=0,{count:w}=d,R=RecurrenceDayRuleEncoder.decode(m);if((null==R?void 0:R.length)||(R=[[s.getDay()]]),f>0)for(let e=0;e<R.length;e++)f>R[e][0]?R[e][0]=7-f-R[e][0]:R[e][0]-=f;for(R.sort(((e,t)=>e[0]-t[0])),D=DateHelper.getNext(w||p>1?s:r,"week",0),n||w||(w=this.MAX_OCCURRENCES_COUNT);!n||D.getTime()<n;){for(let e=0;e<R.length;e++){S=new Date(D.getFullYear(),D.getMonth(),D.getDate()+R[e][0],v,y,b,C);const r=S.getTime();if(r>=a){if(E++,this.isInViewMS(t,S,r,o,l,i)&&(n&&r>=n||!1===u.apply(g,[S,E,1===E&&c,i,...h])||w&&E>=w))return}}D=DateHelper.getNext(D,"week",p)}}};__publicField(WeeklyRecurrenceIterator,"frequency","WEEKLY"),WeeklyRecurrenceIterator._$name="WeeklyRecurrenceIterator";var MonthlyRecurrenceIterator=class extends AbstractRecurrenceIterator{static getNthDayOfMonth(e,t){const r=DateHelper.daysInMonth(e);let n=null;return t&&Math.abs(t)<=r&&(n=new Date(e.getFullYear(),e.getMonth(),t<0?r+t+1:t)),n}static isValidPosition(e){return e&&Math.abs(e)>0&&Math.abs(e)<=31}static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:p,count:m,positions:f}=c,v=RecurrenceDayRuleEncoder.decode(p),y=f&&f.length,b={};let C,D,S,E,w,R,{monthDays:x}=c,T=0;for(D=DateHelper.startOf(m||g>1?s:r,"month"),S=new Date(DateHelper.getNext(D,"month",1)-1),x&&x.length||v&&v.length||(x=[s.getDate()]),v&&v.length&&v.forEach((e=>{e[1]&&(C=C||{},C[e[0]]=e[1])}));(!n||n>D)&&(!m||T<m);){if(E=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let r=1,n=53;for(e[1]&&(r=n=e[1]),R=r;R<=n;R++)(w=this.getNthDayInPeriod(D,S,t,R))&&(w=DateHelper.copyTimeValues(w,s),b[w.getTime()]||(b[w.getTime()]=!0,E.push(w)))})),E.sort(((e,t)=>e-t)),!y)for(R=0;R<E.length;R++)if(w=E[R],w>=s){const e=this.isInView(t,w,a,o,i);if(T++,e&&(n&&w>=n||!1===d.apply(h,[w,T,1===T&&l,i,...u])||m&&T>=m))return!1}}else{const e=[];for(R=0;R<x.length;R++)(w=this.getNthDayOfMonth(D,x[R]))&&!b[w.getTime()]&&(b[w.getTime()]=!0,e.push(w));for(e.sort(((e,t)=>e-t)),R=0;R<e.length;R++)if(w=DateHelper.copyTimeValues(e[R],s),y)E.push(w);else if(w>=s){const e=this.isInView(t,w,a,o,i);if(T++,e&&(n&&w>n||!1===d.apply(h,[w,T,1===T&&l,i,...u])||m&&T>=m))return}}y&&E.length&&this.forEachDateAtPositions(E,f,(e=>{if(e>=s){const r=t?e>=a:e.valueOf()+o>a&&!i.hasException(e);if(T++,r&&(!n||e<=n)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||m&&T>=m))return!1}})),D=DateHelper.getNext(D,"month",g),S=new Date(DateHelper.getNext(D,"month",1)-1)}}};__publicField(MonthlyRecurrenceIterator,"frequency","MONTHLY"),MonthlyRecurrenceIterator._$name="MonthlyRecurrenceIterator";var YearlyRecurrenceIterator=class extends AbstractRecurrenceIterator{static forEachDate(e){const{startOnly:t,startDate:r,endDate:n,timeSpan:i,timeSpanStart:s,earliestVisibleDate:a,durationMS:o,spansStart:l,recurrence:c,fn:d,extraArgs:u,scope:h=this}=this.processIterationConfig(e),{interval:g,days:p,count:m,positions:f}=c,v=RecurrenceDayRuleEncoder.decode(p),y=f&&f.length,b={};let C,D,S,E,w,R,{months:x}=c,T=0;for(E=DateHelper.startOf(m||g>1?s:r,"year"),w=new Date(DateHelper.getNext(E,"year",1)-1),x&&x.sort(((e,t)=>e-t)),x&&x.length||v&&v.length||(x=[s.getMonth()+1]),v&&v.length&&v.forEach((e=>{e[1]&&(R=R||{},R[e[0]]=e[1])}));(!n||n>E)&&(!m||T<m);){if(S=[],v&&v.length){if(v.forEach((e=>{const t=e[0];let r=1,n=53;for(e[1]&&(r=n=e[1]),C=r;C<=n;C++)(D=this.getNthDayInPeriod(E,w,t,C))&&(D=DateHelper.copyTimeValues(D,s),b[D.getTime()]||(b[D.getTime()]=!0,S.push(D)))})),S.sort(((e,t)=>e-t)),!y)for(C=0;C<S.length;C++)if(D=S[C],D>=s){const e=this.isInView(t,D,a,o,i);if(T++,e&&(n&&D>=n||!1===d.apply(h,[D,T,1===T&&l,i,...u])||m&&T>=m))return}}else for(C=0;C<x.length;C++)if((D=this.buildDate(E.getFullYear(),x[C]-1,s.getDate()))&&(D=DateHelper.copyTimeValues(D,s),!b[D.getTime()]))if(b[D.getTime()]=!0,y)S.push(D);else if(D>=s){const e=t?D>=a:D.valueOf()+o>a&&!i.hasException(D);if(T++,e&&(n&&D>=n||!1===d.apply(h,[D,T,1===T&&l,i,...u])||m&&T>=m))return}y&&S.length&&this.forEachDateAtPositions(S,f,(e=>{if(e>=s){const r=t?e>=a:e.valueOf()+o>a&&!i.hasException(e);if(T++,r&&(!n||e<n)&&(!1===d.apply(h,[e,T,1===T&&l,i,...u])||m&&T>=m))return!1}})),E=DateHelper.getNext(E,"year",g),w=new Date(DateHelper.getNext(E,"year",1)-1)}}};__publicField(YearlyRecurrenceIterator,"frequency","YEARLY"),YearlyRecurrenceIterator._$name="YearlyRecurrenceIterator";var recurrenceIterators={};function convertStringOfIntegerItemsValue(e){return e?"string"==typeof e&&(e=e.split(",").map((e=>parseInt(e,10)))):e=null,e}function convertStringOfItemsValue(e){return e?"string"==typeof e&&(e=e.split(",")):e=null,e}function isEqualAsString(e,t){return String(e)===String(t)}function convertInteger(e){return this.defaultValue&&void 0===e?this.defaultValue:this.allowNull&&null==e?null:(e=parseInt(e),isNaN(e)?void 0:e)}[DailyRecurrenceIterator,WeeklyRecurrenceIterator,MonthlyRecurrenceIterator,YearlyRecurrenceIterator].forEach((e=>{recurrenceIterators[e.frequency]=e}));var RecurrenceModel=class extends Model{static get $name(){return"RecurrenceModel"}get isRecurrenceModel(){return!0}static get fields(){return[{name:"frequency",defaultValue:"DAILY"},{name:"interval",defaultValue:1,convert:convertInteger},{name:"endDate",type:"date"},{name:"count",allowNull:!0,convert:convertInteger},{name:"days",convert:convertStringOfItemsValue,isEqual:isEqualAsString},{name:"monthDays",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString},{name:"months",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString},{name:"positions",convert:convertStringOfIntegerItemsValue,isEqual:isEqualAsString}]}get dateFormat(){return this._dateFormat||"YYYYMMDDTHHmmss"}set dateFormat(e){this._dateFormat=e}get recurrenceIterator(){return recurrenceIterators[this.frequency]}get timeSpan(){return this._timeSpan}set timeSpan(e){this._timeSpan=e}get rule(){const e=this,t=[];return e.frequency&&(t.push("FREQ="+e.frequency),e.interval>1&&t.push("INTERVAL="+e.interval),e.days&&e.days.length&&t.push("BYDAY="+e.days.join(",")),e.monthDays&&e.monthDays.length&&t.push("BYMONTHDAY="+e.monthDays.join(",")),e.months&&e.months.length&&t.push("BYMONTH="+e.months.join(",")),e.count&&t.push("COUNT="+e.count),e.endDate&&t.push("UNTIL="+DateHelper.format(e.endDate,e.dateFormat)),e.positions&&e.positions.length&&t.push("BYSETPOS="+e.positions.join(","))),t.join(";")}set rule(e){const t=this,r={frequency:null,interval:null,count:null,endDate:null,days:null,monthDays:null,months:null,positions:null};if(t.beginBatch(),e){const n=e.split(";");for(let e=0,i=n.length;e<i;e++){const i=n[e].split("="),s=i[1];switch(i[0]){case"FREQ":r.frequency=s;break;case"INTERVAL":r.interval=s;break;case"COUNT":r.count=s,r.until=null;break;case"UNTIL":r.endDate=s?DateHelper.parse(s,t.dateFormat):null,r.count=null;break;case"BYDAY":r.days=s;break;case"BYMONTHDAY":r.monthDays=s;break;case"BYMONTH":r.months=s;break;case"BYSETPOS":r.positions=s}}}t.set(r),e&&t.sanitize(),t.endBatch()}construct(e={}){const t=this,{rule:r,timeSpan:n}=e;t._suspendedTimeSpanNotifying=0,delete e.timeSpan,delete e.rule,super.construct(...arguments),r&&(t.suspendTimeSpanNotifying(),t.rule=r,t.resumeTimeSpanNotifying()),t.timeSpan=n}forEachOccurrence(e,t,r){this.timeSpan.startDate&&this.recurrenceIterator.forEachDate({recurrence:this,startDate:e,endDate:t,fn:(e,t,n,i)=>r(i.buildOccurrence(e,n),n,t,e)})}sanitize(){var e,t;const r=this,n=null==(e=r.timeSpan)?void 0:e.startDate,i={};switch(r.isSanitizing=!0,r.frequency){case"DAILY":i.positions=null,i.days=null,i.monthDays=null,i.months=null;break;case"WEEKLY":{i.positions=null,i.monthDays=null,i.months=null;const{days:e}=r;n&&1===(null==e?void 0:e.length)&&e[0]===RecurrenceDayRuleEncoder.encodeDay(n.getDay())&&(i.days=null);break}case"MONTHLY":{(null==(t=r.monthDays)?void 0:t.length)&&(i.positions=null,i.days=null),i.months=null;const{monthDays:e}=r;n&&1===(null==e?void 0:e.length)&&e[0]===n.getDate()&&(i.monthDays=null);break}case"YEARLY":{i.monthDays=null;const{months:e}=r;n&&1===(null==e?void 0:e.length)&&e[0]===n.getMonth()+1&&(i.months=null);break}}r.set(i),r.isSanitizing=!1}copy(...e){const t=super.copy(...e);return t.dateFormat=this.dateFormat,t.timeSpan=this.timeSpan,t}afterChange(e,t,r){const n=super.afterChange(e,t,r),{timeSpan:i}=this;return this.isSanitizing||this.sanitize(),i&&(i.sanitizeRecurrenceData(this),this.isTimeSpanNotifyingSuspended||i.onRecurrenceChanged()),n}set(e,t,...r){const n="object"==typeof e?e:{[e]:t};n.count?n.endDate=null:n.endDate&&(n.count=null),super.set(n,void 0,...r)}get isTimeSpanNotifyingSuspended(){return Boolean(this._suspendedTimeSpanNotifying)}suspendTimeSpanNotifying(){this._suspendedTimeSpanNotifying++}resumeTimeSpanNotifying(){this._suspendedTimeSpanNotifying&&this._suspendedTimeSpanNotifying--}};function convertExceptionDatesValue(e){const t={},{dateFormat:r}=this;return e&&(e="string"==typeof e?e.split(","):ArrayHelper.asArray(e)).forEach((e=>{"string"==typeof e&&(e=DateHelper.parse(e,r)),isNaN(e)||(t[DateHelper.makeKey(e)]=1)})),t}function serializeExceptionDatesValue(e){const t=[],{dateFormat:r}=this;for(const n in e)e[n]&&t.push(DateHelper.format(DateHelper.parseKey(n),r));return t}RecurrenceModel._$name="RecurrenceModel";var emptyArray12=[],RecurringTimeSpan_default=e=>class extends(e||TimeSpan){static get $name(){return"RecurringTimeSpan"}get supportsRecurring(){return!0}static get fields(){return[{name:"recurrenceRule",internal:!0},{name:"exceptionDates",convert:convertExceptionDatesValue,serialize:serializeExceptionDatesValue,internal:!0}]}remove(){if(!this.isOccurrence)return super.remove(...arguments);{const e=this,{recurringTimeSpan:t}=e;e.cancelBatch(),t.beginBatch(),e.detachFromRecurringEvent(),t.endBatch()}}get eventStore(){var e;let t=this.isOccurrence?this.recurringEvent.eventStore:super.eventStore;return!t&&(null==(e=this.firstStore)?void 0:e.isRecurringTimeSpansMixin)&&(t=this.firstStore),t}get recurrenceModel(){return this._recurrenceModel||RecurrenceModel}set recurrenceModel(e){this._recurrenceModel=e}setRecurrence(e,t,r){const n=this;let i;e&&(e.isRecurrenceModel||("string"==typeof e&&(e={frequency:e},t&&(e.interval=t),r&&(r instanceof Date?e.endDate=r:e.count=r)),e=new n.recurrenceModel(e)),e.timeSpan=n,i=e.rule),n.recurrence=e,n.recurrenceRule=i}get recurrence(){const e=this,t=e.recurrenceRule;return!e._recurrence&&t&&(e._recurrence=new e.recurrenceModel({rule:t,timeSpan:e,id:e.id+"-recurrence"})),e._recurrence}set recurrence(e){const t=this;t._recurrence=e,e?(e.timeSpan=t,t.recurrenceRule=e.rule):t.isOccurrence?t.setData("recurrenceRule",null):t.recurrenceRule=null}get isRecurring(){return Boolean(!this.isOccurrence&&this.recurrence)}get isOccurrence(){return Boolean(this.recurringTimeSpan)}get recurringTimeSpan(){return this._recurringTimeSpan}get isPersistable(){return super.isPersistable&&(!this.supportsRecurring||!this.isOccurrence)}set recurringTimeSpan(e){this._recurringTimeSpan=e}getOccurrencesForDateRange(e,t=e){return this.eventStore.getOccurrencesForTimeSpan(this,e,t)}get occurrences(){if(this.isRecurring){const e=[];return this.occurrenceMap.forEach((t=>{t!==this&&e.push(t)})),e}return emptyArray12}get occurrenceMap(){return this._occurrencesMap||(this._occurrencesMap=new Map)}removeOccurrence(e){var t;const r=e.isTimeSpan?e.occurrenceDate:e;null==(t=this.eventStore)||t.globalOccurrences.delete(this.createRecurrenceKey(r)),this.occurrenceMap.delete(DateHelper.makeKey(r))}removeOccurrencesFrom(e){this.occurrenceMap.forEach(((t,r)=>{DateHelper.parseKey(r)>=e&&this.removeOccurrence(t)}))}removeOccurrences(){[this,...this.occurrences].forEach((e=>this.removeOccurrence(e)))}onRecurrenceChanged(){var e;this.recurrenceRule=(null==(e=this.recurrence)?void 0:e.rule)||null}sanitizeRecurrenceData(e=this.recurrence){if(e.endDate){const t=DateHelper.clearTime(e.endDate),{exceptionDates:r}=this;if(this.removeOccurrencesFrom(t),r)for(const e in r){DateHelper.parseKey(e)>=t&&delete r[e]}}}get occurrenceDate(){var e;return(null==(e=this.meta.modified)?void 0:e.startDate)||this.startDate}get occurrenceIndex(){return AbstractRecurrenceIterator.getOccurrenceIndex(this)}buildOccurrence(e,t){var r;const n=this,{occurrenceMap:i,recurrence:s,meta:a}=n,o=null==(r=n.eventStore)?void 0:r.globalOccurrences,l=DateHelper.makeKey(e),c=n.createRecurrenceKey(e,l),d=!(e-n.startDate),{fieldMap:u}=n.constructor;let h=null==o?void 0:o.get(c),{duration:g}=n;!n.endDate||!n.allDay&&g||(g=DateHelper.as(n.durationUnit,n.endDate.getTime()-n.startDate.getTime()));const p=void 0!==g?DateHelper.add(e,g,n.durationUnit):void 0;return h||(t||d?(h=n,d||(n.setStartEndDate(e,p,!0),s.suspendTimeSpanNotifying(),s.sanitize(),s.resumeTimeSpanNotifying()),a.isSyncedWithRule=!0):(h=n.copy({[u.id.dataSource]:c,[u.startDate.dataSource]:e,[u.endDate.dataSource]:p,[u.duration.dataSource]:g,constraintDate:null,constraintType:null},{creatingOccurrence:!0}),h.recurringTimeSpan=n),null==o||o.set(c,h),i.set(l,h)),h}createRecurrenceKey(e=this.startDate,t=null){return"_generated:"+this.id+":"+(t||DateHelper.makeKey(e))}convertToRealEvent(e,t){var r;if(!this.isOccurrence)return;const n=this,{recurringTimeSpan:i,resource:s,occurrenceIndex:a,recurrence:o}=n,l=o&&i.recurrence.count,c=(null==(r=null==e?void 0:e.resourceRecords)?void 0:r.value)||n.data.newResource;i.beginBatch(),n.detachFromRecurringEvent(),n.clearChanges(),n.setData("id",n.generateId(i.eventStore)),c&&delete n.data.resourceId,i.eventStore.add(n,t),l&&(n.recurrence.count=l-a),(c||s)&&n.assign(c||s),c&&delete n.data.resourceRecords,e&&delete e.resourceRecords,i.endBatch()}afterChange(e,t,r,...n){const i=this,{eventStore:s}=i;return"recurrenceRule"in t&&(i._recurrence=null,null==s||s.recurringEvents[t.recurrenceRule.value?"add":"delete"](i)),i.isOccurrence?i.convertToRealEvent(t,r):"newExceptionDate"in t&&(i.meta.modified.exceptionDates=!0,delete i.meta.modified.newExceptionDate,i.removeOccurrence(t.newExceptionDate.value)),super.afterChange(e,t,r,...n)}detachFromRecurringEvent(){const e=this,{recurringTimeSpan:t,occurrenceDate:r,startDate:n}=e;e.recurringTimeSpan=null,t.addExceptionDate(r),e.recurrenceRule&&(t.recurrence.endDate=DateHelper.add(n,-1,"minute"))}set newExceptionDate(e){if(e){(this.exceptionDates||(this.exceptionDates={}))[DateHelper.makeKey(e)]=1}}addExceptionDate(e){return this.set({newExceptionDate:e})}hasException(e){var t;return null==(t=this.exceptionDates)?void 0:t[DateHelper.makeKey(e)]}},oneDayMS=864e5,EventModelMixin_default=e=>class extends e{static get $name(){return"EventModelMixin"}static get isEventModel(){return!0}static get fields(){return[{name:"resourceId",internal:!0},{name:"resources",column:{type:"resourceassignment"},persist:!1,internal:!0},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0,internal:!0},{name:"resizable",persist:!1,defaultValue:!0,internal:!0},{name:"allDay",type:"boolean",defaultValue:!1},{name:"eventStyle",internal:!0},{name:"eventColor",internal:!0},{name:"milestoneWidth",internal:!0},{name:"stickyContents",internal:!0}]}updateAssignmentEventIds(){this.assigned.forEach((e=>{e.eventId=this.id}))}syncId(e){super.syncId(e),this.updateAssignmentEventIds()}get resources(){return this.assignments.reduce(((e,{resource:t})=>(t&&e.push(t.$original),e)),[])}set resources(e){e=ArrayHelper.asArray(e);const t=this,r=e.map(t.constructor.asId);if(t.usesSingleAssignment)t.set("resourceId",r[0]);else{const e=t.assignments.map((e=>e.resource.id)),{onlyInA:n,onlyInB:i}=ArrayHelper.delta(r,e);t.assignmentStore.add(n.map((e=>({resource:e,event:t})))),t.assignmentStore.remove(i.map((e=>t.assignments.find((t=>t.resource.id===e)))))}}forEachResource(e,t=this){for(const r of this.resources)if(!1===e.call(t,r))return}getResource(e){return null==e?this.resource:this.resourceStore?this.resourceStore.getById(e):null}get startDate(){var e;let t;return t=this.isOccurrence?this.get("startDate"):null!=(e=this._startDate)?e:super.startDate,this.allDay&&(t=this.constructor.getAllDayStartDate(t)),t}set startDate(e){this.batching?(this._startDate=e,this.set({startDate:e})):super.startDate=e}get endDate(){var e;let t;return t=this.isOccurrence?this.get("endDate"):null!=(e=this._endDate)?e:super.endDate,this.allDay&&(t=this.constructor.getAllDayEndDate(t)),t}set endDate(e){this.batching?(this._endDate=e,this.set({endDate:e})):super.endDate=e}get wrapStartDate(){return this.startDate}set wrapStartDate(e){}get wrapEndDate(){return this.endDate}set wrapEndDate(e){}get isEvent(){return!0}get isDraggable(){return!this.readOnly&&this.draggable}get isResizable(){return!this.isMilestone&&(!this.isParent||this.manuallyScheduled)&&this.resizable}get isPersistable(){return super.isPersistable&&!this.isCreating}endBatch(){const e=this,{isPersistable:t,meta:{batchChanges:r}}=e;if(r&&("endDate"in r&&(delete e._endDate,e.postamble&&(e.wrapEndDate=null)),"startDate"in r&&(delete e._startDate,e.preamble&&(e.wrapStartDate=null))),super.endBatch(...arguments),e.isPersistable&&!t&&!e.ignoreBag&&e.assigned)for(const t of e.assigned)t.stores.forEach((e=>e.updateModifiedBagForRecord(t)))}get isCreating(){return super.isCreating}set isCreating(e){super.isCreating=e,this.assignments.forEach((t=>t.isCreating=e))}get usesSingleAssignment(){return!this.eventStore||this.eventStore.usesSingleAssignment}copy(...e){const t=super.copy(...e);return this.usesSingleAssignment||(t.resourceId=null),t}get persistableData(){const e=super.persistableData;return this.usesSingleAssignment||delete e.resourceId,e}get resource(){const{resources:e}=this;return e.length?e[0]:null}set resource(e){this.resourceId=this.constructor.asId(e)}get resourceId(){var e;return this.usesSingleAssignment?this.get("resourceId"):null==(e=this.resource)?void 0:e.id}set resourceId(e){this.applyResourceId(e)}get $linkedResources(){var e,t;return null!=(t=null==(e=this.resources)?void 0:e.flatMap((e=>[e,...e.$links])))?t:[]}applyResourceId(e,t=!1){var r;const n=this,{eventStore:i,assignments:s}=n;if(i){const t=i.assignmentStore||(null==(r=i.crudManager)?void 0:r.assignmentStore);if(null!=e)if(n.meta.skipEnforcingSingleAssignment||(i.usesSingleAssignment=!0),(null==s?void 0:s.length)&&e!==s[0].resourceId){const r=Boolean(i.eventsSuspended);r&&t.suspendEvents(),s[0].resource=e,r&&t.resumeEvents()}else t.assignEventToResource(n,e);else t.remove(s)}else t||n.set({resourceId:e})}applyValue(e,t,r,n,i){if(i&&"resourceId"===i.name&&!this.meta.isAssigning){const{eventStore:e}=this;e&&(e.isAssigning=!0),this.applyResourceId(r,!0),e&&(e.isAssigning=!1)}super.applyValue(e,t,r,n,i)}get assignments(){return[...this.assigned||[]]}assign(e,t=!1){const{eventStore:r}=this;r&&!r.usesSingleAssignment?r.assignEventToResource(this,e,t):(this.resourceId=this.constructor.asId(e),r||(this.meta.skipEnforcingSingleAssignment=!0))}unassign(e,t=!1){var r;const n=this;e=n.constructor.asId(e),n.meta.removingResource=t,null==(r=n.eventStore)||r.unassignEventFromResource(n,e),n.meta.removingResource=null}reassign(e,t){this.eventStore&&this.eventStore.reassignEventFromResourceToResource(this,e,t)}isAssignedTo(e){const t=this.constructor.asId(e);return this.assignments.some((e=>e.resourceId===t))}get predecessors(){var e;return[...null!=(e=this.incomingDeps)?e:[]]}get successors(){var e;return[...null!=(e=this.outgoingDeps)?e:[]]}get dependencies(){var e,t;return[...null!=(e=this.incomingDeps)?e:[],...null!=(t=this.outgoingDeps)?t:[]]}normalize(){}inSetNormalize(){}get recurringEvent(){return this.recurringTimeSpan}get isInterDay(){const{durationMS:e}=this;if(e>=oneDayMS||!e&&this.allDay)return!0;const{endDate:t,startDate:r}=this,n=DateHelper.clearTime(r);return r&&t?(n.setDate(n.getDate()+1),(t||DateHelper.add(r,e))>n):void 0}static getAllDayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),e&&(e=DateHelper.clearTime(e,!0)),e}static getAllDayEndDate(e){return e&&e.isEvent&&(e=e.get("endDate")),e&&(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0||e.getMilliseconds()>0)&&(e=DateHelper.getNext(e,"d",1)),e}static getAllDayDisplayStartDate(e){return e&&e.isEvent&&(e=e.get("startDate")),DateHelper.clearTime(e,!0)}static getAllDayDisplayEndDate(e,t){return e&&e.isEvent&&(t=e.get("endDate"),e=e.get("startDate")),t&&(e=this.constructor.getAllDayDisplayStartDate(e),DateHelper.clearTime(t,!0).valueOf()===t.valueOf()?t=DateHelper.add(t,DateHelper.DAY,-1):e.valueOf()!==t.valueOf()&&(t=DateHelper.clearTime(t,!0))),t}isEditable(e){switch(e){case"endDate":case"duration":case"fullDuration":return this.isLeaf}return super.isEditable(e)}},EngineMixin5=SchedulerCoreEvent,EventModel=class extends(EngineMixin5.derive(TimeSpan).mixin(RecurringTimeSpan_default,PartOfProject_default,EventModelMixin_default)){static get $name(){return"EventModel"}};EventModel.exposeProperties(),EventModel._$name="EventModel";var EngineMixin6=PartOfProject_default(CoreEventStoreMixin.derive(AjaxStore)),EventStore=class extends(EngineMixin6.mixin(SharedEventStoreMixin_default,RecurringEventsMixin_default,EventStoreMixin_default,DayIndexMixin_default,GetEventsMixin_default)){static get defaultConfig(){return{modelClass:EventModel}}};__publicField(EventStore,"$name","EventStore"),EventStore._$name="EventStore";var canonicalDependencyTypes=["SS","SF","FS","FF"],DependencyBaseModel=class extends Model{static get $name(){return"DependencyBaseModel"}static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"},{name:"highlighted",persist:!1,internal:!0}]}construct(e){const t=e[this.fieldMap.from.dataSource],r=e[this.fieldMap.to.dataSource];null!=t&&(e.fromEvent=t),null!=r&&(e.toEvent=r),super.construct(...arguments)}get eventStore(){var e;return this.eventStore||(null==(e=this.unjoinedStores[0])?void 0:e.eventStore)}set from(e){const{fromEvent:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("from",e):this.fromEvent=e}get from(){return this.get("from")}set to(e){const{toEvent:t}=this;(null==t?void 0:t.isModel)&&t.id===e?this.set("to",e):this.toEvent=e}get to(){return this.get("to")}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.hardType&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){this.setLag(e)}setLag(e,t=this.lagUnit){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=DateHelper.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?(this.lag<0?"-":"+")+Math.abs(this.lag)+DateHelper.getShortNameOfUnit(this.lagUnit):""}get fullLag(){return new Duration({unit:this.lagUnit,magnitude:this.lag})}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}get isPersistable(){const e=this,{stores:t,unjoinedStores:r}=e,n=t[0];let i;if(n){const{fromEvent:t,toEvent:r}=e,s=n.crudManager;i=t&&(s||!t.hasGeneratedId)&&r&&(s||!r.hasGeneratedId)}else i=Boolean(r[0]);return i&&super.isPersistable}getDateRange(){const{fromEvent:e,toEvent:t}=this;if((null==e?void 0:e.isScheduled)&&(null==t?void 0:t.isScheduled)){const r=DependencyBaseModel.Type;let n,i;switch(this.type){case r.StartToStart:n=e.startDateMS,i=t.startDateMS;break;case r.StartToEnd:n=e.startDateMS,i=t.endDateMS;break;case r.EndToEnd:n=e.endDateMS,i=t.endDateMS;break;case r.EndToStart:n=e.endDateMS,i=t.startDateMS;break;default:throw new Error("Invalid dependency type: "+this.type)}return{start:Math.min(n,i),end:Math.max(n,i)}}return null}highlight(e){var t,r;const n=null!=(r=null==(t=this.highlighted)?void 0:t.split(" "))?r:[];n.includes(e)||(this.highlighted=n.concat(e).join(" "))}unhighlight(e){const{highlighted:t}=this;if(t){const r=t.split(" "),n=r.indexOf(e);n>=0&&(r.splice(n,1),this.highlighted=r.join(" "))}}isHighlightedWith(e){return this.highlighted&&this.highlighted.split(" ").includes(e)}getConnectorString(e){const t=canonicalDependencyTypes[this.type];return e?t:this.type===DependencyBaseModel.Type.EndToStart?"":t}toString(){return""+this.from+this.getConnectorString()+this.getLag()}get isValid(){const{fromEvent:e,toEvent:t,type:r}=this;return"number"==typeof r&&e&&t&&e!==t}get fromEventName(){var e;return(null==(e=this.fromEvent)?void 0:e.name)||""}get toEventName(){var e;return(null==(e=this.toEvent)?void 0:e.name)||""}shouldRecordFieldChange(e,t,r){var n;if(!super.shouldRecordFieldChange(e,t,r))return!1;if("from"===e||"to"===e||"fromEvent"===e||"toEvent"===e){const e=null==(n=this.project)?void 0:n.eventStore;if(e&&e.oldIdMap[t]===e.getById(r))return!1}return!0}};DependencyBaseModel.exposeProperties(),DependencyBaseModel._$name="DependencyBaseModel";var EngineMixin7=CoreDependencyMixin,DependencyModel=class extends(PartOfProject_default(EngineMixin7.derive(DependencyBaseModel))){static get $name(){return"DependencyModel"}getTypeFromSides(e,t,r){const n=DependencyBaseModel.Type,i=r?"right":"left",s=r?"left":"right";return e===i?t===i?n.StartToStart:n.StartToEnd:t===s?n.EndToEnd:n.EndToStart}};DependencyModel.exposeProperties(),DependencyModel._$name="DependencyModel";var DependencyStoreMixin_default=e=>class extends e{static get $name(){return"DependencyStoreMixin"}static get defaultConfig(){return{loadPriority:400,syncPriority:400,storeId:"dependencies"}}reduceEventDependencies(e,t,r,n=!0,i){return i=i||(e=>this.getEventDependencies(e)),(e=ArrayHelper.asArray(e)).reduce(((e,r)=>{r.children&&!n?r.traverse((r=>{e=i(r).reduce(t,e)})):e=i(r).reduce(t,e)}),r),r}mapEventDependencies(e,t,r,n,i){return this.reduceEventDependencies(e,((e,t)=>(r(t)&&e.push(t),e)),[],n,i)}mapEventPredecessors(e,t,r,n){return this.reduceEventPredecessors(e,((e,t)=>(r(t)&&e.push(t),e)),[],n)}mapEventSuccessors(e,t,r,n){return this.reduceEventSuccessors(e,((e,t)=>(r(t)&&e.push(t),e)),[],n)}getEventDependencies(e){return[].concat(e.predecessors||[],e.successors||[])}removeEventDependencies(e){this.remove(this.getEventDependencies(e))}removeEventPredecessors(e){this.remove(e.predecessors)}removeEventSuccessors(e,t){this.remove(e.successors)}getBySourceTargetId(e){return this.records.find((t=>e==this.constructor.makeDependencySourceTargetCompositeKey(t.from,t.to)))}getDependencyForSourceAndTargetEvents(e,t){return e=Model.asId(e),t=Model.asId(t),this.getBySourceTargetId(this.constructor.makeDependencySourceTargetCompositeKey(e,t))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}async isValidDependency(e,t,r){let n=e,i=t;return null!=e&&(e.isDependencyModel&&({fromEvent:n,toEvent:i}=e),n=this.eventStore.getById(n),i=this.eventStore.getById(i),n&&i?!(!n.project||!i.project)&&this.project.isValidDependency(n,i,r):e!==t)}isValidDependencyToCreate(e,t,r){return this.isValidDependency(e,t,r)}getHighlightedDependencies(e){return this.records.reduce(((t,r)=>(r.isHighlightedWith(e)&&t.push(r),t)),[])}static makeDependencySourceTargetCompositeKey(e,t){return"source("+e+")-target("+t+")"}getTimeSpanDependencies(e){return this.getEventDependencies(e)}},EngineMixin8=PartOfProject_default(CoreDependencyStoreMixin.derive(AjaxStore)),DependencyStore=class extends(DependencyStoreMixin_default(EngineMixin8.derive(AjaxStore))){static get defaultConfig(){return{modelClass:DependencyModel}}};DependencyStore._$name="DependencyStore";var ProjectCrudManager_default=e=>class extends((e||Base).mixin(AbstractCrudManagerMixin_default,AjaxTransport_default,JsonEncoder_default)){static get defaultConfig(){return{project:null}}startConfigure(e){this.getConfig("project"),super.startConfigure(e),this._changesToClear=new Map}async doAutoLoad(){const{project:e}=this;return e&&await e.commitAsync(),super.doAutoLoad()}applyProjectResponse(e){const t=this,{project:r}=t;t.applyingProjectResponse=!0;const n=r.fieldMap.startDate,i=r.fieldMap.endDate,s=ObjectHelper.getPath(e,n.dataSource),a=ObjectHelper.getPath(e,i.dataSource);"string"==typeof s&&ObjectHelper.setPath(e,n.dataSource,n.convert(s)),"string"==typeof a&&ObjectHelper.setPath(e,i.dataSource,i.convert(a)),Object.assign(r,e),t._changesToClear.set(t,e),t.applyingProjectResponse=!1}loadCrudManagerData(e,t={}){const r=this,{project:n}=r;r.suspendChangesTracking(),super.loadCrudManagerData(...arguments),(null==e?void 0:e.project)&&(n.delayEnteringReplica?n.ion({recordsUnlinked:()=>{r.suspendChangesTracking(),r.applyProjectResponse(e.project),r.resumeChangesTracking()},once:!0}):r.applyProjectResponse(e.project)),r.resumeChangesTracking()}async sync(){const{project:e}=this;if(this.suspendAutoSync(),e&&await e.commitAsync(),!this.isDestroying)return this.resumeAutoSync(!1),super.sync()}async applyResponse(e,t,r){var n,i,s,a,o;const l=this;if(!l.isDestroyed&&!(null==(n=l.project)?void 0:n.isDestroyed)&&(l.trigger("startApplyResponse"),await super.applyResponse(e,t,r),((null==t?void 0:t.project)||l.supportShortSyncResponse&&(null==(i=null==e?void 0:e.pack)?void 0:i.project))&&l.applyProjectResponse(t.project||(null==(s=null==e?void 0:e.pack)?void 0:s.project)),l.project)){let r=e.type;l.trackResponseType&&(r=t.type||r);const n="propagating"+StringHelper.capitalize(r)+"Changes";l.suspendAutoSync(),l[n]=!0;const i=l.project.isInitialCommit&&!l.project.silenceInitialCommit;await l.project.commitAsync(),l[n]=!1,null==(a=l.resumeAutoSync)||a.call(l,i),null==(o=l.commitRespondedChanges)||o.call(l)}}applySyncResponse(...e){var t;const r=this,n=null==(t=r.project)?void 0:t.stm.disabled;!1===n&&r.ignoreRemoteChangesInSTM&&r.project.stm.disable(),super.applySyncResponse(...e),!1===n&&r.project.stm.enable()}shouldClearRecordFieldChange(e,t,r){const n=e[t];return(null==(t=e.getFieldDefinition(t))?void 0:t.isEqual)?t.isEqual(n,r):ObjectHelper.isEqual(n,r)}commitRespondedChanges(){this._changesToClear.forEach(((e,t)=>{Object.entries(e).forEach((([e,r])=>{this.shouldClearRecordFieldChange(t,e,r)&&delete t.meta.modified[e]}))})),this._changesToClear.clear()}applyChangesToStore(e,t,r,...n){const i=super.applyChangesToStore(e,t,r,...n);if(i.size&&this.project)for(const[t,r]of i){const n=e.store.getById(t);n&&this._changesToClear.set(n,r)}return i}},ProjectModelCommon_default=e=>{var t;return __publicField(t=class extends(e||Model){static get configurable(){return{assignments:null,dependencies:null,resources:null,timeRanges:null}}get assignments(){return this.assignmentStore.allRecords}updateAssignments(e){this.assignmentStore.data=e}get dependencies(){return this.dependencyStore.allRecords}updateDependencies(e){this.dependencyStore.data=e}get resources(){return this.resourceStore.allRecords}updateResources(e){this.resourceStore.data=e}get timeRanges(){return this.timeRangeStore.allRecords}getTimeRanges(e,t){const r=this.timeRangeStore,n=[];for(const i of r)i.isRecurring?n.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&e<i.endDate&&n.push(i);return n}updateTimeRanges(e){this.timeRangeStore.data=e}getResourceTimeRanges(e,t){const r=this.resourceTimeRangeStore,n=[];for(const i of r)i.isRecurring?n.push(...i.getOccurrencesForDateRange(e,t)):i.startDate<t&&e<i.endDate&&n.push(i);return n}},"$name","ProjectModelCommon"),t},ResourceTimeRangeModel=class extends(TimeSpan.mixin(RecurringTimeSpan_default)){get domId(){return this.constructor.domIdPrefix+"-"+this.id}get isResourceTimeRange(){return!0}get resources(){return this.resource?[this.resource]:[]}get $linkedResources(){return this.resources}};__publicField(ResourceTimeRangeModel,"$name","ResourceTimeRangeModel"),__publicField(ResourceTimeRangeModel,"fields",["resourceId","timeRangeColor"]),__publicField(ResourceTimeRangeModel,"relations",{resource:{foreignKey:"resourceId",foreignStore:"resourceStore",relatedCollectionName:"timeRanges",nullFieldOnRemove:!0}}),__publicField(ResourceTimeRangeModel,"domIdPrefix","resourcetimerange"),ResourceTimeRangeModel._$name="ResourceTimeRangeModel";var ResourceTimeRangeStore=class extends(AjaxStore.mixin(RecurringTimeSpansMixin_default)){static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:ResourceTimeRangeModel,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}getRanges({resourceRecord:e,startDate:t,endDate:r}){return e.timeRanges.flatMap((e=>e.supportsRecurring?e.getOccurrencesForDateRange(t,r):e.intersectsRange(t,r)?e:[])).sort(((e,t)=>e.startDate-t.startDate))}};__publicField(ResourceTimeRangeStore,"$name","ResourceTimeRangeStore"),ResourceTimeRangeStore._$name="ResourceTimeRangeStore";var ProjectModelTimeZoneMixin_default=e=>{var t;return __publicField(t=class extends(e||Model){afterConstruct(){super.afterConstruct(...arguments),this._storesWithDates=[this.taskStore,this.timeRangeStore,this.resourceTimeRangeStore]}relayStoreChange({source:e,action:t,records:r,replaced:n}){const i=this;i.timeZone&&i._storesWithDates.includes(e)&&("dataset"===t?(i.convertStoresToTimeZone([e]),i.ignoreRecordChanges=!0,i.commitAsync()):["add","replace"].includes(t)&&(!(null==r?void 0:r.length)&&(null==n?void 0:n.length)&&(r=n),r.length&&r.forEach((e=>e.timeZone=i.timeZone))))}convertStoresToTimeZone(e){var t;const r=this,{timeZone:n}=r,i=null==(t=r.stm)?void 0:t.autoRecord;i&&(r.stm.autoRecord=!1);for(const t of e)t&&t.forEach((e=>{var t;if(e.$ignoreChange=!0,null==(t=e.baselines)?void 0:t.count)for(const t of e.baselines)e.timeZone!==t.timeZone&&(t.timeZone=e.timeZone),t.convertToTimeZone(n);e.convertToTimeZone(n),delete e.$ignoreChange}));i&&(r.stmAutoRecord=i)}updateTimeZone(e,t){const r=this,n=r._isConfiguringTimeZone||r.isConfiguring;if(r.calendarManagerStore.forEach((e=>e.bumpVersion())),r.convertStoresToTimeZone(r._storesWithDates),r.startDate){const n=t?TimeZoneHelper.fromTimeZone(r.startDate,t):r.startDate;r.startDate=e?TimeZoneHelper.toTimeZone(n,e):n}r.ignoreRecordChanges=!0,r.commitAsync().then((()=>{r.isDestroyed||r.trigger("timeZoneChange",{timeZone:e,oldTimeZone:t,isConfiguring:n}),delete r._isConfiguringTimeZone}))}},"$name","ProjectModelTimeZoneMixin"),__publicField(t,"configurable",{timeZone:{$config:"lazy",value:null}}),t},ProjectModelMixin_default=e=>{var t;return t=class extends((e||Model).mixin(ProjectModelCommon_default,ProjectModelTimeZoneMixin_default)){static get $name(){return"ProjectModelMixin"}static get defaultConfig(){return{stm:{},timeRangeModelClass:TimeSpan,resourceTimeRangeModelClass:ResourceTimeRangeModel,timeRangeStoreClass:Store,resourceTimeRangeStoreClass:ResourceTimeRangeStore,eventStore:{},assignmentStore:{},dependencyStore:{},resourceStore:{},timeRangesData:null}}get inlineData(){return StringHelper.safeJsonParse(super.json)}set inlineData(e){this.json=e}construct(e={}){super.construct(...arguments),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData)}afterConstruct(){super.afterConstruct();const e=this;!e.timeRangeStore.stm&&e.stm.addStore(e.timeRangeStore),!e.resourceTimeRangeStore.stm&&e.stm.addStore(e.resourceTimeRangeStore)}attachStore(e){null==e||e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this})}detachStore(e){e&&this.detachListeners(e.$$name)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}updateTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}setTimeRangeStore(e){this.timeRangeStore=e}changeTimeRangeStore(e){return e&&!e.isStore&&(e=this.timeRangeStoreClass.new({modelClass:this.timeRangeModelClass},e)),e}updateResourceTimeRangeStore(e,t){this.detachStore(t),this.attachStore(e)}changeResourceTimeRangeStore(e){return e&&!e.isStore&&(e=this.resourceTimeRangeStoreClass.new({modelClass:this.resourceTimeRangeModelClass},e)),e}setResourceTimeRangeStore(e){this.resourceTimeRangeStore=e}get events(){return this.eventStore.allRecords}updateEvents(e){this.eventStore.data=e}get resourceTimeRanges(){return this.resourceTimeRangeStore.allRecords}updateResourceTimeRanges(e){this.resourceTimeRangeStore.data=e}async loadInlineData(e){return this.isLoadingInlineData=!0,e.resourceTimeRangesData&&(this.resourceTimeRangeStore.data=e.resourceTimeRangesData),e.timeRangesData&&(this.timeRangeStore.data=e.timeRangesData),super.loadInlineData(e)}toJSON(){const e=this,t={eventsData:e.eventStore.toJSON(),resourcesData:e.resourceStore.toJSON(),dependenciesData:e.dependencyStore.toJSON(),timeRangesData:e.timeRangeStore.toJSON(),resourceTimeRangesData:e.resourceTimeRangeStore.toJSON()};return e.eventStore.usesSingleAssignment||(t.assignmentsData=e.assignmentStore.toJSON()),t}get json(){return super.json}changeJson(e){return"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),e}updateJson(e){e&&this.loadInlineData(e)}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}doDestroy(){this.timeRangeStore.destroy(),this.resourceTimeRangeStore.destroy(),super.doDestroy()}},__publicField(t,"configurable",{json:null,timeRangeStore:{value:{id:"timeRanges",modelClass:TimeSpan},$config:"nullify"},resourceTimeRangeStore:{value:{},$config:"nullify"},events:null,resourceTimeRanges:null}),t},ProjectCurrentConfig_default=e=>class extends e{getCurrentConfig(e){const t=this,r=super.getCurrentConfig(e);if(r){for(const n of["eventStore","resourceStore","assignmentStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"]){const i=t[n];if(i){i.count&&(r[i.id+"Data"]=i.getInlineData(e));const t=i.getCurrentConfig(e);t&&Object.keys(t).length>0?r[n]=Object.assign(r[n]||{},t):r[n]&&0===Object.keys(r[n]).length&&delete r[n]}}return r.timeRangeStore&&(t.timeRangeStore.originalModelClass!==t.timeRangeModelClass&&"TimeSpan"!==t.timeRangeStore.originalModelClass.$name||delete r.timeRangeStore.modelClass,"timeRanges"===r.timeRangeStore.storeId&&delete r.timeRangeStore.storeId,1===Object.keys(r.timeRangeStore).length&&delete r.timeRangeStore),t.taskStore.isTaskStore&&(delete r.eventModelClass,delete r.eventStoreClass,delete r.children),r}}},ModelPersistencyManager=class extends Base{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.ion({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.ion({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.ion({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.ion({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){const t=e.added||[];let r,n;for(n=t.length-1;n>=0;--n)r=t[n],r.isPersistable||t.splice(t.indexOf(r),1);0===t.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}};ModelPersistencyManager._$name="ModelPersistencyManager";var EngineMixin9=SchedulerCoreProjectMixin,ProjectModel=class extends(ProjectCurrentConfig_default(ProjectModelMixin_default(EngineMixin9))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{eventModelClass:EventModel,dependencyModelClass:DependencyModel,resourceModelClass:ResourceModel,assignmentModelClass:AssignmentModel,eventStoreClass:EventStore,dependencyStoreClass:DependencyStore,resourceStoreClass:ResourceStore,assignmentStoreClass:AssignmentStore}}construct(...e){super.construct(...e),VersionHelper.isTestEnv&&(globalThis.gantt.testProject=this),this.modelPersistencyManager=this.createModelPersistencyManager()}createModelPersistencyManager(){return new ModelPersistencyManager({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}doDestroy(){this.modelPersistencyManager.destroy(),super.doDestroy()}get taskStore(){return this.eventStore}};ProjectModel.applyConfigs=!0,ProjectModel.initClass(),ProjectModel._$name="ProjectModel";var CrudManager=class extends(AbstractCrudManager.mixin(ProjectCrudManager_default,AjaxTransport_default,JsonEncoder_default)){static get defaultConfig(){return{projectClass:ProjectModel,resourceStoreClass:ResourceStore,eventStoreClass:EventStore,assignmentStoreClass:AssignmentStore,dependencyStoreClass:DependencyStore,resourceStore:{},eventStore:{},assignmentStore:{},dependencyStore:{},project:null}}buildProject(){return new this.projectClass(this.buildProjectConfig())}buildProjectConfig(){return ObjectHelper.cleanupProperties({eventStore:this.eventStore,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore,resourceTimeRangeStore:this.resourceTimeRangeStore})}set project(e){const t=this;e!==t._project&&(t.detachListeners("beforeDataReady"),t.detachListeners("afterDataReady"),t._project=e,e&&(t.eventStore=e.eventStore,t.resourceStore=e.resourceStore,t.assignmentStore=e.assignmentStore,t.dependencyStore=e.dependencyStore,t.timeRangeStore=e.timeRangeStore,t.resourceTimeRangeStore=e.resourceTimeRangeStore,e.ion({name:"beforeDataReady",dataReady:()=>t.suspendChangesTracking(),prio:100,thisObj:t}),e.ion({name:"afterDataReady",dataReady:()=>t.resumeChangesTracking(),prio:-100,thisObj:t})),t.eventStore||(t.eventStore={}),t.resourceStore||(t.resourceStore={}),t.assignmentStore||(t.assignmentStore={}),t.dependencyStore||(t.dependencyStore={}))}get project(){return this._project}get timeRangeStore(){var e;return null==(e=this._timeRangeStore)?void 0:e.store}set timeRangeStore(e){var t;this.setFeaturedStore("_timeRangeStore",e,null==(t=this.project)?void 0:t.timeRangeStoreClass)}get resourceTimeRangeStore(){var e;return null==(e=this._resourceTimeRangeStore)?void 0:e.store}set resourceTimeRangeStore(e){var t;this.setFeaturedStore("_resourceTimeRangeStore",e,null==(t=this.project)?void 0:t.resourceTimeRangeStoreClass)}get resourceStore(){var e;return null==(e=this._resourceStore)?void 0:e.store}set resourceStore(e){this.setFeaturedStore("_resourceStore",e,this.resourceStoreClass)}get eventStore(){var e;return null==(e=this._eventStore)?void 0:e.store}set eventStore(e){this.setFeaturedStore("_eventStore",e,this.eventStoreClass)}get assignmentStore(){var e;return null==(e=this._assignmentStore)?void 0:e.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){var e;return null==(e=this._dependencyStore)?void 0:e.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,r){var n;const i=this,s=null==(n=i[e])?void 0:n.store;return s!==t&&(t=Store.getStore(t,(null==t?void 0:t.storeClass)||r),s&&i.removeStore(s),i[e]=t&&{store:t}||null,i.addPrioritizedStore(i[e])),i[e]}getChangesetPackage(){const e=super.getChangesetPackage();return e&&this.eventStore.usesSingleAssignment&&(delete e[this.assignmentStore.storeId],!this.crudStores.some((t=>e[t.storeId])))?null:e}get crudLoadValidationMandatoryStores(){return[this._eventStore.storeId,this._resourceStore.storeId]}};__publicField(CrudManager,"$name","CrudManager"),CrudManager._$name="CrudManager";var ViewPreset=class extends Model{static get fields(){return[{name:"base",type:"string"},{name:"name",type:"string"},{name:"rowHeight",defaultValue:24},{name:"tickWidth",defaultValue:50},{name:"tickHeight",defaultValue:50},{name:"displayDateFormat",defaultValue:"HH:mm"},{name:"shiftUnit",defaultValue:"hour"},{name:"shiftIncrement",defaultValue:1},{name:"defaultSpan",defaultValue:12},{name:"mainUnit"},{name:"start"},"timeResolution","headers","mainHeaderLevel","columnLinesFor"]}construct(){super.construct(...arguments),this.normalizeUnits()}generateId(e){const t=this,{headers:r}=t,n=[];let i=Object.getPrototypeOf(t.data).id;if(!i){for(let{length:e}=r,t=e-1;t>=0;t--){const{unit:e,increment:i}=r[t],s=i>1;n.push(""+(s?i:"")+(t?e:StringHelper.capitalize(e))+(s?"s":""))}i=n.join("And")}return e.count&&e.includes(i)&&(i+="-"+t.tickWidth+"by"+(t.tickHeight||t.tickWidth),e.includes(i)&&(i+="-"+t.bottomHeader.increment,e.includes(i)&&(i=IdHelper.generateId(i+"-")))),i}normalizeUnits(){const e=this,{timeResolution:t,headers:r,shiftUnit:n}=e;if(r)for(let e=0,{length:t}=r;e<t;e++){const t=r[e];t.unit=DateHelper.normalizeUnit(t.unit),t.splitUnit&&(t.splitUnit=DateHelper.normalizeUnit(t.splitUnit)),"increment"in t||(r[e]=Object.assign({increment:1},t))}t&&(t.unit=DateHelper.normalizeUnit(t.unit)),n&&(e.shiftUnit=DateHelper.normalizeUnit(n))}static normalizeHeaderConfig(e){const{headerConfig:t,columnLinesFor:r,mainHeaderLevel:n}=e,i=e.headers=[];if(t.top&&("top"===r&&(e.columnLinesFor=0),"top"===n&&(e.mainHeaderLevel=0),i[0]=t.top),!t.middle)throw new Error("ViewPreset.headerConfig must be configured with a middle");"middle"===r&&(e.columnLinesFor=i.length),"middle"===n&&(e.mainHeaderLevel=i.length),i.push(t.middle),t.bottom&&(e.mainHeaderLevel=i.length-1,null==r?e.columnLinesFor=i.length-1:"bottom"===r&&(e.columnLinesFor=i.length),null==n&&(e.mainHeaderLevel=i.length-1),"bottom"===n&&(e.mainHeaderLevel=i.length),i.push(t.bottom))}set(){}inSet(){}get columnLinesFor(){return"columnLinesFor"in this.data?this.data.columnLinesFor:this.headers.length-1}get tickSize(){return this._tickSize||this.tickWidth}get tickWidth(){return"tickWidth"in this.data?this.data.tickWidth:50}get tickHeight(){return"tickHeight"in this.data?this.data.tickHeight:50}get headerConfig(){if(this.data.headerConfig)return this.data.headerConfig;const e={},{headers:t}=this,{length:r}=t;switch(r){case 1:e.middle=t[0];break;case 2:0===this.mainHeaderLevel?(e.middle=t[0],e.bottom=t[1]):(e.top=t[0],e.middle=t[1]);break;case 3:e.top=t[0],e.middle=t[1],e.bottom=t[2];break;default:throw new Error("headerConfig object not supported for >3 header levels")}return e}set mainHeaderLevel(e){this.data.mainHeaderLevel=e}get mainHeaderLevel(){return"mainHeaderLevel"in this.data?this.data.mainHeaderLevel:3===this.data.headers.length?1:this.headers.length-1}get mainHeader(){return this.headers[this.mainHeaderLevel]}get bottomHeader(){return this.headers[this.headers.length-1]}get leafUnit(){return this.bottomHeader.unit}get leafIncrement(){return this.bottomHeader.increment}get mainUnit(){return"mainUnit"in this.data?this.data.mainUnit:this.mainHeader.unit}get msPerPixel(){const{bottomHeader:e}=this;return Math.round(DateHelper.asMilliseconds(e.increment||1,e.unit)/this.tickWidth)}get isValid(){const e=this;let t=!0;for(const r of e.headers)t=t&&Boolean(DateHelper.normalizeUnit(r.unit));return e.timeResolution&&(t=t&&DateHelper.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(t=t&&DateHelper.normalizeUnit(e.shiftUnit)),t}};__publicField(ViewPreset,"$name","ViewPreset"),ViewPreset._$name="ViewPreset";var locale4={localeName:"Ch",localeDesc:"中文",localeCode:"ch",Object:{newEvent:"新建事件"},ResourceInfoColumn:{eventCountText:e=>e+" event"+(1!==e?"s":"")},Dependencies:{from:"从",to:"到",valid:"有效",invalid:"无效"},DependencyType:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"开始 - 开始",StartToEnd:"开始 - 结束",EndToStart:"结束 - 开始",EndToEnd:"结束 - 结束",short:["SS","SF","FS","FF"],long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},DependencyEdit:{From:"从",To:"到",Type:"类型",Lag:"延后","Edit dependency":"编辑依赖关系",Save:"保存",Delete:"删除",Cancel:"取消",StartToStart:"开始 - 开始",StartToEnd:"开始 - 结束",EndToStart:"结束 - 开始",EndToEnd:"结束 - 结束"},EventEdit:{Name:"名称",Resource:"资源",Start:"开始",End:"结束",Save:"保存",Delete:"删除",Cancel:"取消","Edit event":"编辑事件",Repeat:"重复"},EventDrag:{eventOverlapsExisting:"此事件与资源重复",noDropOutsideTimeline:"时间线之外不允许删除事件"},SchedulerBase:{"Add event":"新建事件","Delete event":"删除事件","Unassign event":"取消分配事件"},TimeAxisHeaderMenu:{pickZoomLevel:"缩放",activeDateRange:"日期范围",startText:"开始日期",endText:"结束日期",todayText:"Today"},EventCopyPaste:{copyEvent:"复制事件",cutEvent:"剪切事件",pasteEvent:"粘贴事件"},EventFilter:{filterEvents:"筛选任务",byName:"根据名称"},TimeRanges:{showCurrentTimeLine:"显示当前时间线"},PresetManager:{secondAndMinute:{displayDateFormat:"ll LTS",name:"Seconds"},minuteAndHour:{topDateFormat:"ddd MM/DD, hA",displayDateFormat:"ll LST"},hourAndDay:{topDateFormat:"ddd MM/DD",middleDateFormat:"LST",displayDateFormat:"ll LST",name:"Day"},day:{name:"Day/hours"},week:{name:"Week/hours"},dayAndWeek:{displayDateFormat:"ll LST",name:"Week/days"},dayAndMonth:{name:"Month"},weekAndDay:{displayDateFormat:"ll LST",name:"Week"},weekAndMonth:{name:"Weeks"},weekAndDayLetter:{name:"Weeks/weekdays"},weekDateAndMonth:{name:"Months/weeks"},monthAndYear:{name:"Months"},year:{name:"Years"},manyYears:{name:"Multiple years"}},RecurrenceConfirmationPopup:{"delete-title":"You are deleting an event","delete-all-message":"Do you want to delete all occurrences of this event?","delete-further-message":"Do you want to delete this and all future occurrences of this event, or only the selected occurrence?","delete-further-btn-text":"Delete All Future Events","delete-only-this-btn-text":"Delete Only This Event","update-title":"You are changing a repeating event","update-all-message":"Do you want to change all occurrences of this event?","update-further-message":"Do you want to change only this occurrence of the event, or this and all future occurrences?","update-further-btn-text":"All Future Events","update-only-this-btn-text":"Only This Event",Yes:"Yes",Cancel:"Cancel",width:600},RecurrenceLegend:{" and ":" and ",Daily:"Daily","Weekly on {1}":({days:e})=>"Weekly on "+e,"Monthly on {1}":({days:e})=>"Monthly on "+e,"Yearly on {1} of {2}":({days:e,months:t})=>"Yearly on "+e+" of "+t,"Every {0} days":({interval:e})=>"Every "+e+" days","Every {0} weeks on {1}":({interval:e,days:t})=>"Every "+e+" weeks on "+t,"Every {0} months on {1}":({interval:e,days:t})=>"Every "+e+" months on "+t,"Every {0} years on {1} of {2}":({interval:e,days:t,months:r})=>"Every "+e+" years on "+t+" of "+r,position1:"the first",position2:"the second",position3:"the third",position4:"the fourth",position5:"the fifth","position-1":"the last",day:"day",weekday:"weekday","weekend day":"weekend day",daysFormat:({position:e,days:t})=>e+" "+t},RecurrenceEditor:{"Repeat event":"Repeat event",Cancel:"Cancel",Save:"Save",Frequency:"Frequency",Every:"Every",DAILYintervalUnit:"day(s)",WEEKLYintervalUnit:"week(s)",MONTHLYintervalUnit:"month(s)",YEARLYintervalUnit:"year(s)",Each:"Each","On the":"On the","End repeat":"End repeat","time(s)":"time(s)"},RecurrenceDaysCombo:{day:"day",weekday:"weekday","weekend day":"weekend day"},RecurrencePositionsCombo:{position1:"first",position2:"second",position3:"third",position4:"fourth",position5:"fifth","position-1":"last"},RecurrenceStopConditionCombo:{Never:"Never",After:"After","On date":"On date"},RecurrenceFrequencyCombo:{None:"No repeat",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly",Yearly:"Yearly"},RecurrenceCombo:{None:"None",Custom:"Custom..."},Summary:{"Summary for":e=>"Summary for "+e},ScheduleRangeCombo:{completeview:"Complete schedule",currentview:"Visible schedule",daterange:"日期范围",completedata:"Complete schedule (for all events)"},SchedulerExportDialog:{"Schedule range":"Schedule range","Export from":"From","Export to":"To"},ExcelExporter:{"No resource assigned":"No resource assigned"},CrudManagerView:{serverResponseLabel:"Server response:"},DurationColumn:{Duration:"Duration"}},En_default3=LocaleHelper.publishLocale(locale4),PresetStore=class extends(Localizable_default(Store)){static get $name(){return"PresetStore"}static get defaultConfig(){return{useRawData:!0,modelClass:ViewPreset,zoomOrder:1}}set storage(e){super.storage=e,this.storage.addSorter(((e,t)=>{const r=e.bottomHeader,n=t.bottomHeader;return(t.msPerPixel-e.msPerPixel||unitMagnitudes[r.unit]-unitMagnitudes[n.unit]||r.increment-n.increment)*this.zoomOrder}))}get storage(){return super.storage}getById(e){return super.getById(e)||!this.isPresetManager&&pm.getById(e)}createRecord(e,...t){let r;if(e.isViewPreset)return e;if("string"==typeof e)r=this.getById(e);else{if("number"!=typeof e)return e.base&&(e=this.copyBaseValues(e)),super.createRecord(e,...t);r=this.getAt(e)}if(!r)throw new Error("ViewPreset "+e+" does not exist");return r}updateLocalization(){super.updateLocalization();const e=this;let t=e.allRecords;e.isPresetManager&&(t=new Set(t.concat(Object.values(e.basePresets)))),t.forEach((t=>{let r=e.optionalL("L{PresetManager."+t.id+"}",null,!0);"string"==typeof r&&t.baseId&&(r=e.optionalL("L{PresetManager."+t.baseId+"}",null,!0)),r&&"object"==typeof r&&(t.originalDisplayDateFormat||(t.originalDisplayDateFormat=t.displayDateFormat),0===t.mainHeaderLevel&&r.topDateFormat&&(r.middleDateFormat=r.middleDateFormat||r.topDateFormat),t.setData("displayDateFormat",r.displayDateFormat||t.originalDisplayDateFormat),["top","middle","bottom"].forEach((e=>{const n=t.headerConfig[e],i=r[e+"DateFormat"];n&&(n.originalDateFormat||(n.originalDateFormat=n.dateFormat),i&&n.renderer&&(n.renderer=null),n.dateFormat=i||n.originalDateFormat)})),r.name?(t.unlocalizedName||(t.unlocalizedName=t.name),t.setData("name",r.name)):t.unlocalizedName&&t.unlocalizedName!==t.name&&(t.name=t.unlocalizedName,t.unlocalizedName=null))}))}getCurrentConfig(e){return super.getCurrentConfig(e).data}copyBaseValues(e){let t=this.getById(e.base);if(!t)throw new Error('视图预设 "'+e.base+'" 不存在');return t=ObjectHelper.clone(t.data),delete t.id,delete t.name,ObjectHelper.merge(t,e)}add(e){return(e=Array.isArray(e)?e:[e]).forEach((e=>{e.isViewPreset&&e.base&&(e.data=this.copyBaseValues(e.originalData))})),super.add(...arguments)}};PresetStore._$name="PresetStore";var PresetManager=class extends PresetStore{static get $name(){return"PresetManager"}static get defaultConfig(){return{preventSubClassingModel:!0,basePresets:{secondAndMinute:{name:"Seconds",tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headers:[{unit:"minute",dateFormat:"lll"},{unit:"second",increment:10,dateFormat:"ss"}]},minuteAndHour:{name:"Minutes",tickWidth:60,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:15},headers:[{unit:"hour",dateFormat:"ddd MM/DD, hA"},{unit:"minute",increment:30,dateFormat:"mm"}]},hourAndDay:{name:"Day",tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headers:[{unit:"day",dateFormat:"ddd DD/MM"},{unit:"hour",dateFormat:"LT"}]},day:{name:"Day/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"},{unit:"hour",renderer:e=>'<div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">'+DateHelper.format(e,"HH")+'</span><span class="b-sch-calendarcolumn-minutes">'+DateHelper.format(e,"mm")+"</span></div>\n"}]},week:{name:"Week/hours",displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"D d",splitUnit:"day"},{unit:"hour",dateFormat:"LT",renderer:e=>'\n<div class="sch-calendarcolumn-ct">\n<span class="sch-calendarcolumn-hours">'+DateHelper.format(e,"HH")+'</span><span class="sch-calendarcolumn-minutes">'+DateHelper.format(e,"mm")+"</span>\n</div>\n"}]},dayAndWeek:{name:"Days & Weeks",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headers:[{unit:"week",renderer:e=>DateHelper.getShortNameOfUnit("week")+"."+DateHelper.format(e,"WW MMM YYYY")},{unit:"day",dateFormat:"dd DD"}]},dayAndMonth:{name:"Month",tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"month",shiftIncrement:1,defaultSpan:1,mainUnit:"month",timeResolution:{unit:"hour",increment:1},headers:[{unit:"month",dateFormat:"MMMM YYYY"},{unit:"day",dateFormat:"DD"}]},weekAndDay:{name:"Week",tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY MMMM DD"},{unit:"day",increment:1,dateFormat:"DD MMM"}]},weekAndMonth:{name:"Weeks",tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"MMM YYYY"},{unit:"week",dateFormat:"DD MMM"}]},weekAndDayLetter:{name:"Weeks/weekdays",tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},mainHeaderLevel:0,headers:[{unit:"week",dateFormat:"YYYY-MM-DD",verticalColumnWidth:115},{unit:"day",dateFormat:"d1",verticalColumnWidth:25}]},weekDateAndMonth:{name:"Months/weeks",tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headers:[{unit:"month",dateFormat:"YYYY MMMM"},{unit:"week",dateFormat:"DD"}]},monthAndYear:{name:"Months",tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"month",dateFormat:"MMM YYYY"}]},year:{name:"Years",tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headers:[{unit:"year",dateFormat:"YYYY"},{unit:"quarter",renderer:(e,t,r)=>DateHelper.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)}]},manyYears:{name:"Multiple years",tickWidth:40,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"year",increment:1},mainHeaderLevel:0,headers:[{unit:"year",increment:5,renderer:(e,t)=>e.getFullYear()+" - "+t.getFullYear()},{unit:"year",dateFormat:"YY",increment:1}]}},defaultPresets:["manyYears",{width:80,increment:1,resolution:1,base:"manyYears",resolutionUnit:"YEAR"},"year",{width:30,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,base:"year",resolutionUnit:"MONTH"},"monthAndYear","weekDateAndMonth","weekAndMonth","weekAndDayLetter","dayAndMonth","weekAndDay",{width:54,increment:1,resolution:1,base:"weekAndDay",resolutionUnit:"HOUR"},"hourAndDay",{width:64,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,base:"hourAndDay",resolutionUnit:"MINUTE"},"minuteAndHour",{width:60,increment:15,resolution:5,base:"minuteAndHour"},{width:130,increment:15,resolution:5,base:"minuteAndHour"},{width:60,increment:5,resolution:5,base:"minuteAndHour"},{width:100,increment:5,resolution:5,base:"minuteAndHour"},"secondAndMinute",{width:60,increment:10,resolution:5,base:"secondAndMinute"},{width:130,increment:5,resolution:5,base:"secondAndMinute"}],internalListeners:{locale:"updateLocalization"}}}set basePresets(e){const t=this._basePresets={};for(const r in e)e[r].id=r,t[r]=this.createRecord(e[r])}get basePresets(){return this._basePresets}set defaultPresets(e){for(let t=0,{length:r}=e;t<r;t++){const r=e[t],n="string"==typeof r,i=n?r:r.base;let s;if(n)s=this.basePresets[i];else{const e=Object.setPrototypeOf(ObjectHelper.clone(this.basePresets[i].data),{id:i}),{timeResolution:t}=e,n=e.headers[e.headers.length-1];e.id=void 0,"width"in r&&(e.tickWidth=r.width),"height"in r&&(e.tickHeight=r.height),"increment"in r&&(n.increment=r.increment),"resolution"in r&&(t.increment=r.resolution),"resolutionUnit"in r&&(t.unit=DateHelper.getUnitByName(r.resolutionUnit)),s=this.createRecord(e),s.baseId=i}this.add(s)}}getById(e){return super.getById(e)||this.basePresets[e]}registerPreset(e,t){const r=this.createRecord(Object.assign({id:e},t)),n=this.find((e=>e.equals(r)));if(n)return n;if(!r.isValid)throw new Error("Invalid preset, please check your configuration");return this.add(r),r}getPreset(e){return"number"==typeof e&&(e=this.getAt(e)),"string"==typeof e?e=this.getById(e):e instanceof ViewPreset||(e=this.createRecord(e)),e}normalizePreset(e){const t=this;if(!(e instanceof ViewPreset))if("string"==typeof e){if(!(e=t.getPreset(e)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else if("object"==typeof e){if(e.base){const t=this.getById(e.base);if(!t)throw new Error("视图预设基础 "+e.base+"不存在");e=ObjectHelper.merge(ObjectHelper.clone(t.data),e)}e.id?e=t.createRecord(e):(e=t.createRecord(ObjectHelper.assign({},e))).id=e.generateId(e)}return e}deletePreset(e){"string"==typeof e?e=this.getById(e):"number"==typeof e&&(e=this.getAt(e)),e&&(this.remove(e),delete this.basePresets[e.id])}},pm=new PresetManager,Tick=class extends TimeSpan{get startDate(){return this.data.startDate}get endDate(){return this.data.endDate}},TimeAxis=class extends Store{static get defaultConfig(){return{modelClass:Tick,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,tickCache:{},viewPreset:null,maxTraverseTries:100,useRawData:{disableDuplicateIdCheck:!0,disableDefaultValue:!0,disableTypeConversion:!0}}}static get configurable(){return{generateTicks:null,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,defaultSpan:1,weekStartDay:null,forceFullTicks:null}}construct(e){const t=this;if(super.construct(e),t.originalContinuous=t.continuous,t.ion({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}get isTimeAxis(){return!0}reconfigure(e,t=!1,r=!1){const n=this,i=n.getAdjustedDates(e.startDate,e.endDate),s={};if(!1!==n.trigger("beforeReconfigure",{startDate:i.startDate,endDate:i.endDate,config:e})){n.trigger("beginReconfigure"),n._configuredStartDate=e.startDate,n._configuredEndDate=e.endDate;for(const t in e)s[t]=n[t];const i=e.viewPreset&&e.viewPreset!==n.viewPreset;if(i&&(r=n.isFiltered,n.filters.forEach((e=>e.disabled=!1))),Object.assign(n,e),!1===n.internalOnReconfigure(r,i))return!1;n.trigger("endReconfigure",{suppressRefresh:t,config:e,oldConfig:s})}}internalOnReconfigure(e=!1,t){const r=this;r.isConfigured=!0;const n=r.getAdjustedDates(r.startDate,r.endDate,!0),i=r.getAdjustedDates(r.startDate,r.endDate),s=i.startDate,a=i.endDate;if(s>=a)throw new Error("无效的开始/结束日期。开始日期必须小于结束日期, 开始日期 "+s+"。 结束日期: "+a+".");const{unit:o,increment:l=1}=r,c=r.generateTicks(s,a,o,l);r.suspendEvents(),r.maintainFilter=e,r.data=c,r.maintainFilter=!1;const{count:d}=r;if(0===d){if(e)return t&&r.disableFilters(),r.resumeEvents(),!1;throw new Error("时间轴配置或筛选器无效，请检查您的输入数据")}r.startDate=r.first.startDate,r.endDate=r.last.endDate,r.resumeEvents(),r.isContinuous?(r.adjustedStart=n.startDate,r.adjustedEnd=DateHelper.getNext(d>1?c[d-1].startDate:n.startDate,o,l,r.weekStartDay)):(r.adjustedStart=r.startDate,r.adjustedEnd=r.endDate),r.updateVisibleTickBoundaries(),r.updateTickCache(!0)}updateVisibleTickBoundaries(){const e=this,{count:t,unit:r,startDate:n,endDate:i,weekStartDay:s,increment:a=1}=e,o=DateHelper.getNormalizedUnitDuration(n,r)*a,l=DateHelper.getNormalizedUnitDuration(i,r)*a;do{e.visibleTickStart=(n-e.adjustedStart)/o,e.autoAdjust&&(e.visibleTickStart=Math.floor(e.visibleTickStart)),e.visibleTickStart>=1&&(e.adjustedStart=DateHelper.getNext(e.adjustedStart,r,a,s))}while(e.visibleTickStart>=1);do{e.visibleTickEnd=t-(e.adjustedEnd-i)/l,t-e.visibleTickEnd>=1&&(e.adjustedEnd=DateHelper.getNext(e.adjustedEnd,r,-1,s))}while(t-e.visibleTickEnd>=1);e.fullTicks=!e.visibleTickStart&&e.visibleTickEnd===t}get viewPreset(){return this._viewPreset}set viewPreset(e){if(!((e=pm.getPreset(e))instanceof ViewPreset))throw new Error("TimeAxis must be configured with the ViewPreset instance that the Scheduler is using");this._viewPreset=e,Object.assign(this,{unit:e.bottomHeader.unit,increment:e.bottomHeader.increment||1,resolutionUnit:e.timeResolution.unit,resolutionIncrement:e.timeResolution.increment,mainUnit:e.mainHeader.unit,shiftUnit:e.shiftUnit||e.mainHeader.unit,shiftIncrement:e.shiftIncrement||1,defaultSpan:e.defaultSpan||1,presetName:e.id,headers:e.headers})}get weekStartDay(){var e;return null!=(e=this._weekStartDay)?e:DateHelper.weekStartDay}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this.forceFullTicks?this.unit:this._resolutionUnit}get resolutionIncrement(){return this.forceFullTicks?this.increment:this._resolutionIncrement}setTimeSpan(e,t,r=!1){t&&e-t==0&&(t=null);const n=this,{startDate:i,endDate:s}=n.getAdjustedDates(e,t);if(n.startDate-i!=0||n.endDate-s!=0)return n.reconfigure({startDate:i,endDate:s},!1,r)}shift(e,t=this.shiftUnit){const r=this;let{startDate:n,endDate:i}=r;r.isFiltered&&(n=r.allRecords[0].startDate,i=r.allRecords[r.allCount-1].endDate);let s=0;do{n=DateHelper.add(n,e,t),i=DateHelper.add(i,e,t)}while(s++<r.maxTraverseTries&&!1===r.setTimeSpan(n,i,{preventThrow:!0}))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){this.filters.clear(),super.filterBy(((r,n)=>e.call(t,r.data,n)))}filter(){const e=this,t=super.filter(...arguments);return e.maintainFilter||0!==e.count||(e.resumeEvents(),e.trigger("invalidFilter"),e.disableFilters()),t}disableFilters(){this.filters.forEach((e=>e.disabled=!0)),this.filter()}triggerFilterEvent(e){const t=this;e.filters.count?t.continuous=!1:t.continuous=t.originalContinuous,t.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.isFiltered}getAdjustedDates(e,t,r=!1){const n=this;return t&&e-t==0&&(t=null),e=e||n.startDate,t=t||DateHelper.add(e,n.defaultSpan,n.mainUnit),n.autoAdjust||r?{startDate:n.floorDate(e,!1,n.autoAdjust?n.mainUnit:n.unit,1),endDate:n.ceilDate(t,!1,n.autoAdjust?n.mainUnit:n.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=DateHelper.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=DateHelper.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,r,n){const i=this,s=(t=!1!==t)?DateHelper.clone(i.startDate):null,a=n||i.resolutionIncrement,o=r||(t?i.resolutionUnit:i.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(DateHelper.diff(s,e,o),a);return DateHelper.add(s,t,o,!1)}const c=DateHelper.clone(e);if("week"===o){const e=c.getDay()||7,t=i.weekStartDay||7;DateHelper.add(DateHelper.startOf(c,"day",!1),e>=t?t-e:-(7-t+e),"day",!1),c.getDay()!==t&&23===c.getHours()&&DateHelper.add(c,1,"hour",!1)}else{DateHelper.startOf(c,o,!1);const e=["day","year"].includes(o)?1:0,t="day"===o?"date":o,r=l(DateHelper.get(c,t)-e,a)+e;DateHelper.set(c,t,r)}return c}roundDate(e,t,r=this.resolutionUnit,n=this.resolutionIncrement||1){const i=this,s=DateHelper.clone(e);switch(t=DateHelper.clone(t||i.startDate),r){case"week":{DateHelper.startOf(s,"day",!1);let e,t=s.getDay()-i.weekStartDay;return t<0&&(t=7+t),e=1===Math.round(t/7)?7-t:-t,DateHelper.add(s,e,"day",!1)}case"month":{const e=DateHelper.diff(t,s,"month")+DateHelper.as("month",s.getDay()/DateHelper.daysInMonth(s)),r=Math.round(e/n)*n;return DateHelper.add(t,r,"month",!1)}case"quarter":return DateHelper.startOf(s,"month",!1),DateHelper.add(s,3-s.getMonth()%3,"month",!1);default:{const e=DateHelper.as(r,DateHelper.diff(t,s)),i=DateHelper.as(r,t.getTimezoneOffset()-s.getTimezoneOffset(),"minute"),a=Math.round((e+i)/n)*n;return DateHelper.add(t,a-i,r,!1)}}}ceilDate(e,t,r,n){const i=this;t=!1!==t,n=n||(t?i.resolutionIncrement:1);const s=r||(t?i.resolutionUnit:i.mainUnit),a=DateHelper.clone(e);let o=!1;switch(s){case"minute":o=!DateHelper.isStartOf(a,"minute");break;case"hour":o=!DateHelper.isStartOf(a,"hour");break;case"day":case"date":o=!DateHelper.isStartOf(a,"day");break;case"week":DateHelper.startOf(a,"day",!1),o=a.getDay()!==i.weekStartDay||!DateHelper.isEqual(a,e);break;case"month":DateHelper.startOf(a,"day",!1),o=1!==a.getDate()||!DateHelper.isEqual(a,e);break;case"quarter":DateHelper.startOf(a,"day",!1),o=a.getMonth()%3!=0||1!==a.getDate()||!DateHelper.isEqual(a,e);break;case"year":DateHelper.startOf(a,"day",!1),o=0!==a.getMonth()||1!==a.getDate()||!DateHelper.isEqual(a,e)}return o?DateHelper.getNext(a,s,n,i.weekStartDay):a}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,r){const{include:n}=this;return!!n&&Object.entries(n).some((([n,i])=>{if(!i)return!1;const{from:s,to:a}=i;if(DateHelper.compareUnits("day",r)>=0&&DateHelper.getLargerUnit(n)===r&&(s&&DateHelper.set(e,n,s),a)){let e=r;"day"===r&&(e="date"),DateHelper.set(t,{[e]:DateHelper.get(t,e)-1,[n]:a})}if(DateHelper.compareUnits(n,r)>=0){const t="day"===n?e.getDay():DateHelper.get(e,n);if(s&&t<s||a&&t>=a)return!0}}))}initExclusion(){Object.entries(this.include).forEach((([e,t])=>{if(t){const{from:r,to:n}=t;t.lengthFactor=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r),t.lengthFactorExcl=DateHelper.getUnitToBaseUnitRatio(e,DateHelper.getLargerUnit(e))/(n-r-1),t.center=r+r/(t.lengthFactor-1)}}))}updateGenerateTicks(){this.isConfiguring||this.reconfigure(this)}_generateTicks(e,t,r=this.unit,n=this.increment){const i=this,s=[],a=Boolean(i.include);let o,l,c,d=0,{startDate:u,endDate:h}=i.getAdjustedDates(e,t);for(i.tickCache={},a&&i.initExclusion();u<h;){if(o=DateHelper.getNext(u,r,n,i.weekStartDay),!i.autoAdjust&&o>h&&(o=h),"hour"===r&&n>1&&s.length>0&&0===d){const e=s[s.length-1];d=(e.startDate.getHours()+n)%24-e.endDate.getHours(),0!==d&&(o=DateHelper.add(o,d,"hour"))}c=!1,a?(l=new Date(o.getTime()),c=i.processExclusion(u,o,r)):l=o,c||(s.push({id:s.length+1,startDate:u,endDate:o}),i.tickCache[u.getTime()]=s.length-1),u=l}return s}get visibleTickTimeSpan(){const e=this;return e.isContinuous?e.visibleTickEnd-e.visibleTickStart:e.count}getTickFromDate(e){var t,r;const n=this,i=n.records,s=null!=(r=null==(t=e.getTime)?void 0:t.call(e))?r:e;let a,o,l,c,d=0,u=i.length-1;if(!i.length||s<i[0].startDateMS||s>i[u].endDateMS)return-1;if(n.isContinuous){for(;d<u;)a=d+u+1>>1,s>i[a].endDateMS?d=a+1:s<i[a].startDateMS?u=a-1:d=a;return o=i[d],l=o.startDateMS,s>l&&(c=o.endDateMS,d+=(s-l)/(c-l)),Math.min(Math.max(d,n.visibleTickStart),n.visibleTickEnd)}for(let e=0;e<=u;e++)if(c=i[e].endDateMS,s<=c)return l=i[e].startDateMS,o=e+(s>l?(s-l)/(c-l):0),o}getDateFromTick(e,t){const r=this;if(e===r.visibleTickEnd)return r.endDate;const n=Math.floor(e),i=e-n,s=r.getAt(n);if(!s)return null;const a=0===n?r.adjustedStart:s.startDate,o=n===r.count-1&&r.isContinuous?r.adjustedEnd:s.endDate;let l=DateHelper.add(a,i*(o-a),"millisecond");return t&&(l=r[t+"Date"](l)),l}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach(((e,r)=>t.tickCache[e.startDate.getTime()]=r)))}dateInAxis(e,t=!1){const r=this,n=r.startDate,i=r.endDate;if(r.isContinuous)return t?DateHelper.betweenLesserEqual(e,n,i):DateHelper.betweenLesser(e,n,i);{const n=r.getCount();let i,s,a;for(let o=0;o<n;o++)if(a=r.getAt(o),i=a.startDate,s=a.endDate,t&&e<=s||!t&&e<s)return e>=i}return!1}timeSpanInAxis(e,t){const r=this;return t&&t.getTime()!==e.getTime()?r.isContinuous?DateHelper.intersectSpans(e,t,r.startDate,r.endDate):e<r.startDate&&t>r.endDate||r.getTickFromDate(e)!==r.getTickFromDate(t):this.dateInAxis(e,!0)}isTimeSpanInAxis(e){const t=this,{startMS:r,endMS:n}=t,{startDateMS:i,endDateMS:s}=e;if(!i||!s)return!1;if(s===i)return t.dateInAxis(e.startDate,!0);if(t.isContinuous)return s>r&&i<n;const a=t.getTickFromDate(e.startDate),o=t.getTickFromDate(e.endDate);return!(a===t.count&&DateHelper.isEqual(e.startDate,t.last.endDate)||0===o&&DateHelper.isEqual(e.endDate,t.first.startDate))&&(i<r&&s>n||a!==o)}forEachAuxInterval(e,t=1,r,n=this){const i=this.endDate;let s,a=this.startDate,o=0;if(a>i)throw new Error("Invalid time axis configuration");for(;a<i;)s=DateHelper.min(DateHelper.getNext(a,e,t,this.weekStartDay),i),r.call(n,a,s,o,s>=i),a=s,o++}};TimeAxis._$name="TimeAxis";var RecurrenceLegend=class extends(Localizable_default()){static get $name(){return"RecurrenceLegend"}static get allDaysValueAsArray(){return["SU","MO","TU","WE","TH","FR","SA"]}static get allDaysValue(){return this.allDaysValueAsArray.join(",")}static get workingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>!DateHelper.nonWorkingDays[t])).join(",")}static get nonWorkingDaysValue(){return this.allDaysValueAsArray.filter(((e,t)=>DateHelper.nonWorkingDays[t])).join(",")}static getLegend(e,t){const r=this,{timeSpan:n,interval:i,days:s,monthDays:a,months:o,positions:l}=e,c=t||n.startDate,d={interval:i};let u;switch(e.frequency){case"DAILY":return 1===i?r.L("L{Daily}"):r.L("L{Every {0} days}",d);case"WEEKLY":return s&&s.length?d.days=r.getDaysLegend(s):c&&(d.days=DateHelper.getDayName(c.getDay())),r.L(1===i?"L{Weekly on {1}}":"L{Every {0} weeks on {1}}",d);case"MONTHLY":return s&&s.length&&l&&l.length?d.days=r.getDaysLegend(s,l):a&&a.length?(a.sort(((e,t)=>e-t)),d.days=r.arrayToText(a)):c&&(d.days=c.getDate()),r.L(1===i?"L{Monthly on {1}}":"L{Every {0} months on {1}}",d);case"YEARLY":return s&&s.length&&l&&l.length?d.days=r.getDaysLegend(s,l):d.days=c.getDate(),o&&o.length?(o.sort(((e,t)=>e-t)),u=o.length>2?e=>DateHelper.getMonthShortName(e-1):e=>DateHelper.getMonthName(e-1),d.months=r.arrayToText(o,u)):d.months=DateHelper.getMonthName(c.getMonth()),r.L(1===i?"L{Yearly on {1} of {2}}":"L{Every {0} years on {1} of {2}}",d)}}static getDaysLegend(e,t){const r=this,n={position:""};let i;if(t&&t.length&&(n.position=r.arrayToText(t,(e=>r.L("L{position"+e+"}")))),e.length)switch(e.sort(((e,t)=>RecurrenceDayRuleEncoder.decodeDay(e)[0]-RecurrenceDayRuleEncoder.decodeDay(t)[0])),e.join(",")){case r.allDaysValue:n.days=r.L("L{day}");break;case r.workingDaysValue:n.days=r.L("L{weekday}");break;case r.nonWorkingDaysValue:n.days=r.L("L{weekend day}");break;default:i=e.length>2?e=>DateHelper.getDayShortName(RecurrenceDayRuleEncoder.decodeDay(e)[0]):e=>DateHelper.getDayName(RecurrenceDayRuleEncoder.decodeDay(e)[0]),n.days=r.arrayToText(e,i)}return r.L("L{daysFormat}",n)}static arrayToText(e,t){return t&&(e=e.map(t)),e.join(", ").replace(/,(?=[^,]*$)/,this.L("L{ and }"))}};RecurrenceLegend._$name="RecurrenceLegend";var AttachToProjectMixin_default=e=>class extends e{static get $name(){return"AttachToProjectMixin"}async afterConstruct(){super.afterConstruct();const e=this,t=e.client||e.grid,{project:r}=t;t.projectSubscribers.push(e),r&&(e.attachToProject(r),e.attachToResourceStore(r.resourceStore),e.attachToEventStore(r.eventStore),e.attachToAssignmentStore(r.assignmentStore),e.attachToDependencyStore(r.dependencyStore),e.attachToCalendarManagerStore(r.calendarManagerStore))}attachToProject(e){this.detachListeners("project"),this._project=e}attachToEventStore(e){this.detachListeners("eventStore")}attachToResourceStore(e){this.detachListeners("resourceStore")}attachToAssignmentStore(e){this.detachListeners("assignmentStore")}attachToDependencyStore(e){this.detachListeners("dependencyStore")}attachToCalendarManagerStore(e){this.detachListeners("calendarManagerStore")}get project(){return this._project}get calendarManagerStore(){return this.project.calendarManagerStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}get eventStore(){return this.project.eventStore}get dependencyStore(){return this.project.dependencyStore}},engineStoreNames=["assignmentStore","dependencyStore","eventStore","resourceStore"],ProjectConsumer_default=e=>class extends(e||Base){static get $name(){return"ProjectConsumer"}static get declarable(){return["projectStores"]}static get configurable(){return{projectModelClass:ProjectModel,project:{},destroyStores:null,projectSubscribers:[]}}startConfigure(e){this.getConfig("project"),super.startConfigure(e)}changeProject(e,t){const r=this,{projectStoreNames:n,projectDataNames:i}=r.constructor;if(r.projectCallbacks=new Set,e){if(r.buildingProjectConfig=!0,!e.isModel){if(r.isConfiguring){r._project=e;const{crudManager:t}=r;if(t){const{isCrudManager:e}=t;for(const i of n)t[i]&&(r[i]=t[i],e||delete t[i])}r.getConfig("projectStores");for(const e of i)r.getConfig(e)}const{eventStore:t}=e;let{_sharedProject:s}=r;if(t&&!t.isEventStoreMixin&&t.autoLoad&&!t.count&&(t.autoLoad=!1,r.delayAutoLoad=!0),s&&engineStoreNames.some((t=>e[t]&&e[t]!==s[t]))){for(const t of engineStoreNames)e[t]&&e[t]===s[t]&&(e[t]=e[t].chain());s=null}e=s||new r.projectModelClass(e),delete r._project}r.buildingProjectConfig=!1}return e}updateProject(e,t){const r=this,{projectListeners:n,crudManager:i}=r;if(r.detachListeners("projectConsumer"),delete r._crudManager,e){n.thisObj=r,e.ion(n),e.isCrudManager?r.crudManager=e:i&&(i.project=e,r.crudManager=i),r.projectSubscribers.forEach((t=>t.attachToProject(e)));for(const t of r.constructor.projectStoreNames)r[t]=e[t];r.delayAutoLoad&&(e.eventStore.autoLoad=!0,e.eventStore.load())}r.trigger("projectChange",{project:e})}changeCrudManager(e){if(!this.buildingProjectConfig)return super.changeCrudManager(e);this._crudManager=e.isCrudManager?e:Object.assign({},e)}onProjectDataReady(){const e=this;e.whenVisible((()=>{e.projectCallbacks.size&&(e.projectCallbacks.forEach((e=>e())),e.projectCallbacks.clear())}),null,null,"onProjectDataReady")}onTimeZoneChange({timeZone:e,oldTimeZone:t}){const r=this;if(r.startDate&&r.timeAxis.timeZone!==e){const n=t?TimeZoneHelper.fromTimeZone(r.startDate,t):r.startDate;r.startDate=e?TimeZoneHelper.toTimeZone(n,e):n,r.timeAxis.timeZone=e}}whenProjectReady(e){this.isEngineReady?e():this.projectCallbacks.add(e)}get isEngineReady(){var e,t;return Boolean(null==(t=(e=this.project).isEngineReady)?void 0:t.call(e))}doDestroy(){super.doDestroy(),this.destroyStores&&!this.project.isDestroyed&&this.project.destroy()}get projectStores(){const{projectStoreNames:e}=this.constructor;return e.map((e=>this[e]))}static get projectStoreNames(){return Object.keys(this.projectStores)}static get projectDataNames(){return this.projectStoreNames.reduce(((e,t)=>{const{dataName:r}=this.projectStores[t];return r&&e.push(r),e}),[])}static setupProjectStores(e,t){const{projectStores:r}=e;if(r){const e={name:"projectConsumer",dataReady:"onProjectDataReady",change:"relayProjectDataChange",timeZoneChange:"onTimeZoneChange"},n={projectListeners:e};let i;for(const s in r){const{dataName:a}=r[s];n[s]=n[a]=null,a&&(Object.defineProperty(t.class.prototype,a,{configurable:!0,get(){var e;return null==(e=this.project[s])?void 0:e.records}}),this.createDataUpdater(s,a,i,t)),this.createStoreDescriptor(t,s,r[s],e),i=a}this.setupConfigs(t,n)}}static createDataUpdater(e,t,r,n){n.class.prototype["update"+StringHelper.capitalize(t)]=function(n){const{project:i}=this;r&&this.getConfig(r),this.buildingProjectConfig?i[t+"Data"]=n:i[e].data=n}}static createStoreDescriptor(e,t,{listeners:r},n){const{prototype:i}=e.class,s=StringHelper.capitalize(t);n[t+"Change"]=function({store:e}){this[t]=e},i["change"+s]=function(e,n){const i=this,{project:a}=i,o=null==e?void 0:e.project;return i.buildingProjectConfig?((null==o?void 0:o.isProjectModel)&&(i._sharedProject=o),void(a[t]=e)):(i.initializingProject||a[t]!==e&&(a["set"+s](e),e=a[t]),e!==n&&(r&&(r.thisObj=i,r.name=t+"Listeners",i.detachListeners(r.name),e.ion(r)),i["_"+t]=e,i.projectSubscribers.forEach((t=>{var r;null==(r=t["attachTo"+s])||r.call(t,e)})),i["_"+t]=null),e)}}relayProjectDataChange(e){if(!e.isExpand&&!e.isCollapse||e.records[0].fieldMap.expanded.persist)return this.trigger("dataChange",{project:e.source,...e,source:this})}get widgetClass(){}},HorizontalLayout=class extends Base{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}applyLayout(e,t){return this.nbrOfBandsByResource[t.id]=this.layoutEventsInBands(e,t)}layoutEventsInBands(e,t){throw new Error("Implement in subclass")}};HorizontalLayout._$name="HorizontalLayout";var PackMixin_default=e=>class extends(e||Base){static get $name(){return"PackMixin"}static get defaultConfig(){return{coordProp:"top",sizeProp:"height",inBandCoordProp:"inBandTop",inBandSizeProp:"inBandHeight"}}isSameGroup(e,t){return!this.grouped||e.group===t.group}packEventsInBands(e,t){const r=this,{coordProp:n,sizeProp:i}=r;let s,a,o,l;for(let c=0,d=e.length;c<d;c++){if(a=e[c],s=r.findStartSlot(e,a),o=r.getCluster(e,c),o.length>1){for(a[n]=s.start,a[i]=s.end-s.start,l=1;l<o.length-1&&o[l+1].start-a.start==0;)l++;const t=r.findStartSlot(e,o[l]);t&&t.start<.8&&(o.length=l)}const d=o.length,u=(s.end-s.start)/d;for(l=0;l<d;l++)t(o[l],l,s,u);c+=d-1}return 1}findStartSlot(e,t){const{inBandSizeProp:r,inBandCoordProp:n,coordProp:i,sizeProp:s}=this,a=this.getPriorOverlappingEvents(e,t);let o;if(0===a.length)return{start:0,end:1};for(o=0;o<a.length;o++){const e=a[o],t=n in e?n:i,l=r in e?r:s;if(0===o&&e[t]>0)return{start:0,end:e[t]};if(e[t]+e[l]<(o<a.length-1?a[o+1][t]:1))return{start:e[t]+e[l],end:o<a.length-1?a[o+1][t]:1}}return!1}getPriorOverlappingEvents(e,t){const r=t.start,n=t.end,i=[];for(let s=0,a=e.indexOf(t);s<a;s++){const a=e[s];this.isSameGroup(a,t)&&DateHelper.intersectSpans(r,n,a.start,a.end)&&i.push(a)}return i.sort(this.sortOverlappers.bind(this)),i}sortOverlappers(e,t){const{coordProp:r}=this;return e[r]-t[r]}getCluster(e,t){const r=e[t],n=[r];if(t>=e.length-1)return n;let{start:i,end:s}=r;for(let a=t+1,o=e.length;a<o;a++){const t=e[a];if(!this.isSameGroup(t,r)||!DateHelper.intersectSpans(i,s,t.start,t.end))break;n.push(t),i=DateHelper.max(i,t.start),s=DateHelper.min(t.end,s)}return n}},HorizontalLayoutPack=class extends(HorizontalLayout.mixin(PackMixin_default)){static get $name(){return"HorizontalLayoutPack"}static get configurable(){return{type:"pack"}}layoutEventsInBands(e){const t=this.packEventsInBands(e,((e,t,r,n)=>{e.height=n,e.top=r.start+t*n}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),t}};HorizontalLayoutPack._$name="HorizontalLayoutPack";var HorizontalLayoutStack=class extends HorizontalLayout{static get $name(){return"HorizontalLayoutStack"}static get configurable(){return{type:"stack"}}layoutEventsInBands(e,t,r=!1){let n=0;do{let t=0,i=e[0];for(;i;)r||(i.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,n,i.eventRecord,i.resourceRecord)),e.splice(t,1),t=this.findClosestSuccessor(i,e),i=e[t];n++}while(e.length>0);return n}findClosestSuccessor(e,t){const{endMS:r,group:n}=e,i=e.eventRecord&&0===e.eventRecord.duration;let s,a,o,l=1/0;for(let e=0,c=t.length;e<c;e++)if(o=t[e],a=o.startMS-r,a>=0&&a<l&&(a>0||o.endMS-o.startMS>0||!i)){if(this.grouped&&n!==o.group)break;s=e,l=a}return s}};HorizontalLayoutStack._$name="HorizontalLayoutStack";var ClockTemplate=class extends Base{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,div:document.createElement("div"),scheduler:null,template(e){return'<div class="b-sch-clockwrap b-sch-clock-'+(e.mode||this.mode)+" "+(e.cls||"")+'"><span class="b-sch-clock-text">'+StringHelper.encodeHtml(("Y"==e.isDrag?"b-sch-tooltip-startdate"==e.cls?"计划开始日期：":"计划完成日期：":"")+DateHelper.format(e.date,"YYYY-MM-DD"))+"</span></div>"}}}generateContent(e){return this.div.innerHTML=this.template(e)}updateDateIndicator(e,t){const r=null==e?void 0:e.querySelector(".b-sch-hour-indicator"),n=null==e?void 0:e.querySelector(".b-sch-minute-indicator");t&&r&&n&&BrowserHelper.isBrowserEnv&&("hour"===this.mode?(r.style.transform="rotate("+t.getHours()%12*30+"deg)",n.style.transform="rotate("+6*t.getMinutes()+"deg)"):(r.style.transform="none",n.style.transform="none"))}set mode(e){this._mode=e}get mode(){if(this._mode)return this._mode;const e=DateHelper.compareUnits(this.scheduler.timeAxisViewModel.timeResolution.unit,"day")<0,t=DateHelper.formatContainsHourInfo(this.scheduler.displayDateFormat);return e&&t?"hour":"day"}set template(e){this._template=e}get template(){return this._template}};ClockTemplate._$name="ClockTemplate";var DragBase=class extends InstancePlugin{static get defaultConfig(){return{tooltipTemplate:e=>'<div class="b-sch-tip-'+(e.valid?"valid":"invalid")+'">'+e.startClockHtml+e.endClockHtml+'<div class="b-sch-tip-message">'+e.message+"</div>\n</div>\n",showTooltip:!0,showExactDropPosition:!1,store:null,dragHelperConfig:null,tooltipCls:"b-eventdrag-tooltip"}}static get configurable(){return{constrainDragToTimeline:!0,constrainDragToResource:!0,constrainDragToTimeSlot:!1,tip:{$config:["lazy","nullify"],value:{align:{align:"b-t",allowTargetOut:!0},autoShow:!0,updateContentOnMouseMove:!0}},throttleDragEvent:!0}}static get pluginConfig(){return{chain:["onPaint"]}}internalSnapToPosition(e){var t;const{dragData:r}=this;null==(t=this.snapToPosition)||t.call(this,{assignmentRecord:r.assignmentRecord,eventRecord:r.eventRecord,resourceRecord:r.newResource||r.resourceRecord,startDate:r.startDate,endDate:r.endDate,snapTo:e})}buildDragHelperConfig(){const e=this,{client:t,constrainDragToTimeline:r,constrainDragToResource:n,constrainDragToTimeSlot:i,dragHelperConfig:s={}}=e,{timeAxisViewModel:a,isHorizontal:o}=t,l=o?n:i,c=o?i:n;return e.externalDropTargetSelector&&(s.dropTargetSelector=".b-timeaxissubgrid,"+e.externalDropTargetSelector),Objects.merge({name:e.constructor.name,positioning:"absolute",lockX:c,lockY:l,minX:!0,maxX:!0,constrain:!1,cloneTarget:!r,removeProxyAfterDrop:!1,dragWithin:r?null:document.body,hideOriginalElement:!0,dropTargetSelector:".b-timelinebase",dropTargetCls:e.externalDropTargetSelector?"b-drop-target":"",outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,scrollManager:r?t.scrollManager:null,createProxy:t=>e.createProxy(t),snapCoordinates:({element:r,newX:n,newY:i})=>{const{dragData:s}=e;if(e.constrainDragToTimeline&&!e.constrainDragToTimeSlot&&(e.showExactDropPosition||a.snap)){const l=s.draggedEntities[0],c=e.getCoordinate(l,r,[n,i]),d=a.getDateFromPosition(c,"round"),{calendar:u}=l;if(!u||d&&u.isWorkingTime(d,DateHelper.add(d,l.fullDuration))){const e=d&&a.getPositionFromDate(d);d&&d>=t.startDate&&null!=e&&(o?n=e:i=e)}}const l={x:n,y:i};return e.internalSnapToPosition(l),l},internalListeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",afterdragstart:"onAfterDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",abortFinalized:"onDragAbortFinalized",reset:"onDragReset",thisObj:e}},s,{isElementDraggable:(t,r)=>(!s||!s.isElementDraggable||s.isElementDraggable(t,r))&&e.isElementDraggable(t,r)})}onPaint({firstPaint:e}){var t;const r=this,{client:n}=r;null==(t=r.drag)||t.destroy(),r.drag=DragHelper.new(r.buildDragHelperConfig()),e&&n.rowManager.ion({changeTotalHeight:()=>{var e;return r.updateYConstraint(null==(e=r.dragData)?void 0:e[n.scheduledEventName+"Record"])},thisObj:r}),r.showTooltip&&(r.clockTemplate=new ClockTemplate({scheduler:n}))}doDestroy(){var e,t,r;null==(e=this.drag)||e.destroy(),null==(t=this.clockTemplate)||t.destroy(),null==(r=this.tip)||r.destroy(),super.doDestroy()}get tipId(){return this.client.id+"-event-drag-tip"}changeTip(e,t){const r=this;if(e){const n=Tooltip.reconfigure(t,Tooltip.mergeConfigs({forElement:r.element,id:r.tipId,getHtml:r.getTipHtml.bind(r),cls:r.tooltipCls,owner:r.client},e),{owner:r.client,defaults:{type:"tooltip"}});return n.ion({innerHtmlUpdate:"updateDateIndicator",thisObj:r}),n}null==t||t.destroy()}createProxy(e){const t=e.cloneNode(!0);return delete t.id,t.classList.add("b-sch-"+this.client.mode),t}onBeforeDragStart({context:e,event:t}){var r;const n=this,{client:i}=n,s=n.getMinimalDragData(e,t),a=null==s?void 0:s[i.scheduledEventName+"Record"],o=s.resourceRecord;if(i.readOnly||n.disabled||!a||!1===a.isDraggable||a.readOnly||(null==o?void 0:o.readOnly))return!1;e.pointerStartDate=i.getDateFromXY([e.startClientX,e.startPageY],null,!1);const l=!1!==n.triggerBeforeEventDrag("before"+i.capitalizedEventName+"Drag",{...s,event:t,context:{...e,...s}});return l&&(n.updateYConstraint(a,o),null==(r=i["before"+i.capitalizedEventName+"DragStart"])||r.call(i,e,s)),l}onAfterDragStart({context:e,event:t}){}get isDragging(){var e;return null==(e=this.drag)?void 0:e.isDragging}get isActivelyDragging(){return this.isDragging&&!this.finalizing}onDragStart({context:e,event:t}){var r,n,i;const s=this,a=null!=(r=s.findClientFromTarget(t,e))?r:s.client;s.currentOverClient=a,s.drag.unifiedProxy=s.unifiedDrag,s.onMouseOverNewTimeline(a,!0);const o=s.dragData=s.getDragData(e);if(s.suspendElementRedrawing(e.element),s.showTooltip&&s.tip){const t=o.context.dragProxy?o.context.dragProxy.firstChild:e.element;s.tip.showBy(t)}s.triggerDragStart(o),null==(n=a["after"+a.capitalizedEventName+"DragStart"])||n.call(a,e,o);const{eventMenu:l,taskMenu:c}=a.features,d=l||c;null==(i=null==d?void 0:d.hideContextMenu)||i.call(d,!1)}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,{tip:r,clockTemplate:n}=this,i=r.element.querySelector(".b-sch-tooltip-enddate");n.updateDateIndicator(r.element,e),i&&n.updateDateIndicator(i,t)}findClientFromTarget(e,t){let{target:r}=e;if(/^touch/.test(e.type)){const e=Rectangle.from(t.element,null,!0).center;r=DomHelper.elementFromPoint(e.x,e.y)}const n=Widget.fromElement(r,"timelinebase");return(null==n?void 0:n.isResourceHistogram)?null:n}onDrag({context:e,event:t}){const r=this,n=r.dragData,i=n.startDate;let s;if(s=r.constrainDragToTimeline?r.client:r.findClientFromTarget(t,n.context),r.updateDragContext(e,t),s){if(s!==r.currentOverClient&&r.onMouseOverNewTimeline(s),n.dirty||!r.throttleDragEvent){const e=n.valid;r.triggerEventDrag(n,i),e!==n.valid&&(n.context.valid=n.externalDragValidity=n.valid)}r.showTooltip&&r.tip&&(r.tip.lastAlignSpec.allowTargetOut=!n.valid,r.tip.realign())}}onMouseOverNewTimeline(e,t){const r=this,{drag:{lockX:n,lockY:i}}=r,s=[];r.currentOverClient.element.classList.remove("b-dragging-"+r.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),t||r.currentOverClient.scrollManager.stopMonitoring(),n||s.push({element:e.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),i||s.push({element:e.scrollable.element,direction:"vertical"}),e.scrollManager.startMonitoring({scrollables:s,callback:r.drag.onScrollManagerScrollCallback}),r.currentOverClient=e}triggerBeforeEventDropFinalize(e,t,r){r.trigger(e,t)}onDrop({context:e,event:t}){var r;const n=this,{currentOverClient:i,dragData:s}=n;let a=!1;if(null==(r=n.tip)||r.hide(),e.valid=e.valid&&n.isValidDrop(s),n.drag.removeProxyAfterDrop=Boolean(s.externalDropTarget),e.valid&&s.startDate&&s.endDate){let r=!1;s.finalize=async t=>{r||s.async?await n.finalize(t):e.valid=e.valid&&t},n.triggerBeforeEventDropFinalize("before"+i.capitalizedEventName+"DropFinalize",{context:s,domEvent:t},i),r=!0,e.async=s.async,e.async||s.externalDropTarget||(a=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)}e.async||n.finalize(s.valid&&e.valid&&a)}onDragAbort({context:e}){var t;const r=this;r.client.currentOrientation.onDragAbort({context:e,dragData:r.dragData}),r.resetDraggedElements(),null==(t=r.tip)||t.hide(),r.triggerDragAbort(r.dragData)}onDragAbortFinalized({context:e}){var t,r;const n=this;n.triggerDragAbortFinalized(n.dragData),null==(r=(t=n.client)["after"+n.client.capitalizedEventName+"DragAbortFinalized"])||r.call(t,e,n.dragData)}onDragReset({source:e}){var t;const r=this,n=r.currentOverClient;null==n||n.scrollManager.stopMonitoring(),(null==(t=e.context)?void 0:t.started)&&(r.resetDraggedElements(),n.trigger(n.scheduledEventName+"DragReset")),null==n||n.element.classList.remove("b-dragging-"+r.currentOverClient.scheduledEventName),r.dragData=null}resetDraggedElements(){const{dragData:e}=this,{eventBarEls:t,draggedEntities:r}=e;this.resumeRecordElementRedrawing(e.record),r.forEach(((e,r)=>{this.resumeRecordElementRedrawing(e),t[r].classList.remove(this.drag.draggingCls),t[r].retainElement=!1})),e.context.element.retainElement=!1}onInternalInvalidDrop(e){var t;const r=this,{context:n}=r.drag;null==(t=r.tip)||t.hide(),r.triggerAfterDrop(r.dragData,!1),n.valid=!1,e&&r.drag.abort()}async finalize(e){const t=this,{dragData:r}=t;if(!r||t.finalizing)return;const{context:n,draggedEntities:i,externalDropTarget:s}=r;let a;return t.finalizing=!0,i.forEach(((e,n)=>{t.resumeRecordElementRedrawing(e),r.eventBarEls[n].classList.remove(t.drag.draggingCls),r.eventBarEls[n].retainElement=!1})),n.element.retainElement=!1,s&&r.valid||e?(a=t.updateRecords(r),!s&&Objects.isPromise(a)&&(n.async=!0,await a),r.valid?(n.async&&n.finalize(),s&&t.client.refreshRows(!1),t.triggerAfterDrop(r,!0)):t.onInternalInvalidDrop(!0)):t.onInternalInvalidDrop(n.async||r.async),t.finalizing=!1,a}updateDragContext(e,t){var r,n,i;const s=this,{drag:a}=s,o=s.dragData,l=s.currentOverClient,{isHorizontal:c}=l,[d]=o.draggedEntities,u=d.isAssignment?d.event:d,h=o.startDate,g=s.constrainDragToTimeSlot||(c?a.lockX:a.lockY);if(o.browserEvent=t,Object.assign(o,s.getProductDragContext(o)),g)o.timeDiff=0;else{let t;if(l.timeAxis.isContinuous){const i=l.isHorizontal?null!=(r=e.pageX)?r:e.startPageX:null!=(n=e.pageY)?n:e.startPageY,s=l.getDateFromCoordinate(i,null,!1,!0);t=o.timeDiff=s-e.pointerStartDate}else{const r=s.resolveStartEndDates(e.element);o.valid=Boolean(r.startDate&&r.endDate),o.valid&&(t=r.startDate-o.origStart)}null!==t&&(o.startDate=s.adjustStartDate(o.origStart,t),o.endDate=DateHelper.add(o.startDate,u.fullDuration),o.valid&&(o.timeDiff=o.startDate-o.origStart))}const p=o.dirty=o.dirty||h-o.startDate!=0;if(o.valid)if(s.constrainDragToTimeline&&(o.endDate<=l.timeAxis.startDate||o.startDate>=l.timeAxis.endDate))o.valid=!1,o.context.message=s.L("L{EventDrag.noDropOutsideTimeline}");else if(p||o.externalDropTarget){const r=o.externalDragValidity=!t||e.pageX&&s.checkDragValidity(o,t);r&&"boolean"!=typeof r?(o.valid=!1!==r.valid,o.context.message=r.message):(o.valid=!1!==r,o.context.message="")}else o.valid=!1!==o.externalDragValidity&&!1!==(null==(i=o.externalDragValidity)?void 0:i.valid);else o.valid=!1;o.context.valid=o.valid}suspendRecordElementRedrawing(e,t=!0){this.suspendElementRedrawing(this.getRecordElement(e),t),e.instanceMeta(this.client).retainElement=t}resumeRecordElementRedrawing(e){this.suspendRecordElementRedrawing(e,!1)}suspendElementRedrawing(e,t=!0){e&&(e.retainElement=t)}resumeElementRedrawing(e){this.suspendElementRedrawing(e,!1)}getDragData(e){const t=this,{client:r,drag:n}=t,i=t.setupProductDragData(e),{record:s,eventBarEls:a,draggedEntities:o}=i,{startEvent:l}=n,c=s.isAssignment?s.event:s,d=c.startDate,u=c.endDate,h=r.timeAxis,g=d<h.startDate,p=u>h.endDate,m=r.isSchedulerBase?r.multiEventSelect:r.selectionMode.multiSelect,f=t.getCoordinate(c,e.element,[e.elementStartX,e.elementStartY]),v=t.getCoordinate(c,e.element,[e.startClientX,e.startClientY]);t.suspendRecordElementRedrawing(s),o.forEach((e=>t.suspendRecordElementRedrawing(e))),s.isAssignment?r.selectAssignment(s,l.ctrlKey&&m):r.selectEvent(s,l.ctrlKey&&m);const y={context:e,...i,sourceDate:g?d:r.getDateFromCoordinate(f),screenSourceDate:r.getDateFromCoordinate(v,null,!1),startDate:d,endDate:u,timeDiff:0,origStart:d,origEnd:u,startsOutsideView:g,endsOutsideView:p,duration:u-d,browserEvent:l};return a.forEach((e=>e.classList.remove("b-sch-event-hover","b-active"))),a.length>1&&(e.relatedElements=a.slice(1)),y}setupConstraints(e,t,r,n){const i=this,s=!i.showExactDropPosition&&r>1?r:0;n?i.setXConstraint(e.left,e.right-t.width,s):i.setXConstraint(!0,!0,s),i.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(e,t){const r=this,{client:n}=r,{context:i}=r.drag,s=n.timeAxisViewModel.snapPixelAmount;if(i&&!r.drag.lockY){let a;if(!r.constrainDragToTimeline)return void r.setYConstraint(null,null,s);a=n.getScheduleRegion(t,e),r.setYConstraint(a.top,a.bottom-i.element.offsetHeight,s)}else r.setYConstraint(null,null,s)}setXConstraint(e,t,r){const{drag:n}=this;n.minX=e,n.maxX=t}setYConstraint(e,t,r){const{drag:n}=this;n.minY=e,n.maxY=t}adjustStartDate(e,t){const r=this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e);return this.constrainStartDate(r)}resolveStartEndDates(e){const t=this.currentOverClient,{timeAxis:r}=t,n=Rectangle.from(e.querySelector(t.eventInnerSelector),t.timeAxisSubGridElement),i=this.dragData,[s]=i.draggedEntities,a=s.isAssignment?s.event:s,{fullDuration:o}=a,l=t.fillTicks&&t.snapRelativeToEventStartDate;let{start:c,end:d}=t.getStartEndDatesFromRectangle(n,l?null:"round",o,!0);if(c&&d){if(l){const e=(a.startDate-DateHelper.startOf(a.startDate,r.unit))/(d-c)*n.width;n.deflate(e,0,0,e);const i=n.getStart(t.rtl,!t.isVertical);c=t.getDateFromCoordinate(i,null,!0),c=r.roundDate(c,a.startDate)}if(c=this.adjustStartDate(c,0),i.startsOutsideView)i.endsOutsideView||(c=d&&DateHelper.add(d,-o));else{if(!r.dateInAxis(c,!1)){const e=r.getTickFromDate(c);e>=0&&(c=r.getDateFromTick(e))}d=c&&DateHelper.add(c,o)}}return{startDate:c,endDate:d}}getTipHtml(){const e=this,{dragData:t,client:r,tooltipTemplate:n}=e,{startDate:i,endDate:s,draggedEntities:a}=t,o=r.getFormattedDate(i),l=r.getFormattedEndDate(s,i),{valid:c,message:d,element:u,dragProxy:h}=t.context,g=h?h.firstChild:u,p=a[0],m=p.isTask?p:p.event;return e.tip.lastAlignSpec.target=g,n({valid:c,startDate:i,endDate:s,startText:o,endText:l,dragData:t,message:d||"",[r.scheduledEventName+"Record"]:m,startClockHtml:e.clockTemplate.template({date:i,text:o,cls:"b-sch-tooltip-startdate",isDrag:"Y"}),endClockHtml:e.clockTemplate.template({date:s,text:l,cls:"b-sch-tooltip-enddate",isDrag:"Y"})})}updateConstrainDragToTimeSlot(e){const t=this.client.isHorizontal?"lockX":"lockY";this.drag&&(this.drag[t]=e)}updateConstrainDragToResource(e){const t=this;if(t.drag){const{constrainDragToTimeSlot:r}=t,{isHorizontal:n}=t.client;e&&(t.constrainDragToTimeline=!0),t.drag.lockY=n?e:r,t.drag.lockX=n?r:e}}updateConstrainDragToTimeline(e){this.isConfiguring||Object.assign(this.drag,{cloneTarget:!e,dragWithin:e?null:document.body,scrollManager:e?this.client.scrollManager:null})}constrainStartDate(e){const{dragData:t}=this,{dateConstraints:r}=t,n=t.eventRecord||t.taskRecord||t.draggedEntities[0];return(null==r?void 0:r.start)&&(e=DateHelper.max(r.start,e)),(null==r?void 0:r.end)&&(e=DateHelper.min(new Date(r.end-n.durationMS),e)),e}getElementFromContext(e){return e.grabbed||e.dragProxy||e.element}getRelatedRecords(e){return[]}getMinimalDragData(e,t){return{}}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,r){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}getRecordElement(e){throw new Error("Implement in subclass")}};DragBase._$name="DragBase";var tipAlign={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},EventResize=class extends(InstancePlugin.mixin(Draggable_default,Droppable_default)){static get $name(){return"EventResize"}static get configurable(){return{draggingItemCls:"b-sch-event-wrap-resizing",resizingItemInnerCls:"b-sch-event-resizing",leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSize:null,dynamicHandleSize:!0,allowResizeToZero:null,reservedSpace:5,touchHandleSize:null,dragThreshold:0,dragTouchStartDelay:0,draggingClsSelector:".b-timeline-base",showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>!0,validatorFnThisObj:null,tip:{$config:["lazy","nullify"],value:{autoShow:!1,axisLock:!0,trackMouse:!1,updateContentOnMouseMove:!0,hideDelay:0}},tooltipTemplate:e=>'<div class="b-sch-tip-'+(e.valid?"valid":"invalid")+'">'+e.startClockHtml+e.endClockHtml+'\n<div class="b-sch-tip-message">'+e.message+"</div>\n</div>\n",ignoreSelector:".b-sch-terminal",dragActiveCls:"b-resizing-event"}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isEventElementDraggable"]}}doDestroy(){var e;super.doDestroy(),null==(e=this.dragging)||e.destroy()}render(){const e=this,{client:t}=e;e.dragSelector=e.dragItemSelector=t.eventSelector,e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}isEventElementDraggable(e,t,r,n){const i=this,s=null==t?void 0:t.resizable;return!(!i.disabled&&s&&!t.isMilestone)||(!0!==s&&"start"!==s||!i.isOverStartHandle(n,e))&&(!0!==s&&"end"!==s||!i.isOverEndHandle(n,e))}onEventDataGenerated({eventRecord:e,wrapperCls:t,cls:r}){var n,i;e===(null==(i=null==(n=this.dragging)?void 0:n.context)?void 0:i.eventRecord)&&(t["b-active"]=t[this.draggingItemCls]=t["b-over-resize-handle"]=r["b-resize-handle"]=r[this.resizingItemInnerCls]=1)}onDragPointerMove(e){var t;const{client:r,dragging:n}=this,{visibleDateRange:i,isHorizontal:s}=r,a=s&&r.rtl,o=s?"X":"Y",l=globalThis["page"+o+"Offset"],c=e["page"+o]+((null==(t=n.context)?void 0:t.offset)||0),d=Rectangle.from(r.timeAxisSubGridElement,null,!0),u=d.getStart(a,s),h=d.getEnd(a,s);let g=r.getDateFromCoord({coord:c,local:!1});a?c-l>u?g=i.startDate:c<h&&(g=i.endDate):c-l<u?g=i.startDate:c-l>h&&(g=i.endDate),n.clientStartCoord=u,n.clientEndCoord=h,n.date=g,super.onDragPointerMove(e)}get isResizing(){return Boolean(this.dragging)}beforeDrag(e){const{client:t}=this,r=t.resolveTimeSpanRecord(e.itemElement),n=!t.isGanttBase&&t.resolveResourceRecord(t.isVertical?e.startEvent:e.itemElement);return!(this.disabled||t.readOnly||(null==n?void 0:n.readOnly)||r&&(r.readOnly||!r.project&&!r.isOccurrence)||!1===super.beforeDrag(e))&&(e.mousedownDate=e.date=t.getDateFromCoordinate(e.event["page"+(t.isHorizontal?"X":"Y")],null,!1),this.triggerBeforeResize(e))}dragStart(e){var t,r;const n=this,{client:i,tip:s}=n,{startEvent:a,itemElement:o}=e,l=i.scheduledEventName,c=i.resolveEventRecord(o),{isBatchUpdating:d,wrapStartDate:u,wrapEndDate:h}=c,g=null==(t=i.features.eventBuffer)?void 0:t.enabled,p=d?c.get("startDate"):c.startDate,m=d?c.get("endDate"):c.endDate,f="x"===n.dragLock,v=f&&i.rtl,y=n.isOverEndHandle(a,o),b=y?"endDate":"startDate",C=g?y?"wrapEndDate":"wrapStartDate":null,D=y?"startDate":"endDate",S=y?"setEndDate":"setStartDate",E=y?"setStartDate":"setEndDate",w=Rectangle.from(o),R=f?a.clientX:a.clientY,x=y?w.getEnd(v,f):w.getStart(v,f),T=e.context={eventRecord:c,element:o,timespanRecord:c,taskRecord:c,owner:n,valid:!0,oldValue:y?m:p,startDate:p,endDate:m,offset:g?0:x-R,edge:f?y?"right":"left":y?"bottom":"top",finalize:n.finalize,event:e.event,originalStartDate:p,originalEndDate:m,wrapStartDate:u,wrapEndDate:h,draggingEnd:y,toSet:b,wrapToSet:C,otherEnd:D,setMethod:S,setOtherMethod:E};c.meta.isResizing=!0,i.element.classList.add(...n.dragActiveCls.split(" ")),i.listenToBatchedUpdates||i.beginListeningForBatchedUpdates(),d||n.beginEventRecordBatch(c),n.setupProductResizeContext(T,a),n.triggerEventResizeStart(l+"ResizeStart",{[l+"Record"]:c,event:a,...n.getResizeStartParams(T)},T),T.resizedRecord=(null==(r=i.resolveAssignmentRecord)?void 0:r.call(i,T.element))||c,s&&(s.show(),s.align=tipAlign[T.edge],s.showBy(n.getTooltipTarget(e)))}triggerBeforeResize(e){const{client:t}=this,r=t.resolveTimeSpanRecord(e.itemElement);return t.trigger("before"+t.capitalizedEventName+"Resize",{[t.scheduledEventName+"Record"]:r,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t,r){var n,i;globalThis.isResizing=!0,this.client.trigger(e,t),null==(i=(n=this.client)["after"+StringHelper.capitalize(e)])||i.call(n,r,t)}triggerEventResizeEnd(e,t){globalThis.isResizing=!1,this.client.trigger(e,t)}triggerEventPartialResize(e,t){this.client.trigger(e,t)}triggerBeforeEventResizeFinalize(e,t){this.client.trigger(e,t)}dragEnter(e){var t;return(null==(t=e.context)?void 0:t.owner)===this}resizeEventPartiallyInternal(e,t){var r;const{client:n}=this,{toSet:i}=t;if(null==(r=n.features.eventBuffer)?void 0:r.enabled)if("startDate"===i){const r=t.startDate.getTime()-t.originalStartDate.getTime();e.wrapStartDate=new Date(t.wrapStartDate.getTime()+r)}else if("endDate"===i){const r=t.endDate.getTime()-t.originalEndDate.getTime();e.wrapEndDate=new Date(t.wrapEndDate.getTime()+r)}e.set(i,t[i])}applyDateConstraints(e,t,r){var n,i;const s=null==(n=r.dateConstraints)?void 0:n.start,a=null==(i=r.dateConstraints)?void 0:i.end;return(s||a)&&(e=DateHelper.constrain(e,s,a),r.snappedDate=DateHelper.constrain(r.snappedDate,s,a)),e}moveDrag(e){const t=this,{client:r,tip:n}=t,i="x"===t.dragLock,s=i?"X":"Y",a=r.scheduledEventName,{visibleDateRange:o,enableEventAnimations:l,timeAxis:c,weekStartDay:d}=r,u=i&&r.rtl,{resolutionUnit:h,resolutionIncrement:g}=c,{event:p,context:m}=e,{eventRecord:f}=m,v=m.offset*(u?-1:1),{isOccurrence:y}=f,b=f.get("startDate"),C=f.get("endDate"),D=p["client"+s]+v,S=Rectangle.from(r.timeAxisSubGridElement,null,!0),E=S.getStart(u,i),w=S.getEnd(u,i);m.event=p,p.isScroll&&(e.date=r.getDateFromCoordinate(p["page"+s]+v,null,!1));let R,x,{date:T}=e,{toSet:M,otherEnd:P,draggingEnd:F}=m;u?D>E?T=e.date=o.startDate:D<w&&(T=e.date=o.endDate):D<E?T=e.date=o.startDate:D>w&&(T=e.date=o.endDate),"endDate"===M?T<b&&(R=-1):T>C&&(R=1),R&&t.onDragEndSwitch&&(t.onDragEndSwitch(m,T,R),P=m.otherEnd,M=m.toSet),r.snapRelativeToEventStartDate&&(T=c.roundDate(T,m.oldValue)),m.snappedDate=DateHelper.round(T,c.resolution,null,d);const I=DateHelper.diff(T,m[P],h)*(F?-1:1);if(t.isEventDragCreate)m.tooNarrow=I<g/2;else if(I<g)if(t.allowResizeToZero)m.snappedDate=T=m[P];else{const e="startDate"===P?1:-1;m.snappedDate=T=c.roundDate(DateHelper.add(f.get(P),g*e,h)),x=!0}if(T=t.applyDateConstraints(T,f,m),(!m.date||T-m.date||x)&&(m.date=T,m[M]=t.showExactResizePosition||r.timeAxisViewModel.snap?m.snappedDate:T,m.valid=t.allowResizeToZero||m[M]-m["startDate"===M?"endDate":"startDate"]!=0,f.get(M)-m[M])){if(m.valid=t.checkValidity(m,p),m.message="",m.valid&&"boolean"!=typeof m.valid&&(m.message=m.valid.message,m.valid=m.valid.valid),m.valid=!1!==m.valid,m.valid){const n={[a+"Record"]:f,startDate:b,endDate:C,element:e.itemElement,context:m};n[M]=m[M],t.triggerEventPartialResize(a+"PartialResize",n),y&&f.stores.push(r.eventStore),r.enableEventAnimations=!1,this.resizeEventPartiallyInternal(f,m),r.enableEventAnimations=l,y&&(f.stores.length=0)}m.tooNarrow&&(m.valid=!1)}n&&(n.align=tipAlign[m.edge],n.alignTo(t.getTooltipTarget(e))),super.moveDrag(e)}dragEnd(e){const{context:t}=e;t&&(t.event=e.event),e.aborted?null==t||t.finalize(!1):this.isEventDragCreate||e.started||EventHelper.getPagePoint(e.event).equals(EventHelper.getPagePoint(e.startEvent))||(this.dragStart(e),this.cleanup(e.context,!1))}async dragDrop({context:e,event:t}){var r;e[e.toSet]=e.snappedDate;const{client:n}=this,{startDate:i,endDate:s}=e;let a;null==(r=this.tip)||r.hide(),e.valid=i&&s&&(this.allowResizeToZero||s-i>0)&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(this.triggerBeforeEventResizeFinalize("before"+n.capitalizedEventName+"ResizeFinalize",{context:e,event:t,[n.scheduledEventName+"Record"]:e.eventRecord}),a=!0),e.async||await e.finalize(a)}async finalize(e){const t=this.owner,r=this,{eventRecord:n,oldValue:i,toSet:s}=r,{snapRelativeToEventStartDate:a,timeAxis:o}=t.client;let l=!1;e?(a&&(r[s]=r.snappedDate=o.roundDate(r.date,i)),l=await t.internalUpdateRecord(r,n)):(t.cancelEventRecordBatch(n),n.isOccurrence&&n.resources.forEach((e=>t.client.repaintEventsForResource(e)))),t.cleanup(r,l)}cleanup(e,t){var r;const n=this,{client:i}=n,{element:s,eventRecord:a}=e,o=i.scheduledEventName;a.meta.isResizing=!1,i.endListeningForBatchedUpdates(),null==(r=n.tip)||r.hide(),n.unHighlightHandle(s),i.element.classList.remove(...n.dragActiveCls.split(" ")),n.triggerEventResizeEnd(o+"ResizeEnd",{changed:t,[o+"Record"]:a,...n.getResizeEndParams(e)})}async internalUpdateRecord(e,t){var r;const{client:n}=this,{generation:i}=t;if(t.isOccurrence)n.endListeningForBatchedUpdates(),t[t.batching>1?"endBatch":"cancelBatch"](),t.set(TimeSpan.prototype.inSetNormalize.call(t,{startDate:e.startDate,endDate:e.endDate}));else{const i={[e.toSet]:e[e.toSet]};if(t.isEntity){const{startDate:s,endDate:a,draggingEnd:o}=e;e.duration=i.duration=t.run("calculateProjectedDuration",s,a),i[e.toSet]=t.run("calculateProjectedXDateWithDuration",o?s:a,o,e.duration);const l=!t[e.otherEnd];l&&(i[e.otherEnd]=e[e.otherEnd]),t.set(i),n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),(null==(r=n.features.eventBuffer)?void 0:r.enabled)&&(t[e.wrapToSet]=null);const c=[];l&&c.push(t[e.setOtherMethod](i[e.otherEnd],!1)),c.push(t[e.setMethod](i[e.toSet],!1)),await Promise.all(c),t.endBatch()}else{const r=Object.assign({},t.meta.batchChanges);delete r[e.toSet],n.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),t.set(r),t[e.setMethod](i[e.toSet],!1)}}return await n.project.commitAsync(),t.generation!==i}onDragItemMouseMove(e){"touch"===e.pointerType||this.handleSelector||this.checkResizeHandles(e)}checkResizeHandles(e){const t=this,{overItem:r}=t;if(r&&!t.client.readOnly&&(!t.allowResize||t.allowResize(r,e))){const n=t.client.resolveTimeSpanRecord(r);if(null==n?void 0:n.readOnly)return;t.isOverAnyHandle(e,r)?t.highlightHandle():t.unHighlightHandle()}}onDragItemMouseLeave(e,t){this.unHighlightHandle(t)}highlightHandle(){var e,t;const{overItem:r,client:n}=this;(null!=(t=null==(e=r.syncIdMap)?void 0:e[n.scheduledEventName])?t:r.querySelector(n.eventInnerSelector)).classList.add("b-resize-handle"),r.classList.add("b-over-resize-handle")}unHighlightHandle(e=this.overItem){var t,r;if(e){const n=this,i=null!=(r=null==(t=e.syncIdMap)?void 0:t[n.client.scheduledEventName])?r:e.querySelector(n.client.eventInnerSelector);i&&i.classList.remove("b-resize-handle",n.resizingItemInnerCls),e.classList.remove("b-over-resize-handle",n.draggingItemCls)}}isOverAnyHandle(e,t){return this.isOverStartHandle(e,t)||this.isOverEndHandle(e,t)}isOverStartHandle(e,t){var r;return null==(r=this.getHandleRect("start",e,t))?void 0:r.contains(EventHelper.getPagePoint(e))}isOverEndHandle(e,t){var r;return null==(r=this.getHandleRect("end",e,t))?void 0:r.contains(EventHelper.getPagePoint(e))}getHandleRect(e,t,r){if(this.overItem){if(!(r=t.target.closest("."+this.client.eventCls)||r.querySelector("."+this.client.eventCls)))return;const n=this,i="start"===e,{client:s}=n,a=Boolean(s.rtl),o=n.dragLock,l="x"===o,c=l?"width":"height",d=(l?i&&!a?"left":"right":i?"top":"bottom")+"Handle",{offsetWidth:u}=r,h=s.resolveTimeSpanRecord(r),g=null==h?void 0:h.isResizable,p=Rectangle.from(r),m=p.clone(),f=globalThis.getComputedStyle(r,":before"),v=(n.handleSelector||BrowserHelper.isHoverableDevice?void 0:n.touchHandleSize)||n.handleSize||parseFloat(f[c]),y=n.handleVisibilityThreshold||2*n.handleSize,b=n.dynamicHandleSize?n.reservedSpace/2:0,C=[0,0,0,0];if(!n.disabled&&n[d]&&(u>=y||n.dynamicHandleSize)&&(!0===g||g===e)){if(!l&&!i||l&&a===i?(m[o]+=p[c]-v,C[l?3:0]=p[c]/2+b):C[l?1:2]=p[c]/2+b,p.deflate(...C),m[c]=v,m.constrainTo(p),m[c])return m}}}setupDragContext(e){const t=this;if(t.overItem&&t.isOverAnyHandle(e,t.overItem)&&t.isElementResizable(t.overItem,e)){const r=super.setupDragContext(e);return r.scrollManager=t.client.scrollManager,r}}changeHandleSize(){VersionHelper.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTouchHandleSize(){VersionHelper.deprecate("Scheduler","6.0.0","Handle size is from CSS")}changeTip(e,t){var r;const n=this;return n.showTooltip?(e?(e.isTooltip?e.owner=n:e=Tooltip.reconfigure(t,Tooltip.mergeConfigs({id:n.tipId},e,{getHtml:n.getTipHtml.bind(n),owner:n.client},n.tip),{owner:n,defaults:{type:"tooltip"}}),e.ion({innerhtmlupdate:"updateDateIndicator",thisObj:n}),n.clockTemplate=new ClockTemplate({scheduler:n.client})):t&&(t.destroy(),null==(r=n.clockTemplate)||r.destroy()),e):null}isElementResizable(e,t){var r;const n=this,{client:i}=n,s=i.resolveTimeSpanRecord(e);if(i.readOnly)return!1;let a=null==s?void 0:s.isResizable;const o=null!=(r=null==e?void 0:e.syncIdMap[i.scheduledEventName])?r:e,l=t.target.closest('[class$="-handle"]');if(!a||l&&l!==o)return!1;if(!(e=t.target.closest(n.dragSelector)))return!1;const c=e.classList.contains("b-sch-event-startsoutside"),d=e.classList.contains("b-sch-event-endsoutside");if(!0===a){if(c&&d)return!1;if(c)a="end";else{if(!d)return n.isOverStartHandle(t,e)||n.isOverEndHandle(t,e);a="start"}}return!(c&&"start"===a||d&&"end"===a)&&!!(n.isOverStartHandle(t,e)&&"start"===a||n.isOverEndHandle(t,e)&&"end"===a)}updateDateIndicator(){const{clockTemplate:e}=this,{eventRecord:t,draggingEnd:r,snappedDate:n}=this.dragging.context,i=r?t.get("startDate"):n,s=r?n:t.get("endDate"),{element:a}=this.tip;e.updateDateIndicator(a.querySelector(".b-sch-tooltip-startdate"),i),e.updateDateIndicator(a.querySelector(".b-sch-tooltip-enddate"),s)}getTooltipTarget({itemElement:e,context:t}){const r=this,{rtl:n}=r.client,i=Rectangle.from(e,null,!0);return"x"===r.dragLock?(!n&&"right"===t.edge||n&&"left"===t.edge?i.x=i.right-1:i.x-=r.tip.anchorSize[0]/2,i.width=r.tip.anchorSize[0]/2):("bottom"===t.edge&&(i.y=i.bottom-1),i.height=r.tip.anchorSize[1]/2),{target:i}}basicValidityCheck(e,t){return e.startDate&&(e.endDate>e.startDate||this.allowResizeToZero)&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}getTipHtml({tip:e}){const t=this,{startDate:r,endDate:n,toSet:i,snappedDate:s,valid:a,message:o="",timespanRecord:l}=t.dragging.context;if(!r||!n)return e.html;const c={record:l,valid:a,message:o,startDate:r,endDate:n,[i]:s};return c.startText=t.client.getFormattedDate(c.startDate),c.endText=t.client.getFormattedDate(c.endDate),c.startClockHtml=t.clockTemplate.template({date:c.startDate,text:c.startText,cls:"b-sch-tooltip-startdate",isDrag:"Y"}),c.endClockHtml=t.clockTemplate.template({date:c.endDate,text:c.endText,cls:"b-sch-tooltip-enddate",isDrag:"Y"}),t.tooltipTemplate(c)}beginEventRecordBatch(e){e.beginBatch()}cancelEventRecordBatch(e){e.cancelBatch()}getBeforeResizeParams(e){const{client:t}=this;return{resourceRecord:t.resolveResourceRecord(t.isVertical?e.event:e.element)}}getResizeStartParams(e){return{resourceRecord:e.resourceRecord}}getResizeEndParams(e){return{resourceRecord:e.resourceRecord,event:e.event}}setupProductResizeContext(e,t){var r,n,i;const{client:s}=this,{element:a}=e,o=s.resolveEventRecord(a),l=null==(r=s.resolveResourceRecord)?void 0:r.call(s,a),c=null==(n=s.resolveAssignmentRecord)?void 0:n.call(s,a);Object.assign(e,{eventRecord:o,taskRecord:o,resourceRecord:l,assignmentRecord:c,dateConstraints:null==(i=s.getDateConstraints)?void 0:i.call(s,l,o)})}checkValidity({startDate:e,endDate:t,eventRecord:r,resourceRecord:n}){const{client:i}=this;return!i.allowOverlap&&r.resources.some((n=>!i.isDateRangeAvailable(e,t,r,n)))?{valid:!1,message:this.L("L{EventDrag.eventOverlapsExisting}")}:this.basicValidityCheck(...arguments)}get tipId(){return this.client.id+"-event-resize-tip"}};EventResize._$name="EventResize",GridFeatureManager.registerFeature(EventResize,!0,"Scheduler"),GridFeatureManager.registerFeature(EventResize,!1,"ResourceHistogram");var getDragCreateDragDistance=function(e){var t,r;return!(null==(r=null==(t=this.source)?void 0:t.client.features.taskEdit)?void 0:r._canceling)&&EventHelper.getDistanceBetween(this.startEvent,e)},DragCreateBase=class extends EventResize{construct(e,t){!1===(null==t?void 0:t.showTooltip)&&(t.tip=null),super.construct(...arguments)}changeValidatorFn(e){this.createValidatorFn=e}render(){const e=this,{client:t}=e;e.dragRootElement=e.dropRootElement=t.timeAxisSubGridElement,e.dragLock=t.isVertical?"y":"x"}onDragEndSwitch(e){const{client:t}=this,{enableEventAnimations:r}=t,{eventRecord:n,draggingEnd:i}=e,s="x"===this.dragLock,{initialDate:a}=this.dragging;t.enableEventAnimations=!1,n.set({startDate:a,endDate:a}),i?Object.assign(e,{endDate:a,toSet:"startDate",otherEnd:"endDate",setMethod:"setStartDate",setOtherMethod:"setEndDate",edge:s?"left":"top"}):Object.assign(e,{startDate:a,toSet:"endDate",otherEnd:"startDate",setMethod:"setEndDate",setOtherMethod:"setStartDate",edge:s?"right":"bottom"}),e.draggingEnd=this.draggingEnd=!i,t.enableEventAnimations=r}beforeDrag(e){const t=this,r=super.beforeDrag(e),{pan:n,eventDragSelect:i}=t.client.features;return(!1===r||!(t.preventMultiple&&!t.isRowEmpty(e.rowRecord)||t.disabled||n&&!n.disabled||i&&!i.disabled))&&(t.client.preventDragSelect=!0,r)}startDrag(e){const t=super.startDrag(e);if(!1!==t){const{context:t}=e;e.initialDate=t.eventRecord.get(this.draggingEnd?"startDate":"endDate"),this.client.trigger("dragCreateStart",{proxyElement:e.element,eventElement:e.element,eventRecord:t.eventRecord,resourceRecord:t.resourceRecord}),e.context.offset=0,e.context.oldValue=e.mousedownDate}return t}isOverEndHandle(){return this.draggingEnd}setupDragContext(e){var t;const{client:r}=this;if(r.matchScheduleCell(e.target)){const n=null==(t=r.resolveResourceRecord(e))?void 0:t.$original;if(n&&!n.isSpecialRow){const t=Draggable_default().prototype.setupDragContext.call(this,e),i=[];return r.isVertical?i.push({element:r.scrollable.element,direction:"vertical"}):i.push({element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"}),t.scrollManager=r.scrollManager,t.monitoringConfig={scrollables:i},t.resourceRecord=t.rowRecord=n,t.getDistance=getDragCreateDragDistance,t}}}async dragDrop({context:e,event:t}){var r;e[e.toSet]=e.snappedDate;const{client:n}=this,{startDate:i,endDate:s,eventRecord:a}=e,{generation:o}=a;let l;null==(r=this.tip)||r.hide(),await n.project.commitAsync(),a.generation!==o&&(e.eventRecord[e.toSet]=e.oldValue,e.eventRecord[e.toSet]=e[e.toSet]),e.valid=i&&s&&s-i>0&&e[e.toSet]-e.oldValue&&!1!==e.valid,e.valid&&(n.trigger("beforeDragCreateFinalize",{context:e,event:t,proxyElement:e.element,eventElement:e.element,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord}),l=!0),e.async||await e.finalize(l)}updateDragTolerance(e){this.dragThreshold=e}changeTip(e,t){return super.changeTip(!e||e.isTooltip?e:ObjectHelper.assign({id:this.client.id+"-drag-create-tip"},e),t)}async finalize(e){var t;const r=this.owner,n=this,i=()=>{r.isDestroyed||(r.client.trigger("afterDragCreate",{proxyElement:n.element,eventElement:n.element,eventRecord:n.eventRecord,resourceRecord:n.resourceRecord}),r.cleanup(n))};e?(await r.finalizeDragCreate(n),i()):(null==(t=r.onAborted)||t.call(r,n),i())}async finalizeDragCreate(e){var t;await this.internalUpdateRecord(e,e.eventRecord),this.client.trigger("dragCreateEnd",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,event:e.event,eventElement:e.element}),null==(t=this.client)||t.trigger("eventAutoCreated",{eventRecord:e.eventRecord,resourceRecord:e.resourceRecord})}cleanup(e){var t;const{client:r}=this,{eventRecord:n}=e;n.meta.isResizing=!1,r.endListeningForBatchedUpdates(),null==(t=this.tip)||t.hide(),r.element.classList.remove(...this.dragActiveCls.split(" ")),e.element.parentElement.classList.remove("b-sch-dragcreating")}onElementContextMenu(){if(this.proxy)return!1}prepareCreateContextForFinalization(e,t,r,n=!1){return{...e,async:n,event:t,finalize:r}}onEventDataGenerated(e){var t,r;(null==(r=null==(t=this.dragging)?void 0:t.context)?void 0:r.eventRecord)===e.eventRecord&&(e.wrapperCls["b-sch-dragcreating"]=!0,e.wrapperCls["b-too-narrow"]=this.dragging.context.tooNarrow)}triggerBeforeResize(){}triggerEventResizeStart(){}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}};__publicField(DragCreateBase,"configurable",{showTooltip:!0,dragTolerance:2,preventMultiple:!1,dragTouchStartDelay:300,validatorFnThisObj:null,tipTemplate:e=>'<div class="b-sch-tip-'+(e.valid?"valid":"invalid")+'">'+e.startClockHtml+e.endClockHtml+'<div class="b-sch-tip-message">'+e.message+"</div></div>",dragActiveCls:"b-dragcreating"}),__publicField(DragCreateBase,"pluginConfig",{chain:["render","onEventDataGenerated"],before:["onElementContextMenu"]}),DragCreateBase._$name="DragCreateBase";var DH3=DateHelper,scheduleFields=["startDate","endDate","resource","recurrenceRule"],makeDate=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,r]=e[0]instanceof DateField?e:e.reverse(),n=DH3.parse(t.value);return n&&r.value&&n.setHours(r.value.getHours(),r.value.getMinutes(),r.value.getSeconds(),r.value.getMilliseconds()),n?DateHelper.clone(n):null}return null},copyTime=(e,t)=>{const r=new Date(e.getTime());return r.setHours(t.getHours(),t.getMinutes()),r},adjustEndDate=(e,t,r)=>{if(e&&t&&r.endDateField&&r.endTimeField){const e=DH3.add(copyTime(r.startDateField.value,r.startTimeField.value),r.eventRecord.durationMS,"milliseconds");r.endDateField.value=e,r.endTimeField.value=DH3.clone(e)}},EditBase=class extends InstancePlugin{static get configurable(){return{saveAndCloseOnEnter:!0,triggerEvent:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,items:null,weekStartDay:null}}construct(e,t){const r=this;e.eventEdit=r,super.construct(e,ObjectHelper.assign({weekStartDay:e.weekStartDay},t)),r.clientListenersDetacher=e.ion({[r.triggerEvent]:"onActivateEditor",dragCreateEnd:"onDragCreateEnd",eventAutoCreated:"onEventAutoCreated",thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null==(e=this._editor)||e.destroy(),super.doDestroy()}onEventAutoCreated(){}changeEditorConfig(e){const{items:t}=this;return t&&((e=Objects.clone(e)).items=Config.merge(t,e.items)),e}changeItems(e){return this.cleanItemsConfig(e),e}cleanItemsConfig(e){for(const t in e){const r=e[t];!0===r?delete e[t]:(null==r?void 0:r.items)&&this.cleanItemsConfig(r.items)}}onDatesChange(e){var t,r,n,i;const s=this,a=e.source,o=e.value;switch(s.startDateField&&s.endDateField&&(s.endDateField.min=s.startDateField.value),s.endTimeField&&(DH3.isEqual(DH3.clearTime(null==(t=s.startDateField)?void 0:t.value),DH3.clearTime(null==(r=s.endDateField)?void 0:r.value))?s.endTimeField.min=s.startTimeField.value:s.endTimeField.min=null),a.ref){case"startDateField":(null==(n=s.startTimeField)?void 0:n.value)&&adjustEndDate(o,s.startTimeField.value,s);break;case"startTimeField":(null==(i=s.startDateField)?void 0:i.value)&&adjustEndDate(s.startDateField.value,o,s)}}async save(){throw new Error("在子类中实现")}get values(){const e=this,{editor:t}=e,r=[],n=[],{values:i}=t;return scheduleFields.forEach((e=>delete i[e])),t.eachWidget((s=>{var a;const{name:o}=s;if(!o||s.hidden||s.up((t=>t===e.recurrenceEditor)))delete i[o];else switch(o){case"startDate":r.push(s);break;case"endDate":n.push(s);break;case"resource":i[o]=s.record;break;case"recurrenceRule":i[o]="none"===(null==(a=t.widgetMap.recurrenceCombo)?void 0:a.value)?"":s.value}}),!0),i.allDay&&!e.eventRecord.allDay&&(r.push(e.startTimeField),n.push(e.endTimeField)),r.length&&(i.startDate=makeDate(r)),n.length&&(i.endDate=makeDate(n)),"startDate"in i&&"endDate"in i&&(i.duration=DH3.diff(i.startDate,i.endDate,e.editor.record.durationUnit,!0)),i}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;return this.assignmentStore&&delete t.resource,e.set(t)}onBeforeEditorShow(){const{eventRecord:e,editor:t}=this.editingContext,{nameField:r}=t.widgetMap;r&&e.isCreating&&(t.assigningValues=!0,r.value="",t.assigningValues=!1,r._configuredPlaceholder=r.placeholder,r.placeholder=e.name)}resetEditingContext(){var e;const t=this;if(!t.editingContext)return;const{client:r}=t,{editor:n,eventRecord:i}=t.editingContext,{eventStore:s}=r,{nameField:a}=n.widgetMap;i.isCreating&&(r.isTimelineBase&&(null==(e=t.editingContext.eventElement)||e.closest("[data-event-id]").classList.add("b-released")),s.remove(i),i.isCreating=!1),a&&(a.placeholder=a._configuredPlaceholder),r.element.classList.remove("b-eventeditor-editing"),t.targetEventElement=t.editingContext=n._record=null}onPopupKeyDown({event:e}){const t=this;!t.readOnly&&"Enter"===e.key&&t.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&t.startTimeField&&adjustEndDate(t.startDateField.value,t.startTimeField.value,t),t.onSaveClick())}async onSaveClick(){this.editor.focus();const e=await this.save();return e&&(this.editor.close(),this.client.trigger("afterEventEdit")),e}async onDeleteClick(){if(await this.deleteEvent()){const{editor:e}=this;e.autoClose&&!e.containsFocus||e.close(),this.client.trigger("afterEventEdit")}}onCancelClick(){this.editor.close(),this.client.trigger("afterEventEdit")}};EditBase._$name="EditBase";var ResourceTimeRangesBase=class extends(InstancePlugin.mixin(AttachToProjectMixin_default)){static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"],override:["matchScheduleCell","resolveResourceRecord"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.client;return!this.needsRefresh&&this.store&&!this.store.storage.values.some((t=>e.isTimeSpanInAxis(t)))}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}updateTabIndex(){this.isConfiguring||this.client.refresh()}getEventsToRender(e,t){throw new Error("Implement in subclass")}onEventDataGenerated(e){const t=this,{eventRecord:r,iconCls:n}=e;t.shouldInclude(r)&&(t.client.isVertical?e.width=e.resourceRecord.columnWidth||t.client.resourceColumnWidth:e.top=0,e.fillSize=!0,e.wrapperCls["b-sch-resourcetimerange"]=1,t.rangeCls&&(e.wrapperCls[t.rangeCls]=1),e.wrapperCls["b-sch-color-"+r.timeRangeColor]=r.timeRangeColor,e.eventContent.text=r.name,e.children.push(e.eventContent),e.tabIndex=null!=t.tabIndex?String(t.tabIndex):null,(null==n?void 0:n.length)>0&&e.children.unshift({tag:"i",className:n.toString()}),e.eventId=t.generateElementId(r))}generateElementId(e){return e.domId}resolveResourceTimeRangeRecord(e){var t;return null==(t=null==e?void 0:e.closest("."+this.rangeCls))?void 0:t.elementData.eventRecord}getElementFromResourceTimeRangeRecord(e){return this.client.foregroundCanvas.syncIdMap[e.domId]}resolveResourceRecord(e){var t;return this.overridden.resolveResourceRecord(...arguments)||(null==(t=this.resolveResourceTimeRangeRecord(e.target||e))?void 0:t.resource)}shouldInclude(e){throw new Error("Implement in subclass")}onStoreChange(e){"removeall"!==e.action&&"dataset"!==e.action||(this.needsRefresh=!0),this.client.onInternalEventStoreChange(e),this.needsRefresh=!1}matchScheduleCell(e){let t=this.overridden.matchScheduleCell(e);if(!t&&this.enableMouseEvents){const{client:r}=this,n=e.closest("."+this.rangeCls);t=n&&r.getCell({record:r.isHorizontal?n.elementData.resource:r.store.first,column:r.timeAxisColumn})}return t}handleRangeMouseEvent(e){var t;const r=this,n=e.target.closest("."+r.rangeCls);if(n){const i=null!=(t=EventHelper.eventNameMap[e.type])?t:StringHelper.capitalize(e.type),s=r.resolveResourceTimeRangeRecord(n);r.client.trigger(r.entityName+i,{feature:r,[r.entityName+"Record"]:s,resourceRecord:r.client.resourceStore.getById(s.resourceId),domEvent:e})}}updateEnableMouseEvents(e){var t;const r=this,{client:n}=r;if(null==(t=r.mouseEventsDetacher)||t.call(r),r.mouseEventsDetacher=null,e){let e=function(){r.mouseEventsDetacher=EventHelper.on({element:n.foregroundCanvas,delegate:"."+r.rangeCls,mousedown:"handleRangeMouseEvent",mouseup:"handleRangeMouseEvent",click:"handleRangeMouseEvent",dblclick:"handleRangeMouseEvent",contextmenu:"handleRangeMouseEvent",mouseover:"handleRangeMouseEvent",mouseout:"handleRangeMouseEvent",thisObj:r})};n.whenVisible(e)}n.element.classList.toggle("b-interactive-resourcetimeranges",Boolean(e))}};__publicField(ResourceTimeRangesBase,"configurable",{tabIndex:null,entityName:"resourceTimeRange"}),ResourceTimeRangesBase.featureClass="",ResourceTimeRangesBase._$name="ResourceTimeRangesBase";var TimeSpanMenuBase=class extends ContextMenuBase{};TimeSpanMenuBase._$name="TimeSpanMenuBase";var TooltipBase=class extends InstancePlugin{static get defaultConfig(){return{autoUpdate:!1,hoverDelay:250,hideDelay:100,template:null,cls:null,align:{align:"b-t"},clockTemplate:null,monitorRecordUpdate:null,testConfig:{hoverDelay:0}}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t){const r=this;t=r.processConfig(t),super.construct(e,t),r.forSelector||(r.forSelector=e.eventInnerSelector+":not(.b-dragproxy)"),r.clockTemplate=new ClockTemplate({scheduler:e}),e.ion({["before"+e.scheduledEventName+"drag"]:()=>{var e;null==(e=r.tooltip)||e.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.destroyProperties("clockTemplate","tooltip"),super.doDestroy()}doDisable(e){this.tooltip&&(this.tooltip.disabled=e),super.doDisable(e)}onPaint({firstPaint:e}){var t;if(e){const e=this,{client:r}=e,n=[".b-dragselecting",".b-eventeditor-editing",".b-taskeditor-editing",".b-resizing-event",".b-task-percent-bar-resizing-task",".b-dragcreating",".b-dragging-"+r.scheduledEventName,".b-creating-dependency",".b-dragproxy"].map((e=>":not("+e+")")).join("");null==(t=e.tooltip)||t.destroy();const i=e.tooltip=new Tooltip({axisLock:"flexible",id:e.tipId||e.client.id+"-event-tip",cls:e.tipCls,forSelector:".b-timelinebase"+n+" .b-grid-body-container:not(.b-scrolling) "+e.forSelector,scrollAction:"realign",forElement:r.timeAxisSubGridElement,showOnHover:!0,anchorToTarget:!0,getHtml:e.getTipHtml.bind(e),disabled:e.disabled,...e.config,internalListeners:e.configuredListeners});i.ion({innerhtmlupdate:"updateDateIndicator",overtarget:"onOverNewTarget",show:"onTipShow",hide:"onTipHide",thisObj:e}),Object.keys(i.$meta.configs).forEach((e=>{Object.defineProperty(this,e,{set:t=>i[e]=t,get:()=>i[e]})}))}}processConfiguredListeners(){}addListener(...e){var t;const r=super.addListener(...e),n=null==(t=this.tooltip)?void 0:t.addListener(...e);if(r||n)return()=>{null==r||r(),null==n||n()}}removeListener(...e){var t;super.removeListener(...e),null==(t=this.tooltip)||t.removeListener(...e)}updateDateIndicator(){const e=this,t=e.tooltip,r=t.element.querySelector(".b-sch-tooltip-enddate");e.record&&(e.clockTemplate.updateDateIndicator(t.element,e.record.startDate),r&&e.clockTemplate.updateDateIndicator(r,e.record.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,activeTarget:t}){const r=this,{client:n}=r,i=r.recordType||n.scheduledEventName+"Record",s=r.resolveTimeSpanRecord(t);if((null==s?void 0:s.startDate)instanceof Date){const{startDate:t,endDate:a}=s,o=n.getFormattedDate(t),l=n.getDisplayEndDate(a,t),c=n.getFormattedDate(l);return e.eventRecord=s,r.template({tip:e,[""+i]:s,startDate:t,endDate:a,startText:o,endText:c,startClockHtml:r.clockTemplate.template({date:t,text:o,cls:"b-sch-tooltip-startdate",isDrag:"N"}),endClockHtml:r.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate",isDrag:"N"})})}return e.hide(),""}get record(){return this.tooltip.eventRecord}onTipShow(){const e=this;e.monitorRecordUpdate&&!e.updateListener&&(e.updateListener=e.client.eventStore.ion({update:e.onRecordUpdate,thisObj:e}))}onTipHide(){var e;this.tooltip.eventRecord=null,null==(e=this.updateListener)||e.call(this),this.updateListener=null}onOverNewTarget({newTarget:e}){this.tooltip.eventRecord=this.resolveTimeSpanRecord(e)}onRecordUpdate({record:e}){e===this.record&&(this.tooltip.alignTo(),this.tooltip.updateContent())}};TooltipBase._$name="TooltipBase";var AbstractTimeRanges=class extends(InstancePlugin.mixin(Delayable_default)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",enableResizing:!1,showTooltip:!0,tooltipTemplate:null,dragTipTemplate:e=>'<div class="b-sch-tip-'+(e.valid?"valid":"invalid")+'"><div class="b-sch-tip-name">'+(StringHelper.encodeHtml(e.name)||"")+"</div>"+e.startClockHtml+(e.endClockHtml||"")+"</div>",baseCls:"b-sch-timerange",headerRenderer:null,bodyRenderer:null,cls:null,narrowThreshold:80}}construct(e,t){const r=this;super.construct(e,t),e.isVertical&&e.ion({renderRows:r.onUIReady,thisObj:r,once:!0}),r.cls=r.cls||"b-sch-"+r.constructor.$$name.toLowerCase(),r.baseSelector="."+r.baseCls+"."+r.cls,r.enableResizing&&(r.showHeaderElements=!0)}doDestroy(){var e,t,r,n;const i=this;i.detachListeners("timeAxisViewModel"),i.detachListeners("timeAxis"),null==(e=i.clockTemplate)||e.destroy(),null==(t=i.tip)||t.destroy(),null==(r=i.drag)||r.destroy(),null==(n=i.resize)||n.destroy(),super.doDestroy()}doDisable(e){this.renderRanges(),super.doDisable(e)}setupTimeAxisViewModelListeners(){const e=this;e.detachListeners("timeAxisViewModel"),e.detachListeners("timeAxis"),e.client.timeAxisViewModel.ion({name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",thisObj:e}),e.client.timeAxis.ion({name:"timeAxis",includeChange:"renderRanges",thisObj:e}),e.updateLineBuffer()}onUIReady(){const e=this,{client:t}=e;t.ion({timeAxisViewModelChange:e.setupTimeAxisViewModelListeners,thisObj:e}),e.setupTimeAxisViewModelListeners(),t.hideHeaders||(e.headerContainerElement&&EventHelper.on({click:e.onTimeRangeClick,dblclick:e.onTimeRangeClick,contextmenu:e.onTimeRangeClick,delegate:e.baseSelector,element:e.headerContainerElement,thisObj:e}),e.enableResizing&&(e.drag=DragHelper.new({name:"rangeDrag",lockX:t.isVertical,lockY:t.isHorizontal,constrain:!0,outerElement:e.headerContainerElement,targetSelector:""+e.baseSelector,isElementDraggable:(r,n)=>!t.readOnly&&e.isElementDraggable(r,n),rtlSource:t,internalListeners:{dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",reset:"onDragReset",abort:"onInvalidDrop",thisObj:e}},e.dragHelperConfig),e.resize=ResizeHelper.new({direction:t.mode,targetSelector:e.baseSelector+".b-sch-range",outerElement:e.headerContainerElement,isElementResizable:(e,t)=>!e.matches(".b-dragging,.b-readonly")&&!t.target.matches(".b-fa"),internalListeners:{resizestart:"onResizeStart",resizing:"onResizeDrag",resize:"onResize",cancel:"onInvalidResize",reset:"onResizeReset",thisObj:e}},e.resizeHelperConfig))),e.renderRanges(),e.tooltipTemplate&&(e.hoverTooltip=new Tooltip({forElement:e.headerContainerElement,getHtml({activeTarget:t}){const r=e.resolveTimeRangeRecord(t);return e.tooltipTemplate({timeRange:r})},forSelector:"."+e.baseCls+(e.cls?"."+e.cls:"")}))}refresh(){this._timeRanges=null,this.renderRanges()}getDOMConfig(e,t){const r=this,n=[],i=[];if(!r.disabled){r._labelRotationMap={};for(const s of r.timeRanges){const a=r.renderRange(s,e,t);a&&(n.push(a.bodyConfig),i.push(a.headerConfig))}}return[n,i]}renderRanges(){const e=this,{client:t}=e,{foregroundCanvas:r}=t;if(r&&t.isPainted&&!t.timeAxisSubGrid.collapsed){const{headerContainerElement:t}=e,n=[],[i,s]=e.getDOMConfig();e.bodyCanvas||(e.bodyCanvas=DomHelper.createElement({className:"b-timeranges-canvas "+e.cls+"-canvas",parent:r,retainElement:!0})),DomSync.sync({targetElement:e.bodyCanvas,childrenOnly:!0,domConfig:{children:i,syncOptions:{releaseThreshold:0,syncIdField:"id"}},callback:e.showHeaderElements?null:({targetElement:e,action:t})=>{"reuseElement"!==t&&"newElement"!==t&&"reuseOwnElement"!==t||n.push(e)}}),e.showHeaderElements&&!e.headerCanvas&&(e.headerCanvas=DomHelper.createElement({className:e.cls+"-canvas",parent:t,retainElement:!0})),e.headerCanvas&&DomSync.sync({targetElement:e.headerCanvas,childrenOnly:!0,domConfig:{children:s,syncOptions:{releaseThreshold:0,syncIdField:"id"}}});for(const t of n)e.cacheRotation(t.elementData.timeRange,t);for(const t of n)e.applyRotation(t.elementData.timeRange,t)}}get timeRanges(){return[]}shouldRenderRange(e,t=this.client.visibleDateRange.startDate,r=this.client.visibleDateRange.endDate){const{timeAxis:n}=this.client,{startDate:i,endDate:s,duration:a}=e;return Boolean(i&&(n.isContinuous||n.isTimeSpanInAxis(e))&&DateHelper.intersectSpans(t,r,i,a?s:DateHelper.add(i,this._lineBufferDurationMS)))}getRangeDomConfig(e,t,r,n=0){const i=this,{client:s}=i,{rtl:a}=s,o=s.getCoordinateFromDate(DateHelper.max(e.startDate,t),{respectExclusion:!0})-n,l=e.endDate?s.getCoordinateFromDate(DateHelper.min(e.endDate,r),{respectExclusion:!0,isEnd:!0})-n:o,c=Math.abs(l-o),d=c>0,u=a?"calc("+o+"px - 100%)":o+"px";return{className:{[i.baseCls]:1,[i.cls]:i.cls,[i.rangeCls]:d,[i.lineCls]:!d,[e.cls]:e.cls,"b-narrow-range":d&&c<i.narrowThreshold,"b-readonly":e.readOnly,"b-rtl":a},dataset:{id:e.id},elementData:{timeRange:e},style:s.isVertical?"transform: translateY("+u+"); "+(d?"height:"+c+"px":"")+";":"transform: translateX("+u+"); "+(d?"width:"+c+"px":"")+";"}}renderRange(e,t,r){const n=this,{client:i}=n,{timeAxis:s}=i;if(n.shouldRenderRange(e,t,r)&&s.startDate){const t=n.getRangeDomConfig(e,s.startDate,s.endDate),r=e.iconCls&&StringHelper.xss`<i class="${e.iconCls}"></i>`,i=e.name&&StringHelper.encodeHtml(e.name),a=i||r?"<label>"+(r||"")+(i||"&nbsp;")+"</label>":"",o={...t,style:t.style+(e.style||""),html:n.bodyRenderer?n.bodyRenderer({timeRange:e}):n.showHeaderElements&&!n.showLabelInBody?"":a};let l;return n.showHeaderElements&&(l={...t,html:n.headerRenderer?n.headerRenderer({timeRange:e}):n.showLabelInBody?"":a}),{bodyConfig:o,headerConfig:l}}}cacheRotation(e,t){if(!e.iconCls&&!e.name||!e.duration)return;const r=t.firstElementChild;r&&!e.recurringTimeSpan&&(this._labelRotationMap[e.id]=this.client.isVertical?r.offsetHeight<t.offsetHeight:r.offsetWidth>t.offsetWidth)}applyRotation(e,t){var r,n,i;const s=this._labelRotationMap[null!=(n=null==(r=e.recurringTimeSpan)?void 0:r.id)?n:e.id];null==(i=t.firstElementChild)||i.classList.toggle("b-vertical",Boolean(s))}getBodyElementByRecord(e){const t="string"==typeof e?e:null==e?void 0:e.id;return null!=t&&DomSync.getChild(this.bodyCanvas,t)}resolveTimeRangeRecord(e){}get headerContainerElement(){const e=this,{isVertical:t,timeView:r,timeAxisColumn:n}=e.client;return e._headerContainerElement||(t&&r.element?e._headerContainerElement=r.element.parentElement:t||(e._headerContainerElement=n.element)),e._headerContainerElement}get showHeaderElements(){return!this.client.hideHeaders&&this._showHeaderElements}updateShowHeaderElements(e){const{client:t}=this;this.isConfiguring||(t.element.classList.toggle("b-sch-timeranges-with-headerelements",Boolean(e)),this.renderRanges())}populateTimeAxisHeaderMenu({column:e,items:t}){}onPaint({firstPaint:e}){e&&this.client.isHorizontal&&this.onUIReady()}onSchedulerHorizontalScroll(){this.client.isHorizontal&&this.renderRanges()}afterScroll(){this.client.isVertical&&this.renderRanges()}updateLineBuffer(){const{timeAxisViewModel:e}=this.client;this._lineBufferDurationMS=e.getDateFromPosition(300)-e.getDateFromPosition(0)}onInternalResize(e,t,r,n,i){this.client.isVertical&&i!==r&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.updateLineBuffer(),this.refresh()}onTimeRangeClick(e){const t=this.resolveTimeRangeRecord(e.target);this.client.trigger("timeRangeHeader"+StringHelper.capitalize(e.type),{event:e,domEvent:e,timeRangeRecord:t})}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new ClockTemplate({scheduler:t.client}),t.tip=new Tooltip(ObjectHelper.assign({id:t.client.id+"-time-range-tip",cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,updateContentOnMouseMove:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)},t.showTooltip)))}destroyTip(){this.tip&&(this.tip.destroy(),this.tip=null)}isElementDraggable(e){return(e=e.closest(this.baseSelector+":not(.b-resizing):not(.b-readonly)"))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const{client:t,drag:r}=this;t.isVertical?(r.minY=0,r.maxY=t.timeAxisViewModel.totalSize-e.element.offsetHeight,r.minX=0,r.maxX=Number.MAX_SAFE_INTEGER):(r.minX=0,r.maxX=t.timeAxisViewModel.totalSize-e.element.offsetWidth,r.minY=0,r.maxY=Number.MAX_SAFE_INTEGER),t.element.classList.add("b-dragging-timerange")}onDrop({context:e}){this.client.element.classList.remove("b-dragging-timerange")}onInvalidDrop(){this.drag.reset(),this.client.element.classList.remove("b-dragging-timerange"),this.destroyTip()}onDrag(){}onDragReset(){}onResizeStart(){}onResizeDrag(){}onResize(){}onInvalidResize(){}onResizeReset(){}getTipHtml(e,t){const r=this,{client:n}=r,i=Rectangle.from(t),s=i.getStart(n.rtl,n.isHorizontal),a=i.getEnd(n.rtl,n.isHorizontal),o=n.getDateFromCoordinate(s,"round",!1),l=e.endDate&&n.getDateFromCoordinate(a,"round",!1),c=n.getFormattedDate(o),d=l&&n.getFormattedEndDate(l,o);return r.dragTipTemplate({name:e.name||"",startDate:o,endDate:l,startText:c,endText:d,startClockHtml:r.clockTemplate.template({date:o,text:c,cls:"b-sch-tooltip-startdate",isDrag:"Y"}),endClockHtml:d&&r.clockTemplate.template({date:l,text:d,cls:"b-sch-tooltip-enddate",isDrag:"Y"})})}};__publicField(AbstractTimeRanges,"configurable",{showHeaderElements:!0}),__publicField(AbstractTimeRanges,"pluginConfig",{chain:["onPaint","populateTimeAxisHeaderMenu","onSchedulerHorizontalScroll","afterScroll","onInternalResize"]}),AbstractTimeRanges._$name="AbstractTimeRanges";var emptyObject10=Object.freeze({}),ColumnLines=class extends(InstancePlugin.mixin(AttachToProjectMixin_default,Delayable_default)){static get $name(){return"ColumnLines"}static get delayable(){return{refresh:{type:"raf",cancelOutstanding:!0}}}static get pluginConfig(){return{after:["render","updateCanvasSize","onVisibleDateRangeChange","onVisibleResourceRangeChange"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t)}attachToResourceStore(e){const{client:t}=this;super.attachToResourceStore(e),t.isVertical&&t.resourceStore.ion({name:"resourceStore",group({groupers:e}){0===e.length&&this.refresh()},thisObj:this})}doDisable(e){super.doDisable(e),this.isConfiguring||this.refresh()}render(){this.refresh()}getColumnLinesDOMConfig(e,t){var r,n;const{client:i}=this,{rtl:s}=i,a=s?-1:1,{timeAxisViewModel:o,isHorizontal:l,resourceStore:c,variableColumnWidths:d}=i,{columnConfig:u}=o,h=o.columnLinesFor,g=Math.max(h-1,0),p=e.getTime(),m=t.getTime(),f=[],v=new Set,y=l?"X":"Y";if(!this.disabled){const e=(e,t)=>{const r=e.start.getTime();let n=6==e.start.getDay()?"staCol":"";r>p&&r<m&&!v.has(r)&&(v.add(r),f.push({role:"presentation",className:t?"b-column-line-major":"b-column-line "+n,style:{transform:"translate"+y+"("+e.coord*a+"px)",width:(t?e.width/7:e.width)+"px"},dataset:{line:t?"major-"+e.index:"line-"+e.index}}))};if(h!==g)for(let t=1;t<=u[g].length-1;t++)e(u[g][t],!0);for(let t=1;t<=u[h].length-1;t++)e(u[h][t],!1);if(!l&&i.columnLines){const{columnWidth:e}=i.resourceColumns;let{first:t,last:s}=i.currentOrientation.getResourceRange(!0),o=0;if(t>-1)for(let i=t;i<s+1;i++){const t=c.getAt(i);if(t.isGroupHeader){s++,o++;continue}const l=t.instanceMeta(c),u=d?l.insetStart+t.columnWidth-1:(i-o+1)*e-1;f.push({className:{"b-column-line":1,"b-resource-column-line":1,"b-resource-group-divider":c.isGrouped&&(null==(n=l.groupParent)?void 0:n.groupChildren[(null==(r=l.groupParent)?void 0:r.groupChildren.length)-1])===t},style:{transform:"translateX("+u*a+"px)"},dataset:{line:"resource-"+i}})}}}return f}refresh(){const e=this,{client:t}=e,{timeAxis:r}=t,{startDate:n,endDate:i}=t.visibleDateRange||emptyObject10;if(!r.startDate||!n||e.client.timeAxisSubGrid.collapsed)return;e.element||(e.element=DomHelper.createElement({parent:t.backgroundCanvas,className:"b-column-lines-canvas"}));const s=e.getColumnLinesDOMConfig(n,i);DomSync.sync({targetElement:e.element,onlyChildren:!0,domConfig:{children:s,syncOptions:{releaseThreshold:4}},syncIdField:"line"})}onVisibleDateRangeChange(){this.refresh()}onVisibleResourceRangeChange({firstResource:e,lastResource:t}){this.refresh()}updateCanvasSize(){this.refresh()}};ColumnLines._$name="ColumnLines",GridFeatureManager.registerFeature(ColumnLines,!0,["Scheduler","Gantt"]);var DependencyCreation_default=e=>class extends(e||Base){static get $name(){return"DependencyCreation"}static get defaultConfig(){return{allowDropOnEventBar:!0,showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["start","top","end","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const r=this;r.view=e,r.eventName=e.scheduledEventName,e.ion({readOnly:()=>r.updateCreateListeners()}),r.updateCreateListeners(),r.chain(e,"onElementTouchMove","onElementTouchMove")}doDestroy(){var e,t;const r=this;r.detachListeners("view"),r.creationData=null,null==(e=r.pointerUpMoveDetacher)||e.call(r),null==(t=r.creationTooltip)||t.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.detachListeners("view"),e.isCreateAllowed&&e.view.ion({name:"view",[e.eventName+"mouseenter"]:"onTimeSpanMouseEnter",[e.eventName+"mouseleave"]:"onTimeSpanMouseLeave",thisObj:e}))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter({event:e,source:t,[this.eventName+"Record"]:r,[this.eventName+"Element"]:n}){if(!r.isCreating&&!r.readOnly&&(!this.client.features.nestedEvents||r.parent.isRoot)){const i=this,{creationData:s}=i,a=DomHelper.down(n,t.eventInnerSelector);r!==(null==s?void 0:s.source)&&(i.showTerminals(r,a),s&&e.target.closest(i.client.eventSelector)&&(s.timeSpanElement=a,i.onOverTargetEventBar(e)))}}onTimeSpanMouseLeave(e){var t;const r=this,{creationData:n}=r,i=e[r.eventName+"Element"],s=DomHelper.down(i,r.view.eventInnerSelector),a=null==(t=e.event)?void 0:t.relatedTarget,o=null==n?void 0:n.timeSpanElement;a&&(n&&o&&a&&DomHelper.isDescendant(o,a)||(e.event.isTrusted||s!==(null==n?void 0:n.sourceElement))&&r.hideTerminals(i),n&&!n.finalizing&&(n.timeSpanElement=null,r.onOverNewTargetWhileCreating(void 0,void 0,e)))}onTerminalMouseOver(e){this.creationData&&this.onOverTargetEventBar(e)}onTerminalMouseOut(e){const t=this,{creationData:r}=t,n=e.target.closest(t.view.eventSelector);!n||t.showingTerminalsFor&&DomHelper.isDescendant(n,t.showingTerminalsFor)||r&&n===r.timeSpanElement||(t.hideTerminals(n),t.view.unhover(n,e)),r&&t.onOverNewTargetWhileCreating(e.relatedTarget,r.target,e)}onTerminalPointerDown(e){var t;const r=this;if(0===e.button&&!r.creationData){const n=r.view,i=n.timeAxisSubGridElement,s=e.target,a=s.closest(n.eventInnerSelector),o=Rectangle.from(n.element,document.body);e.stopPropagation(),r.creationData={sourceElement:a,source:n.resolveTimeSpanRecord(a).$original,fromSide:s.dataset.side,startPoint:Rectangle.from(s,i).center,startX:e.pageX-o.x+n.scrollLeft,startY:e.pageY-o.y+n.scrollTop,valid:!1,sourceResource:null==(t=n.resolveResourceRecord)?void 0:t.call(n,e),tooltip:r.creationTooltip},r.pointerUpMoveDetacher=EventHelper.on({pointerup:{element:n.element.getRootNode(),handler:"onMouseUp",passive:!1},pointermove:{element:i,handler:"onMouseMove",passive:!1},thisObj:r}),r.documentPointerUpDetacher=EventHelper.on({pointerup:{element:document,handler:"onDocumentMouseUp"},keydown:{element:document,handler:({key:e})=>{"Escape"===e&&r.abort()}},thisObj:r})}}onElementTouchMove(e){var t;null==(t=super.onElementTouchMove)||t.call(this,e),this.connector&&e.preventDefault()}onMouseMove(e){const t=this,{view:r,creationData:n}=t,i=Rectangle.from(r.element,document.body),s=e.pageX-i.x+r.scrollLeft-n.startX,a=e.pageY-i.y+r.scrollTop-n.startY,o=Math.round(Math.sqrt(s*s+a*a))-3,l=Math.atan2(a,s);let{connector:c}=t;if(!c){if(!1===t.onRequestDragCreate(e))return;c=t.connector}c.style.width=o+"px",c.style.transform="rotate("+l+"rad)",t.lastMouseMoveEvent=e}onRequestDragCreate(e){const t=this,{view:r,creationData:n}=t;if(!1===r.trigger("beforeDependencyCreateDrag",{data:n,source:n.source}))return t.abort(),!1;if(r.element.classList.add("b-creating-dependency"),t.createConnector(n.startPoint.x,n.startPoint.y),r.trigger("dependencyCreateDragStart",{data:n,source:n.source}),t.showCreationTooltip){const r=t.creationTooltip||(t.creationTooltip=t.createDragTooltip());t.creationData.tooltip=r,r.disabled=!1,r.show(),r.onMouseMove(e)}r.scrollManager.startMonitoring({scrollables:[{element:r.timeAxisSubGrid.scrollable.element,direction:"horizontal"},{element:r.scrollable.element,direction:"vertical"}],callback:()=>t.lastMouseMoveEvent&&t.onMouseMove(t.lastMouseMoveEvent)})}onOverTargetEventBar(e){const t=this,{view:r,creationData:n,allowDropOnEventBar:i}=t,{target:s}=e;let a=r.resolveTimeSpanRecord(s).$original;(null==a?void 0:a.isEventSegment)&&(a=a.event),Objects.isPromise(n.valid)||!i&&!s.classList.contains(t.terminalCls)||a!==n.source&&t.onOverNewTargetWhileCreating(s,a,e)}async onOverNewTargetWhileCreating(e,t,r){var n,i;const s=this,{view:a,creationData:o,allowDropOnEventBar:l,connector:c}=s;if(!Objects.isPromise(o.valid)&&!o.finalizing&&c){if(c.classList.remove("b-valid","b-invalid"),o.timeSpanElement&&DomHelper.removeClsGlobally(o.timeSpanElement,"b-sch-terminal-active"),t&&t!==o.source&&(l||e.classList.contains(s.terminalCls))){const d=o.target=t,{source:u}=o;let h,g=e.dataset.side;l&&!e.classList.contains(s.terminalCls)&&(g=s.getTargetSideFromType(s.dependencyStore.modelClass.fieldMap.type.defaultValue||DependencyBaseModel.Type.EndToStart)),a.resolveResourceRecord&&(o.targetResource=a.resolveResourceRecord(r)),o.toSide=g;const p=o.fromSide,m=t=>{s.isDestroyed||(o.valid=t,e.classList.add(t?"b-valid":"b-invalid"),c.classList.add(t?"b-valid":"b-invalid"),a.trigger("dependencyValidationComplete",{data:o,source:u,target:d,dependencyType:h}))};switch(!0){case"start"===p&&"start"===g:h=DependencyBaseModel.Type.StartToStart;break;case"start"===p&&"end"===g:h=DependencyBaseModel.Type.StartToEnd;break;case"end"===p&&"start"===g:h=DependencyBaseModel.Type.EndToStart;break;case"end"===p&&"end"===g:h=DependencyBaseModel.Type.EndToEnd}a.trigger("dependencyValidationStart",{data:o,source:u,target:d,dependencyType:h});let f=o.valid=s.dependencyStore.isValidDependency(u,d,h);Objects.isPromise(f)?(f=await f,m(f)):m(f);const v=f?"b-valid":"b-invalid";c.classList.add(v),null==(i=null==(n=o.timeSpanElement)?void 0:n.querySelector(".b-sch-terminal[data-side="+g+"]"))||i.classList.add("b-sch-terminal-active",v)}else o.target=o.toSide=null,o.valid=!1,c.classList.add("b-invalid");s.updateCreationTooltip()}}async onMouseUp(){var e;const t=this,r=t.creationData;if(r.finalizing=!0,null==(e=t.pointerUpMoveDetacher)||e.call(t),r.valid){if(!1===await t.view.trigger("beforeDependencyCreateFinalize",r)?r.valid=!1:Objects.isPromise(r.valid)&&(r.valid=await r.valid),r.valid){let e=t.createDependency(r);null!==e&&(Objects.isPromise(e)&&(e=await e),r.dependency=e,t.view.trigger("dependencyCreateDrop",{data:r,source:r.source,target:r.target,dependency:e}),t.doAfterDependencyDrop(r))}else t.doAfterDependencyDrop(r)}else r.valid=!1,t.doAfterDependencyDrop(r);t.abort()}doAfterDependencyDrop(e){this.view.trigger("afterDependencyCreateDrop",{data:e,...e})}onDocumentMouseUp({target:e}){this.view.timeAxisSubGridElement.contains(e)||this.abort()}abort(){var e,t;const r=this,{view:n,creationData:i}=r;if(i){const{source:e,sourceResource:t,target:s,targetResource:a}=i;if(e){const i=n.getElementFromEventRecord(e,t);i&&r.hideTerminals(i)}if(s){const e=n.getElementFromEventRecord(s,a);e&&r.hideTerminals(e)}}r.creationTooltip&&(r.creationTooltip.disabled=!0),r.creationData=r.lastMouseMoveEvent=null,null==(e=r.pointerUpMoveDetacher)||e.call(r),null==(t=r.documentPointerUpDetacher)||t.call(r),r.removeConnector()}createConnector(e,t){const r=this,{view:n}=r;r.clearTimeout(r.removeConnectorTimeout),r.connector=DomHelper.createElement({parent:n.timeAxisSubGridElement,className:r.baseCls+"-connector",style:"left:"+e+"px;top:"+t+"px"}),n.element.classList.add("b-creating-dependency")}createDragTooltip(){const e=this,{view:t}=e;return e.creationTooltip=Tooltip.new({id:t.id+"-dependency-drag-tip",cls:"b-sch-dependency-creation-tooltip",loadingMsg:"",anchorToTarget:!1,forElement:t.timeAxisSubGridElement,trackMouse:!0,constrainTo:null,header:{dock:"right"},internalListeners:{beforeShow:"updateCreationTooltip",thisObj:e}},e.creationTooltip)}removeConnector(){const e=this,{connector:t,view:r}=e;t&&(t.classList.add("b-removing"),t.style.width="0",e.removeConnectorTimeout=e.setTimeout((()=>{t.remove(),e.connector=null}),200)),r.element.classList.remove("b-creating-dependency"),e.creationTooltip&&e.creationTooltip.hide(),r.scrollManager.stopMonitoring()}showTerminals(e,t){const r=this;if(!r.isCreateAllowed||!e.project)return;const n=r.terminalCls,i=n+"s-visible";(t=DomHelper.down(t,r.view.eventInnerSelector)).classList.contains(i)||r.view.element.classList.contains("b-resizing-event")||r.view.readOnly||(r.terminalSides.forEach((e=>{e=r.fixSide(e);const i=DomHelper.createElement({parent:t,className:n+" "+n+"-"+e,dataset:{side:e,feature:!0}});i.detacher=EventHelper.on({element:i,mouseover:"onTerminalMouseOver",mouseout:"onTerminalMouseOut",pointerdown:{handler:"onTerminalPointerDown",capture:!0},thisObj:r})})),t.classList.add(i),e.internalCls.add(i),r.showingTerminalsFor=t)}fixSide(e){return"left"===e?"start":"right"===e?"end":e}hideTerminals(e){const t=this,r=t.client.getTimeSpanMouseEventParams(e),n=null==r?void 0:r[t.eventName+"Record"],i=t.terminalCls+"s-visible";DomHelper.forEachSelector(e,"."+t.terminalCls,(e=>{e.detacher&&e.detacher(),e.remove()})),DomHelper.down(e,t.view.eventInnerSelector).classList.remove(i),n.internalCls.remove(i),t.showingTerminalsFor=null}createDependency(e){const{source:t,target:r,fromSide:n,toSide:i}=e,s=("start"===n?0:2)+("end"===i?1:0),a=this.dependencyStore.add({from:t.id,to:r.id,type:s,fromSide:n,toSide:i});return null!==a?a[0]:null}getTargetSideFromType(e){return e===DependencyBaseModel.Type.StartToStart||e===DependencyBaseModel.Type.EndToStart?"start":"end"}updateCreationTooltip(){const e=this,t=e.creationData,{valid:r}=t,n=e.creationTooltip,{classList:i}=n.element;if(Objects.isPromise(r))return i.remove("b-invalid"),i.add("b-checking"),new Promise((i=>r.then((r=>{t.valid=r,n.isDestroyed||i(e.updateCreationTooltip())}))));n.html=e.creationTooltipTemplate(t)}creationTooltipTemplate(e){var t,r;const n=this,{tooltip:i,valid:s}=e,{classList:a}=i.element;let o,l;return Object.assign(e,{fromText:StringHelper.encodeHtml(e.source.name),toText:StringHelper.encodeHtml(null!=(r=null==(t=e.target)?void 0:t.name)?r:""),fromSide:e.fromSide,toSide:e.toSide||""}),a.toggle("b-invalid",!s),a.remove("b-checking"),!0===s?(o="valid",l=n.L("L{Dependencies.valid}")):(o="invalid",l=n.L("L{Dependencies.invalid}")),i.title='<i class="gt-icon gt-icon-'+o+'"></i>'+l,{children:[{className:"b-sch-dependency-tooltip",children:[{dataset:{ref:"fromLabel"},tag:"label",text:n.L("L{Dependencies.from}")},{dataset:{ref:"fromText"},text:e.fromText},{dataset:{ref:"fromBox"},className:"b-sch-box b-"+e.fromSide},{dataset:{ref:"toLabel"},tag:"label",text:n.L("L{Dependencies.to}")},{dataset:{ref:"toText"},text:e.toText},{dataset:{ref:"toBox"},className:"b-sch-box b-"+e.toSide}]}]}}doDisable(e){this.isConfiguring||this.updateCreateListeners(),super.doDisable(e)}},ROWS_PER_CELL=25,DependencyGridCache_default=e=>{var t;return t=class extends e{constructor(){super(...arguments),__publicField(this,"gridCache",null)}getDependenciesToConsider(e,t,r,n){const i=this,{gridCache:s}=i,{timeAxis:a}=i.client;if(s){const o=new Set,l=Math.floor((e-a.startMS)/i.MS_PER_CELL),c=Math.floor((t-a.startMS)/i.MS_PER_CELL),d=Math.floor(r/ROWS_PER_CELL),u=Math.floor(n/ROWS_PER_CELL);for(let e=l;e<=c;e++){const t=s[e];if(t)for(let e=d;e<=u;e++){const r=t[e];if(r)for(let e=0;e<r.length;e++)o.add(r[e])}}return o}}afterDrawDependency(e,t,r,n,i){var s,a;const o=this;if(o.constructGridCache){const{MS_PER_CELL:l}=o,{startMS:c,endMS:d}=o.client.timeAxis,u=Math.ceil((d-c)/l),h=Math.floor((n-c)/l),g=Math.floor((i-c)/l),p=Math.floor(t/ROWS_PER_CELL),m=Math.floor(r/ROWS_PER_CELL),f=Math.min(h,g),v=Math.max(h,g),y=Math.min(p,m),b=Math.max(p,m);if(f<0&&v<0||f>u&&v>u)return;const C=Math.max(f,0),D=Math.min(v,u);for(let t=C;t<=D;t++){const r=null!=(s=o.gridCache[t])?s:o.gridCache[t]={};for(let t=y;t<=b;t++){(null!=(a=r[t])?a:r[t]=[]).push(e)}}}}beforeDraw(){const e=this;if(!e.gridCache){const{visibleDateRange:t}=e.client;e.constructGridCache=!0,e.MS_PER_CELL=Math.max(t.endMS-t.startMS,1e3),e.gridCache={}}}afterDraw(){this.constructGridCache=!1}reset(){this.gridCache=null}},__publicField(t,"$name","DependencyGridCache"),t},THRESHOLD=Math.min(1/globalThis.devicePixelRatio,.75),BOX_PROPERTIES=["start","end","top","bottom"],equalEnough=(e,t)=>Math.abs(e-t)<.1,sideToSide={l:"left",r:"right",t:"top",b:"bottom"},RectangularPathFinder=class extends Base{static get configurable(){return{startSide:"right",startArrowMargin:12,startShift:0,endSide:"left",endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null,client:{}}}findPath(e,t){const r=this,n=e;let i,s,a,o,l,c,d,u,h,g,p,m,f,v,y,b,C,D,S,E,w,R,x,T,M,P,F,I,A;for(t=ArrayHelper.asArray(t),A=0;e&&!I;)for(i=Object.assign(r.config,e),s=i.startBox,a=i.endBox,o=i.startShift,l=i.endShift,c=i.startSide,d=i.endSide,u=i.startArrowMargin,h=i.endArrowMargin,g=i.horizontalMargin,p=i.verticalMargin,m=i.hasOwnProperty("startHorizontalMargin")?i.startHorizontalMargin:g,f=i.hasOwnProperty("startVerticalMargin")?i.startVerticalMargin:p,v=i.hasOwnProperty("endHorizontalMargin")?i.endHorizontalMargin:g,y=i.hasOwnProperty("endVerticalMargin")?i.endVerticalMargin:p,b=i.hasOwnProperty("otherHorizontalMargin")?i.otherHorizontalMargin:g,C=i.hasOwnProperty("otherVerticalMargin")?i.otherVerticalMargin:p,D=i.otherBoxes,c=r.normalizeSide(c),d=r.normalizeSide(d),S=r.getConnectionCoordinatesFromBoxSideShift(s,c,o),E=r.getConnectionCoordinatesFromBoxSideShift(a,d,l),M=r.calcGridBaseBoxFromBoxAndDrawParams(s,c,u,m,f),P=r.calcGridBaseBoxFromBoxAndDrawParams(a,d,h,v,y),BOX_PROPERTIES.forEach((e=>{Math.abs(M[e]-P[e])<=THRESHOLD&&(P[e]=M[e])})),r.shouldLookForPath(s,a,M,P)&&(D=null==D?void 0:D.map((e=>r.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,b,C))),w=r.getConnectionCoordinatesFromBoxSideShift(M,c,o),R=r.getConnectionCoordinatesFromBoxSideShift(P,d,l),F=r.buildPathGrid(M,P,w,R,c,d,D),x=r.convertDecartPointToGridPoint(F,w),T=r.convertDecartPointToGridPoint(F,R),I=r.findPathOnGrid(F,x,T,c,d)),e=!1;!I&&!e&&t&&A<t.length;A++)e=t[A](i,n);return I&&(I=r.prependPathWithArrowStaffSegment(I,S,c),I=r.appendPathWithArrowStaffSegment(I,E,d),I=r.optimizePath(I)),I}static calculateRelativePosition(e,t,r=!1){const n=r?"top":"start",i=r?"bottom":"end";let s;return s=e[i]<t[n]?0:e[i]<=t[i]&&e[i]>=t[n]&&e[n]<t[n]?1:e[n]>=t[n]&&e[i]<=t[i]?2:e[n]<t[n]&&e[i]>t[i]?-2:e[n]<=t[i]&&e[i]>t[i]?3:4,s}static boxOverlapChanged(e,t,r,n,i=!1){const s=RectangularPathFinder.calculateRelativePosition;return s(e,t,i)!==s(r,n,i)}shouldLookForPath(e,t,r,n){let i=!0;return(e.end-e.start<=this.startArrowMargin||t.end-t.start<=this.endArrowMargin)&&2===Math.abs(RectangularPathFinder.calculateRelativePosition(e,t,!0))&&(i=!RectangularPathFinder.boxOverlapChanged(e,t,r,n)),i}getConnectionCoordinatesFromBoxSideShift(e,t,r){let n;switch(t){case"left":n={x:e.start,y:(e.top+e.bottom)/2+r};break;case"right":n={x:e.end,y:(e.top+e.bottom)/2+r};break;case"top":n={x:(e.start+e.end)/2+r,y:e.top};break;case"bottom":n={x:(e.start+e.end)/2+r,y:e.bottom}}return n}calcGridBaseBoxFromBoxAndDrawParams(e,t,r,n,i){let s;switch(this.normalizeSide(t)){case"left":s={start:e.start-Math.max(r,n),end:e.end+n,top:e.top-i,bottom:e.bottom+i};break;case"right":s={start:e.start-n,end:e.end+Math.max(r,n),top:e.top-i,bottom:e.bottom+i};break;case"top":s={start:e.start-n,end:e.end+n,top:e.top-Math.max(r,i),bottom:e.bottom+i};break;case"bottom":s={start:e.start-n,end:e.end+n,top:e.top-i,bottom:e.bottom+Math.max(r,i)};break;default:s={start:e.start-n,end:e.end+n,top:e.top-i,bottom:e.bottom+i}}return s}normalizeSide(e){const{rtl:t}=this.client;return"start"===e?t?"right":"left":"end"===e?t?"left":"right":e}buildPathGrid(e,t,r,n,i,s,a){let o,l,c,d,u,h,g,p,m,f,v,y,b;const C={},D=[];for(o=[e.start,"left"===i||"right"===i?(e.start+e.end)/2:r.x,e.end,t.start,"left"===s||"right"===s?(t.start+t.end)/2:n.x,t.end],l=[e.top,"top"===i||"bottom"===i?(e.top+e.bottom)/2:r.y,e.bottom,t.top,"top"===s||"bottom"===s?(t.top+t.bottom)/2:n.y,t.bottom],a&&a.forEach((e=>{o.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)})),o=[...new Set(o.sort(((e,t)=>e-t)))],l=[...new Set(l.sort(((e,t)=>e-t)))],h=0,p=l.length;h<p;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=o.length;u<g;++u){if(d=o[u],y=(d<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),a)for(m=0,f=a.length;y&&m<f;++m)v=a[m],y=d<=v.start||d>=v.end||c<=v.top||c>=v.bottom||d===r.x&&c===r.y||d===n.x&&c===n.y;b={distance:Number.MAX_SAFE_INTEGER,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,D.push(b)}return{width:o.length,height:l.length,xs:o,ys:l,points:C,linearPoints:D}}convertDecartPointToGridPoint(e,t){const r=e.xs.indexOf(t.x),n=e.ys.indexOf(t.y);return e.points[n][r]}findPathOnGrid(e,t,r,n,i){const s=this;let a=!1;return t.permitted&&r.permitted&&(e=s.waveForward(e,t,0),a=s.collectPath(e,r,i)),a}getGridPointNeighbors(e,t,r){const n=t.ix,i=t.iy,s=[];let a;return i<e.height-1&&(a=e.points[i+1][n],(!r||r(a))&&s.push(a)),i>0&&(a=e.points[i-1][n],(!r||r(a))&&s.push(a)),n<e.width-1&&(a=e.points[i][n+1],(!r||r(a))&&s.push(a)),n>0&&(a=e.points[i][n-1],(!r||r(a))&&s.push(a)),s}waveForward(e,t,r){const n=this;return WalkHelper.preWalkUnordered([t,r],(([t,r])=>n.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance>r+1)).map((e=>[e,r+1]))),(([e,t])=>e.distance=t)),e}collectPath(e,t,r){const n=this,i=[];let s,a,o,l,c=!0;for(;c&&t.distance;)if(s=n.getGridPointNeighbors(e,t,(e=>e.permitted&&e.distance===t.distance-1)),c=s.length>0,c){switch(s=s.sort(((e,n)=>{let i,s;i=e.ix-t.ix,s=e.iy-t.iy;const a=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;i=n.ix-t.ix,s=n.iy-t.iy;const o=("left"===r||"right"===r)&&0===s||("top"===r||"bottom"===r)&&0===i?-1:1;return a>o?1:a<o?-1:a===o?e.y>n.y?-1:1:void 0})),a=s[0],i.push({x1:a.x,y1:a.y,x2:t.x,y2:t.y}),o=a.ix-t.ix,l=a.iy-t.iy,!0){case!l&&o>0:r="left";break;case!l&&o<0:r="right";break;case!o&&l>0:r="top";break;case!o&&l<0:r="bottom"}t=a}return c&&i.reverse()||!1}prependPathWithArrowStaffSegment(e,t,r){if(e.length>0){const n=e[0],i={x2:n.x1,y2:n.y1};switch(r){case"left":case"right":i.x1=t.x,i.y1=n.y1;break;case"top":case"bottom":i.x1=n.x1,i.y1=t.y}e.unshift(i)}return e}appendPathWithArrowStaffSegment(e,t,r){if(e.length>0){const n=e[e.length-1],i={x1:n.x2,y1:n.y2};switch(r){case"left":case"right":i.x2=t.x,i.y2=n.y2;break;case"top":case"bottom":i.x2=n.x2,i.y2=t.y}e.push(i)}return e}optimizePath(e){const t=[];let r,n;if(e.length>0)for(r=e.shift(),t.push(r);e.length>0;)n=e.shift(),equalEnough(r.x1,n.x1)&&equalEnough(r.y1,n.y1)&&equalEnough(r.x2,n.x2)&&equalEnough(r.y2,n.y2)?r=n:equalEnough(r.y1,r.y2)&&equalEnough(n.y1,n.y2)?r.x2=n.x2:equalEnough(r.x1,r.x2)&&equalEnough(n.x1,n.x2)?r.y2=n.y2:(t.push(n),r=n);return t}};function drawingDirection(e){return e.x1===e.x2?e.y2>e.y1?"d":"u":e.x2>e.x1?"r":"l"}function segmentLength(e){return e.x1===e.x2?e.y2-e.y1:e.x2-e.x1}function arc(e,t,r){const n=drawingDirection(e)+drawingDirection(t),i=r*(n.includes("l")?-1:1),s=r*(n.includes("u")?-1:1);return"a"+i+","+s+" 0 0 "+("ur"===n||"lu"===n||"dl"===n||"rd"===n?1:0)+" "+i+","+s}function line(e,t,r,n,i){let s=e.x1===e.x2?"v":"h",a=n;if(n){const o=segmentLength(e),l=t?Math.abs(segmentLength(t)):Number.MAX_SAFE_INTEGER,c=Math.sign(o);null==i&&(i=n),(Math.abs(o)<2*n||l<2*n)&&(a=Math.min(Math.abs(o),l)/2);const d=o-("single"===r?0:"first"===r?a:"between"===r?i+a:i)*c;s+=Math.sign(d)!==c?0:d,"last"!==r&&"single"!==r&&a>0&&(s+=" "+arc(e,t,a))}else s+=segmentLength(e);return{line:s,currentRadius:n!==a?a:null}}function pathMapper(e,t){const{length:r}=t;if(!r)return"";let n=null;return"M"+t[0].x1+","+t[0].y1+" "+t.map(((i,s)=>{const a=1===r?"single":s===r-1?"last":0===s?"first":"between",o=line(i,t[s+1],a,e,n);return({currentRadius:n}=o),o.line})).join(" ")}RectangularPathFinder._$name="RectangularPathFinder";var DependencyLineGenerator_default=e=>{var t;return t=class extends e{constructor(){super(...arguments),__publicField(this,"lineCache",{})}onSVGReady(){const e=this;e.pathFinder=new RectangularPathFinder({...e.pathFinderConfig,client:e.client}),e.lineDefAdjusters=e.createLineDefAdjusters(),e.createMarker()}changeRadius(e){return null!==e&&ObjectHelper.assertNumber(e,"radius"),e}updateRadius(){this.isConfiguring||this.reset()}updateRenderer(){this.isConfiguring||this.reset()}changeClickWidth(e){return null!==e&&ObjectHelper.assertNumber(e,"clickWidth"),e}updateClickWidth(){this.isConfiguring||this.reset()}createMarker(){var e,t;const r=this,{markerDef:n}=r,i=this.client.svgCanvas,s=n?r.client.id+"-arrowEnd":"arrowEnd";null==(e=r.marker)||e.remove(),i.style.setProperty("--scheduler-dependency-marker","url(#"+s+")"),r.marker=DomHelper.createElement({parent:i,id:s,tag:"marker",className:"b-sch-dependency-arrow",ns:"http://www.w3.org/2000/svg",markerHeight:11,markerWidth:11,refX:8.5,refY:3,viewBox:"0 0 9 6",orient:"auto-start-reverse",markerUnits:"userSpaceOnUse",retainElement:!0,children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:null!=(t=r.markerDef)?t:"M3,0 L3,6 L9,3 z"}]})}updateMarkerDef(){this.isConfiguring||this.createMarker()}getAssignmentElement(e){var t;return(null==(t=this.client.features.eventDrag)?void 0:t.getProxyElement(e))||this.client.getElementFromAssignmentRecord(e)}getDomConfigs(e,t,r,n){var i,s;const a=this,o=a.getDependencyKey(e,t,r),l=a.lineCache[o];if(a.constructLineCache||!l||n||a.drawingLive&&(a.getAssignmentElement(t)||a.getAssignmentElement(r))){const l=a.prepareLineDef(e,t,r,n),c=l&&a.pathFinder.findPath(l,a.lineDefAdjusters),{client:d,clickWidth:u}=a,{toEvent:h}=e;if(c){const n=a.highlighted.get(e),g={tag:"path",ns:"http://www.w3.org/2000/svg",d:pathMapper(null!=(i=a.radius)?i:0,c),role:"presentation",dataset:{syncId:o,depId:e.id,fromId:t.id,toId:r.id},elementData:{dependency:e,points:c},class:{[a.baseCls]:1,[e.cls]:e.cls,[e.highlighted]:e.highlighted,[n&&[...n].join(" ")]:n,[a.noMarkerCls]:l.hideMarker,"b-inactive":!1===e.active,"b-sch-bidirectional-line":e.bidirectional,"b-readonly":e.readOnly,"b-sch-dependency-ends-outside":!h.milestone&&(h.endDate<=d.startDate||d.endDate<=h.startDate)||h.milestone&&(h.endDate<d.startDate||d.endDate<h.startDate)}};null==(s=a.renderer)||s.call(a,{domConfig:g,points:c,dependencyRecord:e,fromAssignmentRecord:t,toAssignmentRecord:r,fromBox:l.startBox,toBox:l.endBox,fromSide:l.startSide,toSide:l.endSide});const p=[g];return u>1&&p.push({...g,class:{...g.class,"b-click-area":1},dataset:{...g.dataset,syncId:g.dataset.syncId+"-click-area"},style:{strokeWidth:u}}),a.lineCache[o]=p}return a.lineCache[o]=null}return l}generateBoundaryBoxes(e,t){return"bottom"===t?[{start:e.left,end:e.left+e.width/2,top:e.rowTop,bottom:e.rowBottom},{start:e.left+e.width/2,end:e.right,top:e.rowTop,bottom:e.rowBottom}]:[{start:e.left-this.pathFinder.startArrowMargin,end:e.right+this.pathFinder.startArrowMargin,top:e.rowTop,bottom:e.rowBottom}]}getAssignmentBounds(e){const{client:t}=this,r=this.getAssignmentElement(e);if(r&&!t.isExporting){const n=Rectangle.from(r,this.relativeTo);if(t.isHorizontal){let r=t.getRowById(e.resource.id);if(n.y<r.top||n.bottom>r.bottom){const e=t.rowManager.getRowAt(n.center.y,!0);e&&(r=e)}n.rowTop=r.top,n.rowBottom=r.bottom}return n}return t.isEngineReady&&t.getAssignmentEventBox(e,!0)}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}getDependencyStartSide(e){const{fromEvent:t,type:r,fromSide:n}=e;if(n)return n;switch(!0){case r===DependencyModel.Type.StartToEnd:case r===DependencyModel.Type.StartToStart:return this.getConnectorStartSide(t);case r===DependencyModel.Type.EndToStart:case r===DependencyModel.Type.EndToEnd:default:return this.getConnectorEndSide(t)}}getDependencyEndSide(e){const{toEvent:t,type:r,toSide:n}=e;if(n)return n;switch(!0){case r===DependencyModel.Type.EndToEnd:case r===DependencyModel.Type.StartToEnd:return this.getConnectorEndSide(t);case r===DependencyModel.Type.EndToStart:case r===DependencyModel.Type.StartToStart:default:return this.getConnectorStartSide(t)}}createLineDefAdjusters(){const{client:e}=this;return[function(t){const{barMargin:r}=e;let n=!1;return(t.startArrowMargin>r||t.endArrowMargin>r)&&(t.startArrowMargin=t.endArrowMargin=r,n=!0),n?t:n},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t},function(e,t){let r=!1;return e.horizontalMargin>2&&(e.horizontalMargin=1,r=!0,t.hideMarker=!0),r?e:r}]}adjustLineDef(e,t){return t}prepareLineDef(e,t,r,n){var i,s;const a=this,o=a.getDependencyStartSide(e),l=a.getDependencyEndSide(e),c=null!=(i=null==n?void 0:n.from)?i:a.getAssignmentBounds(t),d=null!=(s=null==n?void 0:n.to)?s:a.getAssignmentBounds(r),u=[];if(!c||!d)return null;let{startArrowMargin:h,verticalMargin:g}=a.pathFinder;return a.client.isHorizontal&&(null!=c.rowTop&&c.rowTop!==d.rowTop&&u.push(...a.generateBoundaryBoxes(c,o)),e.bidirectional||(/(top|bottom)/.test(o)&&(h=a.client.barMargin/2),g=a.client.barMargin/2)),a.adjustLineDef(e,{startBox:c,endBox:d,otherBoxes:u,startArrowMargin:h,verticalMargin:g,otherVerticalMargin:0,otherHorizontalMargin:0,startSide:o,endSide:l})}beforeDraw(){super.beforeDraw(),Object.keys(this.lineCache).length||(this.constructLineCache=!0)}afterDraw(){super.afterDraw(),this.constructLineCache=!1}reset(){super.reset(),this.lineCache={}}},__publicField(t,"$name","DependencyLineGenerator"),t},fromBoxSide=["start","start","end","end"],toBoxSide=["start","end","start","end"],DependencyTooltip_default=e=>{var t;return __publicField(t=class extends e{changeTooltip(e,t){const r=this;return null==t||t.destroy(),r.showTooltip&&e?Tooltip.new({align:"b-t",id:r.client.id+"-dependency-tip",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) ."+r.baseCls,forElement:r.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,textContent:!1,trackMouse:!1,getHtml:r.getHoverTipHtml.bind(r)},e):null}getHoverTipHtml({activeTarget:e}){return this.tooltipTemplate(this.resolveDependencyRecord(e))}},"$name","DependencyTooltip"),__publicField(t,"configurable",{showTooltip:!0,tooltipTemplate(e){return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:this.L("L{Dependencies.from}")},{text:e.fromEvent.name},{className:"b-sch-box b-"+(e.fromSide||fromBoxSide[e.type])},{tag:"label",text:this.L("L{Dependencies.to}")},{text:e.toEvent.name},{className:"b-sch-box b-"+(e.toSide||toBoxSide[e.type])}]}]}},tooltip:{$config:"nullify",value:{}}}),t},eventNameMap={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},collectLinkedAssignments=e=>{var t;const r=[e];return(null==(t=e.resource)?void 0:t.hasLinks)&&r.push(...e.resource.$links.map((t=>({id:t.id+"_"+e.id,resource:t,event:e.event,drawDependencies:e.drawDependencies})))),r},Dependencies=class extends(InstancePlugin.mixin(AttachToProjectMixin_default,Delayable_default,DependencyCreation_default,DependencyGridCache_default,DependencyLineGenerator_default,DependencyTooltip_default)){constructor(){super(...arguments),__publicField(this,"domConfigs",new Map),__publicField(this,"drawingLive",!1),__publicField(this,"lastScrollX",null),__publicField(this,"highlighted",new Map),__publicField(this,"visibleResources",null),__publicField(this,"usingLinks",null),__publicField(this,"visibleDateRange",null),__publicField(this,"relativeTo",null)}static get pluginConfig(){return{chain:["render","onPaint","onElementClick","onElementDblClick","onElementContextMenu","onElementMouseOver","onElementMouseOut","bindStore"],assign:["getElementForDependency","getElementsForDependency","resolveDependencyRecord"]}}construct(e,t){super.construct(e,t);const{scheduledEventName:r}=e;e.ion({svgCanvasCreated:"onSVGReady",animationStart:"refresh",[r+"DragStart"]:"refresh",[r+"DragAbort"]:"refresh",[r+"ResizeStart"]:"refresh",[r+"SegmentDragStart"]:"refresh",[r+"SegmentResizeStart"]:"refresh",timelineViewportResize:"reset",timeAxisViewModelUpdate:"reset",toggleNode:"reset",thisObj:this}),e.rowManager.ion({refresh:"reset",changeTotalHeight:"reset",thisObj:this}),this.bindStore(e.store)}doDisable(e){this.isConfiguring||(this._isDisabling=e,this.draw(),this._isDisabling=!1),super.doDisable(e)}get rowStore(){return this.client.isVertical?this.client.resourceStore:this.client.store}bindStore(e){const t=this;t.client.isVertical||(t.detachListeners("store"),t.client.usesDisplayStore&&(null==e||e.ion({name:"store",refresh:"onStoreRefresh",thisObj:t}),t.reset()))}onStoreRefresh(){this.reset()}attachToProject(e){super.attachToProject(e),null==e||e.ion({name:"project",commitFinalized:"reset",thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",change:"onResourceStoreChange",refresh:"onResourceStoreChange",thisObj:this})}onResourceStoreChange(){this.usingLinks=null,this.reset()}attachToEventStore(e){super.attachToEventStore(e),null==e||e.ion({name:"eventStore",refresh:"reset",thisObj:this})}attachToAssignmentStore(e){super.attachToAssignmentStore(e),null==e||e.ion({name:"assignmentStore",refresh:"reset",thisObj:this})}attachToDependencyStore(e){super.attachToDependencyStore(e),null==e||e.ion({name:"dependencyStore",change:"reset",refresh:"reset",thisObj:this})}updateDrawOnScroll(e){const t=this;t.detachListeners("scroll"),e?t.client.ion({name:"scroll",scroll:"doRefresh",horizontalScroll:"onHorizontalScroll",prio:-100,thisObj:t}):(t.client.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}),t.client.timeAxisSubGrid.scrollable.ion({name:"scroll",scrollEnd:"draw",thisObj:t}))}onHorizontalScroll({subGrid:e,scrollX:t}){t!==this.lastScrollX&&e===this.client.timeAxisSubGrid&&(this.lastScrollX=t,this.draw())}onPaint(){this.refresh()}static getLocalizedDependencyType(e){return e?this.L("L{DependencyType."+e+"}"):""}getElementForDependency(e,t,r){return this.getElementsForDependency(e,t,r)[0]}getElementsForDependency(e,t,r){let n='[data-dep-id="'+e.id+'"]';return t&&(n+='[data-from-id="'+t.id+'"]'),r&&(n+='[data-to-id="'+r.id+'"]'),Array.from(this.client.svgCanvas.querySelectorAll(n))}resolveDependencyRecord(e){var t;return null==(t=e.elementData)?void 0:t.dependency}isDependencyElement(e){return e.matches("."+this.baseCls)}onElementClick(e){const t=this.resolveDependencyRecord(e.target);if(t){const r=eventNameMap[e.type];this.client.trigger("dependency"+r,{dependency:t,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementContextMenu(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this,r=t.resolveDependencyRecord(e.target);r&&(t.client.trigger("dependencyMouseOver",{dependency:r,event:e}),t.overCls&&t.highlight(r))}onElementMouseOut(e){const t=this,r=t.resolveDependencyRecord(e.target);r&&(t.client.trigger("dependencyMouseOut",{dependency:r,event:e}),t.overCls&&t.unhighlight(r))}isDependencyVisible(e){const{rowStore:t}=this,{fromEvent:r,toEvent:n}=e;if(!r||!n)return!1;const i=r.resource,s=n.resource;return!(!t.isAvailable(i)||!t.isAvailable(s))&&(r.isModel&&!i.instanceMeta(t).hidden&&!s.instanceMeta(t).hidden)}updateHighlightDependenciesOnEventHover(e){const t=this;if(e){const{client:e}=t;e.ion({name:"highlightOnHover",[e.scheduledEventName+"MouseEnter"]:e=>t.highlightEventDependencies(e.eventRecord||e.taskRecord),[e.scheduledEventName+"MouseLeave"]:e=>t.unhighlightEventDependencies(e.eventRecord||e.taskRecord),thisObj:t})}else t.detachListeners("highlightOnHover")}highlight(e,t=this.overCls){let r=this.highlighted.get(e);r||this.highlighted.set(e,r=new Set),r.add(t);for(const r of this.getElementsForDependency(e))r.classList.add(t)}unhighlight(e,t=this.overCls){const r=this.highlighted.get(e);r&&(r.delete(t),r.size||this.highlighted.delete(e));for(const r of this.getElementsForDependency(e))r.classList.remove(t)}highlightEventDependencies(e,t){e.dependencies.forEach((e=>this.highlight(e,t)))}unhighlightEventDependencies(e,t){e.dependencies.forEach((e=>this.unhighlight(e,t)))}getDependenciesToConsider(e,t,r,n){var i,s;return null!=(s=null==(i=super.getDependenciesToConsider)?void 0:i.call(this,e,t,r,n))?s:this.project.dependencyStore.records.filter((e=>e.isValid))}getDependencyKey(e,t,r){return"dep:"+e.id+";from:"+t.id+";to:"+r.id}drawDependency(e,t=!1,r=null){var n,i,s,a;const o=this,{domConfigs:l,client:c,rowStore:d,topIndex:u,bottomIndex:h}=o,{eventStore:g,useInitialAnimation:p}=c,{idMap:m}=d,{startMS:f,endMS:v}=o.visibleDateRange,{fromEvent:y,toEvent:b}=e;let C=y.assigned,D=b.assigned;if(y.isScheduled&&b.isScheduled&&g.includes(y)&&g.includes(b)&&(null==C?void 0:C.size)&&(null==D?void 0:D.size)){o.usingLinks&&(C=[...C].flatMap(collectLinkedAssignments),D=[...D].flatMap(collectLinkedAssignments));for(const t of C)for(const g of D){const C=null==(i=m[null==(n=t.resource)?void 0:n.id])?void 0:i.index,D=null==(a=m[null==(s=g.resource)?void 0:s.id])?void 0:a.index,S=Math.min(y.startDateMS,b.startDateMS),E=Math.max(y.endDateMS,b.endDateMS);if(c.isExporting||null!=C&&null!=D&&!1!==t.drawDependencies&&!1!==g.drawDependencies&&d.isAvailable(t.resource)&&d.isAvailable(g.resource)&&!(C<u&&D<u||C>h&&D>h||S<f&&E<f||S>v&&E>v)){const n=o.getDependencyKey(e,t,g),i=o.getDomConfigs(e,t,g,r);i?(p&&(i[0].style={animationDelay:Math.max(C,D)/20*1e3+"ms"}),l.set(n,i)):l.delete(n)}o.afterDrawDependency(e,C,D,S,E)}}t||o.domSync()}afterDrawDependency(e,t,r,n,i){var s;null==(s=super.afterDrawDependency)||s.call(this,e,t,r,n,i)}beforeDraw(){var e;null==(e=super.beforeDraw)||e.call(this)}afterDraw(){var e;null==(e=super.afterDraw)||e.call(this)}domSync(e=this.client.svgCanvas){DomSync.sync({targetElement:e,domConfig:{onlyChildren:!0,children:Array.from(this.domConfigs.values()).flat()},syncIdField:"syncId",releaseThreshold:0,strict:!0,callback(){}})}fillDrawingCache(){const e=this,{client:t}=e;e.relativeTo=Rectangle.from(t.foregroundCanvas),e.visibleResources=t.visibleResources,e.visibleDateRange=t.visibleDateRange,e.topIndex=e.rowStore.indexOf(e.visibleResources.first),e.bottomIndex=e.rowStore.indexOf(e.visibleResources.last),null==e.usingLinks&&(e.usingLinks=t.resourceStore.some((e=>e.hasLinks)))}draw(){const e=this,{client:t}=e;if(!t.refreshSuspended&&t.foregroundCanvas&&t.isEngineReady&&(!e.disabled||e._isDisabling)&&!t.isExporting){if(e.fillDrawingCache(),e.domConfigs.clear(),t.firstVisibleRow&&t.lastVisibleRow&&t.timeAxis.count&&!e.disabled&&e.visibleDateRange.endMS-e.visibleDateRange.startMS>0){const{visibleDateRange:r}=t,{topIndex:n,bottomIndex:i}=e,s=e.getDependenciesToConsider(r.startMS,r.endMS,n,i);e.beforeDraw();for(const t of s)e.drawDependency(t,!0);e.afterDraw()}e.domSync(),t.trigger("dependenciesDrawn")}}doRefresh(){var e,t,r,n;const i=this,{client:s}=i,{scheduledEventName:a}=s;i.draw(),i.drawingLive=s.dependencyStore.count&&(s.isAnimating||s.useInitialAnimation&&s.eventStore.count||(null==(e=s.features[a+"Drag"])?void 0:e.isActivelyDragging)||(null==(t=s.features[a+"Resize"])?void 0:t.isResizing)||(null==(r=s.features[a+"SegmentDrag"])?void 0:r.isActivelyDragging)||(null==(n=s.features[a+"SegmentResize"])?void 0:n.isResizing)),i.drawingLive&&i.refresh()}refresh(){const{client:e}=this;e.refreshSuspended||this.disabled||!e.isPainted||e.timeAxisSubGrid.collapsed||this.doRefresh()}reset(){var e;null==(e=super.reset)||e.call(this),this.refresh()}drawForEvent(){VersionHelper.deprecate("Scheduler","6.0.0","Dependencies.drawForEvent() is no longer needed"),this.refresh()}render(){this.client.getConfig("svgCanvas")}};__publicField(Dependencies,"$name","Dependencies"),__publicField(Dependencies,"configurable",{overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",noMarkerCls:"b-sch-dependency-markerless",markerDef:null,radius:null,renderer:null,highlightDependenciesOnEventHover:null,drawOnScroll:!0,clickWidth:null}),__publicField(Dependencies,"delayable",{doRefresh:10}),Dependencies._$name="Dependencies",GridFeatureManager.registerFeature(Dependencies,!1,["Scheduler","ResourceHistogram"]),GridFeatureManager.registerFeature(Dependencies,!0,"SchedulerPro");var DependencyEditor=class extends Popup{static get $name(){return"DependencyEditor"}static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const{dependencyEditFeature:t}=this;return!("lagField"===e.ref&&!t.showLagField)&&(!("deleteButton"===e.ref&&!t.showDeleteButton)&&super.processWidgetConfig(e))}afterShow(...e){const{deleteButton:t}=this.widgetMap;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}};DependencyEditor._$name="DependencyEditor";var DependencyEdit=class extends InstancePlugin{static get $name(){return"DependencyEdit"}static get configurable(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,defaults:{localeClass:this},items:{fromNameField:{type:"display",weight:100,label:"L{From}"},toNameField:{type:"display",weight:200,label:"L{To}"},typeField:{type:"combo",weight:300,label:"L{Type}",name:"type",editable:!1,valueField:"id",displayField:"name",localizeDisplayFields:!0,buildItems:function(){const e=this.parent;return Object.keys(DependencyModel.Type).map((t=>({id:DependencyModel.Type[t],name:e.L(t),localeKey:t})))}},lagField:{type:"duration",weight:400,label:"L{Lag}",name:"lag",allowNegative:!0}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler"},saveButton:{color:"b-blue",text:"L{Save}"},deleteButton:{color:"b-red",text:"L{Delete}"},cancelButton:{color:"b-gray",text:"L{Object.Cancel}"}}}}}}construct(e,t){const r=this;if(e.dependencyEdit=r,super.construct(e,t),!e.features.dependencies)throw new Error("使用DependencyEdit时需要依赖项功能");r.clientListenersDetacher=e.ion({[r.triggerEvent]:r.onActivateEditor,thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null==(e=this.editor)||e.destroy(),super.doDestroy()}changeEditorConfig(e){const{autoClose:t,cls:r,client:n}=this;return ObjectHelper.assign({owner:n,align:"b-t",id:n.id+"-dependency-editor",autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],constrainTo:globalThis,autoClose:t,cls:r},e)}get isValid(){return Object.values(this.editor.widgetMap).every((e=>!(e.name&&!e.hidden)||!1!==e.isValid))}get values(){const e={};return this.editor.eachWidget((t=>{t.name&&!t.hidden&&(e[t.name]=t.value)}),!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;t.lag&&(t.lagUnit=t.lag.unit,t.lag=t.lag.magnitude),"type"in t&&(null!=e.fromSide&&(t.fromSide=null),null!=e.toSide&&(t.toSide=null)),ObjectHelper.cleanupProperties(t,!0),e.set(t)}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,{client:r}=t;let n=t.lastPointerDownCoordinate;if(!1===r.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const i=t.getEditor(e);if(t.loadRecord(e),r.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:i}),!n){const e=Rectangle.from(t.client.element).center;n=[e.x-i.width/2,e.y-i.height/2]}i.showBy(n)}editDependency(e){this.client.readOnly||e.readOnly||this.internalShowEditor(e)}getEditor(){var e,t,r;const n=this;let{editor:i}=n;return i||(i=n.editor=DependencyEditor.new({dependencyEditFeature:n,autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,autoClose:n.autoClose,cls:n.cls,rootElement:n.client.rootElement,internalListeners:{keydown:n.onPopupKeyDown,thisObj:n}},n.editorConfig),0===i.items.length&&console.warn("Editor configured without any `items`"),i.eachWidget((e=>{const t=e.ref||e.id;t&&!n[t]&&(n[t]=e)})),null==(e=n.saveButton)||e.ion({click:"onSaveClick",thisObj:n}),null==(t=n.deleteButton)||t.ion({click:"onDeleteClick",thisObj:n}),null==(r=n.cancelButton)||r.ion({click:"onCancelClick",thisObj:n}),n.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.fromEvent.name,t.toNameField.value=e.toEvent.name,t.lagField&&(t.lagField.value=new Duration(e.lag,e.lagUnit)),t.editor.record=t.dependencyRecord=e}async save(){var e;const t=this,{client:r,dependencyRecord:n}=t;if(!n||!t.isValid)return;const{dependencyStore:i,values:s}=t;if(!1!==r.trigger("beforeDependencySave",{dependencyRecord:n,values:s})){if(t.onBeforeSave(n),t.updateRecord(n),i&&!n.stores.length){if(!1===r.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:t}))return;i.add(n)}await(null==(e=r.project)?void 0:e.commitAsync()),r.trigger("afterDependencySave",{dependencyRecord:n}),t.onAfterSave(n)}return n}async deleteDependency(){var e;const{client:t,editor:r,dependencyRecord:n}=this;return!1!==t.trigger("beforeDependencyDelete",{dependencyRecord:n})&&(r.containsFocus&&r.revertFocus(),t.dependencyStore.remove(n),await(null==(e=t.project)?void 0:e.commitAsync()),!0)}get dependencyStore(){return this.client.dependencyStore}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}};DependencyEdit._$name="DependencyEdit",GridFeatureManager.registerFeature(DependencyEdit,!1);var ScheduleContext=class extends(InstancePlugin.mixin(Delayable_default)){static get $name(){return"ScheduleContext"}construct(e,t){super.construct(e,t);const{triggerEvent:r}=this,n={datachange:"syncContextElement",timeaxisviewmodelupdate:"onTimeAxisViewModelUpdate",presetchange:"clearContext",thisObj:this};"mouseover"===r?n.timelineContextChange="onTimelineContextChange":("click"!==r&&"mousedown"!==r||(n.schedulecontextmenu="onScheduleContextGesture"),Object.assign(n,{["schedule"+r]:"onScheduleContextGesture",["event"+r]:"onScheduleContextGesture",...n})),e.useBackgroundCanvas=!0,e.ion(n),e.rowManager.ion({rowheight:"syncContextElement",thisObj:this})}changeTriggerEvent(e){return"hover"!==e&&"mousemove"!==e||(e="mouseover"),e}get element(){return this._element||(this._element=DomHelper.createElement({parent:this.client.backgroundCanvas,className:"b-schedule-selected-tick"}))}onTimelineContextChange({context:e}){this.context=e}onScheduleContextGesture(e){this.context=e}onTimeAxisViewModelUpdate({source:e}){var t;e.timeAxis.includes(null==(t=this.context)?void 0:t.tick)?this.syncContextElement():this.clearContext()}clearContext(){this.context=null}updateContext(e,t){this.syncContextElement()}syncContextElement(){if(this.context&&this.enabled){const e=this,{client:t,element:r,context:n,renderer:i}=e,{isVertical:s}=t,{style:a}=r,o=s?t.rowManager.rows[0]:t.getRowFor(n.resourceRecord);if(o){const{tickStartDate:l,tickEndDate:c,resourceRecord:d}=n,u=t.currentOrientation.getTimeSpanRenderData({startDate:l,endDate:c,startDateMS:l.getTime(),endDateMS:c.getTime()},d);let h,g,p;s?(h=u.top,g=u.resourceWidth,p=u.height):(h=o.top,g=u.width,p=o.height),a.display="",a.width=g+"px",a.height=p+"px",DomHelper.setTranslateXY(r,u.left,h),n.index=o.index,r.innerHTML="",i&&e.callback(i,e,[n,r])}else a.display="none"}else this.element.style.display="none"}};__publicField(ScheduleContext,"delayable",{syncContextElement:"raf"}),__publicField(ScheduleContext,"configurable",{triggerEvent:"click",renderer:null,context:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}}}),ScheduleContext.featureClass="b-scheduler-context",ScheduleContext._$name="ScheduleContext",GridFeatureManager.registerFeature(ScheduleContext,!1,["Scheduler"]);var EventCopyPaste=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"clipboardRecords",[]),__publicField(this,"entityName","event")}construct(e,t){super.construct(e,t),e.ion({eventclick:this.onEventClick,scheduleclick:this.onScheduleClick,projectChange:()=>{this.clearClipboard(),this._cellClickedContext=null},thisObj:this}),this.scheduler=e}onEventDataGenerated(e){const{assignmentRecord:t}=e;t&&(e.cls["b-cut-item"]=t.meta.isCut)}onEventClick(e){this._cellClickedContext=null}onScheduleClick(e){this._cellClickedContext=e}isActionAvailable(e,t,r){var n;const i=this.client.features.cellEdit;return!this.disabled&&0===globalThis.getSelection().toString().length&&!(null==i?void 0:i.isEditing)&&Boolean(r.target.closest(".b-timeaxissubgrid"))&&!(null==(n=this.client.focusedCell)?void 0:n.isSpecialRow)}copy(){this.copyEvents()}cut(){this.copyEvents(void 0,!0)}paste(){this.pasteEvents()}copyEvents(e=this.scheduler.selectedAssignments,t=!1){const r=this,{scheduler:n,entityName:i}=r;if(!(null==e?void 0:e.length))return;let s=e.slice();e[0].isEventModel&&(s=e.map((e=>e.assignments)).flat()),t&&(s=s.filter((e=>!e.event.readOnly)));const a=s.map((e=>e.event));s.length&&!n.readOnly&&!1!==n.trigger("beforeCopy",{assignmentRecords:s,records:a,eventRecords:a,isCut:t,entityName:i})&&(s.length>0&&n.trigger("copy",{assignmentRecords:s,eventRecords:a,isCut:t,entityName:i}),r._isCut=t,r.clipboard={assignmentRecords:s,eventRecords:a},n.assignmentStore.forEach((e=>{e.meta.isCut=t&&s.includes(e)})),n.refreshWithTransition())}pasteEvents(e,t){const r=this,{clipboard:n,scheduler:i,entityName:s}=r,{assignmentRecords:a,eventRecords:o}=n,l=r._isCut;let c;if(0===arguments.length){const n=r._cellClickedContext||{};e=n.date,t=n.resourceRecord}if(t&&(t.readOnly&&(c="resourceReadOnly"),t=t.$original),!i.allowOverlap){a.some((e=>!i.isDateRangeAvailable(e.event.startDate,e.event.endDate,l?e.event:null,e.resource)))&&(c="overlappingEvents")}if(c)return void i.trigger("pasteNotAllowed",{assignmentRecords:a,records:o,eventRecords:o,resourceRecord:t||a[0].resource,date:e,isCut:l,entityName:s,reason:c});if(!n||!1===i.trigger("beforePaste",{assignmentRecords:a,records:o,eventRecords:o,resourceRecord:t||a[0].resource,date:e,isCut:l,entityName:s}))return;let d=null;const u=new Set;for(const n of a){let{event:s}=n;const a=t||n.resource,o=e||n.event.startDate;if(u.has(s))l&&n.remove();else{if(u.add(s),l)n.meta.isCut=!1,n.resource=a,d=n;else if(i.eventStore.usesSingleAssignment||"clone"===r.copyPasteAction)s=s.copy(),s.name=r.generateNewName(s),i.eventStore.add(s),s.assign(a),d=i.assignmentStore.last;else if(!s.resources.includes(a)){const e=n.copy();e.resource=a,[d]=i.assignmentStore.add(e)}s.startDate=o,s.constraintDate&&(s.constraintDate=null)}}n&&i.trigger("paste",{assignmentRecords:a,eventRecords:o,resourceRecord:t,date:e,isCut:l,entityName:s});const h=i.ion({renderEvent({assignmentRecord:e}){e===d&&(i.navigateTo(e,{scrollIntoView:!1}),h())}});l&&r.clearClipboard()}clearClipboard(){const e=this;e._isCut&&(e.clipboard.assignmentRecords.forEach((e=>{e.meta.isCut=!1})),e.scheduler.refreshWithTransition(),e._isCut=!1),e.clipboard=null}populateEventMenu({assignmentRecord:e,items:t}){const r=this,{scheduler:n}=r;n.readOnly||(t.copyEvent={text:"L{copyEvent}",localeClass:r,icon:"gt-icon gt-icon-copy",weight:110,onItem:()=>{const t=n.isAssignmentSelected(e)?n.selectedAssignments:[e];r.copyEvents(t)}},t.cutEvent={text:"L{cutEvent}",localeClass:r,icon:"gt-icon gt-icon-cut",weight:120,disabled:e.event.readOnly,onItem:()=>{const t=n.isAssignmentSelected(e)?n.selectedAssignments:[e];r.copyEvents(t,!0)}})}populateScheduleMenu({items:e,resourceRecord:t}){const r=this,{scheduler:n}=r;!n.readOnly&&r.clipboard&&(e.pasteEvent={text:"L{pasteEvent}",localeClass:r,icon:"gt-icon gt-icon-paste",disabled:0===n.resourceStore.count||t.readOnly,weight:110,onItem:({date:e,resourceRecord:t})=>r.pasteEvents(e,t,n.getRowFor(t))})}generateNewName(e){const t=e[this.nameField];let r=2;for(;this.client.eventStore.findRecord(this.nameField,t+" - "+r);)r++;return t+" - "+r}};__publicField(EventCopyPaste,"$name","EventCopyPaste"),__publicField(EventCopyPaste,"pluginConfig",{assign:["copyEvents","pasteEvents"],chain:["populateEventMenu","populateScheduleMenu","onEventDataGenerated"]}),__publicField(EventCopyPaste,"configurable",{nameField:"name",keyMap:{"Ctrl+C":"copy","Ctrl+X":"cut","Ctrl+V":"paste"},copyPasteAction:"clone"}),EventCopyPaste.featureClass="b-event-copypaste",EventCopyPaste._$name="EventCopyPaste",GridFeatureManager.registerFeature(EventCopyPaste,!0,"Scheduler");var EventDrag=class extends DragBase{static get $name(){return"EventDrag"}static get configurable(){return{constrainDragToResource:!1,constrainDragToTimeSlot:!1,externalDropTargetSelector:null,validatorFn:(e,t)=>{},validatorFnThisObj:null,unifiedDrag:null,snapToPosition:null,copyKey:"SHIFT",copyMode:"auto",mode:"move",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changeMode(e){const{dragData:t,copyMode:r}=this;if(("event"===r||"auto"===r||"assignment"===r&&!this.scheduler.eventStore.usesSingleAssignment)&&(!t||t.eventRecords.every((e=>!e.isRecurring))))return e}updateMode(e){this.dragData&&("copy"===e?this.setCopying():this.setMoving(),this.client.trigger("eventDragModeChange",{mode:e}))}setCopying(){const{dragData:e}=this;e&&(e.eventBarCopies.some((e=>e.isConnected))?e.eventBarCopies.forEach((e=>{e.classList.remove("b-hidden")})):e.eventBarCopies.forEach((t=>{t.classList.add("b-drag-proxy-copy"),t.classList.remove("b-hidden"),e.context.grabbedParent.appendChild(t),t.retainElement=!0})))}setMoving(){const{dragData:e}=this;e&&e.eventBarCopies.forEach((e=>{e.classList.add("b-hidden")}))}get scheduler(){return this.client}onAfterDragStart(e){const t=this,{context:{element:r}}=e;super.onAfterDragStart(e),t.handleKeyDownOrMove(e.event),t.keyEventDetacher=EventHelper.on({element:DomHelper.getRootElement(r),keydown:t.handleKeyDownOrMove,keyup:t.handleKeyUp,thisObj:t})}onDragReset(e){var t;super.onDragReset(e),null==(t=this.keyEventDetacher)||t.call(this),this.mode="move"}onDrop(e){var t;return null==(t=this.dragData.eventBarCopies)||t.forEach((e=>e.remove())),super.onDrop(e)}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveEventRecord(e)}isElementDraggable(e,t){var r;const n=this,{client:i}=n,s=n.getDraggableElement(e);if(!s||n.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const a=n.resolveEventRecord(s,i);if(!a||!a.isDraggable||a.readOnly)return!1;return!(!1===(null==(r=i["is"+n.capitalizedEventName+"ElementDraggable"])?void 0:r.call(i,s,a,e,t)))}getTriggerParams(e){const{assignmentRecords:t,eventRecords:r,resourceRecord:n,browserEvent:i}=e;return{context:e,eventRecords:r,resourceRecord:n,assignmentRecords:t,event:i,domEvent:i}}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("eventDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate,newResource:e.newResource}))}triggerDragStart(e){this.client.navigator.skipNextClick=!0,this.client.trigger("eventDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.client.trigger("eventDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.client.trigger("eventDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){const r=this;if(r.currentOverClient.trigger("afterEventDrop",Object.assign(r.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=r.client;r.dragData.initialAssignmentsState.find((({resource:n,assignment:i},s)=>{var a;return!e.includes(i)||!t.includes(i.event)||n.id!==(null==(a=r.dragData.assignmentRecords[s])?void 0:a.resourceId)}))&&r.client.refresh()}r.client.setTimeout((()=>r.client.navigator.skipNextClick=!1),10)}handleKeyDownOrMove(e){"copy"!==this.mode&&(e.key&&EventHelper.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()||e[this.copyKey.toLowerCase()+"Key"])&&(this.mode="copy")}handleKeyUp(e){EventHelper.specialKeyFromEventKey(e.key)===this.copyKey.toLowerCase()&&(this.mode="move")}isValidDrop(e){const{newResource:t,resourceRecord:r}=e,n=e.draggedEntities[0];return t?!t.isSpecialRow&&!t.readOnly&&(r===t||!n.event.resources.includes(t)):!(this.constrainDragToTimeline||!this.externalDropTargetSelector)&&Boolean(e.browserEvent.target.closest(this.externalDropTargetSelector))}checkDragValidity(e,t){var r,n,i;const s=this,a=s.currentOverClient;let o;return!(null==(r=e.newResource)?void 0:r.readOnly)&&(o=a.allowOverlap||a.isDateRangeAvailable(e.startDate,e.endDate,e.draggedEntities[0],e.newResource)?s.validatorFn.call(s.validatorFnThisObj||s,e,t):{valid:!1,message:s.L("L{eventOverlapsExisting}")},o&&!o.valid||(o=null!=(i=null==(n=a.checkEventDragValidity)?void 0:n.call(a,e,t))?i:o),o)}async updateRecords(e){const t=this,r=t.client,n=t.currentOverClient,i="copy"===t.mode,{draggedEntities:s,timeDiff:a,initialAssignmentsState:o}=e,l=o[0].startDate,c=t.adjustStartDate(l,a);let d;return e.externalDropTarget||(n.timeAxis.timeSpanInAxis(c,DateHelper.add(c,s[0].event.durationMS,"ms"))||(e.valid=!1),e.valid&&(r.eventStore.suspendAutoCommit(),n.eventStore.suspendAutoCommit(),d=await t.updateAssignments(r,n,e,i),r.eventStore.resumeAutoCommit(),n.eventStore.resumeAutoCommit())),e.valid&&n.trigger("eventDrop",Object.assign(t.getTriggerParams(e),{isCopy:i,copyMode:t.copyMode,domEvent:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),d}async updateAssignments(e,t,r,n){const i=this,{copyMode:s}=i,a=e!==t,{isVertical:o}=t,{assignmentStore:l,eventStore:c}=e,{assignmentStore:d,eventStore:u}=t,h=e.isVertical?e.resourceStore:e.store,g=o?t.resourceStore:t.store,{eventRecords:p,assignmentRecords:m,timeDiff:f,initialAssignmentsState:v,resourceRecord:y,newResource:b}=r,{unifiedDrag:C}=i,D=u.usesSingleAssignment||!1!==u.usesSingleAssignment&&c.usesSingleAssignment,S=i.adjustStartDate(m[0].event.startDate,f),E=[],w=[],R=[],x=[],T=[],M=new Set,P=h.getAllDataRecords();e.suspendRefresh(),t.suspendRefresh();let F,I=!1,A=!1;F=a?g.indexOf(b)-h.indexOf(y):i.constainDragToResource?0:o&&g.isGrouped?P.indexOf(y)-P.indexOf(b):h.indexOf(y)-h.indexOf(b),o&&p.forEach(((t,n)=>{const i=r.eventBarEls[n];delete t.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const O=r.eventBarEls.slice(),k=[],_={};for(let e=0;e<m.length;e++){const p=m[e];let y,H=p.event;if(n?(y=p.copy(),_[p.id]=y):y=p,!(y.isOccurrenceAssignment||l.includes(p)&&c.includes(H))){O[e].remove(),O.splice(e,1),m.splice(e,1),e--;continue}const L=v[e],j=H,B=L.startDate,V=L.resource,N=this.constrainDragToTimeSlot?B:C?S:i.adjustStartDate(B,f);if(l!==d){const e=j.assignments.length>1||n;let t;n?t=y:(t=y.copy(),_[y.id]=t),t.event&&!D&&(t.event=t.event.id,t.resource=t.resource.id),n||x.push(y),e||w.push(j),(n&&("event"===s||"auto"===s&&u.usesSingleAssignment)||!u.getById(j.id))&&(H=u.createRecord({...j.data,id:!n||"event"!==s&&"auto"!==s?j.id:void 0,calendar:null}),t.set({eventId:H.id,event:H}),E.push(H)),D||R.push(t),y=t}let z=b,$=null;if(!C)if(a){if(e>0){const e=h.indexOf(V);z=g.getAt(e+F)||z}}else if(0!==F){let e;o&&g.isGrouped?(e=Math.max(Math.min(P.indexOf(V)-F,P.length-1),0),z=P[e]):(e=Math.max(Math.min(h.indexOf(V)-F,h.count-1),0),z=h.getAt(e),z.isSpecialRow&&(z=h.getNext(z,!1,!0)||h.getPrevious(z,!1,!0))),z=null==z?void 0:z.$original}else z=V;if(y.resourceId!==z.id?($=h.getById(y.resourceId),n&&l===d?(y.resource=z,y.event=u.getById(y.eventId),("event"===s||c.usesSingleAssignment&&"auto"===s)&&(H=H.copy(),y.event=H,u.usesSingleAssignment&&(H.resource=z,H.resourceId=z.id)),d.find((e=>e.eventId===y.eventId&&e.resourceId===y.resourceId))||R.find((e=>e.eventId===y.eventId&&e.resourceId===y.resourceId))||(E.push(H),R.push(y))):y.resource=z,H.isEvent&&M.add(H),I=!0,H.isOccurrence&&H.set("newResource",z),a&&D&&(H.resourceId=z.id)):n&&("event"===s||"auto"===s&&c.usesSingleAssignment)&&!E.includes(H)&&(H=H.copy(),E.push(H),y.event=H,u.usesSingleAssignment&&H.set({resource:z,resourceId:z.id}),R.push(y)),!T.find((e=>e.draggedEvent===H))&&!DateHelper.isEqual(H.startDate,N)){for(;!H.isOccurrence&&H.isBatchUpdating;)H.endBatch(!0);H.startDate=N,T.push({draggedEvent:H,originalStartDate:B}),H.isEvent&&M.add(H),A=!0}t.processEventDrop({eventRecord:H,resourceRecord:z,element:0===e?r.context.element:r.context.relatedElements[e-1],context:r,toScheduler:t,reassignedFrom:$,eventsToAdd:E,addedEvents:k,draggedAssignment:y}),t.trigger("processEventDrop",{originalAssignment:p,draggedAssignment:y,context:r,copyMode:s,isCopy:n})}if(l.remove(x),c.remove(w),d.add(R),n&&l===d){const{syncIdMap:t}=e.foregroundCanvas;Object.entries(_).forEach((([e,r])=>{const n=t[e];delete t[e],t[r.id]=n}))}if(E.length&&k.push(...u.add(E)),!i.constrainDragToTimeline)for(let e=0;e<m.length;e++){const i=(_[m[e].id]||m[e]).event,s=(null==k?void 0:k.find((e=>e.id===i.id)))||i,l=r.eventBarEls[e],c=0===e?r.context.element:r.context.relatedElements[e-1],d=t.isInTimeAxis(s);if(n||DomSync.removeChild(l.parentElement,l),s.resource&&(o||t.rowManager.getRowFor(s.resource))&&d){if(!s.parent||s.parent.isRoot){const e=Rectangle.from(c,t.foregroundCanvas,!0);DomHelper.setTopLeft(c,e.y,e.x),DomSync.addChild(t.foregroundCanvas,c,s.assignments[0].id),a&&t.processCrossSchedulerEventDrop({eventRecord:s,toScheduler:t})}c.classList.remove("b-sch-event-hover","b-active","b-drag-proxy","b-dragging"),c.retainElement=!1}}null==k||k.forEach((e=>M.add(e))),(x.length||w.length||R.length||E.length)&&(I=!0),(I||A)&&(D&&M.forEach((e=>e.beginBatch())),await Promise.all([t.project!==e.project?t.project.commitAsync():null,e.project.commitAsync()]),D&&M.forEach((e=>e.endBatch(!1,!0)))),I||(I=T.some((({draggedEvent:e,originalStartDate:t})=>!DateHelper.isEqual(e.startDate,t)))),t.resumeRefresh(),e.resumeRefresh(),m.length>0&&(I?(O.forEach((e=>delete e.lastDomConfig)),t.refreshWithTransition(),a&&(e.refreshWithTransition(),t.selectedEvents=k)):r.valid=!1)}getProductDragContext(e){const t=this,{currentOverClient:r}=t,n=e.browserEvent.target,i=e.newResource||e.resourceRecord,s=e.targetEventRecord;let a,o,l=r?t.resolveEventRecord(n,r):null;e.eventRecords.includes(l)&&(l=null),t.constrainDragToResource?a=e.resourceRecord:t.constrainDragToTimeline?r&&(a=t.resolveResource()||e.newResource||e.resourceRecord):a=t.resolveResource();const{assignmentRecords:c,eventRecords:d}=e,u=i!==a;let h=Boolean(a&&!a.isSpecialRow);return!a&&t.externalDropTargetSelector&&(o=n.closest(t.externalDropTargetSelector),h=Boolean(o)),{valid:h,externalDropTarget:o,eventRecords:d,assignmentRecords:c,newResource:a,targetEventRecord:l,dirty:u||l!==s,proxyElements:[e.context.element,...e.context.relatedElements||[]]}}getMinimalDragData(e){const t=this,{scheduler:r}=t,n=t.getElementFromContext(e),i=t.resolveEventRecord(n,r),s=r.resolveResourceRecord(n),a=r.resolveAssignmentRecord(n),o=a?[a]:[];a&&(r.isAssignmentSelected(o[0])||t.drag.startEvent.ctrlKey)&&o.push.apply(o,t.getRelatedRecords(a));return{eventRecord:i,resourceRecord:s,assignmentRecord:a,eventRecords:[...new Set(o.map((e=>e.event)))],assignmentRecords:o}}setupProductDragData(e){var t;const r=this,{scheduler:n}=r,i=r.getElementFromContext(e),{eventRecord:s,resourceRecord:a,assignmentRecord:o,assignmentRecords:l}=r.getMinimalDragData(e),c=[];if(r.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);let d;if(r.constrainDragToTimeline){d=null==(t=r.getDateConstraints)?void 0:t.call(r,a,s);const e=r.constrainRectangle=r.getConstrainingRectangle(d,a,s),o=Rectangle.from(i,n.timeAxisSubGridElement);super.setupConstraints(e,o,n.timeAxisViewModel.snapPixelAmount,Boolean(d.start))}return l.forEach((e=>{let t=n.getElementFromAssignmentRecord(e,!0);t||(t=n.currentOrientation.addTemporaryDragElement(e.event,e.resource)),c.push(t)})),{record:o,draggedEntities:l,dateConstraints:(null==d?void 0:d.start)?d:null,eventBarCopies:c.map((e=>r.createProxy(e))),eventBarEls:c}}getDateConstraints(e,t){var r;const{scheduler:n}=this,i=null==(r=n.getDateConstraints)?void 0:r.call(n,e,t);let s,a;return this.constrainDragToTimeSlot?(s=t.startDate,a=t.endDate):i&&(s=i.start,a=i.end),{start:s,end:a}}getConstrainingRectangle(e,t,r){return this.scheduler.getScheduleRegion(this.constrainDragToResource&&t,r,!0,e&&{start:e.start,end:e.end})}getDragData(e){const t=this.getMinimalDragData(e)||{};return{...super.getDragData(e),...t,initialAssignmentsState:t.assignmentRecords.map((e=>({startDate:e.event.startDate,resource:e.resource,assignment:e})))}}getRelatedRecords(e){return this.scheduler.selectedAssignments.filter((t=>t!==e&&!t.resource.readOnly&&t.event.isDraggable))}getCoordinate(e,t,r){const n=this.currentOverClient;if(n.isHorizontal){let i=r[0];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":i+=t.offsetWidth/2;break;case"end":i+=t.offsetWidth}return i}{let i=r[1];if("default"!==n.milestoneLayoutMode&&e.isMilestone)switch(n.milestoneAlign){case"center":i+=t.offsetHeight/2;break;case"end":i+=t.offsetHeight}return i}}resolveResource(){const e=this,t=e.currentOverClient,{isHorizontal:r}=t,{context:n,browserEvent:i,dragProxy:s}=e.dragData,a=s||n.element,o=Rectangle.from(a,null,!0),l=t.isVertical||e.unifiedDrag?n.clientY:o.center.y,c=Rectangle.from(a,t.timeAxisSubGridElement,!0),{x:d,y:u}=c.center,h=e.getMouseMoveEventTarget(i);let g=null;if(t.element.contains(h))if(r){const e=t.rowManager.getRowAt(l);g=e&&t.store.getAt(e.dataIndex)}else g=t.resolveResourceRecord(t.timeAxisSubGridElement.querySelector(".b-sch-timeaxis-cell"),[d,u]);return g}adjustStartDate(e,t){const r=this.currentOverClient;return e=r.timeAxis.roundDate(new Date(e-0+t),!!r.snapRelativeToEventStartDate&&e),this.constrainStartDate(e)}getRecordElement(e){return this.client.getElementFromAssignmentRecord(e,!0)}getProxyElement(e){if(this.isDragging){const t=this.dragData.assignmentRecords.indexOf(e);if(t>=0)return this.dragData.proxyElements[t]}return null}getMouseMoveEventTarget(e){return e.target}};EventDrag._$name="EventDrag",GridFeatureManager.registerFeature(EventDrag,!0,"Scheduler"),GridFeatureManager.registerFeature(EventDrag,!1,"ResourceHistogram");var EventDragCreate=class extends DragCreateBase{get scheduler(){return this.client}get store(){return this.client.eventStore}updateLockLayout(e){this.dragActiveCls="b-dragcreating"+(e?" b-dragcreate-lock":"")}handleBeforeDragCreate(e,t,r){var n;const{resourceRecord:i}=e;if(i.readOnly||!this.scheduler.resourceStore.isAvailable(i))return!1;const{scheduler:s}=this,a=(!s.isSchedulerPro||t.ignoreResourceCalendar||i.isWorkingTime(e.mousedownDate))&&s.trigger("beforeDragCreate",{resourceRecord:i,date:e.mousedownDate,event:r});return this.dateConstraints=null==(n=s.getDateConstraints)?void 0:n.call(s,i,t),a}dragStart(e){var t;const r=this,{client:n}=r,{eventStore:i,assignmentStore:s,enableEventAnimations:a}=n,{resourceRecord:o}=e,l=r.createEventRecord(e),c=[o];if(l.set("duration",DateHelper.diff(l.startDate,l.endDate,l.durationUnit,!0)),l.isCreating=!0,l.meta.isDragCreating=!0,n.features.taskEdit&&n.features.taskEdit.doCancel(),!1===r.handleBeforeDragCreate(e,l,e.event))return!1;let d=[];return o&&(d=s.assignEventToResource(l,o)),!1===n.trigger("beforeEventAdd",{eventRecord:l,resourceRecords:c,assignmentRecords:d})?(s.remove(d),!1):(r.lockLayout&&(l.meta.excludeFromLayout=!0),null==(t=n.onEventCreated)||t.call(n,l),n.enableEventAnimations=!1,i.addAsync(l).then((()=>n.enableEventAnimations=a)),n.isCreating=!0,n.refreshRows(),n.isCreating=!1,e.itemElement=e.element=n.getElementFromEventRecord(l),DomHelper.isInView(e.itemElement)||n.scrollable.scrollIntoView(e.itemElement,{animate:!0,edgeOffset:n.barMargin}),super.dragStart(e))}checkValidity(e,t){const r=this,{client:n}=r;return e.resourceRecord=r.dragging.resourceRecord,(n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&r.createValidatorFn.call(r.validatorFnThisObj||r,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}triggerBeforeFinalize(e){this.client.trigger("beforeDragCreateFinalize",e)}createEventRecord(e){const t=this,{client:r}=t,n=r.isHorizontal?"X":"Y",{timeAxis:i,eventStore:s,weekStartDay:a}=r,{event:o,mousedownDate:l}=e,c=t.draggingEnd=o["page"+n]>e.startEvent["page"+n],d={name:s.modelClass.fieldMap.name.defaultValue||t.L("L{Object.newEvent}"),startDate:c?DateHelper.floor(l,i.resolution,null,a):l,endDate:c?l:DateHelper.ceil(l,i.resolution,null,a)};return r.project.isGanttProjectMixin&&ObjectHelper.assign(d,{constraintDate:d.startDate,constraintType:"startnoearlierthan"}),s.createRecord(d)}async internalUpdateRecord(e,t){await super.internalUpdateRecord(e,t),this.client.hasEventEditor||(e.eventRecord.isCreating=!1)}async finalizeDragCreate(e){const{meta:t}=e.eventRecord;return t.excludeFromLayout=!1,t.isDragCreating=!1,super.finalizeDragCreate(e)}getTipHtml(...e){const t=super.getTipHtml(...e),{element:r}=this.tip;return r.classList.add("b-sch-dragcreate-tooltip"),r.classList.toggle("b-too-narrow",this.dragging.context.tooNarrow),t}onAborted(e){var t,r;const{eventRecord:n,resourceRecord:i}=e;null==(r=(t=this.store).unassignEventFromResource)||r.call(t,n,i),this.store.remove(n)}};__publicField(EventDragCreate,"$name","EventDragCreate"),__publicField(EventDragCreate,"configurable",{validatorFn:()=>!0,lockLayout:!1}),EventDragCreate._$name="EventDragCreate",GridFeatureManager.registerFeature(EventDragCreate,!0,"Scheduler"),GridFeatureManager.registerFeature(EventDragCreate,!1,"ResourceHistogram");var EventDragSelect=class extends(Delayable_default(InstancePlugin)){constructor(){super(...arguments),__publicField(this,"targetSelector",".b-sch-timeaxis-cell, .b-timeaxissubgrid")}construct(e,t){e.multiEventSelect=!0,super.construct(e,t)}onElementMouseDown(e){const t=this,{client:r}=t,{foregroundCanvas:n}=r,{target:i,button:s,touches:a,clientX:o,clientY:l}=e,c=Rectangle.from(n,!0);a||0!==s||t.disabled||!i.matches(t.targetSelector)||!1===r.trigger("beforeEventDragSelect",{event:e})||(r.preventDragSelect=!0,t.startX=o-c.x,t.startY=l-c.y,t.originalSelection=r.selectedAssignments.slice(),t.element=DomHelper.createElement({tag:"div",className:"b-dragselect-rect",parent:r.foregroundCanvas,retainElement:!0,style:{transform:"translate("+t.startX+"px, "+t.startY+"px)"}}),r.element.classList.add("b-dragselecting"),e.ctrlKey||e.metaKey||r.clearEventSelection(),t.subGridElementRect=Rectangle.from(r.timeAxisSubGridElement,!0),r.navigator.disabled=!0,r.enableScrollingCloseToEdges(r.timeAxisSubGrid),t.mouseUpDetacher=EventHelper.on({element:document,mouseup:"onDocumentMouseUp",thisObj:t}))}get eventRectangles(){const{client:e}=this;return Array.from(e.foregroundCanvas.children).filter((t=>t.matches(e.eventSelector+", .b-nested-events-container"))).map((t=>{const r=e.resolveAssignmentRecord(t);return{rectangle:Rectangle.from(t,!0),record:r,selected:e.selectedAssignments.includes(r)}}))}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const r=t.rectangle=Rectangle.from(t.client.foregroundCanvas,!0),n=Math.min(Math.max(e.clientX-r.x,0),r.width+1),i=Math.min(Math.max(e.clientY-r.y,0),r.height+1),s=new Rectangle(t.startX,t.startY,n-t.startX,i-t.startY);DomHelper.setTranslateXY(t.element,s.x,s.y),t.element.style.width=s.width+"px",t.element.style.height=s.height+"px",t.updateSelection()}}onDocumentMouseUp(e){var t,r;const n=this,{client:i}=n,{selectedAssignments:s,navigator:a}=i;i.disableScrollingCloseToEdges(i.timeAxisSubGrid),null==(t=n.element)||t.remove(),i.element.classList.remove("b-dragselecting"),n.startX=n.startY=null,a.skipNextClick=i.timeAxisSubGridElement.contains(e.target),a.disabled=!1,s.length&&(a.skipScrollIntoView=!0,i.activeAssignment=s[s.length-1],null==(r=a.activeItem)||r.focus(),a.skipScrollIntoView=!1),n.mouseUpDetacher()}updateSelection(){const e=this,t=e.rectangle=Rectangle.from(e.element,!0),{eventRectangles:r,client:n}=e,i=n.selectedAssignments.reduce(((e,t)=>(n.getElementFromAssignmentRecord(t)||e.push(t),e)),[]);for(const e of r)t.intersect(e.rectangle,!0)&&(e.selected=!0,i.push(e.record));i.push(...e.originalSelection),n.selectedAssignments=i}};__publicField(EventDragSelect,"$name","EventDragSelect"),__publicField(EventDragSelect,"pluginConfig",{chain:["onElementMouseDown","onElementMouseMove"]}),EventDragSelect._$name="EventDragSelect",GridFeatureManager.registerFeature(EventDragSelect,!1,"Scheduler");var EventEditor=class extends Popup{static get type(){return"eventeditor"}static get $name(){return"EventEditor"}static get configurable(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",scrollable:{overflowY:!0},readOnly:null,titleRenderer:null}}updateLocalization(){super.updateLocalization(...arguments),this.initialTitle=this.title||""}chainResourceStore(){return this.eventEditFeature.resourceStore.chain((e=>!e.isSpecialRow),null,{storeClass:Store,excludeCollapsedRecords:!1})}processWidgetConfig(e){var t;if((null==(t=e.type)?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"extraItems"===e.type)return!1;const{eventEditFeature:r}=this,n={};if("resourceField"===e.ref){const{store:t}=e;e.store=this.chainResourceStore(),t&&e.store.setConfig(t),"multiSelect"in e||(e.multiSelect=!r.eventStore.usesSingleAssignment)}return"startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(n.format=r.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(n.format=r.timeFormat),Object.assign(e,n),super.processWidgetConfig(e)}onBeforeShow(...e){var t;const r=this,{record:n,titleRenderer:i}=r,{deleteButton:s}=r.widgetMap;s&&(s.hidden=r.readOnly||n.isCreating),r.title=i?r.callback(i,r,[n]):r.initialTitle,null==(t=super.onBeforeShow)||t.call(this,...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}updateReadOnly(e){const{deleteButton:t,saveButton:r,cancelButton:n}=this.widgetMap;super.updateReadOnly(e),t&&(t.hidden=e),r&&(r.hidden=e),n&&(n.hidden=e)}};EventEditor.initClass(),EventEditor._$name="EventEditor";var RecurrenceConfirmationPopup=class extends Popup{static get $name(){return"RecurrenceConfirmationPopup"}static get type(){return"recurrenceconfirmation"}static get defaultConfig(){return{localizableProperties:[],align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onRecurrenceClose",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!0,closable:!0,floating:!0,eventRecord:null,cls:"b-sch-recurrenceconfirmation",bbar:{defaults:{localeClass:this},items:{changeSingleButton:{weight:100,cls:"b-raised",color:"b-blue",text:"L{update-only-this-btn-text}",onClick:"up.onChangeSingleButtonClick"},changeMultipleButton:{weight:200,color:"b-green",text:"L{Object.Yes}",onClick:"up.onChangeMultipleButtonClick"},cancelButton:{weight:300,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get changeMultipleButton(){return this.widgetMap.changeMultipleButton}get changeSingleButton(){return this.widgetMap.changeSingleButton}get cancelButton(){return this.widgetMap.cancelButton}onChangeMultipleButtonClick(){this.processMultipleRecords(),this.hide()}onChangeSingleButtonClick(){this.processSingleRecord(),this.hide()}onCancelButtonClick(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}onRecurrenceClose(){this.cancelFn&&this.cancelFn.call(this.thisObj),this.hide()}confirm(e={}){const t=this;return["actionType","eventRecord","title","html","changerFn","cancelFn","finalizerFn","thisObj"].forEach((r=>{r in e&&(t[r]=e[r])})),t.updatePopupContent(),super.show(e)}updatePopupContent(){const e=this,{changeMultipleButton:t,changeSingleButton:r,cancelButton:n}=e.widgetMap,{eventRecord:i,actionType:s="update"}=e;(null==i?void 0:i.isRecurring)?(t.text=e.L("L{Object.Yes}"),e.html=e.L(s+"-all-message")):(t.text=e.L(s+"-further-btn-text"),e.html=e.L(s+"-further-message")),r.text=e.L(s+"-only-this-btn-text"),n.text=e.L("L{Object.Cancel}"),e.width=e.L("L{width}"),e.title=e.L(s+"-title")}processMultipleRecords(){const{eventRecord:e,changerFn:t,thisObj:r,finalizerFn:n}=this;e.beginBatch(),t&&this.callback(t,r,[e]),e.endBatch(),n&&this.callback(n,r,[e])}processSingleRecord(){const{eventRecord:e,changerFn:t,thisObj:r,finalizerFn:n}=this;let i;e.beginBatch(),(null==e?void 0:e.isRecurring)&&e.recurrence.forEachOccurrence(e.startDate,null,((e,t,r)=>{if(r>1)return i=e,!1})),null==i||i.convertToRealEvent(),e.recurrence=null,t&&this.callback(t,r,[e]),e.recurrenceRule=null,e.endBatch(),n&&this.callback(n,r,[e])}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};RecurrenceConfirmationPopup.initClass(),RecurrenceConfirmationPopup._$name="RecurrenceConfirmationPopup";var RecurrenceFrequencyCombo=class extends Combo{buildItems(){return[...this.addNone?[{text:"L{None}",value:"NONE"}]:[],{value:"DAILY",text:"L{Daily}"},{value:"WEEKLY",text:"L{Weekly}"},{value:"MONTHLY",text:"L{Monthly}"},{value:"YEARLY",text:"L{Yearly}"}]}};__publicField(RecurrenceFrequencyCombo,"$name","RecurrenceFrequencyCombo"),__publicField(RecurrenceFrequencyCombo,"type","recurrencefrequencycombo"),__publicField(RecurrenceFrequencyCombo,"configurable",{editable:!1,displayField:"text",valueField:"value",localizeDisplayFields:!0,addNone:!1}),RecurrenceFrequencyCombo.initClass(),RecurrenceFrequencyCombo._$name="RecurrenceFrequencyCombo";var RecurrenceCombo=class extends RecurrenceFrequencyCombo{static get $name(){return"RecurrenceCombo"}static get type(){return"recurrencecombo"}static get defaultConfig(){return{customValue:"custom",placeholder:"None",splitCls:"b-recurrencecombo-split",items:!0,highlightExternalChange:!1}}buildItems(){return[{value:"none",text:"L{None}"},...super.buildItems(),{value:this.customValue,text:"L{Custom}",cls:this.splitCls}]}set value(e){e=e||"none",super.value=e}get value(){return super.value}set recurrence(e){const t=this;t.value=e?t.isCustomRecurrence(e)?t.customValue:e.frequency:null}isCustomRecurrence(e){const{interval:t,days:r,monthDays:n,months:i}=e;return Boolean(t>1||r&&r.length||n&&n.length||i&&i.length)}};RecurrenceCombo.initClass(),RecurrenceCombo._$name="RecurrenceCombo";var RecurrenceLegendButton=class extends Button{static get $name(){return"RecurrenceLegendButton"}static get type(){return"recurrencelegendbutton"}static get defaultConfig(){return{localizableProperties:[],recurrence:null}}set recurrence(e){this._recurrence=e,this.updateLegend()}get recurrence(){return this._recurrence}set eventStartDate(e){this._eventStartDate=e,this.updateLegend()}get eventStartDate(){return this._eventStartDate}updateLegend(){const{recurrence:e}=this;this.text=e?RecurrenceLegend.getLegend(e,this.eventStartDate):""}onLocaleChange(){this.updateLegend()}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}};RecurrenceLegendButton.initClass(),RecurrenceLegendButton._$name="RecurrenceLegendButton";var RecurrenceDaysCombo=class extends Combo{static get $name(){return"RecurrenceDaysCombo"}static get type(){return"recurrencedayscombo"}static get defaultConfig(){const e=["SU","MO","TU","WE","TH","FR","SA"],t=e.join(",");return{allDaysValue:t,editable:!1,defaultValue:t,workingDaysValue:e.filter(((e,t)=>!DateHelper.nonWorkingDays[t])).join(","),nonWorkingDaysValue:e.filter(((e,t)=>DateHelper.nonWorkingDays[t])).join(","),splitCls:"b-recurrencedays-split",displayField:"text",valueField:"value"}}buildItems(){const e=this;return e._weekDays=null,e.weekDays.concat([{value:e.allDaysValue,text:e.L("L{day}"),cls:e.splitCls},{value:e.workingDaysValue,text:e.L("L{weekday}")},{value:e.nonWorkingDaysValue,text:e.L("L{weekend day}")}])}get weekDays(){const e=this;if(!e._weekDays){const t=DateHelper.weekStartDay,r=DateHelper.getDayNames().map(((e,t)=>({text:e,value:RecurrenceDayRuleEncoder.encodeDay(t)})));e._weekDays=r.slice(t).concat(r.slice(0,t))}return e._weekDays}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}};RecurrenceDaysCombo.initClass(),RecurrenceDaysCombo._$name="RecurrenceDaysCombo";var RecurrenceDaysButtonGroup=class extends ButtonGroup{static get $name(){return"RecurrenceDaysButtonGroup"}static get type(){return"recurrencedaysbuttongroup"}static get defaultConfig(){return{defaults:{cls:"b-raised",toggleable:!0}}}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}updateItemText(e){const t=RecurrenceDayRuleEncoder.decodeDay(e.value)[0];e.text=DateHelper.getDayName(t).substring(0,3)}buildItems(){const e=this;if(!e.__items){const t=DateHelper.weekStartDay,r=DateHelper.getDayNames().map(((e,t)=>({text:e.substring(0,3),value:RecurrenceDayRuleEncoder.encodeDay(t)})));e.__items=r.slice(t).concat(r.slice(0,t))}return e.__items}set value(e){e&&Array.isArray(e)&&(e=e.join(",")),super.value=e}get value(){let e=super.value;return e&&Array.isArray(e)&&(e=e.join(",")),e}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};RecurrenceDaysButtonGroup.initClass(),RecurrenceDaysButtonGroup._$name="RecurrenceDaysButtonGroup";var RecurrenceMonthDaysButtonGroup=class extends ButtonGroup{static get $name(){return"RecurrenceMonthDaysButtonGroup"}static get type(){return"recurrencemonthdaysbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}get minValue(){return 1}get maxValue(){return 31}construct(e={}){e.columns=7,e.items=this.buildItems(),super.construct(e)}buildItems(){const e=this,t=[];for(let r=e.minValue;r<=e.maxValue;r++)t.push({text:r+"",value:r});return t}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};RecurrenceMonthDaysButtonGroup.initClass(),RecurrenceMonthDaysButtonGroup._$name="RecurrenceMonthDaysButtonGroup";var RecurrenceMonthsButtonGroup=class extends ButtonGroup{static get $name(){return"RecurrenceMonthsButtonGroup"}static get type(){return"recurrencemonthsbuttongroup"}static get defaultConfig(){return{defaults:{toggleable:!0,cls:"b-raised"}}}construct(e={}){e.columns=4,e.items=this.buildItems(),super.construct(e)}buildItems(){return DateHelper.getMonthNames().map(((e,t)=>({text:e.substring(0,3),value:t+1})))}updateItemText(e){e.text=DateHelper.getMonthName(e.value-1).substring(0,3)}onLocaleChange(){this.items.forEach(this.updateItemText,this)}updateLocalization(){this.onLocaleChange(),super.updateLocalization()}get widgetClassList(){const e=super.widgetClassList;return e.push("b-field"),e}};RecurrenceMonthsButtonGroup.initClass(),RecurrenceMonthsButtonGroup._$name="RecurrenceMonthsButtonGroup";var RecurrenceStopConditionCombo=class extends Combo{static get $name(){return"RecurrenceStopConditionCombo"}static get type(){return"recurrencestopconditioncombo"}static get defaultConfig(){return{editable:!1,placeholder:"Never",displayField:"text",valueField:"value"}}buildItems(){return[{value:"never",text:this.L("L{Never}")},{value:"count",text:this.L("L{After}")},{value:"date",text:this.L("L{On date}")}]}set value(e){e=e||"never",super.value=e}get value(){return super.value}get recurrence(){return this._recurrence}set recurrence(e){let t=null;e.endDate?t="date":e.count&&(t="count"),this._recurrence=e,this.value=t}};RecurrenceStopConditionCombo.initClass(),RecurrenceStopConditionCombo._$name="RecurrenceStopConditionCombo";var RecurrencePositionsCombo=class extends Combo{static get $name(){return"RecurrencePositionsCombo"}static get type(){return"recurrencepositionscombo"}static get defaultConfig(){return{editable:!1,splitCls:"b-sch-recurrencepositions-split",displayField:"text",valueField:"value",defaultValue:1,maxPosition:5}}buildItems(){return this.buildDayNumbers().concat([{value:"-1",text:this.L("L{position-1}"),cls:this.splitCls}])}buildDayNumbers(){return ArrayHelper.populate(this.maxPosition,(e=>({value:e+1,text:this.L("position"+(e+1))})))}set value(e){const t=this;e&&Array.isArray(e)&&(e=e.join(",")),e&&t.store.findRecord("value",e)||(e=t.defaultValue),super.value=e}get value(){const e=super.value;return e?(""+e).split(",").map((e=>parseInt(e,10))):[]}};RecurrencePositionsCombo.initClass(),RecurrencePositionsCombo._$name="RecurrencePositionsCombo";var RecurrenceEditorPanel=class extends Panel{updateRecord(e){super.updateRecord(e);const t=this,{frequencyField:r,daysButtonField:n,monthDaysButtonField:i,monthsButtonField:s,monthDaysRadioField:a,positionAndDayRadioField:o,stopRecurrenceField:l}=t.widgetMap;if(e){const r=e.timeSpan,c=null==r?void 0:r.startDate;c&&(e.days&&e.days.length||(n.value=[RecurrenceDayRuleEncoder.encodeDay(c.getDay())]),e.monthDays&&e.monthDays.length||(i.value=c.getDate()),e.months&&e.months.length||(s.value=c.getMonth()+1)),e.days&&e.positions?(o.check(),t.isPainted||a.uncheck()):(a.check(),t.isPainted||o.uncheck()),l.recurrence=e}else r.value="NONE"}syncEventRecord(e){const t=this.getValues((t=>t.name in e&&!t.disabled));"endDate"in t||(t.endDate=null),"count"in t||(t.count=null),e.set(t)}toggleStopFields(){const{countField:e,endDateField:t}=this.widgetMap;switch(this.widgetMap.stopRecurrenceField.value){case"count":e.show(),e.enable(),t.hide(),t.disable();break;case"date":e.hide(),e.disable(),t.show(),t.enable();break;default:e.hide(),t.hide(),e.disable(),t.disable()}}onMonthDaysRadioFieldChange({checked:e}){const{monthDaysButtonField:t}=this.widgetMap;t.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onPositionAndDayRadioFieldChange({checked:e}){const{daysCombo:t,positionsCombo:r}=this.widgetMap;t.disabled=r.disabled=!e||!this.isWidgetAvailableForFrequency(t)}onStopRecurrenceFieldChange(){this.toggleStopFields()}isWidgetAvailableForFrequency(e,t=this.widgetMap.frequencyField.value){return!e.forFrequency||e.forFrequency.includes(t)}onFrequencyFieldChange({value:e,oldValue:t,valid:r}){const n=this,i=n.queryAll((e=>"forFrequency"in e)),{intervalField:s,stopRecurrenceField:a}=n.widgetMap;if(r&&e){for(let t=0;t<i.length;t++){const r=i[t];n.isWidgetAvailableForFrequency(r,e)?(r.show(),r.enable()):(r.hide(),r.disable())}s.hidden=a.hidden="NONE"===e,"NONE"!==e&&(s.hint=n.L("L{RecurrenceEditor."+e+"intervalUnit}")),"NONE"===t&&null==s.value&&(s.value=1),n.toggleFieldsState()}}toggleFieldsState(){const e=this,{widgetMap:t}=e;e.onMonthDaysRadioFieldChange({checked:t.monthDaysRadioField.checked}),e.onPositionAndDayRadioFieldChange({checked:t.positionAndDayRadioField.checked}),e.onStopRecurrenceFieldChange()}updateLocalization(){const{countField:e,intervalField:t,frequencyField:r}=this.widgetMap;e.hint=this.L("L{RecurrenceEditor.time(s)}"),r.value&&"NONE"!==r.value&&(t.hint=this.L("L{RecurrenceEditor."+r.value+"intervalUnit}")),super.updateLocalization()}};__publicField(RecurrenceEditorPanel,"$name","RecurrenceEditorPanel"),__publicField(RecurrenceEditorPanel,"type","recurrenceeditorpanel"),__publicField(RecurrenceEditorPanel,"configurable",{cls:"b-recurrenceeditor",record:!1,addNone:!1,items:{frequencyField:{type:"recurrencefrequencycombo",name:"frequency",label:"L{RecurrenceEditor.Frequency}",weight:10,onChange:"up.onFrequencyFieldChange",addNone:"up.addNone"},intervalField:{type:"numberfield",weight:15,name:"interval",label:"L{RecurrenceEditor.Every}",min:1,required:!0},daysButtonField:{type:"recurrencedaysbuttongroup",weight:20,name:"days",forFrequency:"WEEKLY"},monthDaysRadioField:{type:"checkbox",weight:30,toggleGroup:"radio",forFrequency:"MONTHLY",label:"L{RecurrenceEditor.Each}",checked:!0,onChange:"up.onMonthDaysRadioFieldChange"},monthDaysButtonField:{type:"recurrencemonthdaysbuttongroup",weight:40,name:"monthDays",forFrequency:"MONTHLY"},monthsButtonField:{type:"recurrencemonthsbuttongroup",weight:50,name:"months",forFrequency:"YEARLY"},positionAndDayRadioField:{type:"checkbox",weight:60,toggleGroup:"radio",forFrequency:"MONTHLY|YEARLY",label:"L{RecurrenceEditor.On the}",onChange:"up.onPositionAndDayRadioFieldChange"},positionsCombo:{type:"recurrencepositionscombo",weight:80,name:"positions",forFrequency:"MONTHLY|YEARLY"},daysCombo:{type:"recurrencedayscombo",weight:90,name:"days",forFrequency:"MONTHLY|YEARLY",flex:1},stopRecurrenceField:{type:"recurrencestopconditioncombo",weight:100,label:"L{RecurrenceEditor.End repeat}",onChange:"up.onStopRecurrenceFieldChange"},countField:{type:"numberfield",weight:110,name:"count",min:2,required:!0,disabled:!0,label:" "},endDateField:{type:"datefield",weight:120,name:"endDate",hidden:!0,disabled:!0,label:" ",required:!0}}}),RecurrenceEditorPanel.initClass(),RecurrenceEditorPanel._$name="RecurrenceEditorPanel";var RecurrenceEditor=class extends Popup{static get $name(){return"RecurrenceEditor"}static get type(){return"recurrenceeditor"}static get configurable(){return{draggable:!0,closable:!0,floating:!0,cls:"b-recurrenceeditor",title:"L{Repeat event}",autoClose:!0,width:470,items:{recurrenceEditorPanel:{type:"recurrenceeditorpanel",title:null}},bbar:{defaults:{localeClass:this},items:{foo:{type:"widget",cls:"b-label-filler",weight:100},saveButton:{color:"b-green",text:"L{Save}",onClick:"up.onSaveClick",weight:200},cancelButton:{color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelClick",weight:300}}}}}updateReadOnly(e){super.updateReadOnly(e),this.bbar.hidden=e}get recurrenceEditorPanel(){return this.widgetMap.recurrenceEditorPanel}updateRecord(e){this.recurrenceEditorPanel.record=e}onSaveClick(){const e=this;e.saveHandler?e.saveHandler.call(e.thisObj||e,e,e.record):(e.recurrenceEditorPanel.syncEventRecord(),e.close())}onCancelClick(){const e=this;e.cancelHandler?e.cancelHandler.call(e.thisObj||e,e,e.record):e.close()}};RecurrenceEditor.initClass(),RecurrenceEditor._$name="RecurrenceEditor";var RecurringEventEdit_default=e=>class extends(e||Base){static get $name(){return"RecurringEventEdit"}static get configurable(){return{recurringEventsItems:{recurrenceCombo:{type:"recurrencecombo",label:"L{EventEdit.Repeat}",ref:"recurrenceCombo",weight:700},editRecurrenceButton:{type:"recurrencelegendbutton",ref:"editRecurrenceButton",name:"recurrenceRule",color:"b-gray",menuIcon:null,flex:1,weight:800,ignoreParentReadOnly:!0}},showRecurringUI:null}}changeEditorConfig(e){return e.items={...e.items,...this.recurringEventsItems},e=super.changeEditorConfig(e)}construct(e,t){super.construct(e,t),this.scheduler.ion({beforeEventSave:"onRecurrableEventBeforeSave",thisObj:this})}doDestroy(){var e,t;null==(e=this._recurrenceConfirmation)||e.destroy(),null==(t=this._recurrenceEditor)||t.destroy(),super.doDestroy()}onEditorConstructed(e){var t;const r=this;e.ion({hide:r.onRecurringEventEditorHide,thisObj:r}),r.editRecurrenceButton&&(r.editRecurrenceButton.menu=r.recurrenceEditor),null==(t=r.recurrenceCombo)||t.ion({change:r.onRecurrenceComboChange,thisObj:r})}updateReadOnly(e){this._recurrenceEditor&&(this._recurrenceEditor.readOnly=e)}internalShowEditor(){this.toggleRecurringFieldsVisibility(this.client.enableRecurringEvents&&!1!==this.showRecurringUI)}toggleRecurringFieldsVisibility(e=!0){var t,r,n,i;const s=e?"show":"hide";null==(r=null==(t=this.editRecurrenceButton)?void 0:t[s])||r.call(t),null==(i=null==(n=this.recurrenceCombo)?void 0:n[s])||i.call(n)}onRecurringEventEditorHide(){var e,t;(null==(e=this.recurrenceEditor)?void 0:e.isVisible)&&this.recurrenceEditor.hide(),(null==(t=this.recurrenceConfirmation)?void 0:t.isVisible)&&this.recurrenceConfirmation.hide()}makeRecurrence(e){const t=this.eventRecord,r=t.copy();let n=t.recurrence;return n=!e&&n?n.copy():new t.recurrenceModel(e?{rule:e}:{}),n.timeSpan=r,r.setStartDate(this.values.startDate),n.suspendTimeSpanNotifying(),n}onRecurrableEventBeforeSave({eventRecord:e,context:t}){const r=this;r.isEditing&&!e.isCreating&&e.supportsRecurring&&(e.isRecurring||e.isOccurrence)&&(r.recurrenceConfirmation.confirm({actionType:"update",eventRecord:e,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),t.async=!0)}set recurrenceConfirmation(e){this._recurrenceConfirmation=e}get recurrenceConfirmation(){const e=this;let t=e._recurrenceConfirmation;return t&&t.$$name||(t=Widget.create({type:"recurrenceconfirmation",owner:e.editor,...t}),e._recurrenceConfirmation=t),t}set recurrenceEditor(e){this._recurrenceEditor=e}get recurrenceEditor(){const e=this;let t=e._recurrenceEditor;return t&&t.$$name||(e._recurrenceEditor=t=Widget.create({type:"recurrenceeditor",autoShow:!1,centered:!0,modal:!0,constrainTo:globalThis,anchor:!1,rootElement:e.rootElement,saveHandler:e.recurrenceEditorSaveHandler,onBeforeShow:e.onBeforeShowRecurrenceEditor.bind(e),thisObj:e,...t}),t.readOnly=e._readOnly),t}onBeforeShowRecurrenceEditor(){const e=this,{recurrenceEditor:t,eventRecord:r}=e;t&&(null==r?void 0:r.supportsRecurring)&&(e.recurrence||(e.recurrence=e.makeRecurrence()),e.recurrence.timeSpan.setStartDate(e.values.startDate),t.record=e.recurrence,t.centered=!0)}loadRecurrenceData(e){this.recurrence=e,this.updateRecurrenceFields(e)}updateRecurrenceFields(e){const t=this,{editRecurrenceButton:r}=t;t.recurrenceCombo&&(t.recurrenceCombo.recurrence=e),r&&(r.recurrence=e,r.value=e?e.rule:null,e&&t.client.enableRecurringEvents&&!1!==t.showRecurringUI?r.show():r.hide())}onRecurrenceComboChange({source:e,value:t,userAction:r}){if(r){const r=this,{recurrenceEditor:n}=r;t===e.customValue?(r.recurrenceCombo.recurrence=r.makeRecurrence(),n.centered?n.show():n.show((r.editRecurrenceButton||e).element)):r.loadRecurrenceData(t&&"none"!==t?r.makeRecurrence("FREQ="+t):null)}}recurrenceEditorSaveHandler(e,t){e.recurrenceEditorPanel.syncEventRecord(t),this.updateRecurrenceFields(t),e.close()}onDatesChange(...e){if(super.onDatesChange(...e),!this.loadingRecord&&this.editRecurrenceButton){const{startDate:e}=this.values;e&&(this.editRecurrenceButton.eventStartDate=e)}}internalLoadRecord(e){(null==e?void 0:e.supportsRecurring)&&this.loadRecurrenceData(e.recurrence?this.makeRecurrence():null)}updateRecord(e){return e.recurrenceRule&&!this.recurrence&&(e.recurrenceRule=null),super.updateRecord(e)}},ResourceCombo=class extends Combo{static get $name(){return"ResourceCombo"}static get type(){return"resourcecombo"}static get configurable(){return{showEventColor:!1,displayField:"name",valueField:"id",picker:{cls:"b-resourcecombo-picker",itemIconTpl(e){const{eventColor:t}=e,r=!DomHelper.isNamedColor(t);return'<div class="gt-icon gt-icon-square'+(!t||r?"":" b-sch-foreground-"+t)+'"'+(t?r?' style="color:'+t+'"':"":' style="display:none"')+"></div>"}}}}changeShowEventColor(e){return Boolean(e)}updateShowEventColor(e){const{_picker:t}=this,r=e?"add":"remove";this.element.classList[r]("b-show-event-color"),null==t||t.element.classList[r]("b-show-event-color")}changePicker(e,t){return null==(e=super.changePicker(e,t))||e.element.classList[this.showEventColor?"add":"remove"]("b-show-event-color"),e}get innerElements(){return[{class:"gt-icon b-resource-icon gt-icon-square b-hide-display",reference:"resourceIcon"},this.inputElement]}syncInputFieldValue(){var e,t;const r=this,{resourceIcon:n,lastResourceIconCls:i}=r,{classList:s}=n,a=null!=(t=null==(e=r.selected)?void 0:e.eventColor)?t:"";super.syncInputFieldValue(),n.style.color="",i&&s.remove(i),r.lastResourceIconCls=null,a?(DomHelper.isNamedColor(a)?(r.lastResourceIconCls="b-sch-foreground-"+a,s.add(r.lastResourceIconCls)):n.style.color=a,s.remove("b-hide-display")):s.add("b-hide-display")}};ResourceCombo.initClass(),ResourceCombo._$name="ResourceCombo";var punctuation=/[^\w\d]/g,EventEdit=class extends(EditBase.mixin(RecurringEventEdit_default,Delayable_default)){static get $name(){return"EventEdit"}static get configurable(){return{triggerEvent:"eventdblclick",typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{type:"eventeditor",title:"L{EventEdit.Edit event}",closable:!0,localeClass:this,defaults:{localeClass:this},items:{nameField:{type:"text",label:"L{Name}",clearable:!0,name:"name",weight:100,required:!0},resourceField:{type:"resourcecombo",label:"L{Resource}",name:"resource",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,destroyStore:!0,weight:200},startDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{Start}",name:"startDate",validateDateOnly:!0,weight:300},startTimeField:{type:"time",clearable:!1,required:!0,name:"startDate",cls:"b-match-label",weight:400},endDateField:{type:"date",cls:"b-inline",clearable:!1,required:!0,label:"L{End}",name:"endDate",validateDateOnly:!0,weight:500},endTimeField:{type:"time",clearable:!1,required:!0,name:"endDate",cls:"b-match-label",weight:600}},bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{color:"b-blue",cls:"b-raised",text:"L{Save}",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}}},targetEventElement:null}}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey","editEvent"]}}construct(e,t){this.readOnly=e.readOnly,super.construct(e,t),e.ion({projectChange:"onChangeProject",readOnly:"onClientReadOnlyToggle",thisObj:this})}get scheduler(){return this.client}get readOnly(){return this._editor?this.editor.readOnly:this._readOnly}updateReadOnly(e){super.updateReadOnly(e),this._editor&&(this.editor.readOnly=e)}onClientReadOnlyToggle({readOnly:e}){this.readOnly=e}get editor(){var e,t,r,n,i;const s=this,a={beforehide:"resetEditingContext",beforeshow:"onBeforeEditorShow",keydown:"onPopupKeyDown",thisObj:s};let{_editor:o}=s;return o||(o=s._editor=Widget.create(s.getEditorConfig()),o.floating||o.positioned||(o.element.parentNode||s.client.add(o),delete a.beforehide,delete a.beforShow,a.beforeToggleReveal="onBeforeEditorToggleReveal"),o.readOnly=s._readOnly,0===o.items.length&&console.warn("Event Editor configured without any `items`"),o.ion(a),s.scheduler.relayEvents(o,["beforeSetRecord"],"eventEdit"),Object.values(o.widgetMap).forEach((e=>{const t=e.ref||e.id;if(t&&!s[t])switch(s[t]=e,e.name){case"startDate":case"endDate":e.ion({change:"onDatesChange",thisObj:s})}})),null==(e=s.onEditorConstructed)||e.call(s,o),null==(t=s.eventTypeField)||t.ion({change:"onEventTypeChange",thisObj:s}),null==(r=s.saveButton)||r.ion({click:"onSaveClick",thisObj:s}),null==(n=s.deleteButton)||n.ion({click:"onDeleteClick",thisObj:s}),null==(i=s.cancelButton)||i.ion({click:"onCancelClick",thisObj:s}),o)}getEditorConfig(){const e=this,t=new Date(2e3,12,31,23,55,55),r=DateHelper.format(t,e.dateFormat).replace(punctuation,"").length,n=DateHelper.format(t,e.timeFormat).replace(punctuation,"").length,i=r+n,{cls:s,scheduler:a}=e,o=ObjectHelper.assign({owner:a,eventEditFeature:e,weekStartDay:e.weekStartDay,align:"b-t",id:a.id+"-event-editor",autoShow:!1,anchor:!0,scrollAction:"realign",constrainTo:globalThis,cls:s},e.editorConfig);return Widget.prototype.getRenderContext(o)[0]&&(o.floating=!1),!1!==o.floating||o.positioned||(o.collapsible={type:"overlay",direction:"right",autoClose:!1,tool:null,recollapseTool:null},o.collapsed=!0,o.hidden=o.anchor=!1,o.hide=function(){this.collapsible.toggleReveal(!1)}),o.onElementCreated=function({element:e}){e.style.setProperty("--date-time-length",i+"em"),e.style.setProperty("--date-width-difference",(r-n)/2+"em")},o}internalShowEditor(e,t,r=null){var n,i;const s=this,{scheduler:a}=s,o=(null==(n=null==r?void 0:r.target)?void 0:n.nodeType)===Element.ELEMENT_NODE?r.target:a.getElementFromEventRecord(e,t),l=e.isPartOfStore(a.eventStore);if((r=null!=r?r:{target:o,anchor:!0}).target||!l||e.isCreating){if(!1===a.trigger("beforeEventEdit",{eventEdit:s,eventRecord:e,resourceRecord:t,eventElement:o}))return a.element.classList.remove("b-eventeditor-editing"),!1;s.resourceRecord=t;const{editor:n}=s;s.editingContext={eventRecord:e,resourceRecord:t,eventElement:o,editor:n,isPartOfStore:l},null==(i=super.internalShowEditor)||i.call(this,e,t,r),s.typeField&&s.toggleEventType(e.get(s.typeField)),s.loadRecord(e,t),n.collapsed?n.setTimeout((async()=>{await n.collapsible.toggleReveal(!0),n.focus()}),100):!n.centered&&n.anchor&&n.floating?o?(s.targetEventElement=o,n.showBy(r)):(n.show(),n.updateCentered(!0)):n.show();const c=a.timeAxisViewModel.timeResolution;if("hour"===c.unit||"minute"===c.unit){const e=""+c.increment+c.unit;s.startTimeField&&(s.startTimeField.step=e),s.endTimeField&&(s.endTimeField.step=e)}s.detachListeners("changesWhileEditing"),a.eventStore.ion({change:s.onChangeWhileEditing,refresh:s.onChangeWhileEditing,thisObj:s,name:"changesWhileEditing"})}}onChangeWhileEditing(){const e=this;e.isEditing&&e.editingContext.isPartOfStore&&!e.eventRecord.isPartOfStore(e.scheduler.eventStore)&&e.onCancelClick()}onBeforeEditorShow(){super.onBeforeEditorShow(...arguments),this.scheduler.trigger("beforeEventEditShow",{eventEdit:this,...this.editingContext})}updateTargetEventElement(e,t){null==e||e.classList.add("b-editing"),null==t||t.classList.remove("b-editing")}editEvent(e,t,r=null){const n=this,{simpleEventEdit:i}=n.client.features;if(n.isEditing&&n.resetEditingContext(),n.disabled||e.readOnly||e.isCreating&&(null==i?void 0:i.enabled))return;const s=n.doEditEvent(...arguments);return n.isEditing&&n.scheduler.element.classList.add("b-eventeditor-editing"),s}get isEditing(){const{_editor:e}=this;return Boolean((null==e?void 0:e.isVisible)&&!(e.collapsed&&!e.revealed))}doEditEvent(e,t,r=null){const n=this,{scheduler:i}=n,s=e.isCreating;t||(t=e.resource||n.resourceStore.getById(e.resourceId)),s&&TimeSpan.prototype.normalize.call(e),r||s?n.internalShowEditor(e,t,r?{target:r}:null):i.scrollResourceEventIntoView(t,e,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then((()=>n.internalShowEditor(e,t)),(()=>i.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){this.loadingRecord=!0,this.internalLoadRecord(e,t),this.loadingRecord=!1}get eventRecord(){var e;return null==(e=this._editor)?void 0:e.record}internalLoadRecord(e,t){var r;const n=this,{eventStore:i}=n.client,{editor:s,resourceField:a}=n;if(n.resourceRecord=t,a&&(null==(r=a.store)?void 0:r.masterStore)!==n.resourceStore&&(a.store=s.chainResourceStore()),s.record=e,a){const r=i.assignmentStore.getResourcesForEvent(e);s.assigningValues=!0,e.isOccurrence||i.storage.includes(e,!0)||!t?n.assignmentStore&&(n.resourceField.value=r.map((e=>e[n.resourceField.valueField]))):n.resourceField.value=t[n.resourceField.valueField],s.assigningValues=!1}super.internalLoadRecord(e,t)}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget((t=>{var r;(null==(r=t.dataset)?void 0:r.eventType)&&(t.hidden=t.dataset.eventType!==e)}))}async finalizeEventSave(e,t,r,n){const i=this,{scheduler:s,assignmentStore:a}=i;a.suspendAutoCommit(),s.suspendRefresh(),i.onBeforeSave(e),e.beginBatch(),i.updateRecord(e),e.endBatch(),e.isOccurrence?t&&e.set("resourceRecords",t):i.resourceField&&a.assignEventToResource(e,t,null,!0),e.isCreating=!1,await s.project.commitAsync(),a.resumeAutoCommit(),s.resumeRefresh(!0),s.trigger("afterEventSave",{eventRecord:e}),i.onAfterSave(e),r(e)}save(){return new Promise(((e,t)=>{var r;const n=this,{scheduler:i,eventRecord:s}=n;if(!s||!n.editor.isValid)return void e(!1);const{eventStore:a,values:o}=n,l=(null==(r=n.resourceField)?void 0:r.records)||(n.resourceRecord?[n.resourceRecord]:[]);if(!n.scheduler.allowOverlap&&a){let{startDate:t,endDate:r}=o;r||(r="duration"in o?DateHelper.add(t,o.duration,o.durationUnit||s.durationUnit):"fullDuration"in o?DateHelper.add(t,o.fullDuration):s.endDate);if(l.some((e=>!a.isDateRangeAvailable(t,r,s,e))))return void e(!1)}const c={finalize(r){try{!1!==r?n.finalizeEventSave(s,l,e,t):e(!1)}catch(e){t(e)}}};!1!==i.trigger("beforeEventSave",{eventRecord:s,resourceRecords:l,values:o,context:c})?c.async||c.finalize():e(!1)}))}deleteEvent(){return this.detachListeners("changesWhileEditing"),new Promise(((e,t)=>{const{eventRecord:r,editor:n}=this;this.scheduler.removeEvents([r],(t=>{t&&n.containsFocus&&n.revertFocus(),e(t)}),n)}))}onChangeProject(){this.resourceField&&(this.resourceField.store={})}get eventStore(){return this.scheduler.project.eventStore}get resourceStore(){return this.scheduler.project.resourceStore}get assignmentStore(){return this.scheduler.project.assignmentStore}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r}){this.editEvent(e,t,r)}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:r}){this.editEvent(e,t,r)}onEventEnterKey({assignmentRecord:e,eventRecord:t,target:r}){const{client:n}=this,i=r[r.matches(n.eventSelector)?"querySelector":"closest"](n.eventInnerSelector);e?this.editEvent(t,e.resource,i):t&&this.editEvent(t,t.resource,i)}onEventTypeChange({value:e}){this.toggleEventType(e)}populateEventMenu({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||this.disabled||(r.editEvent={text:"L{EventEdit.Edit event}",localeClass:this,icon:"gt-icon gt-icon-edit",weight:100,disabled:e.readOnly,onItem:()=>{this.editEvent(e,t)}})}onBeforeEditorToggleReveal({reveal:e}){this[e?"onBeforeEditorShow":"resetEditingContext"]()}resetEditingContext(){this.detachListeners("changesWhileEditing"),super.resetEditingContext(),this.resourceRecord=null}};EventEdit._$name="EventEdit",GridFeatureManager.registerFeature(EventEdit,!0,"Scheduler"),GridFeatureManager.registerFeature(EventEdit,!1,["SchedulerPro","ResourceHistogram"]),EventEdit.initClass();var EventFilter=class extends InstancePlugin{static get $name(){return"EventFilter"}static get pluginConfig(){return{chain:["populateTimeAxisHeaderMenu"]}}populateTimeAxisHeaderMenu({items:e}){const t=this;e.eventsFilter={text:"L{filterEvents}",icon:"b-fw-icon gt-icon-filter",disabled:t.disabled,localeClass:t,weight:100,menu:{type:"popup",localeClass:t,items:{nameFilter:{weight:110,type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:"L{byName}",localeClass:t,width:200,internalListeners:{change:t.onEventFilterChange,thisObj:t}}},onBeforeShow({source:e}){const[r]=e.items,n=t.store.filters.getBy("property","name");r.value=(null==n?void 0:n.value)||""}}}}onEventFilterChange({value:e}){""!==e?this.store.filter("name",e):this.store.removeFilter("name")}get store(){const{client:e}=this;return e.isGanttBase?e.store:e.eventStore}};EventFilter.featureClass="b-event-filter",EventFilter._$name="EventFilter",GridFeatureManager.registerFeature(EventFilter,!0,["Scheduler","Gantt"]),GridFeatureManager.registerFeature(EventFilter,!1,"ResourceHistogram");var EventMenu=class extends TimeSpanMenuBase{static get $name(){return"EventMenu"}static get configurable(){return{processItems:null,type:"event"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateEventMenu"),e}get resourceStore(){return this.client.isHorizontal?this.client.store:this.client.resourceStore}getDataFromEvent(e){var t;const r=super.getDataFromEvent(e),n=r.targetElement,{client:i}=this,s=i.resolveEventRecord(n),a=s&&(null==(t=i.resolveResourceRecord(n)||this.resourceStore.last)?void 0:t.$original),o=s&&i.resolveAssignmentRecord(n);return Object.assign(r,{eventElement:n,eventRecord:s,resourceRecord:a,assignmentRecord:o})}getTargetElementFromEvent({target:e}){return e.closest(this.client.eventSelector)||e}shouldShowMenu(e){return e.eventRecord}showContextMenuFor(e,{targetElement:t,event:r}={}){this.disabled||(t||(t=this.getElementFromRecord(e)))&&DomHelper.triggerMouseEvent(t,this.tiggerEvent)}getElementFromRecord(e){return this.client.getElementsFromEventRecord(e)[0]}populateEventMenu({items:e,eventRecord:t,assignmentRecord:r}){const{client:n}=this;e.deleteEvent={disabled:t.readOnly||(null==r?void 0:r.readOnly),hidden:n.readOnly},e.unassignEvent={disabled:t.readOnly||(null==r?void 0:r.readOnly),hidden:n.readOnly||n.eventStore.usesSingleAssignment}}changeItems(e){const{client:t}=this;return Objects.merge({deleteEvent:{text:"L{SchedulerBase.Delete event}",icon:"gt-icon gt-icon-trash",weight:200,onItem({menu:e,eventRecord:r}){var n;const i=null==(n=e.focusInEvent)?void 0:n.relatedTarget;i&&(i.focus(),t.navigator.activeItem=i),t.removeEvents(t.isEventSelected(r)?t.selectedEvents:[r])}},unassignEvent:{text:"L{SchedulerBase.Unassign event}",icon:"gt-icon gt-icon-unassign",weight:300,onItem({menu:e,eventRecord:r,resourceRecord:n}){var i;const s=null==(i=e.focusInEvent)?void 0:i.relatedTarget;s&&(s.focus(),t.navigator.activeItem=s),t.isEventSelected(r)?t.assignmentStore.remove(t.selectedAssignments):r.unassign(n)}}},e)}};EventMenu.featureClass="",EventMenu._$name="EventMenu",GridFeatureManager.registerFeature(EventMenu,!0,"Scheduler"),GridFeatureManager.registerFeature(EventMenu,!1,"ResourceHistogram");var NonWorkingTimeMixin_default=e=>{var t;return __publicField(t=class extends e{getNonWorkingTimeRanges(e,t,r){if(!e.getNonWorkingTimeRanges){const n=[];return e.forEachAvailabilityInterval({startDate:t,endDate:r,isForward:!0},((e,t,r)=>{for(const[i,s]of r.intervalGroups)s.getIsWorking()||n.push({name:i.name,iconCls:i.iconCls,cls:i.cls,startDate:e,endDate:t})})),n}return e.getNonWorkingTimeRanges(t,r)}getCalendarTimeRanges(e,t=!1){const r=this,{timeAxis:n,fillTicks:i}=r.client,{unit:s,increment:a}=n,o=!r.maxTimeAxisUnit||DateHelper.compareUnits(s,r.maxTimeAxisUnit)<=0;if(e&&o&&n.count){const o=r.getNonWorkingTimeRanges(e,n.startDate,n.endDate).map((e=>new TimeSpan({name:e.name,cls:"b-nonworkingtime "+(e.cls||""),startDate:e.startDate,endDate:e.endDate}))),l=[];let c=null;for(const e of o)c&&e.startDate<=c.endDate&&(t||e.name===c.name)&&e.duration>0?c.endDate=e.endDate:(l.push(e),e.setData("id","nonworking-"+l.length),c=e);return i&&l.forEach((e=>{e.setStartEndDate(DateHelper.ceil(e.startDate,{magnitude:a,unit:s}),DateHelper.floor(e.endDate,{magnitude:a,unit:s}))})),l}return[]}setupDefaultCalendar(){const{client:e,project:t}=this;this.autoGeneratedWeekends||e.isSchedulerPro||e.isGantt||t.effectiveCalendar!==t.defaultCalendar||t.defaultCalendar.intervalStore.count||(this.autoGeneratedWeekends=!0,this.updateDefaultCalendar())}updateDefaultCalendar(){if(this.autoGeneratedWeekends){const e=this.client.project.effectiveCalendar,t=this.defaultNonWorkingIntervals,r=Boolean(t.length);e.clearIntervals(r),r&&e.addIntervals(t)}}updateLocalization(){var e;null==(e=super.updateLocalization)||e.call(this),this.autoGeneratedWeekends&&this.updateDefaultCalendar()}get defaultNonWorkingIntervals(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return DateHelper.nonWorkingDaysAsArray.map((t=>({recurrentStartDate:"on "+e[t]+" at 0:00",recurrentEndDate:"on "+e[(t+1)%7]+" at 0:00",isWorking:!1})))}},"$name","NonWorkingTimeMixin"),__publicField(t,"configurable",{maxTimeAxisUnit:"week"}),t},EventNonWorkingTime=class extends(InstancePlugin.mixin(AttachToProjectMixin_default,NonWorkingTimeMixin_default)){static get properties(){return{calendarRangeCache:new Map}}doDisable(e){this.client.refresh(),super.doDisable(e)}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e);const t=this;e.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.client.isScheduler&&t.project.effectiveCalendar.intervals.ion({name:"calendarManagerStore",change:"onCalendarChange",thisObj:t}),t.setupDefaultCalendar()}onCalendarChange(){this.calendarRangeCache.clear()}onTimeAxisViewModelUpdate(){this.calendarRangeCache.clear()}getRangeDomConfig(e,t,r,n){const{client:i}=this,{rtl:s}=i,a=i.getCoordinateFromDate(DateHelper.max(e.startDate,t))-n,o=e.endDate?i.getCoordinateFromDate(DateHelper.min(e.endDate,r))-n:a,l=Math.abs(o-a),c=l>0,d=s?"calc("+a+"px - 100%)":a+"px";return{className:{"b-sch-timerange":1,"b-sch-range":1,"b-sch-nonworkingtime":1,[e.cls]:e.cls,"b-rtl":s},dataset:{id:e.id},elementData:{timeRange:e},style:i.isVertical?"transform: translateY("+d+"); "+(c?"height:"+l+"px":"")+";":"transform: translateX("+d+"); "+(c?"width:"+l+"px":"")+";"}}getCalendarTimeRanges(e){let t=this.calendarRangeCache.get(e);return t||(t=super.getCalendarTimeRanges(e,!0),this.calendarRangeCache.set(e,t)),t}onEventDataGenerated({eventRecord:e,endMS:t,startMS:r,start:n,end:i,left:s,top:a,children:o}){var l;if(this.enabled){const{isVertical:c}=this.client,d=null!=(l=e.effectiveCalendarsCombination)?l:this.client.project.calendar;for(const e of this.getCalendarTimeRanges(d))if(e.startDateMS<t&&e.endDateMS>r){const t=this.getRangeDomConfig(e,n,i,c?a:s);o.push(t)}}}};__publicField(EventNonWorkingTime,"$name","EventNonWorkingTime"),__publicField(EventNonWorkingTime,"pluginConfig",{chain:["onTimeAxisViewModelUpdate","updateLocalization","onEventDataGenerated"]}),EventNonWorkingTime._$name="EventNonWorkingTime",GridFeatureManager.registerFeature(EventNonWorkingTime,!1,"Scheduler");var zeroOffset=[0,0],depOffset=[null,[0,10],[10,0]],EventTooltip=class extends TooltipBase{static get $name(){return"EventTooltip"}static get defaultConfig(){return{template:e=>bas(9391,3957)+(e.eventRecord.name?StringHelper.xss`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:"")+e.startClockHtml+e.endClockHtml,cls:"b-sch-event-tooltip",monitorRecordUpdate:!0,scrollAction:"hide"}}construct(e,t){const r=this;super.construct(e,t),"string"==typeof r.align&&(r.align={align:r.align})}onPaint({firstPaint:e}){if(super.onPaint(...arguments),e){const e=this,t=e.client.features.dependencies;t&&e.tooltip.ion({beforeAlign({source:e,offset:r=zeroOffset}){const{edgeAligned:n}=parseAlign(e.align.align),i=t.disabled?zeroOffset:depOffset[n];arguments[0].offset=[r[0]+i[0],r[1]+i[1]]}})}}};EventTooltip._$name="EventTooltip",GridFeatureManager.registerFeature(EventTooltip,!0,"Scheduler"),GridFeatureManager.registerFeature(EventTooltip,!1,"ResourceHistogram");var eventStoreRefreshActions={update:1,filter:1},assignmentStoreRefreshActions={add:1,remove:1,update:1,removeAll:1,filter:1},GroupSummary2=class extends GroupSummary{static get $name(){return"GroupSummary"}static get defaultConfig(){return{showTooltip:!0,summaries:null,renderer:null}}static get properties(){return{footersToUpdate:new Set}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const r=this;if(e.isVertical)throw new Error("GroupSummary feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),!r.summaries&&r.renderer&&(r.summaries=[{renderer:r.renderer}]),e.isSchedulerBase&&(e.eventStore.ion({changePreCommit:r.onEventStoreChange,thisObj:r}),e.assignmentStore.ion({changePreCommit:r.onAssignmentStoreChange,thisObj:r}),e.ion({timeAxisViewModelUpdate:r.onTimeAxisChange,thisObj:r}),e.project.ion({dataReady:r.onProjectDataReady,thisObj:r}))}doDestroy(){var e;null==(e=this._tip)||e.destroy(),super.doDestroy()}onTimeAxisChange(){this.scheduler.rowManager.forEach((e=>{e.isGroupFooter&&e.render()}))}onEventStoreChange({action:e,records:t,changes:r}){if(eventStoreRefreshActions[e]){const e=new Set;t.forEach((t=>t.resources.forEach((t=>e.add(t))))),this.afterChange(e)}}onAssignmentStoreChange({action:e,records:t,changes:r}){var n;if(assignmentStoreRefreshActions[e]){const e=new Set;if(t.forEach((t=>t.resource&&e.add(t.resource))),null!=(null==(n=null==r?void 0:r.resourceId)?void 0:n.oldValue)){const t=this.scheduler.resourceStore.getById(r.resourceId.oldValue);t&&e.add(t)}this.afterChange(e)}}afterChange(e){const{rowManager:t}=this.scheduler;for(const r of e){let e=t.getRowFor(r);if("header"===this.target)for(;e&&!e.isGroupHeader;)e=t.getRow(e.index-1);else for(;e&&!e.isGroupFooter;)e=t.getRow(e.index+1);e&&this.footersToUpdate.add(e)}}onProjectDataReady(){var e;const{footersToUpdate:t,client:r}=this;if(r.isVisible){if(t.size){for(const r of t)null==(e=r.render)||e.call(r);t.clear()}}else r.whenVisible("refresh",r,[!0])}onBeforeRenderRow({row:e,record:t}){if(e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")){const t=e.elements.normal.querySelector(".b-sch-timeaxis-cell");t&&(t.innerHTML="")}super.onBeforeRenderRow(...arguments)}generateHtml(e,t,r,n,i,s){if("timeAxis"===e.type){const e=this,{scheduler:r}=e,{eventStore:a}=r,o=r.timeAxisViewModel.columnConfig;let l="";const c=r.getResourcesEventsPerTick(t,(({event:e})=>e.resources.some((e=>t.includes(e)))&&(!a.isFiltered||a.records.includes(e))));return r.timeAxis.forEach(((d,u)=>{const h=c[u]||[],g=e.summaries.map((e=>'<div class="b-timeaxis-summary-value">'+e.renderer({startDate:d.startDate,endDate:d.endDate,resourceStore:r.resourceStore,events:h,resources:t,eventStore:a,groupRecord:n,groupField:i,groupValue:s})+"</div>")).join("");l+='<div class="b-timeaxis-tick" style="width: '+o[o.length-1][u].width+'px">'+g+"</div>"})),'<div class="b-timeaxis-group-summary">'+l+"</div>"}return super.generateHtml(e,t,r,n,i,s)}updateSummaryHtml(e,t,r){const n=super.updateSummaryHtml(e,t,r);if("timeAxis"===t.type){const e={count:0,height:0};return this.summaries.forEach((t=>{t.height?e.height+=t.height:e.count++})),e}return n}getTipHtml({activeTarget:e}){const t=this,r=Array.from(e.parentElement.children).indexOf(e),n=t.scheduler.timeAxis.getAt(r);let i="<header>"+t.L("L{Summary.Summary for}",t.scheduler.getFormattedDate(n.startDate))+"</header>",s=!1;return DomHelper.forEachSelector(e,".b-timeaxis-summary-value",((e,r)=>{const n=t._labels[r],a=e.innerText.trim();i+="<label>"+(n||"")+'</label><div class="b-timeaxis-summary-value">'+a+"</div>",e.innerHTML&&(s=!0)})),s?i:null}render(){var e;const t=this,{scheduler:r}=t;r.isSchedulerBase&&(null==(e=t.summaries)?void 0:e.some((e=>e.label)))&&t.showTooltip&&!t._tip&&(t._labels=t.summaries.map((e=>e.label||"")),t._tip=new Tooltip({id:r.id+"-groupsummary-tip",cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:0,forElement:r.timeAxisSubGridElement,anchorToTarget:!0,forSelector:".b-timeaxis-group-summary .b-timeaxis-tick",getHtml:t.getTipHtml.bind(t)}))}removeSummaryElements(e){const t=e.querySelector(".b-timeaxis-group-summary");null==t||t.remove(),super.removeSummaryElements()}hasSummary(e){return super.hasSummary(e)||e.isTimeAxisColumn}};GroupSummary2._$name="GroupSummary",GridFeatureManager.registerFeature(GroupSummary2,!1,"Scheduler");var HeaderZoom=class extends InstancePlugin{static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"]}}onElementMouseDown(e){const t=this;if(!e.touches&&0===e.button&&!t.disabled&&e.target.closest(".b-sch-header-timeaxis-cell")){const r=t.client.subGrids.normal.header.headersElement;t.startX=e.clientX,t.element=DomHelper.createElement({parent:r,tag:"div",className:"b-headerzoom-rect"}),t.headerElementRect=Rectangle.from(r),EventHelper.on({element:document,mouseup:"onMouseUp",thisObj:t,once:!0})}}onElementMouseMove(e){const t=this;if("number"==typeof t.startX){const r=Math.max(e.clientX,t.headerElementRect.left),n=Math.min(t.startX,r),i=Math.abs(t.startX-r),s=new Rectangle(n-t.headerElementRect.x+t.client.scrollLeft,0,i,t.headerElementRect.height);DomHelper.setTranslateX(t.element,s.left),t.element.style.width=s.width+"px"}}onMouseUp(){const e=this;if("number"==typeof e.startX){const{client:t}=e,r=Rectangle.from(e.element),n=t.getDateFromCoordinate(r.left,"round",!1),i=t.getDateFromCoordinate(r.right,"round",!1);e.element.remove(),e.startX=null,t.zoomToSpan({startDate:n,endDate:i})}}};__publicField(HeaderZoom,"$name","HeaderZoom"),HeaderZoom._$name="HeaderZoom",GridFeatureManager.registerFeature(HeaderZoom,!1,"Scheduler");var sides=["top","before","after","bottom"],editorAlign=(e,t)=>{switch(e){case"top":return"b-b";case"after":return t.rtl?"r-r":"l-l";case"right":return"l-l";case"bottom":return"t-t";case"before":return t.rtl?"l-l":"r-r";case"left":return"r-r"}},topBottom={top:1,bottom:1},layoutModes={estimate:1,measure:1},layoutSides={before:1,after:1},Labels=class extends InstancePlugin{static get $name(){return"Labels"}static get configurable(){return{labelCls:"b-sch-label",top:null,after:null,right:null,bottom:null,before:null,left:null,thisObj:null,blurAction:"cancel",labelLayoutMode:"default",labelCharWidth:7}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}construct(e,t){const r=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");r.scheduler=e,super.construct(e,t),(r.top||r.bottom||r.before||r.after)&&r.updateHostClasslist()}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:r}=this.scheduler.element;r.remove("b-labels-topbottom"),r.remove("b-labels-top"),r.remove("b-labels-bottom"),(e||t)&&(r.add("b-labels-topbottom"),e&&r.add("b-labels-top"),t&&r.add("b-labels-bottom"))}onLabelDblClick(e){const t=this,r=e.target;r&&t.scheduler.readOnly}changeTop(e){return this.processLabelSpec(e,"top")}updateTop(){this.updateHostClasslist()}changeAfter(e){return this.processLabelSpec(e,"after")}updateAfter(){this.updateHostClasslist()}changeRight(e){this[this.client.rtl?"before":"after"]=e}changeBottom(e){return this.processLabelSpec(e,"bottom")}updateBottom(){this.updateHostClasslist()}changeBefore(e){return this.processLabelSpec(e,"before")}updateBefore(){this.updateHostClasslist()}changeLeft(e){this[this.client.rtl?"after":"before"]=e}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return null;e=Object.setPrototypeOf({},e)}const{scheduler:r}=this,{eventStore:n,resourceStore:i,taskStore:s,id:a}=r,{field:o,editor:l}=e;if(topBottom[t]&&(r.milestoneWidth=null),e.recordType=n&&!s?"event":"task",o){let t,a=!1;n&&!s&&(t=n.modelClass.fieldMap[o],t?(e.fieldDef=t,e.recordType="event",a=!0):Reflect.has(n.modelClass.prototype,o)&&(e.recordType="event",a=!0)),!t&&s&&(t=s.modelClass.fieldMap[o],t?(e.fieldDef=t,e.recordType="task",a=!0):Reflect.has(i.modelClass.prototype,o)&&(e.recordType="task",a=!0)),!t&&i&&(t=i.modelClass.fieldMap[o],t?(e.fieldDef=t,e.recordType="resource",a=!0):Reflect.has(i.modelClass.prototype,o)&&(e.recordType="resource",a=!0)),l&&("boolean"==typeof l?r.editor={type:"textfield"}:"string"==typeof l&&(r.editor={type:l}),EventHelper.on({element:r.timeAxisSubGrid.element,delegate:".b-sch-label",dblclick:"onLabelDblClick",thisObj:this}))}return e}doDisable(e){super.doDisable(e),this.client.isPainted&&this.client.refresh()}generateLabelConfigs(e){const t=this,r=[];for(const n of sides)if(t[n]){const{field:i,fieldDef:s,recordType:a,renderer:o,thisObj:l}=t[n],c={tag:"label",className:{[t.labelCls]:1,[t.labelCls+"-"+n]:1},dataset:{side:n,taskFeature:"label-"+n}};let d;const u=a+"Record",h=e[u];o?d=o.call(l||t.thisObj||t,{[u]:h,resourceRecord:e.resourceRecord,assignmentRecord:e.assignmentRecord,domConfig:c}):(d=h[i],d="date"!==(null==s?void 0:s.type)||o?StringHelper.encodeHtml(d):DateHelper.format(d,t.client.displayDateFormat)),c.html=d||" ",r.push(c)}return r}measureLabels(e,t){const r=this,n=r.client.timeAxisViewModel.getSingleUnitInPixels("millisecond");for(const i of e)if(layoutSides[i.dataset.side]){let{html:e}=i,s=0;if("estimate"===r.labelLayoutMode)e.includes("<")&&(e=DomHelper.stripTags(e)),s=e.length*r.labelCharWidth+18;else{const e=r.labelMeasureElement||(r.labelMeasureElement=DomHelper.createElement({className:"b-sch-event-wrap b-measure-label",parent:r.client.foregroundCanvas}));e.retainElement=!0,DomSync.sync({targetElement:e,childrenOnly:!0,domConfig:{children:[i]}}),s=e.firstElementChild.offsetWidth}const a=s/n;switch(i.dataset.side){case"before":t.startMS-=a;break;case"after":t.endMS+=a}}}onEventDataGenerated(e){var t;if(!this.disabled&&!(null==(t=e.eventRecord)?void 0:t.isResourceTimeRange)){const t=this.generateLabelConfigs(e);layoutModes[this.labelLayoutMode]&&this.measureLabels(t,e),e.wrapperChildren.push(...t)}}updateLabelLayoutMode(){this.isConfiguring||this.client.refreshWithTransition()}updateLabelCharWidth(){this.isConfiguring||this.client.refreshWithTransition()}};Labels.featureClass="b-sch-labels",Labels._$name="Labels",GridFeatureManager.registerFeature(Labels,!1,"Scheduler");var NonWorkingTime=class extends(AbstractTimeRanges.mixin(AttachToProjectMixin_default,NonWorkingTimeMixin_default)){static get defaultConfig(){return{highlightWeekends:null,hideRangesOnZooming:!0,showHeaderElements:!0,showLabelInBody:!0,autoGeneratedWeekends:!1}}doDestroy(){this.attachToCalendar(null),super.doDestroy()}set highlightWeekends(e){VersionHelper.deprecate("Scheduler","6.0.0","Deprecated in favour of disabling the feature"),this.disabled=!e}get highlightWeekends(){return!this.disabled}onConfigChange({name:e}){this.isConfiguring||"fillTicks"!==e||this.refresh()}attachToProject(e){super.attachToProject(e),this.attachToCalendar(e.effectiveCalendar),e.graph||this.client.isScheduler||e.ion({name:"project",dataReady:{fn:()=>this.attachToCalendar(e.effectiveCalendar),once:!0},thisObj:this}),e.ion({name:"project",calendarChange:()=>this.attachToCalendar(e.effectiveCalendar),thisObj:this})}onTimeAxisViewModelUpdate(...e){return this._timeAxisUnitDurationMs=null,super.onTimeAxisViewModelUpdate(...e)}attachToCalendar(e){const t=this,{project:r,client:n}=t;t.detachListeners("calendar"),t.autoGeneratedWeekends=!1,e&&(t.setupDefaultCalendar(),e.intervalStore.ion({name:"calendar",change:()=>t.setTimeout((()=>t.refresh()),1)})),!n.isEngineReady||n.project.isDelayingCalculation||n.isDestroying?r.isDestroyed||(t.detachListeners("initialProjectListener"),r.ion({name:"initialProjectListener",refresh({isCalculated:e}){!1!==e&&(t.refresh(),t.detachListeners("initialProjectListener"))},thisObj:t})):t.refresh()}get calendar(){var e;return null==(e=this.project)?void 0:e.effectiveCalendar}get timeAxisUnitDurationMs(){return this._timeAxisUnitDurationMs||(this._timeAxisUnitDurationMs=DateHelper.as("ms",1,this.client.timeAxis.unit)),this._timeAxisUnitDurationMs}shouldRenderRange(e){return super.shouldRenderRange(e)&&(!this.hideRangesOnZooming||e.durationMS>=this.timeAxisUnitDurationMs)}get timeRanges(){const e=this;return e._timeRanges||(e._timeRanges=e.getCalendarTimeRanges(e.calendar)),e._timeRanges}};__publicField(NonWorkingTime,"$name","NonWorkingTime"),__publicField(NonWorkingTime,"pluginConfig",{chain:["onPaint","attachToProject","updateLocalization","onConfigChange","onSchedulerHorizontalScroll"]}),NonWorkingTime._$name="NonWorkingTime",GridFeatureManager.registerFeature(NonWorkingTime,!1,"Scheduler"),GridFeatureManager.registerFeature(NonWorkingTime,!0,["SchedulerPro","Gantt","ResourceHistogram"]);var Pan=class extends InstancePlugin{get targetSelector(){return".b-sch-timeaxis-cell,.b-timeline-subgrid"+(this.enableInHeader?",.b-sch-header-timeaxis-cell,.b-sch-header-text":"")}static get pluginConfig(){return{chain:["onElementMouseDown"]}}onElementMouseDown(e){const t=this,{client:r}=t,{button:n,touches:i,target:s,clientX:a,clientY:o}=e,l=r.features.taskDrag||r.features.eventDrag,c=r.readOnly||!(null==l?void 0:l.enabled);i||0!==n||t.disabled||!1===r.trigger("beforePan",{event:e})||(s.matches(t.targetSelector)||c&&s.closest(r.eventSelector))&&(t.mouseX=a,t.mouseY=o,t.onHeader=t.enableInHeader&&s.closest(".b-sch-header-timeaxis-cell"),t.mouseDetacher=EventHelper.on({element:document,mousemove:"onMouseMove",mouseup:"onMouseUp",thisObj:t}))}onMouseMove(e){const t=this,{client:r}=t,n=r.timeAxisSubGrid.scrollable,i=r.scrollable,s=e.clientX,a=e.clientY;e.preventDefault(),!t.vertical||!r.isVertical&&t.onHeader||i.scrollBy(0,t.mouseY-a),!t.horizontal||!r.isHorizontal&&t.onHeader||n.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=a}onMouseUp(){this.mouseDetacher(),this.mouseDetacher=null}get isActive(){return Boolean(this.mouseDetacher)}};__publicField(Pan,"$name","Pan"),__publicField(Pan,"configurable",{horizontal:!0,vertical:!0,enableInHeader:!0}),Pan._$name="Pan",GridFeatureManager.registerFeature(Pan,!1,["Scheduler","Gantt"]);var ResourceMenu=class extends ContextMenuBase{static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateResourceMenu"),e}getDataFromEvent(e){const t=e.target.closest(".b-resourceheader-cell"),r=null==t?void 0:t.dataset.resourceId;if(r){return{cellElement:t,resourceRecord:this.client.resourceStore.getById(r)}}}populateResourceMenu({items:e,resourceRecord:t}){const{client:r}=this;r.readOnly||(e.remove={text:"L{CellMenu.removeRow}",localeClass:this,icon:"b-fw-icon gt-icon-trash",cls:"b-separator",weight:100,disabled:t.readOnly,onItem:()=>r.resourceStore.remove(t)})}get showMenu(){return!0}};__publicField(ResourceMenu,"$name","ResourceMenu"),__publicField(ResourceMenu,"configurable",{processItems:null,items:null,type:"resource"}),ResourceMenu.featureClass="",ResourceMenu._$name="ResourceMenu",GridFeatureManager.registerFeature(ResourceMenu,!1,["Scheduler"]);var ResourceTimeRanges=class extends ResourceTimeRangesBase{static get pluginConfig(){return{...super.pluginConfig,assign:["resolveResourceTimeRangeRecord","getElementFromResourceTimeRangeRecord"]}}attachToProject(e){const t=this,{client:r}=t;if(super.attachToProject(e),!e.resourceTimeRangeStore){e.resourceTimeRangeStore=r.resourceTimeRangeStore||new ResourceTimeRangeStore({owner:t});const{crudManager:n}=r;n&&!n.resourceTimeRangeStore&&(n.resourceTimeRangeStore=e.resourceTimeRangeStore)}const n=e.resourceTimeRangeStore;t.exposedOnScheduler||(r.resourceTimeRanges&&(n.add(r.resourceTimeRanges),delete r.resourceTimeRanges),Object.defineProperty(r,"resourceTimeRanges",{get:()=>n.records,set:e=>n.data=e}),t.exposedOnScheduler=!0),n.resourceStore||(n.resourceStore=e.resourceStore),t.detachListeners("store"),n.ion({name:"store",change:t.onStoreChange,thisObj:t})}attachToResourceTimeRangeStore(e){this.attachToProject(this.project),this.client.refresh()}get store(){return this.project.resourceTimeRangeStore}getEventsToRender(e,t){if(!this.disabled){const{timeRanges:r}=e.$original;if(null==r?void 0:r.length){const{startDate:e,endDate:n}=this.client;r.forEach((r=>{r.isRecurring?t.push(...r.getOccurrencesForDateRange(e,n)):t.push(r)}))}}return t}shouldInclude(e){return e.isResourceTimeRange&&!e.isNonWorking&&!e.isCalendarHighlightModel}doDestroy(){var e;(null==(e=this.store)?void 0:e.owner)===this&&this.store.destroy(),super.doDestroy()}};__publicField(ResourceTimeRanges,"$name","ResourceTimeRanges"),__publicField(ResourceTimeRanges,"configurable",{rangeCls:"b-sch-resourcetimerange",enableMouseEvents:!1,tabIndex:0,entityName:"resourceTimeRange"}),ResourceTimeRanges.featureClass="",ResourceTimeRanges._$name="ResourceTimeRanges",GridFeatureManager.registerFeature(ResourceTimeRanges,!1,"Scheduler");var ScheduleMenu=class extends TimeSpanMenuBase{static get $name(){return"ScheduleMenu"}static get defaultConfig(){return{type:"schedule",items:null,processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateScheduleMenu"),e}shouldShowMenu(e){const{client:t}=this,{targetElement:r,resourceRecord:n}=e,i=t.timeAxisSubGridElement.contains(r);return!r.closest(t.eventSelector)&&i&&!(n&&n.isSpecialRow)}getDataFromEvent(e){var t,r;if(DomHelper.isDOMEvent(e)){const{client:n}=this,i=null==(t=n.getCellDataFromEvent)?void 0:t.call(n,e),s=null==(r=n.getDateFromDomEvent)?void 0:r.call(n,e,"floor"),a=n.resolveResourceRecord(e)||n.isVertical&&n.resourceStore.last;return ObjectHelper.assign(super.getDataFromEvent(e),i,{date:s,resourceRecord:a})}return e}populateScheduleMenu({items:e,resourceRecord:t,date:r}){const{client:n}=this;!n.readOnly&&n.eventStore&&(e.addEvent={text:"L{SchedulerBase.Add event}",icon:"gt-icon gt-icon-add",disabled:!t||t.readOnly||!t.isWorkingTime(r),weight:100,onItem(){n.createEvent(r,t,n.getRowFor(t))}})}};ScheduleMenu.featureClass="",ScheduleMenu._$name="ScheduleMenu",GridFeatureManager.registerFeature(ScheduleMenu,!0,"Scheduler");var ScheduleTooltip=class extends InstancePlugin{static get $name(){return"ScheduleTooltip"}static get configurable(){return{messageTemplate:e=>'<div class="b-sch-hovertip-msg">'+e.message+"</div>",hideForNonWorkingTime:null}}static get pluginConfig(){return{chain:["onPaint"]}}onPaint({firstPaint:e}){if(!e)return;const t=this,{client:r}=t;let n;r.isSchedulerPro&&void 0===t.hideForNonWorkingTime&&(t.hideForNonWorkingTime=!0);const i=t.hoverTip=new Tooltip({id:r.id+"-schedule-tip",cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:r.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,updateContentOnMouseMove:!0,monitorResize:!1,textContent:!1,forSelector:".b-schedulerbase:not(.b-dragging-event):not(.b-dragcreating) .b-grid-body-container:not(.b-scrolling) .b-timeline-subgrid:not(.b-scrolling) > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",getHtml:t.getHoverTipHtml.bind(t),onDocumentMouseDown(e){i.forElement.contains(e.event.target)&&(n=EventHelper.on({thisObj:t,element:r.timeAxisSubGridElement,mousemove:e=>i.internalOnPointerOver(e),capture:!0}));const s=i.hideAnimation;i.hideAnimation=!1,i.constructor.prototype.onDocumentMouseDown.call(i,e),i.hideAnimation=s},...t.config,internalListeners:t.configuredListeners});i.ion({pointerover({event:e}){const r="buttons"in e?e.buttons>0:e.which>0;return!r&&n&&n(),!t.disabled&&!r},innerhtmlupdate({source:e}){t.clockTemplate.updateDateIndicator(e.element,t.lastTime)}}),r.ion({timeAxisViewModelUpdate:"updateTip",thisObj:t}),t.clockTemplate=new ClockTemplate({scheduler:r})}processConfiguredListeners(){}updateTip(){this.hoverTip.isVisible&&this.hoverTip.updateContent()}doDestroy(){this.destroyProperties("clockTemplate","hoverTip"),super.doDestroy()}getHoverTipHtml({tip:e,event:t}){const r=this,n=r.client,i=t&&n.getDateFromDomEvent(t,"floor",!0);let s=r.lastHtml;if(i&&t.target){const a=n.resolveResourceRecord(t);if(a&&(i-r.lastTime!=0||a.id!==r.lastResourceId)){if(r.hideForNonWorkingTime){const t=a.isWorkingTime(i);e.element.classList.toggle("b-nonworking-time",!t)}r.lastResourceId=a.id,s=r.lastHtml=r.generateTipContent({date:i,event:t,resourceRecord:a})}}else e.hide(),r.lastTime=null,r.lastResourceId=null;return s}generateTipContent({date:e,event:t,resourceRecord:r}){const n=this,i=n.clockTemplate.generateContent({date:e,text:n.client.getFormattedDate(e)}),s=n.messageTemplate({message:n.getText(e,t,r)||""});return n.lastTime=e,i+s}getText(e,t,r){}};ScheduleTooltip.featureClass="b-scheduletip",ScheduleTooltip._$name="ScheduleTooltip",GridFeatureManager.registerFeature(ScheduleTooltip,!0,"Scheduler"),GridFeatureManager.registerFeature(ScheduleTooltip,!1,"ResourceUtilization");var SimpleEventEdit=class extends InstancePlugin{static get $name(){return"SimpleEventEdit"}static get defaultConfig(){return{triggerEvent:"eventdblclick",eventRecord:null,field:"name",editorConfig:null}}static get pluginConfig(){return{chain:["onEventEnterKey","editEvent"]}}construct(e,t){const r=this;r.scheduler=e,e.eventEdit=r,super.construct(e,t),r.clientListenersDetacher=e.ion({[r.triggerEvent]:({eventRecord:e,eventElement:t})=>r.editEvent(e,e.resource,t),dragcreateend:r.onDragCreateEnd,thisObj:r})}doDestroy(){var e;this.clientListenersDetacher(),null==(e=this.editor)||e.destroy(),super.doDestroy()}get eventStore(){return this.scheduler.eventStore}editEvent(e,t,r){const n=this,{scheduler:i}=n,{eventEdit:s}=n.client.features;if(i.readOnly||n.disabled||e.readOnly||s&&!s.disabled&&!e.isCreating)return;let{editor:a}=n;r=DomHelper.down(r,i.eventInnerSelector)||r,e=e.isAssignment?e.event:e,n.resource=t,n.event=e,n.element=r,i.element.classList.add("b-eventeditor-editing"),a?a.render(i.timeAxisSubGridElement):(n.editor=a=Editor.new({owner:i.timeAxisSubGrid,appendTo:i.timeAxisSubGridElement,scrollAction:"realign",maxHeight:40,align:{align:i.isHorizontal?"c-c":"t-t"},cls:"b-simpleeventeditor",internalListeners:{complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:n},onInternalKeyDown:e=>e.stopPropagation()},n.editorConfig),n.relayEvents(n.editor,["beforestart","start","beforecomplete","complete","beforecancel","cancel"])),e.isCreating&&(e.name=""),a.startEdit({target:r,record:e,field:n.field}),i.isVertical&&e.startDate<i.visibleDateRange.startDate&&a.element.scrollIntoView(),i.navigator.disabled=!0}onEditorComplete(){this.event.isCreating=!1,this.reset()}onEditorCancel(){this.event.isCreating&&this.event.remove(),this.reset()}reset(){this.scheduler.element.classList.remove("b-eventeditor-editing"),this.scheduler.navigator.disabled=!1,this.event=null,this.resource=null}onEventEnterKey({assignmentRecord:e,eventRecord:t}){const r=e?this.scheduler.getElementFromAssignmentRecord(e):this.scheduler.getElementFromEventRecord(t),n=(e||t).resource;this.editEvent(t,n,r)}onDragCreateEnd({eventRecord:e,resourceRecord:t,eventElement:r}){this.element=r,this.editEvent(e,t,r)}};SimpleEventEdit._$name="SimpleEventEdit",GridFeatureManager.registerFeature(SimpleEventEdit,!1,"Scheduler");var zeroMargins={width:0,height:0},StickyEvents=class extends InstancePlugin{construct(e,t){super.construct(e,t),e.isVertical&&(this.toUpdate=new Set,e.ion({scroll:"onSchedulerScroll",horizontalScroll:"onHorizontalScroll",thisObj:this,prio:1e4}))}onEventDataGenerated(e){this.client.isHorizontal?e.wrapperCls["b-disable-sticky"]=!1===e.eventRecord.stickyContents:(this.syncEventContentPosition(e,void 0,!0),this.updateStyles())}onSchedulerScroll(){this.disabled||this.verticalSyncAllEventsContentPosition(this.client)}onHorizontalScroll({subGrid:e}){e===this.client.timeAxisSubGrid&&this.verticalSyncAllEventsContentPosition(this.client)}updateStyles(){for(const{contentEl:e,style:t}of this.toUpdate)DomHelper.applyStyle(e,t);this.toUpdate.clear()}verticalSyncAllEventsContentPosition(e){const{resourceMap:t}=e.currentOrientation;for(const e of t.values())for(const{renderData:t,elementConfig:r}of Object.values(e)){const e=[t];r&&t.eventRecord.isResourceTimeRange&&e.push(r.children[0]),this.syncEventContentPosition.apply(this,e)}this.toUpdate.size&&this.updateStyles()}syncEventContentPosition(e,t=e.eventContent,r=!1){if(this.disabled||!1===e.eventRecord.stickyContents)return;const{client:n}=this,{eventRecord:i,resourceRecord:s,useEventBuffer:a,bufferAfterWidth:o,bufferBeforeWidth:l,top:c,height:d}=e,u=n.scrollable.y,h=r?null:n.getElementFromEventRecord(i,s,!0),g=h&&DomSync.getChild(h,"event.content"),p=i.instanceMeta(n),m="string"==typeof t.style?t.style=DomHelper.parseStyle(t.style):t.style||(t.style={});if(null==h?void 0:h.classList.contains("b-dragging"))return;let f=c,v=d,y=f+v;if(a&&(f+=l,v=v-l-o,y=f+v),f<u&&y>=u&&!i.isMilestone){const t=null==g?void 0:g.offsetWidth,r="center"===((null==g?void 0:g.parentNode)&&DomHelper.getStyleValue(g.parentNode,"justifyContent"))?(e.width-t)/2:0,n=f;if((!g||t)&&n<u&&n+v-1>=u){const e=this.getEventContentMargins(g),t=g?v-g.offsetHeight-e.height-r:Number.MAX_SAFE_INTEGER,i=Math.min(u-n,t-2);m.transform=i>0?"translateY("+i+"px)":"",p.stuck=!0}else m.transform="",p.stuck=!1;g&&this.toUpdate.add({contentEl:g,style:m})}else g&&p.stuck&&(m.transform="",p.stuck=!1,this.toUpdate.add({contentEl:g,style:m}))}getEventContentMargins(e){return(null==e?void 0:e.classList.contains("b-sch-event-content"))?DomHelper.getEdgeSize(e,"margin"):zeroMargins}doDisable(){super.doDisable(...arguments),this.isConfiguring||this.client.refreshWithTransition()}};__publicField(StickyEvents,"$name","StickyEvents"),__publicField(StickyEvents,"type","stickyEvents"),__publicField(StickyEvents,"pluginConfig",{chain:["onEventDataGenerated"]}),StickyEvents._$name="StickyEvents",GridFeatureManager.registerFeature(StickyEvents,!0,"Scheduler"),GridFeatureManager.registerFeature(StickyEvents,!1,"ResourceHistogram");var TimelineSummary=class extends Summary{static get $name(){return"TimelineSummary"}static get configurable(){return{showTooltip:!0}}static get pluginConfig(){return{chain:["renderRows","updateProject"]}}construct(e,t){const r=this;super.construct(e,t),r.summaries||(r.summaries=[{renderer:r.renderer}]),e.isTimelineBase&&(r.updateProject(e.project),e.ion({timeAxisViewModelUpdate:r.renderRows,thisObj:r}))}updateProject(e){this.detachListeners("summaryProject"),e.ion({name:"summaryProject",dataReady:"updateTimelineSummaries",thisObj:this})}renderRows(){this.client.isHorizontal&&this.client.timeAxisSubGrid.footer.element.querySelector(".b-grid-footer").classList.add("b-sch-summarybar"),super.renderRows(),this.disabled||this.render()}get summaryBarElement(){return this.client.element.querySelector(".b-sch-summarybar")}render(){const e=this,{client:t}=e,r=t.isHorizontal?"width":"height",n=t.timeAxisViewModel.columnConfig,i=e.summaryBarElement;i&&(!e._tip&&e.showTooltip&&e.summaries.some((e=>e.label))&&(e._tip=new Tooltip({id:t.id+"-summary-tip",cls:"b-timeaxis-summary-tip",hoverDelay:0,hideDelay:100,forElement:i,anchorToTarget:!0,trackMouse:!1,forSelector:".b-timeaxis-tick",getHtml:({activeTarget:e})=>e._tipHtml})),i.innerHTML=n[n.length-1].map((e=>bct(8473,8213)+r+": "+e.width+'px"></div>')).join(""),e.updateTimelineSummaries())}refresh(){super.refresh(),this.updateTimelineSummaries()}doDisable(e){var t;const{isConfiguring:r}=this.client;super.doDisable(e),null==(t=this.summaryColumn)||t.toggle(!e),r||e||this.render()}doDestroy(){var e;null==(e=this._tip)||e.destroy(),super.doDestroy()}};TimelineSummary._$name="TimelineSummary";var Summary2=class extends TimelineSummary{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null,verticalSummaryColumnConfig:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("bindStore","updateEventStore","updateResourceStore"),e}construct(e,t){const r=this;r.scheduler=e,e.isVertical&&(e.timeAxisSubGrid.resizable=!1,t.hideFooters=!0,e.add(e.createSubGrid("right")),r.summaryColumn=e.columns.add(ObjectHelper.assign({filterable:null,region:"right",cellCls:"b-grid-footer b-sch-summarybar",align:"center",sortable:!1,editor:!1,groupable:!1,htmlEncode:!1,cellMenuItems:!1,enableHeaderContextMenu:!1,hidden:r.disabled},r.verticalSummaryColumnConfig))[0]),super.construct(e,t),e.isSchedulerBase&&(r.updateEventStore(e.eventStore),r.updateResourceStore(e.resourceStore))}updateEventStore(e){this.detachListeners("summaryEventStore"),e.ion({name:"summaryEventStore",filter:"updateTimelineSummaries",thisObj:this})}updateResourceStore(e){this.detachListeners("summaryResourceStore"),e.ion({name:"summaryResourceStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t}=e,{eventStore:r,timeAxis:n}=t,i=e.summaryBarElement,s=e.selectedOnly&&t.selectedRecords.length?t.selectedRecords:t.resourceStore.records;if(i&&t.isEngineReady){const a=t.getResourcesEventsPerTick(s,(({event:e})=>!r.isFiltered||r.records.includes(e)));Array.from(i.children).forEach(((i,s)=>{const o=n.getAt(s),l=a[s]||[];let c="",d="<header>"+e.L("L{Summary for}",t.getFormattedDate(o.startDate))+"</header>";e.summaries.forEach((n=>{const s=n.renderer({startDate:o.startDate,endDate:o.endDate,resourceStore:t.resourceStore,eventStore:r,events:l,element:i}),a=s?'<div class="b-timeaxis-summary-value">'+s+"</div>":"";(e.summaries.length>1||s)&&(c+=a),d+=a?"<label>"+(n.label||"")+"</label>"+a:""})),i.innerHTML=c,i._tipHtml=c?d:""}))}}};Summary2._$name="Summary",GridFeatureManager.registerFeature(Summary2,!1,"Scheduler");var setTimeSpanOptions={maintainVisibleStart:!0},TimeAxisHeaderMenu=class extends HeaderMenu{static get $name(){return"TimeAxisHeaderMenu"}static get defaultConfig(){return{processItems:null,items:null,type:"timeAxisHeader"}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTimeAxisHeaderMenu"),e}construct(){super.construct(...arguments),this.triggerEvent.includes("click")&&this.client.zoomOnTimeAxisDoubleClick&&(this.client.zoomOnTimeAxisDoubleClick=!1)}shouldShowMenu(e){const{column:t,targetElement:r}=e,{client:n}=this;return n.isHorizontal?!1!==(null==t?void 0:t.enableHeaderContextMenu)&&(null==t?void 0:t.isTimeAxisColumn):r.matches(".b-sch-header-timeaxis-cell")}showContextMenu(e){super.showContextMenu(...arguments),this.menu&&(this.menu.scrollAction="realign")}populateTimeAxisHeaderMenu({items:e}){const t=this,{client:r}=t,n={magnitude:r.timeAxis.shiftIncrement,unit:r.timeAxis.shiftUnit};Object.assign(e,{zoomLevel:{text:"L{pickZoomLevel}",localeClass:t,icon:"b-fw-icon gt-icon-search-plus",disabled:!r.presets.count||t.disabled,weight:200,menu:{type:"popup",items:{zoomSlider:{weight:210,type:"slider",minWidth:130,showValue:!1,triggerChangeOnInput:!0}},onBeforeShow({source:e}){const[n]=e.items;n.min=r.minZoomLevel,n.max=r.maxZoomLevel,n.value=r.zoomLevel,t.zoomDetatcher=n.ion({change:"onZoomSliderChange",thisObj:t})},onHide(){t.zoomDetatcher&&(t.zoomDetatcher(),t.zoomDetatcher=null)}}},dateRange:{text:"L{activeDateRange}",localeClass:t,icon:"b-fw-icon gt-icon-calendar",weight:300,menu:{type:"popup",cls:"b-sch-timeaxis-menu-daterange-popup",defaults:{localeClass:t},items:{startDateField:{type:"datefield",label:"L{startText}",weight:310,labelWidth:"6em",required:!0,step:n,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},endDateField:{type:"datefield",label:"L{endText}",weight:320,labelWidth:"6em",required:!0,step:n,internalListeners:{change:t.onRangeDateFieldChange,thisObj:t}},leftShiftBtn:{type:"button",weight:330,cls:"b-left-nav-btn",icon:"gt-icon gt-icon-previous",color:"b-blue b-raised",flex:1,margin:0,internalListeners:{click:t.onLeftShiftBtnClick,thisObj:t}},todayBtn:{type:"button",weight:340,cls:"b-today-nav-btn",color:"b-blue b-raised",text:"今天",flex:4,margin:"0 8",internalListeners:{click:t.onTodayBtnClick,thisObj:t}},rightShiftBtn:{type:"button",weight:350,cls:"b-right-nav-btn",icon:"gt-icon gt-icon-next",color:"b-blue b-raised",flex:1,internalListeners:{click:t.onRightShiftBtnClick,thisObj:t}}},internalListeners:{paint:t.initDateRangeFields,thisObj:t}}}})}onZoomSliderChange({value:e}){const t=this;t.menu.scrollAction="realign",t.client.zoomLevel=e,t.menu.setTimeout({fn:()=>t.menu.scrollAction="hide",delay:100,cancelOutstanding:!0})}initDateRangeFields({source:e,firstPaint:t}){if(t){const{widgetMap:t}=e;this.startDateField=t.startDateField,this.endDateField=t.endDateField}this.initDates()}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.client.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.client.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,r=e===t.startDateField,{client:n}=t,{timeAxis:i}=n,s=t.startDateFieldInitialValue&&!r?t.startDateFieldInitialValue:t.startDateField.value;let a=t.endDateFieldInitialValue&&r?t.endDateFieldInitialValue:t.endDateField.value;r?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,a-s?a<s&&(a=DateHelper.add(s,i.shiftIncrement,i.shiftUnit)):a=DateHelper.add(a,i.shiftIncrement,i.shiftUnit),n.setTimeSpan(s,a,setTimeSpanOptions),t.initDates()}onLeftShiftBtnClick(){this.client.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=DateHelper.clearTime(new Date);this.client.setTimeSpan(e,DateHelper.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.client.timeAxis.shiftNext(),this.initDates()}};TimeAxisHeaderMenu._$name="TimeAxisHeaderMenu",GridFeatureManager.registerFeature(TimeAxisHeaderMenu,!0,["Scheduler","Gantt"]),GridFeatureManager.registerFeature(TimeAxisHeaderMenu,!1,"ResourceHistogram");var TimeRanges=class extends(AbstractTimeRanges.mixin(AttachToProjectMixin_default)){static get $name(){return"TimeRanges"}static get defaultConfig(){return{store:!0}}doDestroy(){var e;null==(e=this.storeDetacher)||e.call(this),super.doDestroy()}get timeRanges(){const e=this;if(!e._timeRanges){const{store:t}=e;let{records:r}=t;if(t.recurringEvents){const{startDate:t,endDate:n}=e.client.timeAxis;r=r.flatMap((e=>e.isRecurring?e.getOccurrencesForDateRange(t,n):e))}e.currentTimeLine&&(t.recurringEvents||(r=r.slice()),r.push(e.currentTimeLine)),e._timeRanges=r}return e._timeRanges}attachToProject(e){var t,r;super.attachToProject(e);const n=this;null==(t=n.projectTimeZoneChangeDetacher)||t.call(n),n.showCurrentTimeLine&&(n.projectTimeZoneChangeDetacher=null==(r=n.client.project)?void 0:r.ion({timeZoneChange:()=>n.updateCurrentTimeLine()}),n.currentTimeLine&&n.updateCurrentTimeLine())}initCurrentTimeLine(){const e=this;if(e.currentTimeLine||!e.showCurrentTimeLine)return;const t="object"==typeof e.showCurrentTimeLine?e.showCurrentTimeLine:{};e.currentTimeLine=e.store.modelClass.new({id:"currentTime",cls:"b-sch-current-time"},t),e.currentTimeInterval=e.setInterval((()=>e.updateCurrentTimeLine()),e.currentTimeLineUpdateInterval),e._timeRanges=null,e.updateCurrentTimeLine()}updateCurrentTimeLine(){var e;const t=this,{currentTimeLine:r}=t;r.timeZone=null==(e=t.project)?void 0:e.timeZone;const n=new Date;n.setHours(11),n.setMinutes(30),n.setSeconds(0),r.setLocalDate("startDate",n),r.endDate=r.startDate,r.originalData.name,t.renderRanges()}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.refresh())}updateShowCurrentTimeLine(e){e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}populateTimeAxisHeaderMenu({column:e,items:t}){t.currentTimeLine={weight:400,text:this.L("L{showCurrentTimeLine}"),checked:this.showCurrentTimeLine,onToggle:({checked:e})=>{this.showCurrentTimeLine=e}}}attachToStore(e){const t=this;let r=!1;t.storeDetacher&&(t.storeDetacher(),r=!0),t.storeDetacher=e.ion({change:"onStoreChange",refresh:"onStoreChange",thisObj:t}),t._timeRanges=null,r&&t.renderRanges()}get store(){return this.client.project.timeRangeStore}updateStore(e){const{client:t}=this,{project:r}=t;e=r.timeRangeStore,this.attachToStore(e),t.timeRanges&&!t._timeRangesExposed&&(e.add(t.timeRanges),delete t.timeRanges)}attachToTimeRangeStore(e){this.store=e}resolveTimeRangeRecord(e){return this.store.getById(e.closest(this.baseSelector).dataset.id)}onStoreChange({type:e,action:t}){const r=this;r._timeRanges=null,r.disabled||!r.client.isVisible||r.isConfiguring||"refresh"===e&&"batch"!==t||r.client.runWithTransition((()=>r.renderRanges()),!r.client.refreshSuspended)}onDragStart(e){const t=this,{context:r}=e,n=t.resolveTimeRangeRecord(r.element.closest(t.baseSelector)),i=t.getBodyElementByRecord(n);r.relatedElements=[i],Object.assign(r,{record:n,rangeBodyEl:i,originRangeX:DomHelper.getTranslateX(i),originRangeY:DomHelper.getTranslateY(i)}),super.onDragStart(e),t.showTip(r)}onDrop(e){const{context:t}=e;if(!t.valid)return this.onInvalidDrop({context:t});const r=this,{client:n}=r,{record:i}=t,s=Rectangle.from(t.rangeBodyEl),a=n.getDateFromCoordinate(s.getStart(n.rtl,n.isHorizontal),"round",!1);i.startDate-a!=0?i.setStartDate(a):r.onInvalidDrop(),r.destroyTip(),super.onDrop(e)}onResizeStart({context:e}){const t=this,r=t.resolveTimeRangeRecord(e.element.closest(t.baseSelector)),n=t.getBodyElementByRecord(r);Object.assign(e,{record:r,rangeBodyEl:n}),t.showTip(e)}onResizeDrag({context:e}){const{rangeBodyEl:t}=e;this.client.isVertical?("top"===e.edge&&DomHelper.setTranslateY(t,e.newY),t.style.height=e.newHeight+"px"):("left"===e.edge&&DomHelper.setTranslateX(t,e.newX),t.style.width=e.newWidth+"px")}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:r}=t,{rtl:n}=r,i=e.record,s=Rectangle.from(e.element),a=s.getStart(n,r.isHorizontal),o=s.getEnd(n,r.isHorizontal),l=r.getDateFromCoordinate(a,"round",!1),c=n&&"right"===e.edge||!n&&"left"===e.edge||"top"===e.edge,d=r.getDateFromCoordinate(o,"round",!1);(c&&i.startDate-l!=0||d&&i.endDate-d!=0)&&d>l?c?i.setStartDate(l,!1):i.setEndDate(d,!1):t.onInvalidResize({context:e}),t.destroyTip()}onInvalidResize({context:e}){const t=this;t.resize.reset(),e.rangeBodyEl.parentElement.lastDomConfig=e.rangeBodyEl.lastDomConfig=null,t.renderRanges(),t.destroyTip()}};__publicField(TimeRanges,"configurable",{store:{modelClass:TimeSpan},currentTimeLineUpdateInterval:1e4,currentDateFormat:"HH:mm",showCurrentTimeLine:!1}),TimeRanges._$name="TimeRanges",GridFeatureManager.registerFeature(TimeRanges,!1,["Scheduler","Gantt"]);var TimeSelection=class extends AbstractTimeRanges{static get configurable(){return{enableResizing:!0,showTooltip:!1,dragTipTemplate:null,cls:"b-selected-time-span",dragHelperConfig:{skipUpdatingElement:!0},resizeHelperConfig:{skipUpdatingElement:!0},headerRenderer({timeRange:e}){const{dateFormat:t}=this.client.timeAxisViewModel.bottomHeader;return'<span class="b-selection-start">'+DateHelper.format(e.startDate,t)+'</span><span class="b-selection-end">'+DateHelper.format(e.endDate,t)+'</span><i class="gt-icon gt-icon-close" data-ref="closeButton" data-btip="L{Popup.close}"></i>'},selectedTimeSpan:null}}onUIReady(){super.onUIReady(),this.client.ion({timeAxisHeaderMouseDown:"onTimeAxisHeaderMouseDown",thisObj:this})}onTimeAxisHeaderMouseDown({startDate:e,endDate:t}){this.disabled||(this.selectedTimeSpan={startDate:e,endDate:t})}onTimeRangeClick(e){super.onTimeRangeClick(e);const t=this;!t.disabled&&e.target.closest(".b-selected-time-span")&&(e.target.matches('[data-ref="closeButton"]')?t.selectedTimeSpan=null:t.client.trigger("timeSelectionElementClick",{...t.selectedTimeSpan,domEvent:e}))}updateFromCoords(e,t,r,n){const{client:i}=this,s=i.isHorizontal?r:n;let a=i.isHorizontal?e:t;i.rtl&&i.isHorizontal&&(a=Math.max(i.timeAxisViewModel.totalSize-a-s,0));const o=i.getDateFromCoord({coord:a,roundingMethod:"round",ignoreRTL:!0}),l=i.getDateFromCoord({coord:a+s,roundingMethod:"round",ignoreRTL:!0});this.selectedTimeSpan={startDate:DateHelper.max(o,i.startDate),endDate:DateHelper.min(l,i.endDate)}}onResizeStart({source:e}){const{timeAxisViewModel:t,timeResolution:r}=this.client,n=DateHelper.asMilliseconds(r.increment,r.unit);this.resize.minWidth=t.getDistanceForDuration(n)}onResizeDrag({context:e}){var t,r;this.updateFromCoords(e.newX,e.newY,null!=(t=e.newWidth)?t:e.elementWidth,null!=(r=e.newHeight)?r:e.elementHeight)}onDragStart(e){super.onDragStart(e);const{context:t}=e;t.elementWidth=t.element.offsetWidth,t.elementHeight=t.element.offsetHeight}onDrag({context:e}){this.updateFromCoords(e.newX,e.newY,e.elementWidth,e.elementHeight)}onDrop(){this.client.element.classList.remove("b-dragging-timerange")}onDragReset(){this.refresh()}get timeRanges(){return this.selectedTimeSpan?[this.selectedTimeSpan]:[]}shouldRenderRange(){return!0}changeSelectedTimeSpan(e){return e&&(e.id="time-selection"),e}updateSelectedTimeSpan(e){this.isConfiguring||this.refresh(),this.client.trigger("timeSelectionChange",{...null!=e?e:{}})}};__publicField(TimeSelection,"$name","TimeSelection"),TimeSelection._$name="TimeSelection",GridFeatureManager.registerFeature(TimeSelection,!1,"Scheduler");var ScheduleRange={completeview:"completeview",currentview:"currentview",daterange:"daterange"},immediatePromise7=Promise.resolve(),SchedulerExporterMixin_default=e=>class extends e{async scrollRowIntoView(e,t){const{rowManager:r,scrollable:n}=e,i=n.y;return t<e.store.count&&(n.scrollTo(null,r.calculateTop(t)),n.y!==i)?new Promise((n=>{const i=e.ion({scroll({scrollTop:e}){null!=e&&r.getRow(t)&&(i(),n())}})})):immediatePromise7}async scrollToDate(e,t){let r=!1;const n=[],i=e.timeAxisSubGrid.scrollable.ion({scrollStart({x:e}){null!=e&&(r=!0)}});n.push(e.scrollToDate(t,{block:"start"})),i(),r&&n.push(e.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}cloneElement(e,t,r){super.cloneElement(e,t,r);const n=this.element.querySelector(".b-schedulerbase");null==n||n.classList.remove(...["fade-in","slide-from-left","slide-from-top","zoom-in"].map((e=>bdz(1294,-261)+e)))}async prepareComponent(e){const t=this,{client:r}=e,{currentOrientation:n}=r,i=r.timeAxisSubGrid.width>0;switch(e.scheduleRange){case ScheduleRange.completeview:e.rangeStart=r.startDate,e.rangeEnd=r.endDate;break;case ScheduleRange.currentview:{const{startDate:t,endDate:n}=r.visibleDateRange;e.rangeStart=t,e.rangeEnd=n;break}}await r.waitForAnimations(),e.infiniteScroll=r.infiniteScroll,r.infiniteScroll=!1,i&&(r.setTimeSpan(e.rangeStart,e.rangeEnd),r.svgCanvas),t._oldEnableEventAnimations=r.enableEventAnimations,r.enableEventAnimations=!1,n.isHorizontalRendering&&(t._oldScrollBuffer=n.scrollBuffer,t._oldVerticalBuffer=n.verticalBufferSize,n.scrollBuffer=100,n.verticalBufferSize=-1),r.ignoreViewBox=!0,await super.prepareComponent(e);const{exportMeta:s,element:a}=t,o=a.querySelector(".b-sch-foreground-canvas"),l=a.querySelector(".b-horizontaltimeaxis");if(s.includeTimeline=i,i&&e.scheduleRange!==ScheduleRange.completeview){s.totalWidth-=s.subGrids.normal.width,s.totalWidth+=s.subGrids.normal.width=r.timeAxisViewModel.getDistanceBetweenDates(e.rangeStart,e.rangeEnd);const t=Math.ceil(s.totalWidth/s.pageWidth),n=t*s.verticalPages;s.horizontalPages=t,s.totalPages=n,s.subGrids.normal.scrollLeft=r.getCoordinateFromDate(e.rangeStart)}if(s.timeAxisHeaders=[],s.timeAxisPlaceholders=[],s.headersColleted=!1,DomHelper.forEachSelector(l,".b-sch-header-row",(e=>{s.timeAxisPlaceholders.push(t.createPlaceholder(e)),s.timeAxisHeaders.push(new Map)})),s.subGrids.normal.eventsPlaceholder=t.createPlaceholder(o,!1),DomHelper.removeEachSelector(o,".b-sch-event-wrap,.b-sch-resourcetimerange"),DomHelper.removeEachSelector(t.element,".b-released"),s.eventsBoxes=new Map,s.client=r,r.hasActiveFeature("columnLines")){const e=a.querySelector(".b-column-lines-canvas");s.columnLinesPlaceholder=t.createPlaceholder(e),s.columnLines={lines:new Map,majorLines:new Map}}if(r.hasActiveFeature("timeRanges")){const e=a.querySelector(".b-sch-timeaxiscolumn .b-sch-timeranges-canvas"),r=a.querySelector(".b-sch-foreground-canvas .b-sch-timeranges-canvas");s.timeRanges={},e&&(s.timeRanges.header={},s.timeRangesHeaderPlaceholder=t.createPlaceholder(e)),s.timeRanges.body={},s.timeRangesBodyPlaceholder=t.createPlaceholder(r)}if(r.hasActiveFeature("dependencies")){r.features.dependencies.fillDrawingCache();const e=a.querySelector('[id="'+r.svgCanvas.getAttribute("id")+'"]');e&&(s.dependencyCanvasEl=e,s.dependenciesPlaceholder=t.createPlaceholder(e,!1,{ns:"http://www.w3.org/2000/svg",tag:"path"}),DomHelper.removeEachSelector(e,".b-sch-dependency"))}i&&!DateHelper.betweenLesser(e.rangeStart,r.startDate,r.endDate)&&await t.scrollToDate(r,e.rangeStart)}async restoreState(e){let t=!1;const{client:r}=e,n=[],i=r.timeAxisSubGrid.scrollable.ion({scrollStart({x:e}){this.element.scrollLeft!==e&&(t=!0)}});n.push(super.restoreState(e)),i(),t&&n.push(r.timeAxisSubGrid.header.scrollable.await("scrollEnd",{checkLog:!1})),await Promise.all(n)}async restoreComponent(e){const{client:t}=e,{currentOrientation:r}=t;t.ignoreViewBox=!1,t.infiniteScroll=e.infiniteScroll,t.enableEventAnimations=this._oldEnableEventAnimations,r.isHorizontalRendering&&(r.scrollBuffer=this._oldScrollBuffer,r.verticalBufferSize=this._oldVerticalBuffer),await super.restoreComponent(e)}async onRowsCollected(e,t){const r=this;if(await super.onRowsCollected(e,t),r.exportMeta.includeTimeline){const{client:n,enableDirectRendering:i}=t,{timeView:s}=n,{pageRangeStart:a,pageRangeEnd:o}=r.getCurrentPageDateRange(t);if(i)a&&o&&(r.renderHeaders(t,a,o),r.renderLines(t,a,o),r.renderRanges(t,a,o),r.renderEvents(t,e,a,o));else{if(a){let i=!1;for(await r.scrollToDate(n,a);!i;)if(r.collectLines(t),r.collectHeaders(t),r.collectRanges(t),r.collectEvents(e,t),DateHelper.timeSpanContains(s.startDate,s.endDate,a,o))i=!0;else if(s.endDate.getTime()>=o.getTime())i=!0;else{const e=s.endDate;if(await r.scrollToDate(n,s.endDate),e.getTime()===s.endDate.getTime())throw new Error("Could not scroll to date")}}await r.scrollToDate(n,t.rangeStart)}}}getCurrentPageDateRange({rangeStart:e,rangeEnd:t,enableDirectRendering:r,client:n}){const{exportMeta:i}=this,{horizontalPages:s,horizontalPosition:a,pageWidth:o,subGrids:l}=i;let c,d;if(s>1){const e=a*o,i=(a+1)*o,s=l.locked.width+l.locked.splitterWidth;if(i<=s)d=c=null;else{const{scrollLeft:a=0}=l.normal;c=n.getDateFromCoordinate(Math.max(e-s+a,0));const o=r?1:1.2;d=n.getDateFromCoordinate((i-s+a)*o)||t}}else c=e,d=t;return{pageRangeStart:c,pageRangeEnd:d}}prepareExportElement(){const{element:e,exportMeta:t}=this,{id:r,headerId:n,footerId:i,scrollLeft:s}=t.subGrids.normal,a=e.querySelector('[id="'+r+'"]');return[".b-sch-background-canvas",".b-sch-foreground-canvas"].forEach((e=>{const r=a.querySelector(e);r&&(t.lastExportedRowBottom?r.style.height=t.lastExportedRowBottom+"px":r.style.height="",s&&(r.style.marginLeft="-"+s+"px"))})),s&&[n,i].forEach((t=>{const r=e.querySelector('[id="'+t+'"] .b-widget-scroller');r&&(r.style.marginLeft="-"+s+"px")})),super.prepareExportElement()}collectHeaders(e){const{client:t}=e,{exportMeta:r}=this;if(!r.headersCollected){const e=t.timeView.element,n=r.timeAxisHeaders;DomHelper.forEachSelector(e,".b-sch-header-row",((e,i,s)=>{const a=n[i];DomHelper.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{a.has(e.dataset.tickIndex)||a.set(e.dataset.tickIndex,e.outerHTML)})),i===s.length-1&&a.has(String(t.timeAxis.count-1))&&(r.headersCollected=!0)}))}}collectRanges(e){const{client:t}=e,{exportMeta:r}=this,{timeRanges:n}=r;if(!r.headersCollected&&n){const{headerCanvas:e,bodyCanvas:r}=t.features.timeRanges;e&&DomHelper.forEachSelector(e,".b-sch-timerange",(e=>{n.header[e.dataset.id]=e.outerHTML})),DomHelper.forEachSelector(r,".b-sch-timerange",(e=>{n.body[e.dataset.id]=e.outerHTML}))}}collectLines(e){const{client:t}=e,{exportMeta:r}=this,{columnLines:n}=r;if(!r.headersCollected&&n){const e=t.backgroundCanvas;DomHelper.forEachSelector(e,".b-column-line, .b-column-line-major",(e=>{if(e.classList.contains("b-column-line")){const t=Number(e.dataset.line.replace(/line-/,""));n.lines.set(t,e.outerHTML)}else{const t=Number(e.dataset.line.replace(/major-/,""));n.majorLines.set(t,e.outerHTML)}}))}}collectEvents(e,t){const r=e.length,{client:n}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{var s,a;const o=i[i.length-r+t],l=n.store.getAt(e.dataIndex),c=o[3];null==(s=l.events)||s.forEach((e=>{if(e.isScheduled){let t=n.getElementFromEventRecord(e,l);t&&(t=t.parentElement)&&!c.has(e.id)&&c.set(e.id,[t.outerHTML,Rectangle.from(t,t.offsetParent)])}})),null==(a=l.timeRanges)||a.forEach((e=>{var t;const r=(null==(t=n.features.resourceTimeRanges)?void 0:t.generateElementId(e))||"",i=n.foregroundCanvas.syncIdMap[r];i&&!c.has(r)&&c.set(r,[i.outerHTML,Rectangle.from(i,i.offsetParent)])}))}))}renderHeaders(e,t,r){const{exportMeta:n}=this,{client:i}=e,s=n.timeAxisHeaders,{timeAxisView:a}=i.timeAxisColumn,o=a.buildCells(t,r),l=document.createElement("div");DomSync.sync({targetElement:l,domConfig:o}),DomHelper.forEachSelector(l,".b-sch-header-row",((e,t)=>{const r=s[t];DomHelper.forEachSelector(e,".b-sch-header-timeaxis-cell",(e=>{r.has(e.dataset.tickIndex)||r.set(e.dataset.tickIndex,e.outerHTML)}))}))}renderEvents(e,t,r,n){const{client:i}=e,s=this.exportMeta.subGrids.normal.rows;t.forEach(((e,t)=>{const a=s[t][3],o=i.store.getAt(e.dataIndex),l=i.currentOrientation.getResourceLayout(o),c=i.getCoordinateFromDate(r),d=i.getCoordinateFromDate(n),u=i.currentOrientation.getEventDOMConfigForCurrentView(l,e,c,d),h=document.createElement("div");u.forEach((e=>{const{eventId:t}=e.dataset,{left:r,top:n,width:i,height:s}=e.style;DomSync.sync({targetElement:h,domConfig:e}),a.set(t,[h.outerHTML,new Rectangle(r,n,i,s)])}))}))}renderLines(e,t,r){const{client:n}=e,{exportMeta:i}=this,{columnLines:s}=i;if(s){const e=n.features.columnLines.getColumnLinesDOMConfig(t,r),i=document.createElement("div");DomSync.sync({targetElement:i,domConfig:{children:e},onlyChildren:!0}),s.lines.set(0,i.innerHTML)}}renderRanges(e,t,r){const{client:n}=e,{exportMeta:i}=this,{timeRanges:s}=i;if(s){const e=n.features.timeRanges.getDOMConfig(t,r),i=document.createElement("div");e.forEach(((e,t)=>{DomSync.sync({targetElement:i,domConfig:{children:e,onlyChildren:!0}}),0===t?s.body=i.innerHTML:s.header=i.innerHTML}))}}buildPageHtml(e){const t=this,{subGrids:r,timeAxisHeaders:n,timeAxisPlaceholders:i,columnLines:s,columnLinesPlaceholder:a,timeRanges:o,timeRangesHeaderPlaceholder:l,timeRangesBodyPlaceholder:c}=t.exportMeta,{enableDirectRendering:d}=e;let u=t.prepareExportElement();if(Object.values(r).forEach((({placeHolder:r,eventsPlaceholder:n,rows:i,mergedCellsHtml:s})=>{const a=r.outerHTML,{resources:o,events:l}=t.positionRows(i,e);let c=o.join("");(null==s?void 0:s.length)&&(c+='<div class="b-grid-merged-cells-container">'+s.join("")+"</div>"),u=u.replace(a,c),n&&(u=u.replace(n.outerHTML,l.join("")))})),n.forEach(((e,t)=>{u=u.replace(i[t].outerHTML,Array.from(e.values()).join(""))})),s){const e=Array.from(s.lines.values()).concat(Array.from(s.majorLines.values()));u=u.replace(a.outerHTML,e.join("")),d&&(t.exportMeta.columnLines.lines.clear(),t.exportMeta.columnLines.majorLines.clear())}return o&&(d?(u=u.replace(c.outerHTML,o.body),l&&(u=u.replace(l.outerHTML,o.header)),t.exportMeta.timeRanges={}):(u=u.replace(c.outerHTML,Object.values(o.body).join("")),l&&(u=u.replace(l.outerHTML,Object.values(o.body).join(""))))),u=t.buildDependenciesHtml(u),u}getEventBox(e){const{eventsBoxes:t,enableDirectRendering:r}=this.exportMeta,n=e&&t.get(String(e.id));return r&&n&&e.isMilestone&&n.translate(-n.width/2,0),n}renderDependencies(){const e=this,{client:t,eventsBoxes:r}=e.exportMeta,{dependencies:n}=t,i=t.features.dependencies,s=DomHelper.createElement();let a=!1;return n.forEach((t=>{if(!r.has(String(t.from))&&!r.has(String(t.to))||!i.isDependencyVisible(t))return;const n=e.getEventBox(t.fromEvent),s=e.getEventBox(t.toEvent);i.drawDependency(t,!0,{from:null==n?void 0:n.clone(),to:null==s?void 0:s.clone()}),a=!0})),a&&i.domSync(s),s.innerHTML}buildDependenciesHtml(e){const{dependenciesPlaceholder:t,includeTimeline:r}=this.exportMeta;if(t&&r){const r=t.outerHTML;e=e.replace(r,this.renderDependencies())}return e}},MultiPageExporter2=class extends(SchedulerExporterMixin_default(MultiPageExporter)){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}positionRows(e){const t=[],r=[];return e.forEach((([e,n,i,s])=>{t.push(e),s&&Array.from(s.entries()).forEach((([e,[t,n,i=[]]])=>{r.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),n)}))})),{resources:t,events:r}}};MultiPageExporter2._$name="MultiPageExporter";var MultiPageVerticalExporter2=class extends(SchedulerExporterMixin_default(MultiPageVerticalExporter)){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}async stateNextPage(e){await super.stateNextPage(e),this.exportMeta.eventsBoxes.clear()}async prepareComponent(e){await super.prepareComponent(e),e.scheduleRange!==ScheduleRange.completeview&&this.estimateTotalPages(e)}positionRows(e){const t=[],r=[];return e.forEach((([e,,,n])=>{t.push(e),n&&Array.from(n.entries()).forEach((([e,[t,n,i=[]]])=>{r.push(t+i.join("")),this.exportMeta.eventsBoxes.set(String(e),n)}))})),{resources:t,events:r}}};MultiPageVerticalExporter2._$name="MultiPageVerticalExporter";var ScheduleRangeCombo=class extends Combo{static get $name(){return"ScheduleRangeCombo"}static get type(){return"schedulerangecombo"}static get defaultConfig(){return{editable:!1,localizeDisplayFields:!0,displayField:"text",buildItems:()=>Object.entries(ScheduleRange).map((([e,t])=>({value:e,text:"L{"+t+"}"})))}}};ScheduleRangeCombo.initClass(),ScheduleRangeCombo._$name="ScheduleRangeCombo";var SchedulerExportDialog=class extends ExportDialog{static get $name(){return"SchedulerExportDialog"}static get type(){return"schedulerexportdialog"}static get configurable(){return{defaults:{localeClass:this},items:{scheduleRangeField:{type:"schedulerangecombo",label:"L{Schedule range}",value:"completeview",weight:150,onChange({value:e}){this.parent.widgetMap.rangesContainer.hidden=e!==ScheduleRange.daterange}},rangesContainer:{type:"container",flex:"1 0 100%",weight:151,hidden:!0,defaults:{localeClass:this},items:{filler:{weight:0,type:"widget"},rangeStartField:{type:"datefield",label:"L{Export from}",labelWidth:"3em",flex:"1 0 25%",weight:10,onChange({value:e}){this.parent.widgetMap.rangeEndField.min=DateHelper.add(e,1,"d")}},filler2:{type:"widget",weight:20,width:"0.5em"},rangeEndField:{type:"datefield",label:"L{Export to}",labelWidth:"1em",flex:"1 0 25%",weight:30,onChange({value:e}){this.parent.widgetMap.rangeStartField.max=DateHelper.add(e,-1,"d")}}}}}}}onLocaleChange(){const e=this.L("labelWidth");this.width=this.L("L{width}"),this.items.forEach((t=>{t instanceof Field?t.labelWidth=e:"rangesContainer"===t.ref&&(t.items[0].width=e)}))}applyInitialValues(e){super.applyInitialValues(e);const{client:t,scheduleRange:r}=e,n=e.items=e.items||{},i=n.scheduleRangeField=n.scheduleRangeField||{},s=n.rangesContainer=n.rangesContainer||{},a=s.items=s.items||{},o=a.filler=a.filler||{},l=a.rangeStartField=a.rangeStartField||{},c=a.rangeEndField=a.rangeEndField||{};o.width=this.L("labelWidth"),i.value=i.value||r,i.value===ScheduleRange.daterange&&(s.hidden=!1);const d=l.value=l.value||t.startDate;l.max=DateHelper.max(t.startDate,DateHelper.add(t.endDate,-1,"d"));let u=c.value||t.endDate;u<=d&&(u=DateHelper.add(d,1,"d")),c.value=u,c.min=DateHelper.min(t.endDate,DateHelper.add(t.startDate,1,"d"))}};SchedulerExportDialog._$name="SchedulerExportDialog";var SinglePageExporter2=class extends(SchedulerExporterMixin_default(SinglePageExporter)){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}collectDependencies(){}positionRows(e,t){const r=[],n=[],i=/translate\((\d+.?\d*)px, (\d+.?\d*)px\)/,s=/top:.+?px/;if(t.enableDirectRendering)e.forEach((([e,,,t])=>{r.push(e),t&&Array.from(t.entries()).forEach((([e,[t,r,i=[]]])=>{this.exportMeta.eventsBoxes.set(String(e),r),n.push(t+i.join(""))}))}));else{let t=0;e.forEach((([e,a,o,l])=>{r.push(e.replace(i,"translate($1px, "+t+"px)"));const c=t-a;l&&Array.from(l.entries()).forEach((([e,[t,r]])=>{r.translate(0,c),this.exportMeta.eventsBoxes.set(String(e),r),n.push(t.replace(s,"top: "+r.y+"px"))})),t+=o}))}return{resources:r,events:n}}};SinglePageExporter2._$name="SinglePageExporter";var PdfExport2=class extends PdfExport{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[SinglePageExporter2,MultiPageExporter2,MultiPageVerticalExporter2],dialogClass:SchedulerExportDialog,scheduleRange:"completeview",rangeStart:null,rangeEnd:null}}get defaultExportDialogConfig(){return ObjectHelper.copyProperties(super.defaultExportDialogConfig,this,["scheduleRange"])}buildExportConfig(e){e=super.buildExportConfig(e);const{scheduleRange:t,rangeStart:r,rangeEnd:n}=this;return e.columns&&!e.columns.find((e=>"timeAxis"===e.type))&&e.columns.push(e.client.timeAxisColumn.id),ObjectHelper.assign({scheduleRange:t,rangeStart:r,rangeEnd:n},e)}};PdfExport2._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport2,!1,"Scheduler");var TimeAxisViewModel=class extends(Events_default()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headers:null,mode:"horizontal",suppressFit:!1,columnConfig:[],viewPreset:null,columnLinesFor:null,originalTickSize:null,headersDatesCache:[]}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);const r=t.timeAxis.viewPreset||t.viewPreset;if(r)if(r instanceof ViewPreset)t.consumeViewPreset(r);else{const e=pm.getPreset(r);e&&t.consumeViewPreset(e)}t.timeAxis.ion({reconfigure:"onTimeAxisReconfigure",thisObj:t}),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this),super.doDestroy()}calculateInfiniteScrollingDateRange(e,t,r=this.viewPreset){const{timeAxis:n,availableSpace:i}=this,{bufferCoef:s}=this.owner,{leafUnit:a,leafIncrement:o,tickSize:l}=r;if(t){const t=Math.ceil((i*s+i/2)/l);return{startDate:n.floorDate(DateHelper.add(e,-t*o,a),!1,a,o),endDate:n.ceilDate(DateHelper.add(e,t*o,a),!1,a,o)}}{const t=Math.ceil(i*s/l);return{startDate:n.floorDate(DateHelper.add(e,-t*o,a),!1,a,o),endDate:n.ceilDate(DateHelper.add(e,Math.ceil((i/l+t)*o),a),!1,a,o)}}}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get headers(){return this._headers}set headers(e){if(e&&e.length&&e[e.length-1].cellGenerator)throw new Error("`cellGenerator` cannot be used for the bottom level of your headers. Use TimeAxis#generateTicks() instead.");this._headers=e}get isTimeAxisViewModel(){return!0}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this.headers=null,this.setConfig(e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,r=!1){const n=this,{timeAxis:i,headers:s}=n,a=0!==e;if(n.isConfiguring||a&&n._availableSpace===e)return void(r&&n.trigger("update"));if(n._availableSpace=Math.max(e||n.availableSpace||0,0),"number"!=typeof n.availableSpace)throw new Error("提供给TimeAxis的可用空间无效");n.columnConfig=[];const o=n._tickSize=n.calculateTickSize(n.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("时间轴刻度大小无效");n.unitToPixelsCache={},n._totalSize=null;for(let e=0,{length:t}=s;e<t;e++){const t=s[e];if(t.cellGenerator){const r=t.cellGenerator.call(n,i.startDate,i.endDate);n.columnConfig[e]=n.createHeaderRow(e,t,r)}else n.columnConfig[e]=n.createHeaderRow(e,t)}t||n.trigger("update")}getDistanceBetweenDates(e,t){return this.getPositionFromDate(t)-this.getPositionFromDate(e)}getDistanceForDuration(e){return this.getSingleUnitInPixels("millisecond")*e}getPositionFromDate(e,t={}){const r=this.getScaledTick(e,t);return-1===r?-1:this.tickSize*(r-this.timeAxis.visibleTickStart)}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:r,isEnd:n,min:i,max:s}){const{timeAxis:a}=this,{include:o,unit:l}=a;let c=a.getTickFromDate(e);if(-1!==c&&t&&o){let t=!1;if(o.hour&&DateHelper.compareUnits(l,"hour")>0&&"day"!==l){const{from:n,to:i,lengthFactor:s,center:a}=o.hour,l=e.getHours(),c=Math.min(Math.max(l,n),i);if(!r&&c!==l)return-1;const d=a-(a-(c+e.getMinutes()/60))*s;e=DateHelper.add(e,d-l,"h"),t=!0}if(o.day&&DateHelper.compareUnits(l,"day")>0){const{from:l,to:c,lengthFactor:d,center:u}=o.day;let h=e.getDay();n&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<l||h>=c){if(!r)return-1;if(g=n?(c-h-8)%7:(l-h+7)%7,e=DateHelper.add(e,g,"d"),e=DateHelper.startOf(e,"d",!1),s&&e.getTime()>=s||i&&e.getTime()<=i)return-1}const{weekStartDay:p}=a,m=0===e.getDay()?0:u,f=e.getDay()+e.getHours()/24,v=m-(m-f)*d;e=DateHelper.add(e,v-f+p,"d"),t=!0}t&&(e=DateHelper.constrain(e,a.startDate,a.endDate),c=a.getTickFromDate(e))}return c}getDateFromPosition(e,t,r=!1){const n=this,{timeAxis:i}=n,s=n.getScaledPosition(e)/n.tickSize+i.visibleTickStart;if(s<0||s>i.count){if(r){let e;return e=s<0?DateHelper.add(i.startDate,s,i.unit):DateHelper.add(i.endDate,s-i.count,i.unit),t&&(e=i[t+"Date"](e)),e}return null}return i.getDateFromTick(s,t)}getScaledPosition(e){const{include:t,unit:r,weekStartDay:n}=this.timeAxis;if(t){const i=this.getSingleUnitInPixels("day");if(t.day&&DateHelper.compareUnits(r,"day")>0){const{from:r,lengthFactor:s}=t.day,a=e%(7*i);e=a/s+(r-n)*i+(e-a)}if(t.hour&&DateHelper.compareUnits(r,"hour")>0&&"day"!==r){const{from:r,lengthFactorExcl:n}=t.hour,s=e%i;e=s/n+r*this.getSingleUnitInPixels("hour")+(e-s)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=DateHelper.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:r,timeAxis:n,suppressFit:i}=t,s=n.unit;let a=0,o=1;if(t.snap){const e=n.resolution;o=DateHelper.getUnitToBaseUnitRatio(s,e.unit)*e.increment}if(i)a=e;else{const i=t.availableSpace/n.visibleTickTimeSpan;a=r||e<i?i:e,o>0&&(!r||o<1)&&(a=Math.max(1,o*a)/o)}return a}get totalSize(){return this._totalSize||(this._totalSize=Math.floor(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,r=!1){const n=this,i=[],s=t?n.lowestHeader:e,a=n.majorHeaderLevel,o=n.headers&&n.headers[e].unit,l=null!=a&&n.headers&&n.headers[a].unit,c=null!=a&&DateHelper.doesUnitsAlign(l,o);if(!(!n.headers||!n.headers[s].cellGenerator)){const e=n.columnConfig[s];for(let t=1,r=e.length;t<r;t++)i.push({date:e[t].startDate})}else n.forEachInterval(s,((t,s)=>{i.push({date:r?s:t,isMajor:a!==e&&c&&n.isMajorTick(r?s:t)})}));return i}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t,r){const n=this,i=[],{align:s,headerCellCls:a=""}=t,o=DateHelper.clearTime(new Date),{timeAxis:l}=n,c=n.headers.length-1,d=(r,d,h,g,p)=>{let m=DateHelper.format(r,t.dateFormat);const f=h>0&&!g,v={align:s,start:r,end:d,value:p?p.header:m,headerCellCls:a,width:c===e&&n.owner&&(l.fullTicks||f)?n.owner.tickSize:n.getDistanceBetweenDates(r,d),index:h};0!==v.width&&(v.coord=u-1,u+=v.width,n.headersDatesCache[e][r.getTime()]=1,t.renderer&&(m=t.renderer.call(t.thisObj||n,r,d,v,h),v.value=null==m?"":m),"day"!==t.unit||t.increment&&1!==t.increment||(v.headerCellCls+=" b-sch-dayheadercell-"+r.getDay(),DateHelper.clearTime(r,!0)-o==0&&(v.headerCellCls+=" b-sch-dayheadercell-today")),i.push(v))};let u=0;return n.headersDatesCache[e]={},r?r.forEach(((e,t)=>d(e.start,e.end,t,t===r.length-1,e))):n.forEachInterval(e,d),i}get mainHeader(){return"mainHeaderLevel"in this?this.headers[this.mainHeaderLevel]:this.bottomHeader}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return this.headers.length-1}get majorHeaderLevel(){const{headers:e}=this;return e?Math.max(e.length-2,0):null}isMajorTick(e){const t=this.majorHeaderLevel;return null!=t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,r=this){const{headers:n,timeAxis:i}=this;if(n)if(e===n.length-1)i.forEach(((e,n)=>t.call(r,e.startDate,e.endDate,n,n===i.count-1)));else{const s=n[e];i.forEachAuxInterval(s.unit,s.increment,t,r)}}forEachMainInterval(e,t){this.forEachInterval(this.mainHeaderLevel,e,t)}consumeViewPreset(e){const t=this;t.headers=null,t.getConfig("tickSize"),t.viewPreset=e,Object.assign(t,{headers:e.headers,columnLinesFor:e.columnLinesFor,mainHeaderLevel:e.mainHeaderLevel,_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}};TimeAxisViewModel._$name="TimeAxisViewModel";var tempDate2=new Date,TimelineDateMapper_default=e=>{var t;return __publicField(t=class extends(e||Base){getRtlX(e){return this.rtl&&this.isHorizontal&&(e=this.timeAxisViewModel.totalSize-e),e}getDateFromCoordinate(e,t,r=!0,n=!1,i=!1){return r||(e=this.currentOrientation.translateToScheduleCoordinate(e)),i||(e=this.getRtlX(e)),this.timeAxisViewModel.getDateFromPosition(e,t,n)}getDateFromCoord(e){return this.getDateFromCoordinate(e.coord,e.roundingMethod,e.local,e.allowOutOfRange,e.ignoreRTL)}getDateFromXY(e,t,r=!0,n=!1){return this.currentOrientation.getDateFromXY(e,t,r,n)}getDateFromDomEvent(e,t,r=!1){return this.getDateFromXY([e.pageX,e.pageY],t,!1,r)}getStartEndDatesFromRectangle(e,t,r,n=!1){const i=this,{isHorizontal:s}=i,a=s?e.x:e.top,o=s?e.right:e.bottom;let l,c;return a>=0&&o<i.timeAxisViewModel.totalSize?(l=i.getDateFromCoordinate(a,t,!0),c=i.getDateFromCoordinate(o,t,!0)):a<0?(c=i.getDateFromCoordinate(o,t,!0,n),l=c&&DateHelper.add(c,-r,"ms")):(l=i.getDateFromCoordinate(a,t,!0,n),c=l&&DateHelper.add(l,r,"ms")),{start:l,end:c}}getDisplayEndDate(e,t){return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||DateHelper.formatContainsHourInfo(this.displayDateFormat)||(e=DateHelper.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const r=this,{timeAxisViewModel:n}=r,{isContinuous:i,startMS:s,endMS:a,startDate:o,endDate:l,unit:c}=r.timeAxis,d=e.valueOf();let u;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(tempDate2.setTime(e),e=tempDate2),i&&e.getTimezoneOffset()===o.getTimezoneOffset()&&o.getTimezoneOffset()===l.getTimezoneOffset()&&-1!==DateHelper.getUnitToBaseUnitRatio(c,"day")){if(d<s||d>a)return-1;u=(d-s)/(a-s)*n.totalSize}else u=n.getPositionFromDate(e,t);return r.rtl&&r.isHorizontal&&(u=n.totalSize-u),t.local||(u=r.currentOrientation.translateToPageCoordinate(u)),u}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const{timeAxis:e,timelineScroller:t}=this;if(e.isContinuous){const r=(t.position+t.clientSize/2)/t.scrollSize;return new Date(e.startMS+(e.endMS-e.startMS)*r)}return this.getDateFromCoordinate(t.position+t.clientSize/2)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution="number"==typeof e?{increment:e,unit:this.timeAxis.resolution.unit}:e}get snap(){var e,t;return null!=(t=null==(e=this._timeAxisViewModel)?void 0:e.snap)?t:this._snap}updateSnap(e){this.isConfiguring||(this.timeAxisViewModel.snap=e,this.timeAxis.forceFullTicks=e&&this.fillTicks)}onSchedulerHorizontalScroll({subGrid:e,scrollLeft:t,scrollX:r}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}},"$name","TimelineDateMapper"),__publicField(t,"configurable",{snap:!1}),t},{eventNameMap:eventNameMap2}=EventHelper,TimelineDomEvents_default=e=>{var t;return t=class extends(e||Base){constructor(){super(...arguments),__publicField(this,"hoveredEvents",new Set)}initDomEvents(){const e=this,{schedulerEvents:t,schedulerEnterLeaveEvents:r}=e;t.element=r.element=e.timeAxisSubGridElement,t.thisObj=r.thisObj=e,EventHelper.on(t),EventHelper.on(r),BrowserHelper.supportsPointerEventConstructor&&EventHelper.on({element:document,scroll:"onScheduleScroll",capture:!0,thisObj:e})}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduleEvent(e){const t=this,r=t.getTimelineEventContext(e);t.lastPointerEvent=e,r&&t.trigger(""+(r.eventElement?t.scheduledEventName:"schedule")+(eventNameMap2[e.type]||StringHelper.capitalize(e.type)),r),t.timelineContext=r}handleScheduleEnterLeaveEvent(e){e.target.parentElement===this.foregroundCanvas&&this.handleScheduleEvent(e)}onScheduleScroll({target:e}){var t,r,n,i,s;const a=this;if(e&&a.updateTimelineContextOnScroll&&!(null==(t=a.features.pan)?void 0:t.isActive)&&!a.partners.some((e=>{var t;return null==(t=e.features.pan)?void 0:t.isActive}))&&(e.contains(a.element)||a.bodyElement.contains(e))){const{timelineContext:e,lastPointerEvent:t}=a;if(e){const a=DomHelper.elementFromPoint(e.domEvent.clientX,e.domEvent.clientY),o=new BrowserHelper.PointerEventConstructor("pointermove",t),l=new MouseEvent("mousemove",t);Object.defineProperty(o,"pointerId",{value:null!=(s=null!=(i=null==(r=GlobalEvents_default.currentPointerDown)?void 0:r.pointerId)?i:null==(n=GlobalEvents_default.currentTouch)?void 0:n.identifier)?s:1}),o.scrollInitiated=l.scrollInitiated=!0,null==a||a.dispatchEvent(o),null==a||a.dispatchEvent(l)}}}updateTimelineContext(e,t){this.trigger("timelineContextChange",{oldContext:t,context:e}),e||this.trigger("scheduleMouseLeave")}getTimelineEventContext(e){const t=this,r=e.target.closest(t.eventInnerSelector),n=t.getCellElementFromDomEvent(e);if(n){const i=t.getDateFromDomEvent(e,"floor");if(!i)return;const s=DomDataStore.get(n),a=r?t.getTimeSpanMouseEventParams(r,e):t.getScheduleMouseEventParams(s,e);if(!a)return;const o=t.isVertical?t.resourceStore.indexOf(a.resourceRecord):s.row.dataIndex,l=t.timeAxis.getTickFromDate(i),c=t.timeAxis.getAt(Math.floor(l));if(c)return{isTimelineContext:!0,domEvent:e,eventElement:r,cellElement:n,index:o,tick:c,tickIndex:l,date:i,tickStartDate:c.startDate,tickEndDate:c.endDate,tickParentIndex:c.parentIndex,row:s.row,event:e,...a}}}getCellElementFromDomEvent({target:e,clientY:t,type:r}){var n;const i=this,{isVertical:s,foregroundCanvas:a}=i,o=e.closest(i.eventSelector);return o?i.getCell({[s?"row":"record"]:s?0:i.resolveRowRecord(o),column:i.timeAxisColumn}):a.contains(e)?e===a||"mousemove"===r?null==(n=i.rowManager.getRowAt(t,!1))?void 0:n.getCell(i.timeAxisColumn.id):void 0:e.matches(".b-grid-row")?e.firstElementChild:e.closest(i.timeCellSelector)}matchScheduleCell(e){return e.closest(this.timeCellSelector)}onElementMouseButtonEvent(e){const t=e.target.closest(".b-sch-header-timeaxis-cell");if(t){const r=this,n=t.parentElement.dataset.headerPosition,i=r.timeAxisViewModel.columnConfig[n],s=r.timeAxis.isFiltered?i.findIndex((e=>e.index==t.dataset.tickIndex)):t.dataset.tickIndex,a=i[s],o=r.features.contextMenu;o&&e.type===o.triggerEvent||this.trigger("timeAxisHeader"+StringHelper.capitalize(e.type),{startDate:a.start,endDate:a.end,event:e})}}onElementMouseDown(e){this.onElementMouseButtonEvent(e),super.onElementMouseDown(e)}onElementClick(e){this.onElementMouseButtonEvent(e),super.onElementClick(e)}onElementDblClick(e){this.onElementMouseButtonEvent(e),super.onElementDblClick(e)}onElementContextMenu(e){this.onElementMouseButtonEvent(e),super.onElementContextMenu(e)}onElementMouseOver(e){var t;super.onElementMouseOver(e);const r=this,{target:n}=e,{hoveredEvents:i}=r;if(n.closest(r.eventInnerSelector)&&!(null==(t=r.features.eventDrag)?void 0:t.isDragging)){const t=n.closest(r.eventSelector);if(!i.has(t)&&!r.preventOverCls){i.add(t),t.classList.add(r.overScheduledEventClass);const n=r.getTimeSpanMouseEventParams(t,e);n&&r.trigger(r.scheduledEventName+"MouseEnter",n)}}else i.size&&r.unhoverAll(e)}onElementMouseOut(e){var t;super.onElementMouseOut(e);const r=this,{target:n,relatedTarget:i}=e,s=n.closest(r.eventInnerSelector),a=n.closest(r.eventSelector),o=r.resolveTimeSpanRecord(n);if(s&&o&&r.hoveredEvents.has(a)&&!(null==(t=r.features.eventDrag)?void 0:t.isDragging)){if(i&&DomHelper.isDescendant(s,i))return;r.unhover(a,e)}}unhover(e,t){const r=this;e.classList.remove(r.overScheduledEventClass),r.trigger(r.scheduledEventName+"MouseLeave",r.getTimeSpanMouseEventParams(e,t)),r.hoveredEvents.delete(e)}unhoverAll(e){for(const t of this.hoveredEvents)!t.isReleased&&!t.classList.contains("b-released")&&this.unhover(t,e);this.hoveredEvents.clear()}get widgetClass(){}},__publicField(t,"$name","TimelineDomEvents"),__publicField(t,"configurable",{timelineContext:{$config:{equal:(e,t)=>(null==e?void 0:e.index)===(null==t?void 0:t.index)&&(null==e?void 0:e.tickParentIndex)===(null==t?void 0:t.tickParentIndex)&&!(((null==e?void 0:e.tickStartDate)||0)-((null==t?void 0:t.tickStartDate)||0))}},updateTimelineContextOnScroll:!0}),__publicField(t,"properties",{schedulerEvents:{mouseover:"handleScheduleEvent",mousedown:"handleScheduleEvent",mouseup:"handleScheduleEvent",click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent",mousemove:"handleScheduleEvent",mouseout:"handleScheduleEvent"},schedulerEnterLeaveEvents:{mouseenter:"handleScheduleEnterLeaveEvent",mouseleave:"handleScheduleEnterLeaveEvent",capture:!0}}),__publicField(t,"delayable",{onScheduleScroll:"raf"}),t},datesDiffer=(e=0,t=0)=>t-e,TimelineViewPresets_default=e=>class extends(e||Base){static get $name(){return"TimelineViewPresets"}static get configurable(){return{viewPreset:"weekAndDayLetter",presets:!0,displayDateFormat:null}}changePresets(e){const t={owner:this};let r=[];if(!0===e)r=pm.allRecords;else if(Array.isArray(e))for(const t of e)if("string"==typeof t){const e=pm.getById(t);e&&r.push(e)}else r.push(t);else ObjectHelper.assign(t,e);const n=new PresetStore(t);return n.add(r),n}changeViewPreset(e,t){const r=this,{presets:n}=r;e?(e=n.createRecord(e),n.includes(e)||n.add(e)):e=n.first;const i=r.lastViewPresetOptions||{},s=e.options||(e.options={}),a=s.event={startDate:s.startDate,endDate:s.endDate,from:t,to:e,preset:e},o=!r._viewPreset||!r._viewPreset.equals(e),l=datesDiffer(s.startDate,i.startDate)||datesDiffer(s.endDate,i.endDate)||datesDiffer(s.centerDate,i.centerDate)||s.startDate&&datesDiffer(s.startDate,r.startDate)||s.endDate&&datesDiffer(s.endDate,r.endDate);if((o||l)&&(o||(r._viewPreset=null),r.isConfiguring||!1!==r.trigger("beforePresetChange",a)))return e}get displayDateFormat(){return this._displayDateFormat||this.viewPreset.displayDateFormat}updateDisplayDateFormat(e){this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return DateHelper.format(e,this.displayDateFormat)}updateViewPreset(e){const t=this,{options:r}=e,{event:n,startDate:i,endDate:s}=r,{isHorizontal:a,_timeAxis:o,_timeAxisViewModel:l}=t;let{centerDate:c,zoomDate:d,zoomPosition:u}=r,h=!1;if(t._viewPresetChanging=!0,o&&!t.isConfiguring){if(t.rtl&&(u=l.totalSize-u),t.lastViewPresetOptions=r,o.isConfigured){t.suspendRefresh();const r=ObjectHelper.copyProperties({},t,["weekStartDay","startTime","endTime"]);t.infiniteScroll?Object.assign(r,l.calculateInfiniteScrollingDateRange(c||new Date((i.getTime()+s.getTime())/2),!0,e)):i?(r.startDate=i,r.endDate=s,!c&&s&&(c=new Date((i.getTime()+s.getTime())/2))):(r.startDate=o.startDate,r.endDate=s||o.endDate,c||(c=t.viewportCenterDate)),o.isConfigured=!1,r.viewPreset=e,o.reconfigure(r,!0),l.reconfigure({viewPreset:e,headers:e.headers,columnLinesFor:null!=e.columnLinesFor?e.columnLinesFor:e.headers.length-1,tickSize:a?e.tickWidth:e.tickHeight||e.tickWidth||60}),t.resumeRefresh(!1)}if(t.refresh(),!r.notScroll&&t.isPainted)if(d&&u){const e=unitMagnitudes[o.resolutionUnit]>3?"hour":"minute",i=DateHelper.asMilliseconds("minute"===e?15:1,e),s=new Date(Math.round(d/i)*i);let a;n.zoomDate=d,n.zoomPosition=u,n.zoomLevel=r.zoomLevel,a=t.rtl?l.getPositionFromDate(s)-u:t.getCoordinateFromDate(s)-u,t.timelineScroller.scrollBy(a)}else if(c){t.cachedCenterDate=c,n.centerDate=c;const e=t.timelineScroller.clientSize,r=t.rtl?t.timeAxisViewModel.totalSize-t.getCoordinateFromDate(c,!0):t.getCoordinateFromDate(c,!0),i=Math.max(r-e/2,0);t.scrollingToCenter=!0,i===(t.isHorizontal?t.scrollLeft:t.scrollTop)?h=!0:t.isHorizontal?t.scrollHorizontallyTo(i,!1):t.scrollVerticallyTo(i,!1),t.setTimeout((()=>{t.scrollingToCenter=!1}),100)}else 0===(t.isHorizontal?t.scrollLeft:t.scrollTop)?h=!0:t.timelineScroller.scrollTo(0)}t.dataset.presetId=e.id,t.trigger("presetChange",n),t._viewPresetChanging=!1,h&&(t.isHorizontal?t.currentOrientation.updateFromHorizontalScroll(t.scrollLeft,t.scrollX):t.currentOrientation.updateFromVerticalScroll(t.scrollTop))}doDestroy(){this._presets.owner===this&&this._presets.destroy(),super.doDestroy()}getCurrentConfig(e){const t=super.getCurrentConfig(e);return t.viewPreset&&t.viewPreset.name&&!t.viewPreset.base&&delete t.viewPreset.name,t}get widgetClass(){}},TimelineZoomable_default=e=>{var t;return t=class extends(e||Base){constructor(){super(...arguments),__publicField(this,"lastWheelTime",-1),__publicField(this,"lastZoomPosition",-1)}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&EventHelper.on({element:t.timeAxisSubGridElement,wheel:"onWheel",throttled:{buffer:100,alt:e=>e.ctrlKey&&e.preventDefault()},thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.ion({timeaxisheaderdblclick:({startDate:e,endDate:r})=>{t.forceFit||t.zoomToSpan({startDate:e,endDate:r})}})}get maxZoomLevel(){return this._maxZoomLevel||this.presets.count-1}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.presets.count-1),e<0||e>=this.presets.count)throw new Error("Invalid range for `maxZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.presets.count)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}get zoomLevel(){return this.presets.indexOf(this.viewPreset)}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){const{bottomHeader:r}=e,n=this.isHorizontal?e.tickWidth:e.tickHeight;return Math.round((DateHelper.add(new Date(1,0,1),r.increment||1,r.unit)-new Date(1,0,1))/(t?n:e.actualWidth||n))}zoomTo(e){const t=this;"object"==typeof e?e.preset?t.zoomToLevel(e.preset,e):null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e):t.zoomToLevel(e)}zoomToLevel(e,t={}){if(this.forceFit)return void console.warn("警告：forceFit设置和缩放无法组合");"number"==typeof e&&(e=Math.min(Math.max(e,this.minZoomLevel),this.maxZoomLevel));const r=this,{presets:n}=r,i=r.isVertical?"tickHeight":"tickWidth",s=n.createRecord(e),a=s[i],o=t.startDate?new Date(t.startDate):null,l=t.endDate?new Date(t.endDate):null;n.add(s);let c=o&&l?{startDate:o,endDate:l}:null;const d=t.centerDate?new Date(t.centerDate):c?new Date((o.getTime()+l.getTime())/2):r.viewportCenterDateCached,u=r.isVertical?r.scrollable.clientHeight:r.timeAxisSubGrid.width;return 0===u?null:(c||(c=r.calculateOptimalDateRange(d,u,s)),"width"in t&&s.setData(i,t.width),r.isZooming=!0,s.options={...t,startDate:c.startDate||r.startDate,endDate:c.endDate||r.endDate,centerDate:d},r.viewPreset=s,s.actualWidth=r.timeAxisViewModel.tickSize,r.isZooming=!1,s.setData(i,a),r.zoomLevel)}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e={leftMargin:0,rightMargin:0,...e,...t}).startDate&&e.endDate&&(e.endDate>e.startDate?this.zoomToSpan(e):this.scrollToDate(e.startDate))}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");const t=this,{timeAxis:r}=t,n=e.adjustStart>=0||e.adjustEnd>=0;let{startDate:i,endDate:s}=e;if(n&&(i=DateHelper.add(i,-e.adjustStart,r.mainUnit),s=DateHelper.add(s,e.adjustEnd,r.mainUnit)),i<=s){const{availableSpace:a}=t.timeAxisViewModel,o=t.presets.allRecords,l=s-i||1;let c,d,u=t.zoomLevel;-1===u&&(u=0);let h,g=t.getMilliSecondsPerPixelForZoomLevel(o[u],!0),p=u+(c=l/g+e.leftMargin+e.rightMargin>a?-1:1),m=null;for(;p>=0&&p<=o.length-1;){h=o[p],g=t.getMilliSecondsPerPixelForZoomLevel(h,!0);const r=l/g+e.leftMargin+e.rightMargin;if(-1===c){if(r<=a){m=p;break}}else{if(!(r<=a))break;u!==p-c&&(m=p)}p+=c}m=null!=m?m:p-c,h=o[m];const f=h.bottomHeader.unit;g=t.getMilliSecondsPerPixelForZoomLevel(h,!0),(e.leftMargin||e.rightMargin)&&(i=new Date(i.getTime()-g*e.leftMargin),s=new Date(s.getTime()+g*e.rightMargin));const v=DateHelper.getDurationInUnit(i,s,f,!0)/h.bottomHeader.increment;if(0===v)return null;const y=Math.floor(a/v),b=e.centerDate||new Date((i.getTime()+s.getTime())/2);d=n?{startDate:i,endDate:s}:t.calculateOptimalDateRange(b,a,h);let C=t.zoomLevel;return t.zoomLevel===m?r.reconfigure(d):C=t.zoomToLevel(m,Object.assign(d,{width:y,centerDate:b})),t.infiniteScroll&&t.scrollToDate(i,{block:"start"}),C}return null}zoomIn(e=1,t){const r=this.zoomLevel;return r>=this.maxZoomLevel?null:this.zoomToLevel(r+e,t)}zoomOut(e=1,t){const r=this.zoomLevel;return r<=this.minZoomLevel?null:this.zoomToLevel(r-e,t)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,r,n){if(n)return n;const i=this,{timeAxis:s}=i,{bottomHeader:a}=r,o=i.isHorizontal?r.tickWidth:r.tickHeight;if(i.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const l=a.unit,c=Math.ceil(t/o*a.increment*i.visibleZoomFactor/2),d=DateHelper.add(e,-c,l),u=DateHelper.add(e,c,l);return i.infiniteScroll?i.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,!0):{startDate:s.floorDate(d,!1,l,a.increment),endDate:s.ceilDate(u,!1,l,a.increment)}}onElementMouseMove(e){const{isHorizontal:t,zoomContext:r}=this;super.onElementMouseMove(e),e.isTrusted&&r&&Math.abs(e["client"+(t?"X":"Y")]-r.coordinate)>10&&(this.zoomContext=null)}async onWheel(e){if(e.ctrlKey&&!this.forceFit){e.preventDefault();const t=this,{zoomContext:r,isHorizontal:n,timelineScroller:i,zoomLevel:s}=t,a=performance.now(),o=e["client"+(n?"X":"Y")],l=o-i.viewport[n?"x":"y"]+i.position;a-t.lastWheelTime>200||!r||Math.abs(o-t.zoomContext.coordinate)>20?t.zoomContext={zoomLevel:s,coordinate:o,zoomPosition:l,zoomDate:t.getDateFromDomEvent(e)}:(s>r.zoomLevel&&(r.zoomDate=t.getDateFromDomEvent(e),r.zoomLevel=s),r.zoomPosition=l),t.lastWheelTime=a,t["zoom"+(e.deltaY>0?"Out":"In")](void 0,t.zoomContext)}}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}},__publicField(t,"$name","TimelineZoomable"),__publicField(t,"defaultConfig",{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,minZoomLevel:0,maxZoomLevel:null,visibleZoomFactor:5,zoomKeepsOriginalTimespan:null}),t},RecurringEvents_default=e=>{var t;return __publicField(t=class extends(e||Base){construct(e){super.construct(e),this.ion({beforeEventDropFinalize:"onRecurrableBeforeEventDropFinalize",beforeEventResizeFinalize:"onRecurrableBeforeEventResizeFinalize",beforeAssignmentDelete:"onRecurrableAssignmentBeforeDelete"})}changeRecurrenceConfirmationPopup(e,t){const r=this.constructor.reconfigure(t,e,"recurrenceconfirmation");return r.owner=this,r}findRecurringEventToConfirmDelete(e){return e.find((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)))}onRecurrableAssignmentBeforeDelete({assignmentRecords:e,context:t}){const r=e.map((e=>e.event)),n=this.findRecurringEventToConfirmDelete(r);if(this.enableRecurringEvents&&n)return this.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:n,changerFn(){t.finalize(!0)},cancelFn(){t.finalize(!1)}}),!1}onRecurrableBeforeEventDropFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecords:t}=e,r=t.filter((e=>e.supportsRecurring&&(e.isRecurring||e.isOccurrence)));r.length&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:r[0],changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onRecurrableBeforeEventResizeFinalize({context:e}){if(this.enableRecurringEvents){const{eventRecord:t}=e;t.supportsRecurring&&(t.isRecurring||t.isOccurrence)&&(e.async=!0,this.recurrenceConfirmationPopup.confirm({actionType:"update",eventRecord:t,changerFn(){e.finalize(!0)},cancelFn(){e.finalize(!1)}}))}}onAssignmentChange({action:e,records:t}){var r;if("dataset"!==e&&Array.isArray(t))for(const e of t)(null==(r=e.event)?void 0:r.isRecurring)&&!e.event.isBatchUpdating&&e.event.removeOccurrences()}getOccurrencesFor(e){return this.eventStore.getOccurrencesForTimeSpan(e,this.timeAxis.startDate,this.timeAxis.endDate)}async removeEvents(e,t=null,r=this){const n=this;if(!n.readOnly&&e.length){const i={finalize(r=!0){if(t&&t(r),!1!==r)if(e.some((e=>{var t;return e.isOccurrence||(null==(t=e.event)?void 0:t.isOccurrence)})))e.forEach((e=>e.isOccurrenceAssignment?e.event.remove():e.remove()));else{(e[0].isAssignment?n.assignmentStore:n.eventStore).remove(e)}}};let s;if(s=e[0].isAssignment?n.trigger("beforeAssignmentDelete",{assignmentRecords:e,context:i}):n.trigger("beforeEventDelete",{eventRecords:e,context:i}),!1!==s){const t=e.find((e=>e.isRecurring||e.isOccurrence));return t?(n.recurrenceConfirmationPopup.owner=r,n.recurrenceConfirmationPopup.confirm({actionType:"delete",eventRecord:t,changerFn(){i.finalize(!0)},cancelFn(){i.finalize(!1)}})):i.finalize(!0),!0}}return!1}get widgetClass(){}},"$name","RecurringEvents"),__publicField(t,"configurable",{enableRecurringEvents:!1,recurrenceConfirmationPopup:{$config:["lazy"],value:{type:"recurrenceconfirmation"}}}),t},TimelineEventRendering_default=e=>{var t;return __publicField(t=class extends(e||Base){static get $name(){return"TimelineEventRendering"}static get defaultConfig(){return{resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green",tickSize:null}}updateFillTicks(e){this.isConfiguring||(this.timeAxis.forceFullTicks=e&&this.snap,this.refreshWithTransition(),this.trigger("stateChange"))}changeBarMargin(e){return ObjectHelper.assertNumber(e,"barMargin"),this.isHorizontal&&this.rowHeight?Math.min(Math.ceil(this.rowHeight/2),e):e}updateBarMargin(){this.rendered&&(this.currentOrientation.onBeforeRowHeightChange(),this.refreshWithTransition(),this.trigger("stateChange"))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;ObjectHelper.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickSize(e){ObjectHelper.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","deep-orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal","rounded"]}get widgetClass(){}},"configurable",{barMargin:10,fillTicks:!1}),t},maintainVisibleStart={maintainVisibleStart:!0},defaultScrollOptions4={block:"nearest"},TimelineScroll_default=e=>class extends(e||Base){static get $name(){return"TimelineScroll"}static get configurable(){return{bufferCoef:5,bufferThreshold:.2,infiniteScroll:!1}}initScroll(){const e=this,{isHorizontal:t,visibleDate:r}=e;super.initScroll();const{scrollable:n}=t?e.timeAxisSubGrid:e;if(n.ion({scroll:"onTimelineScroll",thisObj:e}),e.infiniteScroll){const t=r?{...r,visibleDate:r.date}:{visibleDate:e.viewportCenterDate,block:"center"},{startDate:n,endDate:i}=e.timeAxisViewModel.calculateInfiniteScrollingDateRange(t.visibleDate,"center"===t.block);e.setTimeSpan(n,i,t)}}get timelineScroller(){const e=this;return e.scrollInitialized||e.initScroll(),e._timelineScroller||(e._timelineScroller=new TimelineScroller({widget:e,scrollable:e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable,isHorizontal:e.isHorizontal}))}doDestroy(){var e;null==(e=this._timelineScroller)||e.destroy(),super.doDestroy()}onTimelineScroll({source:e}){this.infiniteScroll&&this.checkTimeAxisScroll(e[this.isHorizontal?"x":"y"])}checkTimeAxisScroll(e){const t=this,r=t.timelineScroller,{clientSize:n}=r,i=n*t.bufferCoef*t.bufferThreshold,s=r.maxPosition,{style:a}=t.timeAxisSubGrid.virtualScrollerElement;(s-e<i||e<i)&&(a.overflow="hidden",a.pointerEvents="none",a.paddingBottom=DomHelper.scrollBarWidth+"px",t.setTimeout((()=>{a.overflow="",a.paddingBottom="",a.pointerEvents=""}),100),t.shiftToDate(t.getDateFromCoordinate(e,null,!0,!1,!0)))}shiftToDate(e,t){const r=this.timeAxisViewModel.calculateInfiniteScrollingDateRange(e,t);this.setTimeSpan(r.startDate,r.endDate,maintainVisibleStart)}updateInfiniteScroll(e){!this.isConfiguring&&e&&this.checkTimeAxisScroll(this.timelineScroller.position)}async scrollToDate(e,t={}){const r=this,{timeAxis:n,visibleDateRange:i,infiniteScroll:s}=r,{unit:a,increment:o}=n,l=t.edgeOffset||0,c=DateHelper.ceil(i.endDate,o+" "+a)-DateHelper.floor(i.startDate,o+" "+a),d=e>r.viewportCenterDate?1:-1,u=(s?c*r.bufferCoef*r.bufferThreshold:"center"===t.block?c/2:l?r.getMilliSecondsPerPixelForZoomLevel(r.viewPreset)*l:0)*d,h=new Date(e.getTime()+u);(h>n.endDate?1:h<n.startDate?-1:0)&&r.infiniteScroll&&(r.shiftToDate(new Date(e-u),null,!0),await r.nextAnimationFrame());const g=r.timelineScroller.viewport,p=r.getCoordinateFromDate(e,!0),m=r.isHorizontal?new Rectangle(r.getCoordinateFromDate(e,!1),g.y,Math.min(r.timeAxisViewModel.tickSize,r.timeAxisViewModel.availableSpace),g.height):new Rectangle(g.x,r.getCoordinateFromDate(e,!1),g.width,r.timeAxisViewModel.tickSize);await r.scrollToCoordinate(p,m,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}async scrollToCoordinate(e,t,r,n={}){const i=this;if(e<0){const e=i.endDate-i.startDate,{unit:t,increment:s}=i.timeAxis,a=DateHelper.floor(new Date(r.getTime()-e/2),s+" "+t),o=DateHelper.add(a,e);return a-i.startDate!=0&&o-i.endDate!=0?(i.setTimeSpan(a,o),i.scrollToDate(r,n)):void 0}return await i.timelineScroller.scrollIntoView(t,n),!i.isDestroyed&&i.nextAnimationFrame()}set scrollLeft(e){this.timeAxisSubGrid.scrollable.element.scrollLeft=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.element.scrollLeft}set scrollX(e){this.timeAxisSubGrid.scrollable.x=e}get scrollX(){return this.timeAxisSubGrid.scrollable.x}set scrollTop(e){this.scrollable.y=e}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}},TimelineScroller=class extends Scroller{static get configurable(){return{position:null,x:null,y:null}}updateOverflowX(){}updateOverflowY(){}onScroll(e){super.onScroll(e),this._position=null}syncPartners(e){this.scrollable.syncPartners(e)}updatePosition(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get viewport(){return this.scrollable.viewport}get position(){return this._position=this.scrollable[this.isHorizontal?"x":"y"]}get clientSize(){return this.scrollable["client"+(this.isHorizontal?"Width":"Height")]}get scrollSize(){return this.scrollable["scroll"+(this.isHorizontal?"Width":"Height")]}get maxPosition(){return this.scrollable["max"+(this.isHorizontal?"X":"Y")]}scrollTo(e,t){return this.isHorizontal?this.scrollable.scrollTo(e,null,t):this.scrollable.scrollTo(null,e,t)}scrollBy(e=0,t=0,r=defaultScrollOptions4){return this.isHorizontal?this.scrollable.scrollBy(e||t,0,r):this.scrollable.scrollBy(0,t||e,r)}scrollIntoView(){return this.scrollable.scrollIntoView(...arguments)}changeX(e){this.position=e}changeY(e){this.position=e}get x(){return this.position}set x(e){this.scrollable[this.isHorizontal?"x":"y"]=e}get y(){return this.position}set y(e){this.scroller[this.isHorizontal?"x":"y"]=e}get clientWidth(){return this.clientSize}get clientHeight(){return this.clientSize}get scrollWidth(){return this.scrollSize}get scrollHeight(){return this.scrollSize}get maxX(){return this.maxPosition}get maxY(){return this.maxPosition}},copyProperties=["barMargin"],TimelineState_default=e=>class extends(e||Base){static get $name(){return"TimelineState"}getState(){const e=this,t=ObjectHelper.copyProperties(super.getState(),e,copyProperties);return t.zoomLevel=e.zoomLevel,t.zoomLevelOptions={startDate:e.startDate,endDate:e.endDate,centerDate:!e.infiniteScroll||e.timeAxisViewModel.availableSpace?e.viewportCenterDate:void 0,width:e.tickSize},t}applyState(e){var t;const r=this;r.suspendRefresh(),ObjectHelper.copyProperties(r,e,copyProperties),super.applyState(e),null!=e.zoomLevel&&(r.infiniteScroll&&(null==(t=null==e?void 0:e.scroll)?void 0:t.scrollLeft)&&(e.scroll.scrollLeft={}),r.isPainted?r.zoomToLevel(e.zoomLevel,e.zoomLevelOptions):r._zoomAfterPaint={zoomLevel:e.zoomLevel,zoomLevelOptions:e.zoomLevelOptions}),r.resumeRefresh(!0)}onPaint(...e){if(super.onPaint(...e),this._zoomAfterPaint){const{zoomLevel:e,zoomLevelOptions:t}=this._zoomAfterPaint;this.zoomToLevel(e,t),delete this._zoomAfterPaint}}get widgetClass(){}},Header2=class extends Header{static get $name(){return"SchedulerHeader"}refreshContent(){var e;(null==(e=this.headersElement)?void 0:e.querySelector(".b-sch-timeaxiscolumn"))||super.refreshContent()}};Header2._$name="Header";var TimeAxisSubGrid=class extends SubGrid{static get $name(){return"TimeAxisSubGrid"}static get type(){return"timeaxissubgrid"}static get configurable(){return{sealedColumns:!0,headerClass:Header2}}startConfigure(e){const{grid:t}=e;t.timeAxisSubGrid=this,super.startConfigure(e),t.isHorizontal&&(e.header={cls:{"b-sticky-headers":t.stickyHeaders}},delete e.headerClass),"flex"in e||"width"in e||(e.flex=1)}changeScrollable(){const e=this,t=super.changeScrollable(...arguments);return t&&Object.defineProperty(t,"scrollWidth",{get(){var e,t;return null!=(t=null==(e=this.element)?void 0:e.scrollWidth)?t:0},set(){e.grid.updateCanvasSize()}}),t}syncScrollingPartners(e=!0){this.grid._viewPresetChanging||super.syncScrollingPartners(e)}onInternalResize(e,t,r,n,i){const s=this;if(s.isPainted&&t!==n){const e=s.grid,r=e._bodyRectangle.height;DomHelper.scrollBarWidth&&t<n&&(s.monitorResize=!1),e.onSchedulerViewportResize(t,r,n,r),s.monitorResize||s.requestAnimationFrame((()=>s.monitorResize=!0))}super.onInternalResize(...arguments)}clearWidthCache(){super.clearWidthCache(),this.owner.isHorizontal&&this.owner.updateViewModelAvailableSpace(this.width)}async expand(){const{owner:e}=this;await super.expand(),e.isPainted&&e.timeAxisViewModel.update(this.width,!1,!0)}};TimeAxisSubGrid.initClass(),TimeAxisSubGrid._$name="TimeAxisSubGrid";var exitTransition={fn:"exitTransition",delay:0,cancelOutstanding:!0},emptyObject11={},TimelineBase=class extends(GridBase.mixin(TimelineDateMapper_default,TimelineDomEvents_default,TimelineEventRendering_default,TimelineScroll_default,TimelineState_default,TimelineViewPresets_default,TimelineZoomable_default,RecurringEvents_default)){constructor(){super(...arguments),__publicField(this,"timeCellSelector",null)}static get $name(){return"TimelineBase"}static get type(){return"timelinebase"}static get defaultConfig(){return{workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,snapRelativeToEventStartDate:!1,suppressFit:!1,timeCellCls:null,scheduledEventName:null,overScheduledEventClass:null,preventOverCls:!1,useBackgroundCanvas:!1,enableEventAnimations:!0,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,defaultRegion:"locked",durationDisplayPrecision:1,asyncEventSuffix:"PreCommit",viewportResizeTimeout:250,testConfig:{viewportResizeTimeout:50}}}updateTimeZone(e){this.isConfiguring&&(this.project._isConfiguringTimeZone=!0),this.project.timeZone=e}get timeZone(){return this.project.timeZone}populateEventMenu(){}populateScheduleMenu(){}onVisibleDateRangeChange(e){if(!this.handlingVisibleDateRangeChange){const t=this,{_visibleDateRange:r}=t;(!r||r.startDate-e.startDate||r.endDate-e.endDate)&&(t.timeView.range=e,t.handlingVisibleDateRangeChange=!0,t.trigger("visibleDateRangeChange",{old:r,new:e}),t.handlingVisibleDateRangeChange=!1,t._visibleDateRange=e)}}onVisibleResourceRangeChange(){}construct(e={}){const t=this;super.construct(e),t.$firstVerticalOverflow=!0,t.initDomEvents(),t.currentOrientation.init(),t.rowManager.ion({refresh:()=>{t.forceLayout=!1}})}createSubGrid(e,t={}){const r=this,{stickyHeaders:n}=r;return e===(r.schedulerRegion||"normal")?t.type="timeaxissubgrid":"locked"===e&&n&&r.isVertical&&(t.scrollable={overflowX:"visible",overflowY:"visible"},r.bodyContainer.classList.add("b-sticky-headers")),super.createSubGrid(e,t)}doDestroy(){const e=this,{partneredWith:t,currentOrientation:r}=e;null==r||r.destroy(),t?(t.forEach((t=>{e.removePartner(t)})),t.destroy()):(e.timeAxisViewModel.destroy(),e.timeAxis.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),ResizeMonitor.addResizeListener(this.bodyContainer,this.onBodyResize.bind(this)),this.getConfig("partner")}changeStartDate(e){return"string"==typeof e&&(e=DateHelper.parse(e)),e}onPaint({firstPaint:e}){var t,r;if(e){const e=this,n=(e.isHorizontal?e.timeAxisSubGrid.scrollable:e.scrollable).element.getBoundingClientRect()[e.isHorizontal?"width":"height"];e.timeAxisViewModel.update(n,e.infiniteScroll,!0),e.infiniteScroll&&(null==(r=(t=e.currentOrientation).doUpdateTimeView)||r.call(t))}super.onPaint(...arguments)}onSchedulerHorizontalScroll(e,t,r){this.currentOrientation.updateFromHorizontalScroll(r),super.onSchedulerHorizontalScroll(e,t,r)}initScroll(){const e=this;let t=0;super.initScroll(),e.ion({horizontalScroll:({subGrid:r,scrollLeft:n,scrollX:i})=>{!e.isPainted||r!==e.timeAxisSubGrid||e.isDestroying||e.refreshSuspended||e.onSchedulerHorizontalScroll(r,n,i),t++}}),"horizontal"===e.testPerformance&&e.setTimeout((()=>{const r=performance.now();let n=5,i=1;const s=e.setInterval((()=>{if(n+=5,e.scrollX+=(10+Math.floor(n))*i,1===i&&e.scrollX>5500&&(i=-1,n=5),-1===i&&e.scrollX<=0){const n=(performance.now()-r)/t,i=Math.round(1e3/n*10)/10;clearInterval(s),console.log(e.eventPositionMode,e.eventScrollMode,i+"fps")}}),0)}),500)}preserveViewCenter(e,t=this,...r){const n=this,i=n.viewportCenterDate,s=e.apply(t,r),a=n.timelineScroller,{clientSize:o}=a,l=Math.max(Math.floor(n.getCoordinateFromDate(i,!0)-o/2),0);return n.scrollingToCenter=!0,a.scrollTo(l,!1).then((()=>n.scrollingToCenter=!1)),s}setTimeSpan(e,t,r=emptyObject11){const n=this,{timeAxis:i}=n,{preventThrow:s=!1,maintainVisibleStart:a=!1,visibleDate:o}=r,{startDate:l,endDate:c}=i.getAdjustedDates(e,t),d=i.startDate-l!=0,u=i.endDate-c!=0;if(d||u){if(a){const{timeAxisViewModel:e}=n,{totalSize:t}=e,r=e.tickSize,i=n.timelineScroller,s=i.position,a=e.getDateFromPosition(s);a>=l&&a<c&&e.ion({update(){const o=e.tickSize!==r;n.updateCanvasSize(),!d||u||o?i.position=d||o?e.getPositionFromDate(a):s:i.position+=e.totalSize-t,i.syncPartners(!0)},prio:1e4,once:!0})}const e=i.reconfigure({startDate:l,endDate:c},!1,s);return o&&n.scrollToDate(o,r),e}}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some((e=>this.timeAxis.isTimeSpanInAxis(e)))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=StringHelper.capitalize(this.scheduledEventName)),this._capitalizedEventName}set partner(e){this._partner=e,this.addPartner(e)}addPartner(e){const t=this;if(!t.isPartneredWith(e)){(t.partneredWith||(t.partneredWith=new Collection)).add(e),(e.partneredWith||(e.partneredWith=new Collection)).add(t),t.getConfig("viewPreset"),e.ion({presetchange:"onPartnerPresetChange",thisObj:t}),e.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:t});const r=t.partnerSharedConfigs.reduce(((t,r)=>(t[r]=e[r],t)),{});t.setConfig(r),t.ion({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.ion({overflowChange:"onPartnerOverflowChange",thisObj:e}),t.isPainted?(t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()):t.initScroll=FunctionHelper.createSequence(t.initScroll,(()=>{t.scrollable.addPartner(e.scrollable,t.isHorizontal?"x":"y"),e.syncPartnerSubGrids()}),t)}}removePartner(e){const t=this,{partneredWith:r}=t;t.isPartneredWith(e)&&(r.remove(e),t.scrollable.removePartner(e.scrollable),t.un({presetchange:"onPartnerPresetChange",thisObj:e}),t.scrollable.un({overflowChange:"onPartnerOverflowChange",thisObj:e}),e.removePartner(t))}isPartneredWith(e){var t;return Boolean(null==(t=this.partneredWith)?void 0:t.includes(e))}onPartnerOverflowChange({source:e,y:t}){const{scrollable:r}=this,n=r.hasOverflow("y");n!==t?n?e.overflowY="scroll":(e.overflowY=!0,r.overflowY="scroll",this.refreshVirtualScrollbars()):r.overflowY=!0}onPartnerPresetChange({preset:e,startDate:t,endDate:r,centerDate:n,zoomDate:i,zoomPosition:s,zoomLevel:a}){this._viewPresetChanging||this.viewPreset===e||(e.options={startDate:t,endDate:r,centerDate:n,zoomDate:i,zoomPosition:s,zoomLevel:a},this.viewPreset=e)}get partner(){return this._partner}get partners(){const e=this.partner?[this.partner]:[];return this.partneredWith&&e.push.apply(e,this.partneredWith.allValues),e}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}changeColumns(e,t){const r=this;let n,i;if(e){const t=Array.isArray(e);let s=e;t||(s=e.data),n=s&&s.length,s.some(((e,t)=>"timeAxis"===e.type&&(n=t,i=ObjectHelper.assign(e,r.timeAxisColumn),!0))),r.isVertical?(s=[ObjectHelper.assign({type:"verticalTimeAxis"},r.verticalTimeAxisColumn),s[n]],n=1):s=s.slice(),s[n]=this._timeAxisColumn||{type:"timeAxis",cellCls:r.timeCellCls,mode:r.mode,...i},t?e=s:e.data=s}return super.changeColumns(e,t)}updateColumns(e,t){if(super.updateColumns(e,t),e){const e=this,t=e._timeAxisColumn=e.columns.find((e=>e.isTimeAxisColumn));e.isVertical&&(e.verticalTimeAxisColumn=e.columns.find((e=>e.isVerticalTimeAxisColumn)),e.verticalTimeAxisColumn.relayAll(e)),t.relayAll(e)}}onColumnsChanged({action:e,changes:t,record:r,records:n}){const{timeAxisColumn:i,columns:s}=this;"dataset"!==e&&"batch"!==e||s.includes(i)?r===i&&"width"in t&&this.updateCanvasSize():s.add(i,!0),super.onColumnsChanged(...arguments)}get timeView(){var e,t;const r=this;return r.columns&&r.isVertical?null==(e=r.verticalTimeAxisColumn)?void 0:e.view:null==(t=r.timeAxisColumn)?void 0:t.timeAxisView}updateEventCls(e){const t=this;t.eventSelector||(t.unreleasedEventSelector=t.eventSelector="."+e+"-wrap"),t.eventInnerSelector||(t.eventInnerSelector="."+e)}set timeAxisViewModel(e){const t=this,r=t._timeAxisViewModel,n={name:"timeAxisViewModel",update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||r&&r===e||((null==r?void 0:r.owner)===t&&r.destroy(),t.detachListeners("timeAxisViewModel"),(null==e?void 0:e.isTimeAxisViewModel)?e.ion(n):e=TimeAxisViewModel.new({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,suppressFit:t.suppressFit,internalListeners:n,owner:t},e),t.isConfiguring||(t.isHorizontal?t.timeAxisColumn.timeAxisViewModel=e:t.verticalTimeAxisColumn.view.model=e),t._timeAxisViewModel=e,t.relayEvents(e,["update"],"timeAxisViewModel"),r&&e&&t.trigger("timeAxisViewModelChange",{timeAxisViewModel:e}))}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}get suppressFit(){var e,t;return null!=(t=null==(e=this._timeAxisViewModel)?void 0:e.suppressFit)?t:this._suppressFit}set suppressFit(e){this._timeAxisViewModel?this.timeAxisViewModel.suppressFit=e:this._suppressFit=e}set timeAxis(e){const t=this,r=t._timeAxis,n={name:"timeAxis",reconfigure:"onTimeAxisReconfigure",thisObj:t};t.partner&&!e||r&&r===e||(r&&r.owner===t&&r.destroy(),t.detachListeners("timeAxis"),(null==e?void 0:e.isTimeAxis)||(e=ObjectHelper.assign({owner:t,viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,weekStartDay:t.weekStartDay,forceFullTicks:t.fillTicks&&t.snap},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new TimeAxis(e)),e.ion(n),t._timeAxis=e)}onTimeAxisReconfigure({config:e,oldConfig:t}){if(e){(!t||t.startDate-e.startDate||t.endDate-e.endDate)&&this.trigger("dateRangeChange",{old:{startDate:t.startDate,endDate:t.endDate},new:{startDate:e.startDate,endDate:e.endDate}})}this.trigger("timeAxisChange",{config:e})}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}updateForceFit(e){this._timeAxisViewModel&&(this._timeAxisViewModel.forceFit=e)}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){var t;const r=this,n=r._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;r.isPainted&&(r.timeAxisColumn.refreshHeader(),null==(t=r.features.columnLines)||t.refresh(),r.refreshWithTransition())}updateStartDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const r=this,n=r._timeAxis,{startDate:i,endDate:s,mainUnit:a}=n||emptyObject11;if("string"==typeof e&&(e=DateHelper.parse(e)),n&&s){if(e){let n=s;if(t&&i){const t=DateHelper.diff(i,s,a,!0);n=DateHelper.add(e,t,a)}r.setTimeSpan(e,n)}}else r._tempStartDate=e}get startDate(){const e=this;return e._timeAxis?e._timeAxis.startDate:e._tempStartDate||new Date}changeEndDate(e){"string"==typeof e&&(e=DateHelper.parse(e)),this.setEndDate(e)}setEndDate(e,t=!1){const r=this,n=r._timeAxis,{startDate:i,endDate:s,mainUnit:a}=n||emptyObject11;if("string"==typeof e&&(e=DateHelper.parse(e)),n&&i){if(e){let n=i;if(t&&s){const t=DateHelper.diff(i,s,a,!0);n=DateHelper.add(e,-t,a)}r.setTimeSpan(n,e)}}else r._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||DateHelper.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}changeVisibleDate(e){return e instanceof Date?{date:e,block:"nearest"}:e instanceof Object?{date:e.date,...e}:void 0}updateVisibleDate(e){const t=this;t.infiniteScroll&&t.isConfiguring||(t.isPainted?t.scrollToDate(e.date,e):t.ion({paint:()=>t.scrollToDate(e.date,e),once:!0}))}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.refreshWithTransition(),this.trigger("stateChange")}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.refreshWithTransition(),this.trigger("stateChange")}onLocaleChange(){super.onLocaleChange();const e=this.timeAxis.autoAdjust;this.timeAxis.reconfigure({autoAdjust:!1}),this.timeAxis.autoAdjust=e}onBodyResize(e,t,{width:r,height:n}){this.isVertical&&t&&r!==t.width&&delete this.timeAxisSubGrid._width;const i=this.timeAxisSubGrid.element.offsetWidth;this._bodyRectangle&&t&&n!==t.height&&this.onSchedulerViewportResize(i,n,i,t.height)}onSchedulerViewportResize(e,t,r,n){if(this.isPainted){const i=this,{isHorizontal:s,partneredWith:a}=i;i.currentOrientation.onViewportResize(e,t,r,n),i.updateViewModelAvailableSpace(s?e:Math.floor(t)),a&&!i.isSyncingFromPartner&&i.syncPartnerSubGrids(),i.trigger("timelineViewportResize",{width:e,height:t,oldWidth:r,oldHeight:n})}}updateViewModelAvailableSpace(e){this.timeAxisViewModel.availableSpace=e}onTimeAxisViewModelUpdate(){this._viewPresetChanging||this.timeAxisSubGrid.collapsed||(this.updateCanvasSize(),this.currentOrientation.onTimeAxisViewModelUpdate())}syncPartnerSubGrids(){this.partneredWith.forEach((e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,this.eachSubGrid((t=>{const r=e.subGrids[t.region];r.width!==t.width&&(t.collapsed?r.collapse():(r.collapsed&&r.expand(),t.flex?t.flex!==r.flex&&(r.flex=t.flex):r.width=t.width))})),e.isSyncingFromPartner=!1)}))}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("id",IdHelper.generateId("svg")),t.retainElement=!0,e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated",{svg:t})}return e._svgCanvas}get timeAxisSubGridElement(){var e;return this._timeAxisSubGridElement||(this.getConfig("regions"),this._timeAxisSubGridElement=null==(e=this.timeAxisColumn)?void 0:e.subGridElement),this._timeAxisSubGridElement}updateCanvasSize(){const e=this,{totalSize:t}=e.timeAxisViewModel,r=e.isHorizontal?t:e.timeAxisColumn.width;let n=!1;return e.isVertical&&(e.isPainted&&e.refreshTotalHeight(t+e._rowBorderHeight,!0),e.suppressFit&&DomHelper.setLength(e.foregroundCanvas,"height",t),n=!0),r!==e.$canvasWidth&&e.foregroundCanvas&&(e.backgroundCanvas&&DomHelper.setLength(e.backgroundCanvas,"width",r),DomHelper.setLength(e.foregroundCanvas,"width",r),e.$canvasWidth=r,n=!0),n}getHeaderDomConfigs(e){}getForegroundDomConfigs(e){}async onStoreDataChange({action:e}){const t=this;t.isVisible?("dataset"===e&&t.project.isRepopulatingStores&&await t.project.await("refresh",!1),super.onStoreDataChange(...arguments)):t.whenVisible("refresh",t,[!0])}refresh(e=!0){const t=this;t.isPainted&&!t.refreshSuspended&&(t.hasVisibleEvents||t.timeAxisSubGridElement.querySelector(t.eventSelector)?t.isEngineReady?t.refreshRows(!1,e):(t.refreshAfterProjectRefresh=!0,t.currentOrientation.refreshAllWhenReady=!0):t.rowManager.trigger("refresh"))}render(){const e=this,t=e.timeAxisSubGridElement;e.useBackgroundCanvas&&(e._backgroundCanvas=DomHelper.createElement({className:"b-sch-background-canvas",parent:t,nextSibling:t.firstElementChild}));const r=e._foregroundCanvas=DomHelper.createElement({className:"b-sch-foreground-canvas",style:"font-size:"+(e.rowHeight-2*e.resourceMargin)+"px",parent:t});e.timeAxisSubGrid.insertRowsBefore=r,e.isVertical&&e.suppressFit&&e.updateCanvasSize(),super.render(...arguments)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}getCellDataFromEvent(e,t){return t&&(t=!Boolean(e.target.closest(".b-sch-foreground-canvas"))),super.getCellDataFromEvent(e,t)}onCellNavigate(e,t,r){var n,i;(null==(n=r.cell)?void 0:n.classList.contains("b-timeaxis-cell"))&&!(null==(i=GlobalEvents_default.currentMouseDown)?void 0:i.target.classList.contains("b-grid-cell"))&&(this.preventDragSelect=!0),super.onCellNavigate(...arguments)}runWithTransition(e,t){const r=this;r.isVisible&&(null!=t&&!0!==t||(t=r.transitionDuration),t&&r.enableEventAnimations&&(r.hasTimeout("exitTransition")||(r.isAnimating=!0),exitTransition.delay=t,r.setTimeout(exitTransition))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}async waitForAnimations(){this.isEngineReady||await this.project.await("dataReady",!1),await super.waitForAnimations()}refreshWithTransition(e,t){this.isPainted&&!this.refreshSuspended&&this.runWithTransition((()=>this.refresh(e)),t)}get visibleDateRange(){return this.currentOrientation.visibleDateRange}isRowNumberSelecting(...e){return super.isRowNumberSelecting(...e)||e.some((e=>{var t;return e.column?e.column.isTimeAxisColumn:null==(t=e.cell)?void 0:t.closest(".b-timeaxis-cell")}))}formatDuration(e,t=this.durationDisplayPrecision){const r=Math.pow(10,t);return Math.round(e*r)/r}beginListeningForBatchedUpdates(){this.listenToBatchedUpdates=(this.listenToBatchedUpdates||0)+1}endListeningForBatchedUpdates(){this.listenToBatchedUpdates&&(this.listenToBatchedUpdates-=1)}onConnectedCallback(e,t){e&&!t&&(this.timeAxisSubGrid.scrollable.x+=.5)}async updateRtl(e){let t;this.isConfiguring||(t=this.visibleDateRange),super.updateRtl(e),this.isConfiguring||(this.currentOrientation.clearAll(),this.timeAxisSubGrid.scrollable.x+=.5,this.infiniteScroll&&(await this.nextAnimationFrame(),this.scrollToDate(t.startDate,{block:"start"})))}applyStartEndParameters(e){const t=this,r=t.eventStore.modelClass.fieldMap.startDate;t.passStartEndParameters&&(e[t.startParamName]=r.print(t.startDate),e[t.endParamName]=r.print(t.endDate))}};__publicField(TimelineBase,"configurable",{partnerSharedConfigs:{value:["timeAxisViewModel","timeAxis","viewPreset"],$config:{merge:"distinct"}},startDate:{$config:{equal:"date"},value:null},endDate:{$config:{equal:"date"},value:null},stickyHeaders:!0,visibleDate:null,eventCls:null,forceFit:!1,timeZone:null}),TimelineBase.initClass(),VersionHelper.setVersion("scheduler","5.3.4"),TimelineBase._$name="TimelineBase";var stores=["eventStore","taskStore","assignmentStore","resourceStore","dependencyStore","timeRangeStore","resourceTimeRangeStore"],inlineProperties=["events","tasks","resources","assignments","dependencies","timeRanges","resourceTimeRanges"],CurrentConfig_default=e=>class extends e{static get $name(){return"CurrentConfig"}preProcessCurrentConfigs(e){for(const t of inlineProperties)delete e[t];super.preProcessCurrentConfigs(e)}getCurrentConfig(e){const t=this.project.getCurrentConfig(e),r=super.getCurrentConfig(e);if(t){r.project=t;const{crudManager:e}=r;if(e)for(const r of stores)e[r]&&(t[r]=e[r]);0===Object.keys(t).length&&delete r.project}return delete r.data,delete r.crudManager,r}get widgetClass(){}},arrayify=e=>!e||Array.isArray(e)?e:[e],pickFormat=(e,t,r)=>e&&!0!==e[t]?e[t]:r,Describable_default=e=>{var t;return __publicField(t=class extends(e||Base){get dateBounds(){return[this.date]}get description(){const e=this,{descriptionRenderer:t}=e;return t?e.callback(t,e,[e]):e.formattedDescription}get formattedDescription(){var e;const t=this,{dateBounds:r,dateFormat:n}=t,i=null!=(e=t.descriptionFormat)?e:arrayify(t.defaultDescriptionFormat),s=pickFormat(i,0,n),a=r.length>1&&(null==i?void 0:i.length)>1&&DateHelper.format(r[0],s)!==DateHelper.format(r[1],s);let o=DateHelper.format(r[0],s);return a&&(o=DateHelper.formatRange(r,pickFormat(i,1,"S"+n+t.dateSeparator+"E"+n))),o}changeDescriptionFormat(e){return arrayify(e)}get widgetClass(){}},"$name","Describable"),__publicField(t,"configurable",{dateFormat:"MMMM d, YYYY",dateSeparator:" - ",descriptionFormat:null,descriptionRenderer:null}),t},SchedulerDom_default=e=>class extends(e||Base){static get $name(){return"SchedulerDom"}getElementFromAssignmentRecord(e,t=!1){var r,n,i;if(this.isPainted&&e){let s=null==(r=this.foregroundCanvas.syncIdMap)?void 0:r[e.id];if(!s&&e.resource.hasLinks)for(const t of e.resource.$links)if(s=null==(n=this.foregroundCanvas.syncIdMap)?void 0:n[e.id+"_"+t.id],s)break;return t?s:null==(i=null==s?void 0:s.syncIdMap)?void 0:i.event}return null}getElementFromEventRecord(e,t=(t=>null==(t=e.resources)?void 0:t[0])(),r=!1){var n;if(e.isResourceTimeRange){const t=null==(n=this.foregroundCanvas.syncIdMap)?void 0:n[e.domId];return r?t:null==t?void 0:t.syncIdMap.event}const i=this.assignmentStore.getAssignmentForEventAndResource(e,t);return this.getElementFromAssignmentRecord(i,r)}getElementsFromEventRecord(e,t,r=!1){return t?[this.getElementFromEventRecord(e,t,r)]:e.resources.reduce(((t,n)=>{const i=this.getElementFromEventRecord(e,n,r);return i&&t.push(i),t}),[])}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveRowRecord(e){return this.resolveResourceRecord(e)}resolveEventRecord(e){e instanceof Event&&(e=e.target);const t=null==e?void 0:e.closest(this.eventSelector);if(t){if(t.dataset.eventId)return this.eventStore.getById(t.dataset.eventId);if(t.dataset.assignmentId)return this.assignmentStore.getById(t.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const t=e.closest(this.eventSelector),r=t&&this.assignmentStore.getById(t.dataset.assignmentId),n=t&&this.eventStore.getById(t.dataset.eventId);return this.assignmentStore.getOccurrence(r,n)}isRowVisible(e){return this.store.indexOf(e)>=0}get widgetClass(){}},SchedulerDomEvents_default=e=>class extends(e||Base){static get $name(){return"SchedulerDomEvents"}getTimeSpanMouseEventParams(e,t){const r=this.resolveEventRecord(e);return r&&{eventRecord:r,resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){const t=super.onElementKeyDown(e),r=this;return r.selectedEvents.length&&r.trigger(r.scheduledEventName+"KeyDown",{eventRecords:r.selectedEvents,assignmentRecords:r.selectedAssignments,event:e,eventRecord:r.selectedEvents,assignmentRecord:r.selectedAssignments}),t}onElementKeyUp(e){super.onElementKeyUp(e);const t=this;t.selectedEvents.length&&t.trigger(t.scheduledEventName+"KeyUp",{eventRecords:t.selectedEvents,assignmentRecords:t.selectedAssignments,event:e,eventRecord:t.selectedEvents,assignmentRecord:t.selectedAssignments})}get widgetClass(){}},SchedulerEventRendering_default=e=>class extends(e||Base){static get $name(){return"SchedulerEventRendering"}static get configurable(){return{milestoneTextPosition:"outside",milestoneAlign:"center",milestoneCharWidth:10,milestoneLayoutMode:"default",eventLayout:"stack",overlappingEventSorter:null,horizontalEventSorterFn:null,resourceMargin:null,useInitialAnimation:!0,eventRenderer:null,eventRendererThisObj:null,eventBarTextField:"name",eventBodyTemplate:null,horizontalLayoutPackClass:HorizontalLayoutPack,horizontalLayoutStackClass:HorizontalLayoutStack,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:null,resourceImageExtension:".jpg",isFirstRender:!0,initialAnimationDuration:2e3,narrowEventWidth:10,internalEventLayout:null,eventPositionMode:"translate",eventScrollMode:"move"}}changeEventLayout(e){return this.internalEventLayout=e,this.internalEventLayout.type}changeInternalEventLayout(e){return this.getEventLayout(e)}updateInternalEventLayout(e,t){const r=this;t&&r.element.classList.remove("b-eventlayout-"+t.type),r.element.classList.add("b-eventlayout-"+e.type),r.isConfiguring||(r.refreshWithTransition(),r.trigger("stateChange"))}changeHorizontalEventSorterFn(e){VersionHelper.deprecate("Scheduler","6.0.0","Replaced by overlappingEventSorter()"),this.overlappingEventSorter=e}updateOverlappingEventSorter(e){this.isConfiguring||this.refreshWithTransition()}getEventLayout(e){return(null==e?void 0:e.isModel)&&(e=e.eventLayout||this.internalEventLayout),"string"==typeof e&&(e={type:e}),e}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:r,horizontal:n}=t,{type:i}=e;switch(t.layouts||(t.layouts={}),i){case"stack":return t.layouts.horizontalStack||(t.layouts.horizontalStack=new t.horizontalLayoutStackClass(ObjectHelper.assign({scheduler:t,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:n},e))),t.layouts.horizontalStack;case"pack":return t.layouts.horizontalPack||(t.layouts.horizontalPack=new t.horizontalLayoutPackClass(ObjectHelper.assign({scheduler:t,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:n},e))),t.layouts.horizontalPack;default:return null}}get resourceColumns(){var e;return(null==(e=this.timeAxisColumn)?void 0:e.resourceColumns)||this._resourceColumns}get resourceColumnWidth(){var e;return(null==(e=this.resourceColumns)?void 0:e.columnWidth)||null}getEventsToRender(e,t){return t}repaintEventsForResource(e){this.currentOrientation.repaintEventsForResource(e)}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach((e=>this.repaintEventsForResource(e)))}getResourceMargin(e){var t;return null!=(t=null==e?void 0:e.resourceMargin)?t:this.resourceMargin}getBarMargin(e){var t;return null!=(t=null==e?void 0:e.barMargin)?t:this.barMargin}getResourceHeight(e){var t;return null!=(t=e.rowHeight)?t:this.isHorizontal?this.rowHeight:this.getResourceWidth(e)}getResourceWidth(e){var t;return null!=(t=e.columnWidth)?t:this.resourceColumnWidth}getAppliedResourceHeight(e){var t;const r=this.getRowById(e);return null!=(t=null==r?void 0:r.maxRequestedHeight)?t:this.getResourceHeight(e)}getResourceLayoutSettings(e,t=null){const r=this.getResourceMargin(e,t),n=this.getAppliedResourceHeight(e,t);return{barMargin:this.getBarMargin(e,t),contentHeight:Math.max(n-2*r,1),rowHeight:n,resourceMargin:r}}getEventStyle(e,t){return e.eventStyle||t.eventStyle||this.eventStyle}getEventColor(e,t){var r,n;return e.eventColor||(null==(r=e.event)?void 0:r.eventColor)||(null==(n=e.parent)?void 0:n.eventColor)||t.eventColor||this.eventColor}generateRenderData(e,t,r={viewport:!0}){var n,i;const s=this,a=s.currentOrientation.getTimeSpanRenderData(e,t,r),{isEvent:o}=e,{eventResize:l}=s.features,c=!e.meta.isDragCreating&&e.isMilestone,d=o&&e.assignments.find((e=>e.resourceId===t.$originalId)),u={className:"b-sch-event-content",role:"presentation",dataset:{taskBarFeature:"content"}};if(a){a.tabIndex="0";let r=e.isResizable;l&&r&&(a.startsOutsideView&&(!0===r?r="end":"start"===r&&(r=!1)),a.endsOutsideView&&(!0===r?r="start":"end"===r&&(r=!1)),r&&(s.isHorizontal?!s.rtl&&!l.leftHandle||s.rtl&&!l.rightHandle?r="start"!==r&&"end":(!s.rtl&&!l.rightHandle||s.rtl&&!l.leftHandle)&&(r="end"!==r&&"start"):l.topHandle?l.bottomHandle||(r="end"!==r&&"start"):r="start"!==r&&"end"));const h=Boolean(e.hasPersistableChanges||(null==d?void 0:d.hasPersistableChanges)),g={[t.cls]:t.cls,[s.generatedIdCls]:!e.isOccurrence&&e.hasGeneratedId,[s.dirtyCls]:h,[s.committingCls]:e.isCommitting,[s.endsOutsideViewCls]:a.endsOutsideView,[s.startsOutsideViewCls]:a.startsOutsideView,"b-clipped-start":a.clippedStart,"b-clipped-end":a.clippedEnd,"b-iscreating":e.isCreating,"b-rtl":s.rtl},p={[s.eventCls+"-parent"]:t.isParent,"b-readonly":e.readOnly||(null==d?void 0:d.readOnly),"b-linked-resource":t.isLinked,"b-original-resource":t.hasLinks},m=e.isResourceTimeRange?new DomClassList:e.internalCls.clone(),f=e.isResourceTimeRange?e.internalCls.clone():new DomClassList;if(a.wrapperStyle="",a.isWrap=!0,o){const n=d&&s.isAssignmentSelected(d);ObjectHelper.assign(g,{[s.eventCls]:1,"b-milestone":c,"b-sch-event-narrow":!c&&a.width<s.narrowEventWidth,[s.fixedEventCls]:!1===e.isDraggable,["b-sch-event-resizable-"+r]:Boolean(l&&!e.readOnly),[s.eventSelectedCls]:n,[s.eventAssignHighlightCls]:s.eventAssignHighlightCls&&!n&&s.isEventSelected(e),"b-recurring":e.isRecurring,"b-occurrence":e.isOccurrence,"b-inactive":e.inactive}),a.eventId=e.id;const i=s.getEventStyle(e,t),o=s.getEventColor(e,t),u=s.isFirstRender&&s.useInitialAnimation&&!0!==globalThis.gantt.noAnimations;if(ObjectHelper.assign(p,{[s.eventCls+"-wrap"]:1,"b-milestone-wrap":c}),u){const e=(a.row?a.row.index:(a.top-s.scrollTop)/s.tickSize)/20*1e3;a.wrapperStyle="animation-delay: "+e+"ms;",s.maxDelay=Math.max(s.maxDelay||0,e),s.initialAnimationDetacher||(s.initialAnimationDetacher=EventHelper.on({element:s.foregroundCanvas,delegate:s.eventSelector,once:!0,animationend:()=>s.setTimeout({fn:"stopInitialAnimation",delay:s.maxDelay,cancelOutstanding:!0}),expires:{alt:"stopInitialAnimation",delay:s.initialAnimationDuration+s.maxDelay},thisObj:s}))}a.eventColor=o,a.eventStyle=i,a.assignmentRecord=a.assignment=d}if(a.wrapperCls=ObjectHelper.assign(f,p),a.cls=ObjectHelper.assign(m,g),a.iconCls=new DomClassList(e.get(s.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(a.style="",a.wrapperStyle+=e.style||""):a.style=e.style||"",a.resource=a.resourceRecord=t,a.resourceId=a.rowId,o){let r,i=null,o=null;if(s.eventRenderer){const n=s.eventRenderer.call(s.eventRendererThisObj||s,{eventRecord:e,resourceRecord:t,assignmentRecord:a.assignmentRecord,renderData:a});"string"==typeof a.cls&&(a.cls=new DomClassList(a.cls)),"string"==typeof a.wrapperCls&&(a.wrapperCls=new DomClassList(a.wrapperCls)),"string"==typeof a.iconCls&&(a.iconCls=new DomClassList(a.iconCls)),r=s.eventBodyTemplate?s.eventBodyTemplate(n):n}else s.eventBodyTemplate?r=s.eventBodyTemplate(e):s.eventBarTextField&&(r=StringHelper.encodeHtml(e[s.eventBarTextField]||""));!s.eventBodyTemplate||Array.isArray(r)?(u.children=[],!c||"default"!==s.milestoneLayoutMode&&"always-outside"!==s.milestoneTextPosition||null==r||""===r||u.children.unshift(o={tag:"label",children:[]}),(null==(n=a.iconCls)?void 0:n.length)&&u.children.unshift({tag:"i",className:a.iconCls}),Array.isArray(r)?(o||u).children.push(...r):StringHelper.isHtml(r)?u.children.length?i={tag:"span",class:"b-event-text-wrap",html:r}:(u.children=null,u.html=r):"string"==typeof r||"object"==typeof r?i=r:null!=r&&(i=String(r)),null!=i&&((o||u).children.push(i),a.cls.add("b-has-content")),(null!=u.html||u.children.length)&&a.children.push(u)):(u.html=r,a.children.push(u))}const{eventStyle:v,eventColor:y}=a;if(a.wrapperCls["b-sch-style-"+(v||"none")]=1,DomHelper.isNamedColor(y))a.wrapperCls["b-sch-color-"+y]=y;else if(y){const e=v?"color":"background-color";a.style=e+":"+y+";"+a.style,a.wrapperCls["b-sch-custom-color"]=1}else a.wrapperCls["b-sch-color-none"]=1;a.style&&c&&u&&(u.style=a.style,delete a.style),a.cls["b-sch-event-withicon"]=null==(i=a.iconCls)?void 0:i.length,a.eventContent=u,a.wrapperChildren=[],s.onEventDataGenerated(a)}return a}onEventDataGenerated(e){}changeUseInitialAnimation(e){return!0===e?"fade-in":e}updateUseInitialAnimation(e,t){const{classList:r}=this.element;t&&r.remove("b-initial-"+t),e&&(r.add("b-initial-"+e),BrowserHelper.isFirefox&&r.add("b-prevent-event-transitions"))}restartInitialAnimation(e){var t;const r=this;null==(t=r.initialAnimationDetacher)||t.call(r),r.initialAnimationDetacher=null,r.useInitialAnimation=e,r.isFirstRender=!0,r.refresh()}stopInitialAnimation(){const e=this;e.initialAnimationDetacher(),e.isFirstRender=!1,e.useInitialAnimation=!1,BrowserHelper.isFirefox&&e.setTimeout((()=>e.element.classList.remove("b-prevent-event-transitions")),100)}getMilestoneLabelWidth(e,t){const r=this,n=r.milestoneLayoutMode,i=r.getResourceLayoutSettings(t).contentHeight;if("measure"===n){const n=StringHelper.encodeHtml(e.name),s=r.getEventColor(e,t),a=r.getEventStyle(e,t),o=r.milestoneMeasureElement||(r.milestoneMeasureElement=DomHelper.createElement({className:{"b-sch-event-wrap":1,"b-milestone-wrap":1,"b-measure":1,["b-sch-color-"+s]:s,["b-sch-style-"+a]:a},children:[{className:"b-sch-event b-milestone",children:[{className:"b-sch-event-content",children:[{tag:"label"}]}]}],parent:r.foregroundCanvas}));if(o.retainElement=!0,o.style.fontSize=i+"px","always-outside"===r.milestoneTextPosition){const e=o.firstElementChild.firstElementChild.firstElementChild;e.innerHTML=n;const t=Rectangle.from(e,e.parentElement);return t.left+t.width+2}return o.firstElementChild.firstElementChild.innerHTML="<label></label>"+n,o.firstElementChild.offsetWidth}return"estimate"===n?e.name.length*r.milestoneCharWidth+("always-outside"===r.milestoneTextPosition?i:0):"data"===n?e.milestoneWidth:0}updateMilestoneLayoutMode(e){const t=this,r="always-outside"===t.milestoneTextPosition;t.element.classList.toggle("b-sch-layout-milestones","default"!==e&&!r),t.element.classList.toggle("b-sch-layout-milestone-labels","default"!==e&&r),t.isConfiguring||t.refreshWithTransition()}updateMilestoneTextPosition(e){this.element.classList.toggle("b-sch-layout-milestone-text-position-inside","inside"===e),this.updateMilestoneLayoutMode(this.milestoneLayoutMode)}updateMilestoneAlign(){this.isConfiguring||this.refreshWithTransition()}updateMilestoneCharWidth(){this.isConfiguring||this.refreshWithTransition()}get widgetClass(){}},SchedulerStores_default=e=>class extends(ProjectConsumer_default(e||Base)){static get $name(){return"SchedulerStores"}static get projectStores(){return{resourceStore:{dataName:"resources"},eventStore:{dataName:"events",listeners:{batchedUpdate:"onEventStoreBatchedUpdate",changePreCommit:"onInternalEventStoreChange",commitStart:"onEventCommitStart",commit:"onEventCommit",exception:"onEventException",idchange:"onEventIdChange",beforeLoad:"onBeforeLoad"}},assignmentStore:{dataName:"assignments",listeners:{changePreCommit:"onAssignmentChange",commitStart:"onAssignmentCommitStart",commit:"onAssignmentCommit",exception:"onAssignmentException",beforeRemove:{fn:"onAssignmentBeforeRemove",prio:-1e3}}},dependencyStore:{dataName:"dependencies"},calendarManagerStore:{},timeRangeStore:{},resourceTimeRangeStore:{}}}static get configurable(){return{store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:VersionHelper.checkVersion("core","6.0",">="),crudManagerClass:null,crudManager:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("schedulerStores"),e.ion({name:"schedulerStores",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh({isInitialCommit:e}){const t=this;t.isVisible?(e&&t.isVertical&&(t.refreshAfterProjectRefresh=!1,t.refreshWithTransition()),t.navigateToAfterRefresh&&(t.navigateTo(t.navigateToAfterRefresh),t.navigateToAfterRefresh=null),t.refreshAfterProjectRefresh&&(t.refreshWithTransition(!1,!e),t.refreshAfterProjectRefresh=!1)):t.whenVisible("refresh",t,[!0])}changeCrudManager(e){const t=this;e&&!e.isCrudManager&&(e=t.crudManagerClass.new({scheduler:t},e)),t._crudManager=e,t.bindCrudManager(e)}get store(){return!this._store&&this.isVertical&&(this._store=new Store({data:[{id:"verticalTimeAxisRow",cls:"b-verticaltimeaxis-row"}]})),super.store}set store(e){super.store=e}refreshFromRowOnStoreAdd(e,{isExpand:t,records:r}){const n=arguments;this.runWithTransition((()=>{this.currentOrientation.suspended=!t&&!r.some((e=>e.isLinked)),super.refreshFromRowOnStoreAdd(e,...n),this.currentOrientation.suspended=!1}),!t)}onStoreAdd(e){super.onStoreAdd(e),this.isPainted&&this.calculateRowHeights(e.records)}onStoreUpdateRecord({source:e,record:t,changes:r}){let n=0;"assigned"in r&&n++,"calendar"in r&&n++,n!==Object.keys(r).length&&super.onStoreUpdateRecord(...arguments)}updateResourceStore(e){e&&this.isHorizontal&&(e.metaMapId=this.id,this.store=e)}get usesDisplayStore(){return this.store!==this.resourceStore}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onEventStoreBatchedUpdate(e){if(this.listenToBatchedUpdates)return this.onInternalEventStoreChange(e)}onInternalEventStoreChange(e){this.isPainted&&this._mode&&!e.isAssign&&!this.assignmentStore.isRemovingAssignment&&(this.isVisible?this.currentOrientation.onEventStoreChange(e):this.whenVisible(this.onInternalEventStoreChange,this,[e]))}onEventCommit({changes:e}){let t=[...e.added,...e.modified].map((e=>this.eventStore.getResourcesForEvent(e)));t=Array.prototype.concat.apply([],t),new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onEventCommitStart({changes:e}){const{currentOrientation:t,committingCls:r}=this;[...e.added,...e.modified].forEach((e=>e.assignments.forEach((e=>t.toggleCls(e,r,!0)))))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach((e=>this.repaintEvent(e)))}}onAssignmentCommit({changes:e}){this.repaintEventsForAssignmentChanges(e)}onAssignmentCommitStart({changes:e}){const{currentOrientation:t,committingCls:r}=this;[...e.added,...e.modified].forEach((e=>{t.toggleCls(e,r,!0)}))}onAssignmentException({action:e}){"commit"===e&&this.repaintEventsForAssignmentChanges(this.assignmentStore.changes)}repaintEventsForAssignmentChanges(e){const t=[...e.added,...e.modified,...e.removed].map((e=>e.getResource()));new Set(t).forEach((e=>this.repaintEventsForResource(e)))}onAssignmentBeforeRemove({records:e,removingAll:t}){if(t)return;const r=this;let n;if(!r.isConfiguring&&(r.navigateToAfterRefresh||r.activeAssignment&&e.includes(r.activeAssignment))){if(e.includes(r.navigateToAfterRefresh)&&(r.navigateToAfterRefresh=null),"key"===GlobalEvents_default.lastInteractionType)for(let t=0,i=e.length;t<i&&!n;t++){const i=e[t];if(i.resource&&i.resource.isModel){let t=r.getNext(i);t&&!e.includes(t)||(t=r.getPrevious(i)),t&&!e.includes(t)&&(n=t)}}n?(r.navigateTo(n),r.navigateToAfterRefresh=n):DomHelper.focusWithoutScrolling(r.focusElement)}}set timeRanges(e){this.project.timeRanges=e}get timeRanges(){return this.project.timeRanges}set resourceTimeRanges(e){this.project.resourceTimeRanges=e}get resourceTimeRanges(){return this.project.resourceTimeRanges}onBeforeLoad({params:e}){this.applyStartEndParameters(e)}getResourcesEventsPerTick(e,t){const{timeAxis:r,resourceStore:n}=this,i=[];return(e=e||n.records).forEach((e=>{e.events.forEach((n=>{if(!r.isTimeSpanInAxis(n)||t&&!t.call(this,{resource:e,event:n}))return;let s=Math.floor(r.getTickFromDate(n.startDate)),a=Math.ceil(r.getTickFromDate(n.endDate));-1==s&&(s=0),-1===a&&(a=r.ticks.length);do{i[s]?i[s].push(n):i[s]=[n]}while(++s<a)}))})),i}get widgetClass(){}},defaultScrollOptions5={block:"nearest",edgeOffset:20},unrenderedScrollOptions={highlight:!1,focus:!1},SchedulerScroll_default=e=>class extends(e||Base){static get $name(){return"SchedulerScroll"}async scrollEventIntoView(e,t=defaultScrollOptions5){const r=e.resources||[e];if(r.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");r.length||console.warn("You have asked to scroll to an event which is not assigned to a resource"),await this.scrollResourceEventIntoView(r[0],e,t)}scrollAssignmentIntoView(e,...t){return this.scrollResourceEventIntoView(e.resource,e.event,...t)}async scrollResourceEventIntoView(e,t,r=defaultScrollOptions5){var n;const i=this,s=t.startDate,a=t.endDate,o=t.isScheduled&&s<i.timeAxis.startDate|(a>i.timeAxis.endDate)<<1;let l;if(arguments.length>3&&(r=arguments[3]),null==r.edgeOffset&&(r.edgeOffset=20),o&&!1!==r.extendTimeAxis){const e=i.timeAxis.endDate-i.timeAxis.startDate;3===o?i.setTimeSpan(new Date(s.valueOf()-e/2),new Date(a.getTime()+e/2)):1&o?i.setTimeSpan(new Date(s),new Date(s.valueOf()+e)):i.setTimeSpan(new Date(a.valueOf()-e),new Date(a))}if(i.store.tree&&await(null==(n=i.expandTo)?void 0:n.call(i,e)),t.parent&&!t.parent.isRoot&&await this.scrollEventIntoView(t.parent),l=i.getElementFromEventRecord(t,e),l){DomHelper.isFocusable(l)||(l=l.parentNode);const e=i.timeAxisSubGrid.scrollable;i.timeAxisSubGrid.forceScrollUpdate=!0,await e.scrollIntoView(l,r)}else 3===o&&!1===r.extendTimeAxis?console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"):t.isOccurrence||i.eventStore.isAvailable(t)?t.isScheduled?await i.scrollUnrenderedEventIntoView(e,t,r):await i.scrollResourceIntoView(e,r):console.warn("You have asked to scroll to an event which is not available")}scrollUnrenderedEventIntoView(e,t,r=defaultScrollOptions5){return new Promise((n=>{const i=this,s=Object.assign({edgeOffset:20},r,unrenderedScrollOptions),a=i.timeAxisSubGrid.scrollable,o=i.getResourceEventBox(t,e),l=a.viewport;if(!l||!o)return void n();o.x=Math.ceil(o.x),o.y=Math.ceil(o.y),i.rtl&&o.translate(-i.timeAxisViewModel.totalSize+l.width,0),o.translate(l.x-a.scrollLeft,l.y-a.y);const c=i.ion({renderEvent:async({eventRecord:e,element:i,targetElement:s})=>{if(e===t){const e=i||s;c(),await d,r.highlight&&DomHelper.highlight(e),r.focus&&e.focus(),n()}}}),d=a.scrollIntoView(o,s)}))}scrollResourceIntoView(e,t=defaultScrollOptions5){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}},SchedulerRegions_default=e=>class extends(e||Base){static get $name(){return"SchedulerRegions"}getScheduleRegion(e,t,r=!0,n){return this.currentOrientation.getScheduleRegion(...arguments)}getResourceRegion(e,t,r){return this.currentOrientation.getRowRegion(...arguments)}getAssignmentEventBox(e,t){return this.getResourceEventBox(e.event,e.resource,t)}getResourceEventBox(e,t,r=!1,n=!1){return this.currentOrientation.getResourceEventBox(...arguments)}getItemBox(e,t=!1){return e.resources.map((r=>this.getResourceEventBox(e,r,t)))}get widgetClass(){}},copyProperties2=["eventLayout","mode","eventColor","eventStyle","tickSize","fillTicks"],SchedulerState_default=e=>class extends(e||Base){static get $name(){return"SchedulerState"}getState(){return ObjectHelper.copyProperties(super.getState(),this,copyProperties2)}applyState(e){var t;this.suspendRefresh();let r=copyProperties2.slice();"layoutFn"===(null==e?void 0:e.eventLayout)&&(delete e.eventLayout,r.splice(r.indexOf("eventLayout"),1)),(null==(t=null==e?void 0:e.zoomLevelOptions)?void 0:t.width)&&(r=r.filter((e=>"tickSize"!==e))),ObjectHelper.copyProperties(this,e,r),super.applyState(e),this.resumeRefresh(!0)}get widgetClass(){}},EventSelection_default=e=>class extends(e||Base){static get $name(){return"EventSelection"}static get configurable(){return{highlightPredecessors:!1,highlightSuccessors:!1,deselectOnClick:!1}}static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){var e;super.afterConstruct(),null==(e=this.navigator)||e.ion({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof Collection||(e=new Collection(e)),this._selectedCollection=e,e.ion({change:(...e)=>this.project.deferUntilRepopulationIfNeeded("onSelectedCollectionChange",((...e)=>!this.isDestroying&&this.onSelectedCollectionChange(...e)),e),beforeSplice:"onBeforeSelectedCollectionSplice",thisObj:this})}get selectedCollection(){return this._selectedCollection}getActionType(e,t,r){return e.length>0?t.length>0&&r.length>0?"update":t.length>0?"select":"deselect":"clear"}getEventsFromAssignments(e){return ArrayHelper.unique(e.map((e=>e.event)))}get selectedEvents(){return this.getEventsFromAssignments(this.selectedCollection.values)}set selectedEvents(e){const t=[];null==(e=ArrayHelper.asArray(e))||e.forEach((e=>{!1!==this.isEventSelectable(e)&&(e.isOccurrence?e.assignments.forEach((r=>{t.push(this.assignmentStore.getOccurrence(r,e))})):t.push(...e.assignments))})),this.selectedCollection.splice(0,this.selectedCollection.count,t)}get selectedAssignments(){return this.selectedCollection.values}set selectedAssignments(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){const{selectedCollection:t}=this;return Boolean(t.count&&t.includes(e.assignments))}isEventSelectable(e){}isAssignmentSelected(e){return this.selectedCollection.includes(e)}select(e,t=!1){e.isAssignment?this.selectAssignment(e,t):this.selectEvent(e,t)}selectEvent(e,t=!1){this.isEventSelected(e)||this.selectEvents([e],t)}selectAssignment(e,t=!1,r){this.isAssignmentSelected(e)||(t?this.selectedCollection.add(e):this.selectedAssignments=e)}deselect(e){e.isAssignment?this.deselectAssignment(e):this.deselectEvent(e)}deselectEvent(e){this.isEventSelected(e)&&this.selectedCollection.remove(...e.assignments)}deselectAssignment(e){this.isAssignmentSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e,t=!1){if(t){const t=e.reduce(((e,t)=>(!1!==this.isEventSelectable(t)&&e.push(...t.assignments),e)),[]);this.selectedCollection.add(t)}else this.selectedEvents=e}deselectEvents(e){this.selectedCollection.remove(e.reduce(((e,t)=>(e.push(...t.assignments),e)),[]))}selectAssignments(e){this.selectedCollection.add(e)}deselectAssignments(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedAssignments=[]}onBeforeSelectedCollectionSplice({toAdd:e,toRemove:t,index:r}){const n=this,i=n._selectedCollection.values,s=e,a=t>0?s.slice(r,t+r):[],o=n.getActionType(i,s,a);return!1!==n.trigger("beforeEventSelectionChange",{action:o,selection:n.getEventsFromAssignments(i)||[],selected:n.getEventsFromAssignments(s)||[],deselected:n.getEventsFromAssignments(a)||[]})&&(!1!==n.trigger("beforeAssignmentSelectionChange",{action:o,selection:i,selected:s,deselected:a})&&void 0)}onSelectedCollectionChange({added:e,removed:t}){const r=this,n=r.selectedAssignments,i=e||[],s=t||[];function a(e,t){const n=e.event;if(n){const{eventAssignHighlightCls:i}=r,s=r.getElementFromAssignmentRecord(e);r.currentOrientation.toggleCls(e,r.eventSelectedCls,t),i&&r.getElementsFromEventRecord(n).forEach((e=>{if(e!==s){const n=r.resolveAssignmentRecord(e);r.currentOrientation.toggleCls(n,i,t),t&&(e.style.animation="none",e.offsetHeight,e.style.animation=""),e.classList.toggle(i,t)}}))}}if(s.forEach((e=>a(e,!1))),i.forEach((e=>a(e,!0))),(r.highlightSuccessors||r.highlightPredecessors)&&r.highlightLinkedEvents(r.selectedEvents),r.$selectedAssignments=n.map((e=>({eventId:e.eventId,resourceId:e.resourceId}))),!r.silent){const e=this.getActionType(n,i,s);r.trigger("assignmentSelectionChange",{action:e,selection:n,selected:i,deselected:s}),r.trigger("eventSelectionChange",{action:e,selection:r.selectedEvents,selected:r.getEventsFromAssignments(i),deselected:r.getEventsFromAssignments(s)})}}onAssignmentChange(e){super.onAssignmentChange(e);const t=this,{action:r,records:n}=e;if(t.silent=!t.triggerSelectionChangeOnRemove,"remove"===r)t.deselectAssignments(n);else if("removeall"!==r||t.eventStore.isSettingData){if("dataset"===r&&t.$selectedAssignments)if(t.maintainSelectionOnDatasetChange){const e=t.$selectedAssignments.map((e=>n.find((t=>t.eventId===e.eventId&&t.resourceId===e.resourceId))));t.selectedAssignments=ArrayHelper.clean(e)}else t.clearEventSelection()}else t.clearEventSelection();t.silent=!1}onInternalEventStoreChange({source:e,action:t,records:r}){e.isResourceTimeRangeStore||"dataset"!==t||r.length||this.clearEventSelection(),super.onInternalEventStoreChange(...arguments)}onAssignmentSelectionClick(e,t){const r=this;r.isAssignmentSelected(t)?(r.deselectOnClick||e.ctrlKey)&&r.deselectAssignment(t,r.multiEventSelect,e):!1!==this.isEventSelectable(t.event)&&r.selectAssignment(t,e.ctrlKey&&r.multiEventSelect,e)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const r=t&&(t.nodeType===Element.ELEMENT_NODE?this.resolveAssignmentRecord(t):t);r?this.onAssignmentSelectionClick(e,r):this.clearEventSelection()}}changeHighlightSuccessors(e){return this.changeLinkedEvents(e)}changeHighlightPredecessors(e){return this.changeLinkedEvents(e)}changeLinkedEvents(e){const t=this;return e?(t.highlighted=t.highlighted||new Set,t.highlightLinkedEvents(t.selectedEvents)):t.highlighted&&t.highlightLinkedEvents(),e}highlightLinkedEvents(e=[]){const t=this,{highlighted:r,eventStore:n}=t,i=t.features.dependencies;r.forEach((t=>{e.includes(t)||(t.meta.highlight=!1,r.delete(t),n.includes(t)&&t.dependencies.forEach((e=>i.unhighlight(e,"b-highlight"))))})),e.forEach((e=>{const n=[e];for(;n.length;){const e=n.pop();r.add(e),t.highlightSuccessors&&e.outgoingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!r.has(e.toEvent)&&n.push(e.toEvent)})),t.highlightPredecessors&&e.incomingDeps.forEach((e=>{i.highlight(e,"b-highlight"),!r.has(e.fromEvent)&&n.push(e.fromEvent)}))}r.forEach((e=>e.meta.highlight=!0))})),t.element.classList.toggle("b-highlighting",e.length>0),t.refreshWithTransition()}onEventDataGenerated(e){(this.highlightSuccessors||this.highlightPredecessors)&&(e.cls["b-highlight"]=e.eventRecord.meta.highlight),super.onEventDataGenerated(e)}updateProject(e,t){this.clearEventSelection(),super.updateProject(e,t)}doDestroy(){var e;null==(e=this._selectedCollection)||e.destroy(),super.doDestroy()}get widgetClass(){}},preventDefault=e=>e.preventDefault(),isArrowKey={ArrowRight:1,ArrowLeft:1,ArrowUp:1,ArrowDown:1},animate100={animate:100},emptyObject12=Object.freeze({}),EventNavigation_default=e=>class extends(Delayable_default(e||Base)){static get $name(){return"EventNavigation"}static get configurable(){return{navigator:{allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:"onDeleteKey",Backspace:"onDeleteKey",ArrowUp:"onArrowUpKey",ArrowDown:"onArrowDownKey",Escape:"onEscapeKey",Tab:"onTab","SHIFT+Tab":"onShiftTab"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:1,ArrowRight:1}}}static get defaultConfig(){return{focusCls:"b-active",enableDeleteKey:!0,onDeleteKeyBuffer:500,navigatePreviousBuffer:200,navigateNextBuffer:200,testConfig:{onDeleteKeyBuffer:1}}}construct(e){const t=this;t.isInTimeAxis=t.isInTimeAxis.bind(t),t.onDeleteKey=t.throttle(t.onDeleteKey,t.onDeleteKeyBuffer,t),super.construct(e)}changeNavigator(e){const t=this;return t.getConfig("subGridConfigs"),new Navigator(t.constructor.mergeConfigs({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:"."+t.eventCls+"-wrap",focusCls:t.focusCls,navigatePrevious:t.throttle(t.navigatePrevious,{delay:t.navigatePreviousBuffer,throttled:preventDefault}),navigateNext:t.throttle(t.navigateNext,{delay:t.navigateNextBuffer,throttled:preventDefault})},e))}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}onElementKeyDown(e){var t,r,n;const i=this,{navigator:s}=i;if(-1===(null==(t=i.focusedCell)?void 0:t.rowIndex)||(null==(r=i.focusedCell)?void 0:r.column)!==i.timeAxisColumn||e.target.closest(s.itemSelector)||"Enter"!==e.key)null==(n=super.onElementKeyDown)||n.call(this,e);else{const t=i.getFirstVisibleAssignment();if(t)return i.navigateTo(t,{uiEvent:e}),!1}}getFirstVisibleAssignment(e=this.focusedCell){var t,r,n;const{currentOrientation:i,rowManager:s,eventStore:a}=this;if(this.isHorizontal){let o=i.rowMap.get(s.getRow(e.rowIndex));if(null==o?void 0:o.length)return null==(t=o[0])?void 0:t.elementData.assignmentRecord;if(o=null==(r=i.resourceMap.get(e.id))?void 0:r.eventsData,null==o?void 0:o.length)return null==(n=o.filter((e=>a.isAvailable(e.eventRecord)))[0])?void 0:n.assignmentRecord}else{const e=[...i.resourceMap.values()][0],t=e&&Object.values(e);if(null==t?void 0:t.length)return t.filter((e=>a.isAvailable(e.renderData.eventRecord)))[0].renderData.assignmentRecord}}onGridBodyFocusIn(e){var t;const r=e.target.closest(this.focusableSelector);if(this.timeAxisSubGridElement.contains(e.target)){const n=this,{navigationEvent:i}=n,{target:s}=e,a=s.closest(n.navigator.itemSelector),o=a?n.normalizeCellContext({rowIndex:n.isVertical?0:n.resourceStore.indexOf(n.resolveResourceRecord(s)),column:n.timeAxisColumn,target:s}):new Location(s);if(a){const{_focusedCell:e}=n;return n._focusedCell=o,void(null==(t=n.onCellNavigate)||t.call(n,n,e,o,i,!0))}if(r&&(!i||isArrowKey[i.key])){const t=n.getFirstVisibleAssignment(o);if(t)return void n.navigateTo(t,{scrollIntoView:Boolean(i&&"mousedown"!==i.type),uiEvent:i||e})}}r&&super.onGridBodyFocusIn(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}normalizeTarget(e){return e.assignmentRecord}getPrevious(e,t){const r=this,{resourceStore:n}=r,{eventSorter:i}=r.currentOrientation,{startDate:s,endDate:a}=r.timeAxis,o=e.event,l=r.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:a}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(o)-1];if(!d)for(let e=n.indexOf(c)-1;(!d||t&&d===o)&&e>=0;e--){c=n.getAt(e);const t=r.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:a}).filter(r.isInTimeAxis).sort(i);d=t.length&&t[t.length-1]}return r.assignmentStore.getAssignmentForEventAndResource(d,c)}navigatePrevious(e){const t=this,r=t.getPrevious(t.normalizeTarget(e));return e.preventDefault(),r?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,{uiEvent:e})):t.doGridNavigation(e)}getNext(e,t){const r=this,{resourceStore:n}=r,{eventSorter:i}=r.currentOrientation,{startDate:s,endDate:a}=r.timeAxis,o=e.event,l=r.eventStore.getEvents({resourceRecord:e.resource,startDate:s,endDate:a}).filter(this.isInTimeAxis).sort(i);let c=e.resource,d=l[l.indexOf(o)+1];if(!d)for(let e=n.indexOf(c)+1;(!d||t&&d===o)&&e<n.count;e++){c=n.getAt(e);d=r.eventStore.getEvents({resourceRecord:c,startDate:s,endDate:a}).filter(r.isInTimeAxis).sort(i)[0]}return r.assignmentStore.getAssignmentForEventAndResource(d,c)}navigateNext(e){const t=this,r=t.getNext(t.normalizeTarget(e));return e.preventDefault(),r?(e.ctrlKey||t.clearEventSelection(),t.navigateTo(r,{uiEvent:e})):t.doGridNavigation(e)}doGridNavigation(e){e.handled||0!==e.key.indexOf("Arrow")||this["navigate"+e.key.substring(5)+"ByKey"](e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:r={}}=emptyObject12){const n=this,{navigator:i}=n,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await n.scrollAssignmentIntoView(e,animate100),i.disabled=!1):i.skipScrollIntoView=!0,!n.isDestroyed&&this.getElementFromAssignmentRecord(e)&&(n.activeAssignment=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:r,item:n.getElementFromAssignmentRecord(e).closest(i.itemSelector)})))}set activeAssignment(e){const t=this.getElementFromAssignmentRecord(e,!0);t&&(this.navigator.activeItem=t)}get activeAssignment(){const{activeItem:e}=this.navigator;if(e)return this.resolveAssignmentRecord(e)}get previousActiveEvent(){const{previousActiveItem:e}=this.navigator;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,r=e.target.closest(t.eventSelector);return!t.navigator.disabled&&r&&(e.assignmentRecord=t.resolveAssignmentRecord(r),e.eventRecord=t.resolveEventRecord(r),e.resourceRecord=t.resolveResourceRecord(r)),e}onDeleteKey(e){const t=this;if(!t.readOnly&&t.enableDeleteKey){const e=t.eventStore.usesSingleAssignment?t.selectedEvents:t.selectedAssignments;t.removeEvents(e.filter((e=>!e.readOnly)))}}onArrowUpKey(e){this.focusCell({rowIndex:this.focusedCell.rowIndex-1,column:this.timeAxisColumn}),e.handled=!0}onArrowDownKey(e){this.focusedCell.rowIndex<this.resourceStore.count-1&&(this.focusCell({rowIndex:this.focusedCell.rowIndex+1,column:this.timeAxisColumn}),e.handled=!0)}onEscapeKey(e){e.target.closest(".b-dragging")||(this.focusCell({rowIndex:this.focusedCell.rowIndex,column:this.timeAxisColumn}),e.handled=!0)}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}},releaseEventActions={releaseElement:1,reuseElement:1},renderEventActions={newElement:1,reuseOwnElement:1,reuseElement:1},MAX_WIDTH=9999999,heightEventSorter=({startDateMS:e},{startDateMS:t})=>e-t,chronoFields={startDate:1,endDate:1,duration:1};function getStartEnd(e,t,r,n,i){var s,a;const{timeAxis:o}=e,l=t.isBatchUpdating&&!i?t.get(n):t[n],c=null==(s=t.hasBatchedChange)?void 0:s.call(t,n);if(e.fillTicks&&(!(null==(a=t.meta)?void 0:a.isResizing)||!c)){let e=o.getTickFromDate(l);if(e>=0){r&&e===Math.round(e)&&e>0&&e--;const t=Math.floor(e);return o.getAt(t)[n].getTime()}}return null==l?void 0:l.getTime()}var HorizontalRendering=class extends(Base.mixin(AttachToProjectMixin_default)){static get configurable(){return{scrollBuffer:0,bufferSize:150,verticalBufferSize:150}}static get properties(){return{resourceMap:new Map,rowMap:new Map,eventConfigs:[],isFirstRefresh:!0,toDrawOnProjectRefresh:new Set,toDrawOnDataReady:new Set}}construct(e){const t=this;t.client=t.scheduler=e,t.eventSorter=t.eventSorter.bind(e),e.scrollable.ion({scroll:"onEarlyScroll",prio:1,thisObj:t}),e.rowManager.ion({name:"rowManager",renderDone:"onRenderDone",removeRows:"onRemoveRows",translateRow:"onTranslateRow",offsetRows:"onOffsetRows",beforeRowHeight:"onBeforeRowHeightChange",thisObj:t}),super.construct({})}init(){}updateVerticalBufferSize(){const{rowManager:e}=this.scheduler;this.scheduler.isPainted&&e.renderRows(e.rows)}get visibleDateRange(){return this._visibleDateRange}getDateFromXY(e,t,r,n=!1){const{scheduler:i}=this;let s=e[0];return r||(s=this.translateToScheduleCoordinate(s)),s=i.getRtlX(s),i.timeAxisViewModel.getDateFromPosition(s,t,n)}translateToScheduleCoordinate(e){const{scheduler:t}=this,{scrollable:r}=t.timeAxisSubGrid;let n=e-t.timeAxisSubGridElement.getBoundingClientRect().left-globalThis.scrollX;return t.rtl?n+=r.maxX-Math.abs(t.scrollLeft):n+=t.scrollLeft,n}translateToPageCoordinate(e){const{scheduler:t}=this,{scrollable:r}=t.timeAxisSubGrid;let n=e+t.timeAxisSubGridElement.getBoundingClientRect().left;return t.rtl?n-=r.maxX-Math.abs(t.scrollLeft):n-=t.scrollLeft,n}getScheduleRegion(e,t,r=!0,n,i=!1){var s;const a=this,{scheduler:o}=a,{timeAxisSubGridElement:l,timeAxis:c}=o,d=(!i||e)&&o.getResourceMargin(e)||0;let u;if(e){const r=t&&o.getElementsFromEventRecord(t,e)[0];if(u=Rectangle.from(o.getRowById(e.id).getElement("normal"),l),r){const e=Rectangle.from(r,l);u.y=e.y,u.bottom=e.bottom}else u.y=u.y+d,u.bottom=u.bottom-d}else u=Rectangle.from(l).moveTo(null,0),u.width=l.scrollWidth,u.y=u.y+d,u.bottom=u.bottom-d;const h=c.startDate,g=c.endDate;n=(null==n?void 0:n.start)&&n||(null==(s=o.getDateConstraints)?void 0:s.call(o,e,t))||{start:h,end:g};let p=o.getCoordinateFromDate(n.start?DateHelper.max(h,n.start):h),m=o.getCoordinateFromDate(n.end?DateHelper.min(g,n.end):g);return r||(p=a.translateToPageCoordinate(p),m=a.translateToPageCoordinate(m)),u.left=Math.min(p,m),u.right=Math.max(p,m),u}getRowRegion(e,t,r){const{scheduler:n}=this,{timeAxis:i}=n,s=n.getRowById(e.id);if(!s)return null;const a=i.startDate,o=i.endDate,l=t?DateHelper.max(a,t):a,c=r?DateHelper.min(o,r):o,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=s.top,g=Math.min(d,u),p=h+s.offsetHeight;return new Rectangle(g,h,Math.max(d,u)-g,p-h)}getResourceEventBox(e,t,r,n=!1){const i=this.resourceMap.get(t.id);let s=null,a=!1;if(i&&(s=i.eventsData.find((t=>t.eventRecord===e))),s||(s=this.getTimeSpanRenderData(e,t,{viewport:!0,timeAxis:r}),a=!0),s){const e=this.scheduler.rowManager.getRecordCoords(t,!0,n),r=s.top+e.top,i=new Rectangle(s.left,r,s.width,s.height);return i.layout=!a,i.rowTop=e.top,i.rowBottom=e.bottom,i.resourceId=t.id,i}return null}resolveRowRecord(e){const t=this,{scheduler:r}=t,n=e.nodeType?e:e.target,i=n.nodeType===Element.TEXT_NODE?n.parentElement:n,s=i.closest(r.eventSelector);return s?t.resourceStore.getById(s.dataset.resourceId):r.getRecordFromElement(i)}attachToProject(e){super.attachToProject(e),this.refreshAllWhenReady=!0,this.scheduler.isConfiguring||this.clearAll({clearDom:!0}),null==e||e.ion({name:"project",refresh:"onProjectRefresh",commitFinalized:"onProjectCommitFinalized",thisObj:this})}onProjectCommitFinalized(){const{scheduler:e,toDrawOnDataReady:t,project:r}=this;e.isVisible?e.isPainted&&!e.refreshSuspended&&(!t.size&&r.timeZone&&r.ignoreRecordChanges&&r.resourceStore.forEach((e=>t.add(e.id))),t.size&&(this.clearResources(t),this.refreshResources(t)),t.clear()):e.whenVisible("refreshRows")}onProjectRefresh({isCalculated:e,isInitialCommit:t}){const r=this,{scheduler:n,toDrawOnProjectRefresh:i}=r;if(n.isVisible){if(n.isPainted&&!n.isConfiguring&&!n.refreshSuspended){if(r.refreshAllWhenReady||t&&e){n.calculateAllRowHeights(!0);const{rowManager:i}=n;i.topRow?(r.clearAll(),n.refreshAfterProjectRefresh||(i.topRow.dataIndex>=n.store.count?n.renderRows(!1):n.refreshWithTransition(!1,!r.isFirstRefresh&&e&&!t)),r.isFirstRefresh=!1):i.reinitialize(),r.refreshAllWhenReady=!1}else i.size&&r.refreshResources(i);i.clear()}}else n.whenVisible("refresh",n,[!0])}attachToAssignmentStore(e){this.refreshAllWhenReady=!0,super.attachToAssignmentStore(e),e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({source:e,action:t,records:r=[],replaced:n,changes:i}){const s=this,{scheduler:a}=s,o=new Set(r.flatMap((e=>{var t,r,n;return[e.resourceId,...null!=(n=null==(r=null==(t=e.resource)?void 0:t.$links)?void 0:r.map((e=>e.id)))?n:[]]})));if(!s.resourceStore.isRemoving&&!s.resourceStore.isChangingId)switch(t){case"dataset":return void(s.eventStore.usesSingleAssignment||(o.size?s.refreshResourcesWhenReady(o):(s.clearAll(),a.refreshWithTransition())));case"add":case"remove":case"updateMultiple":return void s.refreshResourcesWhenReady(o);case"removeall":return void(s.refreshAllWhenReady=!0);case"replace":return n.forEach((([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)})),void s.refreshResourcesWhenReady(o);case"filter":return s.clearAll(),a.calculateAllRowHeights(!0),void a.refreshWithTransition();case"update":("eventId"in i||"resourceId"in i||"id"in i)&&("resourceId"in i&&o.add(i.resourceId.oldValue),e===a.project.assignmentStore?s.refreshResourcesOnDataReady(o):s.refreshResources(o));break;case"clearchanges":{const{added:e,modified:t,removed:r}=i;t.length?a.refreshWithTransition():(e.forEach((e=>o.add(e.resourceId))),r.forEach((e=>o.add(e.resourceId))),s.refreshResourcesOnDataReady(o))}}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.scheduler.refreshWithTransition())}attachToEventStore(e){this.refreshAllWhenReady=!0,super.attachToEventStore(e),e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){if("batch"===e){const{scheduler:e}=this;e.isEngineReady&&e.isPainted&&(this.clearAll(),e.refreshWithTransition())}}onEventStoreChange({action:e,records:t=[],record:r,replaced:n,changes:i,source:s}){var a,o;const l=this,{scheduler:c}=l,d=s.isResourceTimeRangeStore,u=new Set;if(c.isPainted)if(t.forEach((e=>{var t;const r=null==(t=e.$linkedResources)?void 0:t.filter((e=>l.resourceStore.includes(e)));null==r||r.forEach((e=>u.add(e.id)))})),d){switch(e){case"removeall":case"dataset":return l.clearAll(),void c.refreshWithTransition()}l.refreshResources(u)}else{switch(e){case"batch":case"sort":case"group":case"move":case"remove":return;case"clearchanges":return l.clearAll(),void c.refreshWithTransition();case"dataset":return l.clearAll(),void(c.isEngineReady?c.refreshWithTransition():l.refreshAllWhenReady=!0);case"add":case"updateMultiple":break;case"replace":n.forEach((([,e])=>{e.resources.map((e=>u.add(e.id)))}));break;case"removeall":case"filter":return c.isEngineReady?(l.clearAll(),c.calculateAllRowHeights(!0),void c.refreshWithTransition()):void(l.refreshAllWhenReady=!0);case"update":{const e=r.$entity?!Object.keys(i).some((e=>!r.$entity.getField(e))):!Object.keys(i).some((e=>!chronoFields[e]));let t=0;return"startDate"in i&&t++,"endDate"in i&&t++,"duration"in i&&t++,"resourceId"in i&&u.add(i.resourceId.oldValue),void(u.size&&(!e||t&&(!("duration"in i)||1!==t)||"percentDone"in i||"inactive"in i||"constraintDate"in i||"constraintType"in i||"segments"in i)&&((null==(a=l.project)?void 0:a.propagatingLoadChanges)||(null==(o=l.project)?void 0:o.isWritingData)?l.refreshResourcesOnDataReady(u):l.refreshResources(u)))}}l.refreshResourcesWhenReady(u)}}attachToResourceStore(e){this.refreshAllWhenReady=!0,super.attachToResourceStore(e),e&&(this.clearAll({clearLayoutCache:!0}),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",thisObj:this}))}get resourceStore(){return this.client.store}onResourceStoreChange({action:e,isExpand:t,records:r,changes:n}){const i=this,s=null==r?void 0:r.flatMap((e=>e.isLinked?[e.id,e.$originalId]:[e.id]));if(i.scheduler.isPainted){switch(e){case"add":return void(t||(r.every((e=>e.isLinked))?i.refreshResources(s):i.refreshResourcesWhenReady(s)));case"update":return void(i.project.isBatchingChanges||n.isLeaf||i.refreshResources(s));case"filter":case"dataset":return;case"removeall":return void i.clearAll({clearLayoutCache:!0})}s&&i.clearResources(s)}}onTranslateRow({row:e}){null!=e.id&&this.refreshEventsForResource(e,!1)}onOffsetRows(){this.clearAll(),this.doUpdateTimeView()}calculateRowHeight(e){var t;const{scheduler:r}=this,n=r.getResourceHeight(e),i=r.getEventLayout(e);if("stack"===i.type&&r.isEngineReady&&!e.isSpecialRow&&(null==(t=e.assigned)?void 0:t.size)>1){const{assignmentStore:t,eventStore:n,timeAxis:s}=r,{barMargin:a,resourceMargin:o,contentHeight:l}=r.getResourceLayoutSettings(e),c=(n.isFiltered||t.isFiltered)&&(r=>r.assignments.some((r=>r.resource===e.$original&&t.includes(r)))),d=n.getEvents({resourceRecord:e,includeOccurrences:r.enableRecurringEvents,startDate:s.startDate,endDate:s.endDate,filter:c}).sort(heightEventSorter).map((t=>{const r=t.isBatchUpdating?t.get("startDate"):t.startDate,n=t.isBatchUpdating?t.get("endDate"):t.endDate||r;return{eventRecord:t,resourceRecord:e,startMS:r.getTime(),endMS:n.getTime()}})),u=r.getEventLayoutHandler(i),h=u.layoutEventsInBands(d,e,!0);return"layoutFn"===u.type?h:h*l+(h-1)*a+2*o}return n}doUpdateTimeView(){const{scrollable:e}=this.scheduler.timeAxisSubGrid;this.updateFromHorizontalScroll(e.x)}onTimeAxisViewModelUpdate(){const e=this,{scheduler:t}=e;e.clearAll(),t.refreshSuspended&&(e.detachListeners("renderingSuspend"),t.ion({name:"renderingSuspend",resumeRefresh({trigger:r}){t.isEngineReady&&r&&e.doUpdateTimeView()},thisObj:e,once:!0})),e.doUpdateTimeView()}getConnectorStartSide(e){return"start"}getConnectorEndSide(e){return"end"}refreshRows(e){e&&this.clearAll()}onLocaleChange(){this.clearAll()}onViewportResize(e,t,r,n){t>n&&this.onRenderDone()}onDragAbort({context:e,dragData:t}){this.resourceStore.indexOf(t.record.resource)<this.scheduler.topRow.dataIndex&&e.element.remove()}toggleCls(e,t,r=!0,n=!1){const i=this.client.getElementFromAssignmentRecord(e,n),s=this.resourceMap.get(e.isModel?e.get("resourceId"):e.resourceId),a=null==s?void 0:s.eventsData.find((t=>t.eventId===e.eventId));a&&(a[n?"wrapperCls":"cls"][t]=r),i&&(i.classList[r?"add":"remove"](t),i.lastDomConfig.className[t]=r)}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),this.onRenderDone()}onEarlyScroll(){this.rendererCalled=!1}updateFromVerticalScroll(){this.fromScroll=!0,this.rendererCalled||this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{scheduler:r,scrollBuffer:n}=t,{timeAxisSubGrid:i,timeAxis:s,rtl:a}=r,{width:o}=i,{totalSize:l}=r.timeAxisViewModel,c=e,d=0!==i.scrollable.maxX&&Math.abs(i.scrollable.maxX)<=Math.round(c)+5,u=r.getDateFromCoord({coord:Math.max(0,c-n),ignoreRTL:!0}),h=d?s.endDate:r.getDateFromCoord({coord:c+o+n,ignoreRTL:!0})||s.endDate;if(u&&!r._viewPresetChanging){t._visibleDateRange={startDate:u,endDate:h,startMS:u.getTime(),endMS:h.getTime()},t.viewportCoords=a?{left:l-e-o+n,right:l-e-n}:{left:e-n,right:e+o+n};const i=r.timeView.range={startDate:u,endDate:h};if(r.onVisibleDateRangeChange(i),!r.refreshSuspended&&r.rowManager.rows.length){if(null===r.rowManager.rows[0].id)return;t.fromScroll=!0,r.rowManager.rows.forEach((e=>t.refreshEventsForResource(e,!1,!1))),t.onRenderDone()}}}repaintEventsForResource(e){this.refreshResources([e.id])}onBeforeRowHeightChange(){this.clearAll()}refreshResourcesOnDataReady(e){e.forEach((e=>this.toDrawOnDataReady.add(e)))}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshResources(e,t=!0){const{scheduler:r}=this,n=[],i=[];this.clearResources(e),r.refreshSuspended||(e.forEach((e=>{const t=r.getRowById(e);t?n.push(t):i.push(t)})),r.runWithTransition((()=>{r.calculateRowHeights(i.map((e=>this.resourceStore.getById(e))),!0),r.rowManager.renderRows(n)}),t))}layoutEventVerticallyStack(e,t,r){const{barMargin:n,resourceMargin:i,contentHeight:s}=this.scheduler.getResourceLayoutSettings(r,t.parent);return 0===e?i:i+e*s+e*n}layoutEventVerticallyPack(e,t,r,n){const{barMargin:i,resourceMargin:s,contentHeight:a}=this.scheduler.getResourceLayoutSettings(n,r.parent),o=1/t,l=e*o,c=(a-(o-1)*i)*t;return{top:s+l*c+l*i,height:c}}addTemporaryDragElement(e,t=e.resource){const{scheduler:r}=this,n=r.generateRenderData(e,t,{timeAxis:!0,viewport:!0});n.absoluteTop=n.row?n.top+n.row.top:r.getResourceEventBox(e,t,!0).top;const i=this.renderEvent(n),{dataset:s}=i;delete i.tabIndex,delete s.eventId,delete s.resourceId,delete s.assignmentId,delete s.syncId,s.transient=!0,i.parent=this.scheduler.foregroundCanvas,i.retainElement=!0;const a=DomHelper.createElement(i);return a.innerElement=a.firstChild,e.instanceMeta(r).hasTemporaryDragElement=!0,a}eventSorter(e,t){if(this.overlappingEventSorter)return this.overlappingEventSorter(e.eventRecord||e,t.eventRecord||t);const r=e.isModel?e.startDateMS:e.dataStartMS||e.startMS,n=e.isModel?e.endDateMS:e.dataEndMS||e.endMS,i=t.isModel?t.startDateMS:t.dataStartMS||t.startMS,s=t.isModel?t.endDateMS:t.dataEndMS||t.endMS,a=e.isModel?e.name:e.eventRecord.name,o=t.isModel?t.name:t.eventRecord.name;return r-i||s-n||(a<o?-1:a==o?0:1)}calculateMS(e,t,r,n,i){const{scheduler:s}=this,{timeAxisViewModel:a}=s;let o=getStartEnd(s,e,!1,t,n),l=getStartEnd(s,e,!0,r,n),c=l-o;if("default"!==s.milestoneLayoutMode&&0===c){const t=a.getSingleUnitInPixels("minute");if(c=60*(s.getMilestoneLabelWidth(e,i)*(1/t))*1e3,"always-outside"===s.milestoneTextPosition){o-=s.getResourceLayoutSettings(i,e.parent).contentHeight*(1/t)*60*1e3/2,l=o+c}else switch(s.milestoneAlign){case"start":case"left":l=o+c;break;case"end":case"right":l=o,o=l-c;break;default:l=o+c/2,o=l-c}}return{startMS:o,endMS:l,durationMS:c}}setupRenderData(e,t){var r;const n=this,{scheduler:i}=n,{timeAxis:s,timeAxisViewModel:a}=i,{preamble:o,postamble:l}=e,c=n.isProHorizontalRendering&&(null==(r=i.features.eventBuffer)?void 0:r.enabled)&&(o||l)&&!e.isMilestone,d=a.getSingleUnitInPixels("minute"),{isBatchUpdating:u}=e,h=c?"wrapStartDate":"startDate",g=c?"wrapEndDate":"endDate",p=u&&!c?e.get(h):e[h],m=u&&!c?e.get(g):e[g]||p,f=s.startMS,v=s.endMS,{startMS:y,endMS:b,durationMS:C}=n.calculateMS(e,h,g,c,t),D=y<f|(y>v)<<1,S=b>v|(b<=f)<<1,E=S?d*(C/6e4):null,w=i.getRowById(t);return{eventRecord:e,taskRecord:e,start:p,end:m,rowId:t.id,children:[],startMS:y,endMS:b,durationMS:C,startsOutsideView:D,endsOutsideView:S,width:E,row:w,useEventBuffer:c}}fillTimeSpanHorizontalPosition(e){const{startMS:t,endMS:r,durationMS:n}=e,i=null!=t&&null!=r&&this.calculateHorizontalPosition(e,t,r,n);return!!i&&(Object.assign(e,i),!0)}calculateHorizontalPosition(e,t,r,n){const{scheduler:i}=this,{timeAxis:s,timeAxisViewModel:a}=i,{startsOutsideView:o,endsOutsideView:l,eventRecord:c}=e,d=s.startMS,u=a.getSingleUnitInPixels("minute"),h=l?u*(n/6e4):null;let g,p=i.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!0}),m=!1,f=!1;return o?(g=(t-d)/6e4*u,i.rtl&&(g=i.timeAxisSubGrid.scrollable.scrollWidth-g)):(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==p}),m=-1===g),l?p=BrowserHelper.isSafari&&i.features.stickyEvents?i.getCoordinateFromDate(s.endMS):g+h*(i.rtl?-1:1):f=-1===p,f&&!m&&(p=i.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),h>MAX_WIDTH&&(1===o?1===l?(g=-100,p=i.timeAxisColumn.width+100):g=p-MAX_WIDTH:1===l&&(p=g+MAX_WIDTH)),m&&f&&(g=i.getCoordinateFromDate(t,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:r}),p=i.getCoordinateFromDate(r,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:t}),g===p)?(c.instanceMeta(i).excluded=!0,null):{left:Math.min(g,p),width:Math.abs(p-g)||(c.isMilestone&&!c.meta.isDragCreating?0:6),clippedStart:m,clippedEnd:f}}fillTimeSpanVerticalPosition(e,t){const{scheduler:r}=this,{start:n,end:i}=e,{resourceMargin:s,contentHeight:a}=r.getResourceLayoutSettings(t);r.fillTicks&&(e.dataStartMS=n.getTime(),e.dataEndMS=i.getTime()),e.top=Math.max(0,s),r.managedEventSizing&&(e.height=a)}getTimeSpanRenderData(e,t,r=!1){const n=this,{scheduler:i}=n,{timeAxis:s}=i,a=!0===r||r.timeAxis,o=!0===r||r.viewport;if(a||s.isTimeSpanInAxis(e)){if(i.getRowById(t)||o){const r=n.setupRenderData(e,t);return n.fillTimeSpanHorizontalPosition(r)?(n.fillTimeSpanVerticalPosition(r,t),r):null}}}layoutEvents(e,t,r=!1,n,i){const{scheduler:s}=this,{timeAxis:a}=s,o=t.reduce(((t,n)=>{if(r||a.isTimeSpanInAxis(n)){const r=s.generateRenderData(n,e,!1);r&&t.push(r)}return t}),[]);o.sort(null!=i?i:this.eventSorter);let l=s.getAppliedResourceHeight(e,n);const c=o.filter((({eventRecord:e})=>e.isEvent&&!e.meta.excludeFromLayout)),d=s.getEventLayout(e,n),u=s.getEventLayoutHandler(d);if(u){const{barMargin:t,resourceMargin:r,contentHeight:i}=s.getResourceLayoutSettings(e,n),a=u.applyLayout(c,e)||1;l="layoutFn"===u.type?a:a*i+(a-1)*t+2*r}else if(c.length>0)for(let e=0;e<c.length;e++){c[e].wrapperStyle+=";z-index:"+(e+5)}return{rowHeight:l,eventsData:o}}layoutResourceEvents(e,t=!1){const{scheduler:r}=this,{eventStore:n,assignmentStore:i,timeAxis:s}=r,a=n.getEvents({includeOccurrences:r.enableRecurringEvents,resourceRecord:e,startDate:s.startDate,endDate:s.endDate,filter:(i.isFiltered||n.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e.$original&&i.includes(t))))}),o=r.getEventsToRender(e,a)||[];return this.layoutEvents(e,o,t)}renderEvent(e,t){const{scheduler:r}=this,{resourceRecord:n,assignmentRecord:i,eventRecord:s}=e,{milestoneLayoutMode:a,milestoneTextPosition:o}=r,l=i?this.assignmentStore.getOccurrence(i,s).id:e.eventId,c={className:e.cls,style:e.style||"",children:e.children,role:"presentation",dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},d={className:e.wrapperCls,tabIndex:"tabIndex"in e?e.tabIndex:-1,children:[c,...e.wrapperChildren],style:{top:e.absoluteTop,left:e.left,height:e.fillSize?t:e.height,width:!s.isMilestone||s.meta.isDragCreating||("default"!==a||"outside"!==o&&("inside"!==o||e.width))&&"always-outside"!==o?e.width:e.height,style:e.wrapperStyle,fontSize:e.height+"px"},dataset:{resourceId:n.id,eventId:e.eventId,syncId:n.isLinked?l+"_"+n.id:l},elementData:e,retainElement:(null==i?void 0:i.instanceMeta(r).retainElement)||s.instanceMeta(r).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return e.fillSize&&(e.height=t),e.zIndex&&(d.zIndex=e.zIndex),i&&(d.dataset.assignmentId=i.id),e.elementConfig=d,d}refreshEventsForResource(e,t=!0,r=!0){const n=this,i=n.scheduler.store.getById(e.isRow?e.id:e),s=n.scheduler.rowManager.getRowFor(i);t&&n.clearResources([i]),s&&i&&(n.renderer({row:s,record:i}),t&&r&&n.onRenderDone())}getResourceLayout(e){const t=this;let r=t.resourceMap.get(e.id);if(!r||r.invalid){if(t.suspended)return;r=t.layoutResourceEvents(e,!1),t.resourceMap.set(e.id,r)}return r}getEventDOMConfigForCurrentView(e,t,r,n){const i=this,{bufferSize:s,scheduler:a}=i,{labels:o,eventBuffer:l}=a.features,c=(null==l?void 0:l.enabled)||(null==o?void 0:o.enabled)&&(o.left||o.right||o.before||o.after),{eventsData:d}=e,u=i.fromScroll?i.rowMap.get(t):null,h=[];let g,p;for(let a=0;a<d.length;a++){const o=d[a];if(g=r,p=n,(c||0===o.width)&&(g-=s,p+=s),o.left+o.width>=g&&o.left<=p){o.absoluteTop=o.top+t.top;const r=null==u?void 0:u.find((e=>e.elementData.eventId===o.eventId));h.push(null!=r?r:i.renderEvent(o,e.rowHeight))}}return h}renderer({row:e,record:t,size:r={}}){const n=this;if(t.isSpecialRow)return void n.rowMap.delete(e);const{left:i,right:s}=n.viewportCoords,a=n.getResourceLayout(t);if(!a)return;r.height=a.rowHeight,r.transient=!0;const o=n.getEventDOMConfigForCurrentView(a,e,i,s);n.rowMap.set(e,o),n.rendererCalled=!0}onRenderDone(){var e;const{scheduler:t,rowMap:r,verticalBufferSize:n}=this,i=[],s=null!=(e=t._scrollTop)?e:0,a=s-n,o=s+t._bodyRectangle.height+n,l=n<0,c=!t.managedEventSizing;r.forEach(((e,t)=>{if(l||t.bottom>a&&t.top<o)for(let t=0;t<e.length;t++){const r=e[t],n=r.elementData,{absoluteTop:s,eventRecord:d}=n;(l||c||d.meta.isDragCreating||d.meta.isResizing||s+n.height>a&&s<o)&&i.push(r)}for(let t=0;t<e.length;t++)e[t]={...e[t]}})),this.fromScroll=!1,this.visibleEventDOMConfigs=i,DomSync.sync({domConfig:{onlyChildren:!0,children:i},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:e,domConfig:r,lastDomConfig:n,targetElement:i,jsx:s}){var a,o,l;const{reactComponent:c}=t,d=releaseEventActions[e],u=renderEventActions[e];if((d||!(null==(a=t.processEventContent)?void 0:a.call(t,{jsx:s,action:e,domConfig:r,targetElement:i,isRelease:d,reactComponent:c})))&&"none"!==e&&(null==(o=null==r?void 0:r.elementData)?void 0:o.isWrap)){if(d&&(null==n?void 0:n.elementData)){const{eventRecord:e,resourceRecord:r,assignmentRecord:s}=n.elementData,a={renderData:n.elementData,element:i,eventRecord:e,resourceRecord:r,assignmentRecord:s};null==(l=t.processEventContent)||l.call(t,{isRelease:d,targetElement:i,reactComponent:c,assignmentRecord:s}),i===DomHelper.getActiveElement(i)&&t.focusElement.focus(),t.trigger("releaseEvent",a)}if(u){const{eventRecord:n,resourceRecord:s,assignmentRecord:a}=r.elementData,o={renderData:r.elementData,element:i,isReusingElement:"reuseElement"===e,isRepaint:"reuseOwnElement"===e,eventRecord:n,resourceRecord:s,assignmentRecord:a};t.trigger("renderEvent",o)}}}})}clearResources(e){(e=ArrayHelper.asArray(e)).map(Model.asId).forEach((e=>{const t=this.resourceMap.get(e);t&&(t.invalid=!0);const r=this.scheduler.getRowById(e);r&&this.rowMap.delete(r)}))}clearAll({clearDom:e=!1,clearLayoutCache:t=!1}={}){const r=this,{layouts:n,foregroundCanvas:i}=r.scheduler;if(t&&n)for(const e in n)n[e].clearCache();if(i&&e){i.syncIdMap=i.lastDomConfig=null;for(const e of i.children)e.lastDomConfig=e.elementData=null}r.resourceMap.clear(),r.rowMap.clear()}};__publicField(HorizontalRendering,"$name","HorizontalRendering"),HorizontalRendering._$name="HorizontalRendering";var VerticalLayout=class extends(PackMixin_default()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,r,n,i,s){const a=this,o=s.type;return a.packEventsInBands(e,((e,i,s,l)=>{if("none"===o)e.width=t-2*r,e.left+=r;else{e.widthFactor=l;const a=e.leftFactor=s.start+i*l,c=Math.round(1/l),d=a/l,u=t-2*r-n*(c-1);"mixed"===o&&2===c?(e.left+=a*t/5+n,e.width=t-a*t/5-2*n,e.zIndex=5+d):(e.width=l*u,e.left+=a*u+r+n*d)}e.cls["b-sch-event-narrow"]=e.width<a.scheduler.narrowEventWidth}))}};VerticalLayout._$name="VerticalLayout";var releaseEventActions2={releaseElement:1,reuseElement:1},renderEventActions2={newElement:1,reuseOwnElement:1,reuseElement:1},chronoFields2={startDate:1,endDate:1,duration:1},emptyObject13=Object.freeze({}),VerticalRendering=class extends(Base.mixin(Delayable_default,AttachToProjectMixin_default)){static get properties(){return{eventMap:new Map,resourceMap:new Map,releasedElements:{},toDrawOnProjectRefresh:new Set,resourceBufferSize:1}}construct(e){this.client=this.scheduler=e,this.verticalLayout=new VerticalLayout({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t,resourceColumns:r}=e;r.resourceStore=e.resourceStore,r.ion({name:"resourceColumns",columnWidthChange:"onResourceColumnWidthChange",thisObj:e}),e.initialized=!0,t.isPainted&&e.renderer(),r.availableWidth=t.timeAxisSubGridElement.offsetWidth}resolveRowRecord(e,t){const r=this,{scheduler:n}=r,i=e.nodeType?null:e,s=i?i.target:e,a=i?[i.borderOffsetX,i.borderOffsetY]:t,o=(s.nodeType===Element.TEXT_NODE?s.parentElement:s).closest(n.eventSelector);if(o)return n.resourceStore.getById(o.dataset.resourceId);if(!s.closest(".b-sch-timeaxis-cell"))return null;if(!a)throw new Error("垂直模式需要坐标来解析此元素。也可以使用浏览器事件而不是元素调用，以从中提取元素和坐标");if(n.variableColumnWidths||n.resourceStore.isGrouped){let e=0;for(const t of r.resourceStore)if(t.isSpecialRow||(e+=t.columnWidth||r.resourceColumns.columnWidth),e>=a[0])return t;return null}const l=Math.floor(a[0]/r.resourceColumns.columnWidth);return r.allResourceRecords[l]}toggleCls(e,t,r=!0,n=!1){var i;const s=null==(i=this.eventMap.get(e.eventId))?void 0:i[e.resourceId];if(s){s.renderData[n?"wrapperCls":"cls"][t]=r;const i=this.client.getElementFromAssignmentRecord(e,n);i&&i.classList[r?"add":"remove"](t)}}getDateFromXY(e,t,r,n=!1){let i=e[1];return r||(i=this.translateToScheduleCoordinate(i)),this.scheduler.timeAxisViewModel.getDateFromPosition(i,t,n)}translateToScheduleCoordinate(e){return e-this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top-globalThis.scrollY}translateToPageCoordinate(e){return e+this.scheduler.timeAxisSubGridElement.getBoundingClientRect().top+globalThis.scrollY}getResourceEventBox(e,t){var r,n,i;const s=e.id,a=t.id;let{renderData:o}=(null==(r=this.eventMap.get(s))?void 0:r[a])||emptyObject13;return o||(this.layoutResourceEvents(this.scheduler.resourceStore.getById(a)),o=null==(i=null==(n=this.eventMap.get(s))?void 0:n[a])?void 0:i.renderData),o?new Rectangle(o.left,o.top,o.width,o.bottom-o.top):null}getScheduleRegion(e,t,r){var n;const i=this,{scheduler:s}=i,a=Rectangle.from(s.timeAxisSubGridElement,s.timeAxisSubGridElement);e&&(a.left=i.allResourceRecords.indexOf(e)*s.resourceColumnWidth,a.right=a.left+s.resourceColumnWidth);const o=s.timeAxis.startDate,l=s.timeAxis.endDate,c=(null==(n=s.getDateConstraints)?void 0:n.call(s,e,t))||{start:o,end:l},d=s.getCoordinateFromDate(DateHelper.max(o,c.start)),u=s.getCoordinateFromDate(DateHelper.min(l,c.end));return r?(a.top=d,a.bottom=u):(a.top=i.translateToPageCoordinate(d),a.bottom=i.translateToPageCoordinate(u)),a}getRowRegion(e,t,r){const{scheduler:n}=this,i=this.allResourceRecords.indexOf(e)*n.resourceColumnWidth,s=n.timeAxis.startDate,a=n.timeAxis.endDate,o=t?DateHelper.max(s,t):s,l=r?DateHelper.min(a,r):a,c=n.getCoordinateFromDate(o),d=n.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new Rectangle(i,u,n.resourceColumnWidth,h)}get visibleDateRange(){const e=this.scheduler,t=e.scrollable.y,r=e.scrollable.clientHeight,n=e.getDateFromCoordinate(t)||e.timeAxis.startDate,i=e.getDateFromCoordinate(t+r)||e.timeAxis.endDate;return{startDate:n,endDate:i,startMS:n.getTime(),endMS:i.getTime()}}onResourceColumnWidthChange({width:e,oldWidth:t}){const r=this,{scheduler:n}=r;r.resourceColumns.width=n.timeAxisColumn.width=r.allResourceRecords.length*e,r.clearAll(),r.refresh(Math.abs(e-t)>30)}attachToProject(e){super.attachToProject(e),e&&e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}onProjectRefresh(){const e=this,{scheduler:t,toDrawOnProjectRefresh:r}=e;t.isVisible?t.rendered&&!t.refreshSuspended&&(e.refreshAllWhenReady?(e.clearAll(),e.refresh(),e.refreshAllWhenReady=!1):r.size&&e.refresh(),r.clear()):t.whenVisible("refresh",t,[!0])}attachToEventStore(e){super.attachToEventStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"eventStore",refreshPreCommit:"onEventStoreRefresh",thisObj:this})}onEventStoreRefresh({action:e}){"batch"===e&&(this.refreshAllWhenReady=!0)}onEventStoreChange({action:e,records:t=[],record:r,replaced:n,changes:i,isAssign:s}){const a=this,o=new Set;switch(t.forEach((e=>{var t;const r=null==(t=e.$linkedResources)?void 0:t.filter((e=>a.resourceStore.includes(e)));null==r||r.forEach((e=>o.add(e.id)))})),e){case"sort":case"group":case"move":case"remove":return;case"dataset":return void a.refreshAllResourcesWhenReady();case"add":case"updateMultiple":break;case"replace":n.forEach((([,e])=>{e.resources.map((e=>o.add(e.id)))})),a.clearResources(o);break;case"removeall":case"filter":return a.clearAll(),void a.refresh();case"update":{let e=0;return"startDate"in i&&e++,"endDate"in i&&e++,"duration"in i&&e++,void((!(r.$entity?!Object.keys(i).some((e=>!r.$entity.getField(e))):!Object.keys(i).some((e=>!chronoFields2[e])))||e||"percentDone"in i||"inactive"in i||"segments"in i)&&(a.clearResources(o),a.refresh()))}}a.refreshResourcesWhenReady(o)}attachToResourceStore(e){const t=this;super.attachToResourceStore(e),t.refreshAllWhenReady=!0,t.resourceColumns&&(t.resourceColumns.resourceStore=e),e.ion({name:"resourceStore",changePreCommit:"onResourceStoreChange",refreshPreCommit:"onResourceStoreRefresh",load:()=>t.scheduler.unmaskBody(),thisObj:t,prio:1}),t.initialized&&t.scheduler.isPainted&&(t.firstResource=t.lastResource=null,t.clearAll(),t.renderer())}onResourceStoreChange({source:e,action:t,records:r=[],record:n,replaced:i,changes:s}){const a=this,o=i?i.map((e=>e[1])):r,l=new Set(o.map((e=>e.id)));a.firstResource=a.lastResource=null,e._allResourceRecords=null;const{allResourceRecords:c}=e;if(a.scheduler.isEngineReady){switch(t){case"update":(null==s?void 0:s.id)?a.clearResources([s.id.oldValue,s.id.value]):a.clearResources([n.id]);break;case"filter":a.clearAll()}s&&"columnWidth"in s&&a.clearAll(),a.refresh(!0)}else{switch(t){case"dataset":case"remove":case"removeall":return void a.refreshAllResourcesWhenReady();case"replace":case"add":if(!e.isGrouped){const e=o.reduce(((e,t)=>Math.min(e,c.indexOf(t))),c.length);for(let t=e;t<c.length;t++)l.add(c[t].id)}}a.refreshResourcesWhenReady(l)}}onResourceStoreRefresh({action:e}){const t=this;"sort"!==e&&"group"!==e||(t.firstResource=t.lastResource=t.resourceStore._allResourceRecords=null,t.clearAll(),t.refresh())}attachToAssignmentStore(e){super.attachToAssignmentStore(e),this.refreshAllWhenReady=!0,e&&e.ion({name:"assignmentStore",changePreCommit:"onAssignmentStoreChange",refreshPreCommit:"onAssignmentStoreRefresh",thisObj:this})}onAssignmentStoreChange({action:e,records:t=[],replaced:r,changes:n}){const i=this,s=new Set(t.map((e=>e.resourceId)));if(i.scheduler.isEngineReady){switch(e){case"remove":i.clearResources(s);break;case"filter":i.clearAll();break;case"update":if("resourceId"in n&&s.add(n.resourceId.oldValue),!Object.keys(n).filter((e=>"resource"!==e&&"event"!==e)).length)return;i.clearResources(s)}i.refresh(!0)}else{switch(n&&"resourceId"in n&&s.add(n.resourceId.oldValue),e){case"removeall":return void i.refreshAllResourcesWhenReady();case"replace":r.forEach((([e,t])=>{s.add(e.resourceId),s.add(t.resourceId)}))}i.refreshResourcesWhenReady(s)}}onAssignmentStoreRefresh({action:e,records:t}){"batch"===e&&(this.clearAll(),this.refreshAllResourcesWhenReady())}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}repaintEventsForResource(e){this.renderResource(e)}updateFromHorizontalScroll(e){e!==this.prevScrollX&&(this.renderer(),this.prevScrollX=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:r}=this,n=this.allResourceRecords.indexOf(e)*r.resourceColumnWidth;return r.scrollHorizontallyTo(n,t)}get allResourceRecords(){return this.scheduler.resourceStore.allResourceRecords}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}get resourceColumns(){var e;return null==(e=this.scheduler.timeAxisColumn)?void 0:e.resourceColumns}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}updateElementId(){}releaseTimeSpanDiv(){}getConnectorStartSide(e){return"top"}getConnectorEndSide(e){return"bottom"}refreshResourcesWhenReady(e){this.clearResources(e),e.forEach((e=>this.toDrawOnProjectRefresh.add(e)))}refreshAllResourcesWhenReady(){this.clearAll(),this.refreshAllWhenReady=!0}get resourceRange(){return this.getResourceRange(!0)}get visibleResources(){const{first:e,last:t}=this.getResourceRange();return{first:this.allResourceRecords[e],last:this.allResourceRecords[t]}}getResourceRange(e){const{scheduler:t,resourceStore:r}=this,{resourceColumnWidth:n,scrollX:i}=t,{scrollWidth:s}=t.timeAxisSubGrid.scrollable,a=e?this.resourceBufferSize:0,o=i-a,l=i+s+a;if(!(null==r?void 0:r.count))return{first:-1,last:-1};if(t.variableColumnWidths){let e,r,n=0,i=0;return this.allResourceRecords.forEach(((s,a)=>{if(s.instanceMeta(t).insetStart=r=i,i=r+s.columnWidth,r>l)return!1;i>o&&null==e?e=a:r<l&&(n=a)})),{first:e,last:n}}return{first:Math.max(Math.floor(i/n)-a,0),last:Math.min(Math.floor((i+t.timeAxisSubGrid.width)/n)+a,this.allResourceRecords.length-1)}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));t||(t=e.timeAxis.last.endDate);let r=e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0));return r||(r=e.timeAxis.first.startDate,t=e.getDateFromCoordinate(e.bodyHeight+e.tickSize-1)),{topDate:r,bottomDate:t}}getTimeSpanRenderData(e,t,r=!1){var n;const i=this,{scheduler:s}=i,{preamble:a,postamble:o}=e,{variableColumnWidths:l}=s,c=(null==(n=s.features.eventBuffer)?void 0:n.enabled)&&i.isProVerticalRendering&&(a||o)&&!e.isMilestone,d=c?"wrapStartDate":"startDate",u=c?"wrapEndDate":"endDate",h=e.isBatchUpdating&&e.hasBatchedChange(d)&&!c?e.get(d):e[d],g=e.isBatchUpdating&&e.hasBatchedChange(u)&&!c?e.get(u):e[u],p=s.getResourceMargin(t),m=s.getCoordinateFromDate(h),f=t.instanceMeta(s),v=l?f.insetStart:i.allResourceRecords.indexOf(t)*s.resourceColumnWidth,y=s.getResourceWidth(t),b=y-2*p,C=h.getTime(),D=g.getTime();let S=s.getCoordinateFromDate(g),E=S-m;return-1===S&&(E=Math.round((D-C)*s.timeAxisViewModel.getSingleUnitInPixels("millisecond")),S=m+E),{eventRecord:e,resourceRecord:t,left:v,top:m,bottom:S,resourceWidth:y,width:b,height:E,startDate:h,endDate:g,startDateMS:C,endDateMS:D,useEventBuffer:c,children:[],start:h,end:g,startMS:C,endMS:D}}eventSorter(e,t){const r=e.dataStartMs||e.startDateMS,n=e.dataEndMs||e.endDateMS,i=t.dataStartMs||t.startDateMS,s=t.dataEndMs||t.endDateMS,a=e.isModel?e.name:e.eventRecord.name,o=t.isModel?t.name:t.eventRecord.name;return r-i||s-n||(a<o?-1:a==o?0:1)}layoutEvents(e,t,r=!1,n,i){const s=this,{scheduler:a}=s,{variableColumnWidths:o}=a,{id:l}=e,c=e.instanceMeta(a),d=n?l+"-"+n.id:l,u=s.resourceMap.set(d,{}).get(d),h=s.allResourceRecords.indexOf(e),{barMargin:g,resourceMargin:p}=a.getResourceLayoutSettings(e,n),m=t.reduce(((t,r)=>{if(r.isScheduled){const n=a.generateRenderData(r,e,!1),i={renderData:n};ObjectHelper.getMapPath(s.eventMap,n.eventId,{})[l]=i,u[n.eventId]=i,n.fillSize?(n.left=o?c.insetStart:h*a.resourceColumnWidth,n.width=a.getResourceWidth(e)):t.push(n)}return t}),[]);return m.sort(null!=i?i:s.eventSorter),s.verticalLayout.applyLayout(m,a.getResourceWidth(e,n),p,g,h,a.getEventLayout(e,n)),u}layoutResourceEvents(e){const{scheduler:t}=this,{assignmentStore:r,eventStore:n,timeAxis:i}=t;let s=n.getEvents({includeOccurrences:t.enableRecurringEvents,resourceRecord:e,startDate:i.startDate,endDate:i.endDate,filter:(r.isFiltered||n.isFiltered)&&(t=>t.assignments.some((t=>t.resource===e&&r.includes(t))))});return s=t.getEventsToRender(e,s),this.layoutEvents(e,s)}addTemporaryDragElement(e){const{scheduler:t}=this,r=t.generateRenderData(e,e.resource,{timeAxis:!0,viewport:!0});r.top=r.row?r.top+r.row.top:t.getResourceEventBox(e,e.resource,!0).top;const n=this.renderEvent({renderData:r}),{dataset:i}=n;delete n.tabIndex,delete i.eventId,delete i.resourceId,delete i.assignmentId,delete i.syncId,i.transient=!0,n.parent=this.scheduler.foregroundCanvas,n.retainElement=!0;const s=DomHelper.createElement(n);return s.innerElement=s.firstChild,e.instanceMeta(t).hasTemporaryDragElement=!0,s}renderEvent(e){const{scheduler:t}=this,r=e.renderData,{resourceRecord:n,assignmentRecord:i,eventRecord:s}=r,a={className:r.wrapperCls,tabIndex:-1,children:[{role:"presentation",className:r.cls,style:(r.internalStyle||"")+(r.style||""),children:r.children,dataset:{taskFeature:"event"},syncOptions:{syncIdField:"taskBarFeature"}},...r.wrapperChildren],style:{top:r.top,[t.rtl?"right":"left"]:r.left,height:s.isMilestone?"1em":r.height,width:r.width,style:r.wrapperStyle||"",fontSize:s.isMilestone?Math.min(r.width,40):null},dataset:{resourceId:n.id,eventId:r.eventId,syncId:i?this.assignmentStore.getOccurrence(i,s).id:r.eventId},elementData:e,retainElement:(i||s).instanceMeta(this.scheduler).retainElement,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}};return a.className["b-sch-vertical"]=1,r.zIndex&&(a.zIndex=r.zIndex),i&&(a.dataset.assignmentId=i.id),e.elementConfig=a,a}renderResource(e){var t;const r=this,{topDateMS:n,bottomDateMS:i}=r,s=[];let a=r.resourceMap.get(e.id);a||(a=r.layoutResourceEvents(e));for(const e in a){const o=a[e],{endDateMS:l,startDateMS:c,eventRecord:d}=o.renderData;if(l>=n&&c<=i&&!d.instanceMeta(r.scheduler).hasTemporaryDragElement){const e="b-released"!==(null==(t=o.elementConfig)?void 0:t.className)&&o.elementConfig||r.renderEvent(o);s.push(e)}}return s}isEventElement(e){const t=e&&e.className;return t&&t[this.scheduler.eventCls+"-wrap"]}renderer(){const e=this,{scheduler:t}=e,{first:r,last:n}=e.resourceRange,{topDate:i,bottomDate:s}=e.dateRange,a=[],o=[];if(e.initialized&&(t.isEngineReady||t.isCreating)){if(!DateHelper.isEqual(i,e.topDate)||!DateHelper.isEqual(s,e.bottomDate)){e.topDate=i,e.bottomDate=s,e.topDateMS=i.getTime(),e.bottomDateMS=s.getTime();const r=e.timeView.range={startDate:i,endDate:s};t.onVisibleDateRangeChange(r)}if(-1!==r&&-1!==n)for(let t=r;t<=n;t++)a.push.apply(a,e.renderResource(e.allResourceRecords[t]));if(t.getForegroundDomConfigs(o),a.push.apply(a,o),DomSync.sync({domConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,syncIdField:"syncId",callback({action:r,domConfig:n,lastDomConfig:i,targetElement:s,jsx:a}){var o,l,c;const{reactComponent:d}=t;if(e.isEventElement(n)||a||(null==(o=null==n?void 0:n.elementData)?void 0:o.jsx)){const o=releaseEventActions2[r],u=renderEventActions2[r];if(null==(l=t.processEventContent)?void 0:l.call(t,{action:r,domConfig:n,isRelease:!1,targetElement:s,reactComponent:d,jsx:a}))return;if(o&&e.isEventElement(i)&&!i.isReleased){const e=i.elementData.renderData,r={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s};null==(c=t.processEventContent)||c.call(t,{isRelease:o,targetElement:s,reactComponent:d,assignmentRecord:e.assignmentRecord}),s===DomHelper.getActiveElement(s)&&t.focusElement.focus(),t.trigger("releaseEvent",r)}if(u){const e=n.elementData.renderData,i={renderData:e,assignmentRecord:e.assignmentRecord,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s,isReusingElement:"reuseElement"===r,isRepaint:"reuseOwnElement"===r};i.reusingElement="reuseElement"===r,t.trigger("renderEvent",i)}}}}),e.firstResource!==r||e.lastResource!==n){const i=e.resourceColumns.visibleResources={firstResource:r,lastResource:n};e.firstResource=r,e.lastResource=n,t.onVisibleResourceRangeChange(i),t.trigger("resourceRangeChange",i)}}}refresh(e){this.scheduler.runWithTransition((()=>this.renderer()),e)}refreshResources(e){this.clearResources(e),this.refresh()}refreshEventsForResource(e,t=!0,r=!0){this.refreshResources([e.id])}onRenderDone(){}get timeView(){return this.scheduler.timeView}clearResources(e){const{resourceMap:t,eventMap:r}=this;e.forEach((e=>{t.has(e)&&(Object.values(t.get(e)).forEach((({renderData:{eventId:t}})=>{delete r.get(t)[e]})),t.delete(e))}))}clearAll(){this.resourceMap.clear(),this.eventMap.clear()}};VerticalRendering._$name="VerticalRendering";var descriptionFormats={month:"MMMM, YYYY",week:["MMMM YYYY (Wp)","S{MMM} - E{MMM YYYY} (S{Wp})"],day:"MMMM D, YYYY"},SchedulerBase=class extends(TimelineBase.mixin(CrudManagerView_default,Describable_default,SchedulerDom_default,SchedulerDomEvents_default,SchedulerStores_default,SchedulerScroll_default,SchedulerState_default,SchedulerEventRendering_default,SchedulerRegions_default,EventSelection_default,EventNavigation_default,CurrentConfig_default)){constructor(){super(...arguments),__publicField(this,"timeCellSelector",".b-sch-timeaxis-cell"),__publicField(this,"resourceTimeRangeSelector",".b-sch-resourcetimerange")}static get $name(){return"SchedulerBase"}static get type(){return"schedulerbase"}static get configurable(){return{date:{value:null,$config:{equal:"date"}},stepUnit:"week",range:"week",getDateConstraints:null,verticalTimeAxisColumn:{},createEventOnDblClick:!0,schedulableAreaSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",sortFeatureStore:"resourceStore"}}static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,preCalculateHeightLimit:1e4,crudManagerClass:CrudManager,testConfig:{loadMaskError:{autoClose:10,showDelay:0}}}}afterConstruct(){const e=this;super.afterConstruct(),e.ion({scroll:"onVerticalScroll",thisObj:e}),e.createEventOnDblClick&&e.ion({scheduledblclick:e.onTimeAxisCellDblClick})}onPaintOverride(){}get store(){return super.store}set store(e){super.store=e}get visibleResources(){var e,t;const r=this;return r.isVertical?r.currentOrientation.visibleResources:{first:r.store.getById(null==(e=r.firstVisibleRow)?void 0:e.id),last:r.store.getById(null==(t=r.lastVisibleRow)?void 0:t.id)}}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onTimeAxisCellDblClick({date:e,resourceRecord:t,row:r}){this.readOnly||t.isSpecialRow||t.readOnly||this.createEvent(e,t,r)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add("b-sch-"+e),"horizontal"===e?(t.horizontal=new HorizontalRendering(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new VerticalRendering(t),t.rendered&&t.vertical.init()))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){return super.onElementKeyDown(e)}onElementKeyUp(e){return super.onElementKeyUp(e)}onElementMouseOver(e){return super.onElementMouseOver(e)}onElementMouseOut(e){return super.onElementMouseOut(e)}processEventDrop(){}processCrossSchedulerEventDrop(){}beforeEventDragStart(){}afterEventDragStart(){}afterEventDragAbortFinalized(){}checkEventDragValidity(){}afterEventResizeStart(){}get hasEventEditor(){const{eventEdit:e,taskEdit:t,simpleEventEdit:r}=this.features;return Boolean((null==e?void 0:e.enabled)||(null==t?void 0:t.enabled)||(null==r?void 0:r.enabled))}editEvent(e,t,r){const n=this,{eventStore:i,assignmentStore:s}=n;if(!n.hasEventEditor)return!1;if(e.eventStore!==i){const{enableEventAnimations:r}=n,a=[];e.isCreating=!0;let o=[];if(t&&(a.push(t),o=s.assignEventToResource(e,t)),!1===n.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:a,assignmentRecords:o}))return null==s||s.remove(o),!1;n.enableEventAnimations=!1,i.add(e),n.project.commitAsync().then((()=>n.enableEventAnimations=r)),n.refreshRows()}}async createEvent(e,t){var r,n,i;const s=this,{enableEventAnimations:a,features:o,eventStore:l,assignmentStore:c}=s,d=[t],u=s.createEventOnDblClick.useEventModelDefaults,h=u?l.modelClass.defaultValues.duration:1,g=u?l.modelClass.defaultValues.durationUnit:s.timeAxis.unit,p=l.createRecord({startDate:e,endDate:DateHelper.add(e,h,g),duration:h,durationUnit:g,name:s.L("L{Object.newEvent}")}),m=Boolean((null==(r=o.eventEdit)?void 0:r.enabled)||(null==(n=o.taskEdit)?void 0:n.enabled)||(null==(i=o.simpleEventEdit)?void 0:i.enabled));if(s.readOnly||t.isSpecialRow||!s.allowOverlap&&!s.isDateRangeAvailable(p.startDate,p.endDate,null,t))return;p.isCreating=m,s.onEventCreated(p);const f=null==c?void 0:c.assignEventToResource(p,t);!1!==s.trigger("beforeEventAdd",{eventRecord:p,resourceRecords:d,assignmentRecords:f})?(s.enableEventAnimations=!1,l.add(p),s.project.commitAsync().then((()=>s.enableEventAnimations=a)),s.isCreating=!0,s.refreshRows(),s.isCreating=!1,s.trigger("eventAutoCreated",{eventRecord:p,resourceRecord:t}),m&&s.editEvent(p,t,s.getEventElement(p))):null==c||c.remove(f)}isDateRangeAvailable(e,t,r,n){return this.eventStore.isDateRangeAvailable(e,t,r,n)}async resumeRefresh(e){super.resumeRefresh(!1);const t=this;if(!t.refreshSuspended&&e){if(!t.isEngineReady)return t.currentOrientation.refreshAllWhenReady=!0,t.project.commitAsync();t.isDestroyed||t.refreshWithTransition()}}toggleEmptyText(){var e;const t=this;t.bodyContainer&&DomHelper.toggleClasses(t.bodyContainer,"b-grid-empty",!(t.resourceStore.count>0||(null==(e=t.crudManager)?void 0:e.isLoading)))}getRowHeight(e){if(this.isHorizontal){const t=this.currentOrientation.calculateRowHeight(e);return this.rowManager.storeKnownHeight(e.id,t),t}}calculateRowHeights(e,t=!1){e.forEach((e=>e&&this.getRowHeight(e))),t||this.rowManager.estimateTotalHeight(!0)}calculateAllRowHeights(e=!1){const{store:t,rowManager:r}=this,n=Math.min(t.count,this.preCalculateHeightLimit);if(n){r.clearKnownHeights();for(let e=0;e<n;e++)this.getRowHeight(t.getAt(e));e||r.estimateTotalHeight(!0)}}get dateBounds(){const e=this,t=[e.startDate];return"week"===e.range&&t.push(e.lastDate),t}get defaultDescriptionFormat(){return descriptionFormats[this.range]}get lastDate(){const e=this.endDate;return e&&DateHelper.add(e,-1,"day")}getEventRecord(e){return e=DomHelper.getEventElement(e),this.resolveEventRecord(e)}getEventElement(e){return this.getElementFromEventRecord(e)}changeRange(e){return DateHelper.normalizeUnit(e)}updateRange(e){if(!this.isConfiguring){const t=this.date,r=this.date=DateHelper.startOf(t,e);t.getTime()===r.getTime()&&this.updateDate(r)}}changeStepUnit(e){return DateHelper.normalizeUnit(e)}updateDate(e){const t=this,r=DateHelper.startOf(e,t.range);t.setTimeSpan(r,DateHelper.add(r,1,t.range)),t.visibleDate={date:DateHelper.max(e,t.timeAxis.startDate),block:"start",animate:!0},t.trigger("descriptionChange")}previous(){this.date=DateHelper.add(this.date,-1,this.stepUnit)}next(){this.date=DateHelper.add(this.date,1,this.stepUnit)}async scheduleEvent({startDate:e,eventRecord:t,resourceRecord:r,element:n}){const i=this;if(i.eventStore.includes(t)||([t]=i.eventStore.add(t)),t.startDate=e,t.assign(r),n){const e=Rectangle.from(n,i.foregroundCanvas);DomHelper.setTranslateXY(n,0,0),DomHelper.setTopLeft(n,e.y,e.x),DomSync.addChild(i.foregroundCanvas,n,t.assignments[0].id)}await i.project.commitAsync()}};SchedulerBase.initClass(),SchedulerBase._$name="SchedulerBase";var ScheduleTableExporter=class extends(Localizable_default(TableExporter)){static get defaultConfig(){return{includeUnassigned:!0,eventColumns:[{text:"Task",field:"name"},{text:"Starts",field:"startDate",width:140},{text:"Ends",field:"endDate",width:140}],eventSortFn:null}}construct(e={},...t){super.construct(e,...t),this.eventSortFn||(this.eventSortFn=(e,t)=>e.internalId-t.internalId)}normalizeColumns(e){super.normalizeColumns(e),e.eventColumns=e.eventColumns.map((e=>"string"==typeof e?{field:e}:e))}generateExportData(e){const t=this,r=this.target instanceof SchedulerBase,n=t.generateColumns(e),i=r?t.generateEventColumns(e):[];return{columns:n.concat(i),rows:t.generateRows(e)}}generateEventColumns(e){return e.eventColumns.map((t=>this.processEventColumn(t,e)))}processEventColumn(e,t){const{width:r,minWidth:n}=e,{defaultColumnWidth:i}=t;return{field:e.field,value:e.text,width:Math.max(r||i,n||i),eventColumn:!0,type:this.getColumnType(e,this.target.eventStore)}}generateRows(e){const t=this,{target:r}=t;let n;if(r instanceof SchedulerBase){if(n=[],r.resourceStore.map((r=>{const i=r.events||[];i.sort(t.eventSortFn),i.length||i.push(""),i.forEach((i=>n.push(t.getRowData(e,r,i))))})),e.includeUnassigned&&e.eventColumns.length){const i=r.eventStore.query((e=>!e.resources.length));if(i.length){const r=new Array(e.columns.length).fill("");r.push(t.L("L{ExcelExporter.No resource assigned}")),n.push(r),i.forEach((r=>n.push(t.getRowData(e,null,r))))}}n=n.filter((e=>e.length))}else n=super.generateRows(e);return n}getRowData(e,t,r){const{columns:n,eventColumns:i}=e,s=[],a=this.processRecord(t,n,e);if(a&&s.push(...a),!t||!t.isSpecialRow){const t=this.processRecord(r,i,e);t&&s.push(...t)}return s}};ScheduleTableExporter._$name="ScheduleTableExporter";var ExcelExporter2=class extends ExcelExporter{static get $name(){return"ExcelExporter"}static get defaultConfig(){return{exporterClass:ScheduleTableExporter,exporterConfig:null}}};ExcelExporter2._$name="ExcelExporter",GridFeatureManager.registerFeature(ExcelExporter2,!1,"Scheduler");var Scheduler=class extends SchedulerBase{static get $name(){return"Scheduler"}static get type(){return"scheduler"}};Scheduler.initClass(),Scheduler._$name="Scheduler";var ProjectCombo=class extends Combo{static get $name(){return"ProjectCombo"}static get type(){return"projectcombo"}static get configurable(){return{project:null,displayField:"title",valueField:"url",highlightExternalChange:!1,editable:!1}}updateProject(e){var t;(null==(t=e.transport.load)?void 0:t.url)&&(this.value=e.transport.load.url)}onChange({value:e,userAction:t}){t&&this.project&&(this.project.transport.load.url=e,this.project.load())}};ProjectCombo.initClass(),ProjectCombo._$name="ProjectCombo";var ResourceFilter=class extends List{static get $name(){return"ResourceFilter"}static get type(){return"resourcefilter"}static get delayable(){return{applyFilter:"raf"}}static get configurable(){return{eventStore:null,multiSelect:!0,toggleAllIfCtrlPressed:!0,itemTpl:e=>StringHelper.encodeHtml(e.name||""),masterFilter:()=>!0}}itemIconTpl(e,t){const{eventColor:r}=e,n=DomHelper.isNamedColor(r)?" b-sch-foreground-"+r:"",i=!n&&r?' style="color:'+r+'"':"";return this.multiSelect?'<div class="b-selected-icon gt-icon'+n+'"'+i+"></div>":""}updateEventStore(e){var t,r;const n=this,i=(null==(t=n.initialConfig.store)?void 0:t.isStore)?n.initialConfig.store.initialConfig:null==(r=n.store)?void 0:r.config,{resourceStore:s}=e,a=n.store=s.chain(n.masterFilter,null,{...i,syncOrder:!0}),o={change:"onStoreChange",thisObj:n};a.un(o),s.ion(o),s.count?n.initFilter():s.project.ion({name:"project",refresh:"initFilter",thisObj:n})}changeMasterFilter(e){const t=this;return function(r){return e.call(t,r)}}initFilter(){const{eventStore:e,selected:t}=this;e.count&&e.resourceStore.count&&(this.initialSelection||t.add(this.store.getRange()),this.detachListeners("project"))}onStoreRefresh({source:e,action:t}){if("filter"===t&&this.resourceFilter){const{resourceFilter:t}=this,{disabled:r}=t,n=!e.isFiltered&&this.allSelected;n!==r&&(t.disabled=n,this.applyFilter())}super.onStoreRefresh(...arguments)}onSelectionChange({source:e,added:t,removed:r}){const n=this,i=!n.store.isFiltered&&n.allSelected;if(super.onSelectionChange(...arguments),n.resourceFilter){if(n.resourceFilter.disabled=i,n.applyFilter(),n.eventListeners.change){const i=e.values,s=i.concat(r);ArrayHelper.remove(s,t),n.triggerFieldChange({value:i,oldValue:s})}}else n.resourceFilter=n.eventStore.addFilter({id:n.id+"-filter-instance",filterBy:e=>!e.resource||n.selected.includes(e.resources),disabled:i},t.length===n.store.count)}get value(){return this.selected.values}applyFilter(){this.eventStore.filter()}};ResourceFilter.initClass(),ResourceFilter._$name="ResourceFilter";var SchedulerDatePicker=class extends DatePicker{static get $name(){return"SchedulerDatePicker"}static get type(){return"datepicker"}static get configurable(){return{showEvents:null,eventStore:null,eventFilter:{$config:"lazy",value:null}}}construct(e){"events"in e&&(delete(e={...e,showEvents:e.events}).events,VersionHelper.deprecate(VersionHelper.calendar?"Calendar":"Scheduler","6.0.0","DatePicker#events should be configured as showEvents")),super.construct(e)}changeEventFilter(e){if("string"==typeof e){const{handler:t,thisObj:r}=this.resolveCallback(e);e=t.bind(r)}return e}doRefresh(){if(this.isVisible||!this.showEvents)return this.refreshEventsMap(),super.doRefresh(...arguments);this.whenVisible("doRefresh")}updateShowEvents(e,t){const r=this,{classList:n}=r.contentElement;let{eventStore:i}=r;if(r.requestAnimationFrame((()=>{var i;r.element.classList.toggle("b-datepicker-with-events",Boolean(e)),null==(i=r.owner)||i.element.classList.toggle("b-datepicker-with-events",Boolean(e)),e&&n.add("b-show-events-"+e),n.remove("b-show-events-"+t)})),e){if(!i){const e=r.up((e=>e.eventStore));if(!e)throw new Error("DatePicker configured with events but no eventStore");i=e.eventStore}}else r.eventsMap=null;r.isConfiguring||(r.updateEventStore(i),r.doRefresh())}refreshEventsMap(){const e=this;e.showEvents&&(e.eventsMap=e.eventStore.getEventCounts({startDate:e.startDate,endDate:e.endDate,dateMap:e.eventsMap,filter:e.eventFilter}))}updateEventStore(e){var t;-1===e.findListener("change","refresh",this)&&(null==(t=null==e?void 0:e[this.showEvents?"on":"un"])||t.call(e,{change:"refresh",thisObj:this}))}cellRenderer({cell:e,date:t}){var r,n;const{showEvents:i}=this,s=null==(n=null==(r=this.eventCounts)?void 0:r.get)?void 0:n.call(r,DateHelper.makeKey(t)),a="count"===i;delete e.dataset.btip,s&&(!a&&this.eventCountTip&&(e.dataset.btip=this.L("L{ResourceInfoColumn.eventCountText}",s)),DomHelper.createElement({dataset:{count:s},class:{[a?"b-cell-events-badge":"gt-icon gt-icon-circle"]:1,[SchedulerDatePicker.getEventCountClass(s)]:1},parent:e,[a?"text":""]:s}))}static getEventCountClass(e){return e?e<4?"b-datepicker-1-to-3-events":e<7?"b-datepicker-4-to-6-events":"b-calendar-7-or-more-events":""}static setupClass(e){e.replaceType=!0,super.setupClass(e)}};SchedulerDatePicker.initClass(),SchedulerDatePicker._$name="SchedulerDatePicker";var isProjectConsumer=e=>e.isProjectConsumer,UndoRedo=class extends UndoRedoBase{static get $name(){return"UndoRedo"}static get type(){return"undoredo"}static get configurable(){return{scheduler:null,project:null}}construct(){super.construct(...arguments),this.stm||(this.scheduler=this.up(isProjectConsumer))}changeScheduler(e){return e.isProjectConsumer?e:UndoRedo.getById(e)}updateScheduler(e){const{crudManager:t}=e;e.ion({projectChange:"onProjectChanged",thisObj:this}),t?this.setupLoadListener(t):this.onLoad(),this.stm=e.project.stm}setupLoadListener(e){e.detachListeners("load"),e.ion({name:"load",load:"onLoad",thisObj:this})}async onLoad(){await this.scheduler.project.commitAsync(),this.isDestroyed||(this.stm.enable(),this.fillUndoRedoCombo())}onProjectChanged({project:e}){this.project=e}updateProject(e){super.updateProject(...arguments),e&&this.scheduler&&!this.scheduler.isConfiguring&&this.setupLoadListener(e)}};UndoRedo.initClass(),UndoRedo._$name="UndoRedo";var ViewPresetCombo=class extends Combo{construct(){super.construct(...arguments),this.scheduler.ion({presetchange:this.onClientPresetChange,thisObj:this})}get scheduler(){return this.client||this.up((e=>e.isTimelineBase))||Widget.query((e=>e.isTimelineBase))}changeValue(e,t){return this.getConfig("presets"),super.changeValue(e,t)}updatePresets(e){this.store=this.scheduler.presets.chain((t=>e.includes(t.id))),this.store.sort(((t,r)=>e.indexOf(t.id)-e.indexOf(r.id)))}onClientPresetChange({preset:e}){const t=this;t._isSelecting||(t.isSettingValue=!0,t.store.includes(e.id)?t.value=e:t.clear(),t.isSettingValue=!1)}onSelect({record:e}){var t;if(!this.isSettingValue){const{scheduler:r}=this,{mainUnit:n,start:i,defaultSpan:s}=e;if(r.suspendRefresh(),this._isSelecting=!0,r.viewPreset=e,this._isSelecting=!1,n&&s){let a=n;i&&"string"==typeof i&&(a=null!=(t=DateHelper.parseTimeUnit(i))?t:i);let o=DateHelper.startOf(r.startDate,a);e.start&&"number"==typeof i&&(o=DateHelper.add(o,i,n));const l=DateHelper.add(o,s,n);r.setTimeSpan(o,l)}r.scrollLeft=0,r.resumeRefresh(!0)}}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}};__publicField(ViewPresetCombo,"$name","ViewPresetCombo"),__publicField(ViewPresetCombo,"type","viewpresetcombo"),__publicField(ViewPresetCombo,"configurable",{presets:["hourAndDay","weekAndDay","dayAndMonth"],client:null,editable:!1,valueField:"id",displayField:"name",placeholder:"Select view"}),ViewPresetCombo.initClass(),ViewPresetCombo._$name="ViewPresetCombo";var OnCycleAction,MIN_SMI=-Math.pow(2,30),MAX_SMI=Math.pow(2,30)-1,uppercaseFirst=e=>e.slice(0,1).toUpperCase()+e.slice(1),isAtomicValue=e=>Object(e)!==e,defineProperty9=(e,t,r)=>(Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0}),r),prototypeValue=e=>function(t,r){t[r]=e},copySetInto=(e,t)=>{for(const r of e)t.add(r);return t},delay2=e=>new Promise((t=>setTimeout(t,e))),matchAll=function*(e,t){let r;for(;null!==(r=e.exec(t));)yield r},isRegeneratorRuntime=null,isGeneratorFunction=function(e){return null===isRegeneratorRuntime&&(isRegeneratorRuntime="undefined"!=typeof regeneratorRuntime),!0===isRegeneratorRuntime?regeneratorRuntime.isGeneratorFunction(e):"GeneratorFunction"===e.constructor.name},DEBUG=!1,emptyFn3=(...e)=>{},DEBUG_ONLY=e=>DEBUG?e:emptyFn3,debug=DEBUG_ONLY((e=>{})),warn=DEBUG_ONLY((e=>{"undefined"!=typeof console&&console.warn(e)})),StackEntry=class extends Base2{},SourceLinePoint=class extends Base2{constructor(){super(...arguments),this.stackEntries=[]}static fromError(e){return SourceLinePoint.new({exception:e,stackEntries:parseErrorStack(e.stack)})}static fromThisCall(){const e=this.fromError(new Error);return e.stackEntries.splice(0,2),e}},parseErrorStack=e=>CI(matchAll(/^   +at\s*(.*?)\s*\((https?:\/\/.*?):(\d+):(\d+)/gm,e)).map((e=>StackEntry.new({statement:e[1],sourceFile:e[2],sourceLine:Number(e[3]),sourceCharPos:Number(e[4])}))).toArray(),RequiredProperties=Symbol("RequiredProperties"),required=DEBUG_ONLY(((e,t)=>{let r=e[RequiredProperties];r||(r=e[RequiredProperties]=[]),r.push(t)})),validateRequiredProperties=DEBUG_ONLY((e=>{const t=e[RequiredProperties];if(t)for(let r=0;r<t.length;r++)if(void 0===e[t[r]])throw new Error("Required attribute ["+String(t[r])+"] is not provided")}));!function(e){e.Cancel="Cancel",e.Resume="Resume"}(OnCycleAction||(OnCycleAction={}));var WalkSource=Symbol("WalkSource"),NOT_VISITED=-1,VISITED_TOPOLOGICALLY=-2,WalkContext=class extends Base2{constructor(){super(...arguments),this.visited=new Map,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e.map((e=>({node:e,from:WalkSource,label:void 0})))),this.walkDepth()}onNode(e,t){}onTopologicalNode(e){}onCycle(e,t){return OnCycleAction.Cancel}forEachNext(e,t){throw new Error("Abstract method called")}collectNext(e,t,r){throw new Error("Abstract method called")}getVisitedInfo(e){return this.visited.get(e)}setVisitedInfo(e,t,r){return r?(r.visitedAt=t,r.visitEpoch=this.currentEpoch):(r={visitedAt:t,visitEpoch:this.currentEpoch},this.visited.set(e,r)),r}walkDepth(){this.visited;const e=this.toVisit;let t;for(;t=e.length;){const r=e[t-1].node,n=this.getVisitedInfo(r);if(n&&n.visitedAt===VISITED_TOPOLOGICALLY&&n.visitEpoch===this.currentEpoch)e.pop();else if(n&&n.visitEpoch===this.currentEpoch&&n.visitedAt!==NOT_VISITED){if(n.visitedAt<t){if(this.onCycle(r,e)!==OnCycleAction.Resume)break}else n.visitedAt=VISITED_TOPOLOGICALLY,this.onTopologicalNode(r);e.pop()}else{if(!1===this.onNode(r,e[t-1]))break;const i=this.setVisitedInfo(r,t,n),s=e.length;this.collectNext(r,e,i),e.length===s&&(i.visitedAt=VISITED_TOPOLOGICALLY,this.onTopologicalNode(r),e.pop())}}}};function cycleInfo(e){const t=e.length;if(0===t)return[];const r=e[t-1].node,n=[r];let i=t-1,s=i;for(;i>=0&&e[i].from!==r;){for(;i>=0&&e[i].from===e[s].from;)i--;i>=0&&(n.push(e[i].node),s=i)}return i<0?[]:(n.push(r),n.reverse())}var VariableInputState,__decorate=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},FORMULA_ID=0,CalculateProposed=FORMULA_ID++,Formula=class extends Base2{constructor(){super(...arguments),this.formulaId=FORMULA_ID++,this.inputs=new Set}},VariableWalkContext=class extends WalkContext{collectNext(e,t){if(e instanceof Formula)t.push({node:e.output,from:e,label:void 0});else{const r=this.cache.formulasByInput.get(e);r&&r.forEach((r=>t.push({node:r,from:e,label:void 0})))}}},FormulasCache=class extends(Mixin([Base2],(e=>class extends e{constructor(){super(...arguments),this.variables=new Set,this.formulas=new Set,this.$formulasByInput=void 0,this.$formulasByOutput=void 0}get formulasByInput(){return void 0!==this.$formulasByInput||this.fillCache(),this.$formulasByInput}get formulasByOutput(){return void 0!==this.$formulasByOutput||this.fillCache(),this.$formulasByOutput}add(e){this.$formulasByInput=void 0,this.$formulasByOutput=void 0,this.formulas.add(e)}has(e){return this.formulas.has(e)}fillCache(){this.$formulasByInput=new Map,this.$formulasByOutput=new Map,this.formulas.forEach((e=>{let t=this.$formulasByOutput.get(e.output);t||(t=new Set,this.$formulasByOutput.set(e.output,t)),t.add(e),e.inputs.forEach((t=>{let r=this.$formulasByInput.get(t);r||(r=new Set,this.$formulasByInput.set(t,r)),r.add(e)}))}))}allInputVariables(){return uniqueOnly(concatIterable(map(this.formulas,(e=>e.inputs.values()))))}isCyclic(){let e=!1;return VariableWalkContext.new({cache:this,onCycle:()=>(e=!0,OnCycleAction.Cancel)}).startFrom(Array.from(this.allInputVariables())),e}}))){},CycleDescription=class extends FormulasCache{},CycleResolution=class extends Base2{constructor(){super(...arguments),this.description=void 0,this.defaultResolutionFormulas=new Set,this.resolutionsByInputHash=new Map}clear(){this.resolutionsByInputHash.clear()}resolve(e){const t=this.resolutionsByInputHash.get(e.hash);if(void 0!==t)return t;const r=this.buildResolution(e);return this.resolutionsByInputHash.set(e.hash,r),r}buildResolution(e){const t=WalkState.new({context:this,input:e}),r=Array.from(t.next()).map((e=>({resolution:e.asResolution(),nbrOfDefaultFormulas:Array.from(e.activatedFormulas.formulas).reduce(((t,r)=>e.formulaIsDefault(r)?t+1:t),0),unCoveredInputWeight:e.unCoveredInputWeight()})));if(r.sort(((e,t)=>e.unCoveredInputWeight<t.unCoveredInputWeight?-1:e.unCoveredInputWeight>t.unCoveredInputWeight?1:t.nbrOfDefaultFormulas-e.nbrOfDefaultFormulas)),r.length>0)return r[0].resolution}};!function(e){e[e.NoInput=0]="NoInput",e[e.HasPreviousValue=1]="HasPreviousValue",e[e.HasProposedValue=2]="HasProposedValue",e[e.KeepIfPossible=4]="KeepIfPossible"}(VariableInputState||(VariableInputState={}));var CycleResolutionInput=class extends Base2{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.$hash=""}get hash(){return""!==this.$hash?this.$hash:this.$hash=this.buildHash()}get description(){return this.context.description}get resolution(){return this.context.resolve(this)}initialize(...e){super.initialize(...e),validateRequiredProperties(this),this.input=new Map(CI(this.description.variables).map((e=>[e,VariableInputState.NoInput])))}buildHash(){return String.fromCharCode(...CI(this.description.variables).inBatchesBySize(5).map((e=>this.batchToCharCode(e))))}batchToCharCode(e){return e.reduceRight(((e,t,r)=>e|this.input.get(t)<<3*r),0)}addProposedValueFlag(e){if(DEBUG){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(""!==this.$hash)throw new Error("Already hashed")}const t=this.input.get(e);this.input.set(e,t|VariableInputState.HasProposedValue)}hasProposedValue(e){return Boolean(this.input.get(e)&VariableInputState.HasProposedValue)}hasProposedValueVars(){return CI(this.description.variables).filter((e=>this.hasProposedValue(e)))}addPreviousValueFlag(e){if(DEBUG){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(""!==this.$hash)throw new Error("Already hashed")}const t=this.input.get(e);this.input.set(e,t|VariableInputState.HasPreviousValue)}hasPreviousValue(e){return Boolean(this.input.get(e)&VariableInputState.HasPreviousValue)}hasPreviousValueVars(){return CI(this.description.variables).filter((e=>this.hasPreviousValue(e)))}addKeepIfPossibleFlag(e){if(DEBUG){if(!this.description.variables.has(e))throw new Error("Unknown variable");if(""!==this.$hash)throw new Error("Already hashed")}const t=this.input.get(e);this.input.set(e,t|VariableInputState.KeepIfPossible)}keepIfPossible(e){return Boolean(this.input.get(e)&VariableInputState.KeepIfPossible)}keepIfPossibleVars(){return CI(this.description.variables).filter((e=>this.keepIfPossible(e)))}};__decorate([required],CycleResolutionInput.prototype,"context",void 0);var WalkState=class extends Base2{constructor(){super(...arguments),this.context=void 0,this.input=void 0,this.previous=void 0,this.activatedFormula=void 0,this.$activatedFormulas=void 0}get activatedFormulas(){if(void 0!==this.$activatedFormulas)return this.$activatedFormulas;const e=FormulasCache.new({variables:this.description.variables,formulas:CI(this.thisAndPreviousStates()).map((e=>e.activatedFormula)).toSet()});return this.$activatedFormulas=e}get description(){return this.context.description}*thisAndPreviousStates(){let e=this;for(;e&&e.activatedFormula;)yield e,e=e.previous}formulaHasProposedValueInInput(e){return Array.from(e.inputs).some((e=>this.input.hasProposedValue(e)))}unCoveredInputWeight(){const e=map(this.input.hasProposedValueVars(),(e=>({variable:e,isProposed:!0}))),t=map(this.input.keepIfPossibleVars(),(e=>({variable:e,isProposed:!1})));return CI([e,t]).concat().uniqueOnlyBy((e=>e.variable)).reduce(((e,{variable:t,isProposed:r})=>{let n=0;const i=this.activatedFormulas.formulasByOutput.get(t);if(i){const e=1===i.size?Array.from(i)[0]:null;e&&this.formulaIsDefault(e)&&this.formulaHasProposedValueInInput(e)?n+=r?1e6:1e4:n+=r?1e7:1e5}const s=this.activatedFormulas.formulasByInput.get(t);return s&&s.size>0||(n+=r?1e3:100),e+n}),0)}preferFormula(e,t){const r=this.formulaAllInputsHasProposed(e),n=this.formulaAllInputsHasProposed(t);if(r&&!n)return-1;if(n&&!r)return 1;const i=this.formulaCountInputsWithProposedOrKeep(e),s=this.formulaCountInputsWithProposedOrKeep(t);return i>s?-1:i<s?1:this.formulaIsDefault(e)&&!this.formulaIsDefault(t)?-1:this.formulaIsDefault(t)&&!this.formulaIsDefault(e)?1:0}formulaIsDefault(e){return this.context.defaultResolutionFormulas.has(e)}formulaCountInputsWithProposedOrKeep(e){let t=0;return Array.from(e.inputs).forEach((e=>{(this.input.hasProposedValue(e)||this.input.keepIfPossible(e))&&t++})),t}formulaAllInputsHasProposedOrKeep(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.keepIfPossible(e)))}formulaAllInputsHasProposed(e){return Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)))}formulaIsApplicable(e){const t=Array.from(e.inputs).every((e=>this.input.hasProposedValue(e)||this.input.hasPreviousValue(e)||this.activatedFormulas.formulasByOutput.has(e))),r=FormulasCache.new({formulas:new Set(this.activatedFormulas.formulas)});return r.add(e),t&&!r.isCyclic()}formulaIsInsignificant(e){const t=this.activatedFormulas.formulasByOutput.has(e.output),r=this.input.hasPreviousValue(e.output);return t||r&&Array.from(e.inputs).some((e=>!this.input.hasPreviousValue(e)&&!this.input.hasProposedValue(e)&&!this.activatedFormulas.formulasByOutput.has(e)))}unvisitedFormulas(){return Array.from(this.description.formulas).filter((e=>!this.activatedFormulas.has(e)))}*next(){const e=this.unvisitedFormulas();e.sort(this.preferFormula.bind(this));let t=!0;for(const r of e){if(!this.formulaIsApplicable(r)||this.formulaIsInsignificant(r))continue;const e=WalkState.new({previous:this,context:this.context,input:this.input,activatedFormula:r});yield*e.next(),t=!1}t&&(yield this)}asResolution(){return new Map(CI(this.description.variables).map((e=>{const t=this.activatedFormulas.formulasByOutput.get(e);if(t)for(const r of t)return[e,r.formulaId];return[e,CalculateProposed]})))}},__decorate2=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BreakCurrentStackExecution=Symbol("BreakCurrentStackExecution"),Effect=class extends Base2{};__decorate2([prototypeValue(!0)],Effect.prototype,"sync",void 0),__decorate2([prototypeValue(!0)],Effect.prototype,"pure",void 0);var ProposedOrPreviousSymbol=Symbol("ProposedOrPreviousSymbol"),ProposedOrPrevious=Effect.new({handler:ProposedOrPreviousSymbol}),RejectSymbol=Symbol("RejectSymbol"),RejectEffect=class extends Effect{constructor(){super(...arguments),this.handler=RejectSymbol}};__decorate2([prototypeValue(!1)],RejectEffect.prototype,"pure",void 0);var Reject=e=>RejectEffect.new({reason:e}),TransactionSymbol=Symbol("TransactionSymbol"),GetTransaction=Effect.new({handler:TransactionSymbol}),OwnQuarkSymbol=Symbol("OwnQuarkSymbol"),OwnQuark=Effect.new({handler:OwnQuarkSymbol}),OwnIdentifierSymbol=Symbol("OwnIdentifierSymbol"),OwnIdentifier=Effect.new({handler:OwnIdentifierSymbol}),WriteSymbol=Symbol("WriteSymbol"),WriteEffect=class extends Effect{constructor(){super(...arguments),this.handler=WriteSymbol}};__decorate2([prototypeValue(!1)],WriteEffect.prototype,"pure",void 0);var Write=(e,t,...r)=>WriteEffect.new({identifier:e,proposedArgs:[t,...r]}),WriteSeveralSymbol=Symbol("WriteSeveralSymbol"),WriteSeveralEffect=class extends Effect{constructor(){super(...arguments),this.handler=WriteSeveralSymbol}};__decorate2([prototypeValue(!1)],WriteSeveralEffect.prototype,"pure",void 0);var EdgeType,WriteSeveral=e=>WriteSeveralEffect.new({writes:e}),PreviousValueOfSymbol=Symbol("PreviousValueOfSymbol"),PreviousValueOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=PreviousValueOfSymbol}},PreviousValueOf=e=>PreviousValueOfEffect.new({identifier:e}),ProposedValueOfSymbol=Symbol("ProposedValueOfSymbol"),ProposedValueOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=ProposedValueOfSymbol}},ProposedValueOf=e=>ProposedValueOfEffect.new({identifier:e}),HasProposedValueSymbol=Symbol("HasProposedValueSymbol"),HasProposedValueEffect=class extends Effect{constructor(){super(...arguments),this.handler=HasProposedValueSymbol}},HasProposedValue=e=>HasProposedValueEffect.new({identifier:e}),HasProposedNotPreviousValueSymbol=Symbol("HasProposedNotPreviousValueSymbol"),HasProposedNotPreviousValueEffect=class extends Effect{constructor(){super(...arguments),this.handler=HasProposedNotPreviousValueSymbol}},HasProposedNotPreviousValue=e=>HasProposedNotPreviousValueEffect.new({identifier:e}),ProposedOrPreviousValueOfSymbol=Symbol("ProposedOrPreviousValueOfSymbol"),ProposedOrPreviousValueOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=ProposedOrPreviousValueOfSymbol}},ProposedOrPreviousValueOf=e=>ProposedOrPreviousValueOfEffect.new({identifier:e}),ProposedArgumentsOfSymbol=Symbol("ProposedArgumentsOfSymbol"),ProposedArgumentsOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=ProposedArgumentsOfSymbol}},ProposedArgumentsOf=e=>ProposedArgumentsOfEffect.new({identifier:e}),UnsafeProposedOrPreviousValueOfSymbol=Symbol("UnsafeProposedOrPreviousValueOfSymbol"),UnsafeProposedOrPreviousValueOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=UnsafeProposedOrPreviousValueOfSymbol}},UnsafeProposedOrPreviousValueOf=e=>UnsafeProposedOrPreviousValueOfEffect.new({identifier:e}),UnsafePreviousValueOfSymbol=Symbol("UnsafePreviousValueOfSymbol"),UnsafePreviousValueOfEffect=class extends Effect{constructor(){super(...arguments),this.handler=UnsafePreviousValueOfSymbol}},UnsafePreviousValueOf=e=>UnsafePreviousValueOfEffect.new({identifier:e}),CycleResolutionInputChrono=class extends CycleResolutionInput{collectInfo(e,t,r){null!=e(PreviousValueOf(t))&&this.addPreviousValueFlag(r),e(HasProposedNotPreviousValue(t))&&this.addProposedValueFlag(r)}},ContextSync=Symbol("ContextSync"),ContextGen=Symbol("ContextGen"),CalculationGen=class extends(Mixin([],(e=>class extends e{constructor(){super(...arguments),this.iterator=void 0,this.iterationResult=void 0}isCalculationStarted(){return Boolean(this.iterator||this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(e,...t){const r=this.iterator=this.calculation.call(this.context||this,e,...t);return this.iterationResult=r.next()}continueCalculation(e){return this.iterationResult=this.iterator.next(e)}cleanupCalculation(){this.iterationResult=void 0,this.iterator=void 0}*calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(e(this.iterationResult.value));return this.iterator=void 0,this.result}async runAsyncWithEffect(e,...t){for(this.startCalculation(e,...t);!this.isCalculationCompleted();)this.continueCalculation(await e(this.iterationResult.value));return this.iterator=void 0,this.result}}))){},SynchronousCalculationStarted=Symbol("SynchronousCalculationStarted"),calculationStartedConstant={value:SynchronousCalculationStarted},CalculationSync=class extends(Mixin([],(e=>class extends e{constructor(){super(...arguments),this.iterationResult=void 0}isCalculationStarted(){return Boolean(this.iterationResult)}isCalculationCompleted(){return Boolean(this.iterationResult&&this.iterationResult.done)}get result(){return this.iterationResult&&this.iterationResult.done?this.iterationResult.value:void 0}startCalculation(e,...t){return this.iterationResult=calculationStartedConstant,this.iterationResult={done:!0,value:this.calculation.call(this.context||this,e,...t)}}continueCalculation(e){throw new Error("Can not continue synchronous calculation")}cleanupCalculation(){this.iterationResult=void 0}calculation(e,...t){throw new Error("Abstract method `calculation` called")}runSyncWithEffect(e,...t){return this.startCalculation(e,...t),this.result}async runAsyncWithEffect(e,...t){throw new Error("Can not run synchronous calculation asynchronously")}}))){};function runGeneratorSyncWithEffect(e,t,r,n){const i=t.apply(n||null,r);let s=i.next();for(;!s.done;)s=i.next(e(s.value));return s.value}async function runGeneratorAsyncWithEffect(e,t,r,n){const i=t.apply(n||null,r);let s=i.next();for(;!s.done;){const t=e(s.value);s=t instanceof Promise?i.next(await t):i.next(t)}return s.value}!function(e){e[e.Normal=1]="Normal",e[e.Past=2]="Past"}(EdgeType||(EdgeType={}));var Levels,ORIGIN_ID=0,Quark=class extends(MixinAny([Map],(e=>class extends e{constructor(){super(...arguments),this.createdAt=void 0,this.identifier=void 0,this.value=void 0,this.proposedValue=void 0,this.proposedIsPrevious=!1,this.proposedArguments=void 0,this.usedProposedOrPrevious=!1,this.previous=void 0,this.origin=void 0,this.originId=MIN_SMI,this.needToBuildProposedValue=!1,this.edgesFlow=0,this.visitedAt=NOT_VISITED,this.visitEpoch=0,this.promise=void 0,this.$outgoingPast=void 0}static new(e){const t=new this;return e&&Object.assign(t,e),t}get level(){return this.identifier.level}get calculation(){return this.identifier.calculation}get context(){return this.identifier.context||this.identifier}forceCalculation(){this.edgesFlow=MAX_SMI}cleanup(){this.cleanupCalculation()}isShadow(){return Boolean(this.origin&&this.origin!==this)}resetToEpoch(e){this.visitEpoch=e,this.visitedAt=NOT_VISITED,this.edgesFlow<0&&(this.edgesFlow=0),this.usedProposedOrPrevious=!1,this.cleanupCalculation(),this.clearOutgoing(),this.promise=void 0,this.origin&&this.origin===this?(this.proposedArguments=void 0,void 0!==this.value&&(this.proposedValue=this.value),this.value=void 0):(this.origin=void 0,this.value=void 0),this.identifier.proposedValueIsBuilt&&this.proposedValue!==TombStone&&(this.needToBuildProposedValue=!0,this.proposedValue=void 0)}copyFrom(e){this.value=e.value,this.proposedValue=e.proposedValue,this.proposedArguments=e.proposedArguments,this.usedProposedOrPrevious=e.usedProposedOrPrevious}clearProperties(){this.value=void 0,this.proposedValue=void 0,this.proposedArguments=void 0}mergePreviousOrigin(e){const t=this.origin;if(t!==this.previous)throw new Error("Invalid state");this.copyFrom(t);const r=this.getOutgoing();for(const[n,i]of t.getOutgoing()){if(!r.get(n)){const t=e.get(n);t&&t.originId!==i.originId||r.set(n,t||i)}}if(void 0!==t.$outgoingPast){const r=this.getOutgoingPast();for(const[n,i]of t.getOutgoingPast()){if(!r.get(n)){const t=e.get(n);t&&t.originId!==i.originId||r.set(n,t||i)}}}this.origin=this,t.clearProperties(),t.clear()}setOrigin(e){this.origin=e,this.originId=e.originId}getOrigin(){return this.origin?this.origin:this.startOrigin()}startOrigin(){return this.originId=ORIGIN_ID++,this.origin=this}getOutgoing(){return this}getOutgoingPast(){return void 0!==this.$outgoingPast?this.$outgoingPast:this.$outgoingPast=new Map}addOutgoingTo(e,t){(t===EdgeType.Normal?this:this.getOutgoingPast()).set(e.identifier,e)}clearOutgoing(){this.clear(),void 0!==this.$outgoingPast&&this.$outgoingPast.clear()}getValue(){const e=this.origin;return e===this?this.value:e?e.getValue():void 0}setValue(e){if(this.origin&&this.origin!==this)throw new Error("Can not set value to the shadow entry");this.getOrigin().value=e}hasValue(){return void 0!==this.getValue()}hasProposedValue(){return!this.isShadow()&&this.hasProposedValueInner()}hasProposedValueInner(){return void 0!==this.proposedValue}getProposedValue(e){return this.needToBuildProposedValue&&(this.needToBuildProposedValue=!1,this.proposedValue=this.identifier.buildProposedValue.call(this.identifier.context||this.identifier,this.identifier,this,e)),this.proposedValue}outgoingInTheFutureCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values())n.originId===e.getLatestEntryFor(n.identifier).originId&&t(n);r=r.isShadow()?r.previous:null}}outgoingInTheFutureAndPastCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}if(void 0!==r.$outgoingPast)for(const n of r.$outgoingPast.values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}outgoingInTheFutureAndPastTransactionCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestStableEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}if(void 0!==r.$outgoingPast)for(const n of r.$outgoingPast.values()){const r=e.getLatestStableEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}outgoingInTheFutureTransactionCb(e,t){let r=this;for(;r;){for(const n of r.getOutgoing().values()){const r=e.getLatestEntryFor(n.identifier);r&&n.originId===r.originId&&t(n)}r=r.isShadow()?r.previous:null}}}))){},TombStone=Symbol("Tombstone"),__decorate3=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};!function(e){e[e.UserInput=0]="UserInput",e[e.DependsOnlyOnUserInput=1]="DependsOnlyOnUserInput",e[e.DependsOnlyOnDependsOnlyOnUserInput=2]="DependsOnlyOnDependsOnlyOnUserInput",e[e.DependsOnSelfKind=3]="DependsOnSelfKind"}(Levels||(Levels={}));var Meta=class extends Base2{constructor(){super(...arguments),this.name=void 0,this.lazy=!1,this.total=!0,this.pure=!0,this.proposedValueIsBuilt=!1}calculation(e){throw new Error("Abstract method `calculation` called")}equality(e,t){return e===t}};__decorate3([prototypeValue(Levels.DependsOnSelfKind)],Meta.prototype,"level",void 0),__decorate3([prototypeValue(!0)],Meta.prototype,"sync",void 0);var Identifier=class extends Meta{constructor(){super(...arguments),this.context=void 0}newQuark(e){const t=this.quarkClass.new();return t.createdAt=e,t.identifier=this,t.needToBuildProposedValue=this.proposedValueIsBuilt,t}write(e,t,r,n,...i){(r=r||t.getWriteTarget(e)).proposedValue=n,r.proposedArguments=i.length>0?i:void 0,r.proposedIsPrevious=t.graph.isWritingPreviousData}writeToTransaction(e,t,...r){e.write(this,t,...r)}writeToGraph(e,t,...r){e.write(this,t,...r)}readFromGraphAsync(e){return e.readAsync(this)}readFromGraph(e){return e.read(this)}readFromTransaction(e){return e.read(this)}readFromTransactionAsync(e){return e.readAsync(this)}buildProposedValue(e,t,r){}enterGraph(e){}leaveGraph(e){}},IdentifierC=e=>Identifier.new(e),QuarkSync=Quark.mix(CalculationSync.mix(Map)),QuarkGen=Quark.mix(CalculationGen.mix(Map)),Variable=class extends Identifier{calculation(e){throw new Error("永远不会调用变量的“计算”方法。相反，该值将直接设置为夸克")}write(e,t,r,n,...i){(r=r||t.getWriteTarget(e)).value=n,r.proposedArguments=i.length>0?i:void 0}};function VariableC(...e){return Variable.new(...e)}__decorate3([prototypeValue(Levels.UserInput)],Variable.prototype,"level",void 0),__decorate3([prototypeValue(QuarkSync)],Variable.prototype,"quarkClass",void 0);var CalculatedValueSync=class extends Identifier{calculation(e){return e(ProposedOrPrevious)}};function CalculatedValueSyncC(...e){return CalculatedValueSync.new(...e)}__decorate3([prototypeValue(QuarkSync)],CalculatedValueSync.prototype,"quarkClass",void 0);var CalculatedValueGen=class extends Identifier{*calculation(e){return yield ProposedOrPrevious}};function CalculatedValueGenC(...e){return CalculatedValueGen.new(...e)}__decorate3([prototypeValue(QuarkGen)],CalculatedValueGen.prototype,"quarkClass",void 0);var ReadMode,throwUnknownIdentifier=e=>{throw new Error("Unknown identifier "+e)},CLOCK=0,Revision=class extends Base2{constructor(){super(...arguments),this.createdAt=CLOCK++,this.name="revision-"+this.createdAt,this.previous=void 0,this.scope=new Map,this.reachableCount=0,this.referenceCount=0,this.selfDependent=new Set}getLatestEntryFor(e){let t=this;for(;t;){const r=t.scope.get(e);if(r)return r;t=t.previous}return null}hasIdentifier(e){const t=this.getLatestEntryFor(e);return Boolean(t&&t.getValue()!==TombStone)}*previousAxis(){let e=this;for(;e;)yield e,e=e.previous}},LeveledQueue=class{constructor(){this.length=0,this.levels=[],this.lowestLevel=MAX_SMI}getLowestLevel(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++)if(this.levels[e])return this.lowestLevel=e;return this.lowestLevel=MAX_SMI}takeLowestLevel(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(t)return this.length-=t.length,this.levels[e]=null,this.lowestLevel=e+1,t}}pop(){for(let e=this.lowestLevel!==MAX_SMI?this.lowestLevel:0;e<this.levels.length;e++){const t=this.levels[e];if(this.lowestLevel=e,t&&t.length>0)return this.length--,t.pop()}this.lowestLevel=MAX_SMI}push(e){const t=e.level;let r=this.levels[t];if(!r){for(let e=this.levels.length;e<t;e++)this.levels[e]=null;r=this.levels[t]=[]}r.push(e),this.length++,t<this.lowestLevel&&(this.lowestLevel=t)}*[Symbol.iterator](){for(let e=0;e<this.levels.length;e++){const t=this.levels[e];t&&(yield*t)}}},ComputationCycle=class extends Base2{toString(){const e=[],t=[];return this.cycle.forEach((({name:r,context:n})=>{e.push(r),t[t.length-1]!==n&&t.push(n)})),"events:"+t.map((e=>"#"+e.id)).join(" => ")+"\n\nidentifiers: \n"+e.join("\n")}},TransactionCycleDetectionWalkContext=class extends WalkContext{constructor(){super(...arguments),this.transaction=void 0}onCycle(e,t){return OnCycleAction.Cancel}doCollectNext(e,t,r){let n=this.visited.get(t);n||(n={visitedAt:NOT_VISITED,visitEpoch:this.currentEpoch},this.visited.set(t,n)),r.push({node:t,from:e,label:void 0})}collectNext(e,t){const r=this.transaction.getLatestEntryFor(e);r&&r.outgoingInTheFutureTransactionCb(this.transaction,(r=>{this.doCollectNext(e,r.identifier,t)}))}},TransactionWalkDepth=class extends Base2{constructor(){super(...arguments),this.visited=new Map,this.transaction=void 0,this.baseRevision=void 0,this.pushTo=void 0,this.toVisit=[],this.currentEpoch=0}startFrom(e){this.continueFrom(e)}continueFrom(e){this.toVisit.push.apply(this.toVisit,e),this.walkDepth()}startNewEpoch(){if(this.toVisit.length)throw new Error("Can not start new walk epoch in the middle of the walk");this.currentEpoch++}onTopologicalNode(e,t){e.lazy||e.level===Levels.UserInput||this.pushTo.push(t)}onCycle(e,t){return OnCycleAction.Resume}doCollectNext(e,t,r){let n=this.visited.get(t);n||(n=t.newQuark(this.baseRevision),n.visitEpoch=this.currentEpoch,this.visited.set(t,n)),r.push(t)}collectNext(e,t,r){const n=this.baseRevision.getLatestEntryFor(e);n&&(r.previous=n,n.outgoingInTheFutureAndPastTransactionCb(this.transaction,(r=>{this.doCollectNext(e,r.identifier,t)})));for(const n of r.getOutgoing().keys())this.doCollectNext(e,n,t);if(void 0!==r.$outgoingPast)for(const n of r.getOutgoingPast().keys())this.doCollectNext(e,n,t)}walkDepth(){const e=this.visited,t=this.toVisit;let r;for(;r=t.length;){const n=t[r-1];let i=e.get(n);if(i&&i.visitedAt===VISITED_TOPOLOGICALLY&&i.visitEpoch===this.currentEpoch)i.edgesFlow++,t.pop();else if(i&&i.visitEpoch===this.currentEpoch&&i.visitedAt!==NOT_VISITED){if(i.visitedAt<r){if(this.onCycle(n,t)!==OnCycleAction.Resume)break;i.edgesFlow++}else i.visitedAt=VISITED_TOPOLOGICALLY,this.onTopologicalNode(n,i);t.pop()}else{const s=t.length;i||(i=n.newQuark(this.baseRevision),i.visitEpoch=this.currentEpoch,e.set(n,i)),this.collectNext(n,t,i),i.visitEpoch<this.currentEpoch&&i.resetToEpoch(this.currentEpoch),i.visitedAt=r,i.edgesFlow++,t.length===s&&(i.visitedAt=VISITED_TOPOLOGICALLY,this.onTopologicalNode(n,i),t.pop())}}}},EdgeTypeNormal=EdgeType.Normal,EdgeTypePast=EdgeType.Past,Transaction2=class extends Base2{constructor(){super(...arguments),this.baseRevision=void 0,this.candidateClass=Revision,this.candidate=void 0,this.graph=void 0,this.isClosed=!1,this.walkContext=void 0,this.entries=new Map,this.stackGen=new LeveledQueue,this.activeStack=[],this.onEffectSync=void 0,this.onEffectAsync=void 0,this.propagationStartDate=0,this.lastProgressNotificationDate=0,this.startProgressNotificationsAfterMs=500,this.emitProgressNotificationsEveryMs=200,this.emitProgressNotificationsEveryCalculations=100,this.plannedTotalIdentifiersToCalculate=0,this.ongoing=Promise.resolve(),this.selfDependedMarked=!1,this.rejectedWith=void 0,this.stopped=!1,this.hasEntryWithProposedValue=!1,this.hasVariableEntry=!1}initialize(...e){super.initialize(...e),this.walkContext=TransactionWalkDepth.new({visited:this.entries,transaction:this,baseRevision:this.baseRevision,pushTo:this.stackGen}),this.candidate||(this.candidate=this.candidateClass.new({previous:this.baseRevision})),this.onEffectSync=this.read.bind(this),this.onEffectAsync=this.readAsync.bind(this)}get dirty(){return this.entries.size>0}markSelfDependent(){if(!this.selfDependedMarked){this.selfDependedMarked=!0;for(const e of this.baseRevision.selfDependent){const t=this.entries.get(e);t&&t.getValue()===TombStone||this.touch(e)}}}getActiveEntry(){return this.activeStack[this.activeStack.length-1]}yieldAsync(e){return e instanceof Promise?e:this.graph[e.handler](e,this)}yieldSync(e){if(e instanceof Promise)throw new Error("Can not yield a promise in the synchronous context");return this.graph[e.handler](e,this)}readAsync(e){if(!(e instanceof Identifier))return this.yieldAsync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}return t.hasValue()?t.getValue():t.promise?t.promise:(t.previous&&t.previous.hasValue()||t.forceCalculation(),this.ongoing=t.promise=this.ongoing.then((()=>(async()=>{for(;this.stackGen.lowestLevel<e.level;)await runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,this.stackGen.takeLowestLevel()],this);if(this.markSelfDependent(),void 0===t.getValue())return runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})())).then((()=>{if(this.rejectedWith)throw new Error("Transaction rejected: "+String(this.rejectedWith.reason));if(!t.hasValue())throw new Error("Computation cycle. Sync");return t.getValue()})))}get(e){if(!(e instanceof Identifier))return this.yieldSync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}const n=t.getValue();if(n===TombStone&&throwUnknownIdentifier(e),void 0!==n&&t.hasValue())return n;if(t.promise)return t.promise;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());if(this.markSelfDependent(),e.sync){this.calculateTransitionsStackSync(this.onEffectSync,[t]);const r=t.getValue();if(void 0===r)throw new Error("Cycle during synchronous computation");return r===TombStone&&throwUnknownIdentifier(e),r}{const r=this.ongoing=t.promise=this.ongoing.then((()=>{if(void 0===t.getValue())return runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitionsStackGen,[this.onEffectAsync,[t]],this)})).then((()=>{if(this.rejectedWith)throw new Error("Transaction rejected: "+String(this.rejectedWith.reason));const r=t.getValue();if(void 0===r)throw new Error("Computation cycle. Async get");return r===TombStone&&throwUnknownIdentifier(e),r}));return DEBUG&&(r.quark=t),r}}read(e){if(!(e instanceof Identifier))return this.yieldSync(e);let t;const r=this.getActiveEntry();if(r)t=this.addEdge(e,r,EdgeTypeNormal);else if(t=this.entries.get(e),!t){const r=this.baseRevision.getLatestEntryFor(e);r||throwUnknownIdentifier(e),t=r.hasValue()?r:this.touch(e)}const n=t.getValue();if(n===TombStone&&throwUnknownIdentifier(e),void 0!==n)return n;for(t.previous&&t.previous.hasValue()||t.forceCalculation();this.stackGen.getLowestLevel()<e.level;)this.calculateTransitionsStackSync(this.onEffectSync,this.stackGen.takeLowestLevel());this.markSelfDependent(),this.calculateTransitionsStackSync(this.onEffectSync,[t]);const i=t.getValue();if(void 0===i)throw new Error("Cycle during synchronous computation");return i===TombStone&&throwUnknownIdentifier(e),i}readCurrentOrProposedOrPrevious(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(void 0!==e)return e;if(void 0!==t.proposedValue)return t.proposedValue}return this.readPrevious(e)}readCurrentOrProposedOrPreviousAsync(e){const t=this.entries.get(e);if(t){const e=t.getValue();if(void 0!==e)return e;if(void 0!==t.proposedValue)return t.proposedValue}return this.readPreviousAsync(e)}readPrevious(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const r=t.getValue();return r!==TombStone?void 0===r&&e.lazy?this.read(e):r:void 0}readPreviousAsync(e){const t=this.baseRevision.getLatestEntryFor(e);if(!t)return;const r=t.getValue();return r!==TombStone?void 0!==r?r:this.readAsync(e):void 0}readProposedOrPrevious(e){const t=this.entries.get(e);return t&&void 0!==t.proposedValue?t.proposedValue:this.readPrevious(e)}readProposedOrPreviousAsync(e){const t=this.entries.get(e);return t&&void 0!==t.proposedValue?t.proposedValue:this.readPreviousAsync(e)}write(e,t,...r){void 0===t&&(t=null),e.write.call(e.context||e,e,this,null,t,...r);const n=this.entries.get(e);this.hasVariableEntry=this.hasVariableEntry||!n.isShadow()&&e.level===Levels.UserInput,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||n.hasProposedValue()}getWriteTarget(e){return this.touch(e).startOrigin()}acquireQuarkIfExists(e){const t=this.entries.get(e);return t&&t.origin===t?t.origin:void 0}touch(e){const t=this.entries.get(e);(!t||t.visitEpoch<this.walkContext.currentEpoch)&&this.walkContext.continueFrom([e]);const r=t||this.entries.get(e);return r.forceCalculation(),r}hasIdentifier(e){const t=this.entries.get(e);return(!t||t.getValue()!==TombStone)&&Boolean(t||this.baseRevision.getLatestEntryFor(e))}addIdentifier(e,t,...r){let n=this.entries.get(e);const i=e.level===Levels.UserInput;return n||(n=e.newQuark(this.baseRevision),n.previous=this.baseRevision.getLatestEntryFor(e),n.forceCalculation(),this.entries.set(e,n),e.lazy||i||this.stackGen.push(n),this.hasVariableEntry=this.hasVariableEntry||!n.isShadow()&&i,this.hasEntryWithProposedValue=this.hasEntryWithProposedValue||n.hasProposedValue()),(void 0!==t||i)&&(n.startOrigin(),e.write.call(e.context||e,e,this,n,void 0===t&&i?null:t,...r)),n.getValue()===TombStone&&(n.value=void 0),n.proposedValue===TombStone&&(n.proposedValue=void 0),e.enterGraph(this.graph),n}removeIdentifier(e){e.leaveGraph(this.graph);this.touch(e).startOrigin().setValue(TombStone),this.candidate.selfDependent.delete(e)}populateCandidateScopeFromTransitions(e,t){if(0===e.scope.size)e.scope=t;else for(const[r,n]of t)if(n.isShadow()){const t=e.getLatestEntryFor(r);n.getOutgoing().forEach(((e,r)=>t.getOutgoing().set(r,e)))}else e.scope.set(r,n)}preCommit(e){if(this.isClosed)throw new Error("Can not propagate closed revision");this.markSelfDependent(),this.isClosed=!0,this.propagationStartDate=Date.now(),this.plannedTotalIdentifiersToCalculate=this.stackGen.length}postCommit(){this.populateCandidateScopeFromTransitions(this.candidate,this.entries);const e=this.entries;return this.walkContext=void 0,{revision:this.candidate,entries:e,transaction:this}}commit(e){return this.preCommit(e),this.calculateTransitionsSync(this.onEffectSync),this.postCommit()}reject(e=RejectEffect.new()){this.rejectedWith=e,this.walkContext=void 0}stop(){this.stopped=!0}clearRejected(){for(const e of this.entries.values())e.cleanup();this.entries.clear()}async commitAsync(e){return this.preCommit(e),this.ongoing=this.ongoing.then((()=>runGeneratorAsyncWithEffect(this.onEffectAsync,this.calculateTransitions,[this.onEffectAsync],this))).then((()=>this.postCommit()))}getLatestEntryFor(e){let t=this.entries.get(e)||this.baseRevision.getLatestEntryFor(e);if(!t||t.getValue()!==TombStone)return t}getLatestStableEntryFor(e){let t=this.entries.get(e);if(t){const r=t.getValue();if(r===TombStone)return;return void 0===r?this.baseRevision.getLatestEntryFor(e):t}return this.baseRevision.getLatestEntryFor(e)}addEdge(e,t,r){if(t.identifier.level<e.level)throw new Error("Identifier can not read from higher level identifier");let n=this.entries.get(e);if(!n){const t=this.baseRevision.getLatestEntryFor(e);t||throwUnknownIdentifier(e),n=e.newQuark(this.baseRevision),n.setOrigin(t),n.previous=t,this.entries.set(e,n)}return n.addOutgoingTo(t,r),n}onQuarkCalculationCompleted(e,t){e.cleanup();const r=e.identifier,n=e.previous,i=Boolean(n&&n.hasValue()&&r.equality(t,n.getValue()));i?(n.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=this.entries.get(e.identifier);t&&t.edgesFlow--})),e.edgesFlow=MAX_SMI,e.setOrigin(n.origin),e.value=t):(e.startOrigin(),e.setValue(t));let s=!1;e.usedProposedOrPrevious&&(void 0!==e.proposedValue?r.equality(t,e.proposedValue)&&(s=!0):(i||!n&&null===t)&&(s=!0),s||this.candidate.selfDependent.add(r))}onReadIdentifier(e,t,r){const n=this.addEdge(e,t,EdgeTypeNormal);if(n.hasValue()||void 0!==n.value){const r=n.getValue();return r===TombStone&&throwUnknownIdentifier(e),t.continueCalculation(r)}if(n.isShadow())return n.startOrigin(),n.forceCalculation(),void r.push(n);if(n.isCalculationStarted()){let e;return TransactionCycleDetectionWalkContext.new({transaction:this,onCycle:(r,i)=>(e=ComputationCycle.new({cycle:cycleInfo(i),requestedEntry:n,activeEntry:t}),OnCycleAction.Cancel)}).startFrom([n.identifier]),e}return r.push(n),void(n.previous&&n.previous.hasValue()||n.forceCalculation())}*calculateTransitions(e){const t=this.stackGen;for(;t.length;)yield*this.calculateTransitionsStackGen(e,t.takeLowestLevel())}calculateTransitionsSync(e){const t=this.stackGen;for(;t.length;)this.calculateTransitionsStackSync(e,t.takeLowestLevel())}*calculateTransitionsStackGen(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const r=this.entries,n=this.propagationStartDate,i=!!this.graph&&this.graph.enableProgressNotifications;let s=0;const a=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){if(i&&!(s++%this.emitProgressNotificationsEveryCalculations)){const e=Date.now();if(e-n>this.startProgressNotificationsAfterMs){const r=this.lastProgressNotificationDate;(!r||e-r>this.emitProgressNotificationsEveryMs)&&(this.lastProgressNotificationDate=e,this.graph.onPropagationProgressNotification({total:this.plannedTotalIdentifiersToCalculate,remaining:this.stackGen.length+t.length,phase:"propagating"}),this.activeStack=a,yield delay2(0),this.activeStack=t)}}if(this.rejectedWith||this.stopped)break;const e=t[t.length-1],o=e.identifier;if(r.get(o)!==e){e.cleanup(),t.pop();continue}if(0==e.edgesFlow){e.edgesFlow--;const t=e.previous;t&&t.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=r.get(e.identifier);t&&t.edgesFlow--}))}if(e.edgesFlow<0&&e.previous&&e.previous.origin){e.setOrigin(e.previous.origin),0===e.size&&r.delete(o),e.cleanup(),t.pop();continue}if(e.hasValue()||e.proposedValue===TombStone){e.cleanup(),t.pop();continue}const l=e.visitEpoch;let c=e.isCalculationStarted()?e.iterationResult:e.startCalculation(this.onEffectSync);for(;c&&!this.rejectedWith&&!this.stopped;){const r=void 0===c.value?null:c.value;if(e.isCalculationCompleted()){e.visitEpoch==l&&this.onQuarkCalculationCompleted(e,r),t.pop();break}if(r instanceof Identifier){const n=this.onReadIdentifier(r,e,t);n instanceof ComputationCycle?(this.walkContext.startNewEpoch(),yield*this.graph.onComputationCycleHandler(n),e.cleanupCalculation(),c=void 0):c=n}else{if(r===SynchronousCalculationStarted){t.pop();break}{const n=yield r;if(n===BreakCurrentStackExecution)break;if(e.visitEpoch!==l){t.pop();break}c=e.continueCalculation(n)}}}}this.activeStack=a}calculateTransitionsStackSync(e,t){if(this.rejectedWith||this.stopped)return;this.walkContext.startNewEpoch();const r=this.entries,n=this.activeStack;for(this.activeStack=t;t.length&&!this.rejectedWith&&!this.stopped;){const n=t[t.length-1],i=n.identifier;if(r.get(i)!==n){n.cleanup(),t.pop();continue}if(0==n.edgesFlow){n.edgesFlow--;const e=n.previous;e&&e.outgoingInTheFutureAndPastTransactionCb(this,(e=>{const t=r.get(e.identifier);t&&t.edgesFlow--}))}if(n.edgesFlow<0&&n.previous&&n.previous.origin){n.setOrigin(n.previous.origin),0===n.size&&r.delete(i),n.cleanup(),t.pop();continue}if(n.hasValue()||n.proposedValue===TombStone){n.cleanup(),t.pop();continue}const s=n.visitEpoch;let a=n.isCalculationStarted()?n.iterationResult:n.startCalculation(this.onEffectSync);for(;a&&!this.rejectedWith&&!this.stopped;){const r=void 0===a.value?null:a.value;if(n.isCalculationCompleted()){n.visitEpoch==s&&this.onQuarkCalculationCompleted(n,r),t.pop();break}if(r instanceof Identifier){const e=this.onReadIdentifier(r,n,t);e instanceof ComputationCycle?(this.walkContext.startNewEpoch(),this.graph.onComputationCycleHandlerSync(e),n.cleanupCalculation(),a=void 0):a=e}else{if(r===SynchronousCalculationStarted){t.pop();break}{const i=e(r);if(i instanceof Promise)throw new Error("在同步上下文中解析为promise的效果，检查是否相应地标记了异步计算");if(i===BreakCurrentStackExecution)break;if(n.visitEpoch!==s){t.pop();break}a=n.continueCalculation(i)}}}}this.activeStack=n}},CommitZero={rejectedWith:null},Listener=class extends Base2{constructor(){super(...arguments),this.handlers=[]}trigger(e){for(let t=0;t<this.handlers.length;t++)this.handlers[t](e)}},ChronoGraph=class extends Base2{constructor(){super(...arguments),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.baseRevision=Revision.new(),this.topRevision=void 0,this.historyLimit=0,this.listeners=new Map,this.isWritingPreviousData=!1,this.$activeTransaction=void 0,this.isCommitting=!1,this.enableProgressNotifications=!1,this.ongoing=Promise.resolve(),this._isInitialCommit=!0,this.autoCommitTimeoutId=null,this.autoCommit=!1,this.autoCommitMode="sync",this.autoCommitHandler=null,this.onWriteDuringCommit="throw",this.onComputationCycle="throw",this.transactionClass=Transaction2,this.$followingRevision=void 0}initialize(...e){super.initialize(...e),this.topRevision||(this.topRevision=this.baseRevision),this.autoCommit&&(this.autoCommitHandler="sync"===this.autoCommitMode?e=>this.commit(e):async e=>{this.commitAsync(e)}),this.markAndSweep()}hasPendingAutoCommit(){return null!==this.autoCommitTimeoutId}get dirty(){return this.activeTransaction.dirty}clear(){this.reject(),this.unScheduleAutoCommit(),this.baseRevision.scope&&this.baseRevision.scope.clear(),this.baseRevision.previous=null,this.listeners.clear(),this.topRevision=this.baseRevision,this.$followingRevision=void 0,this.$activeTransaction=void 0,this.markAndSweep()}*eachReachableRevision(){let e=!0,t=0;for(const r of this.topRevision.previousAxis())yield[r,e||t<this.historyLimit],r===this.baseRevision?e=!1:e||t++}get isInitialCommit(){return this._isInitialCommit}set isInitialCommit(e){this._isInitialCommit=e}markAndSweep(){let e;const t=[];for(const[r,n]of this.eachReachableRevision())n?(r.reachableCount++,e=r):t.push(r),r.referenceCount++;t.unshift(e);for(let e=t.length-1;e>=1&&0===t[e].reachableCount;e--)this.compactRevisions(t[e-1],t[e])}compactRevisions(e,t){if(t.reachableCount>0||e.previous!==t)throw new Error("Invalid compact operation");if(t.referenceCount<=1){for(const[r,n]of e.scope)if(n.getValue()===TombStone)t.scope.delete(r);else{const i=t.scope.get(r);n.origin===n?i&&(i.clear(),i.clearProperties()):i&&n.origin===i?n.mergePreviousOrigin(e.scope):r.lazy&&!n.origin&&i&&i.origin&&(n.startOrigin().proposedValue=void 0!==i.origin.value?i.origin.value:i.origin.proposedValue),n.previous=void 0,t.scope.set(r,n)}copySetInto(e.selfDependent,t.selfDependent),e.scope=t.scope,t.scope=null}else e.scope=new Map(concat(t.scope,e.scope)),e.selfDependent=new Set(concat(t.selfDependent,e.selfDependent)),t.referenceCount--;e.previous=null}get followingRevision(){if(void 0!==this.$followingRevision)return this.$followingRevision;const e=Array.from(this.topRevision.previousAxis()),t=[];for(let r=e.length-1;r>0;r--)t.push([e[r],e[r-1]]);return this.$followingRevision=new Map(t)}get activeTransaction(){return this.$activeTransaction?this.$activeTransaction:this.$activeTransaction=this.transactionClass.new({baseRevision:this.baseRevisionTentative||this.baseRevision,graph:this})}branch(e){return this.constructor.new(Object.assign({},e,{baseRevision:this.baseRevision}))}propagate(e){return this.commit(e)}reject(e){this.activeTransaction.reject(RejectEffect.new({reason:e})),this.ongoing=Promise.resolve(),this.$activeTransaction=void 0,this.baseRevisionTentative=void 0,this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable,this.baseRevisionStable=void 0)}commit(e){this.unScheduleAutoCommit(),this.baseRevisionStable=this.baseRevision;const t=this.activeTransaction.commit(e);this.$activeTransaction=void 0;const r=this.finalizeCommit(t);return this.baseRevisionStable=void 0,this.isInitialCommit=!1,r}async propagateAsync(e){return this.commitAsync(e)}async commitAsync(e){if(this.isCommitting)return this.ongoing;let t;return this.isCommitting=!0,this.baseRevisionStable=this.baseRevision,this.ongoing=this.ongoing.then((()=>this.doCommitAsync(e))).then((e=>(t=e,e))).finally((()=>{this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0,this.isInitialCommit=!1,this.isCommitting=!1}))}async doCommitAsync(e){this.unScheduleAutoCommit();const t=this.activeTransaction,r=await t.commitAsync(e),n=Boolean(t.rejectedWith),i=this.baseRevisionTentative;n||(this.baseRevisionTentative=t.candidate),this.$activeTransaction=void 0,await this.finalizeCommitAsync(r),t.rejectedWith&&!n&&(this.baseRevisionTentative=i,this.$activeTransaction=void 0);const s=this.finalizeCommit(r);return t.rejectedWith&&t.clearRejected(),this.dirty&&!t.rejectedWith&&await this.doCommitAsync(e),s}finalizeCommit(e){const{revision:t,entries:r,transaction:n}=e;if(n.rejectedWith)this.baseRevisionStable&&(this.baseRevision=this.baseRevisionStable),this.baseRevisionStable=void 0,this.baseRevisionTentative=void 0;else{if(t.previous!==this.baseRevision)throw new Error("Invalid revisions chain");for(const[e,t]of this.eachReachableRevision())t&&e.reachableCount--,e.referenceCount--;this.baseRevision=this.topRevision=t;for(const[e,t]of r){if(t.cleanup(),t.isShadow()||!t.hasValue())continue;const r=this.listeners.get(e);r&&r.trigger(t.getValue())}this.$followingRevision=void 0,this.markAndSweep()}return{rejectedWith:n.rejectedWith}}async finalizeCommitAsync(e){}*onComputationCycleHandler(e){const t=new Error("计算周期:"+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:r,activeEntry:n}=e;return n.continueCalculation(void 0!==r.proposedValue?r.proposedValue:r.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":warn(t)}}onComputationCycleHandlerSync(e){const t=new Error("Computation cycle:\n"+e);switch(t.cycle=e,this.onComputationCycle){case"ignore":console.log(t.message);const{requestedEntry:r,activeEntry:n}=e;return n.continueCalculation(void 0!==r.proposedValue?r.proposedValue:r.value);case"throw":throw t;case"reject":this.reject(t);break;case"warn":warn(t)}}scheduleAutoCommit(){null!==this.autoCommitTimeoutId||this.isCommitting||(this.autoCommitTimeoutId=setTimeout(this.autoCommitHandler,10))}unScheduleAutoCommit(){null!==this.autoCommitTimeoutId&&(clearTimeout(this.autoCommitTimeoutId),this.autoCommitTimeoutId=null)}variable(e){const t=VariableC();return this.addIdentifier(t,void 0===e?null:e)}variableNamed(e,t){const r=VariableC({name:e});return this.addIdentifier(r,void 0===t?null:t)}identifier(e,t){const r=isGeneratorFunction(e)?CalculatedValueGenC({calculation:e,context:t}):CalculatedValueSyncC({calculation:e,context:t});return this.addIdentifier(r)}identifierNamed(e,t,r){const n="GeneratorFunction"===t.constructor.name?CalculatedValueGenC({name:e,calculation:t,context:r}):CalculatedValueSyncC({name:e,calculation:t,context:r});return this.addIdentifier(n)}addIdentifier(e,t,...r){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Adding identifier during commit");"warn"===this.onWriteDuringCommit&&warn(new Error("Adding identifier during commit"))}return this.activeTransaction.addIdentifier(e,t,...r),this.autoCommit&&this.scheduleAutoCommit(),e}removeIdentifier(e){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Removing identifier during commit");"warn"===this.onWriteDuringCommit&&warn(new Error("Removinfg identifier during commit"))}this.activeTransaction.removeIdentifier(e),this.listeners.delete(e),this.autoCommit&&this.scheduleAutoCommit()}hasIdentifier(e){return this.activeTransaction.hasIdentifier(e)}write(e,t,...r){if(this.isCommitting){if("throw"===this.onWriteDuringCommit)throw new Error("Write during commit");"warn"===this.onWriteDuringCommit&&warn(new Error("Write during commit"))}this.activeTransaction.write(e,t,...r),this.autoCommit&&this.scheduleAutoCommit()}readPrevious(e){return this.activeTransaction.readPrevious(e)}readPreviousAsync(e){return this.activeTransaction.readPreviousAsync(e)}read(e){return this.activeTransaction.read(e)}readAsync(e){return this.activeTransaction.readAsync(e)}get(e){return this.activeTransaction.get(e)}observe(e,t){const r=this.addIdentifier(CalculatedValueGen.new({lazy:!1,calculation:e}));return this.addListener(r,t),r}observeContext(e,t,r){const n=this.addIdentifier(CalculatedValueGen.new({lazy:!1,calculation:e,context:t}));return this.addListener(n,r),n}addListener(e,t){let r=this.listeners.get(e);r||(r=Listener.new(),this.listeners.set(e,r)),r.handlers.push(t)}undo(){const e=this.baseRevision.previous;return!!e&&(this.baseRevision=e,this.$activeTransaction=void 0,!0)}redo(){const e=this.baseRevision;if(e===this.topRevision)return!1;const t=this.followingRevision.get(e);return this.baseRevision=t,this.$activeTransaction=void 0,!0}onPropagationProgressNotification(e){}[ProposedOrPreviousSymbol](e,t){const r=t.getActiveEntry();r.usedProposedOrPrevious=!0;const n=r.getProposedValue(t);if(void 0!==n)return n;if(!r.previous)return;return r.identifier.lazy?r.previous.hasValue()?r.previous.getValue():r.previous.hasProposedValue()?r.previous.getProposedValue(t):null:t.readPrevious(r.identifier)}[RejectSymbol](e,t){return this.reject(e.reason),BreakCurrentStackExecution}[TransactionSymbol](e,t){return t}[OwnQuarkSymbol](e,t){return t.getActiveEntry()}[OwnIdentifierSymbol](e,t){return t.getActiveEntry().identifier}[WriteSymbol](e,t){const r=t.getActiveEntry();if(r.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");const n=e.identifier.level>r.identifier.level;return n||t.walkContext.startNewEpoch(),t.write(e.identifier,...e.proposedArgs),n?void 0:BreakCurrentStackExecution}[WriteSeveralSymbol](e,t){const r=t.getActiveEntry();if(r.identifier.lazy)throw new Error("Lazy identifiers can not use `Write` effect");let n=!0;return e.writes.forEach((e=>{e.identifier.level<=r.identifier.level&&n&&(t.walkContext.startNewEpoch(),n=!1),t.write(e.identifier,...e.proposedArgs)})),n?void 0:BreakCurrentStackExecution}[PreviousValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;return t.addEdge(n,r,EdgeTypePast),t.readPrevious(n)}[ProposedValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return i&&!i.isShadow()?i.getProposedValue(t):void 0}[HasProposedValueSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return!!i&&i.hasProposedValue()}[HasProposedNotPreviousValueSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return!!i&&(i.hasProposedValue()&&!i.proposedIsPrevious)}[ProposedOrPreviousValueOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;return t.addEdge(n,r,EdgeTypePast),t.readProposedOrPrevious(n)}[UnsafeProposedOrPreviousValueOfSymbol](e,t){return t.readProposedOrPrevious(e.identifier)}[UnsafePreviousValueOfSymbol](e,t){return t.readPrevious(e.identifier)}[ProposedArgumentsOfSymbol](e,t){const r=t.getActiveEntry(),n=e.identifier;t.addEdge(n,r,EdgeTypePast);const i=t.entries.get(n);return i&&!i.isShadow()?i.proposedArguments:void 0}},EntityMeta=class extends Base2{constructor(){super(...arguments),this.name=void 0,this.ownFields=new Map,this.schema=void 0,this.$skeleton={},this.$allFields=void 0}hasField(e){return void 0!==this.getField(e)}getField(e){return this.allFields.get(e)}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.ownFields.has(t))throw new Error("Field with name ["+t+"] already exists");return e.entity=this,this.ownFields.set(t,e),e}forEachParent(e){let t=this;for(;t;)e(t),t=t.parentEntity}get allFields(){if(void 0!==this.$allFields)return this.$allFields;const e=new Map,t=new Set;return this.forEachParent((r=>{r.ownFields.forEach(((r,n)=>{t.has(n)||(t.add(n),e.set(n,r))}))})),this.$allFields=e}forEachField(e){this.allFields.forEach(e)}};!function(e){e[e.Current=0]="Current",e[e.Previous=1]="Previous",e[e.ProposedOrPrevious=2]="ProposedOrPrevious",e[e.CurrentOrProposedOrPrevious=3]="CurrentOrProposedOrPrevious"}(ReadMode||(ReadMode={}));var BucketMutationType,Replica=class extends(Mixin([ChronoGraph],(e=>class extends e{constructor(){super(...arguments),this.autoCommit=!0,this.readMode=ReadMode.Current}addEntity(e){e.enterGraph(this)}addEntities(e){e.forEach((e=>this.addEntity(e)))}removeEntity(e){e.leaveGraph(this)}removeEntities(e){e.forEach((e=>this.removeEntity(e)))}}))){},FieldIdentifier=class extends(Mixin([Identifier],(e=>class extends e{constructor(){super(...arguments),this.field=void 0,this.self=void 0,this.DATA=void 0}getFromGraph(e){return e?e.readMode===ReadMode.Current?e.get(this):e.readMode===ReadMode.Previous?e.activeTransaction.readPrevious(this):(e.readMode===ReadMode.ProposedOrPrevious&&e.activeTransaction.readProposedOrPrevious(this),e.activeTransaction.readCurrentOrProposedOrPrevious(this)):this.DATA}readFromGraph(e){return e?e.read(this):this.DATA}writeToGraph(e,t,...r){e?e.write(this,t,...r):this.DATA=t}leaveGraph(e){const t=e.activeTransaction.getLatestStableEntryFor(this);t&&(this.DATA=t.getValue()),super.leaveGraph(e)}toString(){return this.name}}))){},MinimalFieldIdentifierSync=class extends(FieldIdentifier.mix(CalculatedValueSync)){},MinimalFieldIdentifierGen=class extends(FieldIdentifier.mix(CalculatedValueGen)){},MinimalFieldVariable=class extends(FieldIdentifier.mix(Variable)){},EntityIdentifier=class extends(Mixin([Identifier],(e=>class extends e{constructor(){super(...arguments),this.entity=void 0,this.self=void 0}equality(){return!1}toString(){return"Entity identifier ["+this.self+"]"}}))){},MinimalEntityIdentifier=class extends(EntityIdentifier.mix(CalculatedValueGen)){},Field2=class extends Meta{constructor(){super(...arguments),this.persistent=!0}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?isGeneratorFunction(e)?MinimalFieldIdentifierGen:MinimalFieldIdentifierSync:MinimalFieldVariable}},isEntityMarker=Symbol("isEntity"),Entity=class extends(Mixin([],(e=>{return class extends e{[isEntityMarker](){}get $entity(){return createEntityOnPrototype(this.constructor.prototype)}get $(){const e={};if(this.$entity.forEachField(((t,r)=>{e[r]=this.createFieldIdentifier(t)})),DEBUG){const t=new Proxy(e,{get:(e,t,r)=>(e[t]||debug(new Error("Attempt to read a missing field "+String(t)+" on "+e)),e[t].SOURCE_POINT=SourceLinePoint.fromThisCall(),e[t])});return defineProperty9(this,"$",t)}return defineProperty9(this,"$",e)}get $$(){return defineProperty9(this,"$$",MinimalEntityIdentifier.new({name:this.$entityName,entity:this.$entity,calculation:this.calculateSelf,context:this,self:this}))}get $entityName(){return this.constructor.name||this.$entity.name}*calculateSelf(){return this}createFieldIdentifier(e){const t=e.name,r=this.$entity,n=this.constructor,i=r.$skeleton;i[t]||(i[t]=n.getIdentifierTemplateClass(this,e));const s=new i[t];return s.context=this,s.self=this,s.name=this.$$.name+".$."+e.name,s}forEachFieldIdentifier(e){this.$entity.forEachField(((t,r)=>e(this.$[r],r)))}enterGraph(e){if(this.graph)throw new Error("Already entered replica");this.graph=e,e.addIdentifier(this.$$),this.$entity.forEachField(((t,r)=>{const n=this.$[r];e.addIdentifier(n,n.DATA),n.DATA=void 0}))}leaveGraph(e){const t=this.graph,r=e||t;r&&(this.$entity.forEachField(((e,t)=>r.removeIdentifier(this.$[t]))),r.removeIdentifier(this.$$),r===t&&(this.graph=void 0))}propagate(e){return this.commit(e)}commit(e){const t=this.graph;return t?t.commit(e):CommitZero}async propagateAsync(){return this.commitAsync()}async commitAsync(e){const t=this.graph;return t?t.commitAsync(e):Promise.resolve(CommitZero)}static get $entity(){return ensureEntityOnPrototype(this.prototype)}static getIdentifierTemplateClass(e,t){const r=t.name,n={name:e.$$.name+".$."+r,field:t};t.hasOwnProperty("sync")&&(n.sync=t.sync),t.hasOwnProperty("lazy")&&(n.lazy=t.lazy),t.hasOwnProperty("equality")&&(n.equality=t.equality);const i=e.$calculations&&e[e.$calculations[r]];i&&(n.calculation=i);const s=e.$writes&&e[e.$writes[r]];s&&(n.write=s);const a=e.$buildProposed&&e[e.$buildProposed[r]];a&&(n.buildProposedValue=a,n.proposedValueIsBuilt=!0);const o=t.getIdentifierClass(i).new(n),l=function(){};return l.prototype=o,l}run(e,...t){const r=this.graph.activeTransaction,n=r.activeStack;r.activeStack=[];const i=runGeneratorSyncWithEffect((e=>{if(e instanceof Identifier)return this.graph.read(e);throw new Error("Helper methods can not yield effects during computation")}),this[e],t,this);return r.activeStack=n,i}static createPropertyAccessorsFor(e){const t=e,r=this.prototype;Object.defineProperty(r,t,{get:function(){return this.$[t].getFromGraph(this.graph)},set:function(e){this.$[t].writeToGraph(this.graph,e)}})}static createMethodAccessorsFor(e){const t=e,r=this.prototype,n="get"+uppercaseFirst(t),i="set"+uppercaseFirst(t),s="put"+uppercaseFirst(t);n in r||(r[n]=function(){return this.$[t].getFromGraph(this.graph)}),i in r||(r[i]=function(e,...r){return this.$[t].writeToGraph(this.graph,e,...r),this.graph?"sync"===this.graph.autoCommitMode?this.graph.commit():this.graph.commitAsync():Promise.resolve(CommitZero)}),s in r||(r[s]=function(e,...r){this.$[t].writeToGraph(this.graph,e,...r)})}}}))){},createEntityOnPrototype=e=>{let t=Object.getPrototypeOf(e);return defineProperty9(e,"$entity",EntityMeta.new({parentEntity:t.hasOwnProperty(isEntityMarker)?null:t.$entity,name:e.constructor.name}))},ensureEntityOnPrototype=e=>(e.hasOwnProperty("$entity")||createEntityOnPrototype(e),e.$entity),generic_field=(e,t=Field2)=>function(r,n){ensureEntityOnPrototype(r).addField(t.new(Object.assign(e||{},{name:n})));const i=r.constructor;i.createPropertyAccessorsFor(n),i.createMethodAccessorsFor(n)},field=generic_field,calculate=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$calculations?t.hasOwnProperty("$calculations")?t.$calculations:t.$calculations=Object.create(t.$calculations):t.$calculations={},i[e]=r}},write=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$writes?t.hasOwnProperty("$writes")?t.$writes:t.$writes=Object.create(t.$writes):t.$writes={},i[e]=r}},build_proposed=function(e){return function(t,r,n){let i;ensureEntityOnPrototype(t),i=t.$buildProposed?t.hasOwnProperty("$buildProposed")?t.$buildProposed:t.$buildProposed=Object.create(t.$buildProposed):t.$buildProposed={},i[e]=r}},__decorate4=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ReferenceField=class extends(Mixin([Field2],(e=>class extends e{constructor(){super(...arguments),this.identifierCls=MinimalReferenceIdentifier}}))){},reference=(e,t=ReferenceField)=>generic_field(e,t),ReferenceIdentifier=class extends(Mixin([FieldIdentifier],(e=>{class t extends e{constructor(){super(...arguments),this.field=void 0,this.proposedValueIsBuilt=!0}hasBucket(){return Boolean(this.field.bucket)}getBucket(e){return e.$[this.field.bucket]}buildProposedValue(e,t,r){const n=t.proposedValue;if(null===n)return null;const i=isInstanceOf(n,Entity)?n:e.resolve(n);return i&&e.hasBucket()&&e.getBucket(i).addToBucket(r,e.self),i}resolve(e){const t=this.field.resolver;return t?t.call(this.self,e):null}enterGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof Entity&&this.getBucket(t).addToBucket(e.activeTransaction,this.self)}super.enterGraph(e)}leaveGraph(e){if(this.hasBucket()){const t=e.activeTransaction.readProposedOrPrevious(this);t instanceof Entity&&this.getBucket(t).removeFromBucket(e.activeTransaction,this.self)}super.leaveGraph(e)}write(e,t,r,n,...i){const s=r||t.acquireQuarkIfExists(e);if(e.hasBucket())if(s){const r=s.getValue();r instanceof Entity&&e.getBucket(r).removeFromBucket(t,e.self)}else if(t.baseRevision.hasIdentifier(e)){const r=t.readPrevious(e);r instanceof Entity&&e.getBucket(r).removeFromBucket(t,e.self)}super.write(e,t,r,n)}}return __decorate4([prototypeValue(Levels.DependsOnlyOnUserInput)],t.prototype,"level",void 0),__decorate4([prototypeValue(QuarkSync)],t.prototype,"quarkClass",void 0),t}))){},MinimalReferenceIdentifier=class extends(ReferenceIdentifier.mix(FieldIdentifier.mix(CalculatedValueSync))){},__decorate5=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ReferenceBucketField=class extends(Mixin([Field2],(e=>class extends e{constructor(){super(...arguments),this.persistent=!1,this.identifierCls=MinimalReferenceBucketIdentifier}}))){},bucket=(e,t=ReferenceBucketField)=>generic_field(e,t);!function(e){e.Add="Add",e.Remove="Remove"}(BucketMutationType||(BucketMutationType={}));var ReferenceBucketQuark=class extends(Mixin([Quark],(e=>class extends e{constructor(){super(...arguments),this.mutations=[],this.previousValue=void 0}hasProposedValueInner(){return this.mutations.length>0}}))){},MinimalReferenceBucketQuark=ReferenceBucketQuark.mix(QuarkSync),ReferenceBucketIdentifier=class extends(Mixin([FieldIdentifier],(e=>{class t extends e{constructor(){super(...arguments),this.proposedValueIsBuilt=!0}addToBucket(e,t){const r=e.getWriteTarget(this);r.mutations.push({type:BucketMutationType.Add,entity:t});const n=e.baseRevision;!r.previousValue&&n.hasIdentifier(this)&&(r.previousValue=e.readPrevious(this))}removeFromBucket(e,t){const r=e.entries.get(this);if(r&&r.getValue()===TombStone)return;const n=e.getWriteTarget(this);n.mutations.push({type:BucketMutationType.Remove,entity:t});const i=e.baseRevision;!n.previousValue&&i.hasIdentifier(this)&&(n.previousValue=e.readPrevious(this))}buildProposedValue(e,t,r){const n=t,i=new Set(n.previousValue);for(let e=0;e<n.mutations.length;e++){const{type:t,entity:r}=n.mutations[e];t===BucketMutationType.Remove?i.delete(r):t===BucketMutationType.Add&&i.add(r)}return i}leaveGraph(e){super.leaveGraph(e),this.DATA=void 0}}return __decorate5([prototypeValue(Levels.DependsOnlyOnDependsOnlyOnUserInput)],t.prototype,"level",void 0),__decorate5([prototypeValue(MinimalReferenceBucketQuark)],t.prototype,"quarkClass",void 0),t}))){},MinimalReferenceBucketIdentifier=class extends(ReferenceBucketIdentifier.mix(FieldIdentifier.mix(CalculatedValueSync))){},Schema=class extends Base2{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error("Entity with name ["+String(t)+"] already exists");return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=entityDecoratorBody(e);return this.addEntity(t),e}}},entityDecoratorBody=e=>{if(!e.name)throw new Error("Can't add entity - the target class has no name");return ensureEntityOnPrototype(e.prototype)},entity=()=>e=>(entityDecoratorBody(e),e),__decorate6=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},isSerializableEqual=function(e,t){return e===t||((null==t?void 0:t.isBase)?this.serialize(t):t)===((null==e?void 0:e.isBase)?this.serialize(e):e)},ModelField=class extends Field2{constructor(){super(...arguments),this.modelFieldConfig={}}getIdentifierClass(e){return this.identifierCls?this.identifierCls:e?isGeneratorFunction(e)?MinimalChronoModelFieldIdentifierGen:MinimalChronoModelFieldIdentifierSync:MinimalChronoModelFieldVariable}},ModelReferenceField=class extends(ReferenceField.mix(ModelField)){constructor(){super(...arguments),this.identifierCls=ChronoModelReferenceFieldIdentifier}},ModelBucketField=class extends(ReferenceBucketField.mix(Field2)){constructor(){super(...arguments),this.identifierCls=ChronoModelReferenceBucketFieldIdentifier}},IsChronoModelSymbol=Symbol("IsChronoModelSymbol"),ChronoModelFieldIdentifier=class extends(Mixin([FieldIdentifier],(e=>{const t=e.prototype;class r extends e{[IsChronoModelSymbol](){}getFromGraph(e){var r,n;if(e){if(e.readMode===ReadMode.CurrentOrProposedOrPrevious){const t=e.isCommitting&&this.level>(null!=(n=null==(r=e.activeTransaction.getActiveEntry())?void 0:r.level)?n:Number.MAX_SAFE_INTEGER);return!this.sync||this.context.project.isDelayingCalculation||t?e.activeTransaction.readCurrentOrProposedOrPrevious(this):e.get(this)}return t.getFromGraph.call(this,e)}return this.DATA}writeToGraph(e,r,...n){e?t.writeToGraph.call(this,e,r,...n):(this.DATA=r,this.self.inSetting||this.self.isConstructing||this.self.set(this.field.name,r,!1,!1,!0))}write(e,r,n,i,...s){i=e.convert(i),t.write.call(this,e,r,n,i,...s)}convert(e){const t=this.field,r=this.self.getFieldDefinition(t.name);return(null==r?void 0:r.convert)?e=r.convert(e,this.context.data,this.context):t.converter&&(e=t.converter(e,t)),e}equality(e,t){return e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e===t}}return __decorate6([prototypeValue(!1)],r.prototype,"sync",void 0),r}))){},ChronoModelReferenceFieldQuark=class extends(Mixin([QuarkSync],(e=>{const t=e.prototype;return class extends e{setValue(e){t.setValue.call(this,e),e!==TombStone&&(this.identifier.DATA=e)}}}))){},ChronoModelReferenceFieldIdentifier=class extends(ReferenceIdentifier.mix(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync))){buildProposedValue(e,t,r){const n=t,i=n.proposedValue;if(null==i)return r.candidate.failedResolutionReferences.delete(n.identifier),null;if(isInstanceOf(i,Entity)&&i.graph)return e.hasBucket()&&e.getBucket(i).addToBucket(r,e.self),r.candidate.failedResolutionReferences.delete(n.identifier),i;const s=e.resolve(i);return isInstanceOf(s,Entity)&&s.graph?(e.hasBucket()&&e.getBucket(s).addToBucket(r,e.self),r.candidate.failedResolutionReferences.delete(n.identifier),s):(r.candidate.failedResolutionReferences.set(n.identifier,i),null)}};__decorate6([prototypeValue(!0)],ChronoModelReferenceFieldIdentifier.prototype,"sync",void 0),__decorate6([prototypeValue(ChronoModelReferenceFieldQuark)],ChronoModelReferenceFieldIdentifier.prototype,"quarkClass",void 0);var ChronoModelReferenceBucketFieldIdentifier=class extends(ReferenceBucketIdentifier.mix(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync))){};__decorate6([prototypeValue(!0)],ChronoModelReferenceBucketFieldIdentifier.prototype,"sync",void 0);var EffectResolutionResult,MinimalChronoModelFieldIdentifierSync=class extends(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierSync)){},MinimalChronoModelFieldIdentifierGen=class extends(ChronoModelFieldIdentifier.mix(MinimalFieldIdentifierGen)){},MinimalChronoModelFieldVariable=class extends(ChronoModelFieldIdentifier.mix(MinimalFieldVariable)){},model_field=function(e={},t={},r=ModelField){return function(n,i){generic_field({modelFieldConfig:e,...t},r)(n,i),injectStaticFieldsProperty(n.constructor)}},injectStaticFieldsProperty=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return getDecoratedModelFields(this)}})},getDecoratedModelFields=e=>{const t=e.prototype,r=[];return t.hasOwnProperty("$entity")&&t.$entity.ownFields.forEach((e=>{if(e instanceof ModelField){const t=e.modelFieldConfig||{};!t.convert&&e.converter&&e.converter!==dateConverter&&(t.convert=e.converter),r.push(Object.assign(t,{$chrono:e,name:e.name}))}})),r},dateConverter=(e,t)=>{var r,n;return null===e?null:(e instanceof Date||(e=DateHelper.parse(e,(null==(r=t.modelFieldConfig)?void 0:r.format)||(null==(n=t.modelFieldConfig)?void 0:n.dateFormat)||DateHelper.defaultParseFormat)),e||void 0)},ChronoModelMixin=class extends(Mixin([Entity,Model],(e=>{const t=e.prototype;return class extends e{get isEntity(){return!0}construct(e,...r){this.constructor.exposeProperties(),this.originalData=e=e||{},t.construct.call(this,e,...r);for(const t in this.originalData)this.$[t]&&!this.getFieldDefinition(t)&&(this[t]=e[t])}*userProvidedValue(){return yield ProposedOrPrevious}copy(e=null,r=null){const n=t.copy.call(this,e,r),{creatingOccurrence:i}=null!=r?r:{};return(ObjectHelper.isObject(r)&&!r.skipFieldIdentifiers||!ObjectHelper.isObject(r))&&this.forEachFieldIdentifier(((e,t)=>{var r;"store"!==(null==(r=this.getFieldDefinition(t))?void 0:r.type)&&(!i||e instanceof ChronoModelReferenceBucketFieldIdentifier||e instanceof ChronoModelReferenceFieldIdentifier)&&(n[t]=this[t])})),n}applyValue(e,r,n,i,s){var a;this.$entity.getField((null==s?void 0:s.name)||r)&&(e=!0),i&&(e=!1),t.applyValue.call(this,e,e&&null!=(a=null==s?void 0:s.name)?a:r,n,i,s)}get isInActiveTransaction(){var e;const t=null==(e=this.graph)?void 0:e.activeTransaction;return Boolean(null==t?void 0:t.getLatestEntryFor(this.$$))}get data(){return this._data}set data(e){this._data=e;const{fields:t,$:r,graph:n,generation:i}=this;for(let s=0;s<t.length;s++){const{name:a,dataSource:o,complexMapping:l}=t[s],c=r[a];if(c){const t=l?ObjectHelper.getPath(e,o):e[o];!l&&!(o in e)||null==i&&void 0===t||c.writeToGraph(n,t)}}}get $entityName(){const e=this.constructor.name||this.$entity.name,t=this.id;return e+(null!=t?"-"+String(t):"")}}}))){},locale5={localeName:"Ch",localeDesc:"中文",localeCode:"en-US",RemoveDependencyCycleEffectResolution:{descriptionTpl:"删除依赖项"},DeactivateDependencyCycleEffectResolution:{descriptionTpl:"停用依赖项"},CycleEffectDescription:{descriptionTpl:"此处变成了循环： {0}，无法添加依赖关系！"},EmptyCalendarEffectDescription:{descriptionTpl:'"{0}" 日历不提供任何工作时间间隔。'},Use24hrsEmptyCalendarEffectResolution:{descriptionTpl:"非工作周六和周日使用24小时日历。"},Use8hrsEmptyCalendarEffectResolution:{descriptionTpl:"非工作周六和周日使用8小时日历（08:00-12:00，13:00-17:00）。"},ConflictEffectDescription:{descriptionTpl:"发现计划冲突：{0} 与 {1} 冲突"},ConstraintIntervalDescription:{dateFormat:"LLL"},ProjectConstraintIntervalDescription:{startDateDescriptionTpl:"项目开始日期 {0}",endDateDescriptionTpl:"项目结束日期 {0}"},DependencyType:{long:["Start-to-Start","Start-to-Finish","Finish-to-Start","Finish-to-Finish"]},ManuallyScheduledParentConstraintIntervalDescription:{startDescriptionTpl:"手动计划的“{2}”强制其子项不早于{0}启动",endDescriptionTpl:"手动计划的“{2}”强制其子项在{1}之前完成"},DisableManuallyScheduledConflictResolution:{descriptionTpl:"禁用“{0}”的手动计划"},DependencyConstraintIntervalDescription:{descriptionTpl:"从“{3}”到“{4}”的依赖项({2})"},RemoveDependencyResolution:{descriptionTpl:"删除从“{1}”到“{2}”的依赖项"},DeactivateDependencyResolution:{descriptionTpl:"停用从“{1}”到“{2}”的依赖关系"},DateConstraintIntervalDescription:{startDateDescriptionTpl:"任务“{2}” {3} {0}约束",endDateDescriptionTpl:"任务“{2}” {3} {1}约束",constraintTypeTpl:{startnoearlierthan:"开始时间不得早于",finishnoearlierthan:"完成时间不得早于",muststarton:"必须在上启动",mustfinishon:"必须在上完成",startnolaterthan:"最晚开始时间",finishnolaterthan:"最迟完成"}},RemoveDateConstraintConflictResolution:{descriptionTpl:"删除任务“{0}”的“{1}”约束"}},En_default4=LocaleHelper.publishLocale(locale5),DateInterval=class extends Base2{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=MIN_DATE),this.endDate||(this.endDate=MAX_DATE)}equalTo(e){return this.startDate.getTime()===e.startDate.getTime()&&this.endDate.getTime()===e.endDate.getTime()}isInfinite(){return this.startDate.getTime()===MIN_DATE.getTime()&&this.endDate.getTime()===MAX_DATE.getTime()}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==MIN_DATE.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==MAX_DATE.getTime()}containsDate(e,t=EdgeInclusion.Left){return t===EdgeInclusion.Left&&e>=this.startDate&&e<this.endDate||t===EdgeInclusion.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,r=e.endDate,n=this.startDate,i=this.endDate;if(i<t||n>r)return EMPTY_INTERVAL;const s=new Date(Math.max(n.getTime(),t.getTime())),a=new Date(Math.min(i.getTime(),r.getTime()));return this.constructor.new({startDate:s,endDate:a})}intersectMut(e,t=!1){var r;const n=e.startDate,i=e.endDate,s=this.startDate,a=this.endDate;if(t&&(this.intersectionOf||(this.intersectionOf=new Set),(null==(r=e.intersectionOf)?void 0:r.size)>0?(e.intersectionOf.forEach(this.intersectionOf.add,this.intersectionOf),this.intersectedAsEmpty=e.intersectedAsEmpty):this.intersectionOf.add(e)),!this.isIntervalEmpty()){if(a<n||s>i)return this.startDate=MAX_DATE,this.endDate=MIN_DATE,t&&(this.intersectedAsEmpty=e),this;this.startDate=new Date(Math.max(s.getTime(),n.getTime())),this.endDate=new Date(Math.min(a.getTime(),i.getTime()))}return this}getCopyProperties(e){return e}copyWith(e){const t=this.getCopyProperties(e);return this.constructor.new(t)}},EMPTY_INTERVAL=DateInterval.new({startDate:MAX_DATE,endDate:MIN_DATE}),intersectIntervals=(e,t=!1)=>e.reduce(((e,r)=>e.intersectMut(r,t)),DateInterval.new()),__decorate7=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a};!function(e){e.Cancel="Cancel",e.Resume="Resume"}(EffectResolutionResult||(EffectResolutionResult={}));var SchedulingIssueEffectResolution=class extends Base{getDescription(){throw new Error("Abstract method")}resolve(...e){throw new Error("Abstract method")}},SchedulingIssueEffect=class extends Effect{getResolutions(){return this._resolutions}getDescriptionBuilderClass(){return this._descriptionBuilderClass}setDescriptionBuilderClass(e){this._descriptionBuilderClass=e}getDescription(){return this.getDescriptionBuilderClass().getDescription(this)}};__decorate7([prototypeValue("schedulingIssueEffect")],SchedulingIssueEffect.prototype,"type",void 0),__decorate7([prototypeValue(!1)],SchedulingIssueEffect.prototype,"sync",void 0);var __decorate8=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ConflictSymbol=Symbol("ConflictSymbol"),ConflictEffectDescription=class extends(Localizable_default(Base)){static get $name(){return"ConflictEffectDescription"}static getDescription(e){return format(this.L("L{descriptionTpl}"),e.intervals[0].getDescription(),e.intervals[1].getDescription())}},ConflictEffect=class extends SchedulingIssueEffect{constructor(){super(...arguments),this.handler=ConflictSymbol}initialize(e){super.initialize(e),this.intervals=this.filterConflictingIntervals(this.intervals)}getResolutions(){return this._resolutions||(this._resolutions=[].concat(...this.intervals.map((e=>e.getResolutions())))),this._resolutions}filterConflictingIntervals(e){const t=[],r=[...e].filter((e=>!e.isInfinite())),n=r.find((e=>e.isAffectedByTransaction()));if(n){const e=r.sort(((e,t)=>e===n?-1:0)),i=intersectIntervals(e,!0).intersectedAsEmpty;t.push(i,n)}else t.push(intersectIntervals(r,!0).intersectedAsEmpty,intersectIntervals(r.reverse(),!0).intersectedAsEmpty);return t}};__decorate8([prototypeValue("schedulingConflict")],ConflictEffect.prototype,"type",void 0),__decorate8([prototypeValue(ConflictEffectDescription)],ConflictEffect.prototype,"_descriptionBuilderClass",void 0);var ConflictResolution=class extends SchedulingIssueEffectResolution{resolve(){throw new Error("Abstract method")}},ConstraintIntervalDescription=class extends(Localizable_default(Base)){static get $name(){return"ConstraintIntervalDescription"}static getDescription(e){return format(this.L("L{descriptionTpl}"),...this.getDescriptionParameters(e))}static getDescriptionParameters(e){return[DateHelper.format(e.startDate,this.L("L{dateFormat}")),DateHelper.format(e.endDate,this.L("L{dateFormat}"))]}},ConstraintInterval=class extends DateInterval{constructor(){super(...arguments),this.owner=void 0,this.reflectionOf=void 0,this.side=void 0,this.resolutions=void 0}get isConstraintInterval(){return!0}getDescription(){return this.descriptionBuilderClass.getDescription(this)}getResolutions(){return[]}isAffectedByTransaction(e){return!1}getCopyProperties(e){const{owner:t,reflectionOf:r,side:n}=this;return Object.assign({owner:t,reflectionOf:r,side:n},e)}};__decorate8([prototypeValue(ConstraintIntervalDescription)],ConstraintInterval.prototype,"descriptionBuilderClass",void 0);var ChronoPartOfProjectGenericMixin=class extends(Mixin([AbstractPartOfProjectGenericMixin],(e=>{e.prototype;return class extends e{getGraph(){const e=this.getProject();return null==e?void 0:e.getGraph()}getEventById(e){var t;return null==(t=this.getEventStore())?void 0:t.getById(e)}getDependencyById(e){var t;return null==(t=this.getDependencyStore())?void 0:t.getById(e)}getResourceById(e){var t;return null==(t=this.getResourceStore())?void 0:t.getById(e)}getAssignmentById(e){var t;return null==(t=this.getAssignmentStore())?void 0:t.getById(e)}getCalendarById(e){var t;return null==(t=this.getCalendarManagerStore())?void 0:t.getById(e)}}}))){},ChronoStoreMixin=class extends(Mixin([Store],(e=>class extends e{}))){},ChronoPartOfProjectStoreMixin=class extends(Mixin([AbstractPartOfProjectStoreMixin,ChronoPartOfProjectGenericMixin,ChronoStoreMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=0}setStoreData(e){var r;null==(r=this.project)||r.repopulateStore(this),t.setStoreData.call(this,e)}register(e){var r,n;t.register.call(this,e),!e.isRoot&&!(null==(r=this.project)?void 0:r.graph)&&(null==(n=this.project)||n.scheduleDelayedCalculation())}onModelChange(e,t,r,n,i,s){s||this.syncDataOnLoad&&this.isLoadingData||!Object.keys(r).some((t=>"intervals"!==t&&e.$entity.getField(t)))||(n=!0),super.onModelChange(e,t,r,n,i,s)}}}))){},ChronoPartOfProjectModelMixin=class extends(Mixin([AbstractPartOfProjectModelMixin,ChronoPartOfProjectGenericMixin,ChronoModelMixin],(e=>{const t=e.prototype;return class extends e{joinProject(){var e;(null==(e=this.project)?void 0:e.delayEnteringReplica)||(this.graph&&this.graph!=this.getGraph()&&(this.graph=null),this.getGraph().addEntity(this))}leaveProject(e=!1){t.leaveProject.call(this,e);const r=this.getGraph();null==r||r.removeEntity(this),this.graph=null}getProject(){return t.getProject.call(this)}calculateProject(){const e=this.stores.find((e=>isInstanceOf(e,ChronoPartOfProjectStoreMixin)&&!!e.getProject()));return null==e?void 0:e.getProject()}get graph(){var e;return(null==(e=this.project)?void 0:e.delayEnteringReplica)?null:this._graph}set graph(e){this._graph=e}}}))){},__decorate9=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},hasMixin=Symbol("CalendarMixin"),EmptyCalendarSymbol=Symbol("EmptyCalendarSymbol"),BaseCalendarMixin=class extends(Mixin([AbstractCalendarMixin,ChronoPartOfProjectModelMixin],(e=>{class t extends e{constructor(){super(...arguments),this.version=1}[hasMixin](){}}return __decorate9([model_field({},{persistent:!1})],t.prototype,"version",void 0),__decorate9([model_field({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),__decorate9([model_field()],t.prototype,"intervals",void 0),t}))){},EmptyCalendarEffectDescription=class extends(Localizable_default(Base)){static get $name(){return"EmptyCalendarEffectDescription"}static getDescription(e){const t=e.getCalendar();return format(this.L("L{descriptionTpl}"),t.name||t.id)}},EmptyCalendarEffect=class extends SchedulingIssueEffect{constructor(){super(...arguments),this.handler=EmptyCalendarSymbol}getResolutions(){const e=this.getCalendar();return this._resolutions||(this._resolutions=[Use24hrsEmptyCalendarEffectResolution.new({calendar:e}),Use8hrsEmptyCalendarEffectResolution.new({calendar:e})])}getCalendar(){const{calendars:e}=this;if((null==e?void 0:e.length)>1)for(const t of e){if(!(t.skipNonWorkingTime(this.date,this.isForward)instanceof Date))return t}return e[0]}};__decorate9([prototypeValue("emptyCalendar")],EmptyCalendarEffect.prototype,"type",void 0),__decorate9([prototypeValue(EmptyCalendarEffectDescription)],EmptyCalendarEffect.prototype,"_descriptionBuilderClass",void 0);var BaseEmptyCalendarEffectResolution=class extends(Localizable_default(SchedulingIssueEffectResolution)){static get $name(){return"BaseEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{intervals:[{isWorking:!0}]}}}getDescription(){const{calendar:e}=this;return format(this.L("L{descriptionTpl}"),e.name||e.id)}fixCalendarData(e){var t;e.clearIntervals(!0),Object.assign(e,this.calendarData),(null==(t=e.intervals)?void 0:t.length)&&e.addIntervals(e.intervals)}resolve(){const{calendar:e}=this;this.fixCalendarData(e)}},Use24hrsEmptyCalendarEffectResolution=class extends BaseEmptyCalendarEffectResolution{static get $name(){return"Use24hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"on Mon at 0:00",recurrentEndDate:"on Sat at 0:00",isWorking:!0}]}}}},Use8hrsEmptyCalendarEffectResolution=class extends BaseEmptyCalendarEffectResolution{static get $name(){return"Use8hrsEmptyCalendarEffectResolution"}static get configurable(){return{calendarData:{unspecifiedTimeIsWorking:!1,intervals:[{recurrentStartDate:"every weekday at 08:00",recurrentEndDate:"every weekday at 12:00",isWorking:!0},{recurrentStartDate:"every weekday at 13:00",recurrentEndDate:"every weekday at 17:00",isWorking:!0}]}}}},__decorate10=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},CycleSymbol=Symbol("CycleSymbol"),EngineRevision=class extends Revision{constructor(){super(...arguments),this.failedResolutionReferences=new Map}},EngineTransaction=class extends Transaction2{constructor(){super(...arguments),this.candidateClass=EngineRevision}initialize(e){var t;(null==(t=e.graph.project)?void 0:t.delayCalculation)&&(e.startProgressNotificationsAfterMs=0,e.emitProgressNotificationsEveryMs=100),super.initialize(e),this.candidate.failedResolutionReferences=new Map(this.baseRevision.failedResolutionReferences)}addIdentifier(e,t,...r){return this.candidate.failedResolutionReferences.size&&(this.candidate.failedResolutionReferences.forEach(((e,t)=>{this.write(t,e)})),this.candidate.failedResolutionReferences.clear()),super.addIdentifier(e,t,...r)}},EngineReplica=class extends(Mixin([Replica],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.baseRevision=EngineRevision.new(),this.transactionClass=EngineTransaction,this.autoCommitMode="async",this.onComputationCycle="effect",this.cycleEffectClass=CycleEffect,this.silenceInitialCommit=!0,this.ignoreInitialCommitComputationCycles=!1}get dirty(){const e=this.activeTransaction;return e.entries.size>0&&(e.hasVariableEntry||e.hasEntryWithProposedValue)}onPropagationProgressNotification(e){var t,r;this.enableProgressNotifications&&this.project&&(null==(r=(t=this.project).trigger)||r.call(t,"progress",e))}async commitAsync(e){if(!this.project||this.project.isDestroyed)return;this.project.trigger("beforeCommit"),this.isInitialCommit&&this.ignoreInitialCommitComputationCycles&&(this._onComputationCycle=this._onComputationCycle||this.onComputationCycle,this.onComputationCycle="ignore");const r=this.project.beforeCommitAsync();return r||t.commitAsync.call(this,e)}get isInitialCommit(){return this.project.isInitialCommit||super.isInitialCommit}set isInitialCommit(e){super.isInitialCommit=e}write(e,r,...n){var i,s,a;const o=null==(i=e.field)?void 0:i.name,l=e.self;if(o&&l){const i=null==(s=l.beforeChronoFieldSet)?void 0:s.call(l,o,r);t.write.call(this,e,r,...n),null==(a=l.afterChronoFieldSet)||a.call(l,o,r,i)}else t.write.call(this,e,r,...n)}async finalizeCommitAsync(e){const{project:t}=this;if(!t||t.isDestroyed)return;const{entries:r}=e,n=new Set;globalThis.DEBUG&&console.timeEnd("Time to visible");const{isInitialCommit:i,silenceInitialCommit:s}=this,a=i&&s;i&&(t.isInitialCommitPerformed=!0,this.ignoreInitialCommitComputationCycles&&(this.onComputationCycle=this._onComputationCycle)),t.isWritingData=!0,t.hasLoadedDataToCommit=!1,this.enableProgressNotifications&&t.trigger("progress",{total:e.entries.size,remaining:0,phase:"finalizing"});e.transaction.rejectedWith&&t.trigger("commitRejected",{transactionResult:e,isInitialCommit:i,silenceCommit:a}),t.trigger("refresh",{isInitialCommit:i,isCalculated:!0}),await new Promise((s=>{setTimeout((()=>{var o,l;if(!t.isDestroyed){if(e.transaction.rejectedWith)t.isWritingData=!1;else{null==(o=t.suspendChangesTracking)||o.call(t),globalThis.DEBUG&&console.time("Finalize propagation");const s=new Set;for(const e of r.values()){const t=e.identifier,r=e.getValue(),{field:i}=t;if(e.isShadow()||!t[IsChronoModelSymbol]||r===TombStone||i instanceof ModelBucketField)continue;const a=t.self,o=a.firstStore;s.has(a)||(a.beginBatch(!0),s.add(a)),(null==o?void 0:o.autoCommit)&&!n.has(o)&&(o.suspendAutoCommit(),n.add(o)),a.meta.batchChanges[i.name]=r}let c=!1;for(const e of s)if(!e.triggerBeforeUpdate({...e.meta.batchChanges})){c=!0;break}if(c){for(const e of s)e.cancelBatch();e.transaction.reject(),t.trigger("commitRejected",{transactionResult:e,isInitialCommit:i,silenceCommit:a}),t.trigger("refresh",{isInitialCommit:i,isCalculated:!0})}else for(const e of s)e.ignoreBag=a||t.ignoreRecordChanges,e.generation++,e.endBatch(a,!0,!0),e.ignoreBag=!1;t.ignoreRecordChanges=!1,globalThis.DEBUG&&console.timeEnd("Finalize propagation"),t.isWritingData=!1,c||t.trigger("dataReady",{records:s,isInitialCommit:i}),null==(l=t.resumeChangesTracking)||l.call(t,a),n.forEach((e=>e.resumeAutoCommit())),a&&(t.eventStore.acceptChanges(),t.dependencyStore.acceptChanges(),t.resourceStore.acceptChanges(),t.assignmentStore.acceptChanges(),t.calendarManagerStore.acceptChanges(),t.acceptChanges())}t.trigger("commitFinalized",{isInitialCommit:i,transactionResult:e})}s()}),0)}))}*onComputationCycleHandler(e){if("effect"!==this.onComputationCycle)return yield*super.onComputationCycleHandler(e);{const t=this.project.cycleEffectClass.new({cycle:e});(yield t)===EffectResolutionResult.Cancel&&(yield Reject(t))}}async[CycleSymbol](e,t){return this.project.onCycleSchedulingIssue(e,t)}async[EmptyCalendarSymbol](e,t){return t.walkContext.startNewEpoch(),this.project.onEmptyCalendarSchedulingIssue(e,t)}async[ConflictSymbol](e,t){return t.walkContext.startNewEpoch(),this.project.onConflictSchedulingIssue(e,t)}[RejectSymbol](e,t){return super[RejectSymbol](e,t)}}}))){},RemoveDependencyCycleEffectResolution=class extends(Localizable_default(SchedulingIssueEffectResolution)){static get $name(){return"RemoveDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.remove()}},CycleEffectDescription=class extends(Localizable_default(Base)){static get $name(){return"CycleEffectDescription"}static getDescription(e){return format(this.L("L{descriptionTpl}"),this.getShortDescription(e))}static getShortDescription(e){const t=e.getEvents().slice();return t.push(t[0]),'"'+t.map((e=>e.name||"#"+e.id)).join('" -> "')+'"'}},CycleEffect=class extends SchedulingIssueEffect{constructor(){super(...arguments),this.handler=CycleSymbol}getEvents(){if(!this._events){const e=new Set;this.cycle.cycle.forEach((({context:t})=>e.add(t))),this._events=[...e]}return this._events}matchDependencyBySourceAndTargetEvent(e,t,r){return e.fromEvent===t&&e.toEvent===r}getDependencyForSourceAndTargetEvents(e,t){return this.getEvents()[0].project.getDependencyStore().find((r=>this.matchDependencyBySourceAndTargetEvent(r,e,t)))}getDependencies(){if(!this._dependencies){const e=new Set,t=this.getEvents(),r=t.length;let n,i=t[0];if(1===r)(n=this.getDependencyForSourceAndTargetEvents(i,i))&&e.add(n);else for(const r of t)for(const i of t)(n=this.getDependencyForSourceAndTargetEvents(r,i))&&e.add(n),(n=this.getDependencyForSourceAndTargetEvents(i,r))&&e.add(n);this._dependencies=[...e]}return this._dependencies}getResolutions(){return this._resolutions||(this._resolutions=[this.removeDependencyCycleEffectResolutionClass.new()]),this._resolutions}};__decorate10([prototypeValue("cycle")],CycleEffect.prototype,"type",void 0),__decorate10([prototypeValue(CycleEffectDescription)],CycleEffect.prototype,"_descriptionBuilderClass",void 0),__decorate10([prototypeValue(RemoveDependencyCycleEffectResolution)],CycleEffect.prototype,"removeDependencyCycleEffectResolutionClass",void 0);var Instruction,__decorate11=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BaseAssignmentMixin=class extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{}return __decorate11([generic_field({bucket:"assigned",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual,persist:!1}},ModelReferenceField)],t.prototype,"event",void 0),__decorate11([generic_field({bucket:"assigned",resolver:function(e){return this.getResourceById(e)},modelFieldConfig:{serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual,persist:!1}},ModelReferenceField)],t.prototype,"resource",void 0),injectStaticFieldsProperty(t),t}))){},ChronoAssignmentStoreMixin=class extends(Mixin([AbstractAssignmentStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=100}static get defaultConfig(){return{modelClass:BaseAssignmentMixin}}set data(e){this.allAssignmentsForRemoval=!0,super.data=e,this.allAssignmentsForRemoval=!1}}}))){},ChronoCalendarManagerStoreMixin=class extends(Mixin([AbstractCalendarManagerStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=500}static get defaultConfig(){return{tree:!0,modelClass:BaseCalendarMixin}}}}))){},ChronoDependencyStoreMixin=class extends(Mixin([AbstractDependencyStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=200}set data(e){this.allDependenciesForRemoval=!0,super.data=e,this.allDependenciesForRemoval=!1}}}))){};!function(e){e.KeepDuration="KeepDuration",e.KeepStartDate="KeepStartDate",e.KeepEndDate="KeepEndDate"}(Instruction||(Instruction={}));var StartDateVar=Symbol("StartDate"),EndDateVar=Symbol("EndDate"),DurationVar=Symbol("Duration"),startDateFormula=Formula.new({output:StartDateVar,inputs:new Set([DurationVar,EndDateVar])}),endDateFormula=Formula.new({output:EndDateVar,inputs:new Set([DurationVar,StartDateVar])}),durationFormula=Formula.new({output:DurationVar,inputs:new Set([StartDateVar,EndDateVar])}),SEDGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar]),formulas:new Set([startDateFormula,endDateFormula,durationFormula])}),SEDForwardCycleResolutionContext=CycleResolution.new({description:SEDGraphDescription,defaultResolutionFormulas:new Set([endDateFormula])}),SEDBackwardCycleResolutionContext=CycleResolution.new({description:SEDGraphDescription,defaultResolutionFormulas:new Set([startDateFormula])}),SEDDispatcher=class extends CycleResolutionInputChrono{addInstruction(e){e===Instruction.KeepStartDate&&this.addKeepIfPossibleFlag(StartDateVar),e===Instruction.KeepEndDate&&this.addKeepIfPossibleFlag(EndDateVar),e===Instruction.KeepDuration&&this.addKeepIfPossibleFlag(DurationVar)}},SEDDispatcherIdentifier=class extends(FieldIdentifier.mix(CalculatedValueGen)){equality(e,t){const r=e.resolution,n=t.resolution;return r.get(StartDateVar)===n.get(StartDateVar)&&r.get(EndDateVar)===n.get(EndDateVar)&&r.get(DurationVar)===n.get(DurationVar)||r.get(StartDateVar)===CalculateProposed&&r.get(EndDateVar)===CalculateProposed&&r.get(DurationVar)===CalculateProposed}},__decorate12=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasCalendarMixin=class extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{class t extends e{writeCalendar(e,t,r,n){const i=this.getCalendarManagerStore(),s=n;n&&i&&n instanceof BaseCalendarMixin&&!i.includes(s)&&i.add(n),e.constructor.prototype.write.call(this,e,t,r,n)}resolveCalendar(e){var t;return null==(t=this.getCalendarManagerStore())?void 0:t.getById(e)}*calculateEffectiveCalendar(){let e=yield this.$.calendar;if(!e){const t=this.getProject();e=yield t.$.effectiveCalendar}return yield e.$.version,e}shouldRecordFieldChange(e,t,r){if(!super.shouldRecordFieldChange(e,t,r))return!1;const{project:n}=this;if("calendar"===e&&n){const{calendarManagerStore:e}=n;return e.oldIdMap[t]!==e.getById(r)}return!0}}return __decorate12([field({equality:()=>!1})],t.prototype,"effectiveCalendar",void 0),__decorate12([generic_field({modelFieldConfig:{persist:!0,serialize:e=>void 0===e?void 0:(null==e?void 0:e.id)||null,isEqual:isSerializableEqual},resolver:function(e){return this.resolveCalendar(e)},sync:!0},ModelReferenceField)],t.prototype,"calendar",void 0),__decorate12([write("calendar")],t.prototype,"writeCalendar",null),__decorate12([calculate("effectiveCalendar")],t.prototype,"calculateEffectiveCalendar",null),injectStaticFieldsProperty(t),t}))){},CanCombineCalendarsMixin=class extends(Mixin([],(e=>class extends e{constructor(){super(...arguments),this.combinedcalendarscache=new Map}combineCalendars(e){const t=stripDuplicates(e);if(0===t.length)throw new Error("No calendars to combine");t.sort(((e,t)=>e.internalId<t.internalId?-1:1));const r=t.map((e=>e.internalId+"/")).join(""),n=t.map((e=>e.version+"/")).join(""),i=this.combinedcalendarscache.get(r);let s;return i&&i.versionsHash===n?s=i.cache:(s=new CalendarCacheMultiple({calendarCaches:t.map((e=>e.calendarCache))}),this.combinedcalendarscache.set(r,{versionsHash:n,cache:s})),s}}))){},__decorate13=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BaseEventMixin=class extends(Mixin([HasCalendarMixin],(e=>{e.prototype;class t extends e{*calculateDispatcher(e){yield ProposedOrPrevious;const t=yield*this.prepareDispatcher(e),r=yield ProposedArgumentsOf(this.$.startDate),n=r?r[0]?Instruction.KeepDuration:Instruction.KeepEndDate:void 0;n&&t.addInstruction(n);const i=yield ProposedArgumentsOf(this.$.endDate),s=i?i[0]?Instruction.KeepDuration:Instruction.KeepStartDate:void 0;s&&t.addInstruction(s);const a=yield this.$.direction,o=yield ProposedArgumentsOf(this.$.duration);let l;if(o)switch(o[0]){case!0:l=Instruction.KeepStartDate;break;case!1:l=Instruction.KeepEndDate}return!l&&t.hasProposedValue(DurationVar)&&(l=a===Direction.Forward||a===Direction.None?Instruction.KeepStartDate:Instruction.KeepEndDate),l&&t.addInstruction(l),t}*prepareDispatcher(e){const t=this.dispatcherClass(e).new({context:this.cycleResolutionContext(e)});return t.collectInfo(e,this.$.startDate,StartDateVar),t.collectInfo(e,this.$.endDate,EndDateVar),t.collectInfo(e,this.$.duration,DurationVar),t}cycleResolutionContext(e){const t=e(this.$.direction);return t===Direction.Forward||t===Direction.None?SEDForwardCycleResolutionContext:SEDBackwardCycleResolutionContext}dispatcherClass(e){return SEDDispatcher}buildProposedDispatcher(e,t,r){const n=this.dispatcherClass(r.onEffectSync).new({context:this.cycleResolutionContext(r.onEffectSync)});return n.addPreviousValueFlag(StartDateVar),n.addPreviousValueFlag(EndDateVar),n.addPreviousValueFlag(DurationVar),n}*skipNonWorkingTime(e,t){const r=yield this.$.effectiveCalendar;if(!e)return null;const n=r.skipNonWorkingTime(e,t);if(n instanceof Date)return n;{const n=EmptyCalendarEffect.new({calendars:[r],event:this,date:e,isForward:t});if((yield n)!==EffectResolutionResult.Cancel)return null;yield Reject(n)}}*skipWorkingTime(e,t,r,n){const i=yield this.$.durationUnit;return n&&n!==i&&(r=yield*this.getProject().$convertDuration(r,n,i)),yield*this.calculateProjectedXDateWithDuration(e,t,r)}setStartDate(e,t=!0){const{graph:r,project:n}=this;return r?(r.write(this.$.startDate,e,t),r.commitAsync()):(this.$.startDate.DATA=e,null==n?void 0:n.delayedCalculationPromise)}writeStartDate(e,t,r,n,i=!0){(t.baseRevision.hasIdentifier(e)||null!=n)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,void 0,null==n),e.constructor.prototype.write.call(this,e,t,r,n,i))}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(StartDateVar);if(e===CalculateProposed){return yield*this.calculateStartDateProposed()}if(e===startDateFormula.formulaId){return yield*this.calculateStartDatePure()}throw new Error("`startDate`格式不正确")}*calculateStartDatePure(){return yield*this.calculateProjectedXDateWithDuration(yield this.$.endDate,!1,yield this.$.duration)}*calculateStartDateProposed(){const e=this.getProject(),t=yield ProposedOrPrevious;return!(yield this.$.manuallyScheduled)||e.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(t,!0):t}*calculateProjectedXDateWithDuration(e,t,r){const n=yield this.$.durationUnit,i=yield this.$.effectiveCalendar,s=this.getProject();if(!e||isNotNumber(r))return null;if(t=void 0===t||t){return i.calculateEndDate(e,yield*s.$convertDuration(r,n,TimeUnit.Millisecond))}return i.calculateStartDate(e,yield*s.$convertDuration(r,n,TimeUnit.Millisecond))}setEndDate(e,t=!1){const{graph:r,project:n}=this;return r?(r.write(this.$.endDate,e,t),r.commitAsync()):(this.$.endDate.DATA=e,null==n?void 0:n.delayedCalculationPromise)}writeEndDate(e,t,r,n,i=!1){(t.baseRevision.hasIdentifier(e)||null!=n)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,void 0,null==n),e.constructor.prototype.write.call(this,e,t,r,n,i))}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(EndDateVar);if(e===CalculateProposed){return yield*this.calculateEndDateProposed()}if(e===endDateFormula.formulaId){return yield*this.calculateEndDatePure()}throw new Error("结束日期格式不正确")}*calculateEndDatePure(){let e=yield this.$.startDate,t=yield this.$.duration;return yield*this.calculateProjectedXDateWithDuration(e,!0,t)}*calculateEndDateProposed(){const e=this.getProject(),t=yield ProposedOrPrevious;return!(yield this.$.manuallyScheduled)||e.skipNonWorkingTimeWhenSchedulingManually?yield*this.skipNonWorkingTime(t,!1):t}getDuration(e){const t=this.duration;return void 0!==e?this.getProject().convertDuration(t,this.durationUnit,e):t}setDuration(e,t,r){const{graph:n,project:i}=this;if(!n){const r={duration:e};return this.$.duration.DATA=e,null!=t&&(r.durationUnit=this.$.durationUnit.DATA=t),this.set(r),null==i?void 0:i.delayedCalculationPromise}if(void 0!==e)return n.write(this.$.duration,e,t,r),n.commitAsync()}setDurationUnit(e){throw new Error("Use `setDuration` instead")}writeDuration(e,t,r,n,i,s=void 0){n<0&&(n=0),(t.baseRevision.hasIdentifier(e)||null!=n)&&(this.getProject().isStmRestoring||this.$.unscheduled.write(this.$.unscheduled,t,void 0,null==n),e.constructor.prototype.write.call(this,e,t,r,n,s),null!=i&&t.write(this.$.durationUnit,i))}*calculateDuration(){const e=(yield this.$.dispatcher).resolution.get(DurationVar);if(e===CalculateProposed){return yield*this.calculateDurationProposed()}if(e===durationFormula.formulaId){return yield*this.calculateDurationPure()}throw new Error("工期格式不正确")}*calculateDurationPure(){const e=yield this.$.startDate,t=yield this.$.endDate;if(!e||!t)return null;if(t&&t.setHours(23,59,59,0),!(e>t)){return yield*this.calculateProjectedDuration(e,t)}yield Write(this.$.duration,0,null)}*calculateDurationProposed(){return yield ProposedOrPrevious}*calculateProjectedDuration(e,t,r){if(!e||!t)return null;r||(r=yield this.$.durationUnit);const n=yield this.$.effectiveCalendar,i=this.getProject();return yield*i.$convertDuration(n.calculateDurationMs(e,t),TimeUnit.Millisecond,r)}*calculateEffectiveDuration(){let e;const t=(yield this.$.dispatcher).resolution.get(DurationVar);return t===CalculateProposed?e=yield this.$.duration:t===durationFormula.formulaId&&(e=yield*this.calculateProjectedDuration(yield ProposedOrPreviousValueOf(this.$.startDate),yield ProposedOrPreviousValueOf(this.$.endDate))),e}*calculateEffectiveCalendar(){const e=yield this.$.manuallyScheduled,t=this.getProject();return e&&!t.skipNonWorkingTimeInDurationWhenSchedulingManually?t.defaultCalendar:yield*super.calculateEffectiveCalendar()}}return __decorate13([model_field({type:"date"},{converter:dateConverter})],t.prototype,"startDate",void 0),__decorate13([model_field({type:"date"},{converter:dateConverter})],t.prototype,"endDate",void 0),__decorate13([model_field({type:"number",allowNull:!0})],t.prototype,"duration",void 0),__decorate13([model_field({type:"string",defaultValue:TimeUnit.Day},{converter:e=>DateHelper.normalizeUnit(e)||TimeUnit.Day})],t.prototype,"durationUnit",void 0),__decorate13([model_field({type:"string",defaultValue:Direction.Forward},{sync:!0})],t.prototype,"direction",void 0),__decorate13([field({identifierCls:SEDDispatcherIdentifier})],t.prototype,"dispatcher",void 0),__decorate13([model_field({type:"boolean",defaultValue:!1})],t.prototype,"manuallyScheduled",void 0),__decorate13([model_field({type:"boolean",defaultValue:!1})],t.prototype,"unscheduled",void 0),__decorate13([calculate("dispatcher")],t.prototype,"calculateDispatcher",null),__decorate13([build_proposed("dispatcher")],t.prototype,"buildProposedDispatcher",null),__decorate13([write("startDate")],t.prototype,"writeStartDate",null),__decorate13([calculate("startDate")],t.prototype,"calculateStartDate",null),__decorate13([write("endDate")],t.prototype,"writeEndDate",null),__decorate13([calculate("endDate")],t.prototype,"calculateEndDate",null),__decorate13([write("duration")],t.prototype,"writeDuration",null),__decorate13([calculate("duration")],t.prototype,"calculateDuration",null),t}))){},__decorate14=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BaseHasAssignmentsMixin=class extends(Mixin([BaseEventMixin,AbstractHasAssignmentsMixin],(e=>{e.prototype;class t extends e{get assignments(){return this.assigned?[...this.assigned]:[]}}return __decorate14([generic_field({},ModelBucketField)],t.prototype,"assigned",void 0),t}))){},__decorate15=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasDependenciesMixin=class extends(Mixin([BaseEventMixin],(e=>{const t=e.prototype;class r extends e{leaveProject(){var e,r;this.getEventStore();this.isInActiveTransaction&&this.project.dependencyStore.remove([...null!=(e=this.outgoingDeps)?e:[],...null!=(r=this.incomingDeps)?r:[]]),t.leaveProject.call(this)}}return __decorate15([generic_field({},ModelBucketField)],r.prototype,"outgoingDeps",void 0),__decorate15([generic_field({},ModelBucketField)],r.prototype,"incomingDeps",void 0),r}))){},SchedulerBasicEvent=class extends(Mixin([BaseEventMixin,BaseHasAssignmentsMixin,HasDependenciesMixin],(e=>{e.prototype;return class extends e{}}))){},ChronoEventStoreMixin=class extends(Mixin([AbstractEventStoreMixin,ChronoPartOfProjectStoreMixin],(e=>class extends e{constructor(){super(...arguments),this.removalOrder=400}static get defaultConfig(){return{modelClass:SchedulerBasicEvent}}set data(e){super.data=e,this.afterEventRemoval()}}))){},ChronoEventTreeStoreMixin=class extends(Mixin([ChronoEventStoreMixin],(e=>class extends e{buildRootNode(){return this.getProject()||{}}static get defaultConfig(){return{tree:!0}}}))){},__decorate16=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BaseResourceMixin=class extends(Mixin([HasCalendarMixin,ChronoPartOfProjectModelMixin],(e=>{const t=e.prototype;class r extends e{get assignments(){return[...this.assigned]}leaveProject(e=!1){if(!this.isStmRestoring&&this.assigned&&!e){const e=this.getResourceStore();this.assigned.forEach((t=>e.assignmentsForRemoval.add(t)))}t.leaveProject.call(this)}static get fields(){return[{name:"parentId"},{name:"children",persist:!1}]}}return __decorate16([generic_field({},ModelBucketField)],r.prototype,"assigned",void 0),r}))){},ChronoResourceStoreMixin=class extends(Mixin([AbstractResourceStoreMixin,ChronoPartOfProjectStoreMixin],(e=>{e.prototype;return class extends e{constructor(){super(...arguments),this.removalOrder=300}static get defaultConfig(){return{modelClass:BaseResourceMixin}}}}))){},__decorate17=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},DurationConverterMixin=class extends(Mixin([ChronoModelMixin],(e=>{e.prototype;class t extends e{*calculateUnitsInMs(){const e=yield this.$.hoursPerDay,t=yield this.$.daysPerWeek,r=yield this.$.daysPerMonth;return{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:60*e*60*1e3,week:t*e*60*60*1e3,month:r*e*60*60*1e3,quarter:3*r*e*60*60*1e3,year:12*r*e*60*60*1e3}}convertDuration(e,t,r){let n=e;return t!==r&&(n=e*this.unitsInMs[t]/this.unitsInMs[r]),n}*$convertDuration(e,t,r){if(!t||!r)throw new Error("转换单位不存在");const n=yield this.$.unitsInMs;let i=e;return t!==r&&(i=e*n[t]/n[r]),i}}return __decorate17([field()],t.prototype,"unitsInMs",void 0),__decorate17([model_field({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),__decorate17([model_field({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),__decorate17([model_field({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),__decorate17([calculate("unitsInMs")],t.prototype,"calculateUnitsInMs",null),t}))){},__decorate18=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},BaseDependencyMixin=class extends(Mixin([ChronoPartOfProjectModelMixin],(e=>{e.prototype;class t extends e{get isValid(){const{$:e,graph:t}=this;return!!(!t||t.hasIdentifier(e.fromEvent)&&t.hasIdentifier(e.toEvent))&&super.isValid}}return __decorate18([generic_field({bucket:"outgoingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual}},ModelReferenceField)],t.prototype,"fromEvent",void 0),__decorate18([generic_field({bucket:"incomingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual}},ModelReferenceField)],t.prototype,"toEvent",void 0),__decorate18([model_field({type:"int",defaultValue:DependencyType.EndToStart})],t.prototype,"type",void 0),__decorate18([model_field({type:"string"})],t.prototype,"fromSide",void 0),__decorate18([model_field({type:"string"})],t.prototype,"toSide",void 0),t}))){},ChronoAbstractProjectMixin=class extends(Mixin([ChronoModelMixin,AbstractProjectMixin],(e=>{e.prototype;return class extends e{get isDelayingCalculation(){return Boolean(this.delayEnteringReplica||this.delayedCalculationPromise)}getGraph(){return this.replica}beforeCommitAsync(){return null}enterReplica(e){}acceptChanges(){}async commitAsync(){var e;return this.delayedCalculationPromise||(null==(e=this.replica)?void 0:e.commitAsync())}getSchedulingIssueEventArguments(e,t,r,n){const i=[e.type,{continueWithResolutionResult:r,schedulingIssue:e}];return e instanceof ConflictEffect&&(i[1].conflict=e),i}async onSchedulingIssueCall(e,t){return e.type&&this.hasListener(e.type)?new Promise(((r,n)=>{this.trigger(...this.getSchedulingIssueEventArguments(e,t,r,n))})):EffectResolutionResult.Cancel}async onCycleSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}async onEmptyCalendarSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}async onConflictSchedulingIssue(e,t){return this.onSchedulingIssueCall(e,t)}setModelCalculations(e,t){if(!t)return;const r={};for(const n in t)r[n]=e.prototype.$calculations[n];return Object.assign(e.prototype.$calculations,t),r}setRecordCalculations(e,t){const r=this.setModelCalculations(e.constructor,t),n=e.$entity.$skeleton;return Object.keys(t).forEach((r=>{n[r].prototype.calculation=e[t[r]]})),r}setStoreCalculations(e,t){if(!t)return;const r=e.first;return r?this.setRecordCalculations(r,t):this.setModelCalculations(e.modelClass,t)}async setCalculations(e){this.replica&&await this.commitAsync();const t={},r={tasks:this.eventStore,events:this.eventStore,dependencies:this.dependencyStore,resources:this.resourceStore,assignments:this.assignmentStore,calendars:this.calendarManagerStore};Object.keys(r).forEach((n=>{e[n]&&(t[n]=this.setStoreCalculations(r[n],e[n]))}));let n=e.project;return n&&(t.project=this.setRecordCalculations(this,n)),this.replica&&this.repopulateReplica.now(),this.replica&&await this.commitAsync(),t}}}))){},HasSubEventsMixin=class extends(Mixin([BaseEventMixin],(e=>{const t=e.prototype;return class extends e{static get $name(){return"HasSubEventsMixin"}*hasSubEvents(){throw new Error("已调用抽象方法“hasSubEvents”")}*subEventsIterable(){throw new Error("已调用抽象方法“subEventsIterable”")}*calculateStartDatePure(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateMinChildrenStartDate():yield*t.calculateStartDatePure.call(this)}*calculateEndDatePure(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateMaxChildrenEndDate():yield*t.calculateEndDatePure.call(this)}*calculateStartDateProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateStartDatePure():yield*t.calculateStartDateProposed.call(this)}*calculateEndDateProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateEndDatePure():yield*t.calculateEndDateProposed.call(this)}*calculateDurationProposed(){const e=yield this.$.manuallyScheduled,r=yield*this.hasSubEvents();return!e&&r?yield*this.calculateDurationPure():yield*t.calculateDurationProposed.call(this)}*shouldRollupChildStartDate(e){return!0}*calculateMinChildrenStartDate(){const e=yield*this.subEventsIterable();let t=MAX_DATE.getTime();for(const r of e)if(yield*this.shouldRollupChildStartDate(r)){let e=yield r.$.startDate;e||(e=yield r.$.endDate),e&&e.getTime()<t&&(t=e.getTime())}return t===MIN_DATE.getTime()||t===MAX_DATE.getTime()?null:new Date(t)}*shouldRollupChildEndDate(e){return!0}*calculateMaxChildrenEndDate(){const e=yield*this.subEventsIterable();let t=MIN_DATE.getTime();for(const r of e)if(yield*this.shouldRollupChildEndDate(r)){let e=yield r.$.endDate;e||(e=yield r.$.startDate),e&&e.getTime()>t&&(t=e.getTime())}return t===MIN_DATE.getTime()||t===MAX_DATE.getTime()?null:new Date(t)}}}))){},__decorate19=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasChildrenMixin=class extends(Mixin([HasSubEventsMixin],(e=>{e.prototype;class t extends e{*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}get parent(){return this._parent}set parent(e){this._parent=e,this.parentEvent=e}}return __decorate19([reference({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),__decorate19([bucket()],t.prototype,"childEvents",void 0),t}))){},__decorate20=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SchedulerBasicProjectMixin=class extends(MixinAny([ChronoAbstractProjectMixin,BaseEventMixin,HasSubEventsMixin,HasCalendarMixin,DurationConverterMixin,CanCombineCalendarsMixin],(e=>{const t=e.prototype;class r extends e{construct(e={}){this.delayCalculation=!1!==e.delayCalculation,this.enableProgressNotifications=e.enableProgressNotifications||!1!==e.delayCalculation,"expanded"in e||(e.expanded=!0),this.delayCalculation&&(this.delayEnteringReplica=!0),"skipNonWorkingTimeWhenSchedulingManually"in e||(e.skipNonWorkingTimeWhenSchedulingManually=!1),t.construct.call(this,e),this.repopulateStores=new Set,this.ignoreInitialCommitComputationCycles="ignoreInitialCommitComputationCycles"in e&&e.ignoreInitialCommitComputationCycles,this.ignoreInitialCommitComputationCycles&&console.warn('Project "ignoreInitialCommitComputationCycles" option is deprecated and will be dropped in the next major release'),this.eventModelClass||(this.eventModelClass=this.getDefaultEventModelClass()),this.eventStoreClass||(this.eventStoreClass=this.getDefaultEventStoreClass()),this.dependencyModelClass||(this.dependencyModelClass=this.getDefaultDependencyModelClass()),this.dependencyStoreClass||(this.dependencyStoreClass=this.getDefaultDependencyStoreClass()),this.resourceModelClass||(this.resourceModelClass=this.getDefaultResourceModelClass()),this.resourceStoreClass||(this.resourceStoreClass=this.getDefaultResourceStoreClass()),this.assignmentModelClass||(this.assignmentModelClass=this.getDefaultAssignmentModelClass()),this.assignmentStoreClass||(this.assignmentStoreClass=this.getDefaultAssignmentStoreClass()),this.calendarModelClass||(this.calendarModelClass=this.getDefaultCalendarModelClass()),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=this.getDefaultCalendarManagerStoreClass()),this.cycleEffectClass||(this.cycleEffectClass=this.getDefaultCycleEffectClass()),this.initializeStm(),this.defaultCalendar=new this.calendarModelClass({unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.delayEnteringReplica||this.enterReplica(!1),this.setCalendarManagerStore(this.calendarManagerStore),this.setEventStore(this.eventStore),this.setDependencyStore(this.dependencyStore),this.setResourceStore(this.resourceStore),this.setAssignmentStore(this.assignmentStore);Boolean(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData)?(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData):this.delayCalculation&&this.hasDataInStores&&this.scheduleDelayedCalculation()}get hasDataInStores(){return[this.calendarManagerStore,this.eventStore,this.dependencyStore,this.resourceStore,this.assignmentStore].some((e=>e.allCount>0))}enterReplica(e){const t=this;t.replica||(t.replica=t.createReplica(),t.replica.addEntity(t),t.replica.addEntity(t.defaultCalendar),t.trigger("graphReady")),e&&!t.isRepopulatingStores&&(t.calendarManagerStore.forEach((e=>{!e.graph&&e.joinProject()}),void 0,{includeFilteredOutRecords:!0}),t.eventStore.forEach((e=>{!e.graph&&e.joinProject()}),void 0,{includeFilteredOutRecords:!0}),t.resourceStore.forEach((e=>{!e.graph&&e.joinProject()}),void 0,{includeFilteredOutRecords:!0}),t.dependencyStore.forEach((e=>{!e.graph&&e.joinProject()}),void 0,{includeFilteredOutRecords:!0}),t.assignmentStore.forEach((e=>{!e.graph&&e.joinProject()}),void 0,{includeFilteredOutRecords:!0}))}resetStmQueue(){const e=this.stm.disabled;this.stm.disable(),this.stm.resetQueue(),e||this.stm.enable()}doDestroy(){var e,r,n,i,s,a,o,l;const c=this;null==(e=c.eventStore)||e.destroy(),null==(r=c.dependencyStore)||r.destroy(),null==(n=c.assignmentStore)||n.destroy(),null==(i=c.resourceStore)||i.destroy(),null==(s=c.calendarManagerStore)||s.destroy(),null==(a=c.defaultCalendar)||a.destroy(),null==(o=c.replica)||o.clear(),null==(l=c.stm)||l.destroy(),t.doDestroy.call(this)}getReplicaConfig(){return{project:this,schema:Schema.new(),enableProgressNotifications:this.enableProgressNotifications,silenceInitialCommit:this.silenceInitialCommit,ignoreInitialCommitComputationCycles:this.ignoreInitialCommitComputationCycles,cycleEffectClass:this.cycleEffectClass,onWriteDuringCommit:"ignore",readMode:ReadMode.CurrentOrProposedOrPrevious}}createReplica(){return EngineReplica.mix(Replica).new(this.getReplicaConfig())}*hasSubEvents(){return this.getEventStore().count>0}*subEventsIterable(){return this.getEventStore().getRange()}getType(){return ProjectType.SchedulerBasic}get enableProgressNotifications(){return this._enableProgressNotifications}set enableProgressNotifications(e){this._enableProgressNotifications=e,this.replica&&(this.replica.enableProgressNotifications=e)}getDefaultCycleEffectClass(){return CycleEffect}getDefaultEventModelClass(){return SchedulerBasicEvent}getDefaultEventStoreClass(){return ChronoEventStoreMixin}getDefaultDependencyModelClass(){return BaseDependencyMixin}getDefaultDependencyStoreClass(){return ChronoDependencyStoreMixin}getDefaultResourceModelClass(){return BaseResourceMixin}getDefaultResourceStoreClass(){return ChronoResourceStoreMixin}getDefaultAssignmentModelClass(){return BaseAssignmentMixin}getDefaultAssignmentStoreClass(){return ChronoAssignmentStoreMixin}getDefaultCalendarModelClass(){return BaseCalendarMixin}getDefaultCalendarManagerStoreClass(){return ChronoCalendarManagerStoreMixin}usingSyncDataOnLoad(){return[this.eventStore,this.resourceStore,this.dependencyStore,this.assignmentStore].some((e=>e.syncDataOnLoad))}async loadInlineData(e){const{calendarManagerStore:t,eventStore:r,dependencyStore:n,assignmentStore:i,resourceStore:s,replica:a}=this;if(this.isInitialCommitPerformed)for(;this.replica.isCommitting;)await this.commitAsync();else null==a||a.unScheduleAutoCommit();(null==a?void 0:a.enableProgressNotifications)&&!this.delayCalculation&&(await delay2(0),await this.commitAsync(),a.onPropagationProgressNotification({total:0,remaining:0,phase:"storePopulation"}),await delay2(50)),this.isInitialCommitPerformed=!1,this.isLoadingInlineData=!0,globalThis.DEBUG&&(console.log("%cInitializing project","font-weight:bold;color:darkgreen;text-transform:uppercase;margin-top: 2em"),console.time("可见时间"),console.time("正在填充项目")),!this.delayCalculation||this.delayedCalculationPromise||this.usingSyncDataOnLoad()||this.scheduleDelayedCalculation(),e.calendarsData&&(this.repopulateStore(t),t.data=e.calendarsData),(e.eventsData||e.tasksData)&&(this.repopulateStore(r),r.data=e.eventsData||e.tasksData),e.dependenciesData&&(this.repopulateStore(n),n.data=e.dependenciesData),e.resourcesData&&(this.repopulateStore(s),s.data=e.resourcesData),e.assignmentsData&&(this.repopulateStore(i),i.data=e.assignmentsData),e.project&&this.applyProjectResponse(e.project),globalThis.DEBUG&&console.timeEnd("Populating project");const o=await this.commitLoad();return this.isLoadingInlineData=!1,o}setupTemporaryIndices(){const{storage:e}=this.assignmentStore||{};e&&(e.addIndex({property:"event",unique:!1}),e.addIndex({property:"resource",unique:!1}))}removeTemporaryIndices(){const{storage:e}=this.assignmentStore;e.removeIndex("event"),e.removeIndex("resource")}async internalDelayCalculation(e){const t=this;if(t.delayEnteringReplica=!0,t.setupTemporaryIndices(),await delay2(0),t.isDestroyed)return void e();if(t.trigger("delayCalculationStart"),t.trigger("refresh",{isCalculated:!1}),await delay2(0),t.isDestroyed)return void e();t.delayEnteringReplica=!1,t.isRepopulatingStores?t.repopulateReplica.now():(t.trigger("recordsUnlinked"),t.enterReplica(!0));const r=await t.replica.commitAsync();t.isDestroyed?e():(e(r),t.delayedCalculationPromise=null,t.trigger("delayCalculationEnd"),t.removeTemporaryIndices())}scheduleDelayedCalculation(){return this.delayedCalculationPromise?this.delayedCalculationPromise:!1!==this.delayCalculation?this.delayedCalculationPromise=new Promise((e=>this.internalDelayCalculation(e).then())):void 0}async commitLoad(){const e=await this.commitAsync();return this.isDestroyed||this.trigger("load"),e}initializeStm(){const e=this.stmClass||StateTrackingManager;this.setStm(e.new({disabled:!0},this.stm)),this.resetUndoRedoQueuesAfterLoad&&this.ion({load:this.resetStmQueue,thisObj:this}),this.ion({beforeCommit:this.onCommitInitialization,commitFinalized:this.onCommitFinalization,commitRejected:this.onCommitRejection,thisObj:this})}removeRejectedRecordsAdd({transactionResult:e,silenceCommit:t}){var r,n,i;const s=new Map;for(const t of e.entries.values()){const n=t.identifier,{field:i}=n;if(t.isShadow()||!n[IsChronoModelSymbol]||i instanceof ModelBucketField)continue;const a=n.self,o=a.firstStore;!o||t.previous||(null==(r=e.transaction.getLatestStableEntryFor(a.$$))?void 0:r.previous)||(s.has(o)?s.get(o).has(a)||s.get(o).add(a):s.set(o,new Set([a])))}null==(n=this.suspendChangesTracking)||n.call(this);Array.from(s.keys()).sort(((e,t)=>e.removalOrder-t.removalOrder)).forEach((e=>e.remove(s.get(e)))),null==(i=this.resumeChangesTracking)||i.call(this,t),t&&(this.eventStore.acceptChanges(),this.dependencyStore.acceptChanges(),this.resourceStore.acceptChanges(),this.assignmentStore.acceptChanges(),this.calendarManagerStore.acceptChanges())}onCommitRejection(e){this._stmDisabled?(this.replica.isWritingPreviousData=!0,this.isRestoringData=!0,this.removeRejectedRecordsAdd(e),this.isRestoringData=!1,this.replica.isWritingPreviousData=!1):this.rejectStmTransaction()}onCommitInitialization(){const{stm:e}=this;this._stmDisabled=e.disabled,e.isRecording&&e.autoRecord&&(this._stmAutoRecord=!0,e.autoRecord=!1)}onCommitFinalization(){this._stmAutoRecord&&(this.stm.autoRecord=!0,this._stmAutoRecord=!1)}onSTMRestoringStart({source:e}){this.replica&&(this.replica.isWritingPreviousData=!0)}async onSTMRestoringStop({source:e}){this.replica&&(this.replica.isWritingPreviousData=!1);const t=e;t.disable(),await this.commitAsync(),this.isDestroyed||(t.enable(),this.trigger("stateRestoringDone"))}deferUntilRepopulationIfNeeded(e,t,r){this.isRepopulatingStores?(this.detachListeners(e),this.ion({name:e,repopulateReplica:{fn:async()=>{await this.commitAsync(),this.isDestroyed||t(...r)},once:!0}})):t(...r)}get isRepopulatingStores(){var e;return Boolean(null==(e=this.repopulateStores)?void 0:e.size)}repopulateStore(e){var t;const r=this;r.repopulateOnDataset&&e.allCount&&!e.syncDataOnLoad&&(null==(t=r.replica)||t.activeTransaction.stop(),r.repopulateStores||(r.repopulateStores=new Set),r.repopulateStores.add(e),r.repopulateReplica())}repopulateReplica(){const e=this;if(e.delayEnteringReplica)return;const{calendarManagerStore:t,eventStore:r,dependencyStore:n,assignmentStore:i,resourceStore:s,replica:a}=e;a?(e.unlinkStoreRecords(t,r,n,s,i),e.unlinkRecord(e),e.unlinkRecord(e.defaultCalendar),e.trigger("recordsUnlinked"),a.clear()):e.trigger("recordsUnlinked");const o=e.replica=e.createReplica();o.addEntity(e),o.addEntity(e.defaultCalendar),e.joinStoreRecords(t,!0),e.joinStoreRecords(r,!0),e.joinStoreRecords(n,!0),e.joinStoreRecords(s,!0),e.joinStoreRecords(i,!0),e.repopulateStores.clear(),e.trigger("repopulateReplica")}beforeCommitAsync(){return this.repopulateReplica.isPending&&!this.isDelayingCalculation?(this.repopulateReplica.now(),this.replica.commitAsync()):null}unlinkRecord(e){var t;if(null==e?void 0:e.graph){const{activeTransaction:r}=this.replica,{$:n}=e,i=Object.keys(n);for(let e=0;e<i.length;e++){const s=n[i[e]],a=r.getLatestEntryFor(s);if(a){let e=a.getValue();void 0===e&&(e=a.proposedValue),void 0!==e&&(s.DATA=s.field instanceof ModelReferenceField&&null!=(t=null==e?void 0:e.id)?t:e)}}e.graph=null}}unlinkStoreRecords(...e){e.forEach((e=>{this.repopulateStores.has(e)&&!e.syncDataOnLoad||e.traverse((e=>{this.unlinkRecord(e)}),!1,!1,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}))}getGraph(){return this.replica}async addEvents(e){return this.eventStore.add(e),this.commitAsync()}async addEvent(e){return this.eventStore.add(e),this.commitAsync()}includeEvent(e){this.eventStore.add(e)}async removeEvents(e){return this.eventStore.remove(e),this.commitAsync()}excludeEvent(e){this.eventStore.remove(e)}async removeEvent(e){return this.eventStore.remove(e),this.commitAsync()}getStm(){return this.stm}setStm(e){this.stm=e,this.stm.ion({restoringStart:this.onSTMRestoringStart,restoringStop:this.onSTMRestoringStop,thisObj:this})}calculateProject(){return this}*calculateEffectiveCalendar(){let e=yield this.$.calendar;return e?yield e.$.version:e=this.defaultCalendar,e}joinStoreRecords(e,t=!1){const r=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(r,t,!0):e.forEach(r,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}unjoinStoreRecords(e){const t=e=>{e.leaveProject(),e.setProject(this)};e.rootNode?e.rootNode.traverse((r=>{r!==e.rootNode&&t(r)}),!1,!0):e.forEach(t,null,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0})}setEventStore(e){const t=this.eventStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t);const r=t.assignmentsForRemoval;r.forEach((t=>{const n=t.event;if(n){const i=e.getById(n.id);i&&(t.event=i,r.delete(t))}})),t.afterEventRemoval()}if(e&&e instanceof Store)this.eventStore=e,e.setProject(this),this.stm.addStore(e),e.tree&&e.rootNode!==this?(this.appendChild(e.rootNode.children||[]),e.rootNode=this):this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.eventStoreClass;this.eventStore=new t(ObjectHelper.assign({modelClass:this.eventModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.eventStore),this.trigger("eventStoreChange",{store:this.eventStore})}setDependencyStore(e){const t=this.dependencyStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.detachStore(t)),e&&e instanceof Store)this.dependencyStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.dependencyStoreClass;this.dependencyStore=new t(ObjectHelper.assign({modelClass:this.dependencyModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.dependencyStore),this.trigger("dependencyStoreChange",{store:this.dependencyStore})}setResourceStore(e){const t=this.resourceStore;if(t&&this.stm.hasStore(t)){this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t);const r=t.assignmentsForRemoval;r.forEach((t=>{const n=t.resource;if(n){const i=e.getById(n.id);i&&(t.resource=i,r.delete(t))}})),t.afterResourceRemoval()}if(e&&e instanceof Store)this.resourceStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.resourceStoreClass;this.resourceStore=new t(ObjectHelper.assign({modelClass:this.resourceModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.resourceStore),this.trigger("resourceStoreChange",{store:this.resourceStore})}setAssignmentStore(e){const t=this.assignmentStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.unjoinStoreRecords(t),this.detachStore(t)),e&&e instanceof Store)this.assignmentStore=e,e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e);else{const t=(null==e?void 0:e.storeClass)||this.assignmentStoreClass;this.assignmentStore=new t(ObjectHelper.assign({modelClass:this.assignmentModelClass,project:this,stm:this.stm},e||{}))}this.isDelayingCalculation&&this.setupTemporaryIndices(),this.attachStore(this.assignmentStore),this.trigger("assignmentStoreChange",{store:this.assignmentStore})}setCalendarManagerStore(e){const t=this.calendarManagerStore;if(t&&this.stm.hasStore(t)&&(this.stm.removeStore(t),this.detachStore(t)),e&&e instanceof Store)this.calendarManagerStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e));else{const t=(null==e?void 0:e.storeClass)||this.calendarManagerStoreClass;this.calendarManagerStore=new t(ObjectHelper.assign({modelClass:this.calendarModelClass,project:this,stm:this.stm},e||{}))}this.attachStore(this.calendarManagerStore),this.trigger("calendarManagerStoreChange",{store:this.calendarManagerStore})}async isValidDependency(...e){return!0}rejectStmTransaction(e){(e=e||this.stm).transaction&&(e.transaction.length?(e.forEachStore((e=>e.beginBatch())),e.rejectTransaction(),e.forEachStore((e=>e.endBatch()))):e.stopTransaction())}async tryPropagateWithChanges(e){const t=this.stm,r=t.disabled,n=t.autoRecord;r?t.enable():(n&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction()),t.startTransaction(),e();let i=!0;try{i=!(await this.commitAsync()).rejectedWith}catch(e){if(!/cycle/i.test(e))throw e;i=!1}return i?(t.stopTransaction(),r&&t.resetQueue()):(this.replica.reject(),this.rejectStmTransaction(t)),t.disabled=r,t.autoRecord=n,i}isEngineReady(){const{replica:e}=this;return this.delayEnteringReplica||!this.isRepopulatingStores&&(!e||!(e.dirty&&(e.hasPendingAutoCommit()||e.isCommitting)))}static get defaultConfig(){return{assignmentsData:null,calendarsData:null,dependenciesData:null,eventsData:null,resourcesData:null,eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,calendarManagerStore:null,eventModelClass:null,resourceModelClass:null,assignmentModelClass:null,dependencyModelClass:null,calendarModelClass:null,repopulateOnDataset:!0}}static get delayable(){return{repopulateReplica:10}}}return r.applyConfigs=!0,__decorate20([model_field({type:"boolean",defaultValue:!0})],r.prototype,"unspecifiedTimeIsWorking",void 0),__decorate20([model_field({type:"boolean",defaultValue:!1})],r.prototype,"skipNonWorkingTimeWhenSchedulingManually",void 0),__decorate20([model_field({type:"boolean",defaultValue:!0})],r.prototype,"skipNonWorkingTimeInDurationWhenSchedulingManually",void 0),r}))){},__decorate21=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},calculateEffectiveStartDateConstraintInterval=function*(e,t,r,n,i){if(r.isIntervalEmpty())return r;if(i&&r.intersectionOf){const t=new Set;for(const i of r.intersectionOf)if(i.isInfinite())t.add(i);else{const r=i.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(i.startDate,!1,n):i.startDate,s=i.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(i.endDate,!1,n):i.endDate,a=i;t.add(a.copyWith({reflectionOf:a,side:a.side===ConstraintIntervalSide.Start?ConstraintIntervalSide.End:ConstraintIntervalSide.Start,startDate:r,endDate:s}))}r.intersectionOf=t}const s=r.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.startDate,!1,n):null,a=r.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(r.endDate,!1,n):null;return intersectIntervals([t,ConstraintInterval.new({intersectionOf:r.intersectionOf,startDate:s,endDate:a})],i)},calculateEffectiveEndDateConstraintInterval=function*(e,t,r,n,i){if(t.isIntervalEmpty())return t;if(i){const r=new Set;for(const i of t.intersectionOf)if(i.isInfinite())r.add(i);else{const t=i.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(i.startDate,!0,n):i.startDate,s=i.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(i.endDate,!0,n):i.endDate,a=i;r.add(a.copyWith({reflectionOf:a,side:a.side===ConstraintIntervalSide.Start?ConstraintIntervalSide.End:ConstraintIntervalSide.Start,startDate:t,endDate:s}))}t.intersectionOf=r}const s=t.startDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.startDate,!0,n):null,a=t.endDateIsFinite()?yield*e.calculateProjectedXDateWithDuration(t.endDate,!0,n):null;return intersectIntervals([r,ConstraintInterval.new({reflectionOf:s||a?t:void 0,intersectionOf:s||a?t.intersectionOf:void 0,startDate:s,endDate:a})],i)},EarlyLateLazyness=!0,ConstrainedEarlyEventMixin=class extends(Mixin([HasSubEventsMixin],(e=>{const t=e.prototype;class r extends e{*maybeSkipNonWorkingTime(e,t=!0){if(yield*this.hasSubEvents())return e;let r=yield*this.calculateEffectiveDuration();return e&&r>0?yield*this.skipNonWorkingTime(e,t):e}*calculateEffectiveConstraintInterval(e,t,r,n=!1){const i=yield*this.calculateEffectiveDuration();if(null==i)return null;const s=e?calculateEffectiveStartDateConstraintInterval:calculateEffectiveEndDateConstraintInterval;return yield*s(this,intersectIntervals(t,n),intersectIntervals(r,n),i,n)}*calculateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateEarlyEndDateConstraintIntervals(){return[]}*doCalculateEarlyEffectiveStartDateInterval(e=!1){const t=yield this.$.earlyStartDateConstraintIntervals,r=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!0,t.concat(yield this.$.startDateConstraintIntervals),r.concat(yield this.$.endDateConstraintIntervals),e)}*calculateEarlyEffectiveStartDateInterval(){return yield*this.doCalculateEarlyEffectiveStartDateInterval()}*doCalculateEarlyEffectiveEndDateInterval(e=!1){const t=yield this.$.earlyStartDateConstraintIntervals,r=yield this.$.earlyEndDateConstraintIntervals;return yield*this.calculateEffectiveConstraintInterval(!1,t.concat(yield this.$.startDateConstraintIntervals),r.concat(yield this.$.endDateConstraintIntervals),e)}*calculateEarlyEffectiveEndDateInterval(){return yield*this.doCalculateEarlyEffectiveEndDateInterval()}*shouldRollupChildEarlyStartDate(e){return!0}*calculateMinChildrenEarlyStartDate(){let e=MAX_DATE;const t=yield*this.subEventsIterable();for(let r of t){let t;(yield*this.shouldRollupChildEarlyStartDate(r))&&((yield r.$.manuallyScheduled)&&(yield*r.hasSubEvents())&&(t=yield r.$.minChildrenEarlyStartDate),t=t||(yield r.$.earlyStartDate),t&&t<e&&(e=t))}return e.getTime()-MAX_DATE.getTime()?e:null}*shouldRollupChildEarlyEndDate(e){return!0}*calculateMaxChildrenEarlyEndDate(){let e=MIN_DATE;const t=yield*this.subEventsIterable();for(let r of t){let t;(yield*this.shouldRollupChildEarlyEndDate(r))&&((yield r.$.manuallyScheduled)&&(yield*r.hasSubEvents())&&(t=yield r.$.maxChildrenEarlyEndDate),t=t||(yield r.$.earlyEndDate),t&&t>e&&(e=t))}return e.getTime()-MIN_DATE.getTime()?e:null}*calculateEarlyStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Forward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenEarlyStartDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.startDate;let e=yield this.$.earlyEffectiveStartDateInterval;if(null===e)return null;if(e.isIntervalEmpty()){e=yield*this.doCalculateEarlyEffectiveStartDateInterval(!0);const t=ConflictEffect.new({intervals:[...e.intersectionOf]});if((yield t)!==EffectResolutionResult.Cancel)return null;yield Reject(t)}return isDateFinite(e.startDate)?e.startDate:null}*calculateEarlyStartDate(){const e=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateEarlyEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Forward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenEarlyEndDate;if(!(yield*this.isConstrainedEarly()))return yield this.$.endDate;let e=yield this.$.earlyEffectiveEndDateInterval;if(null===e)return null;if(e.isIntervalEmpty()){e=yield*this.doCalculateEarlyEffectiveEndDateInterval(!0);const t=ConflictEffect.new({intervals:[...e.intersectionOf]});if((yield t)!==EffectResolutionResult.Cancel)return null;yield Reject(t)}return isDateFinite(e.startDate)?e.startDate:null}*calculateEarlyEndDate(){return yield this.$.earlyEndDateRaw}*isConstrainedEarly(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.earlyStartDateConstraintIntervals,n=yield this.$.earlyEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==r?void 0:r.length)||(null==n?void 0:n.length))}*calculateStartDatePure(){return(yield this.$.direction)===Direction.Forward?!(yield*this.isConstrainedEarly())||globalThis.isInitLoad||(yield this.$.unscheduled)?yield*t.calculateStartDatePure.call(this):(yield this.$.earlyStartDate)||(yield*t.calculateStartDatePure.call(this)):yield*t.calculateStartDatePure.call(this)}*calculateStartDateProposed(){if((yield this.$.direction)===Direction.Forward){if(!(yield*this.isConstrainedEarly())||globalThis.isInitLoad||(yield this.$.unscheduled))return yield*t.calculateStartDateProposed.call(this);const e=yield this.$.earlyStartDate;if(e){if(isDateFinite(e))return e;const r=yield*t.calculateStartDateProposed.call(this),n=yield this.$.earlyEffectiveStartDateInterval;return n.containsDate(r)?r:isDateFinite(n.endDate)?n.endDate:r}return yield*t.calculateStartDateProposed.call(this)}return yield*t.calculateStartDateProposed.call(this)}*calculateEndDatePure(){return(yield this.$.direction)===Direction.Forward?!(yield*this.isConstrainedEarly())||globalThis.isInitLoad||(yield this.$.unscheduled)?yield*t.calculateEndDatePure.call(this):(yield this.$.earlyEndDate)||(yield*t.calculateEndDatePure.call(this)):yield*t.calculateEndDatePure.call(this)}*calculateEndDateProposed(){if((yield this.$.direction)===Direction.Forward){if(!(yield*this.isConstrainedEarly())||globalThis.isInitLoad||(yield this.$.unscheduled))return yield*t.calculateEndDateProposed.call(this);const e=yield this.$.earlyEndDate;if(e){if(isDateFinite(e))return e;const r=yield*t.calculateEndDateProposed.call(this),n=yield this.$.earlyEffectiveEndDateInterval;return n.containsDate(r)?r:isDateFinite(n.endDate)?n.endDate:r}return yield*t.calculateEndDateProposed.call(this)}return yield*t.calculateEndDateProposed.call(this)}*calculateDirection(){const e=this.getProject();return yield e.$.direction}}return __decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"minChildrenEarlyStartDate",void 0),__decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"earlyStartDateRaw",void 0),__decorate21([model_field({type:"date",persist:!1},{lazy:EarlyLateLazyness,converter:dateConverter,persistent:!1})],r.prototype,"earlyStartDate",void 0),__decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"maxChildrenEarlyEndDate",void 0),__decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"earlyEndDateRaw",void 0),__decorate21([model_field({type:"date",persist:!1},{lazy:EarlyLateLazyness,converter:dateConverter,persistent:!1})],r.prototype,"earlyEndDate",void 0),__decorate21([field()],r.prototype,"startDateConstraintIntervals",void 0),__decorate21([field()],r.prototype,"endDateConstraintIntervals",void 0),__decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"earlyStartDateConstraintIntervals",void 0),__decorate21([field({lazy:EarlyLateLazyness})],r.prototype,"earlyEndDateConstraintIntervals",void 0),__decorate21([field()],r.prototype,"earlyEffectiveStartDateInterval",void 0),__decorate21([field()],r.prototype,"earlyEffectiveEndDateInterval",void 0),__decorate21([calculate("startDateConstraintIntervals")],r.prototype,"calculateStartDateConstraintIntervals",null),__decorate21([calculate("endDateConstraintIntervals")],r.prototype,"calculateEndDateConstraintIntervals",null),__decorate21([calculate("earlyStartDateConstraintIntervals")],r.prototype,"calculateEarlyStartDateConstraintIntervals",null),__decorate21([calculate("earlyEndDateConstraintIntervals")],r.prototype,"calculateEarlyEndDateConstraintIntervals",null),__decorate21([calculate("earlyEffectiveStartDateInterval")],r.prototype,"calculateEarlyEffectiveStartDateInterval",null),__decorate21([calculate("earlyEffectiveEndDateInterval")],r.prototype,"calculateEarlyEffectiveEndDateInterval",null),__decorate21([calculate("minChildrenEarlyStartDate")],r.prototype,"calculateMinChildrenEarlyStartDate",null),__decorate21([calculate("maxChildrenEarlyEndDate")],r.prototype,"calculateMaxChildrenEarlyEndDate",null),__decorate21([calculate("earlyStartDateRaw")],r.prototype,"calculateEarlyStartDateRaw",null),__decorate21([calculate("earlyStartDate")],r.prototype,"calculateEarlyStartDate",null),__decorate21([calculate("earlyEndDateRaw")],r.prototype,"calculateEarlyEndDateRaw",null),__decorate21([calculate("earlyEndDate")],r.prototype,"calculateEarlyEndDate",null),__decorate21([calculate("direction")],r.prototype,"calculateDirection",null),r}))){},__decorate22=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasDateConstraintMixin=class extends(Mixin([ConstrainedEarlyEventMixin,HasChildrenMixin],(e=>{const t=e.prototype;class r extends e{constructor(){super(...arguments),this.ignorePinningConstraint=!1}writeStartDate(e,r,n,i,s=!0){const a=this.getProject();if((null==a?void 0:a.addConstraintOnDateSet)&&r.graph.hasIdentifier(this.$.direction)&&!(null==a?void 0:a.eventStore.isSyncingDataOnLoad)&&!this.isReverting&&!(null==a?void 0:a.getStm().isRestoring)){const e=this.getStartDatePinConstraintType();e&&(this.constraintType=e,this.constraintDate=i)}return t.writeStartDate.call(this,e,r,n,i,s)}writeEndDate(e,r,n,i,s=!1){const a=this.getProject();if((null==a?void 0:a.addConstraintOnDateSet)&&r.graph.hasIdentifier(this.$.direction)&&s&&!(null==a?void 0:a.eventStore.isSyncingDataOnLoad)&&!(null==a?void 0:a.getStm().isRestoring)){const e=this.getEndDatePinConstraintType();e&&(this.constraintType=e,this.constraintDate=i)}return t.writeEndDate.call(this,e,r,n,i,s)}*calculateConstraintType(){let e=yield ProposedOrPrevious;return(yield*this.isConstraintTypeApplicable(e))||(e=null),e}*calculateConstraintDate(e){let t=yield ProposedOrPrevious;const r=yield this.$.constraintType;return r?t||(t=this.getConstraintTypeDefaultDate(e,r)):t=null,t}getStartDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Direction.Forward:return ConstraintType.StartNoEarlierThan;case Direction.Backward:return ConstraintType.StartNoLaterThan}}getEndDatePinConstraintType(){const{direction:e}=this;if(!this.isTaskPinnableWithConstraint())return null;switch(e){case Direction.Forward:return ConstraintType.FinishNoEarlierThan;case Direction.Backward:return ConstraintType.FinishNoLaterThan}}isTaskPinnableWithConstraint(){const{manuallyScheduled:e,ignorePinningConstraint:t,constraintType:r}=this;let n=!1;if(!e&&!t)if(r)switch(r){case ConstraintType.StartNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.FinishNoEarlierThan:case ConstraintType.FinishNoLaterThan:n=!0}else n=!0;return n}applyChangeset(e,t,r){this.ignorePinningConstraint=r;const n=super.applyChangeset(e,t,r);return this.ignorePinningConstraint=!1,n}getConstraintTypeDefaultDate(e,t){switch(t){case ConstraintType.StartNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.MustStartOn:return e(ProposedOrPreviousValueOf(this.$.startDate));case ConstraintType.FinishNoEarlierThan:case ConstraintType.FinishNoLaterThan:case ConstraintType.MustFinishOn:return e(ProposedOrPreviousValueOf(this.$.endDate))}return null}*isConstraintTypeApplicable(e){const t=yield*this.hasSubEvents();switch(e){case ConstraintType.FinishNoEarlierThan:case ConstraintType.StartNoLaterThan:case ConstraintType.MustFinishOn:case ConstraintType.MustStartOn:return!t}return!0}async setConstraint(e,t){return this.constraintType=e,void 0!==t&&(this.constraintDate=t),this.commitAsync()}*calculateEndDateConstraintIntervals(){const e=yield*t.calculateEndDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,n=yield this.$.constraintType,i=yield this.$.constraintDate,s=this.project.dateConstraintIntervalClass;if(!r&&n&&i)switch(n){case ConstraintType.MustFinishOn:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.End,startDate:i,endDate:i}));break;case ConstraintType.FinishNoEarlierThan:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.End,startDate:i}));break;case ConstraintType.FinishNoLaterThan:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.End,endDate:i}))}return e}*calculateStartDateConstraintIntervals(){const e=yield*t.calculateStartDateConstraintIntervals.call(this),r=yield this.$.manuallyScheduled,n=yield this.$.constraintType,i=yield this.$.constraintDate,s=this.project.dateConstraintIntervalClass;if(!r&&n&&i)switch(n){case ConstraintType.MustStartOn:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.Start,startDate:i,endDate:i}));break;case ConstraintType.StartNoEarlierThan:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.Start,startDate:i}));break;case ConstraintType.StartNoLaterThan:e.unshift(s.new({owner:this,side:ConstraintIntervalSide.Start,endDate:i}))}return e}}return __decorate22([model_field({type:"string"},{sync:!0})],r.prototype,"constraintType",void 0),__decorate22([model_field({type:"date"},{converter:dateConverter,sync:!0})],r.prototype,"constraintDate",void 0),__decorate22([calculate("constraintType")],r.prototype,"calculateConstraintType",null),__decorate22([calculate("constraintDate")],r.prototype,"calculateConstraintDate",null),r}))){},RemoveDateConstraintConflictResolution=class extends(Localizable_default(ConflictResolution)){static get $name(){return"RemoveDateConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return format(this.L("L{descriptionTpl}"),e.name||e.id,this.interval.getConstraintName(e.constraintType))}resolve(){this.event.constraintType=null}},DateConstraintIntervalDescription=class extends ConstraintIntervalDescription{static get $name(){return"DateConstraintIntervalDescription"}static getDescription(e){let t;switch(e.owner.constraintType){case ConstraintType.StartNoEarlierThan:case ConstraintType.FinishNoEarlierThan:case ConstraintType.MustStartOn:case ConstraintType.MustFinishOn:t=this.L("L{startDateDescriptionTpl}");break;case ConstraintType.StartNoLaterThan:case ConstraintType.FinishNoLaterThan:t=this.L("L{endDateDescriptionTpl}")}return format(t,...this.getDescriptionParameters(e))}static getConstraintName(e){return this.L("L{constraintTypeTpl}")[e]}static getDescriptionParameters(e){const t=e.owner;return[DateHelper.format(e.startDate,this.L("L{dateFormat}")),DateHelper.format(e.endDate,this.L("L{dateFormat}")),t.name||t.id,this.getConstraintName(t.constraintType)]}},DateConstraintInterval=class extends ConstraintInterval{getConstraintName(e){return this.descriptionBuilderClass.getConstraintName(e||this.owner.constraintType)}getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const t=this.owner,r=(e=e||t.graph.activeTransaction).entries.get(t.$.constraintDate),n=e.entries.get(t.$.constraintType);return!e.baseRevision.hasIdentifier(t.$$)||r&&!r.isShadow()||n&&!n.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.removeDateConstraintConflictResolutionClass.new({interval:this})])}};__decorate22([prototypeValue(RemoveDateConstraintConflictResolution)],DateConstraintInterval.prototype,"removeDateConstraintConflictResolutionClass",void 0),__decorate22([prototypeValue(DateConstraintIntervalDescription)],DateConstraintInterval.prototype,"descriptionBuilderClass",void 0);var __decorate23=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ScheduledByDependenciesEarlyEventMixin=class extends(Mixin([ConstrainedEarlyEventMixin,HasDependenciesMixin],(e=>{const t=e.prototype;class r extends e{*shouldPredecessorAffectScheduling(e){const t=yield e.$.fromEvent;return t&&!isAtomicValue(t)&&(yield e.$.active)&&(!(yield t.$.inactive)||(yield this.$.inactive))}*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=this.getProject(),n=r.dependencyConstraintIntervalClass;for(const t of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(t)))continue;const i=yield t.$.fromEvent;let s;switch(yield t.$.type){case DependencyType.EndToStart:s=yield i.$.earlyEndDateRaw;break;case DependencyType.StartToStart:s=yield i.$.earlyStartDateRaw}if(s){const i=yield t.$.lag,a=yield t.$.lagUnit,o=yield t.$.calendar;yield o.$.version;const l=n.new({owner:t,startDate:o.calculateEndDate(s,yield*r.$convertDuration(i,a,TimeUnit.Millisecond)),endDate:null});e.unshift(l)}}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*t.calculateEarlyEndDateConstraintIntervals.call(this),r=this.getProject(),n=r.dependencyConstraintIntervalClass;for(const t of yield this.$.incomingDeps){if(!(yield*this.shouldPredecessorAffectScheduling(t)))continue;const i=yield t.$.fromEvent;let s;switch(yield t.$.type){case DependencyType.EndToEnd:s=yield i.$.earlyEndDateRaw;break;case DependencyType.StartToEnd:s=yield i.$.earlyStartDateRaw}if(s){const i=yield t.$.lag,a=yield t.$.lagUnit,o=yield t.$.calendar;yield o.$.version;const l=n.new({owner:t,startDate:o.calculateEndDate(s,yield*r.$convertDuration(i,a,TimeUnit.Millisecond)),endDate:null});e.unshift(l)}}return e}}return __decorate23([model_field({type:"boolean"})],r.prototype,"inactive",void 0),r}))){},BaseDependencyResolution=class extends(Localizable_default(ConflictResolution)){static get $name(){return"BaseDependencyResolution"}getDescription(){const{dependency:e}=this,{type:t,fromEvent:r,toEvent:n}=e;return format(this.L("L{descriptionTpl}"),this.L("L{DependencyType.long}")[t],r.name||r.id,n.name||n.id)}},RemoveDependencyResolution=class extends BaseDependencyResolution{static get $name(){return"RemoveDependencyResolution"}resolve(){this.dependency.remove()}},DeactivateDependencyResolution=class extends BaseDependencyResolution{static get $name(){return"DeactivateDependencyResolution"}resolve(){this.dependency.active=!1}},DependencyConstraintIntervalDescription=class extends ConstraintIntervalDescription{static get $name(){return"DependencyConstraintIntervalDescription"}static getDescriptionParameters(e){const t=e.owner;return[DateHelper.format(e.startDate,this.L("L{dateFormat}")),DateHelper.format(e.endDate,this.L("L{dateFormat}")),this.L("L{DependencyType.long}")[t.type],t.fromEvent.name,t.toEvent.name]}},DependencyConstraintInterval=class extends ConstraintInterval{isAffectedByTransaction(e){const t=this.owner;e=e||t.graph.activeTransaction;const{entries:r}=e,{fromEvent:n,toEvent:i,lag:s,lagUnit:a,type:o}=t.$,l=r.get(n),c=r.get(i),d=r.get(s),u=r.get(a),h=r.get(o);return!e.baseRevision.hasIdentifier(t.$$)||l&&!l.isShadow()||c&&!c.isShadow()||d&&!d.isShadow()||u&&!u.isShadow()||h&&!h.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.deactivateDependencyConflictResolutionClass.new({dependency:this.owner}),this.removeDependencyConflictResolutionClass.new({dependency:this.owner})])}};__decorate23([prototypeValue(RemoveDependencyResolution)],DependencyConstraintInterval.prototype,"removeDependencyConflictResolutionClass",void 0),__decorate23([prototypeValue(DeactivateDependencyResolution)],DependencyConstraintInterval.prototype,"deactivateDependencyConflictResolutionClass",void 0),__decorate23([prototypeValue(DependencyConstraintIntervalDescription)],DependencyConstraintInterval.prototype,"descriptionBuilderClass",void 0);var __decorate24=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SchedulerProAssignmentMixin=class extends(Mixin([BaseAssignmentMixin],(e=>{e.prototype;class t extends e{*calculateUnits(){const e=yield this.$.event;return e?yield*e.calculateAssignmentUnits(this):yield ProposedOrPrevious}*calculateEffort(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,r=yield e.$.endDate,n=yield e.$.effectiveCalendar;if(t&&r){const i=new Map;return i.set(n,[this]),yield*e.calculateProjectedEffort(t,r,i)}}return null}*calculateActualDate(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,r=yield e.$.duration,n=yield e.$.percentDone;return yield*e.calculateProjectedXDateWithDuration(t,!0,.01*r*n)}return null}*calculateActualEffort(){const e=yield this.$.event;if(e){const t=yield e.$.startDate,r=yield e.$.effectiveCalendar,n=yield this.$.actualDate,i=new Map;return i.set(r,[this]),yield*e.calculateProjectedEffort(t,n,i)}return null}}return __decorate24([model_field({type:"number",defaultValue:100})],t.prototype,"units",void 0),__decorate24([calculate("units")],t.prototype,"calculateUnits",null),__decorate24([field({lazy:!0})],t.prototype,"effort",void 0),__decorate24([field({lazy:!0})],t.prototype,"actualDate",void 0),__decorate24([field({lazy:!0})],t.prototype,"actualEffort",void 0),__decorate24([calculate("effort")],t.prototype,"calculateEffort",null),__decorate24([calculate("actualDate")],t.prototype,"calculateActualDate",null),__decorate24([calculate("actualEffort")],t.prototype,"calculateActualEffort",null),t}))){},__decorate25=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SchedulerProDependencyMixin=class extends(Mixin([BaseDependencyMixin],(e=>{e.prototype;class t extends e{*calculateCalendar(){const e=this.getProject();let t;switch(yield e.$.dependenciesCalendar){case DependenciesCalendar.Project:t=yield e.$.effectiveCalendar;break;case DependenciesCalendar.FromEvent:const r=yield this.$.fromEvent;t=r&&!isAtomicValue(r)?yield r.$.effectiveCalendar:null;break;case DependenciesCalendar.ToEvent:const n=yield this.$.toEvent;t=n&&!isAtomicValue(n)?yield n.$.effectiveCalendar:null}return t||(t=yield e.$.effectiveCalendar),t}async setLag(e,t){if(this.graph)return this.graph.write(this.$.lag,e,t),this.graph.commitAsync();this.$.lag.DATA=e,null!=t&&(this.$.lagUnit.DATA=t)}writeLag(e,t,r,n,i=void 0){e.constructor.prototype.write.call(this,e,t,r,n),null!=i&&t.write(this.$.lagUnit,i)}}return __decorate25([model_field({type:"number",defaultValue:0})],t.prototype,"lag",void 0),__decorate25([model_field({type:"string",defaultValue:TimeUnit.Day},{converter:DateHelper.normalizeUnit})],t.prototype,"lagUnit",void 0),__decorate25([field()],t.prototype,"calendar",void 0),__decorate25([model_field({type:"boolean",defaultValue:!0,persist:!0})],t.prototype,"active",void 0),__decorate25([calculate("calendar")],t.prototype,"calculateCalendar",null),__decorate25([write("lag")],t.prototype,"writeLag",null),t}))){},__decorate26=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasPercentDoneMixin=class extends(Mixin([HasChildrenMixin],(e=>{e.prototype;class t extends e{*calculatePercentDone(){const e=yield this.$.childEvents,t=this.getProject(),r=yield t.$.autoCalculatePercentDoneForParentTasks;if(e.size&&r){const e=yield this.$.percentDoneSummaryData;return e.totalDuration>0?e.completedDuration/e.totalDuration:e.milestonesNum>0?e.milestonesTotalPercentDone/e.milestonesNum:null}return yield ProposedOrPrevious}*shouldRollupChildPercentDoneSummaryData(e){return!0}*calculatePercentDoneSummaryData(){const e=yield this.$.childEvents;if(e.size){let t={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const r of e){if(!(yield*this.shouldRollupChildPercentDoneSummaryData(r)))continue;const e=yield r.$.percentDoneSummaryData;e&&(t.totalDuration+=e.totalDuration,t.completedDuration+=e.completedDuration,t.milestonesNum+=e.milestonesNum,t.milestonesTotalPercentDone+=e.milestonesTotalPercentDone)}return t}{const e=yield this.$.duration;if("number"==typeof e){const t=yield*this.getProject().$convertDuration(e,yield this.$.durationUnit,TimeUnit.Millisecond),r=yield this.$.percentDone;return{totalDuration:t,completedDuration:t*r,milestonesNum:0===t?1:0,milestonesTotalPercentDone:0===t?r:0}}return null}}}return __decorate26([model_field({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),__decorate26([field()],t.prototype,"percentDoneSummaryData",void 0),__decorate26([calculate("percentDone")],t.prototype,"calculatePercentDone",null),__decorate26([calculate("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t}))){},__decorate27=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SchedulerProHasAssignmentsMixin=class extends(Mixin([BaseHasAssignmentsMixin],(e=>{const t=e.prototype;class r extends e{*hasProposedValueForUnits(){const e=yield this.$.assigned;for(const t of e){if((yield t.$.resource)&&(yield HasProposedValue(t.$.units)))return!0}return!1}async assign(e,t=100){const r=this.getProject().assignmentStore.modelClass;return this.addAssignment(new r({event:this,resource:e,units:t})),this.commitAsync()}*forEachAvailabilityInterval(e,t){const r=yield this.$.effectiveCalendar,n=yield this.$.assignmentsByCalendar,i=yield this.$.effectiveCalendarsCombination,s=(yield this.$.ignoreResourceCalendar)||e.ignoreResourceCalendar||!n.size,a=this.getProject().maxCalendarRange;return a&&(e=Object.assign({maxRange:a},e)),i.forEachAvailabilityInterval(e,((e,i,a)=>{const o=a.getCalendarsWorkStatus(),l=a.getCalendarsWorking();if(o.get(r)&&(s||l.some((e=>n.has(e)))))return t(e,i,a)}))}*calculateEffectiveCalendarsCombination(){const e=[...(yield this.$.assignmentsByCalendar).keys(),yield this.$.effectiveCalendar];return this.getProject().combineCalendars(e)}*calculateAssignmentsByCalendar(){const e=yield this.$.assigned,t=new Map;for(const r of e){const e=yield r.$.resource;if(e){const n=yield e.$.effectiveCalendar;let i=t.get(n);i||(i=[],t.set(n,i)),i.push(r)}}return t}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendar:!1}}*useEventAvailabilityIterator(){return(yield this.$.assignmentsByCalendar).size>0}*skipNonWorkingTime(e,r=!0,n){if(!e)return null;const i=yield this.$.assignmentsByCalendar,s=yield this.$.ignoreResourceCalendar;if(yield*this.useEventAvailabilityIterator()){const t=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),r?{startDate:e,isForward:r}:{endDate:e,isForward:r},n);let a;const o=yield*this.forEachAvailabilityInterval(t,((e,t,n)=>(a=r?e:t,!1)));if(o===CalendarIteratorResult.MaxRangeReached||o===CalendarIteratorResult.FullRangeIterated){const n=[yield this.$.effectiveCalendar];t.ignoreResourceCalendar||s||n.push(...i.keys());const a=EmptyCalendarEffect.new({event:this,calendars:n,date:e,isForward:r});if((yield a)!==EffectResolutionResult.Cancel)return null;yield Reject(a)}return new Date(a)}return yield*t.skipNonWorkingTime.call(this,e,r)}*calculateProjectedDuration(e,r,n,i){if(!e||!r)return null;if(yield*this.useEventAvailabilityIterator()){const t=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:e,endDate:r,isForward:!0},i),s=this.getProject().adjustDurationToDST;let a=0;return yield*this.forEachAvailabilityInterval(t,((e,t)=>{if(a=t.getTime()-e.getTime(),s){const r=e.getTimezoneOffset()-t.getTimezoneOffset();a+=60*r*1e3}})),n||(n=yield this.$.durationUnit),yield*this.getProject().$convertDuration(a,TimeUnit.Millisecond,n)}return yield*t.calculateProjectedDuration.call(this,e,r,n)}*calculateProjectedXDateWithDuration(e,t=!0,r,n,i){if(null==r||isNaN(r)||null==e)return null;if(0==r)return e;n=n||(yield this.$.durationUnit);const s=yield*this.getProject().$convertDuration(r,n,TimeUnit.Millisecond);let a=e.getTime(),o=s;const l=yield this.$.effectiveCalendar;if(yield*this.useEventAvailabilityIterator()){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t},i),n=this.getProject().adjustDurationToDST;return(yield*this.forEachAvailabilityInterval(r,((e,r,i)=>{const s=e.getTime(),l=r.getTime(),c=l-s;if(c>=o){if(n){const n=t?e.getTimezoneOffset()-new Date(s+o).getTimezoneOffset():new Date(l-o).getTimezoneOffset()-r.getTimezoneOffset();o-=60*n*1e3}return a=t?s+o:l-o,!1}if(o-=c,n){const t=e.getTimezoneOffset()-r.getTimezoneOffset();o-=60*t*1e3}})))===CalendarIteratorResult.StoppedByIterator?new Date(a):null}return l.accumulateWorkingTime(e,s,t).finalDate}}return __decorate27([field()],r.prototype,"effectiveCalendarsCombination",void 0),__decorate27([field()],r.prototype,"assignmentsByCalendar",void 0),__decorate27([model_field({type:"boolean"})],r.prototype,"ignoreResourceCalendar",void 0),__decorate27([calculate("effectiveCalendarsCombination")],r.prototype,"calculateEffectiveCalendarsCombination",null),__decorate27([calculate("assignmentsByCalendar")],r.prototype,"calculateAssignmentsByCalendar",null),r}))){},__decorate28=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},MasterStartDateVar=Symbol("MasterStartDateVar"),MasterEndDateVar=Symbol("MasterEndDateVar"),MasterDurationVar=Symbol("MasterDurationVar"),MasterTotalDurationVar=Symbol("MasterTotalDurationVar"),StartOffsetVar=Symbol("StartOffsetVar"),EndOffsetVar=Symbol("EndOffsetVar"),durationByOffsetsFormula=Formula.new({output:DurationVar,inputs:new Set([StartOffsetVar,EndOffsetVar])}),startDateByMasterStartAndStartOffsetFormula=Formula.new({output:StartDateVar,inputs:new Set([StartOffsetVar,MasterStartDateVar])}),endDateByMasterStartAndEndOffsetFormula=Formula.new({output:EndDateVar,inputs:new Set([EndOffsetVar,MasterStartDateVar])}),startOffsetByMasterStartAndStartDateFormula=Formula.new({output:StartOffsetVar,inputs:new Set([StartDateVar,MasterStartDateVar])}),endOffsetByMasterStartAndEndDateFormula=Formula.new({output:EndOffsetVar,inputs:new Set([EndDateVar,MasterStartDateVar])}),startOffsetByEndOffsetAndDurationFormula=Formula.new({output:StartOffsetVar,inputs:new Set([EndOffsetVar,DurationVar])}),endOffsetByStartOffsetAndDurationFormula=Formula.new({output:EndOffsetVar,inputs:new Set([StartOffsetVar,DurationVar])}),endOffsetByMasterTotalDurationAndStartOffsetFormula=Formula.new({output:EndOffsetVar,inputs:new Set([StartOffsetVar,MasterTotalDurationVar])}),endOffsetByMasterDurationAndStartOffsetFormula=Formula.new({output:EndOffsetVar,inputs:new Set([StartOffsetVar,MasterDurationVar])}),durationByMasterEndDateFormula=Formula.new({output:DurationVar,inputs:new Set([StartOffsetVar,MasterEndDateVar])}),segmentCycleDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,MasterStartDateVar,MasterEndDateVar,MasterDurationVar,MasterTotalDurationVar,StartOffsetVar,EndOffsetVar]),formulas:new Set([durationByOffsetsFormula,startDateByMasterStartAndStartOffsetFormula,endDateByMasterStartAndEndOffsetFormula,startOffsetByEndOffsetAndDurationFormula,startOffsetByMasterStartAndStartDateFormula,endOffsetByStartOffsetAndDurationFormula,endOffsetByMasterTotalDurationAndStartOffsetFormula,endOffsetByMasterDurationAndStartOffsetFormula,endOffsetByMasterStartAndEndDateFormula,durationByMasterEndDateFormula])}),segmentCycleResolution=CycleResolution.new({description:segmentCycleDescription,defaultResolutionFormulas:new Set([endDateByMasterStartAndEndOffsetFormula,endOffsetByMasterStartAndEndDateFormula,endOffsetByStartOffsetAndDurationFormula])}),SegmentSEDDispatcherIdentifier=class extends(FieldIdentifier.mix(CalculatedValueGen)){equality(e,t){const r=e.resolution,n=t.resolution;return r.get(StartDateVar)===n.get(StartDateVar)&&r.get(EndDateVar)===n.get(EndDateVar)&&r.get(DurationVar)===n.get(DurationVar)&&r.get(MasterStartDateVar)===n.get(MasterStartDateVar)&&r.get(MasterEndDateVar)===n.get(MasterEndDateVar)&&r.get(MasterDurationVar)===n.get(MasterDurationVar)&&r.get(MasterTotalDurationVar)===n.get(MasterTotalDurationVar)&&r.get(StartOffsetVar)===n.get(StartOffsetVar)&&r.get(EndOffsetVar)===n.get(EndOffsetVar)}},SchedulerProEventSegment=class extends(Mixin([BaseEventMixin],(e=>{class t extends e{get isEventSegment(){return!0}get stm(){var e;return null==(e=this.event)?void 0:e.stm}set stm(e){}writeStartDate(e,t,r,n,i=!0){const s=this.event,a=this.getProject();if(!s||this.previousSegment||!t.baseRevision.hasIdentifier(e)||a&&a.getStm().isRestoring?e.constructor.prototype.write.call(this,e,t,r,n,i):s.$.startDate.constructor.prototype.write.call(this,s.$.startDate,t,null,n,i),i&&this.nextSegment){const e=this.endOffset-this.nextSegment.startOffset;if(e>0){let t=this;for(;t=t.nextSegment;)t.startOffset+=e,t.endOffset+=e}}}shouldRecordFieldChange(e,t,r){return"startOffset"===e||"endOffset"===e||super.shouldRecordFieldChange(e,t,r)}*calculateStartOffset(){const e=(yield this.$.dispatcher).resolution.get(StartOffsetVar);if(!this.event)return yield ProposedOrPrevious;let t;if(e===CalculateProposed)t=yield ProposedOrPrevious;else if(e===startOffsetByEndOffsetAndDurationFormula.formulaId)t=yield*this.calculateStartOffsetByEndOffsetAndDuration();else if(e===startOffsetByMasterStartAndStartDateFormula.formulaId){const e=yield ProposedOrPreviousValueOf(this.event.$.startDate),r=yield ProposedOrPreviousValueOf(this.$.startDate);t=yield*this.event.calculateProjectedDuration(e,r,TimeUnit.Millisecond,{ignoreSegments:!0})}return t}*calculateEndOffset(){const e=(yield this.$.dispatcher).resolution.get(EndOffsetVar);if(!this.event)return yield ProposedOrPrevious;let t;if(e===CalculateProposed)t=yield ProposedOrPrevious;else if(e===endOffsetByStartOffsetAndDurationFormula.formulaId)t=yield*this.calculateEndOffsetByStartOffsetAndDuration();else if(e===endOffsetByMasterStartAndEndDateFormula.formulaId){const e=yield ProposedOrPreviousValueOf(this.event.$.startDate),r=yield ProposedOrPreviousValueOf(this.$.endDate);t=yield*this.event.calculateProjectedDuration(e,r,TimeUnit.Millisecond,{ignoreSegments:!0})}else e===endOffsetByMasterDurationAndStartOffsetFormula.formulaId?t=yield*this.calculateEndOffsetByMasterDurationAndStartOffset():e===endOffsetByMasterTotalDurationAndStartOffsetFormula.formulaId&&(t=yield*this.calculateEndOffsetByMasterTotalDurationAndStartOffset());return t}*calculateStartDate(){const e=(yield this.$.dispatcher).resolution.get(StartDateVar);if(!this.event)return yield ProposedOrPrevious;let t;return t=e===startDateByMasterStartAndStartOffsetFormula.formulaId?yield*this.calculateStartDateByMasterStartAndStartOffset():yield*super.calculateStartDate(),t}*calculateEndDate(){const e=(yield this.$.dispatcher).resolution.get(EndDateVar);if(!this.event)return yield ProposedOrPrevious;let t;return t=e===endDateByMasterStartAndEndOffsetFormula.formulaId?yield*this.calculateEndDateByMasterStartAndEndOffset():yield*super.calculateEndDate(),t}*calculateDuration(){const e=(yield this.$.dispatcher).resolution.get(DurationVar);if(!this.event)return yield ProposedOrPrevious;let t;return t=e===durationByOffsetsFormula.formulaId||e===durationByMasterEndDateFormula.formulaId?yield*this.calculateDurationByOffsets():yield*super.calculateDuration(),t}buildProposedDispatcher(e,t,r){const n=super.buildProposedDispatcher(e,t,r);return n.addPreviousValueFlag(MasterStartDateVar),n.addPreviousValueFlag(StartOffsetVar),n.addPreviousValueFlag(EndOffsetVar),n}*prepareDispatcher(e){const t=yield*super.prepareDispatcher(e);if(!this.event)return t;if(null!=e(PreviousValueOf(this.event.$.startDate))&&t.addPreviousValueFlag(MasterStartDateVar),e(HasProposedValue(this.event.$.startDate))&&t.addProposedValueFlag(MasterStartDateVar),!e(HasProposedValue(this.event.$.segments))){if(t.collectInfo(e,this.event.$.duration,MasterDurationVar),e(HasProposedValue(this.event.$.endDate))){const r=e(ProposedArgumentsOf(this.event.$.endDate));(null==r?void 0:r[0])||t.addProposedValueFlag(MasterEndDateVar)}const r=e(this.event.$.dispatcher);r.resolution.get(StartDateVar)===CalculateProposed&&r.resolution.get(EndDateVar)===CalculateProposed&&t.addProposedValueFlag(MasterTotalDurationVar)}return t.collectInfo(e,this.$.startOffset,StartOffsetVar),t.collectInfo(e,this.$.endOffset,EndOffsetVar),t}cycleResolutionContext(e){return segmentCycleResolution}*calculateEndOffsetByMasterDurationAndStartOffset(){const e=yield ProposedOrPreviousValueOf(this.event.$.duration),t=yield this.event.$.durationUnit,r=yield this.$.startOffset,n=this.nextSegment;let i,s=yield*this.getProject().$convertDuration(e,t,TimeUnit.Millisecond);const a=[];let o=this;for(;o=o.previousSegment;)a.push(o);for(let e=a.length-1;e>=0;e--){const t=a[e],r=yield ProposedOrPreviousValueOf(t.$.startOffset);s-=(yield ProposedOrPreviousValueOf(t.$.endOffset))-r}return i=s>0?n?r+Math.min(s,(yield ProposedOrPreviousValueOf(this.$.endOffset))-r):r+s:r,i}*calculateEndOffsetByMasterTotalDurationAndStartOffset(){const e=yield ProposedOrPreviousValueOf(this.event.$.startDate),t=yield ProposedOrPreviousValueOf(this.event.$.endDate),r=yield*this.event.calculateProjectedDuration(e,t,TimeUnit.Millisecond,{ignoreSegments:!0}),n=yield ProposedOrPreviousValueOf(this.$.startOffset);let i=yield ProposedOrPreviousValueOf(this.$.endOffset),s=this.nextSegment;return n<=r?i<=r?!s||(yield ProposedOrPreviousValueOf(s.$.startOffset))>=r?r:i:r:yield this.$.startOffset}*calculateStartOffsetByEndOffsetAndDuration(){const e=yield this.$.duration,t=yield this.$.durationUnit;return(yield this.$.endOffset)-(yield*this.event.getProject().$convertDuration(e,t,TimeUnit.Millisecond))}*calculateEndOffsetByStartOffsetAndDuration(){const e=yield this.$.duration,t=yield this.$.durationUnit;return(yield this.$.startOffset)+(yield*this.event.getProject().$convertDuration(e,t,TimeUnit.Millisecond))}*calculateEndDateByMasterStartAndEndOffset(){const e=yield this.event.$.startDate,t=yield this.$.endOffset,r=yield*this.event.calculateProjectedXDateWithDuration(e,!0,t,TimeUnit.Millisecond,{ignoreSegments:!0});return yield*this.event.skipNonWorkingTime(r,!1)}*calculateStartDateByMasterStartAndStartOffset(){const e=yield this.event.$.startDate,t=yield this.$.startOffset,r=yield*this.event.calculateProjectedXDateWithDuration(e,!0,t,TimeUnit.Millisecond,{ignoreSegments:!0});return yield*this.event.skipNonWorkingTime(r)}*calculateDurationByOffsets(){const e=yield this.$.startOffset,t=yield this.$.endOffset,r=yield this.$.durationUnit;return yield*this.getProject().$convertDuration(t-e,TimeUnit.Millisecond,r)}*calculatePercentDone(){if(!this.event)return yield ProposedOrPrevious;const e=yield this.event.$.segments;if(e){const t=yield this.event.$.percentDone,r=yield this.event.$.duration,n=yield this.event.$.durationUnit;let i=.01*t*(yield*this.getProject().$convertDuration(r,n,TimeUnit.Millisecond));for(const t of e){const e=t.startOffset,r=t.endOffset-e;if(t===this)return i>=r?100:i>0?100*i/r:0;i-=r}}return 0}*calculateMinPercent(){const e=this.previousSegment;return this.event?e?yield e.$.endPercentDone:0:yield ProposedOrPrevious}*calculateMaxPercent(){if(!this.event)return yield ProposedOrPrevious;const e=yield this.event.$.duration,t=yield this.event.$.durationUnit;let r=yield*this.getProject().$convertDuration(e,t,TimeUnit.Millisecond);const n=yield this.$.startOffset,i=yield this.$.endOffset;return(yield this.$.startPercentDone)+100*(i-n)/r}*calculateProjectedXDateWithDuration(e,t,r,n){return n||(n=yield this.$.durationUnit),yield*this.event.calculateProjectedXDateWithDuration(e,t,r,n,{ignoreSegments:!0})}*calculateProjectedDuration(e,t,r){return r||(r=yield this.$.durationUnit),yield*this.event.calculateProjectedDuration(e,t,r,{ignoreSegments:!0})}}return __decorate28([field({identifierCls:SegmentSEDDispatcherIdentifier})],t.prototype,"dispatcher",void 0),__decorate28([field()],t.prototype,"startOffset",void 0),__decorate28([field()],t.prototype,"endOffset",void 0),__decorate28([field()],t.prototype,"percentDone",void 0),__decorate28([field()],t.prototype,"startPercentDone",void 0),__decorate28([field()],t.prototype,"endPercentDone",void 0),__decorate28([write("startDate")],t.prototype,"writeStartDate",null),__decorate28([calculate("startOffset")],t.prototype,"calculateStartOffset",null),__decorate28([calculate("endOffset")],t.prototype,"calculateEndOffset",null),__decorate28([calculate("percentDone")],t.prototype,"calculatePercentDone",null),__decorate28([calculate("startPercentDone")],t.prototype,"calculateMinPercent",null),__decorate28([calculate("endPercentDone")],t.prototype,"calculateMaxPercent",null),t}))){},__decorate29=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SegmentsVar=Symbol("SegmentsVar"),segmentsConverter=(e,t,r)=>r.processSegmentsValue(e),startDateByEndDateAndSegmentsFormula=Formula.new({output:StartDateVar,inputs:new Set([EndDateVar,SegmentsVar])}),endDateByStartDateAndSegmentsFormula=Formula.new({output:EndDateVar,inputs:new Set([StartDateVar,SegmentsVar])}),durationByStartDateAndEndDateAndSegmentsFormula=Formula.new({output:DurationVar,inputs:new Set([StartDateVar,EndDateVar,SegmentsVar])}),SEDSGCycleDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,SegmentsVar]),formulas:new Set([endDateByStartDateAndSegmentsFormula,startDateByEndDateAndSegmentsFormula,startDateFormula,endDateFormula,durationFormula])}),SEDSGForwardCycleResolution=CycleResolution.new({description:SEDSGCycleDescription,defaultResolutionFormulas:new Set([endDateFormula,endDateByStartDateAndSegmentsFormula])}),SEDSGBackwardCycleResolution=CycleResolution.new({description:SEDSGCycleDescription,defaultResolutionFormulas:new Set([startDateFormula,startDateByEndDateAndSegmentsFormula])}),SEDSGDispatcherIdentifier=class extends(FieldIdentifier.mix(CalculatedValueGen)){equality(e,t){const r=e.resolution,n=t.resolution;return r.get(StartDateVar)===n.get(StartDateVar)&&r.get(EndDateVar)===n.get(EndDateVar)&&r.get(DurationVar)===n.get(DurationVar)&&r.get(SegmentsVar)===n.get(SegmentsVar)}},SplitEventMixin=class extends(Mixin([SchedulerProHasAssignmentsMixin,HasPercentDoneMixin],(e=>{class t extends e{constructor(){super(...arguments),this._segmentGeneration={}}static get $name(){return"SplitEventMixin"}construct(){this.segmentModelClass=this.getDefaultSegmentModelClass(),super.construct(...arguments)}getDefaultSegmentModelClass(){return SchedulerProEventSegment}*prepareDispatcher(e){const t=yield*super.prepareDispatcher(e);return(yield*this.hasSegmentChangesProposed())&&t.addProposedValueFlag(SegmentsVar),t}cycleResolutionContext(e){const t=e(this.$.direction);return t===Direction.Forward||t===Direction.None?SEDSGForwardCycleResolution:SEDSGBackwardCycleResolution}*hasSegmentChangesProposed(){const e=yield ProposedValueOf(this.$.segments);let t=!1;(yield HasProposedValue(this.$.segments))&&(t=Boolean(e));const r=yield ProposedOrPreviousValueOf(this.$.segments);if(!r)return!1;for(const e of r){const r=yield HasProposedValue(e.$.startDate),n=yield HasProposedValue(e.$.endDate),i=yield HasProposedValue(e.$.duration);(r||n||i)&&(t=!0)}return t}writeSegments(e,t,r,n){if(e.constructor.prototype.write.call(this,e,t,r,n),this.getSegments()&&this.getSegments()!==TombStone){const e=this.project,t=e.replica;for(const r of this.getSegments())r.graph!==t&&(r.setProject(e),t.addEntity(r))}}*doWriteSegments(e,t){if(t=t||[],e.length<=1){const r=e.length?yield*this.getProject().$convertDuration(e[0].endOffset-e[0].startOffset,TimeUnit.Millisecond,yield this.$.durationUnit):0;t.push({identifier:this.$.duration,proposedArgs:[r,null]}),e=null}t.push({identifier:this.$.segments,proposedArgs:[e]}),yield WriteSeveral(t)}*calculateSegments(){yield this.$.dispatcher;const{graph:e,project:t}=this,r=yield PreviousValueOf(this.$.segments);let n=yield ProposedOrPrevious;const i=[];let s=!1;if(n){const t=new Set;let r=null,a=!1;const{baseRevision:o}=e.$activeTransaction;for(const e of n){const n=yield e.$.startOffset,s=yield e.$.endOffset,l=o.hasIdentifier(e.$.startDate)&&(yield ProposedArgumentsOf(e.$.startDate)),c=o.hasIdentifier(e.$.endDate)&&(yield ProposedArgumentsOf(e.$.endDate));if(a=a||(null==l?void 0:l[0])||(null==c?void 0:c[0]),n===s)i.push(e);else if(r&&n<=r.endOffset)if(i.push(e),r.graph){i.push(r);const e=r.startOffset,t=a?s+r.endOffset-n:Math.max(s,r.endOffset),o=r.cls;r=this.segmentModelClass.new({event:this,cls:o,startOffset:e,endOffset:t})}else r.endOffset=a?s+r.endOffset-n:Math.max(s,r.endOffset);else r&&t.add(r),r=e}r&&t.add(r),1===t.size&&i.push(...t),s=i.length>0,s&&(n=Array.from(t)),n.reduce(((e,t,r)=>(e&&(e.nextSegment=t),t.previousSegment=e,t.segmentIndex=r,t)),null),n.length&&(n[n.length-1].nextSegment=null)}else r&&i.push(...r);return i.length&&(i.forEach((e=>e.event=null)),t.ion({commitFinalized:()=>e.removeEntities(i),once:!0})),s&&(yield*this.doWriteSegments(n)),n=(null==n?void 0:n.length)>1?n:null,n}*calculateAdjustedSegments(){yield this.$.dispatcher;let e=yield this.$.segments;yield this.$.startDate;const t=yield this.$.endDate;yield this.$.duration;let r=yield ProposedOrPrevious;if(e){const r=this.project,n=this.graph,i=[],s=[];let a=-1;for(let n=e.length-1;n>=0;n--){const o=e[n],l=yield o.$.startDate,c=yield o.$.endDate;if(!(l>t)){if(c.getTime()!==t.getTime()){const e=o.endOffset+(t.getTime()-c.getTime())-o.startOffset,n=yield*r.$convertDuration(e,TimeUnit.Millisecond,yield o.$.durationUnit);s.push({identifier:o.$.duration,proposedArgs:[n,null]},{identifier:o.$.endDate,proposedArgs:[t,!1]},{identifier:o.$.endOffset,proposedArgs:[o.endOffset+(t.getTime()-c.getTime())]})}break}i.push(o),a=n}let o=!1;a>-1&&(o=!0,e.splice(a),e.length&&(e[e.length-1].nextSegment=null),r.ion({commitFinalized:()=>n.removeEntities(i),once:!0}));let l="";e&&(l=this.getSegmentsSnapshot()),l!==this._lastSegmentsSnapshot&&(o=!0,e=e?e.slice():e,this._lastSegmentsSnapshot=l),o&&(yield*this.doWriteSegments(e,s))}return r}getSegmentsSnapshot(e){return null==(e=e||this.segments)?void 0:e.map((e=>{var t,r;return e.startOffset+"-"+(null==(t=e.startDate)?void 0:t.getTime())+"-"+e.endOffset+"-"+(null==(r=e.endDate)?void 0:r.getTime())})).join(";")}processSegmentsValue(e){let t=e;if(e)for(let t=0;t<e.length;t++){const r=e[t],n=r.isModel?r:this.segmentModelClass.new(r);n.event=this,e[t]=n}return t}*calculateStartDate(){let e;return e=(yield this.$.dispatcher).resolution.get(StartDateVar)===startDateByEndDateAndSegmentsFormula.formulaId?yield*this.calculateStartDateBySegments():yield*super.calculateStartDate(),e}*calculateStartDateBySegments(){yield this.$.dispatcher;const e=yield this.$.segments,t=yield this.$.endDate;let r;if(e){const n=e[e.length-1],i=yield n.$.endOffset,s=yield*this.calculateProjectedXDateWithDuration(t,!1,i,TimeUnit.Millisecond,{ignoreSegments:!0});r=yield*this.skipNonWorkingTime(s,!0)}return r}*calculateEndDateBySegments(){yield this.$.dispatcher;const e=yield this.$.segments,t=yield this.$.startDate;let r;if(e){const n=e[e.length-1],i=yield n.$.endOffset,s=yield*this.calculateProjectedXDateWithDuration(t,!0,i,TimeUnit.Millisecond,{ignoreSegments:!0});r=yield*this.skipNonWorkingTime(s,!1)}return r}*calculateEndDate(){let e;return e=(yield this.$.dispatcher).resolution.get(EndDateVar)===endDateByStartDateAndSegmentsFormula.formulaId?yield*this.calculateEndDateBySegments():yield*super.calculateEndDate(),e}*calculateDurationProposed(){let e;return e=(yield*this.hasSegmentChangesProposed())?yield*this.calculateDurationBySegments():yield*super.calculateDurationProposed(),e}*skipNonWorkingTime(e,t=!0,r){return e?(r=Object.assign({ignoreSegments:!0},r),yield*super.skipNonWorkingTime(e,t,r)):null}*calculateDurationBySegments(){let e;yield this.$.dispatcher;const t=yield this.$.durationUnit,r=yield this.$.segments;if(r){let n=0;for(const e of r)n+=e.endOffset-e.startOffset;e=yield*this.getProject().$convertDuration(n,TimeUnit.Millisecond,t)}return e}*forEachAvailabilityInterval(e,t){const r=yield this.$.effectiveCalendar,n=yield this.$.assignmentsByCalendar,i=yield this.$.effectiveCalendarsCombination,s=!1!==e.isForward,a=(yield this.$.ignoreResourceCalendar)||e.ignoreResourceCalendar||!n.size,o=this.getProject().maxCalendarRange;let l,c,d,u,h,g=e.ignoreSegments,p=1;return g||(u=yield this.$.segments,g=g||!u,g||(u=u.slice(),s?(l=u.shift(),c=0,p=1,h=l.nextSegment?l.endOffset:MAX_DATE.getTime()):(l=u.pop(),c=l.endOffset,p=-1,h=l.endOffset),d=h-l.startOffset)),i.forEachAvailabilityInterval(Object.assign({maxRange:o},e),((e,i,o)=>{const m=o.getCalendarsWorkStatus(),f=o.getCalendarsWorking();if(m.get(r)&&(a||f.some((e=>n.has(e))))){if(g)return t(e,i,o);{const r=e.getTime();let n,a,g=i.getTime()-e.getTime();if(this.getProject().adjustDurationToDST){g+=60*(e.getTimezoneOffset()-i.getTimezoneOffset())*1e3}for(s?(n=c,a=c+g):(n=c-g,a=c);l&&n<=h&&a>l.startOffset;){const e=Math.max(n,l.startOffset),i=Math.min(a,h),c=new Date(r+e-n),g=new Date(r+i-n);if(!1===t(c,g,o))return!1;if(d-=g.getTime()-c.getTime(),d)break;l=s?u.shift():u.pop(),l&&(h=!s||l.nextSegment?l.endOffset:MAX_DATE.getTime(),d=h-l.startOffset)}c+=p*g}}}))}*useEventAvailabilityIterator(){return!(yield this.$.manuallyScheduled)}get isSegmented(){const e=this.segments;return Boolean(null==e?void 0:e.length)}getSegmentByDate(e,t){if(t=t||this.getSegments()){return t[this.getSegmentIndexByDate(e,t)]}}getSegmentIndexByDate(e,t){return(t=t||this.getSegments())?t.findIndex((t=>e>=t.startDate&&e<t.endDate)):-1}get firstSegment(){const e=this.getSegments();return e?e[0]:null}get lastSegment(){const e=this.getSegments();return e?e[e.length-1]:null}getSegment(e){const t=this.getSegments();return null==t?void 0:t[e]}async splitToSegments(e,t=1,r){var n;const i=this.getProject();await i.commitAsync();const s=this;if(!e||s.isHasSubEventsMixin&&(null==(n=s.childEvents)?void 0:n.size))return;const a=s.duration,o=s.durationUnit,l=s.startDate,c=s.endDate;if(r=r?DateHelper.normalizeUnit(r):o,!l||!c||l>=e||e>=c||!a)return;const d=s.isSegmented;let u,h,g=s.segments||[];if(d&&(h=s.getSegmentIndexByDate(e,g),u=g[h],!u))return;const p=u||s,m=u?p.startDate:l,f=p.duration,v=p.durationUnit,y=s.run("calculateProjectedDuration",m,e,v,{ignoreSegments:!0}),b=f-y,C=i.run("$convertDuration",t,r,TimeUnit.Millisecond),D=C+s.run("calculateProjectedDuration",l,e,TimeUnit.Millisecond,{ignoreSegments:!0});if(u){u.duration=y;const e=this.segmentModelClass.new({duration:b,durationUnit:v,startOffset:D});g=g.slice(0),g.splice(h+1,0,e),s.segments=g,s.duration=a;for(let e=h+2,t=g.length;e<t;e++){const t=g[e];t&&(t.startOffset+=C,t.endOffset+=C)}}else{const e=this.segmentModelClass.new({duration:y,durationUnit:v,startOffset:0}),t=this.segmentModelClass.new({duration:a-y,durationUnit:v,startOffset:D});s.duration=a,s.segments=[e,t]}return i.commitAsync()}async mergeSegments(e,t){if(this.isSegmented){if(e=e||this.firstSegment,t=t||this.lastSegment,e.startOffset>t.startOffset){let r=t;t=e,e=r}return e.endDate=t.startDate,this.getProject().commitAsync()}}storeFieldChange(e,t){if("segments"===e&&t){const e=[];for(const r of t){const t=r.toJSON();(!this._segmentGeneration[r.internalId]||r.generation>this._segmentGeneration[r.internalId])&&Object.assign(t,r.meta.modified),e.push(t),this._segmentGeneration[r.internalId]=r.generation}t=e}super.storeFieldChange(e,t)}leaveProject(){const e=this.segments;if(e)for(const t of e)t.leaveProject();super.leaveProject()}}return __decorate29([field({identifierCls:SEDSGDispatcherIdentifier})],t.prototype,"dispatcher",void 0),__decorate29([model_field({type:"array",convert:segmentsConverter})],t.prototype,"segments",void 0),__decorate29([field()],t.prototype,"adjustedSegments",void 0),__decorate29([write("segments")],t.prototype,"writeSegments",null),__decorate29([calculate("segments")],t.prototype,"calculateSegments",null),__decorate29([calculate("adjustedSegments")],t.prototype,"calculateAdjustedSegments",null),t}))){},__decorate30=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasEffortMixin=class extends(Mixin([SchedulerProHasAssignmentsMixin,HasChildrenMixin],(e=>{e.prototype;class t extends e{getEffort(e){const t=this.effort;return e?this.getProject().convertDuration(t,this.effortUnit,e):t}writeEffort(e,t,r,n,i){n<0&&(n=0),(t.baseRevision.hasIdentifier(e)||null!=n)&&(null!=i&&i!==this.effortUnit&&this.$.effortUnit.write.call(this,this.$.effortUnit,t,null,i),e.constructor.prototype.write(e,t,r,n))}setEffortUnit(e){throw new Error("Use `setEffort` instead")}*shouldRollupChildEffort(e){return!0}*calculateTotalChildrenEffort(){const e=yield this.$.childEvents,t=this.getProject();let r=0;for(const n of e){if(!(yield*this.shouldRollupChildEffort(n)))continue;const e=yield n.$.effortUnit;r+=(yield*t.$convertDuration(yield n.$.effort,e,TimeUnit.Millisecond))}return yield*t.$convertDuration(r,TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateEffort(){if((yield this.$.childEvents).size>0)return yield*this.calculateTotalChildrenEffort();{const e=yield ProposedOrPrevious;return void 0!==e?e:yield*this.calculateEffortPure()}}*calculateEffortPure(){return(yield this.$.childEvents).size>0?yield*this.calculateTotalChildrenEffort():yield*this.calculateProjectedEffort(yield this.$.startDate,yield this.$.endDate)}*calculateEffortProposed(){return yield ProposedOrPrevious}*calculateAssignmentUnits(e){return yield*this.calculateAssignmentUnitsProposed(e)}*calculateAssignmentUnitsPure(e){return yield*this.calculateUnitsByStartEndAndEffort(e)}*calculateAssignmentUnitsProposed(e){return yield ProposedOrPrevious}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendar:!1}}*calculateProjectedEffort(e,t,r){if(null==e||null==t||e>t)return null;r||(r=yield this.$.assignmentsByCalendar);const n=new Map;for(const[e,t]of r){let r=0;for(const e of t)r+=(yield e.$.units);n.set(e,r)}let i=0;const s=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:e,endDate:t});return 0===n.size&&(n.set(yield this.$.effectiveCalendar,100),s.ignoreResourceCalendar=!0),yield*this.forEachAvailabilityInterval(s,((e,t,r)=>{const s=r.getCalendarsWorking(),a=e.getTime(),o=t.getTime()-a;let l=0;for(const e of s)l+=n.get(e)||0;i+=l*o*.01})),yield*this.getProject().$convertDuration(i,TimeUnit.Millisecond,yield this.$.effortUnit)}*calculateUnitsByStartEndAndEffort(e){const t=yield this.$.effort,r=yield this.$.effortUnit,n=yield*this.getProject().$convertDuration(t,r,TimeUnit.Millisecond);let i=0;const s=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),a=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(s,((e,t,r)=>{const n=r.getCalendarsWorking(),s=e.getTime(),o=t.getTime()-s;for(const e of n)i+=(a.has(e)?a.get(e).length:0)*o})),i?100*n/i:100}*calculateProjectedXDateByEffort(e,t=!0,r,n){r=void 0!==r?r:yield this.$.effort,n=void 0!==n?n:yield this.$.effortUnit;const i=yield*this.getProject().$convertDuration(r,n,TimeUnit.Millisecond);if(null==e||null==r)return null;let s=e.getTime(),a=i;if(0===a)return new Date(s);const o=yield this.$.effectiveCalendar,l=yield this.$.assignmentsByCalendar,c=new Map;let d=!1;for(const[e,t]of l){let r=0;for(const e of t)r+=(yield e.$.units);c.set(e,r),r>0&&(d=!0)}if(d&&(yield*this.useEventAvailabilityIterator())){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(r,((e,r,n)=>{const i=n.getCalendarsWorking(),o=e.getTime(),l=r.getTime(),d=l-o;let u=0;for(const e of i)u+=c.get(e)||0;const h=u*d*.01;if(h>=a)return s=t?o+a/(.01*u):l-a/(.01*u),!1;a-=h})),new Date(s)}return o.accumulateWorkingTime(e,i,t).finalDate}}return __decorate30([model_field({type:"number"})],t.prototype,"effort",void 0),__decorate30([model_field({type:"string",defaultValue:TimeUnit.Hour},{converter:e=>DateHelper.normalizeUnit(e)||TimeUnit.Hour})],t.prototype,"effortUnit",void 0),__decorate30([write("effort")],t.prototype,"writeEffort",null),__decorate30([calculate("effort")],t.prototype,"calculateEffort",null),t}))){},EffortVar=Symbol("EffortVar"),UnitsVar=Symbol("UnitsVar"),effortFormula=Formula.new({output:EffortVar,inputs:new Set([StartDateVar,EndDateVar,UnitsVar])}),unitsFormula=Formula.new({output:UnitsVar,inputs:new Set([StartDateVar,EndDateVar,EffortVar])}),endDateByEffortFormula=Formula.new({output:EndDateVar,inputs:new Set([StartDateVar,EffortVar,UnitsVar])}),startDateByEffortFormula=Formula.new({output:StartDateVar,inputs:new Set([EndDateVar,EffortVar,UnitsVar])}),SEDWUDispatcher=class extends SEDDispatcher{},SEDWUDispatcherIdentifier=class extends SEDDispatcherIdentifier{equality(e,t){const r=e.resolution,n=t.resolution;return(e!==TombStone||t===TombStone)&&(e===TombStone||t!==TombStone)&&r.get(EffortVar)===n.get(EffortVar)&&r.get(UnitsVar)===n.get(UnitsVar)&&super.equality(e,t)}},__decorate31=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasSchedulingModeMixin=class extends(Mixin([HasEffortMixin],(e=>{const t=e.prototype;class r extends e{*calculateSchedulingMode(){return(yield ProposedOrPrevious)||SchedulingMode.Normal}*effectiveSchedulingMode(){return(yield this.$.assignmentsByCalendar).size>0?yield this.$.schedulingMode:SchedulingMode.Normal}effectiveSchedulingModeSync(e){return e(this.$.assignmentsByCalendar).size>0?e(this.$.schedulingMode):SchedulingMode.Normal}*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const r=yield*t.prepareDispatcher.call(this,e);return r.collectInfo(e,this.$.effort,EffortVar),(yield*this.hasProposedValueForUnits())&&r.addProposedValueFlag(UnitsVar),r.addPreviousValueFlag(UnitsVar),r}return yield*t.prepareDispatcher.call(this,e)}dispatcherClass(e){return this.effectiveSchedulingModeSync(e)!==SchedulingMode.Normal?SEDWUDispatcher:t.dispatcherClass.call(this,e)}buildProposedDispatcher(e,r,n){const i=t.buildProposedDispatcher.call(this,e,r,n);return i.addPreviousValueFlag(EffortVar),i.addPreviousValueFlag(UnitsVar),i}*calculateAssignmentUnits(e){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const t=(yield this.$.dispatcher).resolution.get(UnitsVar);if(t===CalculateProposed)return yield*this.calculateAssignmentUnitsProposed(e);if(t===unitsFormula.formulaId)return yield*this.calculateAssignmentUnitsPure(e);throw new Error("Unknown formula for `units`")}return yield*t.calculateAssignmentUnits.call(this,e)}*calculateEffort(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){const e=(yield this.$.dispatcher).resolution.get(EffortVar);if(e===CalculateProposed)return yield*this.calculateEffortProposed();if(e===effortFormula.formulaId)return yield*this.calculateEffortPure();throw new Error("Unknown formula for `effort`")}return yield*t.calculateEffort.call(this)}*calculateStartDate(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){return(yield this.$.dispatcher).resolution.get(StartDateVar)===startDateByEffortFormula.formulaId?yield*this.calculateProjectedXDateByEffort(yield this.$.endDate,!1):yield*t.calculateStartDate.call(this)}return yield*t.calculateStartDate.call(this)}*calculateEndDate(){if((yield*this.effectiveSchedulingMode())!==SchedulingMode.Normal){if((yield this.$.dispatcher).resolution.get(EndDateVar)===endDateByEffortFormula.formulaId){return yield*this.calculateProjectedXDateByEffort(yield this.$.startDate,!0)}return yield*t.calculateEndDate.call(this)}return yield*t.calculateEndDate.call(this)}*calculateEffectiveDuration(){const e=yield this.$.dispatcher,r=yield*this.effectiveSchedulingMode(),n=e.resolution.get(DurationVar);e.resolution.get(EffortVar);let i;if(n===durationFormula.formulaId&&r!=SchedulingMode.Normal){const r=yield ProposedOrPreviousValueOf(this.$.startDate),n=yield ProposedOrPreviousValueOf(this.$.endDate),s=e.resolution.get(StartDateVar),a=e.resolution.get(EndDateVar);yield this.$.effortDriven;n&&s===startDateByEffortFormula.formulaId?i=yield*this.calculateProjectedDuration(yield*this.calculateProjectedXDateByEffort(n,!1),n):r&&a===endDateByEffortFormula.formulaId?i=yield*this.calculateProjectedDuration(r,yield*this.calculateProjectedXDateByEffort(r,!0)):(r&&n||!r&&!n)&&(i=yield*t.calculateEffectiveDuration.call(this))}else i=yield*t.calculateEffectiveDuration.call(this);return i}}return __decorate31([model_field({type:"boolean",defaultValue:!1})],r.prototype,"effortDriven",void 0),__decorate31([model_field({type:"string",defaultValue:SchedulingMode.Normal},{sync:!0})],r.prototype,"schedulingMode",void 0),__decorate31([field({identifierCls:SEDWUDispatcherIdentifier})],r.prototype,"dispatcher",void 0),__decorate31([calculate("schedulingMode")],r.prototype,"calculateSchedulingMode",null),__decorate31([calculate("effort")],r.prototype,"calculateEffort",null),__decorate31([calculate("startDate")],r.prototype,"calculateStartDate",null),__decorate31([calculate("endDate")],r.prototype,"calculateEndDate",null),r}))){},fixedDurationSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([startDateFormula,endDateFormula,durationFormula,unitsFormula,effortFormula])}),fixedDurationAndEffortSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([startDateFormula,endDateFormula,durationFormula,unitsFormula])}),fixedDurationSEDWUForwardNonEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateFormula,effortFormula])}),fixedDurationSEDWUForwardEffortDriven=CycleResolution.new({description:fixedDurationAndEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateFormula,unitsFormula])}),fixedDurationSEDWUBackwardNonEffortDriven=CycleResolution.new({description:fixedDurationSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateFormula,effortFormula])}),fixedDurationSEDWUBackwardEffortDriven=CycleResolution.new({description:fixedDurationAndEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateFormula,unitsFormula])}),FixedDurationMixin=class extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedDuration){const r=yield*t.prepareDispatcher.call(this,e),n=yield this.$.effortDriven;return n&&r.addKeepIfPossibleFlag(EffortVar),(yield HasProposedValue(this.$.assigned))&&(n?r.addProposedValueFlag(EffortVar):r.addProposedValueFlag(UnitsVar)),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedDuration){const t=e(this.$.direction),r=e(this.$.effortDriven);return t===Direction.Forward||t===Direction.None?r?fixedDurationSEDWUForwardEffortDriven:fixedDurationSEDWUForwardNonEffortDriven:r?fixedDurationSEDWUBackwardEffortDriven:fixedDurationSEDWUBackwardNonEffortDriven}return t.cycleResolutionContext.call(this,e)}*getBaseOptionsForDurationCalculations(){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedDuration)return{ignoreResourceCalendar:!0};return yield*t.getBaseOptionsForDurationCalculations.call(this)}}}))){},SchedulerProEvent=class extends(Mixin([SchedulerBasicEvent,HasDateConstraintMixin,HasPercentDoneMixin,SchedulerProHasAssignmentsMixin,HasEffortMixin,HasSchedulingModeMixin,FixedDurationMixin,ConstrainedEarlyEventMixin,ScheduledByDependenciesEarlyEventMixin,SplitEventMixin],(e=>class extends e{}))){},__decorate32=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ResourceAllocationEventRangeCalendarIntervalMixin=class extends CalendarIntervalMixin{static get fields(){return[{name:"isWorking",type:"boolean",defaultValue:!0}]}},ResourceAllocationEventRangeCalendarIntervalStore=class extends CalendarIntervalStore{static get defaultConfig(){return{modelClass:ResourceAllocationEventRangeCalendarIntervalMixin}}},ResourceAllocationEventRangeCalendar=class extends BaseCalendarMixin{get intervalStoreClass(){return ResourceAllocationEventRangeCalendarIntervalStore}};__decorate32([model_field({type:"boolean",defaultValue:!1})],ResourceAllocationEventRangeCalendar.prototype,"unspecifiedTimeIsWorking",void 0);var BaseAllocationInterval=class extends Base2{constructor(){super(...arguments),this.effort=0,this.units=0}},AssignmentAllocationInterval=class extends BaseAllocationInterval{},ResourceAllocationInterval=class extends BaseAllocationInterval{constructor(){super(...arguments),this.maxEffort=0,this.isOverallocated=!1,this.isUnderallocated=!1,this.assignments=null,this.assignmentIntervals=null}},BaseAllocationInfo=class extends(Entity.mix(Base2)){getDefaultAllocationIntervalClass(){return BaseAllocationInterval}initialize(e){e=Object.assign({includeInactiveEvents:!1,allocationIntervalClass:this.getDefaultAllocationIntervalClass()},e),super.initialize(e)}};__decorate32([field()],BaseAllocationInfo.prototype,"includeInactiveEvents",void 0),__decorate32([field()],BaseAllocationInfo.prototype,"allocation",void 0);var ResourceAllocationInfo=class extends BaseAllocationInfo{enterGraph(e){super.enterGraph(e)}leaveGraph(e){super.leaveGraph(e),this.resource&&this.resource.entities.delete(this)}getDefaultAllocationIntervalClass(){return ResourceAllocationInterval}*shouldIncludeAssignmentInAllocation(e){const t=yield e.$.event,r=yield e.$.units,n=yield this.$.includeInactiveEvents,i=t&&(yield t.$.inactive),s=t&&(yield t.$.startDate),a=t&&(yield t.$.endDate);return Boolean(t&&r&&s&&a&&(n||!i))}*calculateAllocation(){const e=[],t=yield this.ticks,r=yield this.$.resource,n=(yield this.$.includeInactiveEvents,yield r.$.assigned),i=yield r.$.effectiveCalendar,s=new Map,a=[],o=new Map,l=new Map;let c=!1;for(const e of n){if(!(yield*this.shouldIncludeAssignmentInAllocation(e)))continue;yield e.$.units;const t=yield e.$.event,r=yield t.$.ignoreResourceCalendar,n=yield t.$.startDate,i=yield t.$.endDate,d=yield t.$.segments,u=yield t.$.effectiveCalendar;if(c=c||r,d)for(const t of d){const r=yield t.$.startDate,n=yield t.$.endDate;a.push({startDate:r,endDate:n,assignment:e})}else a.push({startDate:n,endDate:i,assignment:e});let h=s.get(u);h||(h=[],s.set(u,h)),o.set(e,new Map),l.set(e,[]),h.push(e)}const d=new ResourceAllocationEventRangeCalendar({intervals:a}),u=[t,d,...s.keys()],h=new Map;let g,p;t.intervalStore.forEach((t=>{const n=ResourceAllocationInterval.new({tick:t,resource:r});h.set(t,n),e.push(n),o.forEach(((e,r)=>{const n=AssignmentAllocationInterval.new({tick:t,assignment:r});e.set(t,n),l.get(r).push(n)}))}));const m=e[0].tick.startDate,f=e[e.length-1].tick.endDate,v={startDate:m,endDate:f,calendars:u,includeNonWorkingIntervals:c},y=f.getTime()-m.getTime();return y>r.getProject().maxCalendarRange&&(v.maxRange=y),yield*r.forEachAvailabilityInterval(v,((e,r,n)=>{const s=n.getCalendarsWorkStatus();if(s.get(t)){const a=n.intervalsByCalendar.get(t)[0],l=r.getTime()-e.getTime(),u=h.get(a),m=u.assignments||new Set,f=u.assignmentIntervals||new Map;u.assignments||(g=0,p=0);let v,y=0,b=!1;n.intervalsByCalendar.get(d).forEach((t=>{const n=t.assignment,l=null==n?void 0:n.event;if(l&&s.get(l.effectiveCalendar)&&(!c||l.ignoreResourceCalendar||s.get(i))){const t=Math.max(e.getTime(),n.event.startDate.getTime()),i=Math.min(r.getTime(),n.event.endDate.getTime());b=!0,v=i-t;const s=o.get(n).get(a),l=v*n.units/100;s.effort+=l,s.units=n.units,u.effort+=l,y+=n.units,m.add(n),f.set(n,s)}})),s.get(i)&&(u.maxEffort+=l),y&&(v?(g+=v*y,p+=v,u.units=g/p):g||(u.units=y)),b&&(u.assignments=m,u.assignmentIntervals=f,u.isOverallocated=u.isOverallocated||u.effort>u.maxEffort||u.units>100,u.isUnderallocated=u.effort<u.maxEffort||u.units<100)}})),{total:e,byAssignments:l}}};__decorate32([field()],ResourceAllocationInfo.prototype,"resource",void 0),__decorate32([calculate("allocation")],ResourceAllocationInfo.prototype,"calculateAllocation",null);var SchedulerProResourceMixin=class extends(Mixin([BaseResourceMixin],(e=>{const t=e.prototype;return class extends e{constructor(){super(...arguments),this.observers=new Set,this.entities=new Set}addObserver(e){this.graph.addIdentifier(e),this.observers.add(e)}removeObserver(e){this.graph&&this.graph.removeIdentifier(e),this.observers.delete(e)}addEntity(e){this.graph.addEntity(e),this.entities.add(e)}removeEntity(e){this.graph&&this.graph.removeEntity(e),this.entities.delete(e)}leaveGraph(e){const{graph:r}=this;for(const e of this.observers)this.removeObserver(e);for(const e of this.entities)this.removeEntity(e);t.leaveGraph.call(this,e)}*forEachAvailabilityInterval(e,t){const r=this.getProject(),n=yield this.$.effectiveCalendar,i=r.combineCalendars([n].concat(e.calendars||[])),s=r.maxCalendarRange,a=e.includeNonWorkingIntervals;return s&&(e=Object.assign({maxRange:s},e)),i.forEachAvailabilityInterval(e,((e,r,i)=>{const s=i.getCalendarsWorkStatus();if(a||s.get(n))return t(e,r,i)}))}}}))){},__decorate33=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},SchedulerProProjectMixin=class extends(Mixin([SchedulerBasicProjectMixin,ConstrainedEarlyEventMixin,HasChildrenMixin],(e=>{const t=e.prototype;class r extends e{construct(e={}){this.eventSegmentModelClass=e.eventSegmentModelClass||this.getDefaultEventSegmentModelClass(),t.construct.call(this,e),this.resourceAllocationInfoClass||(this.resourceAllocationInfoClass=this.getDefaultResourceAllocationInfoClass())}getDefaultEventStoreClass(){return ChronoEventStoreMixin}getDefaultEventSegmentModelClass(){return SchedulerProEventSegment}getDefaultResourceAllocationInfoClass(){return ResourceAllocationInfo}*calculateDirection(){return yield ProposedOrPrevious}afterConfigure(){t.afterConfigure.apply(this,arguments),this.dateConstraintIntervalClass=this.dateConstraintIntervalClass||DateConstraintInterval,this.dependencyConstraintIntervalClass=this.dependencyConstraintIntervalClass||DependencyConstraintInterval}getType(){return ProjectType.SchedulerPro}getDefaultCycleEffectClass(){return SchedulerProCycleEffect}getDefaultEventModelClass(){return SchedulerProEvent}getDefaultDependencyModelClass(){return SchedulerProDependencyMixin}getDefaultAssignmentModelClass(){return SchedulerProAssignmentMixin}getDefaultResourceModelClass(){return SchedulerProResourceMixin}async validateDependency(e,t,r,n){let i;n&&(i=Array.isArray(n)?n:[n]);return CI(e.outgoingDeps).some((e=>e.toEvent===t&&!(null==i?void 0:i.includes(e))))?DependencyValidationResult.DuplicatingDependency:await this.isDependencyCyclic(e,t,r,i)?DependencyValidationResult.CyclicDependency:DependencyValidationResult.NoError}async isValidDependency(e,t,r,n){return await this.validateDependency(e,t,r,n)===DependencyValidationResult.NoError}getDependencyCycleDetectionIdentifiers(e,t){return[t.$.earlyStartDateConstraintIntervals,t.$.earlyEndDateConstraintIntervals]}async isDependencyCyclic(e,t,r,n){const i=new(0,this.getDependencyStore().modelClass)({fromEvent:e,toEvent:t,type:r}),s=this.replica.branch({autoCommit:!1,onComputationCycle:"throw"});n&&(Array.isArray(n)||(n=[n]),n.forEach((e=>s.removeEntity(e)))),s.addEntity(i),i.project=this;try{return await Promise.all(this.getDependencyCycleDetectionIdentifiers(e,t).map((e=>s.readAsync(e)))),!1}catch(e){if(/cycle/i.test(e))return!0;if(!/conflict/i.test(e))throw e}}async isValidDependencyModel(e,t){return this.isValidDependency(e.fromEvent,e.toEvent,e.type,t)}}return __decorate33([model_field({type:"string",defaultValue:DependenciesCalendar.ToEvent})],r.prototype,"dependenciesCalendar",void 0),__decorate33([model_field({type:"boolean",defaultValue:!0})],r.prototype,"autoCalculatePercentDoneForParentTasks",void 0),__decorate33([model_field({type:"boolean",defaultValue:!0})],r.prototype,"addConstraintOnDateSet",void 0),r}))){},DeactivateDependencyCycleEffectResolution=class extends(Localizable_default(SchedulingIssueEffectResolution)){static get $name(){return"DeactivateDependencyCycleEffectResolution"}getDescription(){return this.L("L{descriptionTpl}")}resolve(e){e.active=!1}},SchedulerProCycleEffect=class extends CycleEffect{getInvalidDependencies(){if(!this._invalidDependencies){const e=this.getDependencies();this._invalidDependencies=e.filter((e=>e.fromEvent===e.toEvent||e.fromEvent.contains(e.toEvent)||e.toEvent.contains(e.fromEvent)))}return this._invalidDependencies}buildInvalidDependencyResolutions(e){return[this.removeDependencyConflictResolutionClass.new(e),this.deactivateDependencyConflictResolutionClass.new(e)]}matchDependencyBySourceAndTargetEvent(e,t,r){return e.active&&super.matchDependencyBySourceAndTargetEvent(e,t,r)}getResolutions(){if(!this._resolutions){const e=this.getInvalidDependencies(),t=[];for(const r of e)t.push(...this.buildInvalidDependencyResolutions({dependency:r}));e.length||t.push(this.deactivateDependencyCycleEffectResolutionClass.new(),...super.getResolutions()),this._resolutions=t}return this._resolutions}};__decorate33([prototypeValue(DeactivateDependencyCycleEffectResolution)],SchedulerProCycleEffect.prototype,"deactivateDependencyCycleEffectResolutionClass",void 0),__decorate33([prototypeValue(RemoveDependencyResolution)],SchedulerProCycleEffect.prototype,"removeDependencyConflictResolutionClass",void 0),__decorate33([prototypeValue(DeactivateDependencyResolution)],SchedulerProCycleEffect.prototype,"deactivateDependencyConflictResolutionClass",void 0);var ModelCombo=class extends Combo{static get $name(){return"ModelCombo"}static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}};ModelCombo.initClass(),ModelCombo._$name="ModelCombo";var CalendarField=class extends ModelCombo{static get $name(){return"CalendarField"}static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,store:null,listItemTpl:e=>e.name||this.L("L{Default calendar}"),displayValueRenderer:(e,t)=>{var r,n;return(null==(e=e||(null==(n=null==(r=t.store)?void 0:r.project)?void 0:n.effectiveCalendar))?void 0:e.name)||this.L("L{Default calendar}")}}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}};CalendarField.initClass(),CalendarField._$name="CalendarField";var ResourceCalendarColumn=class extends(Column.mixin(AttachToProjectMixin_default)){static get $name(){return"ResourceCalendarColumn"}static get type(){return"resourceCalendar"}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:CalendarField.type,clearable:!0,allowInvalid:!1}}}attachToProject(e){e&&(this.defaultCalendar=e.defaultCalendar,this.editor.store=e.calendarManagerStore)}attachToResourceStore(e){super.attachToResourceStore(e),e&&e.ion({name:"resourceStore",update:"onResourceUpdate",thisObj:this})}onResourceUpdate({record:e,changes:t}){var r;const n=t[this.field];if(n){if("string"==typeof n.oldValue&&(null==(r=n.value)?void 0:r.id)===n.oldValue)return;this.refreshCell(e)}}renderer({value:e}){if(e===this.defaultCalendar)return"";if(e&&e.id){const t=this.editor.store.getById(e.id);return t&&t[this.editor.displayField]||""}return""}};ColumnStore.registerColumnType(ResourceCalendarColumn),ResourceCalendarColumn._$name="ResourceCalendarColumn";var ScaleColumn=class extends Column{static get $name(){return"ScaleColumn"}static get type(){return"scale"}static get isScaleColumn(){return!0}static get fields(){return["scalePoints"]}static get defaults(){return{text:" ",width:40,minWidth:40,cellCls:"b-scale-cell",editor:!1,sortable:!1,groupable:!1,filterable:!1,alwaysClearCell:!1,scalePoints:[{value:4},{value:8,text:8}]}}onDestroy(){this.scaleWidget.destroy()}set width(e){super.width=e,this.scaleWidget.width=e}get width(){return super.width}applyValue(e,t,r){return"scalePoints"===t&&(this.scaleWidget[t]=r),super.applyValue(...arguments)}buildScaleWidget(){const e=this,t=new Scale({owner:e.grid,appendTo:e.grid.floatRoot,cls:"b-hide-offscreen",align:"right",scalePoints:e.scalePoints,monitorResize:!1});return Object.defineProperties(t,{width:{get:()=>e.width,set(t){this.element.style.width=t+"px",this._width=e.width}},height:{get(){return this._height},set(e){this.element.style.height=e+"px",this._height=e}}}),t.width=e.width,t}get scaleWidget(){const e=this;return e._scaleWidget||(e._scaleWidget=e.buildScaleWidget()),e._scaleWidget}renderer({cellElement:e,scaleWidget:t=this.scaleWidget}){t.height=this.grid.rowHeight,t.refresh();const r=t.element.cloneNode(!0);r.removeAttribute("id"),r.classList.remove("b-hide-offscreen"),e.innerHTML="",e.appendChild(r)}};ColumnStore.registerColumnType(ScaleColumn),ScaleColumn._$name="ScaleColumn";var throwIfNotTheSameStore=(e,t)=>{if(e!==t)throw new Error("Store set is prohibited for Scheduler Pro entity!")},PartOfProject_default2=e=>class extends(e||Base){static get $name(){return"PartOfProject"}get taskStore(){return this.eventStore}set taskStore(e){this.eventStore=e}get eventStore(){var e;return null==(e=this.project)?void 0:e.eventStore}get leftProjectEventStore(){const e=this.leftProject;return(null==e?void 0:e.getEventStore())||null}set eventStore(e){throwIfNotTheSameStore(this.eventStore,e)}get dependencyStore(){var e;return null==(e=this.project)?void 0:e.dependencyStore}set dependencyStore(e){throwIfNotTheSameStore(this.dependencyStore,e)}get assignmentStore(){var e;return null==(e=this.project)?void 0:e.assignmentStore}set assignmentStore(e){throwIfNotTheSameStore(this.assignmentStore,e)}get resourceStore(){var e;return null==(e=this.project)?void 0:e.resourceStore}set resourceStore(e){throwIfNotTheSameStore(this.resourceStore,e)}get calendarManagerStore(){var e;return null==(e=this.project)?void 0:e.calendarManagerStore}set calendarManagerStore(e){throwIfNotTheSameStore(this.calendarManagerStore,e)}},AssignmentModel2=class extends(PartOfProject_default2(AssignmentModelMixin_default(SchedulerProAssignmentMixin.derive(Model)))){get event(){const{project:e}=this,t=super.event;return(null==e?void 0:e.isDelayingCalculation)?e.eventStore.getById(t):t}set event(e){super.event=e}get resource(){const{project:e}=this;let t=super.resource;return(null==e?void 0:e.isDelayingCalculation)&&(t=e.resourceStore.getById(t)),null==t?void 0:t.$original}set resource(e){super.resource=e}get eventResourceKey(){return this.isInActiveTransaction?this.buildEventResourceKey(this.event,this.resource):this.buildEventResourceKey(this.$.event.DATA,this.$.resource.DATA)}};__publicField(AssignmentModel2,"$name","AssignmentModel"),__publicField(AssignmentModel2,"isProAssignmentModel",!0),AssignmentModel2._$name="AssignmentModel";var AssignmentStore2=class extends(PartOfProject_default2(AssignmentStoreMixin_default(ChronoAssignmentStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:AssignmentModel2}}};__publicField(AssignmentStore2,"$name","AssignmentStore"),AssignmentStore2._$name="AssignmentStore";var CalendarIntervalModel=class extends(PartOfProject_default2(CalendarIntervalMixin.derive(Model))){static get $name(){return"CalendarIntervalModel"}};CalendarIntervalModel._$name="CalendarIntervalModel";var CalendarModel=class extends(PartOfProject_default2(BaseCalendarMixin.derive(Model))){static get $name(){return"CalendarModel"}static get fields(){return[{name:"expanded",internal:!0,defaultValue:!0}]}toString(){return this.name||""}static get defaultConfig(){return{calendarIntervalModelClass:CalendarIntervalModel}}};CalendarModel._$name="CalendarModel";var CalendarManagerStore=class extends(PartOfProject_default2(ChronoCalendarManagerStoreMixin.derive(AjaxStore))){static get defaultConfig(){return{tree:!0,modelClass:CalendarModel,loadPriority:100,syncPriority:100,storeId:"calendars"}}};CalendarManagerStore._$name="CalendarManagerStore";var DependencyModel2=class extends(PartOfProject_default2(SchedulerProDependencyMixin.derive(DependencyBaseModel))){static get $name(){return"DependencyModel"}static get isProDependencyModel(){return!0}get fromEvent(){var e;return(null==(e=this.project)?void 0:e.isDelayingCalculation)?this.project.eventStore.getById(super.fromEvent):super.fromEvent}set fromEvent(e){super.fromEvent=e}get toEvent(){var e;return(null==(e=this.project)?void 0:e.isDelayingCalculation)?this.project.eventStore.getById(super.toEvent):super.toEvent}set toEvent(e){super.toEvent=e}};DependencyModel2._$name="DependencyModel";var DependencyStore2=class extends(PartOfProject_default2(DependencyStoreMixin_default(ChronoDependencyStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:DependencyModel2}}};DependencyStore2._$name="DependencyStore";var PercentDoneMixin_default=e=>class extends e{static get $name(){return"PercentDoneMixin"}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}copy(){const e=super.copy(...arguments);return e.percentDone=0,e.clearChanges(),e}get renderedPercentDone(){const e="number"!=typeof this.percentDone||isNaN(this.percentDone)?0:this.percentDone;return this.getFormattedPercentDone(e)}getFormattedPercentDone(e=0){return e<=99?Math.round(e):Math.floor(e)}set renderedPercentDone(e){this.percentDone=e}},EventSegmentModel=class extends(SchedulerProEventSegment.derive(TimeSpan).mixin(EventModelMixin_default,PercentDoneMixin_default)){static get $name(){return"EventSegmentModel"}get task(){return this.event}};EventSegmentModel._$name="EventSegmentModel";var EventModel2=class extends(SchedulerProEvent.derive(TimeSpan).mixin(RecurringTimeSpan_default,PartOfProject_default2,EventModelMixin_default,PercentDoneMixin_default)){static get $name(){return"EventModel"}static get fields(){return[{name:"showInTimeline",type:"boolean",defaultValue:!1},"note",{name:"preamble",convert:e=>e?new Duration(e):null},{name:"postamble",convert:e=>e?new Duration(e):null}]}getDefaultSegmentModelClass(){return EventSegmentModel}updateWrapDate(e,t,r=!0){return t=new Duration(t),new Date(e.getTime()+(r?1:-1)*t.milliseconds)}get startDate(){var e;let t;return t=this.isOccurrence?this.get("startDate"):null!=(e=this._startDate)?e:super.startDate,this.allDay&&(t=this.constructor.getAllDayStartDate(t)),t}set startDate(e){const t=this;if(t.generation&&t.isParent&&!t.$ignoreChange){const r=DateHelper.diff(t.startDate,e);if(r)for(const e of this.children)e.startDate=DateHelper.add(e.startDate,r)}t.batching?(t._startDate=e,t.set({startDate:e})):(super.startDate=e,t.preamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get endDate(){var e;let t;return t=this.isOccurrence?this.get("endDate"):null!=(e=this._endDate)?e:super.endDate,this.allDay&&(t=this.constructor.getAllDayEndDate(t)),t}set endDate(e){const t=this;t.batching?(t._endDate=e,t.set({endDate:e})):(super.endDate=e,t.postamble&&(t.wrapStartDate=null,t.wrapEndDate=null))}get fullEffort(){return new Duration({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get wrapStartDate(){const e=this,{preamble:t,startDate:r}=e,n=e._wrapStartDate;let i;return n?i=n:t?(i=e.updateWrapDate(r,t,!1),e._wrapStartDate=i):i=r,i}set wrapStartDate(e){this._wrapStartDate=e}get wrapEndDate(){const e=this,{postamble:t,endDate:r}=e,n=e._wrapEndDate;let i;return n?i=n:t?(i=e.updateWrapDate(r,t,!0),e._wrapEndDate=i):i=r,i}set wrapEndDate(e){this._wrapEndDate=e}set(e){const t="object"==typeof e;("preamble"===e||t&&"preamble"in e)&&(this.wrapStartDate=null),("postamble"===e||t&&"postamble"in e)&&(this.wrapEndDate=null),super.set(...arguments)}get outerStartDate(){return this.wrapStartDate}get outerEndDate(){return this.wrapEndDate}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":return!1;case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}get stm(){var e,t;return null!=(t=null==(e=this.recurringEvent)?void 0:e.stm)?t:super.stm}set stm(e){super.stm=e}get assigned(){const{project:e}=this,t=super.assigned;return(null==e?void 0:e.isDelayingCalculation)&&!t?e.assignmentStore.storage.findItem("event",this):t}set assigned(e){super.assigned=e}getCurrentConfig(e){const{segments:t}=this,r=super.getCurrentConfig(e);return r&&t&&(r.segments=t.map((t=>t.getCurrentConfig(e)))),r}};__publicField(EventModel2,"isProEventModel",!0),EventModel2._$name="EventModel";var EventStore2=class extends(PartOfProject_default2(SharedEventStoreMixin_default(RecurringEventsMixin_default(GetEventsMixin_default(DayIndexMixin_default(EventStoreMixin_default(ChronoEventStoreMixin.derive(AjaxStore)))))))){static get defaultConfig(){return{modelClass:EventModel2}}};__publicField(EventStore2,"$name","EventStore"),EventStore2._$name="EventStore";var EventUpdateAction=class extends UpdateAction{get type(){return"EventUpdateAction"}construct(e){let{model:t,newData:r,oldData:n}=e;if(r.segments&&n.segments){n={...n},r={...r};const e=n.segments.slice(),t=r.segments.slice();let i=!1;n.segments.forEach(((n,s)=>{const a=r.segments.indexOf(n);a>-1&&(e[s]=t[a]=[n],i=!0)})),i&&(n.segments=e,r.segments=t)}return n.segments&&(n.segments=n.segments.map((e=>Array.isArray(e)?e:this.packSegmentSnapshot(e)))),r.segments&&(r.segments=r.segments.map((e=>Array.isArray(e)?e:this.packSegmentSnapshot(e)))),super.construct({model:t,newData:r,oldData:n})}packSegmentSnapshot(e){if(e.isModel){const t=e.toJSON();return t.startOffset=e.startOffset,t.endOffset=e.endOffset,[e,t]}return[null,e]}unpackSegmentSnapshot(e){const[t,r]=e;return t&&!t.isDestroyed?(Object.assign(t,r),t):r}undo(){const{oldData:e}=this;e.segments&&(e.segments=e.segments.map(this.unpackSegmentSnapshot)),super.undo()}redo(){const{newData:e}=this;e.segments&&(e.segments=e.segments.map(this.unpackSegmentSnapshot)),super.redo()}};EventUpdateAction._$name="EventUpdateAction";var ResourceModel2=class extends(PartOfProject_default2(ResourceModelMixin_default(SchedulerProResourceMixin.derive(GridRowModel)))){static get $name(){return"ResourceModel"}get assigned(){var e,t;const{project:r}=this;return(null==(e=null==r?void 0:r.assignmentStore.storage._indices)?void 0:e.resource)?null!=(t=r.assignmentStore.storage.findItem("resource",this))?t:new Set:super.assigned}set assigned(e){super.assigned=e}};ResourceModel2._$name="ResourceModel";var ResourceStore2=class extends(PartOfProject_default2(ResourceStoreMixin_default(ChronoResourceStoreMixin.derive(AjaxStore)))){static get defaultConfig(){return{modelClass:ResourceModel2}}};ResourceStore2._$name="ResourceStore";var makeModelUpdateAction2=(e,t,r)=>e.isSplitEventMixin?new EventUpdateAction({model:e,newData:t,oldData:r}):new UpdateAction({model:e,newData:t,oldData:r}),StateTrackingManager2=class extends StateTrackingManager{static get defaultConfig(){return{makeModelUpdateAction:makeModelUpdateAction2}}};StateTrackingManager2._$name="StateTrackingManager";var VersionModel=class extends(Localizable_default(Model)){static get $name(){return"VersionModel"}onBeforeSave(){}get description(){var e;return null!=(e=this.name)?e:this.defaultDescription}get defaultDescription(){return(this.isAutosave?"Auto-saved":"Saved")+" at "+DateHelper.format(this.savedAt,this.L("L{Versions.versionDateFormat}"))}};__publicField(VersionModel,"fields",[{name:"name",type:"string"},{name:"isAutosave",type:"boolean"},{name:"content",type:"object"},{name:"savedAt",type:"date"}]),VersionModel.exposeProperties(),VersionModel._$name="VersionModel";var VersionStore=class extends(Store.mixin(PartOfProject_default2)){};__publicField(VersionStore,"$name","VersionStore"),__publicField(VersionStore,"configurable",{modelClass:VersionModel,storeId:"versions"}),VersionStore._$name="VersionStore";var ChangeLogTransactionModel=class extends(Localizable_default(Model)){get description(){var e;return null!=(e=this.get("description"))?e:this.defaultDescription}get actions(){var e;return null!=(e=this.get("actions"))?e:[]}get defaultDescription(){var e,t;if(0===this.actions.length)return this.L("L{Versions.noChanges}");const r=this,n=ArrayHelper.unique(r.actions.map((({actionType:e})=>e.startsWith("add")?"add":e.startsWith("remove")?"remove":e.startsWith("update")?"update":e))),i=ArrayHelper.unique(r.actions.map((({entity:e})=>e.type))),s=ArrayHelper.unique(r.actions.map((({entity:e})=>e.type+"."+e.id))).length,a=r.L("L{Versions.transactionDescriptions}"),o=r.L("L{Versions.entityNames}"),l=r.L("L{Versions.entityNamesPlural}"),c=i[0],d=i.length>1;return a[n.length>1?"mixed":n[0]].replace("{n}",s).replace("{entities}",s>1?null!=(e=l[d?"other":c])?e:l.other:null!=(t=o[c])?t:o.other)}};__publicField(ChangeLogTransactionModel,"$name","ChangeLogTransactionModel"),__publicField(ChangeLogTransactionModel,"fields",[{name:"versionId"},{name:"actions",type:"array"},{name:"occurredAt",type:"date"},{name:"description",type:"string"}]),ChangeLogTransactionModel.exposeProperties(),ChangeLogTransactionModel._$name="ChangeLogTransactionModel";var ChangeLogStore=class extends(Store.mixin(PartOfProject_default2)){};__publicField(ChangeLogStore,"$name","ChangeLogStore"),__publicField(ChangeLogStore,"configurable",{modelClass:ChangeLogTransactionModel,storeId:"changelogs"}),ChangeLogStore._$name="ChangeLogStore";var ProjectCrudManager_default2=e=>class extends((e||Base).mixin(ProjectCrudManager_default)){static get configurable(){return{crudLoadValidationWarningPrefix:"项目加载异常:",crudSyncValidationWarningPrefix:"项目异步加载异常:",trackProjectModelChanges:!1}}construct(...e){const t=this;super.construct(...e),t.addPrioritizedStore(t.calendarManagerStore),t.addPrioritizedStore(t.assignmentStore),t.addPrioritizedStore(t.dependencyStore),t.addPrioritizedStore(t.resourceStore),t.addPrioritizedStore(t.eventStore),t.timeRangeStore&&t.addPrioritizedStore(t.timeRangeStore),t.resourceTimeRangeStore&&t.addPrioritizedStore(t.resourceTimeRangeStore)}get project(){return this}set project(e){super.project=e}get crudLoadValidationMandatoryStores(){return[this.getStoreDescriptor(this.eventStore).storeId]}loadCrudManagerData(...e){!this.delayCalculation||this.isDelayingCalculation||this.usingSyncDataOnLoad()||this.scheduleDelayedCalculation(),super.loadCrudManagerData(...e)}acceptChanges(){super.acceptChanges(),this.clearChanges(!0,!1)}revertChanges(){this.revertCrudStoreChanges(),this.set(this.meta.modified,void 0,!0)}crudStoreHasChanges(e){const t=this.getCrudStore(e);let r;return r=t?super.crudStoreHasChanges(t):this.hasPersistableChanges||super.crudStoreHasChanges(),r}get changes(){let e=super.changes;if(this.trackProjectModelChanges){const t=this.modificationDataToWrite;t&&(e=e||{},e.project=t)}return e}shouldClearRecordFieldChange(e,t,r){return e.isCalendarModel&&"intervals"===t?!e.get("intervals").changes:super.shouldClearRecordFieldChange(...arguments)}},sortFn=(e,t)=>e<t?-1:e>t?1:0,ProHorizontalLayout_default=e=>class extends(e||Base){static get configurable(){return{type:null,weights:null,groupBy:null,groupByThisObj:null,layoutFn:null}}get grouped(){return Boolean(this.groupBy)}getGroupValue(e){var t;let r;if(null!=e.group)r=e.group;else{const{groupBy:n,weights:i,groupByThisObj:s=this}=this,{eventRecord:a}=e;"function"==typeof n?r=n.call(s,a):(r=a[n],i&&(r=null!=(t=i[r])?t:1/0)),e.group=r}return r}getEventGroups(e){if(this.grouped){const t=new Set;return e.sort(((e,r)=>{const n=this.getGroupValue(e),i=this.getGroupValue(r);return t.add(n),t.add(i),sortFn(n,i)})),Array.from(t).sort(sortFn)}return[]}},ProHorizontalLayoutStack=class extends(HorizontalLayoutStack.mixin(ProHorizontalLayout_default)){static get $name(){return"ProHorizontalLayoutStack"}layoutEventsInBands(e,t=!1){return this.getEventGroups(e),super.layoutEventsInBands(e,t)}};ProHorizontalLayoutStack._$name="ProHorizontalLayoutStack";var ProHorizontalLayoutPack=class extends(HorizontalLayoutPack.mixin(ProHorizontalLayout_default)){static get $name(){return"ProHorizontalLayoutPack"}layoutEventsInBands(e){const t=this.getEventGroups(e),r=t.length||1,n=this.packEventsInBands(e,((e,n,i,s)=>{const a=s/r,o=(1===r?0:t.indexOf(e.group))/r;e.height=a,e.top=o+i.start/r+n*a,e.inBandHeight=s,e.inBandTop=i.start+n*s}));return e.forEach((e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,e.eventRecord,e.resourceRecord))})),n}};ProHorizontalLayoutPack._$name="ProHorizontalLayoutPack";var counter=0,CalendarHighlightModel=class extends ResourceTimeRangeModel{static get $name(){return"CalendarHighlightModel"}static generateId(){return++counter}};__publicField(CalendarHighlightModel,"domIdPrefix","calendarhighlight");var CalendarHighlight=class extends ResourceTimeRangesBase{static get $name(){return"CalendarHighlight"}static get configurable(){return{calendar:"event",unhighlightOnDrop:null,collectAvailableResources:null,rangeCls:"b-sch-highlighted-calendar-range",resourceTimeRangeModelClass:CalendarHighlightModel,inflate:3}}static get pluginConfig(){const e=super.pluginConfig;return e.assign=["highlightEventCalendars","highlightResourceCalendars","unhighlightCalendars"],e}afterConstruct(){super.afterConstruct(),this.client.ion({eventDragStart:"onEventDragStart",eventDragReset:"unhighlightCalendars",eventResizeStart:"onEventResizeStart",eventResizeEnd:"unhighlightCalendars",dragCreateStart:"onDragCreateStart",afterDragCreate:"unhighlightCalendars",thisObj:this})}highlightCalendar(e,t){e=ArrayHelper.asArray(e),t=ArrayHelper.asArray(t),"event"===this.calendar?this.highlightEventCalendars(e,t):this.highlightResourceCalendars(t)}highlightEventCalendars(e,t,r=!0){const n=this,{client:i}=n,{startDate:s,endDate:a}=i;n.disabled||(r&&n.unhighlightCalendars(),e=ArrayHelper.asArray(e),t||(t=e.flatMap((e=>e.$linkedResources))),n.highlight=new Map,t=ArrayHelper.asArray(t),e.forEach((e=>{var r;if(!e.calendar)return;const o=null==(r=e.calendar)?void 0:r.getWorkingTimeRanges(s,a).map((e=>new CalendarHighlightModel(e)));if(o){for(const e of t)n.highlight.set(e,o),i.currentOrientation.refreshEventsForResource(e,!0,!1);t.length>0&&i.currentOrientation.onRenderDone()}})))}highlightResourceCalendars(e,t=!0){var r;const n=this,{startDate:i,endDate:s,currentOrientation:a}=n.client;if(!n.disabled){t&&n.unhighlightCalendars(),n.highlight=new Map;for(const t of e){const e=null==(r=t.calendar)?void 0:r.getWorkingTimeRanges(i,s).map((e=>new CalendarHighlightModel(e)));e&&(n.highlight.set(t,e),a.refreshEventsForResource(t,!0,!1))}e.length>0&&a.onRenderDone()}}unhighlightCalendars(){if(!this.highlight)return;const{currentOrientation:e}=this.client,t=this.highlight.keys();this.highlight=null;for(const r of t)e.refreshEventsForResource(r,!0,!1);e.onRenderDone()}onEventDragStart({context:e}){var t,r;if(this.disabled)return;const n=this,{client:i}=n,{eventRecords:s}=e,a=e.availableResources=i.features.eventDrag.constrainDragToResource?[e.resourceRecord]:null!=(r=null==(t=n.collectAvailableResources)?void 0:t.call(n,{scheduler:i,eventRecords:s}))?r:i.resourceStore.records;n.highlightCalendar(s,a)}onEventResizeStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}onDragCreateStart({eventRecord:e,resourceRecord:t}){this.disabled||this.highlightCalendar(e,[t])}getEventsToRender(e,t){var r;const n=null==(r=this.highlight)?void 0:r.get(e);return n&&t.push(...n),t}onEventDataGenerated(e){const{eventRecord:t}=e;if(t.isCalendarHighlightModel){const{inflate:r}=this;e.fillSize=this.client.isVertical,e.wrapperCls["b-sch-highlighted-calendar-range"]=1,e.children.push({className:"b-sch-event-content",html:t.name,dataset:{taskBarFeature:"content"}}),e.width+=2*r,e.height+=2*r,e.left-=r,e.top-=r,e.eventId=this.generateElementId(t)+"-resource-"+e.resourceRecord.id}}updateDisabled(e,t){super.updateDisabled(e,t),e&&this.unhighlightCalendars()}shouldInclude(e){return e.isCalendarHighlightModel}get featureClass(){}};CalendarHighlight._$name="CalendarHighlight",GridFeatureManager.registerFeature(CalendarHighlight,!1,"SchedulerPro");var DependencyEdit2=class extends DependencyEdit{static get $name(){return"DependencyEdit"}static get configurable(){return{showLagField:!0,editorConfig:{items:{activeField:{type:"checkbox",name:"active",label:"L{Active}"}}}}}};DependencyEdit2._$name="DependencyEdit",GridFeatureManager.registerFeature(DependencyEdit2,!1);var EventBuffer=class extends InstancePlugin{static get $name(){return"EventBuffer"}static get configurable(){return{showDuration:!0,tooltipTemplate:{value:null,$config:"nullify"}}}static get pluginConfig(){return{chain:["onEventDataGenerated"]}}updateTooltipTemplate(e){var t;const r=this;e?r.tooltip=Tooltip.new({forElement:r.client.timeAxisSubGridElement,forSelector:".b-sch-event-buffer-before,.b-sch-event-buffer-after",align:{align:"b-t",offset:[0,10]},getHtml({activeTarget:e}){const t=r.client.resolveEventRecord(e),n=e.matches(".b-sch-event-buffer-before"),i=n?t.preamble:t.postamble;return r.tooltipTemplate({eventRecord:t,duration:i,before:n})}}):null==(t=r.tooltip)||t.destroy()}onEventDataGenerated({useEventBuffer:e,bufferBeforeWidth:t,bufferAfterWidth:r,eventRecord:n,wrapperChildren:i}){if(this.enabled&&e){const{isHorizontal:e}=this.client,{showDuration:s}=this,{preamble:a,postamble:o}=n,l=e?"width":"height";i.push({className:{"b-sch-event-buffer":1,"b-sch-event-buffer-before":1,"b-buffer-thin":!t},style:l+": "+t+"px",children:s&&a?[{tag:"span",className:"b-buffer-label",html:a.toString(!0)}]:void 0},{className:{"b-sch-event-buffer":1,"b-sch-event-buffer-after":1,"b-buffer-thin":!r},style:l+": "+r+"px",children:s&&o?[{tag:"span",className:"b-buffer-label",html:o.toString(!0)}]:void 0})}}updateShowDuration(){this.isConfiguring||this.client.refreshWithTransition()}doDisable(e){super.doDisable(e);const{client:t}=this;!t.isConfiguring&&t.isPainted&&(t.element.classList.add("b-eventbuffer-transition"),t.refreshWithTransition(),t.waitForAnimations().then((()=>{t.element.classList.remove("b-eventbuffer-transition")})))}};EventBuffer._$name="EventBuffer",GridFeatureManager.registerFeature(EventBuffer,!1,"SchedulerPro");var EventResize2=class extends EventResize{static get $name(){return"EventResize"}render(){const e=this,{client:t}=e;super.render(...arguments),e.dragSelector=e.dragItemSelector=t.eventSelector+":not(.b-sch-event-segment)"}};EventResize2._$name="EventResize",GridFeatureManager.registerFeature(EventResize2,!0,"SchedulerPro");var EventSegmentDrag=class extends EventDrag{static get defaultConfig(){return{constrainDragToResource:!0}}static get configurable(){return{capitalizedEventName:"EventSegment"}}static get pluginConfig(){return{chain:["onPaint","isEventElementDraggable"]}}getTriggerParams(e){const{assignmentRecords:t,eventRecords:r,resourceRecord:n,browserEvent:i}=e;return{context:e,eventRecords:r,resourceRecord:n,assignmentRecords:t,event:i}}triggerEventDrag(e,t){this.scheduler.trigger("eventSegmentDrag",Object.assign(this.getTriggerParams(e),{startDate:e.startDate,endDate:e.endDate}))}triggerDragStart(e){this.scheduler.navigator.skipNextClick=!0,this.scheduler.trigger("eventSegmentDragStart",this.getTriggerParams(e))}triggerDragAbort(e){this.scheduler.trigger("eventSegmentDragAbort",this.getTriggerParams(e))}triggerDragAbortFinalized(e){this.scheduler.trigger("eventSegmentDragAbortFinalized",this.getTriggerParams(e))}triggerAfterDrop(e,t){if(this.scheduler.trigger("afterEventSegmentDrop",Object.assign(this.getTriggerParams(e),{valid:t})),!t){const{assignmentStore:e,eventStore:t}=this.client;this.dragData.initialAssignmentsState.find((({resource:r,assignment:n},i)=>{var s;return!e.includes(n)||!t.includes(n.event)||r.id!==(null==(s=this.dragData.assignmentRecords[i])?void 0:s.resourceId)}))&&this.client.refresh()}}async updateRecords(e){const t=this,{client:r}=t;let n;return e.externalDropTarget||(r.eventStore.suspendAutoCommit(),n=await t.updateSegment(r,e,false),r.eventStore.resumeAutoCommit()),r.trigger("eventSegmentDrop",Object.assign(t.getTriggerParams(e),{isCopy:false,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,externalDropTarget:e.externalDropTarget})),n}async updateSegment(e,t){var r;const n=this,i="vertical"===e.mode,{eventRecords:s,assignmentRecords:a,timeDiff:o}=t;e.suspendRefresh();let l=!1;i&&s.forEach(((r,n)=>{const i=t.eventBarEls[n];delete r.instanceMeta(e).hasTemporaryDragElement,i.dataset.transient&&i.remove()}));const c=t.eventBarEls.slice(),d=t.eventRecord,u=n.adjustStartDate(t.origStart,o);DateHelper.isEqual(d.startDate,u)||(e.endListeningForBatchedUpdates(),n.cancelBatchUpdate(d),d.startDate=u,l=!0,await e.project.commitAsync(),null==(r=n.endBatchUpdate)||r.call(n,d)),e.resumeRefresh(),a.length>0&&(l?(e.fillTicks&&c.forEach((e=>delete e.lastDomConfig)),e.refreshWithTransition()):t.valid=!1)}isEventElementDraggable(e,t,r,n){return!(!this.disabled&&(t.isEventSegment||t.segments))||!r.closest(this.drag.targetSelector)}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getMinimalDragData(e){const{client:t}=this,r=this.getElementFromContext(e),n=t.resolveEventRecord(r),i=t.resolveResourceRecord(r),s=t.resolveAssignmentRecord(r);return{eventRecord:n,resourceRecord:i,assignmentRecord:s,eventRecords:[n],assignmentRecords:s?[s]:[]}}beginBatchUpdate(e){e.event.beginBatch(),e.beginBatch()}endBatchUpdate(e){var t;null==(t=e.event)||t.endBatch(),e.endBatch()}cancelBatchUpdate(e){var t;null==(t=e.event)||t.cancelBatch(),e.cancelBatch()}setupProductDragData(e){var t;const r=this,{client:n}=r,i=r.getElementFromContext(e),{eventRecord:s,resourceRecord:a}=r.getMinimalDragData(e),o=[],l=n.getElementsFromEventRecord(s.event,a,!0)[0];if(r.constrainDragToResource&&!a)throw new Error("Resource could not be resolved for event: "+s.id);r.drag.ignoreSamePositionDrop=!n.rtl||s.nextSegment,n.listenToBatchedUpdates||n.beginListeningForBatchedUpdates(),r.beginBatchUpdate(s);const c=null==(t=r.getDateConstraints)?void 0:t.call(r,a,s),d=r.constrainRectangle=r.getConstrainingRectangle(c,a,s),u=Rectangle.from(i,n.foregroundCanvas,!0),h=Rectangle.from(l,n.foregroundCanvas,!0);return d.translate(-h.x),super.setupConstraints(d,u,n.timeAxisViewModel.snapPixelAmount,Boolean(c.start)),o.push(i),{record:s,draggedEntities:[s],dateConstraints:(null==c?void 0:c.start)?c:null,eventBarEls:o,mainEventElement:l}}suspendRecordElementRedrawing(){}suspendElementRedrawing(){}getDateConstraints(e,t){let{minDate:r,maxDate:n}=super.getDateConstraints(e,t);return t.previousSegment&&(!r||r<t.previousSegment.endDate)&&(r=t.previousSegment.endDate),t.nextSegment&&(!n||n<t.nextSegment.startDate)&&(n=t.nextSegment.startDate),{start:r,end:n}}get tipId(){return this.client.id+"-segment-drag-tip"}internalSnapToPosition(e){super.internalSnapToPosition(),this.client.rtl&&!this.dragData.eventRecord.nextSegment&&(e.x=0)}updateDragContext(e,t){var r;super.updateDragContext(...arguments);const{client:n}=this,{dirty:i,eventRecord:s,endDate:a}=this.dragData;if(i&&!s.nextSegment){const{enableEventAnimations:e}=n;n.enableEventAnimations=!1,s.event.set("endDate",a),(null==(r=n.features.eventBuffer)?void 0:r.enabled)&&(s.event.wrapEndDate=a),n.enableEventAnimations=e}}};__publicField(EventSegmentDrag,"$name","EventSegmentDrag"),EventSegmentDrag._$name="EventSegmentDrag",GridFeatureManager.registerFeature(EventSegmentDrag,!0,"SchedulerPro"),GridFeatureManager.registerFeature(EventSegmentDrag,!1,"ResourceHistogram");var EventSegmentResize=class extends EventResize2{static get pluginConfig(){return{chain:[...super.pluginConfig.chain,"isEventSegmentElementDraggable"]}}render(){super.render(...arguments),this.dragSelector=this.dragItemSelector=".b-sch-event-segment"}isEventSegmentElementDraggable(e,t,r,n){return this.isEventElementDraggable(...arguments)}isEventElementDraggable(e,t,r,n){const i=this,s=null==t?void 0:t.resizable;if(i.disabled||!s||t.isMilestone)return!0;if(t.segments){const r=i.client.scheduledEventName;return t.segments.every(((t,s)=>{const a=t.resizable,o=DomSync.getChild(e,r+".segments."+s);return!a||(!0!==a&&"start"!==a||!i.isOverStartHandle(n,o))&&(!0!==a&&"end"!==a||!i.isOverEndHandle(n,o))}))}return super.isEventElementDraggable(...arguments)}get tipId(){return this.client.id+"-event-segment-resize-tip"}dragStart(e){return this._segmentsSlices=null,this._segmentsSlicesIndex=0,super.dragStart(...arguments)}beginEventRecordBatch(e){super.beginEventRecordBatch(e),e.isEventSegment&&e.event.beginBatch()}triggerBeforeResize(e){const{client:t}=this,r=t.scheduledEventName,n=t.resolveTimeSpanRecord(e.itemElement);return t.trigger("before"+t.capitalizedEventName+"SegmentResize",{[r+"Record"]:n,event:e.event,...this.getBeforeResizeParams({event:e.startEvent,element:e.itemElement})})}triggerEventResizeStart(e,t){const{client:r}=this;r.trigger(r.scheduledEventName+"SegmentResizeStart",t)}triggerEventResizeEnd(e,t){const{client:r}=this;r.trigger(r.scheduledEventName+"SegmentResizeEnd",t)}triggerEventPartialResize(e,t){const{client:r}=this;r.trigger(r.scheduledEventName+"SegmentPartialResize",t)}triggerBeforeEventResizeFinalize(e,t){const{client:r}=this;r.trigger("before"+r.capitalizedEventName+"SegmentResizeFinalize",t)}applyDateConstraints(e,t,r){var n,i;let s=null==(n=r.dateConstraints)?void 0:n.start,a=null==(i=r.dateConstraints)?void 0:i.end;if(t.isEventSegment){const{previousSegment:e,nextSegment:r}=t;e&&(s=s?DateHelper.max(e.endDate,s):e.endDate),r&&(a=a?DateHelper.min(r.startDate,a):r.startDate)}return(s||a)&&(e=DateHelper.constrain(e,s,a),r.snappedDate=DateHelper.constrain(r.snappedDate,s,a)),e}resizeEventPartiallyInternal(e,t){const r=this,{toSet:n}=t;if(super.resizeEventPartiallyInternal(...arguments),e.isEventSegment)if(e.nextSegment||"endDate"!==n)if(e.previousSegment||"startDate"!==n){const t=e.event.get("segments");r._segmentsSlices=r._segmentsSlices||[t.slice(),t.slice()],r._segmentsSlicesIndex=(r._segmentsSlicesIndex+1)%2,e.event.set("segments",r._segmentsSlices[r._segmentsSlicesIndex])}else e.event.set("startDate",t[n]);else e.event.set("endDate",t[n])}cancelEventRecordBatch(e){super.cancelEventRecordBatch(e),e.isEventSegment&&e.event.cancelBatch()}highlightHandle(){const{overItem:e}=this;e.classList.add("b-resize-handle","b-over-resize-handle")}unHighlightHandle(e=this.overItem){null==e||e.classList.remove("b-resize-handle",this.resizingItemInnerCls,"b-over-resize-handle",this.draggingItemCls)}};__publicField(EventSegmentResize,"$name","EventSegmentResize"),EventSegmentResize._$name="EventSegmentResize",GridFeatureManager.registerFeature(EventSegmentResize,!0,"SchedulerPro"),GridFeatureManager.registerFeature(EventSegmentResize,!1,"ResourceHistogram");var EventSegments=class extends InstancePlugin{onElementMouseOut(e){const{client:t}=this,{target:r,relatedTarget:n}=e,i=r.closest(t.eventSelector),s=t.resolveTimeSpanRecord(r);(null==s?void 0:s.isEventSegment)&&i&&t.hoveredEvents.has(i)&&n&&DomHelper.isDescendant(i,n)||this.overridden.onElementMouseOut(...arguments)}getElementsFromEventRecord(e,t){if(null==e?void 0:e.isEventSegment){const r=this.overridden.getElementsFromEventRecord(e.event,t)[0];return[DomSync.getChild(r,"segments."+e.segmentIndex)]}return this.overridden.getElementsFromEventRecord(...arguments)}resolveEventRecord(e){const t=e instanceof Event?e.target:e,r=null==t?void 0:t.closest(".b-sch-event-segment");let n=this.overridden.resolveEventRecord(e);return(null==n?void 0:n.segments)&&r&&(n=n.segments[r.dataset.segment]),n}resolveTaskRecord(e){const t=null==e?void 0:e.closest(".b-sch-event-segment");let r=this.overridden.resolveTaskRecord(e);return(null==r?void 0:r.segments)&&t&&(r=r.segments[t.dataset.segment]),r}populateTaskMenu(e){e.eventRecord=e.taskRecord,e.targetElement.closest(e.feature.client.eventSelector)&&this.populateEventMenu(e)}populateEventMenu({eventRecord:e,taskRecord:t,items:r,domEvent:n}){const i=this;if(!i.client.readOnly&&!e.isParent&&!e.milestone){const t=n.target.closest(".b-sch-event-segment");if(t){const n=i.client.resolveEventRecord(t);r.renameSegment={localeClass:i,text:"L{renameSegment}",icon:"gt-icon gt-icon-rename",disabled:e.readOnly||n.readOnly,weight:660,onItem(){i.rename(n,t)}}}}}getSplitDate(e){const{eventRecord:t,date:r,timeAxis:n}=e;return n.roundDate(r,t.startDate)}getSplitDuration(e){const{splitDuration:t,minSplitDuration:r,maxSplitDuration:n}=this;if(null==t?void 0:t.magnitude)return t.magnitude;const{eventRecord:i,tick:s}=e;if(s){const t=this.getSplitDurationUnit(e),{project:a}=i;let o=s.endDate-s.startDate;if(n){const e=a.run("$convertDuration",n.magnitude,n.unit||t,"millisecond");o=Math.min(o,e)}if(r){const e=a.run("$convertDuration",r.magnitude,r.unit||t,"millisecond");o=Math.max(o,e)}return a.run("$convertDuration",o,"millisecond",t)}}getSplitDurationUnit(e){const{splitDuration:t}=this;return(null==t?void 0:t.unit)||e.eventRecord.durationUnit}splitEvent(e){const{client:t}=e.feature,{timeAxis:r}=t;e.date=t.getDateFromXY(e.point,void 0,!1),e.tick=r.getAt(Math.floor(r.getTickFromDate(e.date))),e.timeAxis=r,e.eventRecord.splitToSegments(this.getSplitDate(e),this.getSplitDuration(e),this.getSplitDurationUnit(e))}rename(e,t){const{client:r}=this;new Editor({owner:r,appendTo:r.timeAxisSubGridElement,scrollAction:"realign",align:{align:"c-c"},cls:"b-event-segment-renamer",internalListeners:{complete(){r.refresh()},thisObj:this}}).startEdit({target:t,record:e,field:"name"})}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}generateSegmentRenderData(e,t){var r;let n,i;if(this.client.isGantt){const r=this.client.currentOrientation,n=r.getTaskBox(e),s={taskRecord:e,task:e,row:t.row,children:[]};n&&Object.assign(s,{isTask:!0,top:n.top,left:n.left,width:n.width,height:n.height}),r.internalPopulateTaskRenderData(s,e),i=s}else i=this.client.generateRenderData(e,t.resourceRecord,!0);return i&&(n={segmentRecord:e,eventContent:i.eventContent||i.taskContent,cls:i.cls||(null==(r=e.cls)?void 0:r.clone())||new DomClassList,top:t.top,left:i.left-t.left,width:i.width,height:t.height},Object.assign(n.cls,{["b-sch-color-"+i.eventColor]:i.eventColor,"b-sch-event-segment":!0,"b-first":!e.previousSegment,"b-last":!e.nextSegment},i.cls)),n}appendDOMConfig(e){const t=e.eventRecord||e.taskRecord;if(t.segments&&!this.disabled){const r=e.eventContent||e.taskContent,n=e.children.indexOf(r);n>-1&&e.children.splice(n,1),delete e.eventContent,delete e.taskContent,e.cls["b-segmented"]=!0,e.segments=t.segments.map((t=>this.generateSegmentRenderData(t,e))),e.segmentsDOMConfig=e.segments.map(this.getSegmentDOMConfig.bind(this)),e.children.unshift({syncOptions:{syncIdField:"segment",releaseThreshold:0},className:"b-sch-event-segments",dataset:{taskBarFeature:"segments"},children:e.segmentsDOMConfig})}}getSegmentDOMConfig(e,t){return{className:e.cls,style:{left:e.left,height:e.height,width:e.width},dataset:{segment:t},syncOptions:{syncIdField:"taskBarFeature"},children:[e.eventContent]}}onEventDataGenerated(e){this.appendDOMConfig(e)}onTaskDataGenerated(e){this.appendDOMConfig(e)}get featureClass(){}};__publicField(EventSegments,"$name","EventSegments"),__publicField(EventSegments,"configurable",{splitDuration:0,maxSplitDuration:{magnitude:1,unit:"day"},minSplitDuration:0}),__publicField(EventSegments,"pluginConfig",{override:["getElementsFromEventRecord","resolveEventRecord","resolveTaskRecord","onElementMouseOut"],chain:["populateTaskMenu","populateEventMenu","onTaskDataGenerated","onEventDataGenerated"]}),EventSegments._$name="EventSegments",GridFeatureManager.registerFeature(EventSegments,!0,"SchedulerPro"),GridFeatureManager.registerFeature(EventSegments,!0,"Gantt");var borderWidths={border:1,hollow:2},NestedEvents=class extends(InstancePlugin.mixin(AttachToProjectMixin_default,Delayable_default)){construct(e,t){super.construct(e,t),this.client.eventStore.tree=!0}refreshClient(){!this.client.isConfiguring&&this.client.refreshWithTransition()}doDisable(){this.refreshClient()}updateEventLayout(e){"stack"===e&&this.client.isVertical&&console.warn("Stacked nested events are not supported in vertical mode"),this.refreshClient()}updateBarMargin(){this.refreshClient()}updateResourceMargin(){this.refreshClient()}updateEventHeight(){this.refreshClient()}updateHeaderHeight(e){this.client.element.style.setProperty("--schedulerpro-nested-event-header-height",e+"px"),this.refreshClient()}getEventLayout(e,t){return t?{type:this.eventLayout}:this.overridden.getEventLayout(e)}getResourceMargin(e,t){return t&&!t.isRoot?this.resourceMargin:this.overridden.getResourceMargin(e)}getBarMargin(e,t){return t&&!t.isRoot?this.barMargin:this.overridden.getBarMargin(e)}getAppliedResourceHeight(e,t){var r;const n=this;if(t&&!t.isRoot){if("stack"===n.eventLayout)return n.eventHeight+2*n.resourceMargin;{const i=null!=(r=borderWidths[n.client.getEventStyle(t,e)])?r:0;return n.currentParentsHeight-n.headerHeight-i}}return n.overridden.getAppliedResourceHeight(e)}getResourceWidth(e,t){return t&&!t.isRoot?this.currentParentsWidth-this.headerHeight:this.overridden.getResourceWidth(e)}attachToEventStore(e){null==e||e.ion({name:"eventStore",change:"onEventStoreChange",thisObj:this})}onEventStoreChange({records:e}){(null==e?void 0:e.some((e=>e.parent&&!e.parent.isRoot)))&&this.refreshClient()}onEventStoreBatchedUpdate({records:e}){if(this.client.listenToBatchedUpdates&&(null==e?void 0:e.some((e=>e.parent&&!e.parent.isRoot))))return this.refreshClient(),!1}beforeEventDragStart(e,t){const r=this,{client:n}=r,{eventRecord:i,assignmentRecords:s}=t,{parentElement:a}=e.element;if(i.parent&&a!==n.foregroundCanvas){r.isDraggingNestedEvent=!0,e.originalParentElement=a,e.originalBounds=[];for(const t of s){const{event:s}=t;if(s.parent===i.parent){const i=n.getElementFromAssignmentRecord(t,!0);if(e.originalBounds.push({element:i,bounds:Rectangle.from(i,a)}),!r.constrainDragToParent&&n.features.eventDrag.constrainDragToTimeline){const e=Rectangle.from(i,n.timeAxisSubGridElement);i.style.top=e.top+"px",i.style.left=e.left+"px",DomSync.addChild(n.foregroundCanvas,i,t.id)}}}}else r.isDraggingNestedEvent=!1}afterEventDragStart(e,t){if(this.isDraggingNestedEvent&&this.constrainDragToParent){const{eventDrag:r}=this.client.features,{parent:n}=t.eventRecord,i=e.originalParentElement.getBoundingClientRect();r.setYConstraint(0,i.height-e.originalBounds[0].bounds.height),r.setXConstraint(0,i.width-e.originalBounds[0].bounds.width),t.dateConstraints={start:n.startDate,end:n.endDate}}}checkEventDragValidity({targetEventRecord:e,eventRecord:t,timeDiff:r,newResource:n,resourceRecord:i}){const s=this;return!s.isDraggingNestedEvent||s.allowDeNestingOnDrop||e||!r&&n===i?!s.allowNestingOnDrop&&e&&e!==t.parent?{valid:!1,message:s.L("L{nestingNotAllowed}")}:void 0:{valid:!1,message:s.L("L{deNestingNotAllowed}")}}processEventDrop({context:e,toScheduler:t,eventRecord:r,resourceRecord:n,reassignedFrom:i,element:s,eventsToAdd:a,addedEvents:o,draggedAssignment:l}){var c;const{parent:d}=r,{targetEventRecord:u}=e;let h=d;if(d!==u&&!this.constrainDragToParent&&!(null==(c=r.children)?void 0:c.length)){if(u&&this.allowNestingOnDrop){h=u.parent.isRoot?u:u.parent;const t=this.client.resolveResourceRecord(e.browserEvent);t!==n&&(n=l.resource=t)}else h=t.eventStore.rootNode;h&&h!==d&&(o.push(h.appendChild(r)),ArrayHelper.remove(a,r))}if((null==d?void 0:d.isRoot)&&r.isParent&&i&&i!==n)for(const e of r.children){const t=e.assignments.find((e=>e.resource===i));t&&(t.resource=n)}if(h&&!h.isRoot){const e=this.client.getElementFromEventRecord(h,n).syncIdMap.nestedEventsContainer,t=e&&Rectangle.from(s,e);e&&(s.style.top=t.top+"px",s.style.left=t.left+"px",s.lastDomConfig=null,DomSync.addChild(e,s,s.dataset.syncId))}}processCrossSchedulerEventDrop({eventRecord:e}){if(e.isParent)for(const t of e.children)t.resource=e.resource}async afterEventDragAbortFinalized({originalParentElement:e,originalBounds:t}){if(this.isDraggingNestedEvent){for(const e of t[0].element.getAnimations())"top"!==e.transitionProperty&&"left"!==e.transitionProperty||await e.finished;for(const{element:r,bounds:n}of t)r.style.top=n.top+"px",r.style.left=n.left+"px",e.appendChild(r)}}afterEventResizeStart(e){if(this.constrainResizeToParent){const{parent:t}=e.timespanRecord;if(t&&!t.isRoot){let{startDate:r,endDate:n}=t;e.dateConstraints&&(r=DateHelper.max(r,e.dateConstraints.start),n=DateHelper.min(n,e.dateConstraints.end)),e.dateConstraints={start:r,end:n}}}}getElementFromAssignmentRecord(e,t){var r;if((null==(r=null==e?void 0:e.event)?void 0:r.parent)&&!e.event.parent.isRoot){const r=this.client.getElementFromEventRecord(e.event.parent,e.resource);return DomSync.getChild(r,"nestedEventsContainer."+e.id+(t?"":".event"))}return this.overridden.getElementFromAssignmentRecord(e,t)}async scheduleEvent({eventRecord:e,parentEventRecord:t,startDate:r,element:n}){if(!t)return this.overridden.scheduleEvent(...arguments);if(e.startDate=r,(e=t.appendChild(e)).assign(t.resource),n){const r=this.client.getElementFromEventRecord(t).syncIdMap.nestedEventsContainer,i=Rectangle.from(n,r);DomHelper.setTranslateXY(n,0,0),DomHelper.setTopLeft(n,i.y,i.x),DomSync.addChild(r,n,e.assignments[0].id)}await this.client.project.commitAsync()}getEventsToRender(e,t){return this.disabled||ArrayHelper.remove(t,...t.filter((e=>e.isEventModel&&!e.parent.isRoot))),t}onEventDataGenerated({eventRecord:e,resourceRecord:t,wrapperCls:r,height:n,width:i,children:s,left:a,top:o}){if(e.isParent){r["b-nested-events-parent"]=1;const l=this;l.currentParentsHeight=n,l.currentParentsWidth=i;const{currentOrientation:c,isVertical:d}=l.client,u=e.children.filter((e=>{var r;return null==(r=e.$linkedResources)?void 0:r.includes(t)})),h=c.layoutEvents(t,u,!1,e,l.overlappingEventSorter),g=[];let p;if(d){p=[];for(const e of Object.values(h))p.push(e.renderData)}else p=null==h?void 0:h.eventsData;if(p)for(const r of p){d?(r.left-=a,r.top-=o,r.absoluteTop=r.top):("none"===l.eventLayout?(r.top=0,r.height=l.getAppliedResourceHeight(t,e)):"stack"===l.eventLayout&&(r.height=l.eventHeight),r.left-=a,r.absoluteTop=r.top);const i=c.renderEvent(d?{renderData:r}:r,n);i.className["b-nested-event"]=1,g.push(i)}s.push({className:{"b-nested-events-container":1,["b-nested-events-layout-"+l.eventLayout]:1},dataset:{taskBarFeature:"nestedEventsContainer"},children:g,syncOptions:{syncIdField:"syncId",releaseThreshold:0}})}}};function cls(e){return"b-task-percent-bar"+(e[0]?"-"+e[0]:"")}__publicField(NestedEvents,"$name","NestedEvents"),__publicField(NestedEvents,"configurable",{eventLayout:"pack",barMargin:5,resourceMargin:0,eventHeight:30,headerHeight:20,constrainDragToParent:!1,allowNestingOnDrop:!0,allowDeNestingOnDrop:!0,constrainResizeToParent:!0}),__publicField(NestedEvents,"pluginConfig",{before:["onEventStoreBatchedUpdate"],chain:["getEventsToRender","onEventDataGenerated","processEventDrop","processCrossSchedulerEventDrop","beforeEventDragStart","afterEventDragStart","afterEventDragAbortFinalized","checkEventDragValidity","afterEventResizeStart"],override:["getResourceMargin","getBarMargin","getAppliedResourceHeight","getResourceWidth","getEventLayout","getElementFromAssignmentRecord","scheduleEvent"]}),__publicField(NestedEvents,"delayable",{refreshClient:"raf"}),NestedEvents._$name="NestedEvents",GridFeatureManager.registerFeature(NestedEvents,!1,"SchedulerPro");var PercentBar=class extends InstancePlugin{static get $name(){return"PercentBar"}static get configurable(){return{allowResize:!0,showPercentage:!0,instantUpdate:!0,valueField:"percentDone",displayField:"renderedPercentDone"}}static get pluginConfig(){return{chain:["onPaint",{fn:"onTaskDataGenerated",prio:-1e4},{fn:"onEventDataGenerated",prio:-1e4}]}}onPaint({firstPaint:e}){if(e){const e=this,{client:t}=e;e.drag=new DragHelper({name:"percentBarHandle",lockX:t.isVertical,lockY:t.isHorizontal,targetSelector:t.eventSelector+" .b-task-percent-bar-handle",dragThreshold:1,outerElement:t.timeAxisSubGridElement,internalListeners:{beforeDragStart:"onBeforeDragStart",dragStart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",thisObj:e}}),e.detachListeners("view"),e.client.ion({name:"view",[t.scheduledEventName+"mouseenter"]:"onTimeSpanMouseEnter",[t.scheduledEventName+"mouseleave"]:"onTimeSpanMouseLeave",thisObj:e})}}get sizeProp(){return this.client.isVertical?"height":"width"}get offsetSizeProp(){return this.client.isVertical?"offsetHeight":"offsetWidth"}get positionProp(){return this.client.isVertical?"top":this.client.rtl?"right":"left"}get offsetPositionProp(){return this.client.isVertical?"offsetTop":this.client.rtl?"offsetRight":"offsetLeft"}updateAllowResize(e){this.client.element.classList.toggle(cls`drag-disabled`,!e)}updateShowPercentage(e){this.client.element.classList.toggle(cls`show-percentage`,Boolean(e))}doDestroy(){var e;null==(e=this.drag)||e.destroy(),super.doDestroy()}doDisable(e){this.client.isPainted&&this.client.refresh(),super.doDisable(e)}reset(e){const t=this,{project:r}=t.client;if(t.client.element.classList.remove(cls`resizing-task`),t.isMouseInsideEvent||(t.handle.remove(),t.handle=null),t.instantUpdate){const{stm:n}=r;n.disabled||(t._stmTransactionStarted&&(e.valid?n.stopTransaction():n.rejectTransaction()),n.autoRecord=t.oldStmAutoRecord,t._stmTransactionStarted=!1),r.resumeAutoSync(),t.client.eventStore.resumeAutoCommit()}}getPercentBarDOMConfig(e){return{className:cls`outer`,dataset:{taskBarFeature:"percentBar"},children:[{className:cls``,dataset:{percent:e[this.displayField]},style:{[this.sizeProp]:e[this.valueField]+"%"}}]}}appendDOMConfig(e,t,r){if((e.isEvent||e.isTask)&&!e.isMilestone&&!this.disabled){const{eventSegments:n}=this.client.features;e.isSegmented&&(null==n?void 0:n.enabled)?e.segments.forEach(((e,t)=>{r.segmentsDOMConfig[t].children.unshift(this.getPercentBarDOMConfig(e))})):t.unshift(this.getPercentBarDOMConfig(e))}}onEventDataGenerated(e){this.appendDOMConfig(e.eventRecord,e.children,e)}onTaskDataGenerated(e){this.appendDOMConfig(e.taskRecord,e.children,e)}getHoverSegment(e){const t=(e.toElement||e.target).closest(".b-sch-event-segment");if(t){const r=Rectangle.from(t);if(null==r?void 0:r.contains(EventHelper.getPagePoint(e)))return t}}isOverSegment(e){return Boolean(this.getHoverSegment(e))}onTimeSpanMouseEnter(e){const t=this,{client:r,sizeProp:n}=t,i=e[r.scheduledEventName+"Record"];if(!(i.isMilestone||i.readOnly||t.disabled||i.isParent)&&i.isEditable(t.valueField))if(t.drag.context)i===t.drag.context.taskRecord&&(t.isMouseInsideEvent=!0);else{const s=e[r.scheduledEventName+"Element"],a=DomSync.getChild(s,r.scheduledEventName);if(!t.handle){const e={percent:i[t.valueField]};let s=i[t.valueField]+"%";const{eventSegments:o}=r.features;if(i.isSegmented&&(null==o?void 0:o.enabled)){e.segment=0;const o=Rectangle.from(a);let l,c;i.segments.some(((r,n)=>{if(!r[t.valueField]&&100!==l)return!0;l=r[t.valueField],e.segment=n;const i=DomSync.getChild(a,"segments."+n+".percentBar").firstChild;c=Rectangle.from(i)})),s=r.isVertical?c?c.top+c[n]-o.top:0:r.rtl?c?c.right+c[n]-o.right:0:c?c.left+c[n]-o.left:0}t.handle=DomHelper.createElement({parent:a,className:cls`handle`,style:{[t.positionProp]:s},dataset:e})}t.isMouseInsideEvent=!0}}onTimeSpanMouseLeave(e){const t=this;!t.drag.context&&t.handle&&e.event.toElement!==t.handle&&(t.handle.remove(),t.handle=null),t.isMouseInsideEvent=!1}onBeforeDragStart({source:e,context:t,event:r}){const{client:n,offsetPositionProp:i,offsetSizeProp:s}=this,{eventSegments:a}=n.features,{element:o}=t,l=n.resolveEventRecord(o);let c,d,u,h;if(l.isSegmented&&(null==a?void 0:a.enabled)){const e=o.dataset.segment;c=DomSync.getChild(o.parentElement,"segments."+e+".percentBar"),d=c.firstElementChild,h=o.parentElement[s],u=DomSync.getChild(o.parentElement,"segments."+e)[i]+d[s]}else c=DomSync.getChild(o.parentElement,"percentBar"),d=c.firstElementChild,h=c[s],u=d[s];n.isVertical?(e.minY=-u,e.maxY=h-u):n.rtl?(e.maxX=u,e.minX=-(h-u)):(e.minX=-u,e.maxX=h-u),Object.assign(t,{percentBar:d,initialPos:u,size:h,taskRecord:l,initialValue:l[this.valueField],domEvent:r})}onDragStart({context:e,event:t}){const{client:r}=this,{project:n}=r;r.element.classList.add(cls`resizing-task`),e.element.retainElement=!0,e.domEvent=t,r.trigger("percentBarDragStart",e),this.instantUpdate&&(n.suspendAutoSync(),r.eventStore.suspendAutoCommit(),n.stm.disabled||(this.oldStmAutoRecord=n.stm.autoRecord,n.stm.autoRecord=!1))}onDrag({context:e,event:t}){const r=this,{sizeProp:n,offsetSizeProp:i,client:s}=r,a=s.isHorizontal?Math.round((e.initialPos+e.newX*(s.rtl?-1:1))/e.size*100):Math.round((e.initialPos+e.newY)/e.size*100),{eventSegments:o}=s.features;if(r.instantUpdate){const{stm:t}=s.project;t.disabled||t.transaction||(t.startTransaction(),r._stmTransactionStarted=!0),e.taskRecord[r.valueField]=a}e.domEvent=t,e.percent=e.element.dataset.percent=a,e.taskRecord.isSegmented&&(null==o?void 0:o.enabled)&&e.taskRecord.segments.forEach(((t,r)=>{const s=DomSync.getChild(e.element.parentElement,"segments."+r+".percentBar").firstChild,o=DomSync.getChild(e.element.parentElement,"segments."+r);if(e.percent>=t.endPercentDone)s.style[n]=o[i]+"px";else if(e.percent<=t.startPercentDone)s.style[n]="0";else if(e.percent>=t.startPercentDone&&e.percent<=t.endPercentDone){const e=t.endPercentDone-t.startPercentDone;s.style[n]=(a-t.startPercentDone)*o[i]/e+"px"}})),s.trigger("percentBarDrag",e)}onDragAbort({context:e,event:t}){e.taskRecord.isSegmented&&(e.percentBar.style[this.sizeProp]=e.taskRecord.segments[e.element.dataset.segment][this.valueField]+"%"),e.taskRecord[this.valueField]=e.initialValue,e.domEvent=t,this.reset(e),this.client.trigger("percentBarDragAbort",e)}onDrop({context:e}){const t=this,{taskRecord:r}=e,{eventSegments:n}=t.client.features;r[t.valueField]=e.percent,r.isSegmented&&(null==n?void 0:n.enabled)?r.segments.some(((r,n)=>{if(e.percent>=r.startPercentDone&&e.percent<=r.endPercentDone){const i=r.endPercentDone-r.startPercentDone,s=DomSync.getChild(e.element.parentElement,"segments."+n),a=parseInt(s.style[t.sizeProp])+(e.percent-r.startPercentDone)*s[t.offsetSizeProp]/i;return e.element.style.cssText=t.positionProp+": "+a+"px",e.element.dataset.segment=n,!0}})):e.element.style.cssText=t.positionProp+": "+(t.client.rtl?100-e.percent:e.percent)+"%",t.reset(e),t.client.trigger("percentBarDrop",e)}get featureClass(){}};PercentBar._$name="PercentBar",GridFeatureManager.registerFeature(PercentBar,!1,"SchedulerPro"),GridFeatureManager.registerFeature(PercentBar,!0,"Gantt");var ResourceNonWorkingTime=class extends ResourceTimeRangesBase{static get properties(){return{resourceMap:new Map}}construct(){var e;super.construct(...arguments),this.resourceTimeRangeModelClass=(e=class extends this.resourceTimeRangeModelClass{},__publicField(e,"$name","ResourceNonWorkingTimeModel"),__publicField(e,"domIdPrefix","resourcenonworkingtimemodel"),e),this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this})}attachToResourceStore(e){super.attachToResourceStore(e),null==e||e.ion({name:"resourceStore",changePreCommit:"onResourceChange",thisObj:this})}attachToCalendarManagerStore(e){super.attachToCalendarManagerStore(e),null==e||e.ion({name:"calendarManagerStore",changePreCommit:"onCalendarChange",thisObj:this})}onTimeAxisReconfigure(){this.resourceMap.clear()}onResourceChange({action:e,records:t,record:r,changes:n}){var i;const s=this;if("update"===e){const e=n.calendar;!e||"string"==typeof e.oldValue&&(null==(i=e.value)?void 0:i.id)===e.oldValue||(s.resourceMap.delete(r.id),s.client.runWithTransition((()=>{s.client.currentOrientation.refreshEventsForResource(r)})))}"remove"===e&&t.forEach((e=>s.resourceMap.delete(e.id))),"removeall"===e&&s.resourceMap.clear()}onCalendarChange({action:e,records:t,record:r,changes:n}){this.resourceMap.clear(),this.client.refresh()}getEventsToRender(e,t){const r=this,{resourceMap:n,client:i}=r,{timeAxis:s}=i,a=!r.maxTimeAxisUnit||DateHelper.compareUnits(s.unit,r.maxTimeAxisUnit)<=0;if(!r.disabled&&a&&e.effectiveCalendar){if(!n.has(e.id)){const t=e.effectiveCalendar.getNonWorkingTimeRanges(i.startDate,i.endDate).map(((t,n)=>new r.resourceTimeRangeModelClass({id:"r"+e.id+"i"+n,iconCls:t.iconCls||e.effectiveCalendar.iconCls||"",cls:(e.effectiveCalendar.cls||"")+" "+(t.cls||""),startDate:t.startDate,endDate:t.endDate,name:t.name||"",resourceId:e.id,isNonWorking:!0})));n.set(e.id,t)}t.push(...n.get(e.id))}return t}shouldInclude({isNonWorking:e}){return e}resolveResourceNonWorkingTimeInterval(e){var t;return null==(t=null==e?void 0:e.closest(".b-sch-resourcenonworkingtime"))?void 0:t.elementData.eventRecord}};__publicField(ResourceNonWorkingTime,"$name","ResourceNonWorkingTime"),__publicField(ResourceNonWorkingTime,"configurable",{rangeCls:"b-sch-resourcenonworkingtime",maxTimeAxisUnit:"hour",enableMouseEvents:!1,resourceTimeRangeModelClass:ResourceTimeRangeModel,entityName:"resourceNonWorkingTime"}),ResourceNonWorkingTime.featureClass="",ResourceNonWorkingTime._$name="ResourceNonWorkingTime",GridFeatureManager.registerFeature(ResourceNonWorkingTime,!1,"SchedulerPro");var ProTaskEditStm_default=e=>class extends(e||Base){static get $name(){return"TaskEditStm"}captureStm(){const e=this,t=e.project.getStm();e.stmInitiallyDisabled=t.disabled,e.stmInitiallyAutoRecord=t.autoRecord,e.stmInitiallyDisabled?(t.enable(),t.autoRecord=!1):(e.stmInitiallyAutoRecord&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction())}startStmTransaction(){this.project.getStm().startTransaction()}commitStmTransaction(){const e=this,t=e.project.getStm();t.enabled&&(t.stopTransaction(),e.stmInitiallyDisabled&&t.resetQueue())}async rejectStmTransaction(){var e;const t=this.project.getStm(),{client:r}=this;t.enabled&&((null==(e=t.transaction)?void 0:e.length)?(r.suspendRefresh(),t.rejectTransaction(),await r.resumeRefresh(!0)):t.stopTransaction())}enableStm(){this.project.getStm().enable()}disableStm(){this.project.getStm().disable()}freeStm(){const e=this,t=e.project.getStm();t.disabled=e.stmInitiallyDisabled,t.autoRecord=e.stmInitiallyAutoRecord}},ReadyStatePropagator_default=e=>class extends(e||Events_default(Base)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}get widgetClass(){}},locale6={localeName:"Ch",localeDesc:"中文",localeCode:"en-US",ConstraintTypePicker:{none:"None",muststarton:"Must start on",mustfinishon:"Must finish on",startnoearlierthan:"Start no earlier than",startnolaterthan:"Start no later than",finishnoearlierthan:"Finish no earlier than",finishnolaterthan:"Finish no later than"},CalendarField:{"Default calendar":"Default calendar"},TaskEditorBase:{Information:"信息",Save:"保存",Cancel:"取消",Delete:"删除",calculateMask:"计算中...",saveError:"无法保存，请先更正错误",repeatingInfo:"查看重复事件",editRepeating:"编辑"},TaskEdit:{"Edit task":"编辑任务",ConfirmDeletionTitle:"确认删除",ConfirmDeletionMessage:"确定要删除该事件?"},GanttTaskEditor:{editorWidth:"44em"},SchedulerTaskEditor:{editorWidth:"34em"},SchedulerGeneralTab:{labelWidth:"6em",General:"General",Name:"Name",Resources:"Resources","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Preamble:"Preamble",Postamble:"Postamble"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},SchedulerAdvancedTab:{labelWidth:"13em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint",Rollup:"Rollup",Inactive:"Inactive","Ignore resource calendar":"Ignore resource calendar"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag",cyclicDependency:"Cyclic dependency",invalidDependency:"Invalid dependency"},NotesTab:{Notes:"Notes"},ResourcesTab:{unitsTpl:({value:e})=>e+"%",Resources:"Resources",Resource:"Resource",Units:"Units"},RecurrenceTab:{title:"Repeat"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"},ResourceHistogram:{barTipInRange:'<b>{resource}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',barTipOnDate:'<b>{resource}</b> on {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated',groupBarTipAssignment:'<b>{resource}</b> - <span class="{cls}">{allocated} of {available}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more"},ResourceUtilization:{barTipInRange:'<b>{event}</b> {startDate} - {endDate}<br><span class="{cls}">{allocated}</span> allocated',barTipOnDate:'<b>{event}</b> on {startDate}<br><span class="{cls}">{allocated}</span> allocated',groupBarTipAssignment:'<b>{event}</b> - <span class="{cls}">{allocated}</span>',groupBarTipInRange:'{startDate} - {endDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',groupBarTipOnDate:'On {startDate}<br><span class="{cls}">{allocated} of {available}</span> allocated:<br>{assignments}',plusMore:"+{value} more",nameColumnText:"Resource / Event"},SchedulingIssueResolutionPopup:{"Cancel changes":"取消更改",schedulingConflict:"日程安排冲突",emptyCalendar:"日历配置错误",cycle:"提示",Apply:"应用"},CycleResolutionPopup:{dependencyLabel:"请选择依赖项:",invalidDependencyLabel:"存在需要解决的无效依赖项:"},DependencyEdit:{Active:"激活"},SchedulerProBase:{propagating:"正在计算项目",storePopulation:"正在加载数据",finalizing:"最终确定结果"},EventSegments:{splitEvent:"拆分事件",renameSegment:"重命名"},NestedEvents:{deNestingNotAllowed:"De-nesting not allowed",nestingNotAllowed:"Nesting not allowed"},VersionGrid:{compare:"Compare",description:"Description",occurredAt:"Occurred At",rename:"Rename",restore:"Restore",stopComparing:"Stop Comparing"},Versions:{entityNames:{TaskModel:"task",AssignmentModel:"assignment",DependencyModel:"link",ProjectModel:"project",ResourceModel:"resource",other:"object"},entityNamesPlural:{TaskModel:"tasks",AssignmentModel:"assignments",DependencyModel:"links",ProjectModel:"projects",ResourceModel:"resources",other:"objects"},transactionDescriptions:{update:"Changed {n} {entities}",add:"Added {n} {entities}",remove:"Removed {n} {entities}",move:"Moved {n} {entities}",mixed:"Changed {n} {entities}"},addEntity:"Added {type} **{name}**",removeEntity:"Removed {type} **{name}**",updateEntity:"Changed {type} **{name}**",moveEntity:"Moved {type} **{name}** from {from} to {to}",addDependency:"Added link from **{from}** to **{to}**",removeDependency:"Removed link from **{from}** to **{to}**",updateDependency:"Edited link from **{from}** to **{to}**",addAssignment:"Assigned **{resource}** to **{event}**",removeAssignment:"Removed assignment of **{resource}** from **{event}**",updateAssignment:"Edited assignment of **{resource}** to **{event}**",noChanges:"No changes",nullValue:"none",versionDateFormat:"YYYY-M-D h:mm a",undid:"Undid changes",redid:"Redid changes",editedTask:"Edited task properties",deletedTask:"Deleted a task",movedTask:"Moved a task",movedTasks:"Moved tasks"}},En_default5=LocaleHelper.publishLocale(locale6),TaskEditorBase=class extends(Popup.mixin(ReadyStatePropagator_default)){static get $name(){return"TaskEditorBase"}static get type(){return"taskeditorbase"}static get configurable(){return{localizableProperties:["width"],title:"L{Information}",cls:"b-schedulerpro-taskeditor",closable:!0,layout:"fit",draggable:{handleSelector:":not(button,.b-field-inner)"},items:null,bbar:{hideWhenEmpty:!0,defaults:{localeClass:this},items:{saveButton:{text:"L{Save}",color:"b-blue",cls:"b-raised",weight:100},deleteButton:{text:"L{Delete}",weight:200},cancelButton:{text:"L{Object.Cancel}",weight:300}}},strips:{occurrenceInfoToolbar:{cls:"occurrence-info-toolbar",hidden:!0,ignoreParentReadOnly:!0,items:[{type:"widget",tag:"i",cls:"gt-icon gt-icon-locked"},{ref:"occurrenceInfoText",type:"label",localeClass:this,text:"L{repeatingInfo}"},"->",{ref:"editOccurrenceButton",localeClass:this,text:"L{editRepeating}",onClick:"up.onEditOccurrenceClick"}]}},width:{$config:{localeKey:"L{editorWidth}"}}}}static get defaultConfig(){return{axisLock:"flexible",autoClose:!0,onChange:null,onCancel:null,onSave:null,autoShow:!1,blurAction:"cancel",scrollAction:"realign",durationDisplayPrecision:1,tabPanelItems:null,defaultTabs:null,calculateMask:null,calculateMaskDelay:100,localizableProperties:["calculateMask"],project:null,dependencyIdField:null}}processWidgetConfig(e){var t;if((null==(t=e.type)?void 0:t.includes("date"))&&null==e.weekStartDay&&(e.weekStartDay=this.weekStartDay),"tabs"===e.ref&&this.extraItems){const t={};for(const e in this.extraItems){t[e.replace("tab","Tab")]={items:Array.isArray(this.extraItems[e])?ObjectHelper.transformArrayToNamedObject(this.extraItems[e]):this.extraItems[e]}}ObjectHelper.merge(e.items,t)}return e}changeItems(e){const{tabPanelItems:t={}}=this,r=ObjectHelper.clone(e),n=r.find((e=>"tabs"===e.ref));return this.cleanItemsConfig(t),ObjectHelper.merge(n.items,t),super.changeItems(r)}cleanItemsConfig(e){for(const t in e){const r=e[t];!0===r?delete e[t]:(null==r?void 0:r.items)&&this.cleanItemsConfig(r.items)}}afterConfigure(){var e;const t=this,{widgetMap:r}=t,{tabs:n}=r,{cancelButton:i,deleteButton:s,saveButton:a}=(null==(e=t.bbar)?void 0:e.widgetMap)||{};null==a||a.ion({click:"onSaveClick",thisObj:t}),null==i||i.ion({click:"onCancelClick",thisObj:t}),null==s||s.ion({click:"onDeleteClick",thisObj:t}),Object.values(r).forEach((e=>{e.isDurationField?e.decimalPrecision=this.durationDisplayPrecision:"startDate"===e.ref||"endDate"===e.ref?e.project=this.project:"predecessorsTab"!==e.ref&&"successorsTab"!==e.ref||(e.grid.durationDisplayPrecision=this.durationDisplayPrecision,e.dependencyIdField=e.dependencyIdField||t.dependencyIdField),e.isReadyStatePropagator&&e.ion({readyStateChange:"onReadyStateChange",thisObj:t})})),n.onFieldChange=({source:e})=>{const{name:r,isValid:n,value:i}=e;t.loadedRecord&&r&&n&&!t.isLoadingEvent&&!e.up("recurrenceeditorpanel")&&(t.loadedRecord[r]=i)}}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach((t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)})),e}async hide(){const e=this;e.detachListeners("project"),e.detachListeners("eventStore"),e._delayedAction=null;const t=await super.hide(this.element.matches(":focus-within"));return e.isDestroyed||e.trigger(e.blurAction),t}toggleFieldsDisabled(e){this.eachWidget((t=>{if(t.isField&&t.name&&!t.up("recurrenceeditorpanel")){void 0!==e.isEditable(t.name)&&(t.disabled=!e.isEditable(t.name))}}))}loadEvent(e,t=!1){var r;const n=this,i=null!=(r=n.project)?r:e.project;n.isLoadingEvent=!0,n.widgetMap.occurrenceInfoToolbar.hidden=!e.isOccurrence&&!e.isRecurring||n.editingRecurring,n.toggleFieldsDisabled(e),n.callWidgetHook("loadEvent",e,t),n.detachListeners("project"),n.loadedRecord=e,i.ion({name:"project",beforeCommit:"onProjectBeforeCommit",dataReady:"onProjectDataReady",thisObj:n}),n.detachListeners("eventStore"),i.eventStore.ion({name:"eventStore",remove:"onTaskRemove",thisObj:n}),n.isLoadingEvent=!1,n.trigger("loadEvent")}callWidgetHook(e,...t){this.eachWidget((r=>{"function"==typeof r[e]&&r[e](...t)}))}onDocumentMouseDown(e){const t=this;let r=null;if(Object.values(t.widgetMap).some((e=>e._activeCellEdit))){const{event:n}=e,{saveButton:i,cancelButton:s,deleteButton:a}=t.widgetMap,o=n.target.closest("button");if(o)switch(o){case null==i?void 0:i.element:r=t.onSaveClick;break;case null==s?void 0:s.element:r=t.onCancelClick;break;case null==a?void 0:a.element:r=t.onDeleteClick}}t._delayedAction=r,super.onDocumentMouseDown(e)}onSaveClick(){const e=this;e._delayedAction=null,e.canSave?e.trigger("save"):Toast.show({rootElement:e.rootElement,html:e.L("L{saveError}")})}onCancelClick(){this.close()}onDeleteClick(){this._delayedAction=null,this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.tab.element.classList.remove("b-invalid"),e.tab.icon=null,e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.tab.element.classList.add("b-invalid"),e.tab.icon="gt-icon-warning",e.title=e.couldSaveTitle))}onTaskRemove(){this.afterDelete()}onProjectBeforeCommit(){this.calculateMask&&this.mask({text:this.calculateMask,showDelay:this.calculateMaskDelay})}onProjectDataReady({records:e}){var t;const r=this;r.calculateMask&&r.unmask(),e.has(r.loadedRecord)&&r.callWidgetHook("afterProjectChange"),null==(t=r._delayedAction)||t.call(r)}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.loadedRecord=void 0,this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.loadedRecord=void 0,this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.loadedRecord=void 0,this.callWidgetHook("afterDelete")}onInternalKeyDown(e){if(!e.handled&&"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()){if(e.target.matches("input")){const t=Widget.fromElement(e.target);!(null==t?void 0:t.internalOnChange)||t.isCheckbox||t.isSlider||t.internalOnChange()}e.preventDefault(),this.onSaveClick()}super.onInternalKeyDown(e)}onEditOccurrenceClick(){const e=this;Widget.create({type:"recurrenceconfirmation",owner:e}).confirm({actionType:"update",eventRecord:e.loadedRecord,changerFn:t=>{var r;const n=null!=(r=t.recurringTimeSpan)?r:t;e.resetRecurrenceData={recurringTimeSpan:n,originalExceptionDates:{...n.exceptionDates}},t.isRecurring||(t.convertToRealEvent({startDate:t.startDate}),t.constraintDate=null)},finalizerFn:t=>{t.isRecurring&&(e.editingRecurring=!0,e.readOnly=!1),e.loadEvent(t)}})}updateReadOnly(e){const{deleteButton:t,saveButton:r,cancelButton:n,tabs:i}=this.widgetMap,{items:s}=i;super.updateReadOnly(e),t&&(t.hidden=e),r&&(r.hidden=e),n&&(n.hidden=e);for(let t=0,{length:r}=s;t<r;t++)s[t].readOnly=e}};TaskEditorBase.initClass(),TaskEditorBase._$name="TaskEditorBase";var EventLoader_default=e=>class extends(e||Container){get project(){var e,t,r;return null!=(r=null==(e=this.up((e=>e.isTaskEditorBase)))?void 0:e.project)?r:null==(t=this.record)?void 0:t.project}loadEvent(e,t){this.setRecord(e,t)}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}get widgetClass(){}},EditorTab=class extends(Container.mixin(EventLoader_default,ReadyStatePropagator_default)){static get $name(){return"EditorTab"}static get type(){return"editortab"}static get configurable(){return{title:null,strictRecordMapping:!0}}};EditorTab._$name="EditorTab";var FormTab=class extends EditorTab{static get $name(){return"FormTab"}static get type(){return"formtab"}static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},autoUpdateRecord:!0}}onFieldChange({source:e,valid:t,userAction:r}){r&&(t=void 0!==t?t:"function"==typeof e.isValid?e.isValid():e.isValid)&&super.onFieldChange(...arguments)}};FormTab.initClass(),FormTab._$name="FormTab";var year2300=new Date(2300,0,1),StartDateField=class extends DateField{static get $name(){return"StartDateField"}static get type(){return"startdatefield"}static get alias(){return"startdate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get calendarProvider(){var e,t;return(null!=(t=null==(e=this.eventRecord)?void 0:e.recurringEvent)?t:this.eventRecord)||this.project}get backShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit)}get forwardShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!0),t}transformTimeValue(e){const{calendarProvider:t,keepTime:r}=this;if(t&&"entered"!==r){const r=DateHelper.clearTime(e),n=t.run("skipNonWorkingTime",r);if(DateHelper.isValidDate(n)&&DateHelper.isEqual(n,r,"day"))return DateHelper.copyTimeValues(r,n)}return super.transformTimeValue(e)}get min(){var e;return super.min||(null==(e=this.project)?void 0:e.startDate)}set min(e){super.min=e}get max(){var e;return super.max||(null==(e=this.project)?void 0:e.startDate)?DateHelper.add(this.project.startDate,200,"year"):year2300}set max(e){super.max=e}};StartDateField.initClass(),StartDateField._$name="StartDateField";var year23002=new Date(2300,0,1),EndDateField=class extends DateField{static get $name(){return"EndDateField"}static get type(){return"enddatefield"}static get alias(){return"enddate"}static get defaultConfig(){return{project:null,eventRecord:null,strictParsing:!0}}get min(){var e;let t=this._min;const r=null==(e=this.eventRecord)?void 0:e.startDate;return r&&(t=DateHelper.max(t||r,r)),t}set min(e){super.min=e}get max(){var e;return super.max||(null==(e=this.project)?void 0:e.startDate)?DateHelper.add(this.project.startDate,200,"year"):year23002}set max(e){super.max=e}get calendarProvider(){var e,t;return(null!=(t=null==(e=this.eventRecord)?void 0:e.recurringEvent)?t:this.eventRecord)||this.project}get backShiftDate(){const e=this;let t=e.calendarProvider.run("skipWorkingTime",e.value,!1,e._step.magnitude,e._step.unit);return t=t&&e.calendarProvider.run("skipNonWorkingTime",t,!1),t}get forwardShiftDate(){const e=this;return e.calendarProvider.run("skipWorkingTime",e.value,!0,e._step.magnitude,e._step.unit)}transformTimeValue(e){const{calendarProvider:t,keepTime:r}=this;if(t&&"entered"!==r){const r=DateHelper.clearTime(e),n=DateHelper.add(r,1,"day"),i=t.run("skipNonWorkingTime",n,!1);if(DateHelper.isValidDate(i)&&DateHelper.isEqual(i,r,"day"))return DateHelper.copyTimeValues(r,i)}return!r&&e&&this.min&&DateHelper.clearTime(e,!1)<this.min?this.min:super.transformTimeValue(e)}};EndDateField.initClass(),EndDateField._$name="EndDateField";var EffortField=class extends DurationField{static get $name(){return"EffortField"}static get type(){return"effort"}static get alias(){return"effortfield"}};EffortField.initClass(),EffortField._$name="EffortField";var GeneralTab=class extends FormTab{static get $name(){return"GeneralTab"}static get type(){return"generaltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this},items:{name:{type:"text",weight:100,required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name"},percentDone:{type:"number",weight:200,label:"L{% complete}",name:"renderedPercentDone",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},effort:{type:"effort",weight:300,label:"L{Effort}",name:"fullEffort",flex:"1 0 50%"},divider:{html:"",weight:400,dataset:{text:this.L("L{Dates}")},cls:"b-divider",flex:"1 0 100%"},startDate:{type:"startdate",weight:500,label:"L{Start}",name:"startDate",cls:"b-start-date b-inline",flex:"1 0 50%"},endDate:{type:"enddate",weight:600,label:"L{Finish}",name:"endDate",cls:"b-end-date b-last-row",flex:"1 0 50%"},duration:{type:"durationfield",weight:700,label:"L{Duration}",name:"fullDuration",flex:".5 0",cls:"b-inline"}}}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{startDate:r,endDate:n,effort:i}=this.widgetMap;r&&(r.step=t,r.eventRecord=e),n&&(n.step=t,n.eventRecord=e),i&&(i.unit=e.effortUnit),super.loadEvent(e)}};GeneralTab.initClass(),GeneralTab._$name="GeneralTab";var buildItems=e=>e.map(((e,t)=>[t,e])),DependencyTypePicker=class extends Combo{static get $name(){return"DependencyTypePicker"}static get type(){return"dependencytypepicker"}construct(e){super.construct(e),LocaleManager_default.ion({locale:()=>{this.items=buildItems(this.L("L{DependencyType.long}"))},thisObj:this})}get store(){return this._items||(this.items=this._items=buildItems(this.L("L{DependencyType.long}"))),super.store}set store(e){super.store=e}};DependencyTypePicker.initClass(),DependencyTypePicker._$name="DependencyTypePicker";var markDependencyValid=(e,t)=>{e.instanceMeta(t).valid=!0},markDependencyInvalid=(e,t)=>{e.instanceMeta(t).valid=!1},isDependencyMarkedValid=(e,t)=>!1!==e.instanceMeta(t).valid,DependencyTab=class extends EditorTab{static get $name(){return"DependencyTab"}static get type(){return"dependencytab"}static get configurable(){return{dependencyIdField:null,layoutStyle:{flexFlow:"column nowrap"},sortField:null,taskComboSortField:"name",items:{grid:{type:"grid",weight:100,flex:"1 1 auto",emptyText:"",asyncEventSuffix:"PreCommit",disableGridRowModelWarning:!0,features:{group:!1},columns:{data:{id:{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,hidden:!0,sortable(e,t){var r,n;const{dependencyIdField:i,direction:s}=this.grid.parent,a=null==(r=e[s])?void 0:r[i],o=null==(n=t[s])?void 0:n[i];return a===o?0:a<o?-1:1},renderer:({record:e,row:t,grid:r,column:n})=>{let i;const{direction:s}=r.parent,a=e[s];if(a&&isDependencyMarkedValid(e,r)){const e=r.parent.dependencyIdField,t=a[e];i="id"===e?!a||a.hasGeneratedId?"*":a.id:t}else t.addCls("b-invalid"),i='<div class="gt-icon gt-icon-warning"></div>';return i}},name:{localeClass:this,text:"L{Name}",flex:5,renderer:({value:e,grid:t,cellElement:r})=>{if(e){r.classList.toggle("b-inactive",e.inactive);const n=e[t.parent.dependencyIdField];return e.name+(null==n||e.hasGeneratedId?"":" ("+n+")")}return""},finalizeCellEdit:"up.finalizeLinkedTaskCellEdit",editor:{type:"modelcombo",displayField:"name",valueField:"id",filterOperator:"*",allowInvalid:!0,listItemTpl(e){const t=this,r=t._dependencyTab||(t._dependencyTab=t.up("dependencytab",!0)),{dependencyIdField:n}=r,i=e.hasGeneratedId&&"id"===n?null:e[n];return StringHelper.xss`${e.name}${null!=i?" ("+i+")":""}`}}},type:{localeClass:this,text:"L{Type}",field:"type",flex:3,sortable:!1,editor:"dependencytypepicker",renderer({value:e}){return this.L("L{DependencyType.long}")[e]}},lag:{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}}}},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"gt-icon gt-icon-add",onAction:"up.onAddClick"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"gt-icon gt-icon-trash",disabled:!0,onAction:"up.onRemoveClick"}}}}}}async finalizeLinkedTaskCellEdit({grid:e,value:t,record:r}){const{project:n}=e.store.masterStore,i="toEvent"===this.direction,s=i?r.fromEvent:t,a=i?t:r.toEvent;switch(await n.validateDependency(s,a,r.type,r)){case DependencyValidationResult.NoError:return!0;case DependencyValidationResult.CyclicDependency:return"L{DependencyTab.cyclicDependency}"}return"L{DependencyTab.invalidDependency}"}afterConstruct(){super.afterConstruct();(this.grid=this.widgetMap.grid).ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:this})}get taskCombo(){const{grid:e}=this,t=null==e?void 0:e.columns.get(this.direction);return null==t?void 0:t.editor}loadEvent(e){const t=this,{grid:r,taskCombo:n,record:i}=t;super.loadEvent(e);const{dependencyStore:s,eventStore:a}=t.project,o=r.store.masterStore!==s,l=!o&&e!==i;if(o){t.depStoreGeneration=s.storage.generation,t.eventStoreGeneration=a.storage.generation,t.detachListeners("taskCombo"),r.store=s.chain((e=>e[t.negDirection]===t.record),null);const e=n.store=a.chain((e=>e!==t.record),null,{doRelayToMaster:[],excludeCollapsedRecords:!1});e.sort(t.taskComboSortField),e.filterBy((e=>!r.store.find((r=>{const n=r[t.direction],i=t._activeCellEdit,s=i&&n===i.record[t.direction];return n===e&&!s})))),n.ion({name:"taskCombo",change:"onGridCellEditChange",thisObj:t})}else l||s.storage.generation!==t.depStoreGeneration?(r.store.fillFromMaster(),t.depStoreGeneration=s.storage.generation):r.refreshRows(),(l||a.storage.generation!==t.eventStoreGeneration)&&(n.store.fillFromMaster(),t.eventStoreGeneration=a.storage.generation);l&&r.store.sort(t.sortField),t.requestReadyStateChange()}async insertNewDependency(){const e=this,{grid:t}=e,{cellEdit:r}=t.features;r.isEditing&&!r.editor.isValid&&r.cancelEditing();const[n]=t.store.insert(0,{type:DependencyType.EndToStart,lag:0,lagUnit:TimeUnit.Day,[e.negDirection]:e.record});return e.depStoreGeneration=e.project.dependencyStore.storage.generation,await t.features.cellEdit.startEditing({field:e.direction,id:n.id}),markDependencyInvalid(n,t),n}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,{grid:t}=e,r=t.selectedRecords;t.features.cellEdit.cancelEditing(!0),e.project.dependencyStore.remove(r),t.selectedRecord=t.store.getNext(r[0]),e.taskCombo.store.fillFromMaster()}onGridSelectionChange({selection:e}){const t=this.widgetMap.remove,r=Boolean(!(null==e?void 0:e.length)||this.up((e=>e.readOnly)));t.containsFocus&&r&&this.grid.focusCell({rowIndex:-1,columnIndex:0}),t.disabled=r}clearActiveEditorErrors(){const e=this._activeCellEdit;e&&e.column.field===this.direction&&e.editor.inputField.clearError()}onGridCellEditChange(){this.clearActiveEditorErrors()}onGridStartCellEdit({editorContext:e}){const t=this,r=t._editingDependency=e.record,{grid:n,direction:i}=t;t._activeCellEdit=e,e.column.field===i&&(isDependencyMarkedValid(r,n)?t.clearActiveEditorErrors():r[i]?e.editor.inputField.setError("L{DependencyTab.cyclicDependency}"):e.editor.inputField.setError("L{DependencyTab.invalidDependency}"))}async onGridFinishCellEdit({editorContext:e}){const t=this,{record:r,column:n}=e,{grid:i,direction:s}=t;n.field===s?(markDependencyValid(r,i),t.taskCombo.store.fillFromMaster()):t.redrawDependencyRow(r),t._activeCellEdit=t._editingDependency=null,t.requestReadyStateChange()}afterCancel(){this._activeCellEdit&&this.grid.features.cellEdit.cancelEditing(!0)}onGridCancelCellEdit(){const e=this,t=e._editingDependency;t&&(t[e.direction]||(markDependencyInvalid(t,e.grid),e.redrawDependencyRow(t)),e._activeCellEdit=e._editingDependency=null),e.requestReadyStateChange()}redrawDependencyRow(e){const{grid:t}=this,r=t.rowManager.getRowById(e);if(r){t.store.indexOf(e)>=0&&r.render(t.store.indexOf(e),e)}}get canSave(){const{grid:e}=this;return e.store.every((t=>isDependencyMarkedValid(t,e)))}};DependencyTab._$name="DependencyTab";var SuccessorsTab=class extends DependencyTab{static get $name(){return"SuccessorsTab"}static get type(){return"successorstab"}static get configurable(){return{cls:"b-successors-tab",direction:"toEvent",negDirection:"fromEvent",title:"L{DependencyTab.Successors}",sortField:"toEventName",items:{grid:{columns:{data:{name:{field:"toEvent"}}}}}}}};SuccessorsTab.initClass(),SuccessorsTab._$name="SuccessorsTab";var PredecessorsTab=class extends DependencyTab{static get $name(){return"PredecessorsTab"}static get type(){return"predecessorstab"}static get configurable(){return{cls:"b-predecessors-tab",direction:"fromEvent",negDirection:"toEvent",title:"L{DependencyTab.Predecessors}",sortField:"fromEventName",items:{grid:{columns:{data:{name:{field:"fromEvent"}}}}}}}};PredecessorsTab.initClass(),PredecessorsTab._$name="PredecessorsTab";var ResourcesTab=class extends EditorTab{static get $name(){return"ResourcesTab"}static get type(){return"resourcestab"}static get configurable(){return{title:"L{Resources}",cls:"b-resources-tab",layoutStyle:{flexFlow:"column nowrap"},showUnits:null,items:{grid:{type:"grid",weight:100,flex:"1 1 auto",columns:{data:{resource:{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>(null==e?void 0:e.name)||"",editor:{type:"modelcombo",displayField:"name",valueField:"id"}},units:{type:"number",localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("L{unitsTpl}",e),min:0,max:100,step:10}}},disableGridRowModelWarning:!0,asyncEventSuffix:"PreCommit"},toolbar:{type:"toolbar",dock:"bottom",cls:"b-compact-bbar",items:{add:{type:"button",weight:210,cls:"b-add-button b-green",icon:"gt-icon gt-icon-add"},remove:{type:"button",weight:220,cls:"b-remove-button b-red",icon:"gt-icon gt-icon-trash",disabled:!0}}}}}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap.add,r=e.removeButton=e.widgetMap.remove,n=e.grid=e.widgetMap.grid;null==t||t.ion({click:"onAddClick",thisObj:e}),null==r||r.ion({click:"onRemoveClick",thisObj:e}),n.ion({selectionChange:"onGridSelectionChange",startCellEdit:"onGridStartCellEdit",finishCellEdit:"onGridFinishCellEdit",cancelCellEdit:"onGridCancelCellEdit",thisObj:e})}updateReadOnly(e){const{add:t,remove:r}=this.widgetMap;super.updateReadOnly(...arguments),t.hidden=r.hidden=e}get resourceCombo(){var e;const t=null==(e=this.grid)?void 0:e.columns.get("resource");return null==t?void 0:t.editor}updateShowUnits(e){var t;const r=null==(t=this.grid)?void 0:t.columns.get("units");r&&(r.hidden=!e)}loadEvent(e){const t=this,{resourceCombo:r,grid:n,record:i}=t;super.loadEvent(e);const{assignmentStore:s,resourceStore:a}=t.project,o=n.store.masterStore!==s,l=!o&&e!==i;"boolean"!=typeof this.showUnits&&(n.columns.get("units").hidden=!e.isTask),o?(t.assignmentStoreGeneration=s.storage.generation,t.resourceStoreGeneration=a.storage.generation,n.store=s.chain((e=>t.record&&e.event===t.record),null),r.store=a.chain((e=>!e.isSpecialRow&&t.record&&!t.record.isAssignedTo(e)||!t.activeAssignment||t.activeAssignment.resource===e),null,{groupers:a.groupers})):((l||s.storage.generation!==t.assignmentStoreGeneration)&&n.store.fillFromMaster(),(l||a.storage.generation!==t.resourceStoreGeneration)&&r.store.fillFromMaster())}get activeAssignment(){return this.grid.features.cellEdit.activeRecord}async insertNewAssignment(){const e=this,{project:t,grid:r}=e,n=t.assignmentStore,[i]=n.insert(0,{event:e.record,resource:null,units:100});return e.assignmentStoreGeneration=n.storage.generation,await r.features.cellEdit.startEditing({field:"resource",id:i.id}),i}beforeSave(){this.pruneInvalidAssignments()}onAddClick(){this.insertNewAssignment()}onRemoveClick(){const{grid:e}=this;e.store.remove(e.selectedRecords),e.selectedRecords=null,this.removeButton.disable()}onGridSelectionChange({selection:e}){const{removeButton:t}=this,r=!(null==e?void 0:e.length)||this.up((e=>e.readOnly));t.containsFocus&&r&&this.grid.focus(),t.disabled=r}onGridStartCellEdit({editorContext:e}){"resource"===e.column.field&&(this.resourceCombo.store.fillFromMaster(),this._editingAssignment=e.record,this._activeCellEdit=e)}onGridFinishCellEdit(){this._activeCellEdit=this._editingAssignment=null}onGridCancelCellEdit(){this._activeCellEdit=this._editingAssignment=null}pruneInvalidAssignments(){const{store:e}=this.grid;e.remove(e.query((e=>!e.isValid)))}};ResourcesTab.initClass(),ResourcesTab._$name="ResourcesTab";var ConstraintTypePicker=class extends Combo{static get $name(){return"ConstraintTypePicker"}static get type(){return"constrainttypepicker"}static get configurable(){return{valueField:"id"}}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(){const e=this;return[{id:"none",text:e.L("L{none}")},{id:"muststarton",text:e.L("L{muststarton}")},{id:"mustfinishon",text:e.L("L{mustfinishon}")},{id:"startnoearlierthan",text:e.L("L{startnoearlierthan}")},{id:"startnolaterthan",text:e.L("L{startnolaterthan}")},{id:"finishnoearlierthan",text:e.L("L{finishnoearlierthan}")},{id:"finishnolaterthan",text:e.L("L{finishnolaterthan}")}]}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get store(){return this._store||(this.store=new Store({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}};ConstraintTypePicker.initClass(),ConstraintTypePicker._$name="ConstraintTypePicker";var SchedulingModePicker=class extends Combo{static get $name(){return"SchedulingModePicker"}static get type(){return"schedulingmodecombo"}static get configurable(){return{allowedModes:null,store:{data:this.defaultStoreData}}}static get defaultStoreData(){return[{id:SchedulingMode.Normal,text:this.L("L{Normal}")},{id:SchedulingMode.FixedDuration,text:this.L("L{Fixed Duration}")},{id:SchedulingMode.FixedUnits,text:this.L("L{Fixed Units}")},{id:SchedulingMode.FixedEffort,text:this.L("L{Fixed Effort}")}]}changeAllowedModes(e){return"string"==typeof e?e.split(","):e}updateAllowedModes(e){this._allowedModes=e,e?this.store.addFilter({id:"allowed-mode-filter",filterBy:e=>this._allowedModes.includes(e.id)}):this.store.removeFilter("allowed-mode-filter")}updateLocalization(){super.updateLocalization(),this.store.data=this.constructor.defaultStoreData}};SchedulingModePicker.initClass(),SchedulingModePicker._$name="SchedulingModePicker";var AdvancedTab=class extends FormTab{static get $name(){return"AdvancedTab"}static get type(){return"advancedtab"}static get defaultConfig(){const e={flex:"0 0 64%",labelWidth:"30%",cls:"b-inline"},t={flex:"0 0 34%",labelWidth:"80%"};return{localeClass:this,title:"L{Advanced}",cls:"b-advanced-tab",defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",weight:100,ref:"",name:"calendar",label:"L{Calendar}",...e},ignoreResourceCalendarField:{type:"checkbox",weight:100,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",cls:"b-ignore-resource-calendar",...t},schedulingModeField:{type:"schedulingmodecombo",weight:300,name:"schedulingMode",label:"L{Scheduling mode}",...e},effortDrivenField:{type:"checkbox",weight:400,name:"effortDriven",label:"L{Effort driven}",...t},divider:{weight:500,html:"",dataset:{text:this.L("L{Constraint}")},cls:"b-divider",flex:"1 0 100%"},constraintTypeField:{type:"constrainttypepicker",weight:600,name:"constraintType",label:"L{Constraint type}",clearable:!0,...e},rollupField:{type:"checkbox",weight:700,name:"rollup",label:"L{Rollup}",...t},constraintDateField:{type:"date",weight:800,name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",...e},inactiveField:{type:"checkbox",weight:900,name:"inactive",label:"L{Inactive}",...t},manuallyScheduledField:{type:"checkbox",weight:1e3,name:"manuallyScheduled",label:"L{Manually scheduled}",cls:"b-last-row",style:"margin-left:auto",...t}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get rollupField(){return this.widgetMap.rollupField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const{calendarField:t,constraintTypeField:r}=this,{calendarManagerStore:n}=e.project,i=(null==t?void 0:t.store)!==n;if(t&&i&&(t.store=n.chain(void 0,void 0,{excludeCollapsedRecords:!1})),null==r?void 0:r.isConstraintTypePicker){const{store:t}=r;t.removeFilter("constraintTypeApplicable"),t.filter({id:"constraintTypeApplicable",filterBy:t=>e.run("isConstraintTypeApplicable",t.id)})}super.loadEvent(e)}afterDelete(){const{constraintTypeField:e}=this;(null==e?void 0:e.isConstraintTypePicker)&&e.store.removeFilter("constraintTypeApplicable"),super.afterDelete(...arguments)}};AdvancedTab.initClass(),AdvancedTab._$name="AdvancedTab";var NotesTab=class extends FormTab{static get $name(){return"NotesTab"}static get type(){return"notestab"}static get configurable(){return{cls:"b-notes-tab",title:this.L("L{Notes}"),tab:{icon:"gt-icon-note",titleProperty:"tooltip"},layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:{noteField:{weight:100,type:"textfield",inputAttributes:{tag:"textarea"},cls:"b-taskeditor-notes-field",name:"note"}}}}};NotesTab.initClass(),NotesTab._$name="NotesTab";var GanttTaskEditor=class extends TaskEditorBase{static get type(){return"gantttaskeditor"}static get $name(){return"GanttTaskEditor"}static get defaultConfig(){return{items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"generaltab",weight:100},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},resourcesTab:{type:"resourcestab",weight:400},advancedTab:{type:"advancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}};GanttTaskEditor.initClass(),GanttTaskEditor._$name="GanttTaskEditor";var SchedulerGeneralTab=class extends FormTab{static get $name(){return"SchedulerGeneralTab"}static get type(){return"schedulergeneraltab"}static get defaultConfig(){return{title:"L{General}",cls:"b-general-tab",defaults:{localeClass:this,weight:10},items:{nameField:{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",cls:"b-name",weight:100},resourcesField:{type:"combo",label:"L{Resources}",name:"resources",editable:!0,valueField:"id",displayField:"name",highlightExternalChange:!1,cls:"b-resources",weight:200},startDateField:{type:"datetime",label:"L{Start}",name:"startDate",cls:"b-start-date",flex:"1 0 100%",weight:300,dateField:{type:"startdatefield"}},endDateField:{type:"datetime",label:"L{Finish}",name:"endDate",cls:"b-end-date",flex:"1 0 100%",weight:400,dateField:{type:"enddatefield"}},durationField:{type:"durationfield",label:"L{Duration}",name:"fullDuration",flex:"1 0 50%",cls:"b-inline",min:0,weight:500},percentDoneField:{type:"number",label:"L{% complete}",name:"renderedPercentDone",flex:"1 0 50%",min:0,max:100,weight:600},effortField:{type:"durationfield",label:"L{Effort}",name:"fullEffort",weight:620},preambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:650,label:"L{SchedulerGeneralTab.Preamble}",name:"preamble",flex:"1 0 50%",cls:"b-inline"},postambleField:{type:"durationfield",hidden:!0,useAbbreviation:!0,weight:660,label:"L{SchedulerGeneralTab.Postamble}",name:"postamble",flex:"1 0 50%"}}}}loadEvent(e){var t;const{project:r}=this,n={unit:e.durationUnit,magnitude:1},{isParent:i}=e,{durationField:s,percentDoneField:a,startDateField:o,endDateField:l,resourcesField:c}=this.widgetMap,d=(null==c?void 0:c.store.masterStore)!==r.resourceStore;s&&(s.disabled=i,a||s.element.classList.remove("b-inline")),a&&(a.disabled=i),o&&(o.dateField.eventRecord=e,DateHelper.compareUnits(n.unit,"hour")>0?o.dateField.step=n:o.timeField.step=n),l&&(l.dateField.eventRecord=e,DateHelper.compareUnits(n.unit,"hour")>0?l.dateField.step=n:l.timeField.step=n,l.disabled=i),c&&(c.multiSelect=null!=(t=c.config.multiSelect)?t:!r.eventStore.usesSingleAssignment,d&&(c.store=r.resourceStore.chain((e=>!e.isSpecialRow)))),super.loadEvent(...arguments)}onFieldChange({source:e,valid:t,userAction:r,value:n}){if(r&&t){const{eventStore:t}=this.record,r="resources"===e.name&&0===n.length&&this.autoUpdateRecord&&t.removeUnassignedEvent;r&&(t.removeUnassignedEvent=!1),super.onFieldChange(...arguments),r&&(t.removeUnassignedEvent=!0)}}beforeSave(){0===this.record.resources.length&&this.record.eventStore.removeUnassignedEvent&&this.record.remove(),super.beforeSave()}};SchedulerGeneralTab.initClass(),SchedulerGeneralTab._$name="SchedulerGeneralTab";var RecurrenceTab=class extends EditorTab{get recurrenceEditor(){return this.widgetMap.recurrenceEditor}loadEvent(e){var t;this.recurrenceEditor&&(this.loadingRecord=!0,this.recurrenceEditor.record=null!=(t=e.recurrence)?t:null,this.loadingRecord=!1),super.loadEvent(e)}onFieldChange({source:e,value:t}){const r=this;if(!r.isConfiguring&&!r.recurrenceEditor.assigningValues&&!r.loadingRecord){const{record:n}=r;n.recurrence?e===r.recurrenceEditor.widgetMap.frequencyField&&"NONE"===t?n.recurrence=null:r.recurrenceEditor.syncEventRecord(n.recurrence):n.recurrence=new n.recurrenceModel({}),r.up((e=>e.isTaskEditorBase)).editingRecurring=!0}}};__publicField(RecurrenceTab,"$name","RecurrenceTab"),__publicField(RecurrenceTab,"type","recurrencetab"),__publicField(RecurrenceTab,"configurable",{title:"L{title}",cls:"b-recurrence-tab",scrollable:!0,items:{recurrenceEditor:{type:"recurrenceeditorpanel",addNone:!0}}}),RecurrenceTab.initClass(),RecurrenceTab._$name="RecurrenceTab";var SchedulerAdvancedTab=class extends FormTab{static get $name(){return"SchedulerAdvancedTab"}static get type(){return"scheduleradvancedtab"}static get configurable(){return{cls:"b-advanced-tab",tab:{icon:"gt-icon-advanced",tooltip:"L{SchedulerAdvancedTab.Advanced}"},defaults:{localeClass:this},items:{calendarField:{type:"calendarfield",name:"calendar",label:"L{Calendar}",weight:100},constraintTypeField:{type:"constrainttypepicker",name:"constraintType",label:"L{Constraint type}",clearable:!0,weight:200},constraintDateField:{type:"date",name:"constraintDate",label:"L{Constraint date}",keepTime:"entered",weight:300},manuallyScheduledField:{type:"checkbox",name:"manuallyScheduled",label:"L{Manually scheduled}",weight:400},schedulingModeField:{type:"schedulingmodecombo",name:"schedulingMode",label:"L{Scheduling mode}",hidden:!0,weight:450,allowedModes:SchedulingMode.Normal+","+SchedulingMode.FixedDuration},effortDrivenField:{type:"checkbox",weight:460,name:"effortDriven",label:"L{Effort driven}",hidden:!0,flex:"1 0 50%"},inactiveField:{type:"checkbox",weight:500,name:"inactive",label:"L{Inactive}"},ignoreResourceCalendarField:{type:"checkbox",weight:600,name:"ignoreResourceCalendar",label:"L{Ignore resource calendar}",flex:"1 0 50%"}}}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}get effortDrivenField(){return this.widgetMap.effortDrivenField}get manuallyScheduledField(){return this.widgetMap.manuallyScheduledField}get schedulingModeField(){return this.widgetMap.schedulingModeField}loadEvent(e){const t=this,{project:r}=t,{calendarField:n}=(t.record,t);n&&(n.store=r.calendarManagerStore,n.hidden=!r.calendarManagerStore.count),super.loadEvent(...arguments)}};SchedulerAdvancedTab.initClass(),SchedulerAdvancedTab._$name="SchedulerAdvancedTab";var bufferRe=/(pre|post)amble/,SchedulerTaskEditor=class extends TaskEditorBase{static get type(){return"schedulertaskeditor"}static get $name(){return"SchedulerTaskEditor"}static get defaultConfig(){return{enableEventSpanBuffer:!1,items:[{type:"tabpanel",defaultType:"formtab",ref:"tabs",flex:"1 0 100%",autoHeight:!0,layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:{generalTab:{type:"schedulergeneraltab",weight:100},recurrenceTab:{type:"recurrencetab",weight:150},predecessorsTab:{type:"predecessorstab",weight:200},successorsTab:{type:"successorstab",weight:300},advancedTab:{type:"scheduleradvancedtab",weight:500},notesTab:{type:"notestab",weight:600}}}]}}processWidgetConfig(e){var t,r;return(null==(t=e.ref)?void 0:t.match(bufferRe))&&(e.hidden=!this.enableEventSpanBuffer),"recurrenceTab"===e.ref&&(e.hidden=!(null==(r=this.owner)?void 0:r.enableRecurringEvents)),super.processWidgetConfig(e)}onFocusOut({relatedTarget:e}){var t;const r=null==(t=null==e?void 0:e.closest(".b-sch-event-wrap"))?void 0:t.elementData.eventRecord;if(!r||r!==this.loadedRecord)return super.onFocusOut(...arguments);this.setTimeout((()=>this.focus()),100)}};SchedulerTaskEditor.initClass(),SchedulerTaskEditor._$name="SchedulerTaskEditor";var TaskEdit=class extends(InstancePlugin.mixin(Delayable_default,ProTaskEditStm_default)){static get $name(){return"TaskEdit"}static get pluginConfig(){return{chain:["populateEventMenu","onEventEnterKey"],assign:["editEvent"]}}static get defaultConfig(){return{triggerEvent:"eventdblclick",editorClassMap:{[ProjectType.SchedulerBasic]:"schedulertaskeditor",[ProjectType.SchedulerPro]:"schedulertaskeditor",[ProjectType.Gantt]:"gantttaskeditor"},editorClass:null,editorConfig:null,confirmDelete:!0,saveAndCloseOnEnter:!0,blurAction:"cancel",weekStartDay:null,scrollIntoView:!0}}static get configurable(){return{items:null,suspendHasChangesEvent:!1}}construct(e,t){var r;e.taskEdit=this,super.construct(e,ObjectHelper.assign({weekStartDay:e.weekStartDay,enableEventSpanBuffer:null==(r=e.features.eventBuffer)?void 0:r.enabled},t)),e.ion({[this.triggerEvent]:"onActivateEditor",readOnly:"onClientReadOnlyToggle",dragCreateEnd:"onDragCreateEnd",afterEventDrop:"onEventDropped",eventResizeEnd:"onEventResized",thisObj:this})}doDestroy(){var e;this.detachFromProject(),null==(e=this.editor)||e.destroy(),this.deleteConfirmationPromise&&MessageDialog_default.hide(),super.doDestroy()}onClientReadOnlyToggle({readOnly:e}){this.editor&&(this.editor.readOnly=e)}get scheduler(){return this.client}getElementFromTaskRecord(e,t){return this.client.getElementFromEventRecord(e,t)}scrollEventIntoView(e,t){this.client.scrollResourceEventIntoView(t,e)}get isValid(){return this.editor.eachWidget((e=>!!(!0===e.isValid||e.hidden||e.disabled||e.isField&&!e.name)||!1!==e.isValid),!0)}get project(){return this.scheduler.project}attachToProject(){this.detachFromProject(),this.project.ion({name:"project",loadstart:()=>this.save(),dataReady:"onDataReady",thisObj:this})}detachFromProject(){this.detachListeners("project")}onDataReady(){const{record:e}=this;(null==e?void 0:e.project)&&this.scheduler.taskStore.includes(e)?this.load(e,!0):this.editor.close()}get isEditing(){return!!this._editing}onActivateEditor({eventRecord:e,resourceRecord:t,eventElement:r}){this.editEvent(e,t,r)}async editEvent(e,t=null,r=null){var n;const i=this,{scheduler:s}=i;if(e=e.isEventSegment?e.event:e,i.isEditing&&await i.cancel(),await Promise.all([i._cancelling,i._hiding]).catch((()=>{})),s.isGanttBase||t||(t=e.resource||(null==(n=e.resources)?void 0:n[0])),!i.disabled&&!e.readOnly&&!s.project.isDelayingCalculation&&(e.project||!s.usesDisplayStore)){const{taskStore:n}=s;if(i._editing=!0,i.captureStm(),i.startStmTransaction(),s.project.suspendAutoSync(),"function"==typeof e&&(e=e()),!(e=e.$original).isOccurrence&&!n.includes(e)&&!e.isCreating&&(e.isCreating=!0,n.add(e),t&&s.assignmentStore.assignEventToResource(e,t),await s.project.commitAsync(),i.isDestroyed))return;if(i.scrollIntoView&&!s.timeAxisSubGrid.collapsed&&!r&&n.includes(e)&&(t||s.isGantt)&&(await i.scrollEventIntoView(e,t),i.isDestroyed))return;const a=r||DomHelper.down(i.getElementFromTaskRecord(e,t),s.eventInnerSelector),o=i.getEditor(e);if(!1!==await i.triggerOnClient("beforeTaskEdit",{taskEdit:i,taskRecord:e,taskElement:a})){if(i.suspendHasChangesEvent&&s.project.suspendChangesTracking(),s.element.classList.add("b-taskeditor-editing"),await s.project.commitAsync(),i.isDestroyed)return;i.load(e),i.triggerOnClient("beforeTaskEditShow",{taskEdit:i,taskRecord:e,taskElement:a,editor:o});const{widgetMap:t}=o,r=e.parent&&!e.parent.isRoot;t.deleteButton&&(t.deleteButton.hidden=s.readOnly||e.isCreating||o.readOnly),s.features.nestedEvents&&(t.predecessorsTab&&(t.predecessorsTab.disabled=r),t.successorsTab&&(t.successorsTab.disabled=r),t.resourcesField&&(t.resourcesField.disabled=r)),i.attachToProject(),o.centered?await o.show():s.timeAxisSubGrid.collapsed||!a||s.isGanttBase&&!i.scrollIntoView&&!Rectangle.from(a).intersect(Rectangle.from(s.timeAxisSubGridElement))?await o.showBy({target:s.element,anchor:!1,align:"c-c",clippedBy:null}):await o.showBy({target:a,anchor:!0,offset:-5})}else{if(s.project.resumeAutoSync(),await i.rejectStmTransaction(),i.isDestroyed)return;i.disableStm(),i.freeStm(),i._editing=!1}}}getEditor(e=this.record){var t;const r=this,{client:n}=r;let{editor:i}=r;if(!i){const s=ObjectHelper.merge({clippedBy:[n.timeAxisSubGridElement,n.bodyContainer],eventEditFeature:r,weekStartDay:r.weekStartDay,enableEventSpanBuffer:r.enableEventSpanBuffer,saveAndCloseOnEnter:r.saveAndCloseOnEnter,blurAction:r.blurAction,owner:n,dependencyIdField:(null==(t=r.editorConfig)?void 0:t.dependencyIdField)||n.dependencyIdField,project:r.project,durationDisplayPrecision:n.durationDisplayPrecision,tabPanelItems:r.items,internalListeners:{beforeHide:{fn:"onBeforeHide",prio:-1e3},cancel:"onCancel",delete:"onDelete",save:"onSave",thisObj:r},tabsConfig:r.tabsConfig},r.editorConfig);if(r.editorClass&&!s.type)i=r.editor=r.editorClass.new(s);else{const t=((null==e?void 0:e.project)||r.project).getType();i=r.editor=Widget.create(Object.assign({type:r.editorClassMap[t]||"schedulertaskeditor"},s))}}return i.readOnly=(n.readOnly||(null==e?void 0:e.isOccurrence)||(null==e?void 0:e.isRecurring))&&!i.editingRecurring,i.project=r.project,i}load(e,t){const r=this,n=r.getEditor(e);r._loading=!0,e.isEventSegment&&(e=e.event),r.record=e,n.loadEvent(e,t),r._loading=!1}async save(){const e=this,{scheduler:t,record:r}=e;if(e.isEditing){const n=e.getEditor();if(!e.isValid||!1===await e.triggerOnClient("beforeTaskSave",{taskRecord:r,editor:n}))return;e.detachFromProject(),n.beforeSave(),r.isCreating=!1,n.resetRecurrenceData=n.editingRecurring=null,e.commitStmTransaction(),e.freeStm(),e._editing=!1,await n.close(),t.project.resumeAutoSync(!0),t.element.classList.remove("b-taskeditor-editing"),e.triggerOnClient("afterTaskSave",{taskRecord:r,editor:n}),n.afterSave(),e.suspendHasChangesEvent&&t.project.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{taskRecord:r,editor:n})}}async doCancel(){var e,t,r;const n=this,{scheduler:i,record:s}=n;if(n.isEditing){n._editing=!1,n.detachFromProject();const{project:a}=n,o=n.getEditor();if(o.editingRecurring=null,o.beforeCancel(),n.isDestroyed)return void(null==(e=a.resumeAutoSync)||e.call(a,!1));if((null==s?void 0:s.isCreating)?s.remove():await n.rejectStmTransaction(),n.isDestroyed)return void(null==(t=a.resumeAutoSync)||t.call(a,!1));if(n.disableStm(),await a.commitAsync(),n.isDestroyed)return void(null==(r=a.resumeAutoSync)||r.call(a,!1));n.freeStm(),o.afterCancel(),a.resumeAutoSync(!1),i.element.classList.remove("b-taskeditor-editing"),n.trigger("afterTaskEdit"),n.triggerOnClient("taskEditCanceled",{taskRecord:s,editor:o}),n.suspendHasChangesEvent&&a.resumeChangesTracking(),n.triggerOnClient("afterTaskEdit",{taskRecord:s,editor:o})}}async cancel(){const e=this,{editor:t}=e,{resetRecurrenceData:r}=t;return r&&(r.recurringTimeSpan.exceptionDates=r.originalExceptionDates,t.resetRecurrenceData=null),e._cancelling||(e._cancelling=e.doCancel().finally((()=>e._cancelling=void 0)))}async delete(){const e=this,{editor:t,scheduler:r,record:n,project:i}=e;(n.isCreating||!1!==await e.triggerOnClient("beforeTaskDelete",{taskRecord:n,editor:t}))&&(e.detachFromProject(),t.beforeDelete(),n.remove(),e.freeStm(),await i.commitAsync(),i.resumeAutoSync(!n.isCreating),e.isDestroyed||(e._editing=!1,t.close(),t.afterDelete(),r.element.classList.remove("b-taskeditor-editing"),e.suspendHasChangesEvent&&r.project.resumeChangesTracking(),e.triggerOnClient("afterTaskEdit",{editor:t,taskRecord:n})))}onSave(){this.requestAnimationFrame((()=>this.save()))}onCancel(){this.cancel().then()}async onDelete(){const e=this;if(e.confirmDelete){const{editor:t}=e,r=t.autoClose;t.autoClose=!1,e.deleteConfirmationPromise=MessageDialog_default.confirm({title:"L{TaskEdit.ConfirmDeletionTitle}",message:"L{TaskEdit.ConfirmDeletionMessage}",okButton:"L{TaskEditorBase.Delete}",rootElement:e.rootElement});const n=await e.deleteConfirmationPromise;t.autoClose=r,e.deleteConfirmationPromise=null,n===MessageDialog_default.yesButton&&e.delete()}else e.requestAnimationFrame((()=>e.delete()))}onBeforeHide({source:e,animate:t}){e.hideAnimation&&!1!==t&&(this._hiding=new Promise((t=>{e.ion({hideAnimationEnd:t})})).finally((()=>this._hiding=void 0)))}onDragCreateEnd({eventRecord:e,resourceRecord:t,proxyElement:r}){!this.disabled&&e.isCreating&&this.editEvent(e,t)}populateEventMenu({eventRecord:e,resourceRecord:t,items:r}){this.scheduler.readOnly||(r.editEvent={text:"L{Edit task}",localeClass:this,icon:"gt-icon gt-icon-edit",weight:-200,disabled:this.disabled||e.readOnly,onItem:()=>this.editEvent(e,t)})}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}async triggerOnClient(e,t){const r=e.replace(/task/,"event").replace(/Task/,"Event"),n=await this.scheduler.trigger(...arguments);t.eventRecord=t.taskRecord,t.eventRecords=[t.taskRecord];const i=await this.scheduler.trigger(r,t);return n&&i}onEventDropped({eventRecords:e}){var t;const r=(null==(t=this.editor)?void 0:t.loadedRecord)&&e.find((e=>e===this.editor.loadedRecord));r&&this.onEventResized({eventRecord:r})}onEventResized({eventRecord:e}){const{editor:t}=this;(null==t?void 0:t.isVisible)&&e===t.loadedRecord&&t.realign()}};TaskEdit._$name="TaskEdit",GridFeatureManager.registerFeature(TaskEdit,!0,"SchedulerPro"),GridFeatureManager.registerFeature(TaskEdit,!1,"ResourceHistogram");var TimeSpanHighlight=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"domConfigs",[]),__publicField(this,"configs",[])}static get $name(){return"TimeSpanHighlight"}static get configurable(){return{padding:0}}static get pluginConfig(){return{assign:["highlightTimeSpan","highlightTimeSpans","unhighlightTimeSpans"],chain:["onTimeAxisViewModelUpdate"]}}construct(){super.construct(...arguments),this.client.rowManager.ion({renderDone:this.onViewChanged,thisObj:this})}highlightTimeSpan(e,t=!0){const r=this,{startDate:n,endDate:i,taskRecord:s,name:a,surround:o,animationId:l,padding:c=r.padding,clearExisting:d=!0}=e,{client:u}=r;let h,{resourceRecord:g}=e;l&&DomHelper.addTemporaryClass(u.element,"b-transition-highlight",500,u),d&&(r.domConfigs.length=0,r.configs.length=0),r.disabled||(o?r.surroundTimeSpan(e):(r.configs.push(e),u.isGanttBase?h=u.getScheduleRegion(s,!0,{start:n,end:i}):(g&&(g=u.store.getById(g)),h=u.getScheduleRegion(g,null,!0,{start:n,end:i},!g)),h&&(c&&(u.isHorizontal?h.inflate(c,0,c,0):h.inflate(0,c,0,c)),r.domConfigs.push(h.visualize({children:[{class:"b-sch-highlighted-range-name",html:a}],dataset:{syncId:l},class:{"b-sch-highlighted-range":1,[e.cls]:e.cls,[e.class||"b-sch-highlighted-range-default"]:1}},!0)),t&&r.draw())))}draw(){DomSync.sync({targetElement:this.containerEl,domConfig:{onlyChildren:!0,children:this.domConfigs}})}surroundTimeSpan(e){this.highlightTimeSpans([Object.assign({},e,{animationId:(e.animationId||"")+"Before",class:"b-unavailable",surround:!1,startDate:this.client.startDate,endDate:e.startDate}),Object.assign({},e,{animationId:(e.animationId||"")+"After",class:"b-unavailable",surround:!1,startDate:e.endDate,endDate:this.client.endDate})],{clearExisting:e.clearExisting})}highlightTimeSpans(e,t={}){const r=this,{clearExisting:n=!0}=t;n&&(e=e.slice(),r.domConfigs.length=0,r.configs.length=0),r.disabled||(e.forEach((e=>{r.highlightTimeSpan({...e,clearExisting:!1},!1)})),r.draw())}async unhighlightTimeSpans(e=!1){const t=this,{client:r}=t;e&&DomHelper.addTemporaryClass(r.element,"b-transition-highlight",500,r),Array.from(t.containerEl.children).forEach((n=>{e?(n.style.opacity=0,t.fadeOutDetacher=EventHelper.onTransitionEnd({element:n,property:"opacity",thisObj:r,handler:()=>{t.domConfigs.length=0,t.draw()}})):(t.domConfigs.length=0,t.draw())}))}get containerEl(){return this._containerEl||(this._containerEl=DomHelper.createElement({parent:this.client.foregroundCanvas,retainElement:!0,class:"b-sch-highlight-container"})),this._containerEl}onTimeAxisViewModelUpdate(){this.onViewChanged()}onViewChanged(){this.configs.length>0&&this.highlightTimeSpans(this.configs)}updateDisabled(e,t){e&&this.unhighlightTimeSpans(),super.updateDisabled(e,t)}get featureClass(){}};TimeSpanHighlight._$name="TimeSpanHighlight",GridFeatureManager.registerFeature(TimeSpanHighlight,!1,["SchedulerPro","Gantt"]);var _ChangeLogEntity=class{constructor({model:e,type:t}){var r,n,i;Object.assign(this,{id:null!=(r=e.id)?r:e.$entityName,type:null!=(n=null==t?void 0:t.$$name)?n:e.constructor.name,name:null!=(i=e.name)?i:e.$entityName}),new.target===_ChangeLogEntity&&Object.freeze(this)}},ChangeLogEntity=_ChangeLogEntity;__publicField(ChangeLogEntity,"$name","ChangeLogEntity"),ChangeLogEntity._$name="ChangeLogEntity";var ChangeLogDependencyEntity=class extends ChangeLogEntity{constructor({model:e,fromTask:t,toTask:r}){super({model:e,type:DependencyModel2}),Object.assign(this,{fromTask:t,toTask:r}),Object.freeze(this)}};__publicField(ChangeLogDependencyEntity,"$name","ChangeLogDependencyEntity"),ChangeLogDependencyEntity._$name="ChangeLogDependencyEntity";var ChangeLogAssignmentEntity=class extends ChangeLogEntity{constructor({model:e,event:t,resource:r}){super({model:e,type:AssignmentModel2}),Object.assign(this,{event:t,resource:r}),Object.freeze(this)}};__publicField(ChangeLogAssignmentEntity,"$name","ChangeLogAssignmentEntity"),ChangeLogAssignmentEntity._$name="ChangeLogAssignmentEntity";var _ChangeLogAction=class{constructor({entity:e,actionType:t}){Object.assign(this,{entity:e,actionType:t}),this.constructor===_ChangeLogAction&&Object.freeze(this)}},ChangeLogAction=_ChangeLogAction;__publicField(ChangeLogAction,"$name","ChangeLogAction"),ChangeLogAction._$name="ChangeLogAction";var ChangeLogMoveAction=class extends ChangeLogAction{static get $name(){return"ChangeLogMoveAction"}constructor({entity:e,from:t,to:r}){super({entity:e,actionType:"move"}),Object.assign(this,{from:t,to:r}),Object.freeze(this)}};ChangeLogMoveAction._$name="ChangeLogMoveAction";var ChangeLogUpdateAction=class extends ChangeLogAction{static get $name(){return"ChangeLogUpdateAction"}constructor({entity:e,propertyUpdates:t,isInitialUserAction:r}){super({entity:e,actionType:"update"}),Object.assign(this,{propertyUpdates:t,isUser:r}),Object.freeze(this)}};ChangeLogUpdateAction._$name="ChangeLogUpdateAction";var Versions=class extends(InstancePlugin.mixin(AttachToProjectMixin_default)){constructor(){super(...arguments),__publicField(this,"_remoteActionRanges",[]),__publicField(this,"_comparingVersionId")}construct(e,t){super.construct(e,t);const r=this;r.versionStore=new VersionStore({modelClass:r.versionModelClass,internalListeners:{change:r.onStoreChangeExternal,thisObj:r},id:VersionStore.configurable.storeId}),r.changeStore=new ChangeLogStore({modelClass:r.transactionModelClass,internalListeners:{change:r.onStoreChangeExternal,thisObj:r},id:ChangeLogStore.configurable.storeId}),r._currentChanges=[],r.client.ion({beforeTaskDelete:r.onBeforeTaskDelete,beforeTaskSave:r.onBeforeTaskSave,gridRowBeforeDropFinalize:r.onGridRowBeforeDropFinalize,thisObj:r})}attachToProject(e){const t=this;super.attachToProject(e),e.addCrudStore([t.versionStore,t.changeStore]),e.ion({name:"project",load:t.onProjectLoad,once:!0,thisObj:t}),t.detachProjectListeners(),t.attachProjectListeners(e)}onBeforeTaskDelete(){this.transactionDescription=this.L("L{Versions.deletedTask}")}onBeforeTaskSave(){this.transactionDescription=this.L("L{Versions.editedTask}")}onGridRowBeforeDropFinalize({context:{valid:e,records:t}}){e&&(this.transactionDescription=1===t.length?this.L("L{Versions.movedTask}"):this.L("L{Versions.movedTasks}"))}attachProjectListeners(e){var t;const r=this;null==(t=null==e?void 0:e.stm)||t.ion({recordingStart:r.onStmRecordingStart,recordingStop:r.handleTransactionStop,restoringStop:r.onStmRestoringStop,thisObj:r,name:"stmListeners"}),null==e||e.ion({wsBeforeReceiveChanges:r.onBeforeApplyRemoteChanges,wsReceiveChanges:r.onAfterApplyRemoteChanges,thisObj:r,name:"stmListeners"})}detachProjectListeners(){this.detachListeners("stmListeners")}updateVersionModelClass(e){if(!e.isVersionModel)throw new Error("versionModelClass config must be a subclass of SchedulerPro.model.VersionModel.")}updateTransactionModelClass(e){if(!e.isChangeLogTransactionModel)throw new Error("transactionModelClass config must be a subclass of SchedulerPro.model.changelog.ChangeLogTransactionModel.")}onStoreChangeExternal(){this.triggerVersionChange()}tryAutoSave(){const e=this,{project:t}=e.client;e.changeStore.find((({versionId:e})=>!e))&&((null==t?void 0:t.wsSend)?(t.wsSend("requestVersionAutoSave",{project:t.wsProjectId}),e.detachListeners("autoSave"),t.ion({name:"autoSave",wsVersionAutoSaveOK:e.autoSave,thisObj:e,once:!0})):e.saveVersionWithConfig({isAutosave:!0}))}autoSave(){this.saveVersionWithConfig({isAutosave:!0})}autoSaveHourly(){0===(new Date).getMinutes()&&this.tryAutoSave()}updateAutoSaveInterval(e){const t=this,{client:r}=t;t._autoSaveInterval&&r.clearInterval(t._autosaveInterval),"hourly"===e?t._autoSaveInterval=r.setInterval(t.autoSaveHourly.bind(t),1e4):e&&(t._autoSaveInterval=r.setInterval(t.tryAutoSave.bind(t),60*e*1e3))}saveVersion(e=null){return this.saveVersionWithConfig({name:e})}saveVersionWithConfig(e){const t=this,r=t.captureVersionContent(),n=new t.versionModelClass({savedAt:new Date,content:r,...e});return n.onBeforeSave(),t.versionStore.add(n),t.changeStore.query((e=>null==e.versionId)).forEach((e=>e.versionId=n.id)),t.triggerVersionChange(),t.triggerTransactionChange(),n}async loadVersionContent(e){const t=this,{client:r}=t,{project:n}=r,i={version:e,content:null};if(await t.trigger("beforeLoadVersionContent",{context:i})){if(null==n?void 0:n.wsSend){n.wsSend("loadVersionContent",{project:n.wsProjectId,versionId:e.id});const r=await new Promise(((r,i)=>{const s=Date.now();n.ion({name:"loadVersionContent",loadVersionContent({project:t,versionId:i,content:s}){if(t===n.wsProjectId&&i===e.id)return n.detachListeners("loadVersionContent"),r(s)},thisObj:t,expires:{delay:t.versionContentLoadTimeout-(Date.now()-s),alt:()=>i("Failed to receive version content within "+this.versionContentLoadTimeout+" ms")}})}));return r&&t._versionContentCache.set(e.id,r),r}}else if(i.content)return i.content}async getVersionContent(e){var t;return null!=(t=e.content)?t:await this.loadVersionContent(e)}triggerTransactionChange(){this.client.trigger("transactionChange",{hasUnattachedTransactions:this.hasUnattachedTransactions})}triggerVersionChange(){this.client.trigger("versionChange",{versions:this.versionStore.records})}captureVersionContent(){return this.client.project.toJSON()}async restoreVersion(e){var t,r,n,i;const s=await this.getVersionContent(e),{project:a}=this.client,o=null==(t=a.stm)?void 0:t.enabled;null==(r=a.stm)||r.disable(),a.json=s,await a.commitAsync(),o&&(null==(n=a.stm)||n.enable()),null==(i=a.stm)||i.resetQueue()}async compareVersion(e){var t,r,n;const i=await this.getVersionContent(e),s={},{project:a}=this.client,o=null==(t=a.stm)?void 0:t.enabled;null==(r=a.stm)||r.disable();for(const e of i.eventsData)WalkHelper.preWalk(e,(e=>e.children),(({id:e,startDate:t,endDate:r})=>{s[e]={startDate:t,endDate:r}}));a.taskStore.traverse((e=>{s[e.id]&&(e.baselines.removeAll(),e.baselines.loadData([{task:e,...s[e.id]}]))})),o&&(null==(n=a.stm)||n.enable()),this._comparingVersionId=e.id}stopComparing(){var e,t,r;if(!this._comparingVersionId)return;const{project:n}=this.client,i=null==(e=n.stm)?void 0:e.enabled;null==(t=n.stm)||t.disable(),n.taskStore.traverse((e=>{e.baselines.removeAll()})),i&&(null==(r=n.stm)||r.enable()),this._comparingVersionId=null}doDisable(e){super.doDisable(e),e?this.detachProjectListeners():this.attachProjectListeners(this.client.project),this.client.refresh()}getEntityDescriptor(e){var t;const r=null!=(t=this.knownBaseTypes.find((t=>e instanceof t)))?t:e.constructor;return e.isDependencyModel?new ChangeLogDependencyEntity({model:e,fromTask:this.getEntityDescriptor(e.fromTask),toTask:this.getEntityDescriptor(e.toTask)}):e.isAssignmentModel?new ChangeLogAssignmentEntity({model:e,event:this.getEntityDescriptor(e.event),resource:this.getEntityDescriptor(e.resource)}):new ChangeLogEntity({model:e,type:r})}getUpdateAction(e){const t=e[0].model,r=e.flatMap((({newData:e,oldData:r})=>Object.entries(e).map((([e,t])=>({property:e,value:t,oldValue:r[e]}))).filter((({property:e,value:r,oldValue:n})=>{var i;return!ObjectHelper.isEqual(r,n)&&(null==(i=t.getFieldDefinition(e))?void 0:i.persist)})))),n=ArrayHelper.groupBy(r,"property"),i=Object.entries(n).map((([e,t])=>({property:e,before:t[0].oldValue,after:t[t.length-1].value}))),s=e.some((({isInitialUserAction:e})=>e));return new ChangeLogUpdateAction({actionType:"update",entity:this.getEntityDescriptor(t),propertyUpdates:i,isInitialUserAction:s})}onProjectLoad(){this._currentStmTransaction=null,this.stopTransaction()}onStmRecordingStart({transaction:e}){this._transactionStart=new Date,this._currentStmTransaction=e,this.triggerTransactionChange()}stopTransaction(){var e,t;(null==(e=this.client.project)?void 0:e.stm.isRecording)&&(null==(t=this.client.project)||t.stm.stopTransaction()),this.handleTransactionStop()}async onStmRestoringStop({cause:e,transactions:t}){const r=this;"undo"===e?r.transactionDescription=r.L("L{undid}"):"redo"===e&&(r.transactionDescription=r.L("L{redid}")),await r.client.project.commitAsync(),r._transactionStart=new Date,r.finalizeTransaction({queue:t.flatMap((e=>e.queue))})}onBeforeApplyRemoteChanges(){var e,t;null==this._remoteChangesStartPos&&(this._remoteChangesStartPos=null!=(t=null==(e=this._currentStmTransaction)?void 0:e.queue.length)?t:0)}async onAfterApplyRemoteChanges(){this.endCurrentRemoteActionRange(),await this.client.project.commitAsync()}endCurrentRemoteActionRange(){var e,t;const r=this;if(null!=r._remoteChangesStartPos){const n=null!=(t=null==(e=r._currentStmTransaction)?void 0:e.queue.length)?t:0;n!==r._remoteChangesStartPos&&r._remoteActionRanges.push({start:r._remoteChangesStartPos,end:n}),r._remoteChangesStartPos=null}}handleTransactionStop(){const e=this;e.hasChanges&&e.finalizeTransaction(e._currentStmTransaction),e._currentTransactionDescription=null,e._currentStmTransaction=null,e._remoteActionRanges=[],e.triggerTransactionChange()}excludeRanges(e,t){let r=[],n=0;for(const{start:i,end:s}of t)r=r.concat(e.slice(n,i)),n=s;return r.concat(e.slice(n))}finalizeTransaction(e){const t=this;t.endCurrentRemoteActionRange();const r=t.excludeRanges(e.queue,t._remoteActionRanges);if(0===r.length)return;const n=({model:e})=>e.$entityName,i=ArrayHelper.groupBy(r,"type"),s=[];for(const e of["UpdateAction","EventUpdateAction"]){const r=ArrayHelper.groupBy(i[e]||[],n);for(const e of Object.values(r))s.push(t.getUpdateAction(e))}for(const{modelList:e,isInitialUserAction:r}of i.RemoveAction||[])for(const n of e)s.push(new ChangeLogAction({actionType:"remove",entity:t.getEntityDescriptor(n),isInitialUserAction:r}));for(const{childModels:e}of i.RemoveChildAction||[])for(const r of e)s.push(new ChangeLogAction({actionType:"remove",entity:t.getEntityDescriptor(r)}));for(const{modelList:e}of i.AddAction||[])for(const r of e)s.push(new ChangeLogAction({actionType:"add",entity:t.getEntityDescriptor(r)}));for(const{childModels:e,parentModel:r,context:n,insertIndex:a}of i.InsertChildAction||[])for(const i of e){const e=n.get(i);null!=e?s.push(new ChangeLogMoveAction({actionType:"move",entity:t.getEntityDescriptor(i),from:{parent:t.getEntityDescriptor(e.parent),index:e.index},to:{parent:t.getEntityDescriptor(r),index:a}})):s.push(new ChangeLogAction({actionType:"add",entity:t.getEntityDescriptor(i)}))}const a=new t.transactionModelClass({description:t._currentTransactionDescription,actions:s,occurredAt:t._transactionStart});t.changeStore.add(a)}set transactionDescription(e){this._currentTransactionDescription=e}get hasChanges(){var e,t;return(null==(t=null==(e=this._currentStmTransaction)?void 0:e.queue)?void 0:t.length)>0}get hasUnattachedTransactions(){return this.changeStore.find((e=>null==e.versionId))}get isComparing(){return null!=this._comparingVersionId}};__publicField(Versions,"$name","Versions"),__publicField(Versions,"configurable",{versionModelClass:VersionModel,transactionModelClass:ChangeLogTransactionModel,autoSaveInterval:"hourly",knownBaseTypes:[AssignmentModel2,DependencyModel2,ResourceModel2],versionContentLoadTimeout:6e4}),Versions._$name="Versions",GridFeatureManager.registerFeature(Versions,!1,"SchedulerPro");var ChangeLogPropertyUpdate=class{constructor({property:e,before:t,after:r}){Object.assign(this,{property:e,before:t,after:r}),Object.freeze(this)}};__publicField(ChangeLogPropertyUpdate,"$name","ChangeLogPropertyUpdate"),ChangeLogPropertyUpdate._$name="ChangeLogPropertyUpdate";var willChange=(e,t,r)=>{const n=r.getFieldDefinition(e),{dataSource:i}=n,s=r.constructor.processField(e,t[i],r);return i in t&&!n.isEqual(s,r[e])},ProjectChangeHandlerMixin_default=e=>class extends(e||Base){startConfigure(e){this.getConfig("project"),super.startConfigure(e)}beforeApplyProjectChanges(){const{stm:e}=this;let t=!1;return this.suspendChangesTracking(),e.enabled&&(t=!0,e.isRecording&&e.stash(),this.ignoreRemoteChangesInSTM?e.disable():e.startTransaction()),t}async applyProjectChanges(e){var t,r;const n=this,i=n.beforeApplyProjectChanges();n.applyingChangeset=!0,e.project&&n.applyProjectResponse(e.project),n.applyChangeset(ObjectHelper.clone(e),((e,t)=>{if("tasks"===t.id||"events"===t.id){const{modelClass:r}=t,n=r.getFieldDataSource("startDate"),i=r.getFieldDataSource("endDate");if(e.updated)for(const s of e.updated){const e=t.getById(s[r.idField]);willChange("constraintType",s,e)||willChange("constraintDate",s,e)||(delete s[n],delete s[i])}}})),await n.commitAsync(),n.commitRespondedChanges();for(const i in e){const s=n.getStoreDescriptor(i);if(s){const{store:n}=s,a=e[i],o=[...null!=(t=a.updated)?t:[],...null!=(r=a.added)?r:[]];if(n)for(const e of o){const t=n.getById(e[n.modelClass.idField]);if(t)for(const r in t.modifications)willChange(r,e,t)||delete t.meta.modified[r]}}}n.afterApplyProjectChanges(i),n.applyingChangeset=!1,await n.commitAsync()}afterApplyProjectChanges(e){if(e){const{stm:e}=this;this.ignoreRemoteChangesInSTM?e.enable():e.stopTransaction(),e.applyStash()}this.resumeChangesTracking()}},ProjectModel2=class extends(ProjectChangeHandlerMixin_default(ProjectCrudManager_default2(ProjectModelMixin_default(SchedulerProProjectMixin)))){static get $name(){return"ProjectModel"}static get defaultConfig(){return{calendarModelClass:CalendarModel,dependencyModelClass:DependencyModel2,eventModelClass:EventModel2,assignmentModelClass:AssignmentModel2,resourceModelClass:ResourceModel2,calendarManagerStoreClass:CalendarManagerStore,dependencyStoreClass:DependencyStore2,eventStoreClass:EventStore2,assignmentStoreClass:AssignmentStore2,resourceStoreClass:ResourceStore2,calendarsData:null,supportShortSyncResponseNote:"",delayCalculation:!0,calendarManagerStore:{},stmClass:StateTrackingManager2}}static get configurable(){return{calendars:null}}get taskStore(){return this.eventStore}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}};ProjectModel2._$name="ProjectModel";var ProjectWebSocketHandlerMixin_default=e=>{var t;return __publicField(t=class extends(e||Base){doDestroy(){var e;null==(e=this.websocketManager)||e.destroy(),super.doDestroy()}updateWsAddress(e){var t;const r=this;null==(t=r.websocketManager)||t.destroy(),e&&(r.websocketManager=new WebSocketManager({address:e,userName:r.wsUserName,internalListeners:{message:"handleWebsocketMessage",close:"handleWebsocketClose",error:"handleWebsocketError",thisObj:r}}),r.wsAutoLoad&&r.wsLoad()),r.toggleAutoSyncListener()}toggleAutoSyncListener(){const e=this;e.detachListeners("websocketlisteners"),e._wsAutoSync&&e._wsAddress&&e.ion({name:"websocketlisteners",hasChanges:"scheduleWebsocketMessage"})}updateWsAutoSync(){this.toggleAutoSyncListener()}updateWsProjectId(e){null!=e&&this.wsAutoLoad&&this.wsLoad()}scheduleWebsocketMessage(){const e=this;e.hasTimeout("wsAutoSync")||e.isAutoSyncSuspended||e.setTimeout({name:"wsAutoSync",fn:()=>{e.wsSync()},delay:e.autoSyncTimeout})}resumeAutoSync(e=!0){super.resumeAutoSync(e),this.websocketManager&&!this.isAutoSyncSuspended&&this.changes&&this.wsSync()}async wsSend(e,t,r=!1){return!!await this.wsOpen()&&(this.websocketManager.send(e,t),r||this.trigger("wsSendMessage",{command:e,data:t}),!0)}wsReceive(e){}handleWebsocketClose(){this.trigger("wsClose")}handleWebsocketError({error:e}){this.trigger("wsError",{error:e})}async handleWebsocketMessage({data:e}){const t=this,{wsProjectId:r}=t,{project:n}=e;if(t.trigger("wsMessage",{data:e}),n===r&&"projectChange"===e.command)t.trigger("wsBeforeReceiveChanges"),await t.applyProjectChanges(e.changes),t.trigger("wsReceiveChanges");else if(n===r&&"dataset"===e.command)await t.loadInlineData(e.dataset),t.trigger("wsReceiveDataset");else if(n===r&&"versionAutoSaveOK"===e.command)t.trigger("wsVersionAutoSaveOK");else if(n===r&&"loadVersionContent"===e.command){const{versionId:r,project:n,content:i}=e;t.trigger("loadVersionContent",{versionId:r,project:n,content:i})}else t.wsReceive(e)}async wsOpen(){const{websocketManager:e}=this;if(e){return!e.isOpened&&await e.open()&&this.trigger("wsOpen"),e.isOpened}return!1}async wsLoad(){const e=this;null!=e.wsProjectId&&(await e.wsSend("dataset",{project:e.wsProjectId}),await new Promise((t=>{const r=e.ion({wsReceiveDataset(){r(),t(!0)},expires:{delay:e.wsConnectionTimeout,alt:()=>{r(),t(!1)}}})})),await e.commitAsync(),e.trigger("wsLoad"))}async wsSync(){const e=this,{wsProjectId:t}=e;if(null==t)return;await this.commitAsync();const{changes:r}=this;if(r&&e.wsAutoSync&&!e.autoSyncSuspendCounter){e.acceptChanges();await e.wsSend("projectChange",{project:t,changes:r})&&e.trigger("wsSendChanges")}}wsClose(){var e;null==(e=this.websocketManager)||e.close()}},"configurable",{wsAddress:null,wsUserName:"",wsAutoLoad:!0,wsAutoSync:!0,wsConnectionTimeout:6e4,wsProjectId:null}),t},ProjectProgressMixin_default=e=>{var t;return __publicField(t=class extends(e||Base){static get $name(){return"ProjectProgressMixin"}updateProject(e,t){super.updateProject(e,t),this.setupProgressListener(),this.detachListeners("delayedCalculation"),(null==e?void 0:e.delayCalculation)&&e.ion({name:"delayedCalculation",delayCalculationStart:"internalOnProjectDelayCalculationStart",delayCalculationEnd:"internalOnProjectDelayCalculationEnd",thisObj:this})}setupProgressListener(){var e;const t=this;t.detachListeners("projectProgress"),t.projectProgressReporting&&(null==(e=t.project)||e.ion({name:"projectProgress",progress:"onProjectProgress",thisObj:t}))}updateProjectProgressReporting(){this.isConfiguring||this.setupProgressListener()}onProjectProgress({total:e,remaining:t,phase:r="propagating"}){const n=this;if(!n.isPainted)return;if(e<n.projectProgressThreshold)return;let i=n.projectProgressReporting;if("auto"===i&&(i=n.project.delayCalculation?"progressbar":"mask"),"progressbar"===i){let r=n.calculationProgressElement;r||(r=n.calculationProgressElement=DomHelper.createElement({parent:n.timeAxisSubGrid.header.element,retainElement:!0,className:"b-calculation-progress-wrap",children:[{className:"b-calculation-progress"}]})),r.firstElementChild.style.width=(e-t)/e*100+"%",e>0&&0===t?n.calculationProgressTimeout=n.setTimeout((()=>{null==r||r.remove(),n.calculationProgressElement=null}),50):n.clearTimeout(n.calculationProgressTimeout)}else{const i=n.L("L{SchedulerProBase."+r+"}"),s=e?i+" "+Math.round(100*(e-t)/e)+"%":i;n.masked||n.mask({maxProgress:e,useTransition:!1,text:s}),n.masked.text=s,e&&(n.masked.maxProgress=e,n.masked.progress=e-t),e>0&&0===t&&n.unmask()}}internalOnProjectDelayCalculationStart(){this.readOnly||(this.$delayCalculationReadOnly=this.readOnly=!0)}internalOnProjectDelayCalculationEnd(){this.$delayCalculationReadOnly&&(this.$delayCalculationReadOnly=this.readOnly=!1)}get widgetClass(){}},"configurable",{projectProgressReporting:"auto",projectProgressThreshold:5e3}),t},SchedulerProEventRendering_default=e=>class extends(e||Base){static get $name(){return"SchedulerProEventRendering"}static get configurable(){return{eventLayout:"stack",horizontalLayoutPackClass:ProHorizontalLayoutPack,horizontalLayoutStackClass:ProHorizontalLayoutStack}}updateInternalEventLayout(e,t){const r=this;r.isConfiguring||r.clearLayouts(),super.updateInternalEventLayout(e,t)}getEventLayout(e){return"layoutFn"in(e=super.getEventLayout(e))&&(e.type="layoutFn"),e}clearLayouts(){const e=this;if(e.layouts)for(const t in e.layouts)e.layouts[t].destroy(),delete e.layouts[t]}getEventLayoutHandler(e){const t=this;if(!t.isHorizontal)return null;const{timeAxisViewModel:r,horizontal:n}=t;t.layouts||(t.layouts={});const{layouts:i}=t;switch(e.type){case"stack":return i.horizontalStack||(i.horizontalStack=t.horizontalLayoutStackClass.new({scheduler:t,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:n,groupByThisObj:t},e)),i.horizontalStack;case"pack":return i.horizontalPack||(i.horizontalPack=t.horizontalLayoutPackClass.new({scheduler:t,timeAxisViewModel:r,bandIndexToPxConvertFn:n.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:n,groupByThisObj:t},e)),i.horizontalPack;case"layoutFn":return{type:"layoutFn",scheduler:t,applyLayout:e.layoutFn,layoutEventsInBands:e.layoutFn};default:return null}}get widgetClass(){}},SchedulingIssueResolutionPopup=class extends Popup{static get $name(){return"SchedulingIssueResolutionPopup"}static get type(){return"schedulingissueresolutionpopup"}static get configurable(){return{localizableProperties:[],schedulingIssue:null,align:"b-t",autoShow:!1,autoClose:!1,closeAction:"onCloseButtonClick",modal:!0,centered:!0,scrollAction:"realign",constrainTo:globalThis,draggable:!1,closable:!0,floating:!0,cls:"b-schedulerpro-issueresolutionpopup",layout:"vbox",resolutionsGroup:{type:"radiogroup",name:"resolutions"},items:{description:{type:"widget",cls:"b-error-description",weight:-100}},bbar:{defaults:{localeClass:this},items:{applyButton:{weight:100,color:"b-raised b-blue",text:"L{Apply}",onClick:"up.onApplyButtonClick",disabled:!0},cancelButton:{weight:200,color:"b-gray",text:"L{Object.Cancel}",onClick:"up.onCancelButtonClick"}}}}}get selectedResolutions(){var e,t;const r=new Set,n=null==(t=null==(e=this.resolutionsGroup)?void 0:e.selected)?void 0:t.resolution;return n&&r.add(n),r}changeResolutionsGroup(e,t){return RadioGroup.reconfigure(t,e,this)}updateResolutionsGroup(e){e&&this.add(e)}getResolutionParameters(e){return[]}onApplyButtonClick(){const e=this,{selectedResolutions:t}=e;t.size?(t.forEach((t=>t.resolve(...e.getResolutionParameters(t)))),e.continueWithResolutionResult(EffectResolutionResult.Resume),e.doResolve(t)):e.onCancelButtonClick()}onCancelButtonClick(){this.continueWithResolutionResult(EffectResolutionResult.Cancel),this.doResolve()}onCloseButtonClick(){this.canCancel&&this.onCancelButtonClick()}get isResolving(){return Boolean(this.resolving)}async resolve({source:e,schedulingIssue:t,continueWithResolutionResult:r}){const n=this;return n.project=e,n.schedulingIssue=t,n.continueWithResolutionResult=r,n.updatePopupContent(t,r),n.onResolutionChange({}),n.show(),n.resolving=new Promissory,n.resolving.promise}doResolve(e){const t=this,{resolving:r}=t;r&&(t.resolving.resolve(e),t.resolving=null,t.schedulingIssue=null,t.hide())}getResolutionWidgetConfig(e){return{text:StringHelper.encodeHtml(e.getDescription()),cls:"b-resolution",checkedValue:e.$$name,localeClass:this,name:"resolutions",internalListeners:{change:"up.onResolutionChange"},resolution:e}}getResolutions(){var e;return null==(e=this.schedulingIssue)?void 0:e.getResolutions()}updatePopupContent(e,t){var r;const n=this,{resolutionsGroup:i}=n;t&&(n.continueWithResolutionResult=t),e?n.schedulingIssue=e:e=n.schedulingIssue,n.title=(null==e?void 0:e.type)?n.optionalL(e.type):"Unknown error",n.widgetMap.description.content=e&&StringHelper.encodeHtml(e.getDescription());const s=n.getResolutions(),a=(null==s?void 0:s.map((e=>n.getResolutionWidgetConfig(e))))||[],o=(null==(r=a[0])?void 0:r.name)||"resolutions";i.removeAll(),i.name=o,i.add(...a,{ref:"cancelResolution",text:"L{Cancel changes}",name:o,checkedValue:"cancel",localeClass:this,cls:"b-resolution",internalListeners:{change:"up.onResolutionChange"}}),n.toggleControlsState()}get canApply(){return null!=this.resolutionsGroup.value}get canCancel(){var e;return!(null==(e=this.project)?void 0:e.isInitialCommit)}get cancelResolution(){return this.resolutionsGroup.widgetMap.cancelResolution}onResolutionChange(){this.toggleControlsState()}toggleControlsState(){const e=this,{applyButton:t,cancelButton:r}=e.widgetMap;t.disabled=!e.canApply,e.cancelResolution.hidden=r.hidden=!e.canCancel}updateLocalization(){this.updatePopupContent(),super.updateLocalization()}};SchedulingIssueResolutionPopup.initClass(),SchedulingIssueResolutionPopup._$name="SchedulingIssueResolutionPopup";var CycleResolutionPopup=class extends SchedulingIssueResolutionPopup{static get $name(){return"CycleResolutionPopup"}static get type(){return"cycleresolutionpopup"}getDependencyTitle(e){return'"'+StringHelper.encodeHtml(e.fromEvent.name)+'" -> "'+StringHelper.encodeHtml(e.toEvent.name)+'"'}getResolutionWidgetConfig(e){const{dependency:t}=e,r=this.schedulingIssue.getInvalidDependencies(),n=super.getResolutionWidgetConfig(e);return r.includes(t)&&Object.assign(n,{name:"dependency-resolution",checked:!this._dependencyResolutionsChecked++}),n}getResolutions(){const{schedulingIssue:e}=this,t=null==e?void 0:e.getInvalidDependencies();let r=null==e?void 0:e.getResolutions();return r&&t.length&&(r=r.filter((e=>e.dependency&&t.includes(e.dependency)))),r}updatePopupContent(e,t){const r=this,{invalidDependenciesDescription:n,dependencyField:i}=r.widgetMap;if(r._dependencyResolutionsChecked=0,super.updatePopupContent(...arguments),null==n||n.hide(),null==i||i.hide(),e=r.schedulingIssue){const t=e.getDependencies(),s=e.getInvalidDependencies(),a=t.filter((e=>!s.includes(e)));if(s.length)n?n.show():r.add({type:"widget",ref:"invalidDependenciesDescription",weight:-50,width:"100%",cls:"b-invalid-dependencies-description",html:r.L("L{invalidDependencyLabel}")});else{const e=null==a?void 0:a.map((e=>({value:e.id,text:r.getDependencyTitle(e)})));i?(i.value=null,i.items=e,i.show()):r.add({type:"combo",ref:"dependencyField",weight:50,width:"100%",name:"dependency",label:r.L("L{dependencyLabel}"),labelPosition:"above",cls:"b-dependency-field",items:e,internalListeners:{change:"up.onDependencyChange"}})}}}get canApply(){const{widgetMap:e}=this;return super.canApply&&(e.cancelResolution.checked||!e.dependencyField||e.dependencyField.value)}onDependencyChange(){this.toggleControlsState()}getResolutionParameters(e){if(e.isRemoveDependencyCycleEffectResolution||e.isDeactivateDependencyCycleEffectResolution){const e=this.widgetMap.dependencyField.value;return[this.project.dependencyStore.getById(e)]}return super.getResolutionParameters(e)}};CycleResolutionPopup.initClass(),CycleResolutionPopup._$name="CycleResolutionPopup";var SchedulingIssueResolution_default=e=>class extends(e||Base){static get $name(){return"SchedulingIssueResolution"}static get configurable(){return{schedulingIssueResolutionPopupClass:SchedulingIssueResolutionPopup,cycleResolutionPopupClass:CycleResolutionPopup,displaySchedulingIssueResolutionPopup:!0}}updateProject(e,t){super.updateProject(e,t),this.unbindSchedulingIssueResolutionFromProject(t),this.displaySchedulingIssueResolutionPopup&&e&&this.bindSchedulingIssueResolutionToProject(e)}bindSchedulingIssueResolutionToProject(e){e.ion({name:"schedulingIssueResolution",schedulingConflict:"onProjectSchedulingIssueEvent",emptyCalendar:"onProjectSchedulingIssueEvent",cycle:"onProjectSchedulingIssueEvent",thisObj:this})}get isResolving(){var e;return null==(e=this._lastSchedulingIssueResolutionPopup)?void 0:e.isResolving}get activeSchedulingIssueResolutionPopup(){return this.isResolving&&this._lastSchedulingIssueResolutionPopup}unbindSchedulingIssueResolutionFromProject(e){this.detachListeners("schedulingIssueResolution")}getSchedulingIssueResolutionPopup(e){return"cycle"===e.type?this._cycleResolutionPopup||(this._cycleResolutionPopup=new this.cycleResolutionPopupClass({rootElement:this.rootElement})):this._schedulingIssueResolutionPopup||(this._schedulingIssueResolutionPopup=new this.schedulingIssueResolutionPopupClass({rootElement:this.rootElement}))}onProjectSchedulingIssueEvent({schedulingIssue:e}){const t=this.getSchedulingIssueResolutionPopup(e);this._lastSchedulingIssueResolutionPopup=t,t.resolve(...arguments)}get widgetClass(){}},ProHorizontalRendering=class extends HorizontalRendering{fillInnerSpanHorizontalPosition(e){const{eventRecord:t}=e,{startMS:r,endMS:n,durationMS:i}=this.calculateMS(t,"startDate","endDate"),s=this.calculateHorizontalPosition(e,r,n,i);if(s){const{left:t,width:a}=s;return Object.assign(e,{innerStartMS:r,innerEndMS:n,innerDurationMS:i,bufferBeforeWidth:Math.max(t-e.left,0),bufferAfterWidth:Math.max(Math.floor(e.left+e.width-t-a),0)}),!0}return!1}getTimeSpanRenderData(e,t,r=!1){const n=super.getTimeSpanRenderData(e,t,r);return(null==n?void 0:n.useEventBuffer)&&!this.fillInnerSpanHorizontalPosition(n)?null:n}};__publicField(ProHorizontalRendering,"$name","ProHorizontalRendering"),ProHorizontalRendering._$name="ProHorizontalRendering";var ProVerticalRendering=class extends VerticalRendering{fillInnerSpanVerticalPosition(e){const{scheduler:t}=this,{eventRecord:r}=e,{isBatchUpdating:n}=r,i=n?r.get("startDate"):r.startDate,s=n?r.get("endDate"):r.endDate,a=t.getCoordinateFromDate(i),o=i.getTime(),l=s.getTime(),c=l-o;let d=t.getCoordinateFromDate(s),u=d-a;return-1===d&&(u=Math.round(c*t.timeAxisViewModel.getSingleUnitInPixels("millisecond")),d=a+u),Object.assign(e,{innerStartMS:o,innerEndMS:l,innerDurationMS:c,bufferBeforeWidth:a-e.top,bufferAfterWidth:e.top+e.height-a-u}),!0}getTimeSpanRenderData(e,t,r=!1){const n=super.getTimeSpanRenderData(e,t,r);return(null==n?void 0:n.useEventBuffer)&&!this.fillInnerSpanVerticalPosition(n)?null:n}};__publicField(ProVerticalRendering,"$name","ProVerticalRendering"),ProVerticalRendering._$name="ProVerticalRendering";var SchedulerProBase=class extends(SchedulerBase.mixin(ProjectProgressMixin_default,SchedulingIssueResolution_default,SchedulerProEventRendering_default)){static get $name(){return"SchedulerProBase"}static get type(){return"schedulerprobase"}static get configurable(){return{projectModelClass:ProjectModel2,dependencyIdField:"id"}}static get isSchedulerPro(){return!0}onPaintOverride(){}set calendars(e){this.project.calendars=e}get calendars(){return this.project.calendars}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||(t.element.classList.add("b-sch-"+e),"horizontal"===e?(t.horizontal=new ProHorizontalRendering(t),t.isPainted&&t.horizontal.init()):"vertical"===e&&(t.vertical=new ProVerticalRendering(t),t.rendered&&t.vertical.init()))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&DomHelper.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get taskStore(){return this.project.eventStore}createEvent(e,t,r){if(t.isWorkingTime(e))return this.taskEdit&&this.taskEdit.isEditing?void this.ion({aftertaskedit:()=>super.createEvent(e,t,r),once:!0}):super.createEvent(e,t,r)}};SchedulerProBase.initClass(),VersionHelper.setVersion("schedulerpro","5.3.4"),SchedulerProBase._$name="SchedulerProBase";var emptyFn4=()=>{},ResourceHistogram=class extends SchedulerProBase{static get properties(){return{allocationReportByRecord:new Map,allocationDataByRecord:new Map,allocationObserverByRecord:new Map,resourceGroupsToUpdate:new Set,resourceGroupsAllocation:new Map}}construct(e){super.construct(e);const t=this;t.scheduleRefreshRows=t.createOnFrame(t.refreshRows,[],t,!0),t.horizontal.refreshResourcesWhenReady=t.horizontal.onAssignmentStoreChange=t.horizontal.renderer=function(){},t.rowManager.ion({beforeRowHeight:"onBeforeRowHeight",renderRow:"onRowManagerRenderRow",thisObj:t})}get timeAxis(){return super.timeAxis}set timeAxis(e){const t=this._timeAxis;super.timeAxis=e,this.partner&&!e||t&&t===e||this._timeAxis.ion({name:"timeAxis",endReconfigure:"onTimeAxisEndReconfigure",thisObj:this})}async onRowManagerRenderRow({record:e}){if(e.isSpecialRow){const t=this;if(t.project.isDelayingCalculation&&(await t.project.commitAsync(),t.isDestroyed))return;t.renderGroupHistogram(e),t.renderGroupScale(e)}}onDestroy(){var e,t,r,n,i;const s=this;for(const[t,r]of null==(e=s.allocationObserverByRecord)?void 0:e.entries())t.removeObserver&&(t.removeObserver(r),s.allocationObserverByRecord.delete(t));for(const[e,n]of null==(t=s.allocationReportByRecord)?void 0:t.entries())e.removeEntity&&(null==(r=e.removeEntity)||r.call(e,n),s.allocationReportByRecord.delete(n));s.allocationDataByRecord.clear(),null==(n=s._histogramWidget)||n.destroy(),null==(i=s._groupHistogramWidget)||i.destroy(),s.barTooltip=null}updateProject(e){this.detachListeners("resourceHistogramProject"),e.ion({name:"resourceHistogramProject",startApplyResponse:"onProjectStartApplyResponse",refresh:"internalOnProjectRefresh",delayCalculationStart:"onProjectDelayCalculationStart",delayCalculationEnd:"onProjectDelayCalculationEnd",repopulateReplica:"onRepopulateReplica",thisObj:this}),this.store=e.resourceStore}scheduleRefreshRows(){}getEventsToRender(){}getRowHeight(){return this.rowHeight}convertEffortUnit(e,t,r){return this.project.run("$convertDuration",e,t,r)}updateUseProjectTimeUnitsForScale(){const e=this;if(e.isPainted){const t={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",t),e._generatedScalePoints=e.scalePoints=t.scalePoints,e.scheduleRefreshRows()}}get eventStore(){var e;return null==(e=this.project)?void 0:e.eventStore}set eventStore(e){super.eventStore=e}get scaleColumn(){return this.columns.query((e=>e.isScaleColumn))[0]}get scalePoints(){return this._scalePoints}set scalePoints(e){const{histogramWidget:t,scaleColumn:r}=this,n=e[e.length-1],{value:i,unit:s}=n;this.scaleUnit=s,this._scalePoints=e;let a=i;if(r){const{scaleWidget:e}=r;a+=e.scaleMaxPadding*i}t.topValue=this.useProjectTimeUnitsForScale?this.convertEffortUnit(a,s,TimeUnit.Millisecond):DateHelper.asMilliseconds(a,s),r&&(r.scalePoints=e)}buildScalePointText(e){return""+e.value+DateHelper.getShortNameOfUnit(e.unit)}generateScalePoints(e,t){var r;if(!(null==(r=this.project)?void 0:r.graph))return;const{timeAxis:n}=this,i=[];let s;e=e||n.increment,t=t||n.unit,1===e&&(t=DateHelper.getSmallerUnit(t),e=Math.round(this.useProjectTimeUnitsForScale?this.convertEffortUnit(e,n.unit,t):DateHelper.as(t,e,n.unit)));for(const t of[7,5,4,3,2])if(!(e%t)){s=e/t;break}s||(s=e);for(let t=s;t<=e;t+=s)i.push({value:t});const a=i[i.length-1];return a.unit=t,a.text=this.buildScalePointText(a),i}updateViewPreset(e){const t=this;t._updatingViewPreset=!0,super.updateViewPreset(...arguments),t._updatingViewPreset=!1,t.project.isInitialCommitPerformed&&t.isPainted&&t.onTimeAxisEndReconfigure()}onPaint({firstPaint:e}){super.onPaint({firstPaint:e}),e&&this.showBarTip&&(this.barTooltip={})}updateGetBarTip(e){return e&&(this.barTooltipTemplate=null),e}changeBarTooltip(e,t){return null==t||t.destroy(),e?e.isTooltip?e:this.barTooltipClass.new({forElement:this.timeAxisSubGridElement,forSelector:".b-histogram rect",hoverDelay:0,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:this.getTipHtml.bind(this)},this.showBarTip,e):null}onRepopulateReplica(){this.ticksIdentifier=null,this.allocationReportByRecord.clear(),this.allocationDataByRecord.clear(),this.allocationObserverByRecord.clear()}getTipHtml(e){var t;const{activeTarget:r}=e,n=r.dataset.index,i=this.getRecordFromElement(r),s=this.allocationDataByRecord.get(i);return(e=Object.assign({},e)).index=parseInt(n,10),e.datum=s[e.index],null==(t=this.barTooltipTemplate)?void 0:t.call(this,e)}buildTicksIdentifier(){const e=this,t=e.project.getGraph();return e.ticksIdentifier||(e.ticksIdentifier=t.addIdentifier(CalculatedValueGen.new())),e.ticksIdentifier.writeToGraph(t,new BaseCalendarMixin({unspecifiedTimeIsWorking:!1,intervals:e.timeAxis.ticks.map((e=>({startDate:e.startDate,endDate:e.endDate,isWorking:!0})))})),e.collectTicksWidth(),e.ticksIdentifier}collectTicksWidth(){const{ticks:e}=this.timeAxis,t=e[0].endDate-e[0].startDate,r={0:t};let n=t,i=!0;for(let s=1,{length:a}=e;s<a;s++){const a=e[s],o=a.endDate-a.startDate;t!==o&&(i=!1),n+=o,r[s]=o}if(i)this.ticksWidth=null;else{const t={};for(let i=0,{length:s}=e;i<s;i++)t[i]=r[i]/n;this.ticksWidth=t}}resumeRefresh(e){super.resumeRefresh(!1);const t=this;!t.refreshSuspended&&e&&(t.rowManager.topRow?t.refreshWithTransition():(t.rowManager.reinitialize(),t.histogramWidget.data=[],t.histogramWidget.refresh()))}onProjectDelayCalculationStart(){this.suspendRefresh()}onProjectDelayCalculationEnd(){this.resumeRefresh(!0)}projectUnitsHasChanged(){const{project:e}=this;return e.daysPerMonth!==this._projectDaysPerMonth||e.daysPerWeek!==this._projectDaysPerWeek||e.hoursPerDay!==this._projectHoursPerDay}internalOnProjectRefresh({source:e,isInitialCommit:t,isCalculated:r}){if(r){const r=this;if(r.ticksIdentifier||r.onTimeAxisEndReconfigure(),r.useProjectTimeUnitsForScale&&r.projectUnitsHasChanged()){r._projectDaysPerMonth=e.daysPerMonth,r._projectDaysPerWeek=e.daysPerWeek,r._projectHoursPerDay=e.hoursPerDay;const t={scalePoints:r.generateScalePoints()};r.trigger("generateScalePoints",t),r._generatedScalePoints=r.scalePoints=t.scalePoints}r.resumeRefresh(t||!r.rowManager.topRow)}}get columns(){return super.columns}set columns(e){const t=this;super.columns=e,t.isDestroying||(t.timeAxisColumn.renderer=t.renderResourceHistogram,t.timeAxisColumn.cellCls=t.timeAxisColumnCellCls,e.some((e=>"scale"===e.type))||t.insertScaleColumn())}insertScaleColumn(){this.columns.rootNode.insertChild({type:"scale"},this.timeAxisColumn)}onProjectStartApplyResponse(){this.suspendRefresh()}buildHistogramWidget(e){var t;const r=this;r.getBarTextRenderData&&!e.getBarTextRenderData&&(e.getBarTextRenderData=r.getBarTextRenderData);const n=r.histogramWidgetClass.new({owner:r,appendTo:r.element,cls:"b-hide-offscreen b-resourcehistogram-histogram",height:r.rowHeight,width:(null==(t=r.timeAxisColumn)?void 0:t.width)||0,omitZeroHeightBars:!0,data:[],getBarTip:!r.barTooltipTemplate&&r.getBarTip||emptyFn4,getRectClass:r.getRectClass||r.getRectClassDefault,getBarText:r.getBarText||r.getBarTextDefault,series:r.series},r.histogramWidgetConfig,e);return r.getBarTextDefault.bind(n),n}get histogramWidget(){const e=this;if(!e._histogramWidget){const t=e.series;!e.showMaxEffort&&t.maxEffort&&(t.maxEffort=!1),e._histogramWidget=e.buildHistogramWidget()}return e._histogramWidget}getRectClassDefault(e,t,r){if("effort"===e.id)switch(!0){case r.isOverallocated:return"b-overallocated";case r.isUnderallocated:return"b-underallocated"}return""}get effortFormatter(){const e=this,t=e.effortFormat;let r=e._effortFormatter;return r&&e._effortFormat===t||(r=NumberFormat.get(e._lastFormat=t),e._effortFormatter=r),r}getEffortText(e,t,r=this.showEffortUnit){var n;if(!(null==(n=this.project)?void 0:n.graph))return;const{scaleUnit:i,effortFormatter:s}=this;t=t||i;const a=DateHelper.getShortNameOfUnit(t),o=this.convertEffortUnit(e,TimeUnit.Millisecond,t);return s.format(o)+(r?a:"")}getBarTipEffortUnit(){const{effortUnit:e,barTipEffortUnit:t,timeAxis:r}=this,n=t||e;return DateHelper.compareUnits(r.unit,n)<0?r.unit:n}getGroupBarTip({datum:e}){const t=this,{showBarTip:r,timeAxis:n}=t;let i="";if(r&&e.effort){const r=t.getBarTipEffortUnit(...arguments),s=t.getEffortText(e.effort,r),a=t.getEffortText(e.maxEffort,r),o=t.L("L{groupBarTipAssignment}");let l="L",c=t.L("L{groupBarTipInRange}"),d="";0===DateHelper.compareUnits(n.unit,TimeUnit.Day)?c=t.L("L{groupBarTipOnDate}"):DateHelper.compareUnits(n.unit,TimeUnit.Second)<=0?l="HH:mm:ss A":DateHelper.compareUnits(n.unit,TimeUnit.Hour)<=0&&(l="LT");let u=[...e.resourceAllocation.entries()].filter((([e,t])=>t.effort)).sort((([e,t],[r,n])=>t.effort>n.effort?-1:1));u.length>t.groupBarTipAssignmentLimit&&(d="<br>"+t.L("L{plusMore}").replace("{value}",u.length-t.groupBarTipAssignmentLimit),u=u.slice(0,this.groupBarTipAssignmentLimit));const h=u.map((([e,n])=>o.replace("{resource}",StringHelper.encodeHtml(e.name)).replace("{allocated}",t.getEffortText(n.effort,r)).replace("{available}",t.getEffortText(n.maxEffort,r)).replace("{cls}",n.isOverallocated?"b-overallocated":n.isUnderallocated?"b-underallocated":""))).join("<br>")+d;i=c.replace("{assignments}",h).replace("{startDate}",DateHelper.format(e.tick.startDate,l)).replace("{endDate}",DateHelper.format(e.tick.endDate,l)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),i='<div class="b-histogram-bar-tooltip">'+i+"</div>"}return i}getResourceBarTip({datum:e}){const t=this,{showBarTip:r,timeAxis:n}=t;let i="";if(r&&e.effort){const r=t.getBarTipEffortUnit(),s=t.getEffortText(e.effort,r),a=t.getEffortText(e.maxEffort,r);let o="L",l=t.L("L{barTipInRange}");0===DateHelper.compareUnits(n.unit,TimeUnit.Day)?l=t.L("L{barTipOnDate}"):DateHelper.compareUnits(n.unit,TimeUnit.Second)<=0?o="HH:mm:ss A":DateHelper.compareUnits(n.unit,TimeUnit.Hour)<=0&&(o="LT"),i=l.replace("{startDate}",DateHelper.format(e.tick.startDate,o)).replace("{endDate}",DateHelper.format(e.tick.endDate,o)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),e.resource&&(i=i.replace("{resource}",StringHelper.encodeHtml(e.resource.name))),i='<div class="b-histogram-bar-tooltip">'+i+"</div>"}return i}getBarTextEffortUnit(){const{effortUnit:e,barTextEffortUnit:t,timeAxis:r}=this,n=t||e;return DateHelper.compareUnits(r.unit,n)<0?r.unit:n}getBarTextDefault(e,t){const{showBarText:r}=this.owner;let n="";if(r&&e.effort){const t=this.owner.getBarTextEffortUnit();n=this.owner.getEffortText(e.effort,t)}return n}updateShowBarText(e){this.scheduleRefreshRows()}updateShowBarTip(e){this.barTooltip=e}updateShowMaxEffort(e){const t=this;t._showMaxEffort=e;let r=!1;[t._histogramWidget,t._groupHistogramWidget].forEach((t=>{if(!t)return;const{series:n}=t;e?"object"==typeof e?n.maxEffort=e:"object"==typeof t._seriesMaxEffort?n.maxEffort=t._seriesMaxEffort:(n.maxEffort={type:"outline",field:"maxEffort"},n.maxEffort.id="maxEffort"):n.maxEffort&&(t._seriesMaxEffort=n.maxEffort,delete n.maxEffort),r=!0})),r&&t.scheduleRefreshRows()}updateIncludeInactiveEvents(e){this.allocationReportByRecord.forEach((t=>t.includeInactiveEvents=e))}onTimeAxisEndReconfigureInternal(){const e=this;if(!e._updatingViewPreset){const{unit:t,increment:r}=e.timeAxis;if(t!==e._lastTimeAxisUnit||r!==e._lastTimeAxisIncrement){e._lastTimeAxisUnit=t,e._lastTimeAxisIncrement=r;const n={scalePoints:e.generateScalePoints()};e.trigger("generateScalePoints",n),e._generatedScalePoints=e.scalePoints=n.scalePoints}e.buildTicksIdentifier()}}onTimeAxisEndReconfigure(){const e=this;e._updatingViewPreset||(e.project.graph?e.onTimeAxisEndReconfigureInternal():e.project.ion({graphReady(){e.onTimeAxisEndReconfigureInternal()},thisObj:e,once:!0}))}onBeforeRowHeight({height:e}){if(this._timeAxisColumn)for(const t of[this._histogramWidget,this._groupHistogramWidget])t&&(t.height=e,t.onElementResize(t.element))}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(...arguments);for(const e of[this._histogramWidget,this._groupHistogramWidget])e&&(e.width=this.timeAxisViewModel.totalSize,e.onElementResize(e.element))}getRecordAllocationInfoRenderData(e,t,r,n=null){if(t=Array.isArray(t)?t:t.total,this.ticksWidth)for(let e=0,{length:r}=t;e<r;e++)t[e].width=this.ticksWidth[e];return t}renderRecordAllocationInfo(e,t,r,n=null){n=n||this.histogramWidget;const i=this.getRecordAllocationInfoRenderData(e,t,r,n);if(!i)return;this.allocationDataByRecord.set(e,i),n.data=i,n.refresh();const s=n.element.cloneNode(!0);s.removeAttribute("id"),s.classList.remove("b-hide-offscreen"),r.innerHTML="",r.appendChild(s)}renderRows(){const e=this;return!e.ticksIdentifier&&e.project.isInitialCommitPerformed&&(e.onTimeAxisEndReconfigure(),e.timeView.startDate&&e.timeView.endDate||(e.timeView.range={startDate:e.startDate,endDate:e.endDate})),super.renderRows(...arguments)}onRecordAllocationCalculated(e,t,r){const n=this;if(!n.isDestroying){const r=n.getCell({record:e,columnId:n.timeAxisColumn.id});r&&n.renderRecordAllocationInfo(e,t,r),n.trigger("allocationChange",{record:e,allocation:t});const i=n.getResourceGroupParent(e);i&&(n.resourceGroupsAllocation.delete(i),n.scheduleGroupRender(i))}}buildResourceAllocationReport(e){return this.project.resourceAllocationInfoClass.new({includeInactiveEvents:this.includeInactiveEvents,ticks:this.ticksIdentifier,resource:e})}registerRecordAllocationReport(e){const t=this,r=t.project.getGraph(),n=t.buildResourceAllocationReport(e);t.allocationReportByRecord.set(e,n),e.addEntity(n);const i=r.observe((function*(){return yield n.$.allocation}),(r=>t.onRecordAllocationCalculated(e,r,n)));return t.allocationObserverByRecord.set(e,i),e.addObserver(i),n}renderResourceHistogram({grid:e,cellElement:t,record:r}){const{project:n}=e;if(e.ticksIdentifier&&n.isInitialCommitPerformed&&!r.isSpecialRow){const{allocationReportByRecord:n,allocationObserverByRecord:i}=e;let s=n.get(r);if(s||(s=e.registerRecordAllocationReport(r)),null==s?void 0:s.allocation){s.graph?e.renderRecordAllocationInfo(r,s.allocation,t):(n.delete(r),e.allocationDataByRecord.delete(r),i.delete(r));const a=e.getResourceGroupParent(r);a&&e.store.includes(a)&&e.scheduleGroupRender(a)}}}renderScheduledGroups(){for(const e of Array.from(this.resourceGroupsToUpdate))this.renderGroupHistogram(e);this.clearTimeout(this.renderScheduledGroupTimer)}scheduleGroupRender(e){this.resourceGroupsToUpdate.add(e),this.renderScheduledGroupTimer=this.setTimeout({fn:"renderScheduledGroups",delay:10,cancelOutstanding:!0})}getResourceGroupParent(e){const t=e.instanceMeta(this.project.resourceStore.id);return null==t?void 0:t.groupParent}calculateResourceGroupAllocation(e){var t,r;const{allocationReportByRecord:n}=this,{groupChildren:i}=e,s=i.map((e=>n.get(e))),a=null==(r=null==(t=s[0])?void 0:t.allocation)?void 0:r.total,o=null==a?void 0:a.length;if(a&&s.every((e=>(null==e?void 0:e.allocation)&&e.allocation.total.length===o))){const e=[];return s.forEach((({allocation:t})=>{t.total.forEach(((t,r)=>{let n=e[r];n||(n=e[r]={tick:t.tick,effort:0,maxEffort:0,units:0,isGroup:!0,resourceAllocation:new Map}),n.resourceAllocation.set(t.resource,{effort:t.effort,maxEffort:t.maxEffort,units:t.units,isOverallocated:t.effort>t.maxEffort,isUnderallocated:t.effort<t.maxEffort}),n.isOverallocated=n.isOverallocated||t.isOverallocated,n.isUnderallocated=n.isUnderallocated||t.isUnderallocated,n.effort+=t.effort,n.maxEffort+=t.maxEffort,t.assignments&&(n.assignments?t.assignments.forEach((e=>n.assignments.add(e))):n.assignments=new Set(t.assignments))}))})),e}}renderGroupHistogram(e){var t;const r=this;r.resourceGroupsToUpdate.delete(e),r.store.includes(e)||r.resourceGroupsAllocation.delete(e);const n=r.resourceGroupsAllocation.get(e)||r.calculateResourceGroupAllocation(e);if(n){r.resourceGroupsAllocation.set(e,n);const{groupChildren:i}=e;let s=r.generateScalePoints(r.timeAxis.increment*i.length);const a={scalePoints:s,groupParent:e,isCalculatingTopValue:!0};r.trigger("generateScalePoints",a),s=a.scalePoints;const o=s[s.length-1],l=r.useProjectTimeUnitsForScale?r.convertEffortUnit(o.value,o.unit,TimeUnit.Millisecond):DateHelper.asMilliseconds(o.value,o.unit),c=l+((null==(t=r.scaleColumn)?void 0:t.scaleWidget.scaleMaxPadding)||0)*l,d=r._groupHistogramWidget||r.buildHistogramWidget({topValue:c}),u=r.getCell({id:e.id,columnId:r.timeAxisColumn.id});r._groupHistogramWidget?d.topValue=c:r._groupHistogramWidget=d,u&&(r.renderRecordAllocationInfo(e,n,u,d),r.trigger("groupRendered",{groupParent:e}))}else r.store.includes(e)&&r.scheduleGroupRender(e)}renderGroupScale(e){const t=this,{scaleColumn:r}=t;if(r){const{groupChildren:n}=e,i=t.generateScalePoints(t.timeAxis.increment*n.length),s=t.getCell({id:e.id,columnId:r.id}),a={scalePoints:i,groupParent:e};if(!s)return;let o=t._groupScaleWidget;return o||(o=t._groupScaleWidget=r.buildScaleWidget()),t.trigger("generateScalePoints",a),o.scalePoints=a.scalePoints,r.renderer({cellElement:s,scaleWidget:o})}}updateLocalization(){const e=this;e._generatedScalePoints===e.scalePoints&&e.scalePoints&&e.scalePoints.forEach((t=>{t.text&&t.unit&&(t.text=e.buildScalePointText(t))})),super.updateLocalization(...arguments)}};__publicField(ResourceHistogram,"$name","ResourceHistogram"),__publicField(ResourceHistogram,"type","resourcehistogram"),__publicField(ResourceHistogram,"configurable",{sortFeatureStore:"store",timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourcehistogram-cell",effortFormat:"0.#",showEffortUnit:!0,rowHeight:50,useProjectTimeUnitsForScale:!1,effortUnit:TimeUnit.Hour,barTextEffortUnit:null,barTipEffortUnit:null,showMaxEffort:!0,showBarText:!1,showBarTip:!1,barTooltip:null,barTooltipClass:Tooltip,series:{maxEffort:{type:"outline",field:"maxEffort"},effort:{type:"bar",field:"effort"}},getRectClass:null,createEventOnDblClick:!1,readOnly:!0,getBarTip:null,barTooltipTemplate({datum:e}){let t="";const{effort:r,isGroup:n}=e;return r&&(t=n?this.getGroupBarTip(...arguments):this.getResourceBarTip(...arguments)),t},getBarText:null,getBarTextRenderData:void 0,groupBarTipAssignmentLimit:5,histogramWidgetClass:Histogram,histogramWidgetConfig:null,includeInactiveEvents:!1,fixedRowHeight:!0}),ResourceHistogram.initClass(),ResourceHistogram._$name="ResourceHistogram";var ResourceUtilizationModel=class extends Model{construct(e,...t){this._childrenIndex=new Map,e.origin&&Object.assign(e,this.mapOriginValues(e.origin)),super.construct(e,...t),this.origin&&this.fillChildren()}mapOriginValues(e){var t,r;const n={};return e.isResourceModel?n.name=e.name:e.isAssignmentModel&&(n.name=null==(t=e.event)?void 0:t.name,n.iconCls=null==(r=e.event)?void 0:r.iconCls),n}fillChildren(){var e;const t=this,{children:r}=t,n=new Set(r),i=[];if(null==(e=t.origin)?void 0:e.isResourceModel){const{assigned:e}=t.origin;for(const r of e)t._childrenIndex.has(r)?n.delete(t._childrenIndex.get(r)):i.push(t.constructor.new({origin:r}))}n.size&&this.removeChild([...n]),i.length&&this.appendChild(i)}afterRemoveChild(e){e.forEach((e=>this._childrenIndex.delete(e.origin)))}insertChild(...e){var t;let r=super.insertChild(...e);if(r){const{stores:e}=this;if(Array.isArray(r)||(r=[r]),null==(t=this.origin)?void 0:t.isResourceModel)for(const e of r)e.origin&&!this._childrenIndex.has(e.origin)&&this._childrenIndex.set(e.origin,e);if(null==e?void 0:e.length)for(const t of e)for(const e of r)e.traverse((e=>t.setModelByOrigin(e.origin,e)))}return r}getChildByOrigin(e){return this._childrenIndex.get(e)}};__publicField(ResourceUtilizationModel,"$name","ResourceUtilizationModel"),__publicField(ResourceUtilizationModel,"fields",["name","iconCls"]),ResourceUtilizationModel.exposeProperties(),ResourceUtilizationModel._$name="ResourceUtilizationModel";var ResourceUtilizationStore=class extends(AbstractPartOfProjectStoreMixin.derive(AjaxStore)){static get properties(){return{_modelByOrigin:new Map}}updateProject(e){this.setResourceStore(null==e?void 0:e.resourceStore),this.setAssignmentStore(null==e?void 0:e.assignmentStore),this.setEventStore(null==e?void 0:e.eventStore),this.fillStoreFromProject()}setResourceStore(e){this.detachListeners("resourceStore"),null==e||e.ion({name:"resourceStore",change:this.onResourceStoreDataChanged,thisObj:this})}setEventStore(e){this.detachListeners("eventStore"),null==e||e.ion({name:"eventStore",update:this.onEventUpdate,thisObj:this})}setAssignmentStore(e){this.detachListeners("assignmentStore"),null==e||e.ion({name:"assignmentStore",change:this.onAssignmentsChange,refresh:this.onAssignmentsRefresh,add:this.onAssignmentsAdd,update:this.onAssignmentUpdate,remove:this.onAssignmentsRemove,thisObj:this})}onResourceStoreDataChanged(e){e.isMove&&"remove"===e.action||this.fillStoreFromProject()}onAssignmentsChange(){this.forEach((e=>e.fillChildren()))}onAssignmentsRefresh(e){"batch"===e.action&&this.forEach((e=>e.fillChildren()))}onAssignmentsAdd({records:e}){e.forEach((e=>{const t=this.getModelByOrigin(null==e?void 0:e.resource);null==t||t.fillChildren()}))}onAssignmentUpdate({record:e,changes:t}){if("resource"in t){const t=this.getModelByOrigin(e),r=this.getModelByOrigin(null==e?void 0:e.resource);t&&r&&r.appendChild(t)}}onAssignmentsRemove({records:e}){this.remove(e.map((e=>this.getModelByOrigin(e))))}onEventUpdate({record:e,changes:t}){if("name"in t)for(const t of e.assigned){this.getModelByOrigin(t).set("name",e.name)}}fillStoreFromProject(){var e;const t=[];null==(e=this._project)||e.resourceStore.forEach((e=>{e.isSpecialRow||t.push(this.modelClass.new({origin:e}))})),this.removeAll(),this.add(t),this.trigger("fillFromProject")}remove(){const e=super.remove(...arguments);return null==e||e.forEach((e=>{this._modelByOrigin.delete(e.origin)})),e}removeAll(){super.removeAll(...arguments),this._modelByOrigin.clear()}getModelByOrigin(e){return this._modelByOrigin.get(e)}setModelByOrigin(e,t){return this._modelByOrigin.set(e,t)}};__publicField(ResourceUtilizationStore,"configurable",{modelClass:ResourceUtilizationModel,project:null,tree:!0}),ResourceUtilizationStore._$name="ResourceUtilizationStore";var _ResourceUtilization=class extends ResourceHistogram{updateProject(e){super.updateProject(e),this.store=this.buildStore(e)}buildStore(e){return ResourceUtilizationStore.new({project:e})}insertScaleColumn(){}getTipHtml({activeTarget:e}){const t=e.dataset.index,r=this.getRecordFromElement(e),n=this.allocationDataByRecord.get(r.origin)[parseInt(t,10)];return this.barTooltipTemplate(n)}registerRecordAllocationReport(e){return e.isResourceModel?super.registerRecordAllocationReport(e):e.isAssignmentModel?this.registerAssignmentAllocationReport(e):void 0}onDestroy(){var e,t,r;const n=this;for(const[t,r]of null==(e=n.allocationObserverByRecord)?void 0:e.entries())t.isAssignmentModel&&(t.resource.removeObserver(r),n.allocationObserverByRecord.delete(t));for(const[e,r]of null==(t=n.allocationReportByRecord)?void 0:t.entries())e.isAssignmentModel&&(e.resource.removeEntity(r),n.allocationReportByRecord.delete(r));n.destroyStores&&(null==(r=n.store)||r.destroy()),super.onDestroy()}registerAssignmentAllocationReport(e){const t=this,r=t.project.getGraph(),n=t.allocationReportByRecord.get(e.resource);if(n){t.allocationReportByRecord.set(e,n);const i=r.observe((function*(){return yield n.$.allocation}),(r=>t.onRecordAllocationCalculated(e,r,n)));t.allocationObserverByRecord.set(e,i),e.resource.addObserver(i)}return n}onRecordAllocationCalculated(e,t,r){if(e.isAssignmentModel)if(t.byAssignments.get(e))super.onRecordAllocationCalculated(e,t,r);else{this.allocationReportByRecord.delete(e);const t=this.allocationObserverByRecord.get(e);t&&(r.resource.removeObserver(t),this.allocationObserverByRecord.delete(e))}else super.onRecordAllocationCalculated(e,t,r)}onRowManagerRenderRow({row:e,record:t}){var r,n;e.assignCls({"b-resource-row":null==(r=t.origin)?void 0:r.isResourceModel,"b-assignment-row":null==(n=t.origin)?void 0:n.isAssignmentModel})}getResourceGroupParent(e){const t=e.instanceMeta(this.store);return null==t?void 0:t.groupParent}renderResourceHistogram(e){const{project:t}=e.grid;if(t.isInitialCommitPerformed&&!e.record.isSpecialRow)return e.record=e.record.origin,super.renderResourceHistogram(e)}getCell(e){var t,r;return((null==(t=e.record)?void 0:t.isResourceModel)||(null==(r=e.record)?void 0:r.isAssignmentModel))&&(e.record=this.store.getModelByOrigin(e.record)),super.getCell(e)}buildHistogramWidget(e={},...t){return this.getBarTextRenderData||(null==e?void 0:e.getBarTextRenderData)||(e.getBarTextRenderData=this.getBarTextRenderDataDefault),e.cls="b-hide-offscreen b-resourceutilization-histogram",e.height=this.rowHeight,super.buildHistogramWidget(e,...t)}getBarTextRenderDataDefault(e,t,r){return e.y="50%",e}getRecordAllocationInfoRenderData(e,t,r,n=null){let i;if(e.isResourceModel?i=t.total:e.isAssignmentModel&&(i=t.byAssignments.get(e)),i)for(let e=0,{length:t}=i;e<t;e++)i[e].effort&&(i[e].height=1);return i}getResourceBarTip(e){const t=this,{showBarTip:r,timeAxis:n}=t;let i="";if(r&&e.effort){const r=t.getBarTipEffortUnit(...arguments),s=t.getEffortText(e.effort,r,!0),a=t.getEffortText(e.maxEffort,r,!0),o=t.L("L{groupBarTipAssignment}");let l="L",c=t.L("L{groupBarTipInRange}"),d="";0===DateHelper.compareUnits(n.unit,TimeUnit.Day)?c=t.L("L{groupBarTipOnDate}"):DateHelper.compareUnits(n.unit,TimeUnit.Second)<=0?l="HH:mm:ss A":DateHelper.compareUnits(n.unit,TimeUnit.Hour)<=0&&(l="LT");let u=[...e.assignmentIntervals.entries()].filter((([e,t])=>t.effort)).sort((([e,t],[r,n])=>t.effort>n.effort?-1:1));u.length>t.groupBarTipAssignmentLimit&&(d="<br>"+t.L("L{plusMore}").replace("{value}",u.length-t.groupBarTipAssignmentLimit),u=u.slice(0,this.groupBarTipAssignmentLimit));const h=u.map((([e,n])=>o.replace("{event}",StringHelper.encodeHtml(e.event.name)).replace("{allocated}",t.getEffortText(n.effort,r,!0)).replace("{available}",t.getEffortText(n.maxEffort,r,!0)).replace("{cls}",n.isOverallocated?"b-overallocated":n.isUnderallocated?"b-underallocated":""))).join("<br>")+d;i=c.replace("{assignments}",h).replace("{startDate}",DateHelper.format(e.tick.startDate,l)).replace("{endDate}",DateHelper.format(e.tick.endDate,l)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.isOverallocated?"b-overallocated":e.isUnderallocated?"b-underallocated":""),i='<div class="b-histogram-bar-tooltip">'+i+"</div>"}return i}getAssignmentBarTip(e){const t=this,{showBarTip:r,timeAxis:n}=t;let i="";if(r&&e.effort){const r=t.getBarTipEffortUnit(...arguments),s=t.getEffortText(e.effort,r,!0),a=t.getEffortText(e.maxEffort,r,!0);let o="L",l=t.L("L{barTipInRange}");0===DateHelper.compareUnits(n.unit,TimeUnit.Day)?l=t.L("L{barTipOnDate}"):DateHelper.compareUnits(n.unit,TimeUnit.Second)<=0?o="HH:mm:ss A":DateHelper.compareUnits(n.unit,TimeUnit.Hour)<=0&&(o="LT"),i=l.replace("{startDate}",DateHelper.format(e.tick.startDate,o)).replace("{endDate}",DateHelper.format(e.tick.endDate,o)).replace("{allocated}",s).replace("{available}",a).replace("{cls}",e.cls||""),e.assignment&&(i=i.replace("{event}",StringHelper.encodeHtml(e.assignment.event.name))),i='<div class="b-histogram-bar-tooltip">'+i+"</div>"}return i}},ResourceUtilization=_ResourceUtilization;__publicField(ResourceUtilization,"$name","ResourceUtilization"),__publicField(ResourceUtilization,"type","resourceutilization"),__publicField(ResourceUtilization,"configurable",{timeAxisColumnCellCls:"b-sch-timeaxis-cell b-resourceutilization-cell",rowHeight:30,showEffortUnit:!1,showMaxEffort:!1,showBarText:!0,barTooltipTemplate({effort:e,isGroup:t,resource:r,assignment:n}){let i="";return e&&(r?i=this.getResourceBarTip(...arguments):n?i=this.getAssignmentBarTip(...arguments):t&&(i=this.getGroupBarTip(...arguments))),i},series:{effort:{type:"bar",field:"effort"}},readOnly:!0,columns:[{type:"tree",field:"name",text:"L{nameColumnText}",localeClass:_ResourceUtilization}]}),ResourceUtilization.initClass(),ResourceUtilization._$name="ResourceUtilization",GridFeatureManager.registerFeature(Tree,!0,"ResourceUtilization");var SchedulerPro=class extends SchedulerProBase{static get $name(){return"SchedulerPro"}static get type(){return"schedulerpro"}};SchedulerPro.initClass(),SchedulerPro._$name="SchedulerPro";var Timeline=class extends SchedulerBase{static get $name(){return"Timeline"}static get type(){return"timeline"}static get configurable(){return{height:"13em",eventLayout:"pack",barMargin:1,forceFit:!0,timeAxis:{autoAdjust:!1},readOnly:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,rowHeight:48,displayDateFormat:"L",resources:[{id:1}],columns:[]}}static get delayable(){return{fillFromTaskStore:100}}construct(e={}){const t=this;t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate";let r=!0;if("project"in e){if(!e.project)throw new Error("You need to configure the Timeline with a Project");e.project instanceof SchedulerProProjectMixin&&(t.taskStore=e.project.eventStore,e.project.isInitialCommitPerformed||(r=!1,e.project.ion({name:"initialCommit",refresh({isInitialCommit:e}){e&&(t.fillFromTaskStore(),t.detachListeners("initialCommit"))},thisObj:t})),delete e.project)}e.features=ObjectHelper.assign({cellEdit:!1,cellMenu:!1,columnAutoWidth:!1,columnLines:!1,columnPicker:!1,columnReorder:!1,columnResize:!1,contextMenu:!1,eventContextMenu:!1,eventDrag:!1,eventDragCreate:!1,eventEdit:!1,eventFilter:!1,eventMenu:!1,eventResize:!1,eventTooltip:!1,group:!1,headerMenu:!1,regionResize:!1,scheduleContextMenu:!1,scheduleMenu:!1,scheduleTooltip:!1,sort:!1,timeAxisHeaderMenu:!1,timeRanges:!1},e.features),super.construct(e),t.features.timeRanges&&(t.features.timeRanges.store=new Store),r&&t.fillFromTaskStore.now(),t.taskStore.ion({refreshPreCommit:t.fillFromTaskStore,changePreCommit:t.onTaskStoreChange,thisObj:t}),t.ion({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel)}onSizeChanged({width:e,oldWidth:t}){const r=this,n=e!==t;n&&r.suspendRefresh(),r.updateRowHeight(),n&&(r.resumeRefresh(),r.fitTimeline())}updateRowHeight(){this.bodyContainer.isConnected&&(this.rowHeight=this.bodyContainer.offsetHeight)}fitTimeline(){this.eventStore.count>0&&(this.forceFit=!1,this.zoomToFit({leftMargin:50,rightMargin:50}),this.forceFit=!0),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange({action:e,record:t,records:r,changes:n,isCollapse:i}){const s=this,a=s.eventStore;let o;switch(e){case"add":r.forEach((e=>{e.showInTimeline&&(a.add(s.cloneTask(e)),o=!0)}));break;case"remove":i||r.forEach((e=>{e.showInTimeline&&(a.remove(e.id),o=!0)}));break;case"removeall":s.fillFromTaskStore.now();break;case"update":{const e=t;if(n.showInTimeline){if(e.showInTimeline)a.add(s.cloneTask(e));else{const t=a.getById(e.id);t&&a.remove(t)}o=!0}else if(e.showInTimeline){const t=a.getById(e.id);t&&(t.set(s.cloneTask(e)),o=!0)}break}}o&&s.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,name:e.name,startDate:e.startDate,endDate:e.endDate,cls:e.cls}}render(){super.render(...arguments),this.updateRowHeight()}async fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse((r=>{r.showInTimeline&&r.isScheduled&&t.push(e.cloneTask(r))})),e.events=t,await e.project.commitAsync(),e.isDestroyed||e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels(),super.onLocaleChange()}};Timeline.initClass(),Timeline._$name="Timeline";var EMPTY_ARRAY=[],actionTypeOrder={remove:1,add:2,update:3},entityTypeOrder={TaskModel:1,DependencyModel:2,AssignmentModel:3,ProjectModel:4},describePosition=({parent:e,index:t})=>e.name+"["+t+"]",knownEntityTypes={AssignmentModel:"Assignment",DependencyModel:"Dependency"},VersionGridRow=class extends GridRowModel{};__publicField(VersionGridRow,"fields",[{name:"description",type:"string"},{name:"occurredAt",type:"date"},{name:"versionModel"},{name:"transactionModel"},{name:"propertyUpdate"},{name:"action"}]);var _VersionGrid=class extends TreeGrid{constructor(){super(...arguments),__publicField(this,"_transactionChanges",[]),__publicField(this,"_versionChanges",[]),__publicField(this,"comparingRowCls","b-"+_VersionGrid.type+"-comparing")}static get properties(){return{_rowsByUnderlyingRecord:new WeakMap,_expandedById:new Map}}construct(e){super.construct({...e,features:ObjectHelper.merge({},_VersionGrid.configurable.features,e.features)})}afterConstruct(){if(!this.project)throw new Error(_VersionGrid.$name+" requires the project config.");this.refreshGrid()}updateDateFormat(e){const t=this.columns.get("occurredAt");t&&(t.format=e)}updateProject(e){const t=this;t.detachListeners("storeChange"),t._versionStore=e.getCrudStore("versions"),t._transactionStore=e.getCrudStore("changelogs"),t._versionStore.ion({name:"storeChange",change:t.onVersionStoreChange,thisObj:t}),t._transactionStore.ion({name:"storeChange",change:t.onTransactionStoreChange,thisObj:t})}updateShowNamedVersionsOnly(){this.isPainted&&this.refreshGrid()}updateShowUnattachedTransactions(){this.isPainted&&this.refreshGrid()}updateShowVersions(){this.isPainted&&this.refreshGrid()}updateComparingVersionId(e,t){const[r,n]=[t,e].map((e=>this.store.getById("v-"+e)));r&&(r.cls="",r.iconCls="gt-icon gt-icon-version"),n&&(n.cls=this.comparingRowCls,n.iconCls="gt-icon gt-icon-compare")}onVersionStoreChange({action:e,records:t}){this._versionChanges.push({action:e,records:t}),this.processUpdates()}onTransactionStoreChange({action:e,records:t}){this._transactionChanges.push({action:e,records:t}),this.processUpdates()}processUpdates(){const e=this,t=ArrayHelper.unique(e._versionChanges.flatMap((({records:e})=>e))),r=new Set(t.map((e=>String(e.id)))),n=ArrayHelper.unique(e._transactionChanges.flatMap((({records:e})=>e)).concat(0===t.length?[]:e._transactionStore.query((e=>r.has(e.versionId)))));for(const i of n)i.versionId&&!r.has(i.versionId)&&(t.push(e._versionStore.getById(i.versionId)),r.add(i.versionId));e.replaceRows(ArrayHelper.unique(t),n),e._transactionChanges=[],e._versionChanges=[]}replaceRows(e,t){var r;const n=this,{showNamedVersionsOnly:i,showUnattachedTransactions:s,store:a}=n,o=new Set,l=ArrayHelper.groupBy(t,"versionId"),c=t.concat(e),d=i?e.filter((e=>null!=e.name)):e;for(const e of c)for(const t of null!=(r=n._rowsByUnderlyingRecord.get(e))?r:EMPTY_ARRAY)o.add(t);n.suspendRefresh(),a.remove(Array.from(o));for(const e of d){const t=a.add(n.getGridRows(e,l[e.id]));n._rowsByUnderlyingRecord.set(e,t)}if(s)for(const e of t.filter((e=>null==e.versionId))){const t=a.add(n.getGridRows(null,[e]));n._rowsByUnderlyingRecord.set(e,t)}n.resumeRefresh(),a.sort(a.sorters)}refreshGrid(){this.replaceRows(this._versionStore.records,this._transactionStore.records)}getGridRows(e,t){const r=this,{showVersions:n,comparingVersionId:i}=r,s=(null==t?void 0:t.map((t=>{var n;const i="t-"+t.id;return{id:i,expanded:Boolean(null==(n=r._expandedById)?void 0:n.get(i)),description:t.description,occurredAt:t.occurredAt,transactionModel:t,rootVersionModel:e,children:t.actions.map(((n,i)=>{var s,a,o;const l="a-"+t.id+"-"+i;return{id:l,expanded:Boolean(null==(s=r._expandedById)?void 0:s.get(l)),action:n,rootVersionModel:e,children:null!=(o=null==(a=n.propertyUpdates)?void 0:a.map((t=>({rootVersionModel:e,propertyUpdate:t}))))?o:[]}}))}})))||[],a="v-"+(null==e?void 0:e.id);return e&&n?{id:a,expanded:Boolean(r._expandedById.get(a)),description:e.description,occurredAt:e.savedAt,children:s,versionModel:e,iconCls:"gt-icon-version",cls:e.id===i?r.comparingRowCls:null}:s}renderDescription(e){const{record:t}=e;return t.propertyUpdate?this.renderPropertyUpdate(t.propertyUpdate):t.action?this.renderActionDescription(t.action):t.description}renderPropertyUpdate(e){const t=_VersionGrid.type,{property:r,before:n,after:i}=e;return{children:[{tag:"div",class:"b-"+t+"-property-update-desc",children:[{tag:"span",class:"b-"+t+"-property-name",html:""+this.formatPropertyName(r)},this.renderPropertyValue(n,"before"),{tag:"i",class:"gt-icon gt-icon-right"},this.renderPropertyValue(i,"after")]}]}}renderPropertyValue(e,t){var r;return{tag:"span",class:["b-"+_VersionGrid.type+"-property-"+t,null==e&&"b-"+_VersionGrid.type+"-empty-value"],html:null==e?this.L("L{Versions.nullValue}"):null!=(r=this.formatValueString(e))?r:""}}formatValueString(e){return DateHelper.isDate(e)?DateHelper.format(e,this.dateFormat):"number"==typeof e?e.toFixed(2):e}formatPropertyName(e){return StringHelper.separate(e)}getAssignmentTextTokens(e){return{event:e.event.name,resource:e.resource.name}}getDependencyTextTokens(e){return{from:e.fromTask.name,to:e.toTask.name}}renderActionDescription(e){var t;const r=this,{actionType:n,entity:i}=e;let s,a={type:r.L("L{Versions.entityNames}")[i.type],name:i.name};return"move"===n&&(a.from=describePosition(e.from),a.to=describePosition(e.to)),s=r.L("L{Versions."+n+(null!=(t=knownEntityTypes[i.type])?t:"Entity")+"}"),"DependencyModel"===i.type?a=r.getDependencyTextTokens(i):"AssignmentModel"===i.type&&(a=r.getAssignmentTextTokens(i)),s=s.replace(/\{(\w+)\}/g,((e,t)=>{var r;return null!=(r=a[t])?r:t})),e.isUser&&(s="[!] "+s),r.renderHighlightedTextElements(StringHelper.capitalize(s),a)}static sortActionRows(e,t){if(e.parent===t.parent&&e.action&&t.action){const r=Boolean(e.action.isUser),n=Boolean(t.action.isUser),{actionType:i,entity:{type:s}}=e.action,{actionType:a,entity:{type:o}}=t.action;return r!==n?r?-1:1:Math.sign(actionTypeOrder[i]-actionTypeOrder[a])||Math.sign(entityTypeOrder[s]-entityTypeOrder[o])||0}return 0}triggerRestore(e){this.trigger("restore",{version:e})}triggerCompare(e){this.trigger("compare",{version:e})}triggerStopCompare(e){this.trigger("stopCompare")}renderHighlightedTextElements(e){const t=this.constructor.type;return{children:[{tag:"span",class:"b-"+t+"-highlighted-text",children:e.split(/\*\*/g).reduce(((e,r)=>(e.children.push({tag:"span",text:r,class:e.isEntity?"b-"+t+"-highlighted-entity":null}),e.isEntity=!e.isEntity,e)),{children:[],isEntity:!1}).children}]}}},VersionGrid=_VersionGrid;__publicField(VersionGrid,"$name","VersionGrid"),__publicField(VersionGrid,"type","versiongrid"),__publicField(VersionGrid,"configurable",{store:{tree:!0,modelClass:VersionGridRow,sorters:[{field:"occurredAt",ascending:!1},_VersionGrid.sortActionRows],reapplySortersOnAdd:!0},project:null,showUnattachedTransactions:!0,showNamedVersionsOnly:!1,showVersions:!0,comparingVersionId:null,flex:0,features:{group:{field:"id"},cellEdit:{continueEditingOnCellClick:!1,editNextOnEnterPress:!1},cellMenu:{items:{removeRow:!1,cut:!1,copy:!1,paste:!1,renameButton:{text:"L{VersionGrid.rename}",icon:"gt-icon gt-icon-edit",onItem:({record:e,source:t})=>{t.startEditing({id:e.id,column:t.columns.get("description")})}},restoreButton:{text:"L{VersionGrid.restore}",icon:"gt-icon gt-icon-undo",onItem:({record:e,source:t})=>{t.triggerRestore(e.versionModel)}},compareButton:{text:"L{VersionGrid.compare}",icon:"gt-icon gt-icon-compare",onItem:({record:e,source:t})=>{t.triggerCompare(e.versionModel)}},stopComparingButton:{text:"L{VersionGrid.stopComparing}",onItem:({record:e,source:t})=>{t.triggerStopCompare()}}}},rowCopyPaste:!1},columns:[{type:"tree",text:"L{VersionGrid.description}",field:"description",flex:4,groupable:!1,renderer:({grid:e,...t})=>e.renderDescription({grid:e,...t}),autoHeight:!0},{text:"L{VersionGrid.occurredAt}",field:"occurredAt",type:"date",flex:1,groupable:!1}],dateFormat:"M/D/YY h:mm a",internalListeners:{beforeCellEditStart({editorContext:{column:e,record:t}}){if("description"!==e.field||!t.versionModel)return!1},finishCellEdit({editorContext:{record:e,value:t}}){e.versionModel.name=null!=t&&t.trim()?t:null},cellMenuBeforeShow:({source:e,record:t,items:r})=>(r.stopComparingButton.disabled=!e.comparingVersionId,Boolean(t.versionModel)),toggleNode({record:e,collapse:t}){this._expandedById.set(e.id,!t)}}}),__publicField(VersionGrid,"delayable",{processUpdates:{type:"raf",cancelOutstanding:!0}}),VersionGrid.initClass(),VersionGrid._$name="VersionGrid";var __decorate34=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ConstrainedByParentMixin=class extends(Mixin([BaseEventMixin,HasChildrenMixin,ConstrainedEarlyEventMixin],(e=>{const t=e.prototype;return class extends e{*maybeSkipNonWorkingTime(e,r=!0){return(yield this.$.childEvents).size>0?e:yield*t.maybeSkipNonWorkingTime.call(this,e,r)}*calculateStartDateConstraintIntervals(){const e=yield*t.calculateStartDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(null==r?void 0:r.graph){const t=yield r.$.startDateConstraintIntervals;e.push.apply(e,t)}return e}*calculateEndDateConstraintIntervals(){const e=yield*t.calculateEndDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(null==r?void 0:r.graph){const t=yield r.$.endDateConstraintIntervals;e.push.apply(e,t)}return e}*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(null==r?void 0:r.graph){const t=yield r.$.earlyStartDateConstraintIntervals;e.push.apply(e,t),(yield r.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Forward&&e.push(ManuallyScheduledParentConstraintInterval.new({side:ConstraintIntervalSide.Start,startDate:yield r.$.startDate}))}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*t.calculateEarlyEndDateConstraintIntervals.call(this),r=yield this.$.parentEvent;if(null==r?void 0:r.graph){const t=yield r.$.earlyEndDateConstraintIntervals;e.push.apply(e,t)}return e}}}))){},DisableManuallyScheduledConflictResolution=class extends(Localizable_default(ConflictResolution)){static get $name(){return"RemoveManuallyScheduledParentConstraintConflictResolution"}construct(){super.construct(...arguments),this.event=this.interval.owner}getDescription(){const{event:e}=this;return format(this.L("L{descriptionTpl}"),e.name||e.id)}resolve(){this.event.manuallyScheduled=!1}},ManuallyScheduledParentConstraintIntervalDescription=class extends ConstraintIntervalDescription{static get $name(){return"ManuallyScheduledParentConstraintIntervalDescription"}static getDescription(e){let t;switch(e.side){case ConstraintIntervalSide.Start:t=this.L("L{startDescriptionTpl}");break;case ConstraintIntervalSide.End:t=this.L("L{endDescriptionTpl}")}return format(t,...this.getDescriptionParameters(e))}static getDescriptionParameters(e){const t=e.owner;return[DateHelper.format(e.startDate,this.L("L{dateFormat}")),DateHelper.format(e.endDate,this.L("L{dateFormat}")),t.name||t.id]}},ManuallyScheduledParentConstraintInterval=class extends ConstraintInterval{getDescription(){return this.descriptionBuilderClass.getDescription(this)}isAffectedByTransaction(e){const t=this.owner,r=(e=e||t.graph.activeTransaction).entries.get(t.$.manuallyScheduled);return!e.baseRevision.hasIdentifier(t.$$)||r&&!r.isShadow()}getResolutions(){return this.resolutions||(this.resolutions=[this.resetManuallyScheduledConflictResolutionClass.new({interval:this})])}};__decorate34([prototypeValue(DisableManuallyScheduledConflictResolution)],ManuallyScheduledParentConstraintInterval.prototype,"resetManuallyScheduledConflictResolutionClass",void 0),__decorate34([prototypeValue(ManuallyScheduledParentConstraintIntervalDescription)],ManuallyScheduledParentConstraintInterval.prototype,"descriptionBuilderClass",void 0);var __decorate35=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ConstrainedLateEventMixin=class extends(Mixin([ConstrainedEarlyEventMixin,HasChildrenMixin],(e=>{const t=e.prototype;class r extends e{*calculateLateStartDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateStartDateConstraintIntervals;e.push.apply(e,r)}return e}*calculateLateEndDateConstraintIntervals(){const e=[],t=yield this.$.parentEvent;if(t){const r=yield t.$.lateEndDateConstraintIntervals;e.push.apply(e,r),(yield t.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Backward&&e.push(ManuallyScheduledParentConstraintInterval.new({side:ConstraintIntervalSide.End,endDate:yield t.$.endDate}))}return e}*shouldRollupChildLateStartDate(e){return!0}*calculateMinChildrenLateStartDate(){let e=MAX_DATE;const t=yield*this.subEventsIterable();for(let r of t){if(!(yield*this.shouldRollupChildLateStartDate(r)))continue;let t;(yield r.$.manuallyScheduled)&&(yield*r.hasSubEvents())&&(t=yield r.$.minChildrenLateStartDate),t=t||(yield r.$.lateStartDate),t&&t<e&&(e=t)}return e.getTime()-MAX_DATE.getTime()?e:null}*calculateLateStartDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Backward)return yield this.$.startDate;if(yield*this.hasSubEvents())return yield this.$.minChildrenLateStartDate;if(!(yield*this.isConstrainedLate()))return yield this.$.startDate;const e=(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),t=(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals);let r=yield*this.calculateEffectiveConstraintInterval(!0,e,t);if(null===r)return null;if(r.isIntervalEmpty()){r=yield*this.calculateEffectiveConstraintInterval(!0,e,t,!0);const n=ConflictEffect.new({intervals:[...r.intersectionOf]});if((yield n)!==EffectResolutionResult.Cancel)return null;yield Reject(n)}return isDateFinite(r.endDate)?r.endDate:null}*shouldRollupChildLateEndDate(e){return!0}*calculateMaxChildrenLateEndDate(){let e=MIN_DATE;const t=yield*this.subEventsIterable();for(let r of t){if(!(yield*this.shouldRollupChildLateEndDate(r)))continue;let t;(yield r.$.manuallyScheduled)&&(yield*r.hasSubEvents())&&(t=yield r.$.maxChildrenLateEndDate),t=t||(yield r.$.lateEndDate),t&&t>e&&(e=t)}return e.getTime()-MIN_DATE.getTime()?e:null}*calculateLateStartDate(){return yield this.$.lateStartDateRaw}*calculateLateEndDateRaw(){if((yield this.$.manuallyScheduled)&&(yield this.$.direction)===Direction.Backward)return yield this.$.endDate;if(yield*this.hasSubEvents())return yield this.$.maxChildrenLateEndDate;if(!(yield*this.isConstrainedLate()))return yield this.$.endDate;const e=yield this.$.lateStartDateConstraintIntervals,t=yield this.$.lateEndDateConstraintIntervals;let r=yield*this.calculateEffectiveConstraintInterval(!1,e.concat(yield this.$.startDateConstraintIntervals),t.concat(yield this.$.endDateConstraintIntervals));if(null===r)return null;if(r.isIntervalEmpty()){r=yield*this.calculateEffectiveConstraintInterval(!1,(yield this.$.lateStartDateConstraintIntervals).concat(yield this.$.startDateConstraintIntervals),(yield this.$.lateEndDateConstraintIntervals).concat(yield this.$.endDateConstraintIntervals),!0);const e=ConflictEffect.new({intervals:[...r.intersectionOf]});if((yield e)!==EffectResolutionResult.Cancel)return null;yield Reject(e)}return isDateFinite(r.endDate)?r.endDate:null}*calculateLateEndDate(){const e=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateTotalSlack(){const e=yield this.$.earlyStartDateRaw,t=yield this.$.lateStartDateRaw,r=yield this.$.earlyEndDateRaw,n=yield this.$.lateEndDateRaw,i=yield this.$.slackUnit;let s,a;return(e&&t||r&&n)&&(e&&t?(a=yield*this.calculateProjectedDuration(e,t,i),r&&n&&(s=yield*this.calculateProjectedDuration(r,n,i),s<a&&(a=s))):r&&n&&(a=yield*this.calculateProjectedDuration(r,n,i))),a}*calculateCritical(){return(yield this.$.totalSlack)<=0}*isConstrainedLate(){const e=yield this.$.startDateConstraintIntervals,t=yield this.$.endDateConstraintIntervals,r=yield this.$.lateStartDateConstraintIntervals,n=yield this.$.lateEndDateConstraintIntervals;return Boolean((null==e?void 0:e.length)||(null==t?void 0:t.length)||(null==r?void 0:r.length)||(null==n?void 0:n.length))}*calculateStartDatePure(){return(yield this.$.direction)===Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*t.calculateStartDatePure.call(this):yield this.$.lateStartDate:yield*t.calculateStartDatePure.call(this)}*calculateStartDateProposed(){return(yield this.$.direction)===Direction.Backward?!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)?yield*t.calculateStartDateProposed.call(this):(yield this.$.lateStartDate)||(yield*t.calculateStartDateProposed.call(this)):yield*t.calculateStartDateProposed.call(this)}*calculateEndDatePure(){if((yield this.$.direction)===Direction.Backward){if(!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)){return yield*t.calculateEndDatePure.call(this)}return yield this.$.lateEndDate}return yield*t.calculateEndDatePure.call(this)}*calculateEndDateProposed(){if((yield this.$.direction)===Direction.Backward){if(!(yield*this.isConstrainedLate())||(yield this.$.manuallyScheduled)||(yield this.$.unscheduled)){return yield*t.calculateEndDateProposed.call(this)}return(yield this.$.lateEndDate)||(yield*t.calculateEndDateProposed.call(this))}return yield*t.calculateEndDateProposed.call(this)}}return __decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"minChildrenLateStartDate",void 0),__decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"lateStartDateRaw",void 0),__decorate35([model_field({type:"date",persist:!1},{lazy:EarlyLateLazyness,converter:dateConverter,persistent:!1})],r.prototype,"lateStartDate",void 0),__decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"maxChildrenLateEndDate",void 0),__decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"lateEndDateRaw",void 0),__decorate35([model_field({type:"date",persist:!1},{lazy:EarlyLateLazyness,converter:dateConverter,persistent:!1})],r.prototype,"lateEndDate",void 0),__decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"lateStartDateConstraintIntervals",void 0),__decorate35([field({lazy:EarlyLateLazyness})],r.prototype,"lateEndDateConstraintIntervals",void 0),__decorate35([model_field({type:"number",persist:!1},{lazy:EarlyLateLazyness,persistent:!1})],r.prototype,"totalSlack",void 0),__decorate35([model_field({type:"string",defaultValue:TimeUnit.Day,persist:!1},{lazy:EarlyLateLazyness,converter:DateHelper.normalizeUnit,persistent:!1})],r.prototype,"slackUnit",void 0),__decorate35([model_field({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1,lazy:EarlyLateLazyness})],r.prototype,"critical",void 0),__decorate35([calculate("lateStartDateConstraintIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),__decorate35([calculate("lateEndDateConstraintIntervals")],r.prototype,"calculateLateEndDateConstraintIntervals",null),__decorate35([calculate("minChildrenLateStartDate")],r.prototype,"calculateMinChildrenLateStartDate",null),__decorate35([calculate("lateStartDateRaw")],r.prototype,"calculateLateStartDateRaw",null),__decorate35([calculate("maxChildrenLateEndDate")],r.prototype,"calculateMaxChildrenLateEndDate",null),__decorate35([calculate("lateStartDate")],r.prototype,"calculateLateStartDate",null),__decorate35([calculate("lateEndDateRaw")],r.prototype,"calculateLateEndDateRaw",null),__decorate35([calculate("lateEndDate")],r.prototype,"calculateLateEndDate",null),__decorate35([calculate("totalSlack")],r.prototype,"calculateTotalSlack",null),__decorate35([calculate("critical")],r.prototype,"calculateCritical",null),r}))){},__decorate36=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},ScheduledByDependenciesLateEventMixin=class extends(Mixin([ScheduledByDependenciesEarlyEventMixin,ConstrainedLateEventMixin],(e=>{const t=e.prototype;class r extends e{*shouldSuccessorAffectScheduling(e){const t=yield e.$.toEvent;return t&&!isAtomicValue(t)&&(yield e.$.active)&&(!(yield t.$.inactive)||(yield this.$.inactive))}*calculateLateStartDateConstraintIntervals(){const e=yield*t.calculateLateStartDateConstraintIntervals.call(this),r=this.getProject(),n=r.dependencyConstraintIntervalClass;let i;for(i of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(i)))continue;const t=yield i.$.toEvent;let s;switch(yield i.$.type){case DependencyType.StartToStart:s=yield t.$.lateStartDateRaw;break;case DependencyType.StartToEnd:s=yield t.$.lateEndDateRaw}if(s){const t=yield i.$.lag,a=yield i.$.lagUnit,o=yield*r.$convertDuration(t,a,TimeUnit.Millisecond),l=yield i.$.calendar;yield l.$.version;let c=s;o&&(c=l.skipNonWorkingTime(l.calculateStartDate(s,o)));const d=n.new({owner:i,startDate:null,endDate:c});e.unshift(d)}}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*t.calculateLateEndDateConstraintIntervals.call(this),r=this.getProject(),n=r.dependencyConstraintIntervalClass;let i;for(i of yield this.$.outgoingDeps){if(!(yield*this.shouldSuccessorAffectScheduling(i)))continue;const t=yield i.$.toEvent;let s;switch(yield i.$.type){case DependencyType.EndToEnd:s=yield t.$.lateEndDateRaw;break;case DependencyType.EndToStart:s=yield t.$.lateStartDateRaw}if(s){const t=yield i.$.lag,a=yield i.$.lagUnit,o=yield*r.$convertDuration(t,a,TimeUnit.Millisecond),l=yield i.$.calendar;yield l.$.version;let c=s;o&&(c=l.skipNonWorkingTime(l.calculateStartDate(s,o)));const d=n.new({owner:i,startDate:null,endDate:c});e.unshift(d)}}return e}}return __decorate36([calculate("lateStartDateIntervals")],r.prototype,"calculateLateStartDateConstraintIntervals",null),r}))){},fixedEffortSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([endDateByEffortFormula,durationFormula,unitsFormula,effortFormula,startDateByEffortFormula,startDateFormula,endDateFormula])}),fixedEffortSEDWUForward=CycleResolution.new({description:fixedEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,durationFormula])}),fixedEffortSEDWUBackward=CycleResolution.new({description:fixedEffortSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,durationFormula])}),FixedEffortMixin=class extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedEffort){const r=yield*t.prepareDispatcher.call(this,e);return(yield HasProposedValue(this.$.assigned))&&r.addProposedValueFlag(UnitsVar),r.addKeepIfPossibleFlag(EffortVar),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedEffort){const t=e(this.$.direction);return t===Direction.Forward||t===Direction.None?fixedEffortSEDWUForward:fixedEffortSEDWUBackward}return t.cycleResolutionContext.call(this,e)}}}))){},fixedUnitsSEDWUGraphDescription=CycleDescription.new({variables:new Set([StartDateVar,EndDateVar,DurationVar,EffortVar,UnitsVar]),formulas:new Set([endDateByEffortFormula,durationFormula,effortFormula,unitsFormula,startDateByEffortFormula,startDateFormula,endDateFormula])}),fixedUnitsSEDWUForwardNonEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,endDateFormula,effortFormula])}),fixedUnitsSEDWUForwardEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([endDateByEffortFormula,endDateFormula,durationFormula])}),fixedUnitsSEDWUBackwardNonEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,startDateFormula,effortFormula])}),fixedUnitsSEDWUBackwardEffortDriven=CycleResolution.new({description:fixedUnitsSEDWUGraphDescription,defaultResolutionFormulas:new Set([startDateByEffortFormula,startDateFormula,durationFormula])}),FixedUnitsMixin=class extends(Mixin([HasSchedulingModeMixin],(e=>{const t=e.prototype;return class extends e{*prepareDispatcher(e){if((yield*this.effectiveSchedulingMode())===SchedulingMode.FixedUnits){const r=yield*t.prepareDispatcher.call(this,e);return(yield HasProposedValue(this.$.assigned))&&r.addProposedValueFlag(UnitsVar),(yield this.$.effortDriven)&&r.addKeepIfPossibleFlag(EffortVar),r.addKeepIfPossibleFlag(UnitsVar),r}return yield*t.prepareDispatcher.call(this,e)}cycleResolutionContext(e){if(this.effectiveSchedulingModeSync(e)===SchedulingMode.FixedUnits){const t=e(this.$.direction),r=e(this.$.effortDriven);return t===Direction.Forward||t===Direction.None?r?fixedUnitsSEDWUForwardEffortDriven:fixedUnitsSEDWUForwardNonEffortDriven:r?fixedUnitsSEDWUBackwardEffortDriven:fixedUnitsSEDWUBackwardNonEffortDriven}return t.cycleResolutionContext.call(this,e)}}}))){},__decorate37=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},InactiveEventMixin=class extends(Mixin([ScheduledByDependenciesLateEventMixin],(e=>{e.prototype;class t extends e{writeInactive(e,t,r,n){var i;const s=!t.baseRevision.hasIdentifier(e);if(e.constructor.prototype.write.call(this,e,t,r,n),!s&&this.children&&!(null==(i=this.stm)?void 0:i.state.isRestoringStateClass))for(const e of this.children)e.inactive=n}*calculateInactive(){const e=yield ProposedOrPrevious;if(yield*this.hasSubEvents()){const e=yield*this.subEventsIterable();let t=0;for(const r of e)(yield r.$.inactive)||t++;return!t}return e}*shouldRollupChildEffort(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildPercentDoneSummaryData(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildEarlyEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateStartDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}*shouldRollupChildLateEndDate(e){return!(yield e.$.inactive)||(yield this.$.inactive)}}return __decorate37([write("inactive")],t.prototype,"writeInactive",null),__decorate37([calculate("inactive")],t.prototype,"calculateInactive",null),t}))){},GanttEvent=class extends(MixinAny([SchedulerProEvent,ConstrainedByParentMixin,ConstrainedLateEventMixin,ScheduledByDependenciesLateEventMixin,FixedEffortMixin,FixedUnitsMixin,InactiveEventMixin],(e=>class extends e{}))){},__decorate38=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},HasCriticalPathsMixin=class extends(Mixin([HasChildrenMixin],(e=>{e.prototype;class t extends e{*calculateCriticalPaths(){const e=[],t=[],r=[...yield this.$.childEvents],n=yield this.$.endDate;let i,s;for(;i=r.shift();){const e=yield i.$.childEvents,s=yield i.$.critical,a=!(yield i.$.inactive),o=yield i.$.endDate;a&&o&&o.getTime()-n.getTime()==0&&s&&t.push([{event:i}]),r.push(...e)}for(;s=t.shift();){let r,n=s.length-1;for(;r=s[n];){const e=[];for(const t of yield r.event.$.incomingDeps){const r=yield t.$.fromEvent;r&&(yield t.$.active)&&!(yield r.$.inactive)&&(yield r.$.critical)&&e.push({event:r,dependency:t})}if(e.length){const r=s.slice();s.push(e[0]);for(let n=1;n<e.length;n++)t.push(r.concat(e[n]));n++}else n=-1}e.push(s.reverse())}return e}}return __decorate38([field({lazy:!0})],t.prototype,"criticalPaths",void 0),__decorate38([calculate("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t}))){},__decorate39=function(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a},GanttProjectMixin=class extends(Mixin([SchedulerProProjectMixin,HasEffortMixin,ConstrainedLateEventMixin,HasCriticalPathsMixin],(e=>{const t=e.prototype;class r extends e{constructor(){super(...arguments),this.nonEqual=!1}*calculateNonEqual(){return!(yield ProposedOrPrevious)}get isGanttProjectMixin(){return!0}afterConfigure(){t.afterConfigure.apply(this,arguments),this.projectConstraintIntervalClass=this.projectConstraintIntervalClass||ProjectConstraintInterval}*hasSubEvents(){return(yield this.$.childEvents).size>0}*subEventsIterable(){return yield this.$.childEvents}*calculateDirection(){return yield ProposedOrPrevious}*calculateStartDate(){const e=yield this.$.direction;if(e===Direction.Forward){let e=yield ProposedOrPrevious;return e||(e=yield*this.unsafeCalculateInitialMinChildrenStartDateDeep(),e||(yield this.$.nonEqual)),e}if(e===Direction.Backward){const e=yield*this.calculateMinChildrenStartDate(),t=yield this.$.endDate;return e&&t>e?e:t}}*calculateEndDate(){const e=yield this.$.direction;if(e===Direction.Forward){const e=yield this.$.startDate,t=yield*this.calculateMaxChildrenEndDate();return t&&t>e?t:e}if(e===Direction.Backward){let e=yield ProposedOrPrevious;return e||(e=yield*this.unsafeCalculateInitialMaxChildrenEndDateDeep(),e||(yield this.$.nonEqual)),e}}*shouldRollupChildStartDate(e){return!(yield e.$.inactive)}*shouldRollupChildEndDate(e){return!(yield e.$.inactive)}*calculateEarlyStartDateConstraintIntervals(){const e=yield*t.calculateEarlyStartDateConstraintIntervals.call(this),r=yield this.$.direction;if(r===Direction.Forward){const t=yield this.$.startDate;t&&e.push(this.projectConstraintIntervalClass.new({owner:this,side:ConstraintIntervalSide.Start,startDate:t}))}else if(r===Direction.Backward){const t=yield this.$.lateStartDate;t&&e.push(this.projectConstraintIntervalClass.new({owner:this,side:ConstraintIntervalSide.Start,startDate:t}))}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*t.calculateLateEndDateConstraintIntervals.call(this),r=yield this.$.direction;if(r===Direction.Forward){const t=yield this.$.earlyEndDate;t&&e.push(this.projectConstraintIntervalClass.new({owner:this,side:ConstraintIntervalSide.End,endDate:t}))}else if(r===Direction.Backward){const t=yield this.$.endDate;t&&e.push(this.projectConstraintIntervalClass.new({owner:this,side:ConstraintIntervalSide.End,endDate:t}))}return e}getDefaultEventModelClass(){return GanttEvent}getDefaultAssignmentModelClass(){return SchedulerProAssignmentMixin}getDefaultResourceModelClass(){return SchedulerProResourceMixin}getDefaultEventStoreClass(){return ChronoEventTreeStoreMixin}getType(){return ProjectType.Gantt}*unsafeCalculateInitialMinChildrenStartDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield UnsafeProposedOrPreviousValueOf(this.$.startDate);let t,r=MAX_DATE;const n=[...e];for(;t=n.shift();){let e=yield UnsafeProposedOrPreviousValueOf(t.$.startDate);e||(e=yield UnsafeProposedOrPreviousValueOf(t.$.endDate)),e&&e<r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==MIN_DATE.getTime()&&r.getTime()!==MAX_DATE.getTime()?r:null}*unsafeCalculateInitialMaxChildrenEndDateDeep(){const e=yield this.$.childEvents;if(!e.size)return yield UnsafeProposedOrPreviousValueOf(this.$.endDate);let t,r=MIN_DATE;const n=[...e];for(;t=n.shift();){let e=yield UnsafeProposedOrPreviousValueOf(t.$.endDate);e||(e=yield UnsafeProposedOrPreviousValueOf(t.$.startDate)),e&&e>r&&(r=e),n.push(...yield t.$.childEvents)}return r.getTime()!==MIN_DATE.getTime()&&r.getTime()!==MAX_DATE.getTime()?r:null}getDependencyCycleDetectionIdentifiers(e,t){return[t.$.earlyStartDateConstraintIntervals,t.$.earlyEndDateConstraintIntervals,t.$.lateEndDateConstraintIntervals,t.$.lateStartDateConstraintIntervals]}}return __decorate39([field({equality:()=>!1})],r.prototype,"nonEqual",void 0),__decorate39([calculate("nonEqual")],r.prototype,"calculateNonEqual",null),r}))){},ProjectConstraintIntervalDescription=class extends ConstraintIntervalDescription{static get $name(){return"ProjectConstraintIntervalDescription"}static getDescription(e){return format(e.startDate?this.L("L{startDateDescriptionTpl}"):this.L("L{endDateDescriptionTpl}"),...this.getDescriptionParameters(e))}},ProjectConstraintInterval=class extends ConstraintInterval{isAffectedByTransaction(e){const t=this.owner,r=(e=e||t.graph.activeTransaction).entries.get(this.startDate?t.$.startDate:t.$.endDate);return r&&!r.isShadow()}};__decorate39([prototypeValue(ProjectConstraintIntervalDescription)],ProjectConstraintInterval.prototype,"descriptionBuilderClass",void 0);var AddNewColumn=class extends Column{static get $name(){return"AddNewColumn"}static get type(){return"addnew"}static get defaults(){return{text:"L{New Column}",cls:"b-new-column-column",draggable:!1,sortable:!1,exportable:!1,field:null,editor:null}}doDestroy(){var e;null==(e=this._combo)||e.destroy(),super.doDestroy()}get combo(){const e=this,t=e.grid.columns;return e._combo||(e._combo=new Combo({owner:e.grid,cls:"b-new-column-combo",placeholder:e.L("L{New Column}"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:{align:"t0-b0",axisLock:!0},minWidth:200,onItem({record:r}){const n=new r.value({region:e.region},t);t.insert(t.indexOf(e),n),n.element.focus()},onBeforeShow(){this.forElement=e.element}},syncInputFieldValue(){this.input.value=""},internalListeners:{keydown({event:e}){e.stopImmediatePropagation()}}}))}get ganttColumnStore(){return new Store({data:Object.values(ColumnStore.columnTypes).reduce(((e,t)=>(t.$meta.fields.exposedData||t.exposeProperties({}),t.isGanttColumn&&t.text&&e.push({id:t.type,text:t.optionalL(t.text),value:t}),e)),[]),filters:[e=>!this.grid.columns.some((t=>t.constructor===e.value))],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:t}){e.combo.render(t)}onKeyDown(e){"Enter"===e.key&&this.combo.focus()}updateLocalization(){this._combo&&(this._combo.destroy(),this._combo=null),super.updateLocalization()}};ColumnStore.registerColumnType(AddNewColumn),AddNewColumn._$name="AddNewColumn";var CalendarPicker=class extends Combo{static get $name(){return"CalendarPicker"}static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map((e=>({id:e.id,text:e.name})))}get store(){return this._store||(this.store=new Store),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}};CalendarPicker.initClass(),CalendarPicker._$name="CalendarPicker";var CalendarColumn=class extends Column{static get $name(){return"CalendarColumn"}static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"L{Calendar}",editor:{type:CalendarPicker.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){super.afterConstruct();const e=this,t=e.grid.project;e.defaultCalendar=t.defaultCalendar,e.refreshCalendars(),t.calendarManagerStore.ion({changePreCommit:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){if(this.editor){const e=this.grid.project;this.editor.refreshCalendars(e.calendarManagerStore.allRecords)}}renderer({value:e}){var t;if(e!==this.defaultCalendar&&null!=(null==e?void 0:e.id)){const r=this.grid.project.calendarManagerStore.getById(e.id);return null!=(t=null==r?void 0:r.name)?t:""}return""}},GanttDateColumn=class extends DateColumn{static get $name(){return"GanttDateColumn"}static get isGanttColumn(){return!0}static get defaults(){return{instantUpdate:!0,width:130,step:null,format:"ll"}}construct(e,t){const r=this;r.gantt=t.grid,super.construct(e,t),r.format?r.explicitFormat=!0:r.gantt.ion({displayDateFormatChange({format:e}){r.explicitFormat||r.set("format",e)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}set editor(e){super.editor=e}get editor(){const e=super.editor;return e.project=this.gantt.project,e}};GanttDateColumn._$name="GanttDateColumn";var ConstraintDateColumn=class extends GanttDateColumn{static get $name(){return"ConstraintDateColumn"}static get type(){return"constraintdate"}static get defaults(){return{field:"constraintDate",text:"L{Constraint Date}",width:146}}},ConstraintTypeColumn=class extends Column{static get $name(){return"ConstraintTypeColumn"}static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"L{Constraint Type}",width:146,editor:{type:ConstraintTypePicker.type,clearable:!0,allowInvalid:!1},filterable:{filterField:{type:"constrainttypepicker"}}}}afterConstruct(){const e=this;super.afterConstruct(),e.grid.ion({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,record:t}}){e.inputField instanceof ConstraintTypePicker&&(e.inputField.store.addFilter({id:"isConstraintTypeApplicable",filterBy:e=>t.run("isConstraintTypeApplicable",e.id)}),this._filterDetacher=()=>e.inputField.store.removeFilter("isConstraintTypeApplicable"))}onDoneCellEdit(){this._filterDetacher&&this._filterDetacher()}renderer({value:e}){const t=null!=e&&"none"!==e&&this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}},DeadlineDateColumn=class extends GanttDateColumn{static get $name(){return"DeadlineDateColumn"}static get type(){return"deadlinedate"}static get defaults(){return{field:"deadlineDate",text:"L{Deadline}",width:146}}},EarlyEndDateColumn=class extends GanttDateColumn{static get $name(){return"EarlyEndDateColumn"}static get type(){return"earlyenddate"}static get defaults(){return{field:"earlyEndDate",text:"L{Early End}"}}},EarlyStartDateColumn=class extends GanttDateColumn{static get $name(){return"EarlyStartDateColumn"}static get type(){return"earlystartdate"}static get defaults(){return{field:"earlyStartDate",text:"L{Early Start}"}}},EffortColumn=class extends DurationColumn{static get $name(){return"EffortColumn"}static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"L{Effort}"}}get defaultEditor(){return{type:EffortField.type,name:this.field}}},EndDateColumn=class extends GanttDateColumn{static get $name(){return"EndDateColumn"}static get type(){return"enddate"}static get defaults(){return{field:"endDate",text:"L{Finish}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="enddate",e}};ColumnStore.registerColumnType(EndDateColumn),EndDateColumn._$name="EndDateColumn";var IgnoreResourceCalendarColumn=class extends CheckColumn{static get defaults(){return{field:"ignoreResourceCalendar",text:"L{Ignore resource calendar}"}}};__publicField(IgnoreResourceCalendarColumn,"$name","IgnoreResourceCalendarColumn"),__publicField(IgnoreResourceCalendarColumn,"type","ignoreresourcecalendar"),__publicField(IgnoreResourceCalendarColumn,"isGanttColumn",!0);var InactiveColumn=class extends CheckColumn{static get $name(){return"InactiveColumn"}static get type(){return"inactive"}static get isGanttColumn(){return!0}static get defaults(){return{field:"inactive",text:"L{Inactive}"}}},LateEndDateColumn=class extends GanttDateColumn{static get $name(){return"LateEndDateColumn"}static get type(){return"lateenddate"}static get defaults(){return{field:"lateEndDate",text:"L{Late End}"}}},LateStartDateColumn=class extends GanttDateColumn{static get $name(){return"LateStartDateColumn"}static get type(){return"latestartdate"}static get defaults(){return{field:"lateStartDate",text:"L{Late Start}"}}},ManuallyScheduledColumn=class extends CheckColumn{static get $name(){return"ManuallyScheduledColumn"}static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"L{Manually scheduled}"}}},MilestoneColumn=class extends CheckColumn{static get $name(){return"MilestoneColumn"}static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"L{Milestone}"}}};__publicField(MilestoneColumn,"suppressNoModelFieldWarning",!0);var NameColumn=class extends TreeColumn{static get $name(){return"NameColumn"}static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{width:200,field:"name",text:"L{Name}"}}};ColumnStore.registerColumnType(NameColumn),NameColumn._$name="NameColumn";var NoteColumn=class extends Column{static get $name(){return"NoteColumn"}static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"L{Note}",width:150,editor:{type:"textareapickerfield"}}}renderer({value:e}){return(e||"").trim()}},PercentDoneColumn=class extends NumberColumn{constructor(){super(...arguments),__publicField(this,"circleHeightPercentage",.75)}static get $name(){return"PercentDoneColumn"}static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"L{copRate}",unit:"%",showCircle:!1,readOnly:!0,step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer({record:e,isExport:t,value:r}){return r=e.getFormattedPercentDone(r),t?r:this.showCircle?{className:{"b-percentdone-circle":1,"b-full":100===r,"b-empty":0===r},style:{height:this.circleHeightPercentage*this.grid.rowHeight+"px",width:this.circleHeightPercentage*this.grid.rowHeight+"px","--gantt-percentdone-angle":r/100+"turn"},dataset:{value:r}}:r+this.unit}};ColumnStore.registerColumnType(PercentDoneColumn);var DevRateColumn=class extends NumberColumn{static get $name(){return"devRateColumn"}static get type(){return"devRate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"devRate",text:"偏差率",readOnly:!0,unit:"%",width:90}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return"devRate"==n.type?(r||(r=e.originalData.devRate)||(r=0),r+this.unit):r}};ColumnStore.registerColumnType(DevRateColumn);var OwnerIdColumn=class extends Column{static get $name(){return"ownerIdColumn"}static get type(){return"ownerId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"ownerId",text:"责任人",width:100,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}afterConstruct(){const e=this;super.afterConstruct(),e.grid.ion({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,column:t,record:r}}){t==this&&getNewUserValue(r,"N","ownerId")}};ColumnStore.registerColumnType(OwnerIdColumn);var ActorIdColumn=class extends Column{static get $name(){return"actorIdColumn"}static get type(){return"actorId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"actorId",text:"参与人",width:150,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}afterConstruct(){const e=this;super.afterConstruct(),e.grid.ion({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,column:t,record:r}}){t==this&&getNewUserValue(r,"Y","actorId")}};ColumnStore.registerColumnType(ActorIdColumn);var isOpenUserDialog="N";function getNewUserValue(e,t,r){var n="",i="";"Y"!=isOpenUserDialog&&(isOpenUserDialog="Y",top.layer.open({type:2,title:"选择用户",maxmin:!1,shadeClose:!1,resize:!0,scrollbar:!1,btn:["确定","取消"],area:["500px","520px"],content:["/search?type=USER&selectIds="+(e[r]?e[r].id:"")+"&isMul="+t,"no"],yes:function(t,s){var a=top.layer.getChildFrame("body",t).find(".selected-ul li");a&&a.length&&a.each((function(){n?(n+=","+$(this).attr("attrId"),i+=", "+$(this).find(".selected-name").text()):(n=$(this).attr("attrId"),i=$(this).find(".selected-name").text())})),e[r]={id:n,name:i},top.layer.close(t),isOpenUserDialog="N"},btn2:function(e,t){isOpenUserDialog="N"},cancel:function(e,t){isOpenUserDialog="N"}}))}var TaskUserPicker=class extends Combo{static get $name(){return"TaskUserPicker"}static get type(){return"taskUserPicker"}static get configurable(){return{displayField:"text",valueField:"id"}}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get store(){return this._store||(this.store=new Store({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}};TaskUserPicker.initClass(),TaskUserPicker._$name="TaskUserPicker";var TypeIdColumn=class extends Column{static get $name(){return"typeIdColumn"}static get type(){return"typeId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"typeId",text:"任务类型",width:100,editor:{type:TaskSelectPicker.type,clearable:!0,allowInvalid:!1},filterable:{filterField:{type:TaskSelectPicker.type}}}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return"typeId"==n.type?getNewSelectValue(e,n,r):r}};function getNewSelectValue(e,t,r){if(r){if(!isJSON(r)){if(t.data&&t.data.editor){const n=t.data.editor._text;return e._data.typeId={id:r,name:n},n}return r}try{return"null"==r.name?"":r.name}catch(e){return r}}else r="";return r}function isJSON(e){if("object"!=typeof e||e instanceof Date||e instanceof Duration||"number"==typeof e||"string"==typeof e)return!1;try{return JSON.parse(JSON.stringify(e)),!0}catch(e){return!1}}ColumnStore.registerColumnType(TypeIdColumn);var TaskSelectPicker=class extends Combo{static get $name(){return"TaskSelectPicker"}static get type(){return"taskSelectPicker"}static get configurable(){return{displayField:"text",valueField:"id"}}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(e){const t=this;var r=[],n=t.name?t.name:t.fieldName;const i=new XMLHttpRequest;return i.open("GET","/plan/getGanttSelectList?fieldName="+n,!1),i.onload=function(){200===i.status?r=JSON.parse(i.responseText):console.log("请求失败")},i.send(),r}set value(e){super.value=e}get value(){const e=super.value;return"none"===e?null:e}get store(){return this._store||(this.store=new Store({data:this.buildStoreData(),allowNullId:!0})),this._store}set store(e){super.store=e}};TaskSelectPicker.initClass(),TaskSelectPicker._$name="TaskSelectPicker";var RealStartDateColumn=class extends GanttDateColumn{static get $name(){return"RealStartDate"}static get type(){return"realStartDate"}static get defaults(){return{field:"realStartDate",text:"实际开始日期",width:"100",format:"YYYY-MM-DD",readOnly:!0}}defaultRenderer({record:e,value:t}){return t||(t=e.originalData.realStartDate)&&(t=t.substring(0,10)),t}};ColumnStore.registerColumnType(RealStartDateColumn);var RealEndDateColumn=class extends GanttDateColumn{static get $name(){return"RealEndDate"}static get type(){return"realEndDate"}static get defaults(){return{field:"realEndDate",text:"实际完成日期",width:"100",format:"YYYY-MM-DD",readOnly:!0}}defaultRenderer({record:e,value:t}){return t||(t=e.originalData.realEndDate)&&(t=t.substring(0,10)),t}};ColumnStore.registerColumnType(RealEndDateColumn);var PlanWorkloadColumn=class extends NumberColumn{static get $name(){return"PlanWorkload"}static get type(){return"planWorkload"}static get isGanttColumn(){return!0}static get defaults(){return{field:"planWorkload",text:"预估工时",unit:"小时",step:8,min:-1e4,max:1e4,width:90}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=0),r+" 小时"}};ColumnStore.registerColumnType(PlanWorkloadColumn);var RealWorkloadColumn=class extends NumberColumn{static get $name(){return"RealWorkload"}static get type(){return"realWorkload"}static get isGanttColumn(){return!0}static get defaults(){return{field:"realWorkload",text:"实际工时",unit:"小时",readOnly:!0}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=e.originalData.realWorkload)||(r=0),r+" 小时"}};ColumnStore.registerColumnType(RealWorkloadColumn);var ConfirmWorkloadColumn=class extends NumberColumn{static get $name(){return"ConfirmWorkload"}static get type(){return"confirmWorkload"}static get isGanttColumn(){return!0}static get defaults(){return{field:"confirmWorkload",text:"确认工时",unit:"小时",readOnly:!0}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=e.originalData.confirmWorkload)||(r=0),r+" 小时"}};ColumnStore.registerColumnType(ConfirmWorkloadColumn);var RealDurationColumn=class extends NumberColumn{static get $name(){return"RealDuration"}static get type(){return"realDuration"}static get isGanttColumn(){return!0}static get defaults(){return{field:"realDuration",text:"实际工期",unit:"日",readOnly:!0}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=e.originalData.realDuration)||(r=0),r+" 日"}};ColumnStore.registerColumnType(RealDurationColumn);var PublisherIdColumn=class extends Column{static get $name(){return"PublisherId"}static get type(){return"publisherId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"publisherId",text:"发布人",width:100,readOnly:!0,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}};ColumnStore.registerColumnType(PublisherIdColumn);var PublishDateColumn=class extends GanttDateColumn{static get $name(){return"PublishDate"}static get type(){return"publishDate"}static get defaults(){return{field:"publishDate",text:"发布日期",width:100,format:"YYYY-MM-DD",readOnly:!0}}defaultRenderer({record:e,value:t}){return t||(t=e.originalData.publishDate)&&(t=t.substring(0,10)),t}};ColumnStore.registerColumnType(PublishDateColumn);var AuditorIdColumn=class extends Column{static get $name(){return"auditorIdColumn"}static get type(){return"auditorId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"auditorId",text:"审核人",width:100,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}afterConstruct(){const e=this;super.afterConstruct(),e.grid.ion({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,column:t,record:r}}){t==this&&getNewUserValue(r,"Y","auditorId")}};ColumnStore.registerColumnType(AuditorIdColumn);var AcceptCriteriaColumn=class extends Column{static get $name(){return"AcceptCriteria"}static get type(){return"acceptCriteria"}static get isGanttColumn(){return!0}static get defaults(){return{width:150,field:"acceptCriteria",text:"验收标准"}}defaultRenderer({record:e,value:t}){return t||(t=e.originalData.acceptCriteria),t}};ColumnStore.registerColumnType(AcceptCriteriaColumn);var RemarkColumn=class extends Column{static get $name(){return"Remark"}static get type(){return"remark"}static get isGanttColumn(){return!0}static get defaults(){return{width:150,field:"remark",text:"任务描述"}}defaultRenderer({record:e,value:t}){return t||(t=e.originalData.remark),t}};ColumnStore.registerColumnType(RemarkColumn);var ChangeNumColumn=class extends NumberColumn{static get $name(){return"ChangeNum"}static get type(){return"changeNum"}static get isGanttColumn(){return!0}static get defaults(){return{width:70,field:"changeNum",text:"变更次数",unit:"次",readOnly:!0}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=e.originalData.changeNum)||(r=0),r+" 次"}};ColumnStore.registerColumnType(ChangeNumColumn);var LampSignColumn=class extends Column{static get $name(){return"LampSign"}static get type(){return"lampSign"}static get isGanttColumn(){return!0}static get defaults(){return{width:30,field:"lampSign",text:"指示灯",align:"center",readOnly:!0}}renderer({record:e}){const t=e.lampSign;return t?[{tag:"i",className:"b-fa b-fa-light fz18",style:`color:${t}`}]:""}};ColumnStore.registerColumnType(LampSignColumn);var DueSignColumn=class extends NumberColumn{static get $name(){return"DueSign"}static get type(){return"dueSign"}static get isGanttColumn(){return!0}static get defaults(){return{field:"dueSign",text:"倒计时",unit:"天",width:30,readOnly:!0}}defaultRenderer({record:e,isExport:t,value:r,column:n}){return r||(r=0),r+" 天"}};ColumnStore.registerColumnType(DueSignColumn);var CreatorIdColumn=class extends Column{static get $name(){return"CreatorId"}static get type(){return"creatorId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"creatorId",text:"创建人",width:100,readOnly:!0,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}};ColumnStore.registerColumnType(CreatorIdColumn);var CreatedTimeColumn=class extends GanttDateColumn{static get $name(){return"CreatedTime"}static get type(){return"createdTime"}static get defaults(){return{field:"createdTime",text:"创建时间",width:110,format:"YYYY-MM-DD HH:mm",readOnly:!0}}};ColumnStore.registerColumnType(CreatedTimeColumn);var ModifyIdColumn=class extends Column{static get $name(){return"ModifyId"}static get type(){return"modifyId"}static get isGanttColumn(){return!0}static get defaults(){return{field:"modifyId",text:"更新人",width:100,readOnly:!0,editor:{clearable:!0,allowInvalid:!1},filterable:!1}}defaultRenderer({record:e,isExport:t,value:r}){return r&&isJSON(r)?r.name:r}};ColumnStore.registerColumnType(ModifyIdColumn);var ModifyTimeColumn=class extends GanttDateColumn{static get $name(){return"ModifyTime"}static get type(){return"modifyTime"}static get defaults(){return{field:"modifyTime",text:"最近更新时间",width:110,format:"YYYY-MM-DD HH:mm",readOnly:!0}}};ColumnStore.registerColumnType(ModifyTimeColumn),PercentDoneColumn._$name="PercentDoneColumn";var toggleTypes={from:[2,3,0,1],to:[1,0,3,2]},buildDependencySuffixRe=()=>new RegExp("("+dependencyTypes.join("|")+")?((?:[+-])d+[a-z]*)?","i"),dependencyTypes=["SS","SF","FS","FF"],dependencySuffixRe=buildDependencySuffixRe(),_DependencyField=class extends Combo{construct(e){const t=this,{ourSide:r,otherSide:n}=e;t.dependencies=new Collection({extraKeys:n}),t.startCollection=new Collection({extraKeys:n}),super.construct(e),t.delimiterRegEx=new RegExp("\\s*"+t.delimiter+"\\s*");const i=()=>{dependencyTypes=t.L("L{DependencyType.short}"),dependencySuffixRe=buildDependencySuffixRe(),t.syncInputFieldValue()};LocaleManager_default.ion({locale:i,thisObj:t}),i()}internalOnInput(){this.clearError(void 0,!0),this.isValid&&TextField.prototype.internalOnInput.call(this)}get invalidValueError(){return"L{invalidDependencyFormat}"}onInternalKeyDown(e){var t;const{key:r}=e;"Enter"===r?this.syncInvalid():null==(t=super.onInternalKeyDown)||t.call(this,e),this.pickerVisible&&"ArrowDown"===r&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick(...arguments):this.doFilter(this.filterInput?this.filterInput.value:null)}changeStore(e){return e=e.chain((e=>!this.eventRecord||e.id!==this.eventRecord.id),null,{excludeCollapsedRecords:!1,sorters:this.sorters}),super.changeStore(e)}changePicker(e,t){const r=this,n=r.filterField||(r.filterField=new TextField({cls:"b-dependency-list-filter",clearable:!0,placeholder:"筛选",triggers:{filter:{cls:"gt-icon gt-icon-filter",align:"start"}},internalListeners:{input({event:e}){r.filterOnInput(e)},clear({event:e}){Object.defineProperty(e,"target",{configurable:!0,value:i}),r.filterOnInput.now(e)}}})),i=r.filterInput=n.input,s=_DependencyField.reconfigure(t,e?Objects.merge({owner:r,store:r.store,cls:"b-dependency-list "+r.listCls,itemTpl:r.listItemTpl,forElement:r[r.pickerAlignElement],align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement],minHeight:r.inlinePicker?null:40*Math.min(3,r.store.count)},navigator:{keyEventTarget:i,processEvent:e=>{if("Escape"!==e.key)return e;r.hidePicker()}},onItem:r.onPredecessorClick.bind(r),getItemClasses:function(e){const t=List.prototype.getItemClasses.call(this,e),n=r.dependencies.getBy(r.otherSide+"Event",e);return t+(n?" b-selected b-"+n.getConnectorString(1).toLowerCase():"")}},e):null,r);return s?(s.ion({show(){Object.defineProperty(s.scrollable,"viewport",{get(){return Rectangle.client(this.element).deflate(n.height,0,0,0)}})},once:!0,thisObj:r}),n.owner=s,n.render(s.contentElement)):r.destroyProperties("filterField"),s}updateEventRecord(){this.store.fillFromMaster()}onPickerShow({source:e}){const t=this,{element:r}=t.filterField,{contentElement:n}=e;e.minWidth=t[t.pickerAlignElement].offsetWidth,n.firstChild!==r&&n.insertBefore(r,n.firstChild),super.onPickerShow(...arguments)}listItemTpl(e){const t=StringHelper.encodeHtml(e.name),{dependencyIdField:r}=this.owner,n=r&&r!==e.constructor.idField?r:e.constructor.idField,i=e.isPhantom?"":String(e[n]);return'<div class="b-predecessor-item-text">'+t+" "+(i.length?"("+i+")":"")+'</div><div class="b-sch-box b-from" data-side="from"></div><div class="b-sch-box b-to" data-side="to"></div>'}get isValid(){return Boolean(!this.task||this.parseDependencies(this.input.value))&&super.isValid}set value(e){const t=this,r=t.dependencies;if("string"==typeof e){if(t.input.value=e,!(e=t.parseDependencies(e)))return void t.syncInvalid();e=e.map((e=>new t.dependencyStore.modelClass(e)))}else t.startCollection.clear(),null!==e&&(t.startCollection.values=e);r.clear(),null!==e&&(r.values=e),t.inputting||t.syncInputFieldValue()}get value(){return this.dependencies.values}get inputValue(){const e=this,{value:t}=e;return null==t?"":e.constructor.dependenciesToString(t,e.otherSide,e.delimiter,e.dependencyIdField)}onPredecessorClick({source:e,item:t,record:r,event:n}){const i=this,{dependencies:s}=i,a=n.target.closest(".b-sch-box"),o=null==a?void 0:a.dataset.side;let l=s.getBy(i.otherSide+"Event",r);if(t.dataset.noselect=!0,i.trigger("change",{value:i.value,event:n,userAction:!0}),l&&!a)s.remove(l);else if(l){const{id:e,type:t}=l;l=l.copy({id:e,type:toggleTypes[o][t]},{skipFieldIdentifiers:!0}),l[i.otherSide+"Event"]=r,l[i.ourSide+"Event"]=i.task,s.add(l)}else s.add(i.dependencyStore.createRecord({[i.otherSide+"Event"]:r,[i.ourSide+"Event"]:i.task},!0));i.syncInputFieldValue(),e.refresh()}static dependenciesToString(e,t,r=";",n="id"){const i=t+"Event",s=e=>{const t=e[i];return(null==t?void 0:t.isModel)?t[n]:t||""};if(null==e?void 0:e.length){return e.sort(((e,t)=>s(e)-s(t))).map((e=>""+s(e)+Dependencies.getLocalizedDependencyType(e.getConnectorString())+e.getLag())).join(r)}return""}get task(){var e;return null==(e=this.owner)?void 0:e.record}parseDependencies(e){const t=this,{store:r,task:n,dependencyStore:i}=t,s=e.split(t.delimiterRegEx),a=i.modelClass,o=[];for(let e=0;e<s.length;e++){const i=s[e];if(i){let e,s=i.length+1,l=null;for(;s&&!l;s--)e=i.substr(0,s),l=r.find((r=>String(r[t.dependencyIdField])===e),!0);if(!l)return null;const c=i.substr(s+1),d={[t.otherSide+"Event"]:l,[t.ourSide+"Event"]:n,type:a.Type.EndToStart};if(c.length){const e=dependencySuffixRe.exec(c);if(!e||!e[1]&&!e[2])return null;if(e[1]&&(d.type=dependencyTypes.indexOf(e[1].toUpperCase())),e[2]){const t=DateHelper.parseDuration(e[2],!0,n.durationUnit);d.lag=t.magnitude,d.lagUnit=t.unit}}o.push(d)}}return o}get needsInputSync(){return super.needsInputSync||!this.isValid&&this.inputValue!==this.input.value}doDestroy(){this.dependencies.destroy(),this.startCollection.destroy(),super.doDestroy()}},DependencyField=_DependencyField;__publicField(DependencyField,"$name","DependencyField"),__publicField(DependencyField,"type","dependencyfield"),__publicField(DependencyField,"configurable",{listCls:"b-predecessor-list",displayField:"name",valueField:"name",validateFilter:!1,minChars:0,clearTextOnPickerHide:!1,picker:{floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,align:{align:"t0-b0",axisLock:!0},maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},delimiter:";",dependencyStore:null,otherSide:null,ourSide:null,multiSelect:!0,chipView:null,validateOnInput:!1,dependencyIdField:null,eventRecord:null,sorters:[{field:"name"}]}),DependencyField.initClass(),DependencyField._$name="DependencyField";var hasNoProject=e=>!e.project,depIsValid=e=>e,DependencyColumn=class extends(Delayable_default(Column)){static get $name(){return"DependencyColumn"}static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"},{name:"dependencyIdField",defaultValue:null}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e,grid:t}){const r=this.dependencyIdField||t.dependencyIdField;return DependencyField.dependenciesToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter,r)},filterable({value:e,record:t,column:r}){const n=r.dependencyIdField||r.grid.dependencyIdField;return e=e.toLowerCase(),t["predecessors"===r.field?"predecessorTasks":"successorTasks"].some((t=>{var r;return t&&e.includes(null==(r=t[n])?void 0:r.toString().toLowerCase())}))}}}afterConstruct(){super.afterConstruct()}getFilterableValue(e){return this.renderer({record:e,grid:this.grid})}async finalizeCellEdit({grid:e,record:t,inputField:r,value:n,oldValue:i,editorContext:s}){if(r.clearError(),t&&n){const r=n.filter(hasNoProject),i=e.dependencyStore.getProject(),a=t[this.field];if(await i.commitAsync(),i.isDestroyed)return;return!!(await Promise.all(r.map((e=>i.isValidDependencyModel(e,a))))).every(depIsValid)||s.column.L("L{Invalid dependency}")}}get defaultEditor(){const e=this,{grid:t}=e,r="predecessors"===e.field;return{type:"dependencyfield",grid:t,name:e.field,delimiter:e.delimiter,dependencyIdField:e.dependencyIdField||t.dependencyIdField,ourSide:r?"to":"from",otherSide:r?"from":"to",store:t.eventStore||t.taskStore,dependencyStore:t.dependencyStore}}};ColumnStore.registerColumnType(DependencyColumn),DependencyColumn._$name="DependencyColumn";var PredecessorColumn=class extends DependencyColumn{constructor(){super(...arguments),__publicField(this,"canFillValue",(()=>!1))}static get $name(){return"PredecessorColumn"}static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Predecessors}",field:"predecessors"}}},AssignmentsManipulationStore=class extends AssignmentStore2{static get defaultConfig(){return{storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){const e=this;super.afterConfigure(),e.addSorter({fn:e.defaultSort.bind(e)})}get projectEvent(){return this._projectEvent}set projectEvent(e){var t,r;const n=this;(e!=n._projectEvent||e&&e.generation!==n._projectEventGeneration||(null==(t=null==e?void 0:e.getProject())?void 0:t.assignmentStore.storage.generation)!==n._assignmentStoreGeneration)&&(n._projectEvent=e,n._projectEventGeneration=null==e?void 0:e.generation,n._assignmentStoreGeneration=null==(r=null==e?void 0:e.getProject())?void 0:r.assignmentStore.storage.generation,e?(n.fillFromMaster(),n.sort()):n.removeAll())}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){const t=this;e!==t.floatAssignedResources&&(t._floatAssignedResources=e,t.sort())}fillFromMaster(){const e=this,{projectEvent:t}=e;if(t){const{assignmentStore:r,resourceStore:n}=t,i=r.modelClass.getFieldDefinition("resource").dataSource,s=r.modelClass.getFieldDefinition("event").dataSource,a=[];n.forEach((e=>{const n=r.getAssignmentForEventAndResource(t,e),o=Object.assign({units:0},null==n?void 0:n.data);delete o.id,delete o.eventId,delete o.resourceId,delete o[i],delete o[s],Object.assign(o,{resource:e,event:t}),a.push(o)}),this,{includeFilteredOutRecords:!0,includeCollapsedGroupRecords:!0}),e.data=a}}toValue(){return this.query((e=>e.units>0))}toValueString(){return this.toValue().join(", ")}defaultSort(e,t){let r=0;return r=this.floatAssignedResources?!t.units&&e.units?-1:!e.units&&t.units?1:e.resourceName.localeCompare(t.resourceName):e.resourceName.localeCompare(t.resourceName),r}onUpdate({changes:e}){const t=this;t.isConfiguring||Object.hasOwnProperty.call(e,"event")&&t.floatAssignedResources&&t.liveFloatAssignedResources&&t.sort()}};AssignmentsManipulationStore._$name="AssignmentsManipulationStore";var AssignmentModel3=class extends AssignmentModel2{static get fields(){return[{name:"event",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual},{name:"resource",persist:!0,serialize:e=>null==e?void 0:e.id,isEqual:isSerializableEqual},"eventId","resourceId"]}};AssignmentModel3._$name="AssignmentModel";var locale7={localeName:"Ch",localeDesc:"中文",localeCode:"ch",Object:{Save:"保存"},IgnoreResourceCalendarColumn:{"Ignore resource calendar":"忽略资源日历"},AddNewColumn:{"New Column":"添加列"},WBSColumn:{WBS:"WBS",renumber:"重新编号"},NameColumn:{Name:"名称"},PercentDoneColumn:{copRate:"完成率"},DevRateColumn:{devRate:"偏差率"},OwnerIdColumn:{OwnerId:"责任人"},DurationColumn:{Duration:"计划工期"},EffortColumn:{Effort:"预估工时"},EndDateColumn:{Finish:"计划完成日期"},StartDateColumn:{Start:"计划开始日期"},PredecessorColumn:{Predecessors:"前置任务"},SuccessorColumn:{Successors:"后置任务"},InactiveColumn:{Inactive:"无效"},CalendarColumn:{Calendar:"日历"},EarlyStartDateColumn:{"Early Start":"提前开始"},EarlyEndDateColumn:{"Early End":"提前结束"},LateStartDateColumn:{"Late Start":"延迟启动"},LateEndDateColumn:{"Late End":"延迟结束"},TotalSlackColumn:{"Total Slack":"总时差"},ConstraintDateColumn:{"Constraint Date":"限制日期"},ConstraintTypeColumn:{"Constraint Type":"限制类型"},DeadlineDateColumn:{Deadline:"截止日期"},DependencyColumn:{"Invalid dependency":"无效的依赖关系"},EventModeColumn:{"Event mode":"事件模式",Manual:"手工",Auto:"自动"},ManuallyScheduledColumn:{"Manually scheduled":"手工执行"},MilestoneColumn:{Milestone:"里程碑"},NoteColumn:{Note:"记录"},ResourceAssignmentColumn:{"Assigned Resources":"分配的资源","more resources":"更多资源"},RollupColumn:{Rollup:"汇总"},SchedulingModeColumn:{"Scheduling Mode":"计划模式"},SequenceColumn:{Sequence:"序列"},ShowInTimelineColumn:{"Show in timeline":"在时间线中显示"},TaskCopyPaste:{copyTask:"复制",cutTask:"剪切",pasteTask:"粘贴"},DependencyField:{invalidDependencyFormat:"无效依赖关系"},ProjectLines:{"Project Start":"项目启动","Project End":"项目结束"},TaskTooltip:{Start:"计划开始日期",End:"计划完成日期",Duration:"计划工期",Complete:"完成率"},AssignmentGrid:{Name:"资源名称",Units:"单位",unitsTpl:({value:e})=>e?e+"%":""},GanttMenu:{Edit:"编辑",Indent:"降级",Outdent:"升级","Convert to milestone":"转换为里程碑",Add:"新建...","New task":"新建任务","New milestone":"新建里程碑","Task above":"前置任务","Task below":"后置任务","Delete task":"删除",Milestone:"里程碑","Sub-task":"子任务",Successor:"后置任务",Predecessor:"前置任务",changeRejected:"计划拒绝更改",linkTasks:"添加依赖关系",unlinkTasks:"删除依赖关系"},EventSegments:{splitTask:"分解任务"},Indicators:{earlyDates:"提前开始/结束",lateDates:"延迟开始/结束",Start:"开始",End:"结束",deadlineDate:"截止日期"},Versions:{indented:"降级",outdented:"升级",cut:"剪切",pasted:"粘贴",deletedTasks:"删除任务"}},En_default6=LocaleHelper.publishLocale(locale7),ResourceAssignmentGridResourceColumn=class extends ResourceInfoColumn{static get $name(){return"ResourceAssignmentGridResourceColumn"}static get type(){return"assignmentResource"}static get defaults(){return{showEventCount:!1,cls:"b-assignmentgrid-resource-column",field:"resourceName",flex:1,editor:null,useNameAsImageName:!1,filterable:{filterField:{placeholder:"筛选",triggers:{filter:{align:"start",cls:"gt-icon gt-icon-filter"}}}}}}defaultRenderer({grid:e,record:t,cellElement:r,value:n,isExport:i}){return t.isSpecialRow||(t=t.resource),super.defaultRenderer({grid:e,record:t,cellElement:r,value:n,isExport:i})}};ColumnStore.registerColumnType(ResourceAssignmentGridResourceColumn),ResourceAssignmentGridResourceColumn._$name="ResourceAssignmentGridResourceColumn";var AssignmentGrid=class extends Grid{static get $name(){return"AssignmentGrid"}static get type(){return"assignmentgrid"}static get configurable(){return{resourceImageExtension:".jpg",minHeight:200,resourceColumn:{type:"assignmentResource"},unitsColumn:{field:"units",type:NumberColumn.type,text:"L{Units}",localeClass:this,width:70,min:0,max:100,step:10,unit:"%",renderer:({value:e})=>this.L("L{unitsTpl}",{value:Math.round(e)}),filterable:!1}}}static get defaultConfig(){return{selectionMode:{checkboxOnly:!0,multiSelect:!0,showCheckAll:!0},features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}construct(){super.construct(...arguments),this.ion({selectionChange:({selected:e,deselected:t})=>{e.forEach((e=>e.units=e.units||e.getFieldDefinition("units").defaultValue)),t.forEach((e=>{this.store.includes(e)&&(e.units=0)}))}})}get projectEvent(){const e=this,t=e.store;let r=e._projectEvent;return t&&r!==t.projectEvent&&(r=e._projectEvent=t.projectEvent),r}set projectEvent(e){const t=this;t._projectEvent=e,t.store.projectEvent=e,e&&(t.selectedRecords=t.store.query((t=>e.assignments.find((e=>e.resource===t.resource)))))}get store(){return super.store}set store(e){var t,r;const n=this,i=n.store;e&&i!==e&&(e instanceof AssignmentsManipulationStore||(e=AssignmentsManipulationStore.new({modelClass:(null==(t=n._projectEvent)?void 0:t.assignmentStore.modelClass)||AssignmentModel3,projectEvent:n._projectEvent},e)),super.store=e,null==(r=n.storeDetacher)||r.call(n),n.storeDetacher=e.ion({update:"onAssignmentUpdate",thisObj:n}))}set columns(e){e&&e.unshift(Objects.clone(this.resourceColumn),Objects.clone(this.unitsColumn)),super.columns=e}get columns(){return super.columns}onAssignmentUpdate({record:e,changes:t}){const{units:r}=t;r&&(r.value?0===r.oldValue&&this.selectRow({record:e,scrollIntoView:!1,addToSelection:!0}):this.deselectRow(e))}};AssignmentGrid.initClass(),AssignmentGrid._$name="AssignmentGrid";var AssignmentPicker=class extends AssignmentGrid{static get $name(){return"AssignmentPicker"}static get type(){return"assignmentpicker"}static get defaultConfig(){return{trapFocus:!0,height:"20em",minWidth:"25em",bbar:[{type:"button",text:this.L("L{Object.Save}"),localeClass:this,ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("L{Object.Cancel}"),localeClass:this,ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}configure(e){e.selectedRecordCollection=e.assignments,super.configure(e)}show(){return this.originalSelected=this.selectedRecords.map((e=>e.copy())),super.show(...arguments)}afterConfigure(){var e,t;const r=this;super.afterConfigure(),null==(e=r.bbar.widgetMap.saveBtn)||e.ion({click:"onSaveClick",thisObj:r}),null==(t=r.bbar.widgetMap.cancelBtn)||t.ion({click:"onCancelClick",thisObj:r})}onSaveClick(){this.hide()}onCancelClick(){this.hide()}};AssignmentPicker.initClass(),AssignmentPicker._$name="AssignmentPicker";var AssignmentField=class extends Combo{static get $name(){return"AssignmentField"}static get type(){return"assignmentfield"}static get configurable(){return{editingRecords:!0,chipView:{cls:"b-assignment-chipview",itemTpl:e=>StringHelper.xss`${e.resourceName} ${Math.round(e.units)}%`,scrollable:{overflowX:"hidden-scroll"}},triggers:{expand:{cls:"gt-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,picker:{type:AssignmentPicker.type,floating:!0,scrollAction:"realign"},pickerWidth:null,projectEvent:null,store:{},tooltipTemplate(){return StringHelper.encodeHtml(this.store.toValueString())}}}onChipClose(e){this.showPicker(),this.picker.deselectRows(e)}syncInputFieldValue(){super.syncInputFieldValue();const{store:e}=this;e&&this.tooltipTemplate&&(this.tooltip=this.tooltipTemplate({taskRecord:e.projectEvent,assignmentRecords:e.toValue()}))}onTriggerClick(e){this.pickerVisible?this.hidePicker():PickerField.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}changePicker(e,t){const r=this;return super.changePicker(e&&ObjectHelper.assign({projectEvent:r.projectEvent,store:r.store,readOnly:r.readOnly,resourceImagePath:r.resourceImageFolderPath,assignments:r.valueCollection,onCancelClick(){r.value=this.originalSelected,this.hide()},align:{anchor:r.overlayAnchor,target:r[r.pickerAlignElement]},internalListeners:{hide:()=>{r.isDestroying||r.store.clearFilters(r.containsFocus)}}},e)||null,t)}changeProjectEvent(e){const{picker:t,store:r}=this;return this._projectEvent=e,r&&(r.projectEvent=e),t&&(t.projectEvent=e),e}changeStore(e){return!e||e instanceof AssignmentsManipulationStore||(e=new AssignmentsManipulationStore(e)),e}updateStore(e){const t=this;if(t.detachListeners("storeMutation"),e instanceof AssignmentsManipulationStore){const{projectEvent:r}=e;r?t.projectEvent=r:e.projectEvent=t.projectEvent}e.ion({name:"storeMutation",change:"syncInputFieldValue",thisObj:t})}get value(){return super.value}set value(e){e=null==e?void 0:e.map((e=>{const t=this.store.find((t=>t.resource===e.resource),!0);return null==t||t.copyData(e),t})),super.value=e}hasChanged(e,t){return!ObjectHelper.isEqual(e,t)}onPickerKeyDown(e){const t=this.picker;"ArrowDown"===e.key&&e.target.compareDocumentPosition(t.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING?t.element.focus():"Escape"!==e.key||t.focusedCell.isActionable||this.hidePicker()}cacheCurrentValue(e){return Array.isArray(e)?this._value=e.map((e=>e.copy(e.id))):super.cacheCurrentValue(e)}};AssignmentField.initClass(),AssignmentField._$name="AssignmentField";var resourceNameRegExp=e=>e.resourceName.replace(/[.*+?^${}()|[\]\\]/g,"$&"),ResourceAssignmentColumn=class extends Column{constructor(){super(...arguments),__publicField(this,"internalCellCls","b-resourceassignment-cell")}static get $name(){return"ResourceAssignmentColumn"}static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get fields(){return["showAvatars","sideMargin",{name:"itemTpl",defaultValue:(e,t,r=!0)=>r?StringHelper.encodeHtml(e.toString()):e.toString()},"avatarTooltipTemplate",{name:"enableResourceDragging"},"avatarTooltip",{name:"avatarMaxSize",defaultValue:50}]}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"L{Assigned Resources}",width:250,showAvatars:!1,sideMargin:20,sortable(e,t){const r=e.assignments.join(""),n=t.assignments.join("");return r===n?0:r<n?-1:1},filterable({value:e,record:t}){if(Array.isArray(e)){if(!e.length)return Boolean(!t.assignments.length);e=e.map(resourceNameRegExp).join("|")}const r=new RegExp(e,"gi");return t.assignments.some((e=>r.test(e.resourceName)))},alwaysClearCell:!1}}construct(){super.construct(...arguments);const e=this,{grid:t}=e;e.showAvatars&&Object.assign(e,{repaintOnResize:!0,htmlEncode:!1,renderer:e.rendererWithAvatars,avatarRendering:new AvatarRendering({element:t.element,tooltip:ObjectHelper.assign({forSelector:".b-resourceassignment-cell .b-resource-avatar",internalListeners:{beforeShow({source:t}){var r;const{taskRecord:n,resourceRecord:i,assignmentRecord:s,overflowCount:a}=t.activeTarget.elementData,o=null==(r=e.avatarTooltipTemplate)?void 0:r.call(e,{taskRecord:n,resourceRecord:i,assignmentRecord:s,overflowCount:a,tooltip:t});if(0===t.items.length){const r=StringHelper.xss`${s.toString()}${a?" (+"+a+" "+e.L("L{more resources}")+")":""}`;t.html=null!=o?o:r}}}},e.avatarTooltip)})}),e.enableResourceDragging&&e.grid.ion({paint:e.setupDragging,thisObj:e,once:!0}),t.ion({beforeCellEditStart:e.onBeforeCellEditStart,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),e.showAvatars&&(t.ion({beforeRenderRows:e.calculateAvatarSize,once:!0,thisObj:e}),t.rowManager.ion({beforeRowHeight:e.calculateAvatarSize,thisObj:e})),t.resourceStore.ion({name:"resourceStore",update:e.onResourceUpdate,thisObj:e})}calculateAvatarSize({height:e}){const{grid:t}=this,r=e||t.rowHeight,{cellElement:n}=t.beginGridMeasuring();n.classList.add(this.internalCellCls);const i=globalThis.getComputedStyle(n),s=parseInt(i.paddingTop,10);this.avatarRendering.size=Math.min(this.avatarMaxSize,r-2*s),n.classList.remove(this.internalCellCls),t.endGridMeasuring()}doDestroy(){var e,t;super.doDestroy(),null==(e=this.avatarRendering)||e.destroy(),null==(t=this.dragHelper)||t.destroy()}get defaultEditor(){return{type:AssignmentField.type,store:{modelClass:this.grid.project.assignmentStore.modelClass}}}onBeforeCellEditStart({editorContext:{record:e,column:t}}){const r=this;if(t===r){const{editor:t}=r;t.resourceImageFolderPath=r.grid.resourceImageFolderPath,t.projectEvent=e,r.detachListeners("editorStore"),t.store.ion({name:"editorStore",changesApplied:r.onEditorChangesApplied,thisObj:r})}}onDoneCellEdit(){this.detachListeners("editorStore")}onEditorChangesApplied(){const e=this,t=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});t&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:t})}onResourceUpdate({source:e}){var t;(null==(t=e.project)?void 0:t.propagatingLoadChanges)||this.grid.refreshColumn(this)}get chipView(){const e=this;return e._chipView||(e._chipView=new ChipView({parent:e,cls:"b-assignment-chipview",navigator:null,itemsFocusable:!1,closable:!1,itemTpl:e.itemTpl,store:{},scrollable:{overflowX:"hidden-scroll"}}),Object.defineProperty(e.chipView,"isVisible",{get:()=>!0}),e.chipView.triggerPaint()),e._chipView}renderer({cellElement:e,value:t,isExport:r}){if(t=t.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName))),r)return t.map(((e,t)=>this.itemTpl(e,t,!1))).join(",");{const{chipView:r}=this,n=e.querySelector(".b-assignment-chipview-wrap")||DomHelper.createElement({parent:e,className:"b-assignment-chipview-wrap"});r.store.storage.replaceValues({values:t,silent:!0}),r.refresh();const i=r.element.cloneNode(!0);i.removeAttribute("id"),n.innerHTML="",n.appendChild(i)}}rendererWithAvatars({record:e,value:t,isExport:r}){const n=this,{size:i}=n.avatarRendering,s=Math.floor((n.width-n.sideMargin)/(i+2)),a=t.length>s?t.length-s:0;return t=t.filter((e=>e.resource)).sort(((e,t)=>e.resourceName.localeCompare(t.resourceName))),r?t.map(((e,t)=>this.itemTpl(e,t,!1))).join(","):{className:"b-resource-avatar-container",children:t.map(((t,r)=>{const{resource:o}=t;if(r<s){const l=a>0&&r===s-1,c=n.renderAvatar({taskRecord:e,resourceRecord:o,assignmentRecord:t,overflowCount:l?a:0});return l?{className:"b-overflow-img",style:{height:i+"px",width:i+"px"},children:[c,{tag:"span",className:"b-overflow-count",html:"+"+a}]}:c}}))}}renderAvatar({taskRecord:e,resourceRecord:t,assignmentRecord:r,overflowCount:n}){const{resourceImageFolderPath:i}=this.grid,s=t.imageUrl||t.image&&i&&i+t.image,a=this.avatarRendering.getResourceAvatar({resourceRecord:t,initials:t.initials,color:t.eventColor,iconCls:t.iconCls,defaultImageUrl:this.defaultAvatar,imageUrl:s});return a.elementData||(a.elementData={}),Object.assign(a.elementData,{taskRecord:e,resourceRecord:t,assignmentRecord:r,overflowCount:n}),a}get defaultAvatar(){const{grid:e}=this;return e.defaultResourceImageName?e.resourceImageFolderPath+e.defaultResourceImageName:""}toClipboardString({record:e}){return StringHelper.safeJsonStringify(e[this.field])}fromClipboardString({string:e,record:t}){const r=StringHelper.safeJsonParse(e),n=[];if(null==r?void 0:r.length)for(const e of r)delete e.id,delete e.event,delete e.resource,e.eventId=t.id,n.push(new AssignmentModel3(e));return n}canFillValue({range:e}){return e.every((e=>e.column===this))}calculateFillValue({record:e,value:t}){const r=JSON.stringify(t);return this.fromClipboardString({string:r,record:e})}setupDragging(){const e=this,{grid:t}=e;t.features.rowReorder&&(t.features.rowReorder.dragHelper.targetSelector+=" .b-grid-cell:not(.b-resourceassignment-cell)"),e.subGrid.element.classList.add("b-draggable-resource-avatars"),e.dragHelper=new DragHelper({callOnFunctions:!0,cloneTarget:!0,targetSelector:".b-resource-avatar-container > .b-resource-avatar",onDragStart({context:e}){const{grabbed:r}=e;e.resourceRecord=r.elementData.resourceRecord,t.enableScrollingCloseToEdges()},onDrag({context:e,event:r}){const n=e.targetTask=t.resolveTaskRecord(r.target);e.valid=Boolean(n&&!n.resources.includes(e.resourceRecord))},async onDrop({context:r,event:n}){const{targetTask:i,resourceRecord:s,valid:a,grabbed:o,element:l}=r,{assignmentRecord:c,taskRecord:d}=o.elementData,u=n.target.closest(".b-resourceassignment-cell");if(a&&(o.style.display="none"),u){if(a){const r=t.getCell({column:e,record:i}),n=null==r?void 0:r.querySelector(".b-resource-avatar-container");n&&await this.animateProxyTo(n,{align:"l0-r0"}),i.resources.includes(s)||(c.event=i)}}else l.style.display="none",d.unassign(s);t.disableScrollingCloseToEdges()}})}},RollupColumn=class extends CheckColumn{static get $name(){return"RollupColumn"}static get type(){return"rollup"}static get isGanttColumn(){return!0}static get defaults(){return{field:"rollup",text:"L{Rollup}"}}},SchedulingModeColumn=class extends Column{static get $name(){return"SchedulingModeColumn"}static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"L{Scheduling Mode}",editor:{type:SchedulingModePicker.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){const e=this;let t;super.afterConstruct(),e.editor?(FunctionHelper.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e),t=e.editor.store):t=(new SchedulingModePicker).store,this.store=t}renderer({value:e}){const t=this.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}canFillValue({range:e}){return e.every((e=>e.column===this))}},SequenceColumn=class extends Column{static get $name(){return"SequenceColumn"}static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"L{Sequence}",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}},ShowInTimelineColumn=class extends CheckColumn{static get $name(){return"ShowInTimelineColumn"}static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"L{Show in timeline}"}}},StartDateColumn=class extends GanttDateColumn{static get $name(){return"StartDateColumn"}static get type(){return"startdate"}static get defaults(){return{field:"startDate",text:"L{Start}"}}get defaultEditor(){const e=super.defaultEditor;return e.type="startdate",e}};ColumnStore.registerColumnType(StartDateColumn),StartDateColumn._$name="StartDateColumn";var SuccessorColumn=class extends DependencyColumn{constructor(){super(...arguments),__publicField(this,"canFillValue",(()=>!1))}static get $name(){return"SuccessorColumn"}static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"L{Successors}",field:"successors"}}},TotalSlackColumn=class extends DurationColumn{static get $name(){return"TotalSlackColumn"}static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"L{Total Slack}",filterable({value:e,record:t,operator:r}){const n=DateHelper.asMilliseconds(t.totalSlack,t.slackUnit),i=e.milliseconds;switch(r){case"=":return n===i;case"<":return n<i;case"<=":return n<=i;case">":return n>i;case">=":return n>=i;default:throw new Error("Invalid operator "+r)}}}}getFilterableValue(e){return new Duration({magnitude:e.totalSlack,unit:e.slackUnit})}},WBSColumn=class extends Column{constructor(){super(...arguments),__publicField(this,"canFillValue",(()=>!1))}static get $name(){return"WBSColumn"}static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsValue",text:"L{WBS}",width:50,editor:null,sortable:!1,filterable:!1,headerMenuItems:{renumber:{text:"L{WBSColumn.renumber}",icon:"gt-icon-renumber",onItem({source:e}){e.taskStore.rootNode.refreshWbs()}}},renderer:({value:e})=>String(e)}}},AllColumns_default={},TimeAxisColumn2=class extends TimeAxisColumn{static get defaults(){return{enableCellContextMenu:!0}}};ColumnStore.registerColumnType(TimeAxisColumn2),TimeAxisColumn2._$name="TimeAxisColumn";var AssignmentStore3=class extends AssignmentStore2{static get defaultConfig(){return{modelClass:AssignmentModel3,loadPriority:500,syncPriority:400}}};AssignmentStore3._$name="AssignmentStore";var CalendarModel2=class extends CalendarModel{};CalendarModel2._$name="CalendarModel";var CalendarManagerStore2=class extends CalendarManagerStore{static get defaultConfig(){return{modelClass:CalendarModel2}}};CalendarManagerStore2._$name="CalendarManagerStore";var DependencyModel3=class extends DependencyModel2{constructor(...e){const[t]=e;(null==t?void 0:t.fromTask)&&(t.fromEvent=t.fromTask),(null==t?void 0:t.toTask)&&(t.toEvent=t.toTask),super(...e)}get from(){var e;return null==(e=this.fromEvent)?void 0:e.id}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}get to(){var e;return null==(e=this.toEvent)?void 0:e.id}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}get persistableData(){const e=super.persistableData,{fromTask:t,toTask:r}=e;return t&&(e.fromTask=t.id),r&&(e.toTask=r.id),e}};DependencyModel3._$name="DependencyModel";var DependencyStore3=class extends DependencyStore2{static get defaultConfig(){return{modelClass:DependencyModel3,loadPriority:300,syncPriority:500}}};DependencyStore3._$name="DependencyStore";var ResourceModel3=class extends ResourceModel2{};ResourceModel3._$name="ResourceModel";var ResourceStore3=class extends ResourceStore2{static get defaultConfig(){return{modelClass:ResourceModel3,loadPriority:400,syncPriority:200}}};ResourceStore3._$name="ResourceStore";var Baseline=class extends TimeSpan{static get fields(){return[{name:"task",persist:!1}]}get isBaseline(){return!0}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}normalize(){const e=this,{task:t,startDate:r,endDate:n,duration:i}=e,s=null!=i;t.graph?r&&n&&!s?e.setData("duration",t.run("calculateProjectedDuration",r,n)):r&&!n&&s?e.setData("endDate",t.run("calculateProjectedXDateWithDuration",r,!0,i)):!r&&n&&s&&e.setData("startDate",t.run("calculateProjectedXDateWithDuration",n,!1,i)):super.normalize()}};Baseline._$name="Baseline";var WbsField=class extends DataField{static get type(){return"wbs"}convert(e){return Wbs.from(e)}serialize(e){return String(e)}};WbsField.prototype.compare=Wbs.compare,WbsField.initClass(),WbsField._$name="WbsField";var applyBaselineDefaults=(e,t)=>{const{startDate:r,durationUnit:n,endDate:i}=e;return t?t.map((t=>{const s=+("startDate"in t)+("endDate"in t)+("duration"in t)>1,a={task:e,...t};return s||Object.assign(a,{startDate:r,endDate:i,durationUnit:n}),a})):[]},descendingWbsSorter=e=>"wbsValue"===e.field&&!e.ascending,isReversed=e=>{for(let t,r,n=0,i=e.length;n<i;++n)if(r=e[n].wbsValue,r){if(t)return r<t;t=r}return!1},refreshWbsOptions={deep:!0},refreshWbsOnJoinOptions={deep:!0,silent:!0},TaskModel=class extends(GanttEvent.derive(TimeSpan).mixin(PartOfProject_default2,PercentDoneMixin_default)){constructor(){super(...arguments),__publicField(this,"$manuallyScheduled",null)}static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines",type:"store",modelClass:Baseline,storeClass:Store,lazy:!0},{name:"note",type:"string"},"parentId",{name:"children",persist:!1},{name:"showInTimeline",type:"boolean"},{name:"rollup",type:"boolean"},{name:"wbsValue",type:"wbs",persist:!1},{name:"deadlineDate",type:"date"},{name:"parentIndex",type:"number",persist:!0},"iconCls","taskIconCls",{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0}]}getDefaultSegmentModelClass(){return EventSegmentModel}endBatch(){const{isPersistable:e}=this;super.endBatch(...arguments),this.isPersistable&&!e&&this.assignments.forEach((e=>{e.stores.forEach((t=>{t.updateModifiedBagForRecord(e)}))}))}get isTask(){return!0}get isTaskModel(){return!0}get isEvent(){return!0}get wbsCode(){return String(this.wbsValue)}set wbsCode(e){this.wbsValue=Wbs.from(e)}copy(...e){const t=super.copy(...e);return t.setData("wbsValue",null),t}processBaselinesStoreData(e){return applyBaselineDefaults(this,e)}set baselines(e){this.set({baselines:e})}get baselines(){const e=this;if(!e.$initializedBaselines){e.fieldMap.baselines.init(e.data,e),e.assignInitables(),e.$initializedBaselines=!0}return e.meta.baselinesStore}get hasBaselines(){var e,t;const r=this.fieldMap.baselines;return Boolean(null!=(t=null==(e=this.baselines)?void 0:e.count)?t:this.originalData[r.dataSource])}setBaseline(e){if(e<=0)return;const{baselines:t}=this,r=e-t.count;r>0?t.add(applyBaselineDefaults(this,new Array(r).fill({}))):t.getAt(e-1).set(applyBaselineDefaults(this,[{}])[0])}get successors(){return Array.from(this.outgoingDeps||[])}set successors(e){this.outgoingDeps=e}setSuccessors(e){return this.replaceDependencies(e,!0)}replaceDependencies(e,t){const r=this,{dependencyStore:n}=r.project,i=new Set,s=new Set,a=[],o=t?r.outgoingDeps:r.incomingDeps,l=Array.from(o);return e.forEach((e=>{const r=l.find(t?t=>t.toEvent===e.toEvent:t=>t.fromEvent===e.fromEvent);r?(i.add(r),r.copyData(e)):s.add(e)})),o.forEach((e=>{i.has(e)||a.push(e)})),a.forEach((e=>n.remove(e))),s.forEach((e=>{t?e.fromEvent=r:e.toEvent=r,n.add(e)})),r.commitAsync()}get predecessors(){return Array.from(this.incomingDeps||[])}set predecessors(e){this.incomingDeps=e}setPredecessors(e){return this.replaceDependencies(e,!1)}get assignments(){return super.assignments}set assignments(e){const{assignmentStore:t}=this.project,r=[],n=this.assignments.filter((t=>!(null==e?void 0:e.find((e=>e.resource===t.resource)))));e.forEach((e=>{const n=t.getAssignmentForEventAndResource(this,e.resource);n?n.copyData(e):(e.remove(),r.push(e))})),t.remove(n),t.add(r)}get assigned(){var e;const{project:t}=this;return(null==t?void 0:t.isDelayingCalculation)?null!=(e=t.assignmentStore.storage.findItem("event",this))?e:new Set:super.assigned}set assigned(e){super.assigned=e}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&this.isEditable("endDate")}get isMilestone(){return this.isMst}isEditable(e){switch(e){case"earlyStartDate":case"earlyEndDate":case"lateStartDate":case"lateEndDate":case"totalSlack":return!1;case"effort":case"fullEffort":case"percentDone":case"renderedPercentDone":return this.isLeaf;case"endDate":case"duration":case"fullDuration":return this.isLeaf||this.manuallyScheduled}return super.isEditable(e)}isFieldModified(e){return"fullEffort"===e?super.isFieldModified("effort")||super.isFieldModified("effortUnit"):super.isFieldModified(e)}get milestone(){if(!this.isLeaf){const{startDate:e,endDate:t}=this}return this.isMst}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return this.dependencies}get dependencies(){var e;return(null==(e=this.project)?void 0:e.isDelayingCalculation)?[]:[...this.incomingDeps||[],...this.outgoingDeps||[]]}set dependencies(e){const t=this,r=[],n=[];null==e||e.forEach((e=>{e.fromEvent===t||e.fromEvent===t.id?n.push(e):e.toEvent!==t&&e.toEvent!==t.id||r.push(e)})),t.setPredecessors(r),t.setSuccessors(n)}get predecessorTasks(){return[...this.incomingDeps||[]].map((e=>e.fromEvent))}get successorTasks(){return[...this.outgoingDeps||[]].map((e=>e.toEvent))}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){if(this.taskStore)return this.taskStore.allIndexOf(this)+1;let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){const e=this;let t=null;return e.isProject?t=e:e.bubbleWhile((e=>(e.isProject&&(t=e),!t))),t}get fullEffort(){return new Duration({unit:this.effortUnit,magnitude:this.effort})}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get resources(){return this.assignments.reduce(((e,t)=>(t.resource&&e.push(t.resource),e)),[])}get $linkedResources(){var e,t;return null!=(t=null==(e=this.resources)?void 0:e.flatMap((e=>[e,...e.$links])))?t:[]}normalize(){}inSetNormalize(e){}joinStore(e){var t,r,n;const i=this,s=(i.firstStore||e).useOrderedTreeForWbs;i.wbsValue||i.generatedParent||((null==(t=i.taskStore)?void 0:t.isLoadingData)||!(null==(r=i.nextSibling)?void 0:r.wbsValue)&&!(null==(n=i.previousSibling)?void 0:n.wbsValue)?i.refreshWbs({useOrderedTree:s,...refreshWbsOnJoinOptions}):i.parent.refreshWbs(refreshWbsOptions,-1)),super.joinStore(e)}refreshWbs(e,t){var r,n,i,s,a,o;const l=this,{parent:c}=l,d=l.firstStore||null,{useOrderedTree:u=null!=(r=null==d?void 0:d.useOrderedTreeForWbs)&&r}=e||{};if(c&&-1!==t&&l.fieldMap.wbsValue){t=u?l.orderedParentIndex:null!=(n=null!=t?t:l.unfilteredIndex)?n:l.parentIndex,t++;const r=c.isRoot?new Wbs(t):c.wbsValue.append(t);l.set("wbsValue",r,null==e?void 0:e.silent)}if(null==(i=null==e?void 0:e.deep)||i)if(u)for(const t of null!=(s=l.orderedChildren)?s:[])t.refreshWbs(e);else{const t=null!=(a=l.unfilteredChildren)?a:l.children,r=(null==t?void 0:t.length)||0;if(r){const n=isReversed(t)&&0===(null==(o=null==d?void 0:d.sorters)?void 0:o.findIndex(descendingWbsSorter));for(let i=0;i<r;++i)t[i].refreshWbs(e,n?r-i-1:i)}}}async tryInsertChild(){return this.getProject().tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}updateDependencies(e,t){this.outgoingDeps.forEach((r=>{if(r.toEvent.isScheduled){const{type:n,calendar:i,toEvent:s}=r;e&&(n===DependencyBaseModel.Type.StartToStart?r.setLag(DateHelper.as("hour",i.calculateDurationMs(e,s.startDate,!0)),"hour"):n===DependencyBaseModel.Type.StartToEnd&&r.setLag(DateHelper.as("hour",i.calculateDurationMs(e,s.endDate,!0)),"hour")),t&&(n===DependencyBaseModel.Type.EndToStart?r.setLag(DateHelper.as("hour",i.calculateDurationMs(t,s.startDate,!0)),"hour"):n===DependencyBaseModel.Type.EndToEnd&&r.setLag(DateHelper.as("hour",i.calculateDurationMs(t,s.endDate,!0)),"hour"))}}))}async moveTaskPinningSuccessors(e){const t=this;return t.startDate=e,t.bubble((e=>{if(!e.isRoot){const t=e.run("calculateStartDate"),r=e.run("calculateEndDate");e.updateDependencies(t,r)}})),t.project.commitAsync()}async setStartDatePinningSuccessors(e){const t=this.setStartDate(e,!1);return this.bubble((e=>{if(!e.isRoot){const t=e.run("calculateStartDate");e.updateDependencies(t,null)}})),t}async setEndDatePinningSuccessors(e){const t=this;return t.endDate=e,t.bubble((e=>{if(!e.isRoot){const t=e.run("calculateEndDate");e.updateDependencies(null,t)}})),t.project.commitAsync()}getCurrentConfig(e){const{segments:t}=this,r=super.getCurrentConfig(e);return r&&t&&(r.segments=t.map((t=>t.getCurrentConfig(e)))),r}};TaskModel.convertEmptyParentToLeaf=!0,TaskModel._$name="TaskModel";var refreshWbsForChildrenOptions={deep:!0},wbsAuto=Object.freeze({add:!0,remove:!0,sort:!0}),wbsManual=Object.freeze({add:!1,remove:!1,sort:!1}),TaskStore=class extends(ChronoEventTreeStoreMixin.derive(AjaxStore).mixin(PartOfProject_default2,DayIndexMixin_default,GetEventsMixin_default)){static get defaultConfig(){return{modelClass:TaskModel,loadPriority:200,syncPriority:300,storeId:"tasks",tree:!0}}static get configurable(){return{wbsMode:"manual",useOrderedTreeForWbs:!1,outdentIgnoringSiblings:!1}}changeWbsMode(e){return"auto"===e?wbsAuto:e&&"object"==typeof e?(ObjectHelper.values(e).every((e=>!e))&&(e=ObjectHelper.assign({},wbsAuto,e)),e):wbsManual}setBaseline(e){const t=this.storage.values;this.forEach((t=>t.setBaseline(e))),this.trigger("refresh",{action:"batch",records:t,data:t})}async indent(e){const t=this,{taskStore:r,project:n}=t;let i=!1;if((e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel))).filter((t=>{let r;for(r=Boolean(t.previousSibling);r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r}))).length&&!1!==r.trigger("beforeIndent",{records:e})){if(e.sort(((e,t)=>Wbs.compare(e.wbsCode,t.wbsCode))),r.beginBatch(),i=await n.tryPropagateWithChanges((()=>{for(const r of e){const e=r.previousSibling;e.appendChild(r),t.toggleCollapse(e,!1)}})),t.isDestroyed)return;r.endBatch(),i&&(t.refreshWbsForChildren({up:2,nodes:e}),t.trigger("indent",{records:e}),t.trigger("change",{action:"indent",records:e}))}return i}async outdent(e){const t=this,{taskStore:r,project:n}=t;let i=!1;if((e=(e=(e=Array.isArray(e)?e.slice():[e]).filter((e=>!e.isProjectModel))).filter((t=>{let r;for(r=t.parent&&!t.parent.isRoot;r&&!t.isRoot;)r=!e.includes(t.parent),t=t.parent;return r}))).length&&!1!==r.trigger("beforeOutdent",{records:e})){if(e.sort(((e,t)=>Wbs.compare(t.wbsCode,e.wbsCode))),r.beginBatch(),i=await n.tryPropagateWithChanges((()=>{for(const r of e){const e=!this.outdentIgnoringSiblings&&r.parent.children.slice(r.parent.children.indexOf(r)+1);r.parent.parent.insertChild(r,r.parent.nextSibling,!1,{orderedBeforeNode:r.parent.nextOrderedSibling}),e.length&&r.appendChild(e),t.toggleCollapse(r,!1)}})),t.isDestroyed)return;r.endBatch(),i&&(t.refreshWbsForChildren({up:1,nodes:e}),t.trigger("outdent",{records:e}),t.trigger("change",{action:"outdent",records:e}))}return i}onNodeAddChild(e,t,r,n,i=!1){if(super.onNodeAddChild(e,t,r,n,i),!this.isLoadingData&&this.wbsMode.add){e.refreshWbs(refreshWbsForChildrenOptions);const r=new Set;t.forEach((t=>{const n=this.getById(t.meta.oldParentId);n&&e!==n&&!r.has(n)&&(r.add(n),n.refreshWbs(refreshWbsForChildrenOptions,-1))}))}}onNodeRemoveChild(e,t,r,n={isMove:!1,silent:!1,unfiltered:!1}){const i=super.onNodeRemoveChild(e,t,r,n);return this.wbsMode.remove&&!n.isMove&&e.refreshWbs(refreshWbsForChildrenOptions),i}afterChangesetApplied(e){super.afterChangesetApplied(e),e.forEach((e=>{e.refreshWbs({deep:!0,useOrderedTree:!0})}))}afterPerformSort(e){this.wbsMode.sort&&this.rootNode.refreshWbs(refreshWbsForChildrenOptions),super.afterPerformSort(e)}refreshWbsForChildren(e){const t=e.nodes,r={...refreshWbsForChildrenOptions,...e},n=new Set,i=r.up||0;let s,a;for(a of(t.forEach((e=>{for(a=e,s=i;a&&s;--s)a=a.parent;n.add(a)})),n))a.refreshWbs(r)}getTotalTimeSpan(){return{startDate:this.getProject().startDate,endDate:this.getProject().endDate}}getEventsForResource(e){const t=this.resourceStore.getById(e),r=(null==t?void 0:t.assignments.filter((e=>e.isPartOfStore(this.assignmentStore))))||[],n=[];return r.forEach((({event:e})=>e&&n.push(e))),n}isDateRangeAvailable(e,t,r,n){const i=new Set(this.getEventsForResource(n));if(null==r?void 0:r.isAssignment){r.event.resources.forEach((e=>{e.id!==r.resourceId&&this.getEventsForResource(e).forEach((e=>i.add(e)))}))}if(r){const e=r.isAssignment?r.event:r;i.delete(e)}return!Array.from(i).some((r=>r.isScheduled&&DateHelper.intersectSpans(e,t,r.startDate,r.endDate)))}linkTasks(e){for(let t=1;t<e.length;t++){const r=e[t-1],n=e[t];this.dependencyStore.getEventsLinkingDependency(r,n)||this.dependencyStore.add({from:r,to:n})}}unlinkTasks(e){this.dependencyStore.remove(this.dependencyStore.query((({fromTask:t,toTask:r})=>e.includes(t)&&e.includes(r))))}};__publicField(TaskStore,"$name","TaskStore"),TaskStore._$name="TaskStore";var baselineSelector=".b-task-baseline",Baselines=class extends TooltipBase{static get $name(){return"Baselines"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:baselineSelector,recordType:"baseline"}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}updateRenderer(){this.gantt.refresh()}construct(e,t){this.tipId=e.id+"-baselines-tip",this.gantt=e,super.construct(e,t)}doDisable(e){this.client.refreshWithTransition(),super.doDisable(e)}resolveTimeSpanRecord(e){const t=e.closest(baselineSelector);return null==t?void 0:t.elementData.baseline}template(e){const{baseline:t}=e,{task:r}=t,n=this.client.formatDuration(t.duration);let i='<div class="b-gantt-task-title">'+StringHelper.encodeHtml(r.name)+" (基线 "+(t.parentIndex+1)+")</div>";return i+="<table>",i+="\t<tr><td>计划开始日期：</td><td>"+e.startClockHtml+"</td></tr>",i+="<tr><td>计划完成日期：</td><td>"+e.endClockHtml+'</td></tr><tr><td>计划工期：</td><td class="b-right">'+n+" "+DateHelper.getLocalizedNameOfUnit(t.durationUnit,1!==t.duration)+"</td></tr>",i+="</table>",i}getTaskDOMConfig(e,t){const r=this,n=e.baselines.allRecords,{rtl:i}=r.client,s=i?"right":"left";return{className:{"b-baseline-wrap":!0},style:{transform:"translateY("+t+"px)"},dataset:{taskId:"baselinesFor"+e.id},children:n.map(((t,n)=>{const a=r.gantt.taskRendering.getTaskBox(t),o=a?i?r.client.timeAxisSubGrid.totalFixedWidth-a.left:a.left:0;if(a){const i={className:{[t.cls]:t.cls,"b-task-baseline":1,"b-task-baseline-milestone":t.milestone},style:{width:a.width,[s]:o,style:t.style},dataset:{index:n},elementData:{baseline:t}},l=r.renderer?r.renderer({baselineRecord:t,taskRecord:e,renderData:i}):"";return"string"==typeof l?i.html=l:i.children=[l].flat(),i}return null})),syncOptions:{syncIdField:"index"}}}onTaskDataGenerated({taskRecord:e,top:t,extraConfigs:r,wrapperCls:n}){!this.disabled&&e.hasBaselines&&(n["b-has-baselines"]=1,r.push(this.getTaskDOMConfig(e,t)))}};__publicField(Baselines,"configurable",{renderer:null}),Baselines._$name="Baselines",GridFeatureManager.registerFeature(Baselines,!1,"Gantt");var CellEdit2=class extends CellEdit{static get $name(){return"CellEdit"}static get defaultConfig(){return{addNewAtEnd:{duration:1}}}static get pluginConfig(){const e=super.pluginConfig;return e.chain=[...e.chain,"onProjectChange"],e}onProjectChange(){this.cancelEditing(!0)}getEditorForCell({record:e}){const t=super.getEditorForCell(...arguments),{inputField:r}=t;return r.project=e.project,r.eventRecord=e,t}async doAddNewAtEnd(){const e=this.grid,{addNewAtEnd:t}=this,{project:r}=e;if(await r.commitAsync(),e.isDestroyed||e.store!==e.taskStore)return;const n=e.taskStore.rootNode.appendChild(ObjectHelper.assign({name:this.L("L{Gantt.New task}"),startDate:r.startDate},t));return await r.commitAsync(),e.isDestroyed?void 0:(e.rowManager.getRowFor(n)||e.rowManager.displayRecordAtBottom(),n)}onCellEditStart(){this.client.project.suspendAutoSync()}afterCellEdit(){this.client.project.resumeAutoSync()}};CellEdit2._$name="CellEdit",GridFeatureManager.registerFeature(CellEdit2,!0,"Gantt");var CriticalPaths=class extends(Delayable_default(InstancePlugin)){static get $name(){return"CriticalPaths"}static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}doDisable(e){const t=this;e?t.unhighlightCriticalPaths():t.client.project.graph?t.highlightCriticalPaths():t.client.project.ion({graphReady(){t.highlightCriticalPaths()},thisObj:t,once:!0}),super.doDisable(e)}getDependenciesFeature(){return this.client.foregroundCanvas&&this.client.features.dependencies}setupObserver(){const e=this,{project:t}=e.client;let r;e.destroyObserver(),e.criticalPathObserver=t.getGraph().observe((function*(){return yield t.$.criticalPaths}),(t=>{if(!e.disabled){if(e.removeCriticalCls(),r=r||e.getDependenciesFeature())for(const n of t)for(const t of n)t.dependency&&r.highlight(t.dependency,e.criticalDependencyCls);e.client.trigger("criticalPathsHighlighted")}}))}destroyObserver(){var e,t;this.criticalPathObserver&&(null==(t=null==(e=this.client.project)?void 0:e.getGraph)||t.call(e).removeIdentifier(this.criticalPathObserver),this.criticalPathObserver=null)}doDestroy(){this.destroyObserver(),super.doDestroy()}highlightCriticalPaths(){const e=this,{element:t}=e.client;t.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),e.setupObserver(),t.classList.add(e.cls)}removeCriticalCls(){const e=this.client.project,t=this.getDependenciesFeature();t&&e.dependencyStore.forEach((e=>t.unhighlight(e,this.criticalDependencyCls)))}unhighlightCriticalPaths(){const e=this,t=e.client;e.destroyObserver(),e.removeCriticalCls(),t.element.classList.remove(e.cls),t.trigger("criticalPathsUnhighlighted")}onTaskDataGenerated(e){this.disabled||(e.cls["b-critical"]=e.taskRecord.critical)}};CriticalPaths._$name="CriticalPaths",GridFeatureManager.registerFeature(CriticalPaths,!0,"Gantt");var fromBoxSide2=["start","start","end","end"],toBoxSide2=["start","end","start","end"],criticalPathSorter=({fromTask:e},{fromTask:t})=>(null==e?void 0:e.critical)===(null==t?void 0:t.critical)?0:(null==e?void 0:e.critical)?1:-1,round2=e=>Math.round(2*e)/2,Dependencies2=class extends Dependencies{construct(e,t={}){e.isGantt&&(this.gantt=e),super.construct(e,t)}createMarkers(){super.createMarkers();const e=this.endMarker.cloneNode(!0);e.setAttribute("id","arrowEndCritical"),e.retainElement=!0,this.client.svgCanvas.appendChild(e)}get rowStore(){return this.client.store}attachToResourceStore(...e){this.gantt||super.attachToResourceStore(...e)}getDependencyKey(e,...t){return this.gantt||super.getDependencyKey(e,...t),e.id}getAssignmentElement(e){return this.gantt?this.client.getElementFromTaskRecord(e):super.getAssignmentElement(e)}getAssignmentBounds(e){if(!this.gantt)return super.getAssignmentBounds(e);const{client:t}=this,r=t.getElementFromTaskRecord(e);return r&&!t.isExporting?Rectangle.from(r,this.relativeTo):t.isEngineReady&&t.getTaskBox(e,!0,!0)}isDependencyVisible(e){var t,r;return this.gantt?(null==(t=e.fromEvent)?void 0:t.isScheduled)&&(null==(r=e.toEvent)?void 0:r.isScheduled):super.isDependencyVisible(e)}drawDependency(e,t=!1,r=null){if(!this.gantt)return super.drawDependency(e,t,r);const n=this,{domConfigs:i,client:s}=n,{store:a}=s,o=s.firstVisibleRow.dataIndex,l=s.lastVisibleRow.dataIndex,{startMS:c,endMS:d}=s.visibleDateRange,{fromEvent:u,toEvent:h}=e;if(a.isAvailable(u)&&a.isAvailable(h)){const t=a.indexOf(u),g=a.indexOf(h),p=Math.min(u.startDateMS,h.startDateMS),m=Math.max(u.endDateMS,h.endDateMS);if(s.isExporting||null!=t&&null!=g&&!(t<o&&g<o||t>l&&g>l||p<c&&m<c||p>d&&m>d)){const t=n.getDomConfigs(e,u,h,r);t?i.set(e.id,t):i.delete(e.id)}n.afterDrawDependency(e,t,g,p,m)}t||n.domSync()}getDependenciesToConsider(e,t,r,n){var i;const s=null==(i=super.getDependenciesToConsider)?void 0:i.call(this,e,t,r,n),a=this.client.features.criticalPaths;return s&&(null==a?void 0:a.enabled)?Array.from(s).sort(criticalPathSorter):s}adjustLineDef(e,t){const r=this;if(!r.gantt)return t;const{rtl:n}=r.gantt,{startBox:i,endBox:s}=t,a=r.pathFinder.startArrowMargin,o=r.client.getRecordCoords(e.fromEvent,!0),l=r.client.getRecordCoords(e.toEvent,!0),c=round2(i.getEnd(n)),d=round2(s.getStart(n)),u=round2(s.getEnd(n)),h=n?d<=c&&u<=c+a:d>=c&&u>=c+a;return e.type===DependencyType.EndToStart&&i.bottom<s.y&&h&&(t.endSide="top",e.toEvent.milestone||(n?s.x=s.right-2*a:s.width=2*a)),{...t,startBox:s,endBox:i,endSide:t.startSide,startSide:t.endSide,boxesReversed:!0,otherBoxes:[{start:i.x,end:i.right,top:o.y,bottom:o.bottom},{start:s.x,end:s.right,top:l.y,bottom:l.bottom}]}}drawForTask(){VersionHelper.deprecate("Gantt","6.0.0","Dependencies.drawForTask() is no longer needed"),this.refresh()}getHoverTipHtml({activeTarget:e}){const t=this,r=t.resolveDependencyRecord(e),{dependencyIdField:n}=t.client;if(!r)return null;const{fromEvent:i,toEvent:s}=r;return{children:[{className:"b-sch-dependency-tooltip",children:[{tag:"label",text:t.L("L{from}")},{text:i.name},{className:"b-sch-box b-"+(r.fromSide||fromBoxSide2[r.type])},{tag:"label",text:t.L("L{to}")},{text:s.name},{className:"b-sch-box b-"+(r.toSide||toBoxSide2[r.type])},r.lag?{tag:"label",text:t.L("L{DependencyEdit.Lag}")}:null,r.lag?{text:r.fullLag}:null]}]}}async createDependency(e){const{source:t,target:r,fromSide:n,toSide:i}=e,s=("start"===n?0:2)+("end"===i?1:0),a=this.dependencyStore.add({fromEvent:t,toEvent:r,type:s})[0];return await this.dependencyStore.project.commitAsync(),a}};__publicField(Dependencies2,"$name","Dependencies"),__publicField(Dependencies2,"configurable",{terminalSides:["left","right"],highlightDependenciesOnEventHover:!0,pathFinderConfig:{otherHorizontalMargin:0,otherVerticalMargin:0}}),Dependencies2._$name="Dependencies",GridFeatureManager.registerFeature(Dependencies2,!0,"Gantt");var Indicators=class extends TooltipBase{static get $name(){return"Indicators"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",forSelector:".b-indicator",recordType:"indicator",hoverDelay:500,layoutStyle:{flexDirection:"column"},defaultIndicators:{earlyDates:e=>e.earlyStartDate&&!e.isMilestone?{startDate:e.earlyStartDate,endDate:e.earlyEndDate,cls:"b-bottom b-early-dates",name:this.L("L{earlyDates}")}:null,lateDates:e=>e.lateStartDate&&!e.isMilestone?{startDate:e.lateStartDate,endDate:e.lateEndDate,cls:"b-bottom b-late-dates",name:this.L("L{lateDates}")}:null,constraintDate:e=>e.constraintDate?{startDate:e.constraintDate,cls:"b-bottom b-constraint-date b-constraint-type-"+e.constraintType,name:this.L("L{ConstraintTypePicker."+e.constraintType+"}")}:null,deadlineDate:e=>e.deadlineDate?{startDate:e.deadlineDate,cls:"b-bottom b-deadline-date",name:this.L("L{deadlineDate}")}:null},items:null,tooltipTemplate:e=>{const{indicator:t}=e,r=StringHelper.encodeHtml(t.name);return e.endDate?(t.name?'<div class="b-gantt-task-title">'+r+"</div>":"")+"<table><tr><td>"+this.L("L{Start}")+":</td><td>"+e.startClockHtml+"</td></tr><tr><td>"+this.L("L{End}")+":</td><td>"+e.endClockHtml+"</td></tr></table>\n":(t.name?'<div class="b-gantt-task-title">'+r+"</div>":"")+e.startText}}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(e,t={}){this.tipId=e.id+"-indicators-tip",t=Object.assign({},t);const{items:r}=t;super.construct(e,t),this.items=r}template(...e){return this.tooltipTemplate(...e)}set items(e){const t=this;t._indicators=ObjectHelper.assign({},t.defaultIndicators,e),t._indicatorAccessors={},t._indicatorStatus={};for(const e in t._indicators)t._indicatorStatus[e]=Boolean(t._indicators[e]),"function"!=typeof t._indicators[e]&&(t._indicators[e]=t.defaultIndicators[e]),Object.defineProperty(t._indicatorAccessors,e,{enumerable:!0,get:()=>!!t._indicatorStatus[e]&&t._indicators[e],set(r){t._indicatorStatus[e]=r,t.client.refresh()}})}get items(){return this._indicatorAccessors}createIndicatorDOMConfig(e,t){const{gantt:r,renderData:n}=this,{taskRecord:i}=n,{cls:s,iconCls:a}=e,{rtl:o,timeAxisViewModel:l}=r,c=l.getPositionFromDate(e.startDate),d=e.endDate?Math.abs(l.getPositionFromDate(e.endDate)-c):null,u=(null==s?void 0:s.isDomClassList)?s:new DomClassList(s),h=n.top||r.store.indexOf(i)*r.rowManager.rowOffsetHeight+r.resourceMargin,g=n.height||r.rowHeight-2*r.resourceMargin;return e.taskRecord=i,{className:Object.assign(u,{"b-indicator":1,"b-has-icon":e.iconCls}),style:{[o?"right":"left"]:c,top:h,height:g,width:d,style:e.style},dataset:{taskId:n.taskId+"-indicator-"+t,taskRecordId:n.taskId},children:[a?{tag:"i",className:a}:null],elementData:e}}onTaskDataGenerated(e){if(this.disabled)return;const{items:t}=this,r=[];for(const n in t){const i=t[n];if(this._indicatorStatus[n]&&"function"==typeof i){const t=i(e.taskRecord);t&&this.client.timeAxis.timeSpanInAxis(t.startDate,t.endDate)&&r.push(t)}}e.extraConfigs.push(...r.map(this.createIndicatorDOMConfig,{gantt:this.client,renderData:e}))}resolveTimeSpanRecord(e){return e.lastDomConfig.elementData}};Indicators._$name="Indicators",GridFeatureManager.registerFeature(Indicators,!1);var Labels2=class extends Labels{static get $name(){return"Labels"}static get pluginConfig(){return{chain:["onTaskDataGenerated"]}}onTaskDataGenerated(e){this.onEventDataGenerated(e)}};Labels2._$name="Labels",GridFeatureManager.registerFeature(Labels2,!1,"Gantt");var ParentArea=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"highlighted",new Map)}highlightParent(e){const{highlighted:t}=this;if(e&&!e.isProjectModel&&!t.has(e)){const{client:r}=this,{rowOffsetHeight:n}=r.rowManager,i=e.visibleDescendantCount,s=r.getTaskBox(e);if(!s)return;const a={className:{"b-parent-area":1},style:{top:s.top,height:(i+1)*n-s.top%n,left:s.left,width:s.width},dataset:{taskId:"parent-area-"+e.id}};t.set(e,a),this.highlightParent(e.parent)}}onBeforeTaskSync(e){if(!this.disabled){const{highlighted:t,client:r}=this;t.clear();for(const e of r.rowManager){const t=r.store.getById(e.id);t&&this.highlightParent(t.parent)}e.push(...t.values())}}doDisable(e){super.doDisable(e),this.client.refresh()}};__publicField(ParentArea,"$name","ParentArea"),__publicField(ParentArea,"pluginConfig",{chain:["onBeforeTaskSync"]}),ParentArea._$name="ParentArea",GridFeatureManager.registerFeature(ParentArea,!1,"Gantt");var ProgressLine=class extends(Delayable_default(InstancePlugin)){static get $name(){return"ProgressLine"}static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["onPaint"]}}construct(e,t={}){const r=this;r.scheduleDraw=r.createOnFrame("draw",[],r,!0),super.construct(e,t),this.lineSegments=[]}doDisable(e){const t=this;t.attachToClient(e?null:t.client),t.client.rendered&&t.draw(),super.doDisable(e)}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.disabled||this.scheduleDraw())}getSVGCanvas(){const e=this,{client:t}=e;if(!e._svgCanvas){const r=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");r.retainElement=!0,r.classList.add(e.containerCls),t.foregroundCanvas.appendChild(r)}return e._svgCanvas}attachToProject(e){this.detachListeners("project"),null==e||e.ion({name:"project",refresh:"onProjectRefresh",thisObj:this})}attachToRowManager(e){this.detachListeners("rowManager"),null==e||e.ion({name:"rowManager",translaterow:"onTranslateRow",refresh:"scheduleDraw",rerender:"scheduleDraw",changetotalheight:"scheduleDraw",thisObj:this})}attachToClient(e){const t=this;t.detachListeners("client"),null==e||e.ion({name:"client",horizontalscroll:"scheduleDraw",togglenode:"scheduleDraw",taskdrag:"onTaskDrag",taskdragabortfinalized:"scheduleDraw",aftertaskdrop:"scheduleDraw",timelineviewportresize:"scheduleDraw",thisObj:t}),t.attachToProject(null==e?void 0:e.project),t.attachToRowManager(null==e?void 0:e.rowManager)}onPaint(){this.attachToProject(this.disabled?null:this.client.project)}onProjectRefresh(){this.scheduleDraw()}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:t}){e.forEach((e=>{this.updateLineForTask(e,{[e.id]:DateHelper.add(e.startDate,t.timeDiff)})}))}shouldDrawProgressLine(){const e=this;return!e.client.timeAxisSubGrid.collapsed&&!e.disabled&&(!e.drawLineOnlyWhenStatusDateVisible||e.client.timeAxis.dateInAxis(e.statusDate))}getStatusDateX(){let{statusDate:e}=this;const{client:t}=this;return t.timeAxis.dateInAxis(e)||(e=e<t.timeAxis.startDate?t.timeAxis.startDate:t.timeAxis.endDate),t.getCoordinateFromDate(e)}getRenderData(){const e=this.getStatusDateX(),t=this.client.timeAxisSubGridElement.getBoundingClientRect();return{statusDateX:e,viewXY:[this.client.scrollLeft-t.left,-t.top]}}draw(){const e=this,{client:t}=e;if(e.lineSegments.forEach((e=>e.remove())),e.lineSegments=[],!e.shouldDrawProgressLine())return;if(t.isAnimating)return void t.ion({transitionend(){e.scheduleDraw()},once:!0});const r=e.getRenderData(),n=[];t.rowManager.forEach((t=>n.push(...e.getLineSegmentRenderData(t,r)))),n.forEach((t=>e.drawLineSegment(t))),t.trigger("progressLineDrawn")}segmentBelongsToTask(e,t){return e.getAttribute("data-task-id")==t.id}updateLineForTask(e,t){const r=this;if(r.disabled)return;const n=r.client.getRowFor(e);if(n){const i=[];r.lineSegments.forEach((t=>{r.segmentBelongsToTask(t,e)&&(i.push(t),t.remove())})),ArrayHelper.remove(r.lineSegments,...i),r.getLineSegmentRenderData(n,r.getRenderData(),t).forEach((e=>r.drawLineSegment(e)))}}getLineSegmentRenderData(e,t,r={}){const n=this,{statusDateX:i,viewXY:s}=t,a=n.client.getRecordFromElement(e.elements.normal),o=a.id,l=[];let c;return n.isStatusLineTask(a,r[a.id])&&(c=n.calculateCoordinateForTask(a,s),c&&l.push({dataset:{taskId:o},x1:i,y1:e.top,x2:c.x,y2:c.y},{dataset:{taskId:o},x1:c.x,y1:c.y,x2:i,y2:e.bottom})),c||l.push({dataset:{taskId:o},x1:i,y1:e.top,x2:i,y2:e.bottom}),l}drawLineSegment(e){const t=this;t.lineSegments.push(DomHelper.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:t.lineCls,parent:t.getSVGCanvas()},e)))}isStatusLineTask(e,t){const r=this.statusDate;return t=t||e.startDate,(null==e?void 0:e.project)&&!e.inactive&&this.client.timeAxis.isTimeSpanInAxis(e)&&(e.isInProgress||!e.isStarted&&t<r||e.isCompleted&&t>r)}calculateCoordinateForTask(e,t){const{client:r}=this,n=r.getElementFromTaskRecord(e),i=e.milestone,s=i?n:null==n?void 0:n.querySelector(".b-task-percent-bar");if(s){const e=s.getBoundingClientRect(),n=r.timeAxisViewModel.totalSize;return{x:Math.min((i?e.left:e.right)+t[0],n),y:e.top+e.height/2+t[1]}}}};ProgressLine._$name="ProgressLine",GridFeatureManager.registerFeature(ProgressLine);var ProjectLines=class extends(AbstractTimeRanges.mixin(AttachToProjectMixin_default)){static get $name(){return"ProjectLines"}static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:this.onProjectRefresh,thisObj:this})}startConfigure(){}updateLocalization(){this.renderRanges()}onProjectRefresh(){this.renderRanges()}shouldRenderRange(e){const{client:t}=this;return t.timeAxis.dateInAxis(e.startDate)}get timeRanges(){const{startDate:e,endDate:t}=this.client.project;return e&&t?[{name:this.L("L{Project Start}"),startDate:e},{name:this.L("L{Project End}"),startDate:t}]:[]}};ProjectLines._$name="ProjectLines",GridFeatureManager.registerFeature(ProjectLines,!0,"Gantt");var rollupCls="b-task-rollup",rollupSelector="."+rollupCls,Rollups=class extends TooltipBase{static get $name(){return"Rollups"}static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:rollupSelector}}static get pluginConfig(){return{chain:["onTaskDataGenerated","onPaint"]}}construct(e,t){this.tipId=e.id+"-rollups-tip",super.construct(e,t)}attachToTaskStore(e){this.detachListeners("taskStore"),null==e||e.ion({name:"taskStore",update:"onStoreUpdateRecord",thisObj:this})}doDestroy(){this.attachToTaskStore(null),super.doDestroy()}doDisable(e){const t=this;t.tooltip&&(t.tooltip.disabled=e),t.attachToTaskStore(e?null:t.client.taskStore),t.client.refresh(),super.doDisable(e)}getTipHtml({activeTarget:e,event:t}){const{client:r}=this,n=r.resolveTaskRecord(e),i=document.elementsFromPoint(t.pageX+globalThis.pageXOffset,t.pageY+globalThis.pageYOffset).filter((e=>e.classList.contains(rollupCls))).sort(((e,t)=>parseInt(e.dataset.index,10)-parseInt(t.dataset.index,10))).map((e=>n.children[parseInt(e.dataset.index,10)]));return this.template({task:n,children:i})}template({children:e}){const t=this,{client:r}=t,n=[];return e.map(((e,i)=>{const{startDate:s,endDate:a}=e,o=r.getFormattedDate(s),l=r.getDisplayEndDate(a,s),c=r.getFormattedDate(l);n.push('<div class="b-gantt-task-title '+(i?"b-follow-on":"")+'">'+StringHelper.encodeHtml(e.name)+"</div><table>","<tr><td>"+t.L("L{TaskTooltip.Start}")+"：</td><td>"+t.clockTemplate.template({date:s,text:o,cls:"b-sch-tooltip-startdate",isDrag:"N"})+"</td></tr>","<tr><td>"+t.L("L{TaskTooltip.End}")+"：</td><td>"+t.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate",isDrag:"N"})+"</td></tr></table>")})),n.join("")}onStoreUpdateRecord({record:e,changes:t}){this.client.project.propagatingLoadChanges||e.parent&&(t.rollup||t.startDate||t.endDate)&&this.client.taskRendering.redraw(e.parent)}onTaskDataGenerated({taskRecord:e,left:t,wrapperChildren:r,style:n}){if(!this.disabled&&Array.isArray(e.children)){const i=e.children.slice().sort(((e,t)=>t.durationMS-e.durationMS));r.push({className:rollupCls+"-wrap",dataset:{taskFeature:"rollups"},children:i.map((r=>{if(r.rollup&&r.isScheduled&&(!r.inactive||e.inactive)){const e=this.client.getSizeAndPosition(r);if(!e)return null;const{position:i,width:s}=e;return{dataset:{index:r.parentIndex,rollupTaskId:r.id},className:{[rollupCls]:rollupCls,[r.cls]:r.cls,"b-milestone":r.isMilestone,"b-inactive":r.inactive},style:{style:n,width:r.isMilestone?null:s,left:i-t}}}return null})),syncOptions:{syncIdField:"rollupTaskId"}})}}};Rollups._$name="Rollups",GridFeatureManager.registerFeature(Rollups,!1,"Gantt");var Summary3=class extends TimelineSummary{static get $name(){return"Summary"}static get configurable(){return{summaries:null,renderer:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("updateTaskStore","bindStore"),e}construct(e,t){super.construct(e,t),e.isGanttBase&&this.updateTaskStore(e.taskStore)}bindStore(){this.updateTimelineSummaries()}updateTaskStore(e){this.detachListeners("summaryTaskStore"),e.ion({name:"summaryTaskStore",filter:"updateTimelineSummaries",thisObj:this})}updateTimelineSummaries(){const e=this,{client:t,summaries:r}=e,{timeAxis:n}=t,i=e.summaryBarElement;i&&t.isEngineReady&&Array.from(i.children).forEach(((i,s)=>{const a=n.getAt(s);let o="",l="<header>"+e.L("L{Summary for}",t.getFormattedDate(a.startDate))+"</header>";r.forEach((e=>{const n=e.renderer({startDate:a.startDate,endDate:a.endDate,taskStore:t.taskStore,store:t.store,resourceStore:t.resourceStore,gantt:t,element:i}),s='<div class="b-timeaxis-summary-value">'+(null!=n?n:"&nbsp;")+"</div>";(r.length>1||""!==n)&&(o+=s),l+="<label>"+(e.label||"")+"</label>"+s})),i.innerHTML=o,i._tipHtml=l}))}};Summary3._$name="Summary",GridFeatureManager.registerFeature(Summary3,!1,"Gantt");var TaskCopyPaste=class extends RowCopyPaste{constructor(){super(...arguments),__publicField(this,"entityName","task")}static get $name(){return"TaskCopyPaste"}static get type(){return"taskCopyPaste"}static get configurable(){return{copyRecordText:"L{copyTask}",cutRecordText:"L{cutTask}",pasteRecordText:"L{pasteTask}"}}construct(e,t){super.construct(e,t),e.ion({beforeRenderTask:"onBeforeRenderTask",thisObj:this})}populateCellMenu({record:e,items:t}){super.populateCellMenu(...arguments),this.client.usesDisplayStore&&(t.cut&&(t.cut.disabled=!0),t.copy&&(t.copy.disabled=!0),t.paste&&(t.paste.disabled=!0))}copy(){!this.client.usesDisplayStore&&this.copyRows()}cut(){!this.client.usesDisplayStore&&this.copyRows(!0)}paste(e){!this.client.usesDisplayStore&&this.pasteRows((null==e?void 0:e.isModel)?e:null)}onRowCutOrCopy(e){super.onRowCutOrCopy(...arguments),this.client.taskRendering.redraw(e)}onBeforeRenderTask({renderData:e}){e.cls["b-cut-row"]=e.row.cls["b-cut-row"]}clearClipboard(){const e=this.clipboardRecords.slice();super.clearClipboard(),e.forEach((e=>this.client.taskRendering.redraw(e)))}extractParents(e,t){const r=super.extractParents(e,t);return this._isCut||(this.depsToCopy=this.extractDependencies(e,t)),r}insertCopiedRecords(e,t){const r=this,n=super.insertCopiedRecords(e,t);return e.forEach((e=>e.refreshWbs({deep:!0,useOrderedTree:!0}))),r.client.dependencyStore.add(r.depsToCopy),delete r.depsToCopy,n}extractDependencies(e,t){const r={};return e.reduce(((n,i)=>(i.predecessors.forEach((s=>{const a=s.id;!(a in r)&&e.includes(s.fromEvent)&&(r[a]=!0,n.push(Object.assign({},s.data,{id:void 0,to:void 0,toEvent:t[i.id].id,toTask:void 0,from:void 0,fromEvent:t[s.fromEvent.id].id,fromTask:void 0})))})),i.successors.forEach((s=>{const a=s.id;!(a in r)&&e.includes(s.toEvent)&&(r[a]=!0,n.push(Object.assign({},s.data,{id:void 0,to:void 0,toEvent:t[s.toEvent.id].id,toTask:void 0,from:void 0,fromEvent:t[i.id].id,fromTask:void 0})))})),n)),[])}};TaskCopyPaste._$name="TaskCopyPaste",GridFeatureManager.registerFeature(TaskCopyPaste,!0,"Gantt");var TaskDrag=class extends DragBase{static get $name(){return"TaskDrag"}static get configurable(){return{validatorFn:(e,t,r,n)=>!0,validatorFnThisObj:null,pinSuccessors:!1,tooltipCls:"b-gantt-taskdrag-tooltip",capitalizedEventName:null}}afterConstruct(){this.capitalizedEventName=this.capitalizedEventName||this.client.capitalizedEventName,super.afterConstruct(...arguments)}changePinSuccessors(e){return EventHelper.toSpecialKey(e)}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.store}getDraggableElement(e){return null==e?void 0:e.closest(this.drag.targetSelector)}resolveEventRecord(e,t=this.client){return t.resolveTaskRecord(e)}isElementDraggable(e,t){var r;const n=this,{client:i}=n,s=n.getDraggableElement(e);if(!s||n.disabled||i.readOnly)return!1;if(e.matches('[class$="-handle"]'))return!1;const a=n.resolveEventRecord(s,i);if(!a||!a.isDraggable||a.readOnly||!a.project||!isAllowEdit(a.statusId))return!1;return!(!1===(null==(r=i["is"+n.capitalizedEventName+"ElementDraggable"])?void 0:r.call(i,s,a,e,t)))}triggerBeforeEventDrag(e,t){return this.client.trigger(e,t)}triggerEventDrag(e,t){this.client.trigger("taskDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}triggerDragStart(e){this.client.trigger("taskDragStart",{taskRecords:e.draggedEntities,dragData:e})}triggerDragAbort(e){this.client.trigger("taskDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.client.trigger("taskDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterTaskDrop",{taskRecords:e.draggedEntities,context:e,valid:t})}getProductDragContext(e){return{valid:!0}}getMinimalDragData(e){const t=this.getElementFromContext(e);return{taskRecord:this.client.resolveTaskRecord(t)}}getTaskScheduleRegion(e,t){return this.client.getScheduleRegion(e,!0,t)}getDateConstraints(e){var t,r;return null==(r=(t=this.client).getDateConstraints)?void 0:r.call(t,e)}setupProductDragData(e){const t=this,{client:r}=t,n=e.element,i=r.resolveTaskRecord(n),s=Rectangle.from(n),a=t.getRelatedRecords(i)||[],o=t.getDateConstraints(i),l=[n],c=t.getTaskScheduleRegion(i,o);t.setupConstraints(c,s,r.timeAxisViewModel.snapPixelAmount,Boolean(o)),a.forEach((e=>{ArrayHelper.include(l,r.getElementFromTaskRecord(e,!1))}));const d=[i,...a];return{record:i,dateConstraints:o,eventBarEls:l,draggedEntities:d,taskRecords:d}}getCoordinate(e,t,r){return r[0]}checkDragValidity(e,t){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedEntities,e.startDate,e.duration,t)}isValidDrop(e){return!0}async updateRecords(e){const{startDate:t,browserEvent:r,draggedEntities:[n]}=e,i=n.startDate;this.pinSuccessors&&r[this.pinSuccessors]?await n.moveTaskPinningSuccessors(t):await n.setStartDate(t,!0),n.startDate-i?this.client.trigger("taskDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1}getRecordElement(e){return this.client.getElementFromTaskRecord(e,!0)}get tipId(){return this.client.id+"-task-drag-tip"}};TaskDrag._$name="TaskDrag",GridFeatureManager.registerFeature(TaskDrag,!0,"Gantt");var TaskDragCreate=class extends DragCreateBase{static get $name(){return"TaskDragCreate"}static get configurable(){return{preventMultiple:!0}}construct(e,t){this.gantt=e,super.construct(e,t)}get store(){return this.gantt.store}setupDragContext(e){var t,r;const{client:n}=this;if(null==(r=(t=e.target).closest)?void 0:r.call(t,"."+n.timeAxisColumn.cellCls)){const t=n.getRecordFromElement(e.target);if(t){const r=Draggable_default().prototype.setupDragContext.call(this,e);return r.scrollManager=n.scrollManager,r.taskRecord=r.rowRecord=t,r}}}startDrag(e){const t=this.draggingEnd=e.event.pageX>e.startEvent.pageX,{client:r}=this,{timeAxis:n}=r,{mousedownDate:i,taskRecord:s,date:a}=e;return r.beginListeningForBatchedUpdates(),s.beginBatch(),s.set("startDate",DateHelper.floor(t?i:a,n.resolution,void 0,r.weekStartDay)),s.set("endDate",DateHelper.ceil(t?a:i,n.resolution,void 0,r.weekStartDay)),!1===this.handleBeforeDragCreate(e,s,e.event)?(this.onAborted(e),!1):(e.itemElement=e.element=r.getElementFromTaskRecord(e.taskRecord),super.startDrag.call(this,e))}handleBeforeDragCreate(e,t,r){var n,i;const s=this,a=s.gantt.trigger("beforeDragCreate",{taskRecord:t,date:e.mousedownDate,event:r});return s.dateConstraints=null==(i=(n=s.gantt).getDateConstraints)?void 0:i.call(n,t),a}checkValidity(e,t){const r=this;return e.taskRecord=r.dragging.taskRecord,r.createValidatorFn.call(r.validatorFnThisObj||r,e,t)}isRowEmpty(e){return!e.startDate||!e.endDate}onAborted({taskRecord:e}){e.cancelBatch(),this.client.endListeningForBatchedUpdates()}};TaskDragCreate._$name="TaskDragCreate",GridFeatureManager.registerFeature(TaskDragCreate,!0,"Gantt");var TaskEditor=class extends GanttTaskEditor{static get type(){return"taskeditor"}static get $name(){return"TaskEditor"}static get defaultConfig(){return{cls:"b-gantt-taskeditor b-schedulerpro-taskeditor"}}};TaskEditor.initClass(),TaskEditor._$name="TaskEditor";var TaskEdit2=class extends TaskEdit{static get $name(){return"TaskEdit"}static get defaultConfig(){return{triggerEvent:"taskdblclick",saveAndCloseOnEnter:!0,editorClass:TaskEditor}}static get pluginConfig(){return{chain:["populateTaskMenu","onTaskEnterKey"],assign:["editTask"]}}editTask(e,t){editTaskDialog(e)}onActivateEditor({taskRecord:e,taskElement:t}){openTaskDialog(e)}getElementFromTaskRecord(e){return this.client.getElementFromTaskRecord(e)}onTaskEnterKey({taskRecord:e}){this.editTask(e)}populateTaskMenu({taskRecord:e,selection:t,items:r}){}onEventEnterKey({taskRecord:e,target:t}){this.editTask(e)}scrollTaskIntoView(e){return this.scrollEventIntoView(e)}scrollEventIntoView(e){return this.client.scrollTaskIntoView(e)}};function editTaskDialog(e){let t=e.originalData.statusId,r=e.originalData.id;r||(r=e._data.id),r&&(r.indexOf("_generatede_")>-1?r=r.replace("_generatede_",""):r.indexOf("_generatedt_")>-1&&(r=r.replace("_generatedt_",""))),top.layer.open({skin:t&&"07698511-fa9f-47e2-9f4c-5fbstatus001"!=t?"openClass":"",type:2,title:"编辑任务",maxmin:!0,shadeClose:!1,area:["960px","95%"],content:"/task/addOrEditTask?id="+r+"&taskType=PT&action=10&isGantt=Y&parentname="+(window.name?window.name:$("#parentName").val()),end:function(e,t){e&&reLoad()}})}function openTaskDialog(e,t){e&&((t=e.originalData.id)||(t=e._data.id)),t&&(t.indexOf("_generatede_")>-1?t=t.replace("_generatede_",""):t.indexOf("_generatedt_")>-1&&(t=t.replace("_generatedt_",""))),top.layer.open({skin:"openClass",type:2,title:"编辑任务",maxmin:!0,shadeClose:!1,area:["960px","95%"],content:"/task/view/"+t+"?&isKeepTopWindow="+$("#isKeepTopWindow").val()+"&isGantt=Y&parentname="+(window.name?window.name:$("#parentName").val()),end:function(e,t){e&&reLoad()}})}function isAllowEdit(e){var t=$("#btn_EDITTSK").val();return!(!t||"Y"!=t)&&("07698511-fa9f-47e2-9f4c-5fbstatus004"!=e&&"07698511-fa9f-47e2-9f4c-5fbstatus005"!=e&&"07698511-fa9f-47e2-9f4c-5fbstatus006"!=e&&"07698511-fa9f-47e2-9f4c-5fbstatus007"!=e&&"07698511-fa9f-47e2-9f4c-5fbstatus008"!=e&&"07698511-fa9f-47e2-9f4c-5fbstatus009"!=e)}TaskEdit2._$name="TaskEdit",GridFeatureManager.registerFeature(TaskEdit2,!0,"Gantt");var TaskMenu=class extends EventMenu{static get $name(){return"TaskMenu"}static get defaultConfig(){return{type:"task",processItems:null}}static get pluginConfig(){const e=super.pluginConfig;return e.chain.push("populateTaskMenu"),e}construct(e,t={}){super.construct(...arguments),this.gantt=e,e.features.cellMenu&&(console.warn("`CellMenu` feature is ignored, when `TaskMenu` feature is enabled. If you need cell specific menu items, please configure `TaskMenu` feature items instead."),e.features.cellMenu.disabled=!0)}getDataFromEvent(e){const{client:t}=this,r=this.getTargetElementFromEvent(e),n=t.resolveTaskRecord(r)||t.getRecordFromElement(r),i=n&&t.getElementFromTaskRecord(n,!1);return Objects.assign({event:e,targetElement:r,taskElement:i,taskRecord:n},t.getCellDataFromEvent(e))}callChainablePopulateMenuMethod(e){e.cellData&&this.client.populateCellMenu&&this.client.populateCellMenu(e),super.callChainablePopulateMenuMethod(...arguments)}shouldShowMenu(e){const{column:t}=e;return e.taskRecord&&(!t||!1!==t.enableCellContextMenu)}getElementFromRecord(e){return this.client.getElementFromTaskRecord(e)}populateTaskMenu({items:e,column:t,selection:r,taskRecord:n}){const{client:i}=this,{isTreeGrouped:s,usesDisplayStore:a}=i,o=r.includes(n)&&r.length>1;e.add={disabled:i.readOnly||s||a,hidden:o||!$("#btn_ADDTSK").val()};let l=n.statusId,c=!l||"07698511-fa9f-47e2-9f4c-5fbstatus001"==l;var d=!$("#btn_EDITTSK").val(),u=l&&!isAllowEdit(l),h=l&&("07698511-fa9f-47e2-9f4c-5fbstatus007"==l||"07698511-fa9f-47e2-9f4c-5fbstatus009"==l),g=!1;if(n.previousSibling){var p=n.previousSibling.statusId;p&&"07698511-fa9f-47e2-9f4c-5fbstatus001"!=p&&(g=!0)}e.editTask={disabled:i.readOnly||s||a,hidden:o||!c||d||u},e.changeTask={disabled:i.readOnly||s||a,hidden:o||c||d||u};let m="Y"==$("#isTemplate").val(),f="Y"==n.isNode;e.publishTask={hidden:!c||m||d||f},e.communication={hidden:m},e.convertToMilestone={disabled:i.readOnly||n.readOnly,hidden:n.isParent||n.milestone},e.indent={disabled:i.readOnly||!n.previousSibling||n.readOnly||s||a||g,hidden:d},e.outdent={disabled:i.readOnly||n.parent===i.taskStore.rootNode||n.readOnly||s||a,hidden:d},e.deleteTask={disabled:i.readOnly||n.readOnly,hidden:!$("#btn_DELTSK").val()},e.reopenTask={hidden:m||d||f||!h},e.linkTasks={disabled:!o,hidden:d},e.unlinkTasks={disabled:e.linkTasks.disabled,hidden:d},(null==t?void 0:t.cellMenuItems)&&Objects.merge(e,t.cellMenuItems)}changeItems(e){const{client:t}=this,{store:r}=t;return Objects.merge({add:{text:"L{Gantt.Add}",cls:"b-separator",icon:"gt-icon-add",weight:500,menu:{addTaskAbove:{text:"L{Gantt.Task above}",weight:510,icon:"gt-icon-up",onItem({taskRecord:e}){t.addTaskAbove(e)}},addTaskBelow:{text:"L{Gantt.Task below}",weight:520,icon:"gt-icon-down",onItem({taskRecord:e}){t.addTaskBelow(e)}}}},editTask:{icon:"gt-icon gt-icon-edit",text:"L{Gantt.Edit}",weight:550,separator:!0,onItem({taskRecord:e}){t.editTask(e)}},changeTask:{icon:"gt-icon gt-icon-edit",text:"变更",weight:550,separator:!0,onItem({taskRecord:e}){t.editTask(e)}},publishTask:{text:"发布",icon:"b-fa-check-circle",separator:!1,weight:600,onItem({selection:e,taskRecord:t}){let r="",n=!0;e.forEach((e=>{const t=e.id.replace("_generatede_","");r?r+=","+t:r=t,e.name&&e.startDate&&e.endDate&&e.typeId&&e.ownerId&&"null"!=e.typeId.id&&"null"!=e.ownerId.id||(n=!1)})),n?fetch("/plan/publishTasks",{method:"POST",headers:{"Content-Type":"application/json"},body:r}).then((e=>{if(!e.ok)throw new Error("请求失败");parent.layer.msg("发布成功"),globalThis.ganttInit.project.load("/plan/getPlanTaskList?planId="+$("#planId").val())})).catch((e=>{console.log(e)})):parent.layer.msg("存在必填字段为空，不允许发布！",1)}},communication:{text:"沟通",icon:"b-fa-comment-dots",cls:"b-separator",weight:650,onItem({selection:e,taskRecord:t}){top.layer.open({type:2,title:"发送沟通消息",maxmin:!0,shadeClose:!1,area:["830px","600px"],content:"/addMessage?objectId="+t.id+"&objectType=TSK&parentname="+window.name})}},indent:{text:"L{Gantt.Indent}",icon:"gt-icon-indent",weight:700,separator:!0,onItem({selection:e,taskRecord:r}){t.indent(e.includes(r)?e:r)}},outdent:{text:"L{Gantt.Outdent}",icon:"gt-icon-outdent",weight:800,onItem({selection:e,taskRecord:r}){t.outdent(e.includes(r)?e:r)}},deleteTask:{text:"L{Gantt.Delete task}",icon:"gt-icon-trash",cls:"b-separator",weight:900,onItem({selection:e,taskRecord:t}){var n=top.layer.confirm("确定要删除选中的数据？",{btn:["确定","取消"]},(function(){top.layer.close(n);var i="";e.forEach((e=>{const t=e.id.replace("_generatede_","");i?i+=","+t:i=t})),fetch("/plan/getNotAllowDeleteTasksName",{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then((e=>{if(e.ok)return e.text();throw new Error("请求失败")})).then((n=>{n?parent.layer.msg("已登记过工时的任务，不允许删除！",1):r.remove(e.includes(t)?e:t)})).catch((e=>{console.log(e)}))}),(function(){top.layer.close(n)}))}},reopenTask:{text:"重新开启",icon:"b-fa-power-off",cls:"b-separator",weight:950,onItem({selection:e,taskRecord:t}){var r="";e.forEach((e=>{const t=e.id.replace("_generatede_","");r?r+=","+t:r=t}));var n={taskIds:r,action:"11"};fetch("/task/updateTaskStatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(!e.ok)throw new Error("请求失败");parent.layer.msg("操作成功"),globalThis.ganttInit.project.load("/plan/getPlanTaskList?planId="+$("#planId").val())})).catch((e=>{console.log(e)}))}},linkTasks:{text:"L{Gantt.linkTasks}",icon:"gt-icon-link",cls:"b-separator",weight:1e3,onItem({selection:e}){r.linkTasks(e)}},unlinkTasks:{text:"L{Gantt.unlinkTasks}",icon:"gt-icon-link-slash",weight:1010,onItem({selection:e,taskRecord:t}){r.unlinkTasks(e)}}},e)}};TaskMenu.featureClass="",TaskMenu._$name="TaskMenu",GridFeatureManager.registerFeature(TaskMenu,!0,"Gantt");var casedEventName={click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu"},TaskNonWorkingTime=class extends(InstancePlugin.mixin(AttachToProjectMixin_default)){static get properties(){return{rowMap:new Map,taskMap:new Map}}construct(){super.construct(...arguments),this.client.timeAxis.ion({name:"timeAxis",reconfigure:"onTimeAxisReconfigure",prio:100,thisObj:this}),this.client.taskStore.ion({filter:this.clear,thisObj:this})}attachToProject(e){super.attachToProject(e),e.ion({name:"project",refresh:()=>{this.clear(),this.client.refresh()},prio:100,thisObj:this})}onPaint({firstPaint:e}){e&&(this.mouseEventsDetacher=EventHelper.on({element:this.client.foregroundCanvas,delegate:".b-tasknonworkingtime",click:"handleMouseEvent",dblclick:"handleMouseEvent",contextmenu:"handleMouseEvent",thisObj:this}))}doDisable(e){super.doDisable(e),this.clear(),this.client.refresh()}updateMode(){this.isConfiguring||(this.clear(),this.client.refresh())}clear(){this.taskMap.clear(),this.rowMap.clear()}onTimeAxisReconfigure(){this.clear()}onTaskDataGenerated(e){if(e.task.effectiveCalendar){if("bar"!==this.mode){const t=this.getCalendarIntervalsToRender(e,!1);e.extraConfigs.push(...t)}if("row"!==this.mode){const t=this.getCalendarIntervalsToRender(e,!0);e.children.push(...t)}}}getCalendarIntervalsToRender(e,t=!1){const r=this,{rowMap:n,taskMap:i,client:s}=r,{timeAxis:a}=s,{task:o}=e,l=[],c=!r.maxTimeAxisUnit||DateHelper.compareUnits(a.unit,r.maxTimeAxisUnit)<=0,d=t?i:n;if(!r.disabled&&c){const n=a.first.durationMS;if(!d.has(o.id)){const i=o.effectiveCalendar,a=!t||o.isScheduled?i.getNonWorkingTimeRanges(t?o.startDate:s.startDate,t?o.endDate:s.endDate):[],l=[];for(let s=0;s<a.length;s++){const c=a[s];c.endDate-c.startDate>=n&&l.push(r.createIntervalDOMConfig({id:"r"+o.id+"i"+s,iconCls:c.iconCls||i.iconCls||"",cls:(i.cls?i.cls+" ":"")+(c.cls||""),startDate:c.startDate,endDate:c.endDate,name:c.name,isNonWorking:!0},e,t))}d.set(o.id,l)}l.push(...ObjectHelper.clone(d.get(o.id)))}return l}createIntervalDOMConfig(e,t,r=!1){const{client:n}=this,{taskRecord:i}=t,{cls:s,iconCls:a,name:o,startDate:l,endDate:c}=e,d=n.getCoordinateFromDate(l)-(r?t.left:0),u=n.getCoordinateFromDate(c)-d-(r?t.left:0);return{className:{"b-tasknonworkingtime":1,[s]:1},style:{left:d,top:r?null:n.store.indexOf(i)*n.rowManager.rowOffsetHeight,height:r?null:n.rowHeight,width:r&&u+d>t.width?t.width-d:u},children:[a?{tag:"i",className:a}:null,o],dataset:{taskId:e.id},elementData:{taskRecord:i,interval:e}}}changeTooltip(e,t){const r=this;return null==t||t.destroy(),r.tooltipTemplate&&e?Tooltip.new({align:"b-t",forSelector:".b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .b-sch-foreground-canvas > .b-tasknonworkingtime",forElement:r.client.timeAxisSubGridElement,showOnHover:!0,hideDelay:0,anchorToTarget:!0,trackMouse:!1,getHtml:({activeTarget:e})=>{const{taskRecord:t,interval:n}=e.elementData;return r.tooltipTemplate({taskRecord:t,...n})}},e):null}handleMouseEvent(e){const t=e.target.closest(".b-tasknonworkingtime"),{taskRecord:r,interval:n}=t.elementData;this.client.trigger("taskNonWorkingTime"+casedEventName[e.type],{feature:this,taskRecord:r,interval:n,domEvent:e})}};__publicField(TaskNonWorkingTime,"$name","TaskNonWorkingTime"),__publicField(TaskNonWorkingTime,"configurable",{idPrefix:"TaskNonWorkingTime",maxTimeAxisUnit:"week",tooltipTemplate:null,tooltip:{},mode:"row"}),__publicField(TaskNonWorkingTime,"pluginConfig",{chain:["onTaskDataGenerated","onPaint"]}),__publicField(TaskNonWorkingTime,"featureClass",""),TaskNonWorkingTime._$name="TaskNonWorkingTime",GridFeatureManager.registerFeature(TaskNonWorkingTime,!1,"Gantt");var TaskResize=class extends EventResize2{static get $name(){return"TaskResize"}static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,pinSuccessors:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable"]}}onDragItemMouseMove(){this[(this.client.rtl?"right":"left")+"Handle"]=!1,super.onDragItemMouseMove(...arguments)}changePinSuccessors(e){return EventHelper.toSpecialKey(e)}isTaskElementDraggable(e,t,r,n){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,t){var r;const n=this.client,i=n.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:i,eventRecord:i,dateConstraints:null==(r=n.getDateConstraints)?void 0:r.call(n,i)})}async internalUpdateRecord(e,t){const{client:r}=this,{generation:n}=t,{startDate:i,endDate:s}=e,a={endDate:s};e.duration=a.duration=t.run("calculateProjectedDuration",i,s);const o=a[e.toSet]=t.run("calculateProjectedXDateWithDuration",i,!0,e.duration);return t.set(a),r.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),this.pinSuccessors&&e.event[this.pinSuccessors]?await t.setEndDatePinningSuccessors(o):await t.setEndDate(o,!1),t.endBatch(),t.generation!==n}};TaskResize._$name="TaskResize",GridFeatureManager.registerFeature(TaskResize,!0,"Gantt");var TaskSegmentDrag=class extends TaskDrag{static get configurable(){return{capitalizedEventName:"TaskSegment"}}static get pluginConfig(){return{chain:["onPaint","isTaskElementDraggable"]}}isTaskElementDraggable(e,t,r,n){return!(!this.disabled&&(t.isEventSegment||t.isSegmented))||!r.closest(this.drag.targetSelector)}triggerBeforeEventDrag(e,t){return this.client.trigger("beforeTaskSegmentDrag",t)}triggerBeforeEventDropFinalize(e,t,r){r.trigger("before"+this.capitalizedEventName+"DropFinalize",t)}triggerEventDrag(e,t){this.client.trigger("taskSegmentDrag",{taskRecords:e.draggedEntities,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}triggerDragStart(e){this.client.trigger("taskSegmentDragStart",{taskRecords:e.draggedEntities,dragData:e})}triggerDragAbort(e){this.client.trigger("taskSegmentDragAbort",{taskRecords:e.draggedEntities,context:e})}triggerDragAbortFinalized(e){this.client.trigger("taskSegmentDragAbortFinalized",{taskRecords:e.draggedEntities,context:e})}triggerAfterDrop(e,t){this.currentOverClient.trigger("afterTaskSegmentDrop",{taskRecords:e.draggedEntities,context:e,valid:t})}onInternalInvalidDrop(e){super.onInternalInvalidDrop(...arguments),this.dragData.mainTaskElement.style.width=this.dragData.initialMainTaskElementWidth+"px"}buildDragHelperConfig(){const e=super.buildDragHelperConfig();return e.targetSelector=".b-sch-event-segment:not(.b-first)",e}getTaskScheduleRegion(e,t){const{client:r}=this,n=r.getElementFromTaskRecord(e.event),i=Rectangle.from(n,r.timeAxisSubGridElement),s=this.client.getScheduleRegion(e.event,!0,t);return s.translate(-i.x),s}setupProductDragData(e){const t=super.setupProductDragData(e);return t.mainTaskElement=this.client.getElementFromTaskRecord(t.record.event,!1),t.initialMainTaskElementWidth=parseFloat(t.mainTaskElement.style.width),t}updateDragContext(e,t){super.updateDragContext(...arguments);const{dirty:r,record:n,mainTaskElement:i,initialMainTaskElementWidth:s}=this.dragData;r&&!n.nextSegment&&(i.style.width=s+e.clientX-e.startClientX+"px")}get tipId(){return this.client.id+"-task-segment-drag-tip"}async updateRecords(e){const{startDate:t,draggedEntities:[r]}=e,n=r.startDate;r.isEventSegment&&(await r.setStartDate(t,!0),r.startDate-n?this.client.trigger("taskSegmentDrop",{taskRecords:e.draggedEntities}):this.dragData.valid=!1)}getDateConstraints(e){const t=super.getDateConstraints(e)||{};let{minDate:r,maxDate:n}=t;return e.previousSegment&&(!r||r<e.previousSegment.endDate)&&(r=e.previousSegment.endDate),e.nextSegment&&(!n||n<e.nextSegment.startDate)&&(n=e.nextSegment.startDate),(r||n)&&{start:r,end:n}}};__publicField(TaskSegmentDrag,"$name","TaskSegmentDrag"),TaskSegmentDrag._$name="TaskSegmentDrag",GridFeatureManager.registerFeature(TaskSegmentDrag,!0,"Gantt");var TaskSegmentResize=class extends EventSegmentResize{static get configurable(){return{draggingItemCls:"b-sch-event-resizing",resizingItemInnerCls:null,leftHandle:!1}}static get pluginConfig(){return{chain:["render","onEventDataGenerated","isTaskElementDraggable","isTaskSegmentElementDraggable"]}}isTaskElementDraggable(e,t,r,n){return this.isEventElementDraggable(...arguments)}isTaskSegmentElementDraggable(e,t,r,n){return this.isEventElementDraggable(...arguments)}checkValidity(){return this.basicValidityCheck(...arguments)}getBeforeResizeParams(e){return{}}setupProductResizeContext(e,t){var r;const n=this.client,i=n.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:i,eventRecord:i,dateConstraints:null==(r=n.getDateConstraints)?void 0:r.call(n,i)})}async internalUpdateRecord(e,t){const{client:r}=this,{generation:n}=t,{startDate:i,endDate:s}=e,a={endDate:s};e.duration=a.duration=t.run("calculateProjectedDuration",i,s);const o=a[e.toSet]=t.run("calculateProjectedXDateWithDuration",i,!0,e.duration);return t.set(a),r.endListeningForBatchedUpdates(),this.cancelEventRecordBatch(t),this.pinSuccessors&&e.event[this.pinSuccessors]?await t.setEndDatePinningSuccessors(o):await t.setEndDate(o,!1),t.endBatch(),t.generation!==n}get tipId(){return this.client.id+"-task-segment-resize-tip"}};__publicField(TaskSegmentResize,"$name","TaskSegmentResize"),TaskSegmentResize._$name="TaskSegmentResize",GridFeatureManager.registerFeature(TaskSegmentResize,!0,"Gantt");var TaskTooltip=class extends TooltipBase{static get $name(){return"TaskTooltip"}static get defaultConfig(){return{template(e){const t=this,{taskRecord:r}=e,n=t.client.formatDuration(r.duration,t.decimalPrecision);return(r.name?'<div class="b-gantt-task-title">'+StringHelper.encodeHtml(r.name)+"</div>":"")+"<table><tr><td>"+t.L("L{Start}")+":</td><td>"+e.startClockHtml+"</td></tr><tr><td>"+t.L("L{End}")+":</td><td>"+e.endClockHtml+"</td></tr><tr><td>"+t.L("L{Duration}")+':</td><td class="b-right">'+n+" "+DateHelper.getLocalizedNameOfUnit(r.durationUnit,1!==r.duration)+"</td></tr><tr><td>"+t.L("L{Complete}")+':</td><td class="b-right">'+r.renderedPercentDone+"%</td></tr></table>"},decimalPrecision:null,cls:"b-gantt-task-tooltip",monitorRecordUpdate:!0}}};TaskTooltip._$name="TaskTooltip",GridFeatureManager.registerFeature(TaskTooltip,!0,"Gantt");var TreeGroup2=class extends(TreeGroup.mixin(AttachToProjectMixin_default,Delayable_default)){updateParents(e){var t;(null==(t=e.children)?void 0:t.length)&&WalkHelper.postWalk(e,(e=>{var t;return!(null==(t=e.children)?void 0:t[0].isLeaf)&&e.children}),(e=>{const{children:t}=e;let r=t[0].startDate,n=t[0].endDate,i=0;for(const e of t)e.startDate&&(r=Math.min(e.startDate,r||Number.MAX_SAFE_INTEGER)),e.endDate&&(n=Math.max(e.endDate,n)),i+=e.percentDone;e.startDate=new Date(r),e.endDate=new Date(n),e.duration=this.client.project.taskStore.rootNode.run("calculateProjectedDuration",e.startDate,e.endDate),e.percentDone=i/t.length}))}processTransformedData(e){this.updateParents(e)}onTaskStoreChange({action:e,records:t}){if(t.some((e=>e.isLeaf))&&"dataset"!==e){const{client:e}=this;e.suspendRefresh(),this.updateParents(e.store.rootNode),e.resumeRefresh(),this.refresh()}}refresh(){this.client.refreshWithTransition()}async applyLevels(e){this.detachListeners("taskStore"),await super.applyLevels(e),this.isDestroyed||e&&this.client.taskStore.ion({name:"taskStore",change:"onTaskStoreChange",thisObj:this})}};__publicField(TreeGroup2,"$name","TreeGroup"),__publicField(TreeGroup2,"delayable",{refresh:"raf"}),TreeGroup2._$name="TreeGroup",GridFeatureManager.registerFeature(TreeGroup2,!1,"Gantt");var GanttVersions=class extends Versions{construct(e,t){super.construct(e,t),e.ion({taskMenuItem:({item:e,selection:t})=>{const r=this,n=t.length>1;"deleteTask"===e.ref?r.transactionDescription=n?r.L("L{Versions.deletedTasks}"):r.L("L{Versions.deletedTask}"):"indent"===e.ref?r.transactionDescription=r.L("L{Versions.indented}"):"outdent"===e.ref?r.transactionDescription=r.L("L{Versions.outdented}"):"cut"===e.ref?r.transactionDescription=r.L("L{Versions.cut}"):"paste"===e.ref&&(r.transactionDescription=r.L("L{Versions.pasted}"))}})}};__publicField(GanttVersions,"$name","Versions"),__publicField(GanttVersions,"configurable",{knownBaseTypes:[TaskModel,...Versions.configurable.knownBaseTypes]}),GanttVersions._$name="GanttVersions",GridFeatureManager.registerFeature(GanttVersions,!1,"Gantt");var BASELINE_RATIO=.4,GanttExporterMixin_default=e=>class extends e{async prepareComponent(e){await super.prepareComponent(e);const t=this.element.querySelector(".b-sch-foreground-canvas");DomHelper.removeEachSelector(t,".b-gantt-task-wrap"),DomHelper.removeEachSelector(t,".b-released")}collectEvents(e,t){const r=e.length,{client:n}=t,i=this.exportMeta.subGrids.normal.rows;e.forEach(((e,t)=>{const s=i[i.length-r+t],a=n.store.getAt(e.dataIndex),o=s[3];if(a.isScheduled){const e=n.getElementFromTaskRecord(a,!1);e&&!o.has(a.id)&&o.set(a.id,[e.outerHTML,Rectangle.from(e.firstChild,e.offsetParent)])}}))}renderEvents(e,t){const{client:r}=e,n=r.hasActiveFeature("baselines"),i=this.exportMeta.subGrids.normal.rows,s=this.exportMeta.topRowOffset=t[0].top-t[0].dataIndex*t[0].offsetHeight;t.forEach(((e,t)=>{const a=i[t][3],o=r.store.getAt(e.dataIndex),l=r.currentOrientation.getTaskRenderData(e,o),{taskId:c}=l;if(l.top+=s,l.isTask){const e=r.currentOrientation.getTaskDOMConfig(l),t=document.createElement("div"),{isMilestone:i}=o,s=o.baselines.count;DomSync.sync({targetElement:t,domConfig:e});let{left:d,top:u,width:h,height:g}=l;i&&(d-=g/2,h=g),a.set(c,[t.outerHTML,new Rectangle(d,u,h,g*(n&&s?BASELINE_RATIO:1)),[]])}if(l.extraConfigs.length){const e=document.createElement("div"),t=[];for(const r of l.extraConfigs)DomSync.sync({targetElement:e,domConfig:r}),t.push(e.outerHTML);a.has(c)||a.set(c,["",null,[]]),a.get(c)[2]=t}}))}getEventBox(e){if(!e)return;let t=this.exportMeta.eventsBoxes.get(String(e.id));if(!t){const{client:r}=this.exportMeta,n=r.getCoordinateFromDate(e.startDate),i=r.getCoordinateFromDate(e.endDate),{rows:s}=this.exportMeta.subGrids.normal,[a,o,l]=s[0],[,c]=s[s.length-1],d=parseInt(a.match(/data-index="(\d+)?"/)[1]),u=r.taskStore.indexOf(e);t=new Rectangle(n,u<d?o-l:c+l,i-n,l)}return t}},MultiPageExporter3=class extends(GanttExporterMixin_default(MultiPageExporter2)){static get $name(){return"MultiPageExporter"}static get type(){return"multipage"}};MultiPageExporter3._$name="MultiPageExporter";var MultiPageVerticalExporter3=class extends(GanttExporterMixin_default(MultiPageVerticalExporter2)){static get $name(){return"MultiPageVerticalExporter"}static get type(){return"multipagevertical"}};MultiPageVerticalExporter3._$name="MultiPageVerticalExporter";var SinglePageExporter3=class extends(GanttExporterMixin_default(SinglePageExporter2)){static get $name(){return"SinglePageExporter"}static get type(){return"singlepage"}};SinglePageExporter3._$name="SinglePageExporter";var PdfExport3=class extends PdfExport2{static get $name(){return"PdfExport"}static get defaultConfig(){return{exporters:[SinglePageExporter3,MultiPageExporter3,MultiPageVerticalExporter3]}}};PdfExport3._$name="PdfExport",GridFeatureManager.registerFeature(PdfExport3,!1,"Gantt");var CalendarIntervalModel2=class extends CalendarIntervalModel{};CalendarIntervalModel2._$name="CalendarIntervalModel";var ProjectModel3=class extends(GanttProjectMixin.derive(Model).mixin(ProjectChangeHandlerMixin_default,ProjectCurrentConfig_default,ProjectCrudManager_default2,ProjectModelTimeZoneMixin_default,ProjectModelCommon_default)){static get defaults(){return{expanded:!0}}static get defaultConfig(){return{projectConstraintIntervalClass:ProjectConstraintInterval,dateConstraintIntervalClass:DateConstraintInterval,dependencyConstraintIntervalClass:DependencyConstraintInterval,taskModelClass:TaskModel,dependencyModelClass:DependencyModel3,resourceModelClass:ResourceModel3,assignmentModelClass:AssignmentModel3,calendarModelClass:CalendarModel2,taskStoreClass:TaskStore,dependencyStoreClass:DependencyStore3,resourceStoreClass:ResourceStore3,assignmentStoreClass:AssignmentStore3,calendarManagerStoreClass:CalendarManagerStore2,tasksData:null,eventsData:null,dependenciesData:null,resourcesData:null,assignmentsData:null,calendarsData:null,timeRangeStore:{modelClass:TimeSpan,storeId:"timeRanges"},convertEmptyParentToLeaf:!1,supportShortSyncResponseNote:"Note: ",delayCalculation:!0,eventStore:{},assignmentStore:{},resourceStore:{},dependencyStore:{},calendarManagerStore:{},stmClass:StateTrackingManager2}}static get configurable(){return{tasks:null,resources:null,assignments:null,dependencies:null,timeRanges:null,calendars:null,timeRangesData:null,syncDataOnLoad:null,ignoreRemoteChangesInSTM:!1}}construct(...e){const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||this.getDefaultConfiguration().taskModelClass||this.defaultEventModelClass,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||this.getDefaultConfiguration().taskStoreClass||this.defaultEventStoreClass,super.construct(...e)}attachStore(e){this.syncDataOnLoad&&(e.syncDataOnLoad=this.syncDataOnLoad),e.ion({name:e.$$name,change:"relayStoreChange",thisObj:this})}detachStore(e){e&&this.detachListeners(e.$$name)}relayStoreChange(e){return super.relayStoreChange(e),this.trigger("change",{store:e.source,...e,source:this})}get defaultEventModelClass(){return TaskModel}get defaultEventStoreClass(){return TaskStore}set taskStore(e){this.eventStore=e}get taskStore(){return this.eventStore}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){const t=this;t.detachStore(t._timeRangeStore),t._timeRangeStore=Store.getStore(e,Store),t._timeRangeStore.storeId||(t._timeRangeStore.storeId="timeRanges"),t.attachStore(t._timeRangeStore)}async tryInsertChild(){return this.tryPropagateWithChanges((()=>{this.insertChild(...arguments)}))}toJSON(){return{eventsData:this.eventStore.toJSON(),resourcesData:this.resourceStore.toJSON(),dependenciesData:this.dependencyStore.toJSON(),assignmentsData:this.assignmentStore.toJSON()}}get json(){return super.json}set json(e){"string"==typeof e&&(e=StringHelper.safeJsonParse(e)),this.loadInlineData(e)}get tasks(){return this.taskStore.allRecords}updateTasks(e){this.taskStore.data=e}get calendars(){return this.calendarManagerStore.allRecords}updateCalendars(e){this.calendarManagerStore.data=e}updateTimeRangesData(e){this.timeRangeStore.data=e}get inlineData(){return this.toJSON()}set inlineData(e){this.json=e}afterChange(e,t){super.afterChange(...arguments),t.calendar&&this.trigger("calendarChange")}refreshWbs(e){var t,r;const n=this,i=null!=(t=n.unfilteredChildren)?t:n.children;(null==i?void 0:i.length)&&(null==(r=i[0].refreshWbs)||r.call(n,e,-1))}};__publicField(ProjectModel3,"$name","ProjectModel"),ProjectModel3.applyConfigs=!0,ProjectModel3._$name="ProjectModel";var WebSocketProjectModel=class extends(ProjectWebSocketHandlerMixin_default(ProjectModel3)){};__publicField(WebSocketProjectModel,"$name","WebSocketProjectModel"),WebSocketProjectModel._$name="WebSocketProjectModel";var year=(new Date).getFullYear(),earlyMondayThisYear=DateHelper.add(DateHelper.startOf(new Date(year,0,5),"week"),1-DateHelper.weekStartDay,"day"),rnd=new RandomGenerator;function getNum(e,t){return parseInt(""+e+t)}var ProjectGenerator=class{static async generateAsync(e,t,r=null,n=earlyMondayThisYear,i=!0){const s={startDate:n,tasksData:[],dependenciesData:[]},a=Math.ceil(e/10),o=Math.ceil(t/10),l=this.generateBlocks(a,o,s.startDate);let c=0,d=0,u=0,h=0;i&&console.time("generate");for(const e of l)s.tasksData.push(...e.tasksData),s.dependenciesData.push(...e.dependenciesData),e.projectDuration&&(d=Math.max(e.projectDuration,d)),u+=e.taskCount,h+=e.dependencyCount,++c%1e3==0&&(null==r||r(u,h,!1),await AsyncHelper.animationFrame());return null==r||r(u,h,!0),s.endDate=DateHelper.add(s.startDate,Math.max(d,30),"days"),i&&console.timeEnd("generate"),s}static*generateBlocks(e,t,r){let n=1,i=1,s=0,a=0,o=0,l=0,c=r,d=0;function u(e=!0,t=!1){const r=rnd.nextRandom(5)+2;return e&&(a+=r),t&&(o=0),o+=r,l=r,r}function h(e=l){return c=DateHelper.add(c,e,"days"),c}function g(){return DateHelper.add(c,l,"days")}function p(e){d=0;for(const t of e)d+=t.duration*t.percentDone;return e}for(let r=0;r<e;r++){const e=n,c={tasksData:[{id:n++,name:"Parent "+e,startDate:h(r>0?l:0),expanded:!0,inactive:!1,children:[{id:n++,name:"Sub-parent "+getNum(e,1),startDate:h(0),expanded:!0,inactive:!1,children:p([{id:n++,name:"Task "+getNum(e,11),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1},{id:n++,name:"Task "+getNum(e,12),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1},{id:n++,name:"Task "+getNum(e,13),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1},{id:n++,name:"Task "+getNum(e,14),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:d/o,endDate:g()},{id:n++,name:"Sub-parent "+getNum(e,2),startDate:h(),expanded:!0,inactive:!1,children:p([{id:n++,name:"Task "+getNum(e,21),startDate:h(0),duration:u(!0,!0),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1},{id:n++,name:"Task "+getNum(e,22),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1},{id:n++,name:"Task "+getNum(e,23),startDate:h(),duration:u(),effort:l,effortUnit:"day",endDate:g(),percentDone:rnd.nextRandom(100),inactive:!1}]),duration:o,effort:o,effortUnit:"day",percentDone:d/o,endDate:g()}],duration:a,effort:a,effortUnit:"day",endDate:g()}],dependenciesData:[{id:i++,fromEvent:e+2,toEvent:e+3},{id:i++,fromEvent:e+3,toEvent:e+4},{id:i++,fromEvent:e+4,toEvent:e+5},{id:i++,fromEvent:e+5,toEvent:e+7},{id:i++,fromEvent:e+7,toEvent:e+8},{id:i++,fromEvent:e+8,toEvent:e+9}],taskCount:10,dependencyCount:5},m=c.tasksData[0],f=m.children[0],v=m.children[1];m.percentDone=(f.duration*f.percentDone+v.duration*v.percentDone)/m.duration,s+=a,a=0,c.projectDuration=s,r%t!=0?(c.dependenciesData.push({id:i++,fromEvent:e-2,toEvent:e+2,type:2,lag:0,lagUnit:"d"}),c.dependencyCount++):s=0,n++,yield c}}};ProjectGenerator._$name="ProjectGenerator";var{defineParser:defineParser2,alt:alt2,seq:seq2,string:string2,regexp:regexp2,succeed:succeed2,red:red2,isSuccess:isSuccess2}=Parser_default,resourceNamePEG=defineParser2(red2(regexp2("[^[,]+"),(e=>({resourceName:e.trim(),units:100,match:e})))),integerPEG=defineParser2(red2(regexp2("[0-9s]+"),(e=>({value:e.split(/\s*/).join(""),match:e})))),decimalSeparatorPEG=defineParser2(red2(alt2(string2("."),string2(",")),(e=>({value:e,match:e})))),unitsNumberPEG=defineParser2(alt2(red2(seq2((()=>integerPEG),(()=>decimalSeparatorPEG),(()=>integerPEG)),((e,t,r)=>({value:Number(e.value+"."+r.value),match:[e.match,t.match,r.match].join("")}))),red2(seq2((()=>decimalSeparatorPEG),(()=>integerPEG)),((e,t)=>({value:Number("0."+t.value),match:[e.match,t.match].join("")}))),red2((()=>integerPEG),(e=>({value:Number(""+e.value),match:e.match}))))),unitsPersentagePEG=defineParser2(alt2(red2(seq2((()=>unitsNumberPEG),regexp2("s*%")),((e,t)=>({value:e.value,match:[e.match,t].join("")}))),red2((()=>unitsNumberPEG),(e=>({value:e.value,match:e.match}))))),unitsDesignationPEG=defineParser2(red2(seq2(regexp2("\\s*\\[\\s*"),(()=>unitsPersentagePEG),regexp2("s*]")),((e,t,r)=>({units:t.value,match:[e,t.match,r].join("")})))),commaPEG=defineParser2(red2(regexp2("s*,s*"),(e=>({value:e,match:e})))),raPEG=defineParser2(alt2(seq2((()=>resourceNamePEG),(()=>unitsDesignationPEG),alt2(seq2((()=>commaPEG),(()=>raPEG)),succeed2(""))),seq2((()=>resourceNamePEG),alt2(seq2((()=>commaPEG),(()=>raPEG)),succeed2(""))))),parse=e=>{let t=!1,r=[],n="";raPEG(e,(e=>{if(isSuccess2(e)){const[,i,s]=e;i.length>r.length&&(r=i,n=s,t=!0)}}));let i=0;return!!t&&{rest:n,assignments:r.reduce(((e,t)=>{let r;return"object"==typeof t&&(Object.prototype.hasOwnProperty.call(t,"resourceName")?(r=Object.assign({position:i},t),e.push(r)):(r=e[e.length-1],Object.prototype.hasOwnProperty.call(t,"units")&&(r.units=t.units),r.match+=t.match),i+=t.match.length),e}),[])}},compose=(e,t=!1)=>{let r="";return e.assignments&&(r+=e.assignments.reduce(((e,{resourceName:r,units:n,match:i})=>e+=i&&t?i:(e.length?", ":"")+r+" ["+n+"%]"),r)),e.rest&&(r+=e.rest),t||(r=r.trim()),r},normalize=e=>compose(parse(e)),ResourceAssignmentParser_default={parse:parse,compose:compose,normalize:normalize},MIN_DATE2=DateHelper.clearTime(new Date(1900,5,15)),taskUnitMap={minute:3,hour:5,day:7,week:9,month:11},projectUnitMap={minute:1,hour:2,day:3,week:4,month:5},constraintMap={finishnoearlierthan:6,finishnolaterthan:7,mustfinishon:3,muststarton:2,startnoearlierthan:4,startnolaterthan:5},typeMap={FixedDuration:1,FixedUnits:0,FixedEffort:2,Normal:0},dependencyTypeMap={0:3,1:2,2:1,3:0},_MspExport=class extends InstancePlugin{constructor(){super(...arguments),__publicField(this,"resourceCalendar",new Map)}generateExportData(){const e=this;return e.tasks=e.collectProjectTasks(),{...e.getMsProjectConfig(),Calendars:{Calendar:e.getCalendarsData()},Tasks:{Task:e.getTasksData()},Resources:{Resource:e.getResourcesData()},Assignments:{Assignment:e.getAssignmentsData()}}}export(e={}){const t=this;if(!t.disabled&&(t.resourceCalendar.clear(),(e=ObjectHelper.assign({},t.config,e)).filename||(e.filename=t.client.$$name+".xml"),!1!==t.client.trigger("beforeMspExport",{config:e}))){const r=t.generateExportData(e);t.trigger("dataCollected",{config:e,data:r});const n={config:e,data:r,fileContent:t.convertToXml(r)};t.client.trigger("mspExport",n),BrowserHelper.download(e.filename,"data:text/xml;charset=utf-8,"+encodeURIComponent(n.fileContent))}}convertToXml(e){return XMLHelper.convertFromObject(e,{rootName:"Project",elementName:"",xmlns:"http://schemas.microsoft.com/project",rootElementForArray:!1})}getMsProjectConfig(){const e=this,t=e.dateFormat,{project:r}=e.client,n=e.filename||e.client.$$name;return{CalendarUID:e.getCalendarUID(r.effectiveCalendar),CreationDate:DateHelper.format(new Date,t),SplitsInProgressTasks:0,MoveCompletedEndsBack:0,MoveRemainingStartsBack:0,MoveRemainingStartsForward:0,MoveCompletedEndsForward:0,NewTaskStartDate:0,DaysPerMonth:r.daysPerMonth,FinishDate:DateHelper.format(r.endDate,t),MinutesPerDay:60*r.hoursPerDay,MinutesPerWeek:r.daysPerWeek*r.hoursPerDay*60,Name:n,ScheduleFromStart:"Forward"===r.direction?1:0,StartDate:DateHelper.format(r.startDate,t),Title:n,WorkFormat:projectUnitMap[r.effortUnit],ProjectExternallyEdited:0}}getCalendarsData(){const e=this,{calendarManagerStore:t,project:r}=e.client,{effectiveCalendar:n}=r,i=t.allRecords||[];return t.getByInternalId(n.internalId)||i.push(n),e.client.resources.forEach((t=>{const r=new t.effectiveCalendar.constructor({name:t.name});r.parent=t.effectiveCalendar,r.isResourceCalendar=!0,e.resourceCalendar.set(t,r),i.push(r)})),i.map((t=>{const r=e.getCalendarUID(t);let n=t.name||t.internalId,i=0,s=0;return t.isResourceCalendar?i=e.getCalendarUID(t.parent,0):(n+=" - imported",s=1),{ID:r,UID:r,BaseCalendarUID:i,IsBaseCalendar:s,Name:n,WeekDays:{WeekDay:e.formatWeekDays(t)}}}))}formatWeekDays(e){const{timeFormat:t}=this,r=[],n={};let i,s=MIN_DATE2;for(let e=0;e<7;e++){const e=s.getDay();n[e]={DayType:e+1,DayWorking:0},i=DateHelper.clearTime(DateHelper.add(s,1,"day")),r.push({startDate:s,endDate:i}),s=i}const a=new((e=e.copy()).constructor)({intervals:r});return this.client.project.combineCalendars([e,a]).forEachAvailabilityInterval({startDate:MIN_DATE2,endDate:i},((r,i,s)=>{const a=s.getCalendarsWorkStatus(),o=n[r.getDay()];a.get(e)&&(o.DayWorking=1,o.WorkingTimes=o.WorkingTimes||{WorkingTime:[]},o.WorkingTimes.WorkingTime.push({FromTime:DateHelper.format(r,t),ToTime:DateHelper.format(i,t)}))})),Object.values(n)}collectProjectTasks(){const e=[];return this.client.store.rootNode.traverse((t=>e.push(t)),!0),e}getTasksData(){const e=this,{project:t}=e.client,r="Forward"==t.direction,{dateFormat:n,tasks:i}=e;return i.map((i=>{const{startDate:s,endDate:a,wbsCode:o}=i,l=i.predecessors.filter((({fromEvent:e})=>e)),c=t.convertDuration(i.duration,i.durationUnit,"millisecond"),d=t.convertDuration(i.effort,i.effortUnit,"millisecond"),u=.01*i.percentDone*c,h=DateHelper.format(s,n),g=DateHelper.format(a,n),p=_MspExport.convertDurationToMspDuration(c,"ms"),m={UID:e.getTaskUID(i),Name:i.name,Active:e.inactive?0:1,Manual:i.manuallyScheduled?1:0,Type:i.isLeaf?typeMap[i.schedulingMode]:1,IsNull:s&&a?0:1,WBS:o,OutlineNumber:o,OutlineLevel:o.split(".").length,Start:h,Finish:g,Duration:p,ManualStart:h,ManualFinish:g,ManualDuration:p,DurationFormat:taskUnitMap[i.durationUnit],Work:_MspExport.convertDurationToMspDuration(d,"ms"),EffortDriven:i.effortDriven?1:0,Estimated:0,Milestone:i.isMilestone?1:0,Summary:i.isLeaf?0:1,PercentComplete:Math.round(i.percentDone),ActualStart:h,ActualDuration:_MspExport.convertDurationToMspDuration(u,"ms"),RemainingDuration:_MspExport.convertDurationToMspDuration(c-u,"ms"),PredecessorLink:l.map((r=>({LagFormat:taskUnitMap[r.lagUnit],LinkLag:10*t.convertDuration(r.lag,r.lagUnit,"minute"),PredecessorUID:e.getTaskUID(r.fromEvent),Type:dependencyTypeMap[r.type]}))),Baseline:i.baselines.map(((e,t)=>({Number:t,Finish:DateHelper.format(e.endDate,n),Start:DateHelper.format(e.startDate,n),Duration:_MspExport.convertDurationToMspDuration(e.duration,e.durationUnit)}))),IgnoreResourceCalendar:i.ignoreResourceCalendar?1:0,Rollup:i.rollup?1:0,ConstraintType:i.constraintType?constraintMap[i.constraintType]:r?0:1,CalendarUID:e.getCalendarUID(i.calendar)};return i.constraintDate&&(m.ConstraintDate=DateHelper.format(i.constraintDate,n)),i.deadlineDate&&(m.Deadline=DateHelper.format(i.deadlineDate,n)),i.note&&(m.Notes=i.note),m}))}getTaskUID(e){return e.internalId}getCalendarUID(e,t=-1){return e&&!e.isRoot?e.internalId:t}getResourcesData(){return this.client.resources.map((e=>({UID:e.internalId,Name:e.name,Type:1,MaxUnits:"1.00",PeakUnits:"1.00",CalendarUID:2013===this.msProjectVersion?null:this.getCalendarUID(this.resourceCalendar.get(e))})))}getAssignmentsData(){const e=[];if(2013===this.msProjectVersion)return e;const{project:t}=this.client;for(const r of this.tasks){const n=r.assigned,i=this.getTaskUID(r),s=Math.round(r.percentDone),a=DateHelper.format(r.startDate,this.dateFormat),o=DateHelper.format(r.endDate,this.dateFormat);if(n.size)for(const l of n){const n=t.convertDuration(l.effort,r.effortUnit,"millisecond"),c=t.convertDuration(l.actualEffort,r.effortUnit,"millisecond"),d=n-c;e.push({UpdateNeeded:0,UID:l.internalId,TaskUID:i,ResourceUID:l.resource.internalId,PercentWorkComplete:s,Work:_MspExport.convertDurationToMspDuration(n,"ms"),ActualWork:_MspExport.convertDurationToMspDuration(c,"ms"),RemainingWork:_MspExport.convertDurationToMspDuration(d,"ms"),Start:a,Finish:o,Units:l.units/100})}else{const n=t.convertDuration(r.effort,r.effortUnit,"millisecond"),l=n*s*.01,c=_MspExport.convertDurationToMspDuration(n,"ms");e.push({UID:Model._internalIdCounter++,TaskUID:i,ResourceUID:-65535,PercentWorkComplete:s,ActualWork:_MspExport.convertDurationToMspDuration(l,"ms"),RemainingWork:_MspExport.convertDurationToMspDuration(n-l,"ms"),Start:a,Finish:o,Units:1,Work:c})}}return e}static convertDurationToMspDuration(e,t){if(null==e)return"";const r=DateHelper.getDelta(DateHelper.as("ms",e,t),{ignoreLocale:!0,maxUnit:"hour"}),{hour:n=0,minute:i=0,second:s=0}=r;return"PT"+n+"H"+i+"M"+s+"S"}},MspExport=_MspExport;__publicField(MspExport,"$name","MspExport"),__publicField(MspExport,"configurable",{filename:null,dateFormat:"YYYY-MM-DDTHH:mm:ss",timeFormat:"HH:mm:ss",msProjectVersion:2019}),MspExport._$name="MspExport",GridFeatureManager.registerFeature(MspExport,!1,"Gantt");var hyphenRe=/-/g,GanttDom_default=e=>class extends(e||Base){static get $name(){return"GanttDom"}resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){const t=e.closest(this.eventSelector);return t?this.store.getById(t.dataset.taskId):this.getRecordFromElement(e)}resolveRowRecord(e){return this.resolveTaskRecord(e)}onElementKeyDown(e){const t=this.resolveTaskRecord(e.target);super.onElementKeyDown(e),t&&this.trigger("taskKeyDown",{taskRecord:t,event:e})}onElementKeyUp(e){const t=this.resolveTaskRecord(e.target);super.onElementKeyUp(e),t&&this.trigger("taskKeyUp",{taskRecord:t,event:e})}getElementFromTaskRecord(e,t=!0){return this.taskRendering.getElementFromTaskRecord(e,t)}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return this.id.toString().replace(hyphenRe,"_")+"-"+e.id}getEventData(e){const t=this,r=t.resolveTimeSpanRecord(e.target);if(r){const e=t.getCell({record:r,column:t.timeAxisColumn}),n=DomDataStore.get(e),i=n.id,s=n.columnId;return{cellElement:e,cellData:n,columnId:s,id:i,record:r,cellSelector:{id:i,columnId:s}}}return super.getEventData(e)}get widgetClass(){}},GanttRegions_default=e=>class extends(e||Base){static get $name(){return"GanttRegions"}getScheduleRegion(e,t=!0,r){var n;const i=this,{timeAxisSubGridElement:s,timeAxis:a}=i;let o;if(e){const t=i.getElementFromTaskRecord(e),r=i.getRowById(e.id);if(!r)return null;if(o=Rectangle.from(r.getElement("normal"),s),t){const e=Rectangle.from(t,s);o.y=e.y,o.bottom=e.bottom}else o.y+=i.barMargin,o.bottom-=i.barMargin}else o=Rectangle.from(s).moveTo(null,0),o.width=s.scrollWidth,o.y=o.y+i.barMargin,o.bottom=o.bottom-i.barMargin;const l=a.startDate,c=a.endDate,{start:d,end:u}=r||{};if(d&&u&&!a.timeSpanInAxis(d,u))return null;d||u||(r=(null==(n=i.getDateConstraints)?void 0:n.call(i,e))||{start:l,end:c});let h=i.getCoordinateFromDate(r.start?DateHelper.max(l,r.start):l),g=i.getCoordinateFromDate(r.end?DateHelper.min(c,r.end):c);return t||(h=i.translateToPageCoordinate(h),g=i.translateToPageCoordinate(g)),o.x=Math.min(h,g),o.width=Math.max(h,g)-Math.min(h,g),o}translateToPageCoordinate(e){const t=this.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,t=!1,r=!1){return this.taskRendering.getTaskBox(...arguments)}getSizeAndPosition(){return this.taskRendering.getSizeAndPosition(...arguments)}get widgetClass(){}},defaultScrollOptions6={block:"nearest",edgeOffset:20},GanttScroll_default=e=>class extends(e||Base){static get $name(){return"GanttScroll"}scrollTaskIntoView(e,t=defaultScrollOptions6){let r=e.startDate,n=e.endDate;const i=this;if(null==t.edgeOffset&&(t.edgeOffset=20),!e.isScheduled)return this.scrollRowIntoView(e,t);if(i.timeAxisSubGrid.collapsed)return;r=r||n,n=n||r;const s=r<i.timeAxis.startDate|(n>i.timeAxis.endDate)<<1;if(s&&!1!==t.extendTimeAxis){const e=i.timeAxis.endDate-i.timeAxis.startDate;let t,a;3===s?i.timeAxis.setTimeSpan(new Date(r.valueOf()-e/2),new Date(n.getTime()+e/2)):(t=i.getCoordinateFromDate(1&s?n:r),1&s?i.timeAxis.setTimeSpan(new Date(r),new Date(r.valueOf()+e)):i.timeAxis.setTimeSpan(new Date(n.valueOf()-e),new Date(n)),a=1&s?i.getCoordinateFromDate(n):i.getCoordinateFromDate(r),i.timeAxisSubGrid.scrollable.scrollBy(a-t))}const a=i.getElementFromTaskRecord(e);if(a){return i.timeAxisSubGrid.scrollable.scrollIntoView(a,ObjectHelper.assign({silent:!0},t))}return i.scrollUnrenderedTaskIntoView(e,t)}scrollUnrenderedTaskIntoView(e,t=defaultScrollOptions6){null==t.edgeOffset&&(t.edgeOffset=20);const r=this,n=r.timeAxisSubGrid.scrollable,i=r.getTaskBox(e),s=n.viewport,a=i.translate(s.x-n.x,s.y-n.y);let o=n.scrollIntoView(a,Object.assign({},t,{highlight:!1}));if(t.highlight||t.focus){const n=r.ion({renderTask({taskRecord:r,element:i}){r===e&&(n(),o=o.then((()=>{t.highlight&&DomHelper.highlight(i),t.focus&&i.focus()})))}})}else o=Promise.all([o,new Promise((t=>{const n=r.ion({renderTask({taskRecord:r}){r===e&&(n(),t())}})}))]);return o}get widgetClass(){}},GanttState_default=e=>class extends(e||Base){static get $name(){return"GanttState"}updateProject(e,t){super.updateProject(e,t),this.detachListeners("suspendStateDuringDelayedCalculation"),(null==e?void 0:e.delayCalculation)&&e.ion({name:"suspendStateDuringDelayedCalculation",delayCalculationStart:{fn:"suspendStateListener",prio:10},delayCalculationEnd:{fn:"resumeStateListener",prio:-10},thisObj:this})}suspendStateListener(){this.stateListenerSuspended=(this.stateListenerSuspended||0)+1}resumeStateListener(){const e=this;e.stateListenerSuspended=(e.stateListenerSuspended||1)-1,!e.stateListenerSuspended&&e.isSaveStatePending&&e.saveState({immediate:!0})}saveState(...e){if(!this.stateListenerSuspended)return super.saveState(...e)}applyState(e){var t,r;if(!this.project.isInitialCommitPerformed&&((null==(t=e.store)?void 0:t.sorters)||(null==(r=e.store)?void 0:r.filters))){const t=e.store;this.project.commitAsync().then((()=>{this.isDestroyed||(this.store.state=t)})),delete e.store}const n=["selectedCell","selectedRecords"];if(n.some((t=>t in e))){const t={};n.forEach((r=>{r in e&&(t[r]=e[r],delete e[r])})),this._applyStateAfterPaint=()=>{this._applyStateAfterPaint=null,this.suspendRefresh(),Object.keys(t).forEach((e=>this[e]=t[e])),this.resumeRefresh(!0)}}super.applyState(e)}get widgetClass(){}onPaint(...e){super.onPaint(...e);const t=this;t._applyStateAfterPaint&&(t.project.isInitialCommitPerformed?t._applyStateAfterPaint():t.project.ion({commitFinalized(){t._applyStateAfterPaint()},thisObj:t,once:!0}))}},GanttStores_default=e=>class extends(ProjectConsumer_default(e||Base)){static get $name(){return"GanttStores"}static get projectStores(){return{calendarManagerStore:{},resourceStore:{dataName:"resources"},eventStore:{dataName:"events"},assignmentStore:{dataName:"assignments"},dependencyStore:{dataName:"dependencies"}}}static get configurable(){return{projectModelClass:ProjectModel3,tasks:null,taskStore:null}}updateProject(e,t){super.updateProject(e,t),this.detachListeners("ganttStores"),this.bindCrudManager(e),e&&e.ion({name:"ganttStores",startApplyResponse:"onProjectStartApplyResponse",refresh:"internalOnProjectRefresh",load:"onProjectLoad",thisObj:this})}get replica(){return this.project.replica}onProjectStartApplyResponse(){this.isPainted&&(this.suspendRefresh(),this.$suspendedByResponse=!0)}internalOnProjectRefresh({isInitialCommit:e,isCalculated:t}){const r=this,{project:n,visibleDate:i={}}=r;if(r.isPainted){if(!r.appliedViewStartDate&&!("startDate"in r.initialConfig)&&n.startDate){const e=null==i?void 0:i.date,{startDate:t,endDate:s}=n,a=e?DateHelper.min(t,e):t,o=e?s?DateHelper.max(s,e):DateHelper.add(a,r.visibleDateRange.endDate-r.visibleDateRange.startDate):s;a&&o&&(r.setTimeSpan(a,o,{...i,visibleDate:e}),r.appliedViewStartDate=!0)}r.suspendRendering||(r.$suspendedByResponse?(r.resumeRefresh(!0),r.$suspendedByResponse=!1):!e&&t?r.refreshWithTransition():r.refresh(),r.trigger("projectRefresh",{isInitialCommit:e,isCalculated:t}))}}onProjectLoad({source:e}){if(this.$suspendedByResponse){!e.crudStores.some((e=>e.count>0))&&(this.resumeRefresh(!0),this.$suspendedByResponse=!1)}}get timeRanges(){return this.project.timeRanges}set timeRanges(e){this.project.timeRanges=e}get calendars(){return this.project.calendars}set calendars(e){this.project.calendars=e}get usesDisplayStore(){return this.store!==this.taskStore}get tasks(){return this.project.eventStore.allRecords}changeTasks(e){const{project:t}=this;this.buildingProjectConfig?t.eventsData=e:t.eventStore.data=e}changeTaskStore(e){const{project:t}=this;if(!this.buildingProjectConfig)return this.initializingProject||t.eventStore!==e&&(t.setEventStore(e),e=t.eventStore),e;t.eventStore=e}updateEventStore(e){const t=this;e.metaMapId=t.id,t.taskStore=t.store=e}bindStore(e){super.bindStore(e),this.timeAxisViewModel.store=e,this.detachListeners("storeBatchedUpdateListener"),e.ion({name:"storeBatchedUpdateListener",batchedUpdate:"onEventStoreBatchedUpdate",thisObj:this})}onEventStoreBatchedUpdate(e){const t=this;if(t.listenToBatchedUpdates){const r=t.enableEventAnimations;t.enableEventAnimations=!1,t.onStoreUpdateRecord(e),t.enableEventAnimations=r}}get widgetClass(){}},GanttTimelineDateMapper_default=e=>class extends(e||Base){static get $name(){return"GanttTimelineDateMapper"}getDisplayEndDate(e,t){return e}get widgetClass(){}},animate1002={animate:100},TaskNavigation_default=e=>class extends(e||Base){static get $name(){return"TaskNavigation"}static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{Enter:"onTaskEnterKey"}},isNavigationKey:{ArrowDown:1,ArrowUp:1,ArrowLeft:0,ArrowRight:0}}}processEvent(e){const t=this,r=e.target.closest(t.eventSelector);return!t.navigator.disabled&&r&&(e.taskRecord=e.eventRecord=t.resolveTaskRecord(r)),e}normalizeTarget(e){return e.taskRecord}onElementMouseDown(e){var t;const r=this,{_focusedCell:n}=r,i=e.target.closest(r.navigator.itemSelector),s=i&&i===(null==n?void 0:n.target);super.onElementMouseDown(e),s&&r.lastNavigationEvent!==e&&(null==(t=r.onCellNavigate)||t.call(r,r,n,n,!0),r.lastNavigationEvent=e)}selectEvent(e,t=!1){this.isSelected(e)||this.selectRow({record:e.id,column:!1,addToSelection:t})}deselectEvent(e){this.deselectRow(e.id)}getNext(e){const t=this,{store:r}=t;for(let n=r.indexOf(e)+1;n<r.count;n++){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}getPrevious(e){const t=this,{store:r}=t;for(let n=r.indexOf(e)-1;n>=0;n--){const e=r.getAt(n);if(t.isInTimeAxis(e))return e}}set activeEvent(e){this.navigator.activeItem=this.getElementFromTaskRecord(e,!1)}get activeEvent(){const{activeItem:e}=this.navigator;if(e)return this.resolveTaskRecord(e)}async navigateTo(e,{scrollIntoView:t=!0,uiEvent:r={}}){const n=this,{navigator:i}=n,{skipScrollIntoView:s}=i;e&&(t?(i.disabled=!0,await n.scrollTaskIntoView(e,animate1002),i.disabled=!1):i.skipScrollIntoView=!0,n.isDestroyed||(n.activeEvent=e,i.skipScrollIntoView=s,i.trigger("navigate",{event:r,item:n.getElementFromTaskRecord(e,!1)})))}clearEventSelection(){this.deselectAll()}onTaskEnterKey(){}onDeleteKey(e){const t=e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeEvents([t])}onGridBodyFocusIn(e){var t;if(this.timeAxisSubGridElement.contains(e.target)){const r=this,{navigationEvent:n}=r,{target:i}=e,s=i.closest(r.navigator.itemSelector),a=s?r.resolveTaskRecord(i):r.getRecordFromElement(i),o=r.normalizeCellContext({rowIndex:r.store.indexOf(a),column:r.timeAxisColumn,target:i});if(s){if(r.lastNavigationEvent!==n){const{_focusedCell:e}=r;r._focusedCell=o,null==(t=r.onCellNavigate)||t.call(r,r,e,o,!0),r.lastNavigationEvent=n}return}r.navigateTo(a,{scrollIntoView:Boolean("mousedown"!==(null==n?void 0:n.type)),uiEvent:n})}else super.onGridBodyFocusIn(e)}get widgetClass(){}},releaseEventActions3={releaseElement:1,reuseElement:1},renderEventActions3={newElement:1,reuseOwnElement:1,reuseElement:1},NewTaskRendering=class extends Base{static get properties(){return{rowMap:new Map}}construct(e){this.gantt=e,e.rowManager.ion({renderDone:"onRenderDone",removeRows:"onRemoveRows",beforeRowHeight:"onBeforeRowHeightChange",renderRow:"onRenderRow",thisObj:this}),super.construct({})}init(){}refreshRows(){}onTimeAxisViewModelUpdate(){this.updateFromHorizontalScroll(this.gantt.timeAxisSubGrid.scrollable.x)}onViewportResize(){}onDragAbort(){}onBeforeRowHeightChange(e){var t;const{gantt:r}=this;r.foregroundCanvas&&(r.foregroundCanvas.style.fontSize=(null!=(t=null==e?void 0:e.height)?t:r.rowHeight)-2*r.resourceMargin+"px")}get visibleDateRange(){return this._visibleDateRange}getTaskBox(e,t=!1,r=!1){const{gantt:n}=this,{isBatchUpdating:i}=e,{store:s}=n,a=i?e.get("startDate"):e.startDate,o=i?e.get("endDate"):e.endDate;if(r){const t=this.getElementFromTaskRecord(e);if(t)return Rectangle.from(t,n.timeAxisSubGridElement)}if(!a||!o||e.isTask&&(s.isDestroyed||!s.isAvailable(e)))return null;const l=this.getSizeAndPosition(e,t,r);if(!l)return null;const{position:c,width:d}=l,u=n.rowManager.calculateTop(s.indexOf(e.isBaseline?e.task:e))+n.resourceMargin,h=n.rowHeight-2*n.resourceMargin,g=new Rectangle(c,u,d,h);return g.layout=!0,g}getSizeAndPosition(e,t,r){var n;const{gantt:i}=this,{timeAxis:s}=i,a=s.startDate,o=s.endDate,l=e.milestone,c=l?null==(n=i.features.dependencies.pathFinder)?void 0:n.startArrowMargin:0;let d,u,h=e.isBatchUpdating?e.get("startDate"):e.startDate,g=e.isBatchUpdating?e.get("endDate"):e.endDate||(null!=e.duration?DateHelper.add(h,e.duration,e.durationUnit):null);if(!t&&(g<a||h>o))return null;if(t&&h<a)d=i.getCoordinateFromDate(a)-c;else if(t&&h>o)d=i.getCoordinateFromDate(o)+c;else if(h<a){const t=i.timeAxisViewModel.getSingleUnitInPixels("second"),r=(s.startMS-e.startDateMS)/1e3*t;d=i.getCoordinateFromDate(a)-r}else{if(i.fillTicks&&!l&&(!e.isBatchUpdating||i.snap)){const e=Math.floor(i.timeAxis.getTickFromDate(h));h=i.timeAxis.getAt(e).startDate}d=i.getCoordinateFromDate(h)}if(!l)if(t&&g<a)u=i.getCoordinateFromDate(a);else if(t&&g>o)u=i.getCoordinateFromDate(o);else if(g>o){const t=i.timeAxisViewModel.getSingleUnitInPixels("second"),r=(e.endDateMS-s.endMS)/1e3*t;u=i.getCoordinateFromDate(o)+r}else{if(i.fillTicks&&(!e.isBatchUpdating||i.snap)){const e=Math.ceil(i.timeAxis.getTickFromDate(g))-1;g=i.timeAxis.getAt(e).endDate}u=i.getCoordinateFromDate(g)}let p=l?0:Math.abs(d-u);return r&&l&&h>a&&h<o&&(p=i.rowHeight-2*i.resourceMargin,d-=p/2),!t&&d+p<0?null:{position:d,width:p}}getRowRegion(e,t,r){const{gantt:n}=this,i=n.getRowFor(e);if(!i)return null;const s=i.getElement(n.timeAxisSubGrid.region),a=n.timeAxis.startDate,o=n.timeAxis.endDate,l=t?DateHelper.max(a,t):a,c=r?DateHelper.min(o,r):o,d=n.getCoordinateFromDate(l),u=n.getCoordinateFromDate(c,!0,!0),h=i.top+n.scrollTop,g=Math.min(d,u),p=h+s.offsetHeight;return new Rectangle(g,h,Math.max(d,u)-g,p-h)}getDateFromXY(e,t,r){let n=e[0];return r||(n=this.translateToScheduleCoordinate(n)),this.gantt.timeAxisViewModel.getDateFromPosition(n,t)}translateToScheduleCoordinate(e){return e-Math.floor(this.gantt.timeAxisSubGridElement.getBoundingClientRect().left)+this.gantt.scrollLeft}translateToPageCoordinate(e){const t=this.gantt.timeAxisSubGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}getElementFromTaskRecord(e,t=!0){const{syncIdMap:r}=this.gantt.foregroundCanvas;let n=null==r?void 0:r[e.id];return!n&&e.hasLinks&&r&&e.forEachLinked(((e,t)=>{r[t.id]&&(n=r[t.id])})),t?null==n?void 0:n.syncIdMap.task:n}getConnectorStartSide(e){return this.gantt.rtl?"right":"left"}getConnectorEndSide(e){return this.gantt.rtl?"left":"right"}onRenderRow({row:e,record:t}){e.assignCls({"b-inactive":t.inactive})}onRemoveRows({rows:e}){e.forEach((e=>this.rowMap.delete(e))),!this.gantt.refreshSuspended&&this.onRenderDone()}updateFromHorizontalScroll(e){const t=this,{gantt:r}=t,{timeAxisSubGrid:n,timeAxis:i,rtl:s}=r,{width:a}=n,{totalSize:o}=r.timeAxisViewModel,l=e,c=0!==n.scrollable.maxX&&Math.abs(n.scrollable.maxX)<=Math.round(l)+5,d=r.getDateFromCoord({coord:Math.max(0,l),ignoreRTL:!0}),u=c?i.endDate:r.getDateFromCoord({coord:l+a,ignoreRTL:!0})||i.endDate;if(d&&!r._viewPresetChanging){t._visibleDateRange={startDate:d,endDate:u,startMS:d.getTime(),endMS:u.getTime()},t.viewportCoords=s?{left:o-e-a,right:o-e}:{left:e,right:e+a};const n=r.timeView.range={startDate:d,endDate:u};r.onVisibleDateRangeChange(n)}}internalPopulateTaskRenderData(e,t){var r;const{gantt:n}=this,i={className:"b-gantt-task-content",dataset:{taskBarFeature:"content"},children:[]};if(e){let s=void 0===t.isResizable||t.isResizable;e.startsOutsideView&&(!0===s?s="end":"start"===s&&(s=!1)),e.endsOutsideView&&(!0===s?s="start":"end"===s&&(s=!1)),Object.assign(e,{iconCls:new DomClassList(t.taskIconCls),id:n.getEventRenderId(t),style:t.style||"",taskId:t.id,wrapperCls:new DomClassList({[n.eventCls+"-wrap"]:1,[n.eventCls+"-parent"]:t.isParent,"b-milestone-wrap":t.milestone,"b-inactive":t.inactive,"b-expanded":t.isExpanded(n.store),"b-readonly":t.readOnly,"b-linked":t.isLinked,"b-original":t.hasLinks,"b-temporary":!t.project}),cls:t.isResourceTimeRange?new DomClassList:t.cls.clone(),extraConfigs:[]}),Object.assign(e.cls,{[n.eventCls]:1,[n.generatedIdCls]:t.hasGeneratedId,[n.dirtyCls]:t.modifications,[n.committingCls]:t.isCommitting,[n.endsOutsideViewCls]:e.endsOutsideView,[n.startsOutsideViewCls]:e.startsOutsideView,[n.fixedEventCls]:!1===t.isDraggable,["b-sch-event-resizable-"+s]:isAllowEdit(t.statusId),"b-milestone":t.milestone,"b-task-started":t.isStarted,"b-task-finished":t.isCompleted,"b-task-selected":n.selectedRecords.includes(t)});const a=t.eventStyle||n.eventStyle,o=t.eventColor||n.eventColor;if(e.eventColor=o,e.eventStyle=a,n.taskRenderer){const r=n.taskRenderer.call(n.taskRendererThisObj||n,{taskRecord:t,renderData:e});"string"==typeof e.cls&&(e.cls=new DomClassList(e.cls)),"string"==typeof e.iconCls&&(e.iconCls=new DomClassList(e.iconCls)),"string"==typeof e.wrapperCls&&(e.wrapperCls=new DomClassList(e.wrapperCls));let s=null;StringHelper.isHtml(r)?s={tag:"span",html:r}:"string"==typeof r||"object"==typeof r?s=r:null!=r&&(s=String(r)),s&&(Array.isArray(s)?i.children.push(...s):i.children.push(s),e.cls.add("b-has-content"))}e.cls["b-sch-event-withicon"]=e.iconCls.length,e.wrapperCls["b-sch-style-"+e.eventStyle]=e.eventStyle,DomHelper.isNamedColor(e.eventColor)?e.wrapperCls["b-sch-color-"+e.eventColor]=e.eventColor:e.eventColor&&(e.style="background-color:"+e.eventColor+";"+e.style),(null==(r=e.iconCls)?void 0:r.length)&&i.children.unshift({tag:"i",className:e.iconCls}),(i.children.length||t.milestone)&&e.children.push(i)}e.taskContent=i,e.wrapperChildren=[]}populateTaskRenderData(e,t){this.internalPopulateTaskRenderData(...arguments),this.gantt.onTaskDataGenerated(e)}getTaskRenderData(e,t){const r=this,n=r.getTaskBox(t,!1,!1,e),i={taskRecord:t,task:t,row:e,children:[]};return n?Object.assign(i,{isTask:!0,top:n.top,left:n.left,width:n.width,height:n.height}):i.top=e.top+r.gantt.resourceMargin,r.populateTaskRenderData(i,t),i}getTaskDOMConfig(e){return{className:e.wrapperCls,tabIndex:"0",children:[{className:e.cls,style:(e.internalStyle||"")+(e.style||""),children:e.children,dataset:{taskFeature:"task"},syncOptions:{syncIdField:"taskBarFeature"}},...e.wrapperChildren],style:{top:e.top,left:e.left-(this.gantt.rtl?e.width:0),width:e.width,zIndex:e.zIndex},dataset:{taskId:e.taskId},elementData:e,syncOptions:{syncIdField:"taskFeature",releaseThreshold:0}}}renderer({row:e,record:t}){const r=this,n=r.getTaskRenderData(e,t);let i;if(n.isTask)i=r.getTaskDOMConfig(n),r.gantt.trigger("beforeRenderTask",{renderData:n,domConfig:i});else if(0===n.extraConfigs.length)return void r.rowMap.delete(e);r.rowMap.set(e,[i,...n.extraConfigs])}onRenderDone(){const{gantt:e}=this,t=Array.from(this.rowMap.values()).flat();e.onBeforeTaskSync(t),DomSync.sync({domConfig:{onlyChildren:!0,children:t},targetElement:e.foregroundCanvas,syncIdField:"taskId",callback({action:t,domConfig:r,lastDomConfig:n,targetElement:i}){var s,a;if("none"!==t&&r&&r.className&&r.className[e.eventCls+"-wrap"]){const o=releaseEventActions3[t],l=renderEventActions3[t];if(o&&(null==(s=null==n?void 0:n.elementData)?void 0:s.isTask)){const t={renderData:n.elementData,taskRecord:n.elementData.taskRecord,element:i};e.trigger("releaseTask",t)}if(l&&(null==(a=null==r?void 0:r.elementData)?void 0:a.isTask)){const n={renderData:r.elementData,taskRecord:r.elementData.taskRecord,element:i};n.reusingElement="reuseElement"===t,e.trigger("renderTask",n)}}}})}redraw(e){this.gantt.rowManager.refreshCell(e,this.gantt.timeAxisColumn.id)&&this.onRenderDone()}};NewTaskRendering._$name="NewTaskRendering";var emptyObject14=Object.freeze({}),newTaskCount=0,GanttBase=class extends(TimelineBase.mixin(CrudManagerView_default,GanttDom_default,GanttRegions_default,GanttScroll_default,GanttStores_default,GanttState_default,GanttTimelineDateMapper_default,EventNavigation_default,TaskNavigation_default,ProjectProgressMixin_default,SchedulingIssueResolution_default,CurrentConfig_default)){constructor(){super(...arguments),__publicField(this,"timeCellSelector",".b-sch-timeaxis-cell")}static get type(){return"ganttbase"}static get defaultConfig(){return{project:null,resourceImageFolderPath:null,defaultResourceImageName:null,toggleParentTasksOnClick:!0,scrollTaskIntoViewOnCellClick:!1,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",focusCls:"b-active",taskRenderer:null,newTaskDefaults:{},dependencyIdField:"id",getDateConstraints:null}}get isGantt(){return!0}construct(e={}){const t=this,r=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),n=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);if(!e.features){const r=t.getDefaultConfiguration().features;e.features=r&&"object"==typeof r?r:{}}"tree"in e.features||(e.features.tree=!0),"group"in e.features||(e.features.group=!1);const{project:i}=e;if(i&&(r||n))throw new Error("Providing both project and inline data is not supported");(null==i?void 0:i.isModel)||(e.project=ObjectHelper.assign({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore},i),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),super.construct(e),t.ion({taskclick:"onTaskBarClick",cellClick:"onNonTimeAxisCellClick",toggleNode:"onToggleParentNode"})}changeColumns(e,t){if(e){let t=e;Array.isArray(e)||(t=e.data,this._thisIsAUsedExpression(this.taskStore)),t.some((e=>{const t=e instanceof Column?e.constructor:ColumnStore.getColumnClass(e.type)||Column;return t===NameColumn||t.prototype instanceof NameColumn}))||t.unshift({type:"name"})}return super.changeColumns(e,t)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.store&&(this.timeAxisViewModel.store=this.store)}get timeAxisViewModel(){return super.timeAxisViewModel}onPaintOverride(){}resumeRefresh(e){super.resumeRefresh(!1),!this.refreshSuspended&&e&&this.isPainted&&(this.rowManager.topRow?this.refreshWithTransition():this.rowManager.reinitialize())}onStoreUpdateRecord(e){if(!this.project.isBatchingChanges){let t;return this.runWithTransition((()=>{t=super.onStoreUpdateRecord(e)}),!this.refreshSuspended),t}}onStoreDataChange(e){this.runWithTransition((()=>{super.onStoreDataChange(e)}),"batch"===e.action)}onTaskDataGenerated(){}onBeforeTaskSync(){}onTaskBarClick({taskRecord:e}){this.toggleParentTasksOnClick&&!e.isLeaf&&this.toggleCollapse(e)}onNonTimeAxisCellClick({record:e,column:t}){const{scrollTaskIntoViewOnCellClick:r}=this;"timeAxis"!==t.type&&r&&e.isScheduled&&this.scrollTaskIntoView(e,!0===r?{animate:!0,block:"center",y:!1}:r)}onToggleParentNode({record:e}){e.parent.isExpanded(this.taskStore)&&this.taskRendering.redraw(e)}afterSelectionChange({selectedRecords:e,deselectedRecords:t}){const r=this;function n(e,t){const n=r.getElementFromTaskRecord(e);n&&DomSync[t?"addCls":"removeCls"]("b-task-selected",n)}null==e||e.map((e=>n(e,!0))),null==t||t.map((e=>n(e,!1)))}toggleEmptyText(){const e=this;e.bodyContainer&&e.rowManager&&DomHelper.toggleClasses(e.bodyContainer,"b-grid-empty",!(e.rowManager.rowCount||e.project.isLoadingOrSyncing))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new NewTaskRendering(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,t){const r=this.resolveTaskRecord(e);return r?{taskRecord:r,taskElement:e,event:t}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.redraw(e)}get visibleResources(){var e,t;return{first:this.store.getById(null==(e=this.firstVisibleRow)?void 0:e.id),last:this.store.getById(null==(t=this.lastVisibleRow)?void 0:t.id)}}populateTaskMenu(){}async addTask(e,t=emptyObject14){const r=this,{milestone:n,asPredecessor:i,asSuccessor:s}=t,a=r.project,o=e.parent,l="function"==typeof r.newTaskDefaults?r.newTaskDefaults(e):r.newTaskDefaults,c=r.taskStore.modelClass.new({startDate:e.startDate,duration:e.duration},l,t.data);return r.trigger("beforeTaskAdd",{taskRecord:c}),c.name||(c.name=r.L(n?"L{Gantt.New milestone}":"L{Gantt.New task}")+" "+ ++newTaskCount),a.suspendChangesTracking(),t.asChild?e.insertChild(c,"end"===t.at?null:e.firstChild):t.above?o.insertChild(c,e):o.insertChild(c,e.nextSibling),a.resumeChangesTracking(!0),n?(await a.commitAsync(),await c.convertToMilestone()):await a.commitAsync(),s?r.dependencyStore.add({fromEvent:e,toEvent:c,type:DependencyType.EndToStart,fromSide:"right",toSide:"left"}):i&&r.dependencyStore.add({fromEvent:c,toEvent:e,type:DependencyType.EndToStart,fromSide:"right",toSide:"left"}),(s||i)&&await a.commitAsync(),c}addTaskAbove(e,t){return this.addTask(e,{...t,above:!0})}addTaskBelow(e,t){return this.addTask(e,t)}addMilestoneBelow(e,t){return this.addTask(e,{...t,milestone:!0})}addSubtask(e,t){const r=this.addTask(e,{...t,asChild:!0});return this.toggleCollapse(e,!1),r}addSuccessor(e,t){return this.addTask(e,{...t,asSuccessor:!0})}addPredecessor(e,t){return this.addTask(e,{...t,above:!0,asPredecessor:!0})}async indent(e){const t=this;if(t.isTreeGrouped)return;(!e||e instanceof Event)&&(e=t.selectedRecords),await this.project.commitAsync();const r=await t.taskStore.indent(e);return r||Toast.show({rootElement:t.rootElement,html:t.L("L{Gantt.changeRejected}")}),r}async outdent(e){const t=this;if(t.isTreeGrouped)return;(!e||e instanceof Event)&&(e=t.selectedRecords),await this.project.commitAsync();const r=await t.taskStore.outdent(e);return r||Toast.show({rootElement:t.rootElement,html:t.L("L{Gantt.changeRejected}")}),r}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}};__publicField(GanttBase,"$name","GanttBase"),__publicField(GanttBase,"configurable",{keyMap:{"Alt+Shift+ArrowLeft":"outdent","Alt+Shift+ArrowRight":"indent"}}),GanttBase.initClass(),VersionHelper.setVersion("gantt","5"),GanttBase._$name="GanttBase";var Gantt=class extends GanttBase{static get $name(){return"Gantt"}static get type(){return"gantt"}};Gantt.initClass(),Gantt._$name="Gantt",(()=>{const e=[];let t;class r{static construct(e){const t="gantt",r=VersionHelper.getVersion(t);BrowserHelper.queryString.blockUrl;Object.assign(this,{version:r,product:t,Product:"Gantt",verifyUrl:"gantt",blocked:!1,lastVersionCheck:0},e)}static get isExpired(){return null}static maskExpiredWidget(e){e.mask({text:"出错了...",icon:"b-fa b-fa-exclamation-circle",type:"trial",cover:"target"})}static setWaterMark(e,{darkColor:t="rgba(255, 255, 255, 0.03)",lightColor:r="rgba(240, 240, 240, 0.54)"}={}){}}const n=n=>{e.push(n),Override.apply(class{static get target(){return{class:n}}onPaintOverride(){const e=this,n=()=>{const t=e.subGrids?Object.values(e.subGrids):[e];for(const e of t)e.element&&r.setWaterMark(e.element)};!function(e,n){t||(t=!0,r.construct({widget:e})),e.__foo="THISISTRIAL"}(e),n(),GlobalEvents.on("theme",(()=>{n()})),r.isExpired&&r.maskExpiredWidget(e)}})};void 0!==GridBase&&(n(GridBase),Override.apply(class{static get target(){return{class:RowManager}}matchRowCount(){var e;(!r.isExpired||null!==(e=this.grid)&&void 0!==e&&e.isScheduler)&&this._overridden.matchRowCount.apply(this,arguments)}renderRows(){var e;(!r.isExpired||null!==(e=this.grid)&&void 0!==e&&e.isScheduler)&&this._overridden.renderRows.apply(this,arguments)}renderFromRow(){var e;(!r.isExpired||null!==(e=this.grid)&&void 0!==e&&e.isScheduler)&&this._overridden.renderFromRow.apply(this,arguments)}})),void 0!==SchedulerBase&&(n(SchedulerBase),Override.apply(class{static get target(){return{class:Dependencies}}domSync(){if(!r.isExpired)return this._overridden.domSync.apply(this,arguments)}}),Override.apply(class{static get target(){return{class:HorizontalRendering}}onRenderDone(){var e;if(!r.isExpired||null!==(e=this.scheduler)&&void 0!==e&&e.isSchedulerPro)return this._overridden.onRenderDone.apply(this,arguments)}}),Override.apply(class{static get target(){return{class:VerticalRendering}}onRenderDone(){var e;if(!r.isExpired||null!==(e=this.scheduler)&&void 0!==e&&e.isSchedulerPro)return this._overridden.onRenderDone.apply(this,arguments)}})),void 0!==SchedulerProBase&&(n(SchedulerProBase),Override.apply(class{static get target(){return{class:SchedulerEventRendering_default}}getEventsToRender(){return r.isExpired&&this.isSchedulerPro?[]:this._overridden.getEventsToRender.apply(this,arguments)}})),void 0!==GanttBase&&n(GanttBase)})();export{AbstractAssignmentStoreMixin,AbstractCalendarManagerStoreMixin,AbstractCalendarMixin,AbstractCrudManager,AbstractCrudManagerMixin_default as AbstractCrudManagerMixin,AbstractCrudManagerValidation_default as AbstractCrudManagerValidation,AbstractDependencyStoreMixin,AbstractEventStoreMixin,AbstractHasAssignmentsMixin,AbstractPartOfProjectGenericMixin,AbstractPartOfProjectModelMixin,AbstractPartOfProjectStoreMixin,AbstractRecurrenceIterator,AbstractResourceStoreMixin,AbstractTimeRanges,ActionBase,ActionColumn,AddNewColumn,AdvancedTab,AggregateColumn,AjaxHelper,AjaxStore,AjaxTransport_default as AjaxTransport,AllColumns_default as AllColumns,Animator,ArrayDataField,ArrayHelper,AssignmentAllocationInterval,AssignmentField,AssignmentGrid,AssignmentModel3 as AssignmentModel,AssignmentModelMixin_default as AssignmentModelMixin,AssignmentPicker,AssignmentStore3 as AssignmentStore,AssignmentStoreMixin_default as AssignmentStoreMixin,AssignmentsManipulationStore,AsyncHelper,AttachToProjectMixin_default as AttachToProjectMixin,AvatarRendering,Badge_default as Badge,Bag,Bar,Base,BaseAllocationInfo,BaseAllocationInterval,BaseAssignmentMixin,BaseCalendarMixin,BaseDependencyMixin,BaseDependencyResolution,BaseEmptyCalendarEffectResolution,BaseEventMixin,BaseHasAssignmentsMixin,BaseResourceMixin,Baseline,Baselines,BooleanCombo,BooleanDataField,BreakCurrentStackExecution,BrowserHelper,Button,ButtonGroup,CI,CIFromSetOrArrayOrValue,CSSHelper,CalculateProposed,CalculatedValueGen,CalculatedValueGenC,CalculatedValueSync,CalculatedValueSyncC,CalculationGen,CalculationSync,CalendarCache,CalendarCacheInterval,CalendarCacheIntervalMultiple,CalendarCacheMultiple,CalendarCacheSingle,CalendarColumn,CalendarField,CalendarHighlight,CalendarIntervalMixin,CalendarIntervalModel2 as CalendarIntervalModel,CalendarIntervalStore,CalendarIteratorResult,CalendarManagerStore2 as CalendarManagerStore,CalendarModel2 as CalendarModel,CalendarPanel,CalendarPicker,CanCombineCalendarsMixin,CellCopyPaste,CellEdit2 as CellEdit,CellMenu,CellTooltip,ChangeLogAction,ChangeLogAssignmentEntity,ChangeLogDependencyEntity,ChangeLogEntity,ChangeLogPropertyUpdate,ChangeLogStore,ChangeLogTransactionModel,CheckColumn,Checkbox,ChipView,ChronoAbstractProjectMixin,ChronoAssignmentStoreMixin,ChronoCalendarManagerStoreMixin,ChronoDependencyStoreMixin,ChronoEventStoreMixin,ChronoEventTreeStoreMixin,Field2 as ChronoField,ChronoGraph,Base2 as ChronoMixinBase,ChronoModelFieldIdentifier,ChronoModelMixin,ChronoModelReferenceBucketFieldIdentifier,ChronoModelReferenceFieldIdentifier,ChronoModelReferenceFieldQuark,ChronoPartOfProjectGenericMixin,ChronoPartOfProjectModelMixin,ChronoPartOfProjectStoreMixin,ChronoResourceStoreMixin,ChronoStoreMixin,Transaction2 as ChronoTransaction,ClickRepeater,ClockTemplate,CollapseTool,Collection,CollectionFilter,CollectionSorter,Column,ColumnAutoWidth,ColumnDragToolbar,ColumnLines,ColumnPicker,ColumnRename,ColumnReorder,ColumnResize,ColumnStore,Combo,CommitZero,ComputationCycle,Config,ConflictEffect,ConflictEffectDescription,ConflictResolution,ConflictSymbol,ConstrainedByParentMixin,ConstrainedEarlyEventMixin,ConstrainedLateEventMixin,ConstraintDateColumn,ConstraintInterval,ConstraintIntervalDescription,ConstraintIntervalSide,ConstraintType,ConstraintTypeColumn,ConstraintTypePicker,Container,ContextGen,ContextMenuBase,ContextSync,CoreAssignmentMixin,CoreAssignmentStoreMixin,CoreCalendarManagerStoreMixin,CoreCalendarMixin,CoreDependencyMixin,CoreDependencyStoreMixin,CoreEventMixin,CoreEventStoreMixin,CoreHasAssignmentsMixin,CoreHasDependenciesMixin,CorePartOfProjectGenericMixin,CorePartOfProjectModelMixin,CorePartOfProjectStoreMixin,CoreResourceMixin,CoreResourceStoreMixin,StateTrackingManager as CoreStateTrackingManager,CriticalPaths,CrudManager,CrudManagerView_default as CrudManagerView,CycleDescription,CycleEffect,CycleEffectDescription,CycleResolution,CycleResolutionInput,CycleResolutionInputChrono,CycleResolutionPopup,CycleSymbol,DailyRecurrenceIterator,DataField,DataGenerator,DateColumn,DateConstraintInterval,DateConstraintIntervalDescription,DateDataField,DateField,DateHelper,DateInterval,DatePicker,DateTimeField,DayTime,DeactivateDependencyCycleEffectResolution,DeactivateDependencyResolution,DeadlineDateColumn,Delayable_default as Delayable,DelayableWrapper2 as DelayableWrapper,DemoBot,Dependencies2 as Dependencies,DependenciesCalendar,DependencyBaseModel,DependencyColumn,DependencyConstraintInterval,DependencyConstraintIntervalDescription,DependencyCreation_default as DependencyCreation,DependencyEdit2 as DependencyEdit,DependencyField,DependencyModel3 as DependencyModel,DependencyStore3 as DependencyStore,DependencyStoreMixin_default as DependencyStoreMixin,DependencyTab,DependencyTooltip_default as DependencyTooltip,DependencyType,DependencyTypePicker,DependencyValidationResult,Describable_default as Describable,Direction,DisableManuallyScheduledConflictResolution,DisplayField,DomClassList,DomDataStore,DomHelper,DomSync,DragBase,DragContext,DragCreateBase,DragHelper,DragProxy,DragTipProxy,Draggable_default as Draggable,Droppable_default as Droppable,Duration,DurationColumn,DurationConverterMixin,DurationField,DurationVar,DynamicObject,EMPTY_INTERVAL,EarlyEndDateColumn,EarlyLateLazyness,EarlyStartDateColumn,EdgeInclusion,EdgeType,EdgeTypeNormal,EdgeTypePast,EditBase,Editor,EditorTab,Effect,EffectResolutionResult,EffortColumn,EffortField,EffortVar,EmptyCalendarEffect,EmptyCalendarEffectDescription,EmptyCalendarSymbol,EndDateColumn,EndDateField,EndDateVar,EngineReplica,EngineRevision,EngineTransaction,Entity,EntityIdentifier,EntityMeta,EventBuffer,EventCopyPaste,EventDayIndex,EventDrag,EventDragCreate,EventDragSelect,EventEdit,EventEditor,EventFilter,EventHelper,EventLoader_default as EventLoader,EventMenu,EventModel2 as EventModel,EventModelMixin_default as EventModelMixin,EventNavigation_default as EventNavigation,EventNonWorkingTime,EventResize2 as EventResize,EventSegmentDrag,EventSegmentModel,EventSegmentResize,EventSegments,EventSelection_default as EventSelection,EventStore2 as EventStore,EventStoreMixin_default as EventStoreMixin,EventTooltip,EventUpdateAction,Events_default as Events,ExcelExporter2 as ExcelExporter,ExportDialog,ExportOrientationCombo,ExportRowsCombo,Exporter,Factoryable_default as Factoryable,Featureable_default as Featureable,Fencible_default as Fencible,Field,FieldContainer,FieldFilterPicker,FieldFilterPickerGroup,FieldIdentifier,FieldSet,FileField,FileFormat,FilePicker,FillHandle,Filter,FilterBar,FilterField,Finalizable_default as Finalizable,FixedDurationMixin,FixedEffortMixin,FixedUnitsMixin,Footer,FormTab,Formatter,Formula,FormulasCache,Fullscreen,FunctionHelper,Gantt,GanttBase,GanttDateColumn,GanttDom_default as GanttDom,GanttEvent,GanttProjectMixin,GanttRegions_default as GanttRegions,GanttScroll_default as GanttScroll,GanttState_default as GanttState,GanttStores_default as GanttStores,GanttTaskEditor,GanttTimelineDateMapper_default as GanttTimelineDateMapper,GeneralTab,GetEventsMixin_default as GetEventsMixin,GetTransaction,GlobalEvents_default as GlobalEvents,Grid,GridBase,CellEdit as GridCellEdit,GridElementEvents_default as GridElementEvents,ExcelExporter as GridExcelExporter,GridFeatureManager,GridFeatures_default as GridFeatures,GridFieldFilterPicker,GridFieldFilterPickerGroup,GroupSummary as GridGroupSummary,MultiPageExporter as GridMultiPageExporter,MultiPageVerticalExporter as GridMultiPageVerticalExporter,PdfExport as GridPdfExport,GridResponsive_default as GridResponsive,GridRowModel,GridSelection_default as GridSelection,SinglePageExporter as GridSinglePageExporter,GridState_default as GridState,GridSubGrids_default as GridSubGrids,Summary as GridSummary,TreeGroup as GridTreeGroup,Group,GroupSummary2 as GroupSummary,HasCalendarMixin,HasChildrenMixin,HasCriticalPathsMixin,HasDateConstraintMixin,HasDependenciesMixin,HasEffortMixin,HasPercentDoneMixin,HasProposedNotPreviousValue,HasProposedNotPreviousValueEffect,HasProposedNotPreviousValueSymbol,HasProposedValue,HasProposedValueEffect,HasProposedValueSymbol,HasSchedulingModeMixin,HasSubEventsMixin,Header,HeaderMenu,HeaderZoom,Histogram,HorizontalLayoutPack,HorizontalLayoutStack,HorizontalRendering,HorizontalTimeAxis,Hoverable_default as Hoverable,IdHelper,Identifiable_default as Identifiable,Identifier,IdentifierC,IgnoreResourceCalendarColumn,InactiveColumn,IndexPosition,Indicators,InstancePlugin,Instruction,IntegerDataField,IntervalCache,IsChronoModelSymbol,JsonEncoder_default as JsonEncoder,KeyMap_default as KeyMap,Label,Labelable_default as Labelable,Labels2 as Labels,LateEndDateColumn,LateStartDateColumn,Layout,Levels,List,Listener,LoadMaskable_default as LoadMaskable,LocaleHelper,LocaleManager_default as LocaleManager,Localizable_default as Localizable,Location,MAX_DATE,MI,MIN_DATE,ManuallyScheduledColumn,ManuallyScheduledParentConstraintInterval,ManuallyScheduledParentConstraintIntervalDescription,Mask,Menu,MenuItem,MergeCells,MessageDialog_default as MessageDialog,Meta,MilestoneColumn,Minifiable_default as Minifiable,MinimalChronoModelFieldIdentifierGen,MinimalChronoModelFieldIdentifierSync,MinimalChronoModelFieldVariable,MinimalEntityIdentifier,MinimalFieldIdentifierGen,MinimalFieldIdentifierSync,MinimalFieldVariable,MinimalReferenceBucketIdentifier,MinimalReferenceBucketQuark,MinimalReferenceIdentifier,Model,ModelBucketField,ModelCombo,ModelDataField,ModelField,ModelLink_default as ModelLink,ModelReferenceField,ModelStm_default as ModelStm,Month,MonthlyRecurrenceIterator,MspExport,MultiPageExporter3 as MultiPageExporter,MultiPageVerticalExporter3 as MultiPageVerticalExporter,NOT_VISITED,NameColumn,Navigator,NestedEvents,NewTaskRendering,NonWorkingTime,NonWorkingTimeMixin_default as NonWorkingTimeMixin,NoteColumn,NotesTab,NumberColumn,NumberDataField,NumberField,NumberFormat,ObjectDataField,ObjectHelper,Objects,OnCycleAction,Orientation,Override,OwnIdentifier,OwnIdentifierSymbol,OwnQuark,OwnQuarkSymbol,PackMixin_default as PackMixin,PagingToolbar,Pan,Panel,PanelCollapser,PanelCollapserOverlay,PaperFormat,ParentArea,Parser_default as Parser,PartOfBaseProject_default as PartOfBaseProject,PartOfProject_default2 as PartOfProject,PasswordField,PdfExport3 as PdfExport,PercentBar,PercentColumn,PercentDoneColumn,PercentDoneMixin_default as PercentDoneMixin,PickerField,Pluggable_default as Pluggable,Point,Popup,PredecessorColumn,PredecessorsTab,pm as PresetManager,PresetStore,PreviousValueOf,PreviousValueOfEffect,PreviousValueOfSymbol,ProHorizontalLayout_default as ProHorizontalLayout,ProHorizontalLayoutPack,ProHorizontalLayoutStack,ProTaskEditStm_default as ProTaskEditStm,ProgressLine,ProjectChangeHandlerMixin_default as ProjectChangeHandlerMixin,ProjectCombo,ProjectConstraintInterval,ProjectConstraintIntervalDescription,ProjectConsumer_default as ProjectConsumer,ProjectCrudManager_default2 as ProjectCrudManager,ProjectGenerator,ProjectLines,ProjectModel3 as ProjectModel,ProjectModelCommon_default as ProjectModelCommon,ProjectModelMixin_default as ProjectModelMixin,ProjectModelTimeZoneMixin_default as ProjectModelTimeZoneMixin,ProjectProgressMixin_default as ProjectProgressMixin,ProjectType,ProjectWebSocketHandlerMixin_default as ProjectWebSocketHandlerMixin,Promissory,ProposedArgumentsOf,ProposedArgumentsOfEffect,ProposedArgumentsOfSymbol,ProposedOrPrevious,ProposedOrPreviousSymbol,ProposedOrPreviousValueOf,ProposedOrPreviousValueOfEffect,ProposedOrPreviousValueOfSymbol,ProposedValueOf,ProposedValueOfEffect,ProposedValueOfSymbol,Quark,QuarkGen,QuarkSync,QuickFind,RTL_default as RTL,Radio,RadioGroup,RandomGenerator,RatingColumn,ReadMode,ReadyStatePropagator_default as ReadyStatePropagator,Rectangle,RectangularPathFinder,RecurrenceCombo,RecurrenceConfirmationPopup,RecurrenceDayRuleEncoder,RecurrenceDaysButtonGroup,RecurrenceDaysCombo,RecurrenceEditor,RecurrenceEditorPanel,RecurrenceFrequencyCombo,RecurrenceLegend,RecurrenceLegendButton,RecurrenceModel,RecurrenceMonthDaysButtonGroup,RecurrenceMonthsButtonGroup,RecurrencePositionsCombo,RecurrenceStopConditionCombo,RecurrenceTab,RecurringEventEdit_default as RecurringEventEdit,RecurringEvents_default as RecurringEvents,RecurringEventsMixin_default as RecurringEventsMixin,RecurringTimeSpan_default as RecurringTimeSpan,RecurringTimeSpansMixin_default as RecurringTimeSpansMixin,ReferenceBucketField,ReferenceBucketIdentifier,ReferenceBucketQuark,ReferenceField,ReferenceIdentifier,RegionResize,Reject,RejectEffect,RejectSymbol,RemoveDateConstraintConflictResolution,RemoveDependencyCycleEffectResolution,RemoveDependencyResolution,Renderable,Replica,ResizeHelper,ResizeMonitor,ResourceAllocationEventRangeCalendar,ResourceAllocationEventRangeCalendarIntervalMixin,ResourceAllocationEventRangeCalendarIntervalStore,ResourceAllocationInfo,ResourceAllocationInterval,ResourceAssignmentColumn,ResourceAssignmentGridResourceColumn,ResourceAssignmentParser_default as ResourceAssignmentParser,ResourceCalendarColumn,ResourceCollapseColumn,ResourceCombo,ResourceFilter,ResourceHeader,ResourceHistogram,ResourceInfoColumn,ResourceMenu,ResourceModel3 as ResourceModel,ResourceModelMixin_default as ResourceModelMixin,ResourceNonWorkingTime,ResourceStore3 as ResourceStore,ResourceStoreMixin_default as ResourceStoreMixin,ResourceTimeRangeModel,ResourceTimeRangeStore,ResourceTimeRanges,ResourceTimeRangesBase,ResourceUtilization,ResourcesTab,Responsive_default as Responsive,Revision,Ripple,RollupColumn,Rollups,Rotatable_default as Rotatable,Row,RowCopyPaste,RowExpander,RowManager,RowNumberColumn,RowReorder,RowsRange,SEDBackwardCycleResolutionContext,SEDDispatcher,SEDDispatcherIdentifier,SEDForwardCycleResolutionContext,SEDGraphDescription,SEDWUDispatcher,SEDWUDispatcherIdentifier,Scale,ScaleColumn,ScheduleContext,ScheduleMenu,ScheduleRange,ScheduleRangeCombo,ScheduleTableExporter,ScheduleTooltip,ScheduledByDependenciesEarlyEventMixin,ScheduledByDependenciesLateEventMixin,Scheduler,SchedulerAdvancedTab,AssignmentModel as SchedulerAssignmentModel,AssignmentStore as SchedulerAssignmentStore,SchedulerBase,SchedulerBasicEvent,SchedulerBasicProjectMixin,SchedulerCoreEvent,SchedulerCoreProjectMixin,SchedulerDatePicker,Dependencies as SchedulerDependencies,DependencyEdit as SchedulerDependencyEdit,DependencyModel as SchedulerDependencyModel,DependencyStore as SchedulerDependencyStore,SchedulerDom_default as SchedulerDom,SchedulerDomEvents_default as SchedulerDomEvents,EventModel as SchedulerEventModel,SchedulerEventRendering_default as SchedulerEventRendering,EventResize as SchedulerEventResize,EventStore as SchedulerEventStore,SchedulerExportDialog,SchedulerGeneralTab,Labels as SchedulerLabels,MultiPageExporter2 as SchedulerMultiPageExporter,MultiPageVerticalExporter2 as SchedulerMultiPageVerticalExporter,PartOfProject_default as SchedulerPartOfProject,PdfExport2 as SchedulerPdfExport,SchedulerPro,SchedulerProAssignmentMixin,AssignmentModel2 as SchedulerProAssignmentModel,AssignmentStore2 as SchedulerProAssignmentStore,SchedulerProBase,CalendarIntervalModel as SchedulerProCalendarIntervalModel,CalendarManagerStore as SchedulerProCalendarManagerStore,CalendarModel as SchedulerProCalendarModel,SchedulerProCycleEffect,SchedulerProDependencyMixin,DependencyModel2 as SchedulerProDependencyModel,DependencyStore2 as SchedulerProDependencyStore,SchedulerProEvent,SchedulerProEventRendering_default as SchedulerProEventRendering,SchedulerProHasAssignmentsMixin,SchedulerProProjectMixin,ProjectModel2 as SchedulerProProjectModel,SchedulerProResourceMixin,ResourceModel2 as SchedulerProResourceModel,ResourceStore2 as SchedulerProResourceStore,TaskEdit as SchedulerProTaskEdit,Versions as SchedulerProVersions,ProjectCrudManager_default as SchedulerProjectCrudManager,ProjectModel as SchedulerProjectModel,SchedulerRegions_default as SchedulerRegions,ResourceModel as SchedulerResourceModel,ResourceStore as SchedulerResourceStore,SchedulerScroll_default as SchedulerScroll,SinglePageExporter2 as SchedulerSinglePageExporter,SchedulerState_default as SchedulerState,SchedulerStores_default as SchedulerStores,Summary2 as SchedulerSummary,SchedulerTaskEditor,TimeAxisColumn as SchedulerTimeAxisColumn,SchedulingIssueEffectResolution,SchedulingIssueResolution_default as SchedulingIssueResolution,SchedulingIssueResolutionPopup,SchedulingMode,SchedulingModeColumn,SchedulingModePicker,Schema,ScrollManager,Scroller,Search,SequenceColumn,SharedEventStoreMixin_default as SharedEventStoreMixin,ShowInTimelineColumn,SimpleEventEdit,SinglePageExporter3 as SinglePageExporter,SlideToggle,Slider,Sort,SortedMap,Splitter,StartDateColumn,StartDateField,StartDateVar,State_default as State,StateBase,StateProvider,StateStorage,StateTrackingManager2 as StateTrackingManager,StickyCells,StickyEvents,Store,StoreCRUD_default as StoreCRUD,StoreChained_default as StoreChained,StoreChanges_default as StoreChanges,StoreDataField,StoreFilter_default as StoreFilter,StoreGroup_default as StoreGroup,StoreProxy_default as StoreProxy,StoreRelation_default as StoreRelation,StoreSearch_default as StoreSearch,StoreSort_default as StoreSort,StoreState_default as StoreState,StoreStm_default as StoreStm,StoreSum_default as StoreSum,StoreSync_default as StoreSync,StoreTree_default as StoreTree,StringDataField,StringHelper,Stripe,Styleable_default as Styleable,SubGrid,SuccessorColumn,SuccessorsTab,Summary3 as Summary,SynchronousCalculationStarted,Tab,TabBar,TabPanel,TableExporter,TaskCopyPaste,TaskDrag,TaskDragCreate,TaskEdit2 as TaskEdit,TaskEditor,TaskEditorBase,TaskMenu,TaskModel,TaskNavigation_default as TaskNavigation,TaskNonWorkingTime,TaskResize,TaskSegmentDrag,TaskSegmentResize,TaskStore,TaskTooltip,TemplateColumn,TemplateHelper,TextAreaField,TextAreaPickerField,TextField,TimeAxis,TimeAxisColumn2 as TimeAxisColumn,TimeAxisHeaderMenu,TimeAxisSubGrid,TimeAxisViewModel,TimeColumn,TimeField,TimePicker,TimeRanges,TimeSelection,TimeSpan,TimeSpanHighlight,TimeSpanMenuBase,TimeUnit,TimeZoneHelper,TimeZonedDatesMixin_default as TimeZonedDatesMixin,Timeline,TimelineBase,TimelineDateMapper_default as TimelineDateMapper,TimelineDomEvents_default as TimelineDomEvents,TimelineEventRendering_default as TimelineEventRendering,TimelineScroll_default as TimelineScroll,TimelineState_default as TimelineState,TimelineSummary,TimelineViewPresets_default as TimelineViewPresets,TimelineZoomable_default as TimelineZoomable,Toast,TombStone,Tool,Toolable_default as Toolable,Toolbar,Tooltip,TooltipBase,TotalSlackColumn,Transaction,TransactionCycleDetectionWalkContext,TransactionSymbol,TransactionWalkDepth,Tree,TreeColumn,TreeCombo,TreeGrid,TreeGroup2 as TreeGroup,TreeNode_default as TreeNode,UndoRedo,UndoRedoBase,UnitsVar,UnsafePreviousValueOf,UnsafePreviousValueOfEffect,UnsafePreviousValueOfSymbol,UnsafeProposedOrPreviousValueOf,UnsafeProposedOrPreviousValueOfEffect,UnsafeProposedOrPreviousValueOfSymbol,UnspecifiedTimeIntervalModel,UpdateAction,Use24hrsEmptyCalendarEffectResolution,Use8hrsEmptyCalendarEffectResolution,VISITED_TOPOLOGICALLY,Variable,VariableC,VariableInputState,VariableWalkContext,VersionGrid,VersionHelper,VersionModel,VersionStore,GanttVersions as Versions,VerticalRendering,VerticalTimeAxisColumn,ViewPreset,ViewPresetCombo,WBSColumn,WalkContext,WalkHelper,WalkSource,WalkState,Wbs,WbsField,WebSocketManager,WebSocketProjectModel,WeeklyRecurrenceIterator,Widget,WidgetColumn,WidgetHelper,Write,WriteEffect,WriteSeveral,WriteSeveralEffect,WriteSeveralSymbol,WriteSymbol,XMLHelper,YearPicker,YearlyRecurrenceIterator,binarySearch,bucket,build_proposed,calculate,calculateEffectiveEndDateConstraintInterval,calculateEffectiveStartDateConstraintInterval,combineCalendars,createEntityOnPrototype,cycleInfo,dateConverter,delay,durationFormula,effortFormula,endDateByEffortFormula,endDateFormula,ensureEntityOnPrototype,entity,entityDecoratorBody,field,fixedDurationAndEffortSEDWUGraphDescription,fixedDurationSEDWUBackwardEffortDriven,fixedDurationSEDWUBackwardNonEffortDriven,fixedDurationSEDWUForwardEffortDriven,fixedDurationSEDWUForwardNonEffortDriven,fixedDurationSEDWUGraphDescription,fixedEffortSEDWUBackward,fixedEffortSEDWUForward,fixedEffortSEDWUGraphDescription,fixedUnitsSEDWUBackwardEffortDriven,fixedUnitsSEDWUBackwardNonEffortDriven,fixedUnitsSEDWUForwardEffortDriven,fixedUnitsSEDWUForwardNonEffortDriven,fixedUnitsSEDWUGraphDescription,format,generic_field,getDecoratedModelFields,injectStaticFieldsProperty,intersectIntervals,isAtomicValue,isDateFinite,isNotNumber,isSerializableEqual,later,model_field,prototypeValue,reference,required,runGeneratorAsyncWithEffect,runGeneratorSyncWithEffect,startDateByEffortFormula,startDateFormula,stripDuplicates,throwUnknownIdentifier,unitMagnitudes,unitsFormula,validateRequiredProperties,write};