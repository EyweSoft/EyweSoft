function saveResSchedule(e,t,a,n,i){$.ajax({url:"/saveResSchedule",type:"post",data:{eventId:e,eventName:t,eventTime:a,remark:n},async:!1,success:function(e){0==e.code?parent.layer.msg(e.msg):parent.layer.msg(e.msg,1),i&&(i.id=e.id)}})}$((function(){function enableDrag(){$("#external-events .fc-event").each((function(){$(this).data("event",{title:$.trim($(this).text()),stick:!0}),$(this).draggable({zIndex:999,revert:!0,revertDuration:0})}))}enableDrag(),$(".save-event").on("click",(function(){var e=$("#addNewEvent form").find("input[name='category-name']").val(),t=$("#addNewEvent form").find("select[name='category-color']").val();null!==e&&0!=e.length&&($("#event-list").append('<div class="fc-event bg-'+t+'" data-class="bg-'+t+'">'+e+"</div>"),$("#addNewEvent form").find("input[name='category-name']").val(""),$("#addNewEvent form").find("select[name='category-color']").val(""),enableDrag())}));var calendar=$("#calendar"),newEvent=function(e,t,a){if(e&&t){var n=e._d,i=(t._d,"");let a,r,d,l,c,v,s;e._i instanceof Array?(a=e._i[0],r=String(e._i[1]+1).padStart(2,"0"),d=String(e._i[2]).padStart(2,"0"),l=String(e._i[3]).padStart(2,"0"),c=String(e._i[4]).padStart(2,"0"),v=a+"-"+r+"-"+d+" "+l+":"+c+":00",a=t._i[0],r=String(t._i[1]+1).padStart(2,"0"),d=String(t._i[2]).padStart(2,"0"),l=String(t._i[3]).padStart(2,"0"),c=String(t._i[4]).padStart(2,"0"),s=a+"-"+r+"-"+d+" "+l+":"+c+":00"):(a=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0"),v=a+"-"+r+"-"+d+" 09:00:00",s=a+"-"+r+"-"+d+" 18:00:00"),i=v+" - "+s}var r=$("#addDirectEvent"),d=r.find('input[name="event-name"]'),l=r.find('input[name="event-time"]'),c=r.find('textarea[name="event-remark"]');d.val(""),l.val(i),c.val(""),r.modal("show");var v=$("#addDirectEvent .save-btn");v.unbind(),v.on("click",(function(){var t=d.val(),a=l.val(),n="";if(a&&a.indexOf(" - ")>0){var i=a.split(" - ");e=i[0],n=i[1]}var v=$("#myBg").val(),s=c.val();if(t&&a){var o={title:t,start:e,end:n,allDay:!1,isTask:"N",isMy:"Y",remark:c.val(),className:v};saveResSchedule("",t,a,s,o),calendar.fullCalendar("renderEvent",o,!0),r.modal("hide")}else t?a||l.focus():d.focus()}))},calData="",taskList=$("#taskList").val();taskList&&(calData=eval("("+taskList+")")),calendar.fullCalendar({header:{left:"month, agendaWeek, agendaDay",center:"prev, title, next",right:""},editable:!1,droppable:!0,eventLimit:!1,selectable:!0,events:calData,drop:function(e,t){$("#drop-remove").is(":checked")&&$(this).remove()},select:function(e,t,a){newEvent(e,t,a)},eventClick:function(e,t,a){var n=e.isTask,i=e.isMy,r=$("#btnEdit").val();if(n&&"Y"==n||!i||"Y"!=i||!r||"Y"!=r){d=$("#eventViewModal");$("#event-name").text(e.title),e.remark?$("#event-remark").text(e.remark):$("#event-remark").text("");l="";e.start&&(l=e.start._i+" - ",e.end?l+=e.end._i:l+=e.start._i),$("#event-time").text(l),d.modal("show")}else{var d;(d=$("#eventEditModal")).modal("show"),d.find('input[name="event-name"]').val(e.title),d.find('textarea[name="event-remark"]').val(e.remark);var l="";e.start&&(l=e.start._i+" - ",e.end?l+=e.end._i:l+=e.start._i),d.find('input[name="event-time"]').val(l);var c=d.find(".save-btn");c.unbind(),c.click((function(){var t=d.find("input[name='event-name']").val(),a=d.find("textarea[name='event-remark']").val(),n=d.find("input[name='event-time']").val();if(n&&n.indexOf(" - ")>0){var i=n.split(" - ");start=i[0],end=i[1]}e.title=t,e.remark=a,e.start=start,e.end=end,saveResSchedule(e.id,t,n,a),calendar.fullCalendar("updateEvent",e),d.modal("hide")}));var v=d.find(".delete-btn");v.unbind(),v.click((function(){top.layer.confirm("确定要删除选中的日程？",{btn:[$.i18n.prop("common.comfirm"),$.i18n.prop("common.cancel")]},(function(){$.ajax({url:"/removeResSchedule",type:"post",data:{eventId:e.id},async:!1,success:function(e){0==e.code?parent.layer.msg(e.msg):parent.layer.msg(e.msg,1)}}),calendar.fullCalendar("removeEvents",e._id),d.modal("hide")}))}))}}});var divBtn='<div class="checkbox"><input data-target="checkbox" type="checkbox" checked id="taskId" name="scheduleType" value="task" onclick="filterSchedule($(this))"><label for="taskId" title="任务">任务</label></div>';divBtn+='<div class="checkbox"><input data-target="checkbox" type="checkbox" checked id="scheduleId" name="scheduleType" value="schedule" onclick="filterSchedule($(this))"><label for="scheduleId" title="日程">日程</label></div>',$(".fc-toolbar .fc-left").append($(divBtn))}));